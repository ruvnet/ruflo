{"version":3,"sources":["../../../src/core/ConfigManager.ts"],"sourcesContent":["/**\r\n * ConfigManager - Handles configuration validation and setup\r\n * Manages environment variables, file-based config, and validation schemas\r\n */\r\n\r\nimport * as fs from 'fs-extra';\r\nimport * as path from 'path';\r\nimport { ConfigValidationResult, InitConfig, DatabaseConfig, TopologyConfig } from '../types/interfaces.js';\r\n\r\nexport interface ClaudeFlowConfig {\r\n  // Core settings\r\n  mode?: string;\r\n  topology?: string;\r\n  maxAgents?: number;\r\n  strategy?: string;\r\n\r\n  // Database configuration\r\n  database?: DatabaseConfig;\r\n\r\n  // Topology configuration\r\n  topologyConfig?: TopologyConfig;\r\n\r\n  // MCP integration\r\n  mcpServers?: MCPServerConfig[];\r\n\r\n  // GitHub integration\r\n  github?: GitHubConfig;\r\n\r\n  // Neural network settings\r\n  neural?: NeuralConfig;\r\n\r\n  // Hive mind settings\r\n  hiveMind?: HiveMindConfig;\r\n\r\n  // Enterprise features\r\n  enterprise?: EnterpriseConfig;\r\n\r\n  // Debugging and logging\r\n  debug?: boolean;\r\n  logLevel?: 'error' | 'warn' | 'info' | 'debug';\r\n  logPath?: string;\r\n\r\n  // Performance settings\r\n  performance?: PerformanceConfig;\r\n}\r\n\r\nexport interface MCPServerConfig {\r\n  name: string;\r\n  command: string;\r\n  args?: string[];\r\n  env?: Record<string, string>;\r\n  enabled: boolean;\r\n}\r\n\r\nexport interface GitHubConfig {\r\n  token?: string;\r\n  owner?: string;\r\n  repo?: string;\r\n  webhookSecret?: string;\r\n  autoSync?: boolean;\r\n}\r\n\r\nexport interface NeuralConfig {\r\n  modelPath?: string;\r\n  wasmOptimization?: boolean;\r\n  simdAcceleration?: boolean;\r\n  trainingEnabled?: boolean;\r\n}\r\n\r\nexport interface HiveMindConfig {\r\n  queenEnabled?: boolean;\r\n  workerPoolSize?: number;\r\n  consensusThreshold?: number;\r\n  adaptationRate?: number;\r\n}\r\n\r\nexport interface EnterpriseConfig {\r\n  authentication?: boolean;\r\n  encryption?: boolean;\r\n  audit?: boolean;\r\n  compliance?: string[];\r\n}\r\n\r\nexport interface PerformanceConfig {\r\n  maxConcurrency?: number;\r\n  timeout?: number;\r\n  retryAttempts?: number;\r\n  cacheEnabled?: boolean;\r\n}\r\n\r\nexport class ConfigManager {\r\n  private config: ClaudeFlowConfig = {};\r\n  private configPath: string;\r\n\r\n  constructor(configPath?: string) {\r\n    this.configPath = configPath || this.findConfigFile();\r\n    this.loadConfiguration();\r\n  }\r\n\r\n  /**\r\n   * Find configuration file in standard locations\r\n   */\r\n  private findConfigFile(): string {\r\n    const possiblePaths = [\r\n      'claude-flow.config.json',\r\n      'claude-flow.config.js',\r\n      '.claude-flow.json',\r\n      '.claude-flow/config.json',\r\n      'config/claude-flow.json',\r\n      path.join(process.cwd(), 'claude-flow.config.json')\r\n    ];\r\n\r\n    for (const configPath of possiblePaths) {\r\n      if (fs.existsSync(configPath)) {\r\n        return configPath;\r\n      }\r\n    }\r\n\r\n    return 'claude-flow.config.json'; // Default\r\n  }\r\n\r\n  /**\r\n   * Load configuration from file and environment variables\r\n   */\r\n  private loadConfiguration(): void {\r\n    // Load from file if exists\r\n    if (fs.existsSync(this.configPath)) {\r\n      try {\r\n        const fileContent = fs.readFileSync(this.configPath, 'utf8');\r\n        this.config = JSON.parse(fileContent);\r\n      } catch (error) {\r\n        console.warn(`Failed to load config from ${this.configPath}:`, error);\r\n      }\r\n    }\r\n\r\n    // Override with environment variables\r\n    this.loadEnvironmentVariables();\r\n  }\r\n\r\n  /**\r\n   * Load configuration from environment variables\r\n   */\r\n  private loadEnvironmentVariables(): void {\r\n    const envConfig: Partial<ClaudeFlowConfig> = {};\r\n\r\n    // Core settings\r\n    if (process.env.CLAUDE_FLOW_MODE) envConfig.mode = process.env.CLAUDE_FLOW_MODE;\r\n    if (process.env.CLAUDE_FLOW_TOPOLOGY) envConfig.topology = process.env.CLAUDE_FLOW_TOPOLOGY;\r\n    if (process.env.CLAUDE_FLOW_MAX_AGENTS) envConfig.maxAgents = parseInt(process.env.CLAUDE_FLOW_MAX_AGENTS);\r\n    if (process.env.CLAUDE_FLOW_STRATEGY) envConfig.strategy = process.env.CLAUDE_FLOW_STRATEGY;\r\n\r\n    // Database\r\n    if (process.env.CLAUDE_FLOW_DATABASE_TYPE || process.env.CLAUDE_FLOW_DATABASE_PATH) {\r\n      envConfig.database = {\r\n        type: (process.env.CLAUDE_FLOW_DATABASE_TYPE as 'sqlite' | 'json') || 'sqlite',\r\n        path: process.env.CLAUDE_FLOW_DATABASE_PATH\r\n      };\r\n    }\r\n\r\n    // GitHub\r\n    if (process.env.GITHUB_TOKEN) {\r\n      envConfig.github = {\r\n        token: process.env.GITHUB_TOKEN,\r\n        owner: process.env.GITHUB_OWNER,\r\n        repo: process.env.GITHUB_REPO,\r\n        webhookSecret: process.env.GITHUB_WEBHOOK_SECRET,\r\n        autoSync: process.env.GITHUB_AUTO_SYNC === 'true'\r\n      };\r\n    }\r\n\r\n    // Debug\r\n    if (process.env.CLAUDE_FLOW_DEBUG) envConfig.debug = process.env.CLAUDE_FLOW_DEBUG === 'true';\r\n    if (process.env.CLAUDE_FLOW_LOG_LEVEL) envConfig.logLevel = process.env.CLAUDE_FLOW_LOG_LEVEL as any;\r\n\r\n    // Merge with existing config\r\n    this.config = { ...this.config, ...envConfig };\r\n  }\r\n\r\n  /**\r\n   * Validate the configuration\r\n   */\r\n  async validate(): Promise<ConfigValidationResult> {\r\n    const errors: string[] = [];\r\n    const warnings: string[] = [];\r\n\r\n    // Validate mode\r\n    const validModes = ['standard', 'github', 'hive-mind', 'sparc', 'neural', 'enterprise'];\r\n    if (this.config.mode && !validModes.includes(this.config.mode)) {\r\n      errors.push(`Invalid mode: ${this.config.mode}. Valid modes: ${validModes.join(', ')}`);\r\n    }\r\n\r\n    // Validate topology\r\n    const validTopologies = ['mesh', 'hierarchical', 'ring', 'star'];\r\n    if (this.config.topology && !validTopologies.includes(this.config.topology)) {\r\n      errors.push(`Invalid topology: ${this.config.topology}. Valid topologies: ${validTopologies.join(', ')}`);\r\n    }\r\n\r\n    // Validate maxAgents\r\n    if (this.config.maxAgents !== undefined) {\r\n      if (this.config.maxAgents < 1 || this.config.maxAgents > 100) {\r\n        errors.push('maxAgents must be between 1 and 100');\r\n      }\r\n    }\r\n\r\n    // Validate strategy\r\n    const validStrategies = ['balanced', 'specialized', 'adaptive'];\r\n    if (this.config.strategy && !validStrategies.includes(this.config.strategy)) {\r\n      errors.push(`Invalid strategy: ${this.config.strategy}. Valid strategies: ${validStrategies.join(', ')}`);\r\n    }\r\n\r\n    // Validate database configuration\r\n    if (this.config.database) {\r\n      if (!['sqlite', 'json'].includes(this.config.database.type)) {\r\n        errors.push('Database type must be either \"sqlite\" or \"json\"');\r\n      }\r\n\r\n      if (this.config.database.path && !fs.existsSync(path.dirname(this.config.database.path))) {\r\n        warnings.push(`Database directory does not exist: ${path.dirname(this.config.database.path)}`);\r\n      }\r\n    }\r\n\r\n    // Validate GitHub configuration\r\n    if (this.config.github?.token && !this.config.github.token.startsWith('ghp_')) {\r\n      warnings.push('GitHub token format appears invalid');\r\n    }\r\n\r\n    // Validate performance configuration\r\n    if (this.config.performance?.maxConcurrency && this.config.performance.maxConcurrency < 1) {\r\n      errors.push('maxConcurrency must be at least 1');\r\n    }\r\n\r\n    return {\r\n      valid: errors.length === 0,\r\n      errors,\r\n      warnings\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Get the current configuration\r\n   */\r\n  getConfig(): ClaudeFlowConfig {\r\n    return { ...this.config };\r\n  }\r\n\r\n  /**\r\n   * Get a specific configuration value\r\n   */\r\n  get<K extends keyof ClaudeFlowConfig>(key: K): ClaudeFlowConfig[K] {\r\n    return this.config[key];\r\n  }\r\n\r\n  /**\r\n   * Set a configuration value\r\n   */\r\n  set<K extends keyof ClaudeFlowConfig>(key: K, value: ClaudeFlowConfig[K]): void {\r\n    this.config[key] = value;\r\n  }\r\n\r\n  /**\r\n   * Save configuration to file\r\n   */\r\n  async save(): Promise<void> {\r\n    try {\r\n      await fs.ensureDir(path.dirname(this.configPath));\r\n      await fs.writeJSON(this.configPath, this.config, { spaces: 2 });\r\n    } catch (error) {\r\n      throw new Error(`Failed to save configuration: ${error}`);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Reset configuration to defaults\r\n   */\r\n  reset(): void {\r\n    this.config = {\r\n      mode: 'standard',\r\n      topology: 'mesh',\r\n      maxAgents: 8,\r\n      strategy: 'balanced',\r\n      database: {\r\n        type: 'sqlite',\r\n        path: '.claude-flow/database.sqlite'\r\n      },\r\n      debug: false,\r\n      logLevel: 'info'\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Merge additional configuration\r\n   */\r\n  merge(additionalConfig: Partial<ClaudeFlowConfig>): void {\r\n    this.config = { ...this.config, ...additionalConfig };\r\n  }\r\n\r\n  /**\r\n   * Create InitConfig from current configuration\r\n   */\r\n  toInitConfig(): InitConfig {\r\n    return {\r\n      mode: this.config.mode as any,\r\n      topology: this.config.topology as any,\r\n      maxAgents: this.config.maxAgents,\r\n      strategy: this.config.strategy as any,\r\n      database: this.config.database?.type,\r\n      debug: this.config.debug\r\n    };\r\n  }\r\n}"],"names":["fs","path","ConfigManager","config","configPath","findConfigFile","loadConfiguration","possiblePaths","join","process","cwd","existsSync","fileContent","readFileSync","JSON","parse","error","console","warn","loadEnvironmentVariables","envConfig","env","CLAUDE_FLOW_MODE","mode","CLAUDE_FLOW_TOPOLOGY","topology","CLAUDE_FLOW_MAX_AGENTS","maxAgents","parseInt","CLAUDE_FLOW_STRATEGY","strategy","CLAUDE_FLOW_DATABASE_TYPE","CLAUDE_FLOW_DATABASE_PATH","database","type","GITHUB_TOKEN","github","token","owner","GITHUB_OWNER","repo","GITHUB_REPO","webhookSecret","GITHUB_WEBHOOK_SECRET","autoSync","GITHUB_AUTO_SYNC","CLAUDE_FLOW_DEBUG","debug","CLAUDE_FLOW_LOG_LEVEL","logLevel","validate","errors","warnings","validModes","includes","push","validTopologies","undefined","validStrategies","dirname","startsWith","performance","maxConcurrency","valid","length","getConfig","get","key","set","value","save","ensureDir","writeJSON","spaces","Error","reset","merge","additionalConfig","toInitConfig"],"mappings":"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"}