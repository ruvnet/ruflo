{"version":3,"sources":["../../../../src/cli/simple-commands/process-ui.js"],"sourcesContent":["// process-ui.js - Simple process management UI in pure JavaScript\r\nimport { printSuccess, printError, printWarning, printInfo } from '../utils.js';\r\nimport { cwd, exit, existsSync } from '../node-compat.js';\r\nimport process from 'process';\r\n\r\n// Simple color utilities\r\nconst colors = {\r\n  cyan: (text) => `\\x1b[36m${text}\\x1b[0m`,\r\n  gray: (text) => `\\x1b[90m${text}\\x1b[0m`,\r\n  white: (text) => `\\x1b[37m${text}\\x1b[0m`,\r\n  yellow: (text) => `\\x1b[33m${text}\\x1b[0m`,\r\n  green: (text) => `\\x1b[32m${text}\\x1b[0m`,\r\n  red: (text) => `\\x1b[31m${text}\\x1b[0m`,\r\n};\r\n\r\nconst PROCESSES = [\r\n  { id: 'event-bus', name: 'Event Bus', description: 'Central event distribution system' },\r\n  { id: 'orchestrator', name: 'Orchestrator', description: 'Main coordination engine' },\r\n  { id: 'memory-manager', name: 'Memory Manager', description: 'Persistent memory system' },\r\n  { id: 'terminal-pool', name: 'Terminal Pool', description: 'Terminal session management' },\r\n  { id: 'mcp-server', name: 'MCP Server', description: 'Model Context Protocol server' },\r\n  { id: 'coordinator', name: 'Coordinator', description: 'Task coordination service' },\r\n];\r\n\r\nexport class ProcessUI {\r\n  constructor() {\r\n    this.processes = new Map();\r\n    this.running = true;\r\n    this.selectedIndex = 0;\r\n\r\n    // Initialize process states\r\n    PROCESSES.forEach((p) => {\r\n      this.processes.set(p.id, {\r\n        ...p,\r\n        status: 'stopped',\r\n        pid: null,\r\n        uptime: 0,\r\n        cpu: 0,\r\n        memory: 0,\r\n      });\r\n    });\r\n  }\r\n\r\n  async start() {\r\n    // Clear screen\r\n    console.clear();\r\n\r\n    // Show welcome\r\n    printSuccess('üß† Claude-Flow Process Management UI v1.0.43');\r\n    console.log('‚îÄ'.repeat(60));\r\n    console.log();\r\n\r\n    // Initial render\r\n    this.render();\r\n\r\n    // Main UI loop\r\n    while (this.running) {\r\n      await this.handleInput();\r\n      if (this.running) {\r\n        // Only re-render if still running\r\n        this.render();\r\n      }\r\n    }\r\n  }\r\n\r\n  render() {\r\n    // Clear screen and move cursor to top\r\n    console.log('\\x1b[2J\\x1b[H');\r\n\r\n    // Header\r\n    console.log(colors.cyan('üß† Claude-Flow Process Manager'));\r\n    console.log(colors.gray('‚îÄ'.repeat(60)));\r\n    console.log();\r\n\r\n    // Process list\r\n    console.log(colors.white('Processes:'));\r\n    console.log();\r\n\r\n    let index = 0;\r\n    for (const [id, process] of this.processes) {\r\n      const selected = index === this.selectedIndex;\r\n      const prefix = selected ? colors.yellow('‚ñ∂ ') : '  ';\r\n      const status = this.getStatusIcon(process.status);\r\n      const name = selected ? colors.yellow(process.name) : colors.white(process.name);\r\n\r\n      console.log(`${prefix}[${index + 1}] ${status} ${name}`);\r\n      console.log(`     ${colors.gray(process.description)}`);\r\n\r\n      if (process.status === 'running') {\r\n        console.log(\r\n          `     ${colors.gray(`PID: ${process.pid} | Uptime: ${this.formatUptime(process.uptime)}`)}`,\r\n        );\r\n      }\r\n      console.log();\r\n\r\n      index++;\r\n    }\r\n\r\n    // Controls\r\n    console.log(colors.gray('‚îÄ'.repeat(60)));\r\n    console.log(colors.white('Controls:'));\r\n    console.log(\r\n      `  ${colors.yellow('1-6')} Select process   ${colors.yellow('Space/Enter')} Toggle selected`,\r\n    );\r\n    console.log(`  ${colors.yellow('A')} Start all         ${colors.yellow('Z')} Stop all`);\r\n    console.log(`  ${colors.yellow('R')} Restart all       ${colors.yellow('Q')} Quit`);\r\n    console.log();\r\n    console.log(colors.gray('‚îÄ'.repeat(60)));\r\n  }\r\n\r\n  getStatusIcon(status) {\r\n    switch (status) {\r\n      case 'running':\r\n        return colors.green('‚óè');\r\n      case 'stopped':\r\n        return colors.gray('‚óã');\r\n      case 'error':\r\n        return colors.red('‚úó');\r\n      case 'starting':\r\n        return colors.yellow('‚óê');\r\n      default:\r\n        return colors.gray('?');\r\n    }\r\n  }\r\n\r\n  formatUptime(seconds) {\r\n    if (seconds < 60) return `${seconds}s`;\r\n    if (seconds < 3600) return `${Math.floor(seconds / 60)}m`;\r\n    return `${Math.floor(seconds / 3600)}h`;\r\n  }\r\n\r\n  async handleInput() {\r\n    // Simple input reading\r\n    const decoder = new TextDecoder();\r\n    const encoder = new TextEncoder();\r\n\r\n    await Deno.stdout.write(encoder.encode('\\nCommand: '));\r\n\r\n    const buf = new Uint8Array(1024);\r\n    const n = await Deno.stdin.read(buf);\r\n    if (n === null) return;\r\n\r\n    const rawInput = decoder.decode(buf.subarray(0, n)).trim();\r\n    // Take only the first line if multiple lines were read\r\n    const input = rawInput.split('\\n')[0].toLowerCase();\r\n\r\n    // Handle commands\r\n    switch (input) {\r\n      case 'q':\r\n      case 'quit':\r\n        this.running = false;\r\n        console.clear();\r\n        printSuccess('Goodbye!');\r\n        process.exit(0); // Exit immediately\r\n        break;\r\n\r\n      case 'a':\r\n        await this.startAll();\r\n        break;\r\n\r\n      case 'z':\r\n        await this.stopAll();\r\n        break;\r\n\r\n      case 'r':\r\n        await this.restartAll();\r\n        break;\r\n\r\n      case '1':\r\n      case '2':\r\n      case '3':\r\n      case '4':\r\n      case '5':\r\n      case '6':\r\n        const index = parseInt(input) - 1;\r\n        if (index >= 0 && index < PROCESSES.length) {\r\n          this.selectedIndex = index;\r\n          await this.toggleSelected();\r\n        }\r\n        break;\r\n\r\n      case ' ':\r\n      case 'enter':\r\n      case '':\r\n        await this.toggleSelected();\r\n        break;\r\n\r\n      default:\r\n        if (input) {\r\n          console.log(colors.yellow(`Unknown command: ${input}`));\r\n          await new Promise((resolve) => setTimeout(resolve, 1000));\r\n        }\r\n    }\r\n  }\r\n\r\n  async toggleSelected() {\r\n    const process = Array.from(this.processes.values())[this.selectedIndex];\r\n    if (process.status === 'stopped') {\r\n      await this.startProcess(process.id);\r\n    } else {\r\n      await this.stopProcess(process.id);\r\n    }\r\n  }\r\n\r\n  async startProcess(id) {\r\n    const process = this.processes.get(id);\r\n    if (!process) return;\r\n\r\n    console.log(colors.yellow(`Starting ${process.name}...`));\r\n    process.status = 'starting';\r\n\r\n    // Simulate startup\r\n    await new Promise((resolve) => setTimeout(resolve, 500));\r\n\r\n    process.status = 'running';\r\n    process.pid = Math.floor(Math.random() * 10000) + 1000;\r\n    process.uptime = 0;\r\n\r\n    console.log(colors.green(`‚úì ${process.name} started`));\r\n\r\n    // Start uptime counter\r\n    const interval = setInterval(() => {\r\n      if (process.status === 'running') {\r\n        process.uptime++;\r\n      } else {\r\n        clearInterval(interval);\r\n      }\r\n    }, 1000);\r\n  }\r\n\r\n  async stopProcess(id) {\r\n    const process = this.processes.get(id);\r\n    if (!process) return;\r\n\r\n    console.log(colors.yellow(`Stopping ${process.name}...`));\r\n    process.status = 'stopped';\r\n    process.pid = null;\r\n    process.uptime = 0;\r\n\r\n    await new Promise((resolve) => setTimeout(resolve, 300));\r\n    console.log(colors.green(`‚úì ${process.name} stopped`));\r\n  }\r\n\r\n  async startAll() {\r\n    console.log(colors.yellow('Starting all processes...'));\r\n    for (const [id, process] of this.processes) {\r\n      if (process.status === 'stopped') {\r\n        await this.startProcess(id);\r\n      }\r\n    }\r\n    console.log(colors.green('‚úì All processes started'));\r\n  }\r\n\r\n  async stopAll() {\r\n    console.log(colors.yellow('Stopping all processes...'));\r\n    for (const [id, process] of this.processes) {\r\n      if (process.status === 'running') {\r\n        await this.stopProcess(id);\r\n      }\r\n    }\r\n    console.log(colors.green('‚úì All processes stopped'));\r\n  }\r\n\r\n  async restartAll() {\r\n    await this.stopAll();\r\n    await new Promise((resolve) => setTimeout(resolve, 500));\r\n    await this.startAll();\r\n  }\r\n}\r\n\r\nexport async function launchProcessUI() {\r\n  const ui = new ProcessUI();\r\n  await ui.start();\r\n}\r\n"],"names":["printSuccess","process","colors","cyan","text","gray","white","yellow","green","red","PROCESSES","id","name","description","ProcessUI","processes","Map","running","selectedIndex","forEach","p","set","status","pid","uptime","cpu","memory","start","console","clear","log","repeat","render","handleInput","index","selected","prefix","getStatusIcon","formatUptime","seconds","Math","floor","decoder","TextDecoder","encoder","TextEncoder","Deno","stdout","write","encode","buf","Uint8Array","n","stdin","read","rawInput","decode","subarray","trim","input","split","toLowerCase","exit","startAll","stopAll","restartAll","parseInt","length","toggleSelected","Promise","resolve","setTimeout","Array","from","values","startProcess","stopProcess","get","random","interval","setInterval","clearInterval","launchProcessUI","ui"],"mappings":"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"}