{"version":3,"sources":["../../../../../../src/cli/simple-commands/init/templates/github-safe.js"],"sourcesContent":["#!/usr/bin/env node\r\n\r\n/**\r\n * Safe GitHub CLI Helper\r\n * Prevents timeout issues when using gh commands with special characters\r\n * \r\n * Usage:\r\n *   ./github-safe.js issue comment 123 \"Message with `backticks`\"\r\n *   ./github-safe.js pr create --title \"Title\" --body \"Complex body\"\r\n */\r\n\r\nimport { execSync } from 'child_process';\r\nimport { writeFileSync, unlinkSync } from 'fs';\r\nimport { tmpdir } from 'os';\r\nimport { join } from 'path';\r\nimport { randomBytes } from 'crypto';\r\n\r\nconst args = process.argv.slice(2);\r\n\r\nif (args.length < 2) {\r\n  console.log(`\r\nSafe GitHub CLI Helper\r\n\r\nUsage:\r\n  ./github-safe.js issue comment <number> <body>\r\n  ./github-safe.js pr comment <number> <body>\r\n  ./github-safe.js issue create --title <title> --body <body>\r\n  ./github-safe.js pr create --title <title> --body <body>\r\n\r\nThis helper prevents timeout issues with special characters like:\r\n- Backticks in code examples\r\n- Command substitution \\$(...)\r\n- Directory paths\r\n- Special shell characters\r\n`);\r\n  process.exit(1);\r\n}\r\n\r\nconst [command, subcommand, ...restArgs] = args;\r\n\r\n// Handle commands that need body content\r\nif ((command === 'issue' || command === 'pr') && \r\n    (subcommand === 'comment' || subcommand === 'create')) {\r\n  \r\n  let bodyIndex = -1;\r\n  let body = '';\r\n  \r\n  if (subcommand === 'comment' && restArgs.length >= 2) {\r\n    // Simple format: github-safe.js issue comment 123 \"body\"\r\n    body = restArgs[1];\r\n    bodyIndex = 1;\r\n  } else {\r\n    // Flag format: --body \"content\" \r\n    bodyIndex = restArgs.indexOf('--body');\r\n    if (bodyIndex !== -1 && bodyIndex < restArgs.length - 1) {\r\n      body = restArgs[bodyIndex + 1];\r\n    }\r\n  }\r\n  \r\n  if (body) {\r\n    // Use temporary file for body content\r\n    const tmpFile = join(tmpdir(), `gh-body-${randomBytes(8).toString('hex')}.tmp`);\r\n    \r\n    try {\r\n      writeFileSync(tmpFile, body, 'utf8');\r\n      \r\n      // Build new command with --body-file\r\n      const newArgs = [...restArgs];\r\n      if (subcommand === 'comment' && bodyIndex === 1) {\r\n        // Replace body with --body-file\r\n        newArgs[1] = '--body-file';\r\n        newArgs.push(tmpFile);\r\n      } else if (bodyIndex !== -1) {\r\n        // Replace --body with --body-file\r\n        newArgs[bodyIndex] = '--body-file';\r\n        newArgs[bodyIndex + 1] = tmpFile;\r\n      }\r\n      \r\n      // Execute safely\r\n      const ghCommand = `gh ${command} ${subcommand} ${newArgs.join(' ')}`;\r\n      console.log(`Executing: ${ghCommand}`);\r\n      \r\n      const result = execSync(ghCommand, { \r\n        stdio: 'inherit',\r\n        timeout: 30000 // 30 second timeout\r\n      });\r\n      \r\n    } catch (error) {\r\n      console.error('Error:', error.message);\r\n      process.exit(1);\r\n    } finally {\r\n      // Clean up\r\n      try {\r\n        unlinkSync(tmpFile);\r\n      } catch (e) {\r\n        // Ignore cleanup errors\r\n      }\r\n    }\r\n  } else {\r\n    // No body content, execute normally\r\n    execSync(`gh ${args.join(' ')}`, { stdio: 'inherit' });\r\n  }\r\n} else {\r\n  // Other commands, execute normally\r\n  execSync(`gh ${args.join(' ')}`, { stdio: 'inherit' });\r\n}"],"names":["execSync","writeFileSync","unlinkSync","tmpdir","join","randomBytes","args","process","argv","slice","length","console","log","exit","command","subcommand","restArgs","bodyIndex","body","indexOf","tmpFile","toString","newArgs","push","ghCommand","result","stdio","timeout","error","message","e"],"mappings":";AAWA,SAASA,QAAQ,QAAQ,gBAAgB;AACzC,SAASC,aAAa,EAAEC,UAAU,QAAQ,KAAK;AAC/C,SAASC,MAAM,QAAQ,KAAK;AAC5B,SAASC,IAAI,QAAQ,OAAO;AAC5B,SAASC,WAAW,QAAQ,SAAS;AAErC,MAAMC,OAAOC,QAAQC,IAAI,CAACC,KAAK,CAAC;AAEhC,IAAIH,KAAKI,MAAM,GAAG,GAAG;IACnBC,QAAQC,GAAG,CAAC,CAAC;;;;;;;;;;;;;;AAcf,CAAC;IACCL,QAAQM,IAAI,CAAC;AACf;AAEA,MAAM,CAACC,SAASC,YAAY,GAAGC,SAAS,GAAGV;AAG3C,IAAI,AAACQ,CAAAA,YAAY,WAAWA,YAAY,IAAG,KACtCC,CAAAA,eAAe,aAAaA,eAAe,QAAO,GAAI;IAEzD,IAAIE,YAAY,CAAC;IACjB,IAAIC,OAAO;IAEX,IAAIH,eAAe,aAAaC,SAASN,MAAM,IAAI,GAAG;QAEpDQ,OAAOF,QAAQ,CAAC,EAAE;QAClBC,YAAY;IACd,OAAO;QAELA,YAAYD,SAASG,OAAO,CAAC;QAC7B,IAAIF,cAAc,CAAC,KAAKA,YAAYD,SAASN,MAAM,GAAG,GAAG;YACvDQ,OAAOF,QAAQ,CAACC,YAAY,EAAE;QAChC;IACF;IAEA,IAAIC,MAAM;QAER,MAAME,UAAUhB,KAAKD,UAAU,CAAC,QAAQ,EAAEE,YAAY,GAAGgB,QAAQ,CAAC,OAAO,IAAI,CAAC;QAE9E,IAAI;YACFpB,cAAcmB,SAASF,MAAM;YAG7B,MAAMI,UAAU;mBAAIN;aAAS;YAC7B,IAAID,eAAe,aAAaE,cAAc,GAAG;gBAE/CK,OAAO,CAAC,EAAE,GAAG;gBACbA,QAAQC,IAAI,CAACH;YACf,OAAO,IAAIH,cAAc,CAAC,GAAG;gBAE3BK,OAAO,CAACL,UAAU,GAAG;gBACrBK,OAAO,CAACL,YAAY,EAAE,GAAGG;YAC3B;YAGA,MAAMI,YAAY,CAAC,GAAG,EAAEV,QAAQ,CAAC,EAAEC,WAAW,CAAC,EAAEO,QAAQlB,IAAI,CAAC,MAAM;YACpEO,QAAQC,GAAG,CAAC,CAAC,WAAW,EAAEY,WAAW;YAErC,MAAMC,SAASzB,SAASwB,WAAW;gBACjCE,OAAO;gBACPC,SAAS;YACX;QAEF,EAAE,OAAOC,OAAO;YACdjB,QAAQiB,KAAK,CAAC,UAAUA,MAAMC,OAAO;YACrCtB,QAAQM,IAAI,CAAC;QACf,SAAU;YAER,IAAI;gBACFX,WAAWkB;YACb,EAAE,OAAOU,GAAG,CAEZ;QACF;IACF,OAAO;QAEL9B,SAAS,CAAC,GAAG,EAAEM,KAAKF,IAAI,CAAC,MAAM,EAAE;YAAEsB,OAAO;QAAU;IACtD;AACF,OAAO;IAEL1B,SAAS,CAAC,GAAG,EAAEM,KAAKF,IAAI,CAAC,MAAM,EAAE;QAAEsB,OAAO;IAAU;AACtD"}