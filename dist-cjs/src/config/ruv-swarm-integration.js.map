{"version":3,"sources":["../../../src/config/ruv-swarm-integration.ts"],"sourcesContent":["/**\r\n * ruv-swarm integration helper for Claude Code configuration\r\n *\r\n * This module bridges the main claude-flow configuration with\r\n * ruv-swarm specific settings and provides utility functions\r\n * for seamless integration.\r\n */\r\n\r\nimport { configManager, ConfigManager } from './config-manager.js';\r\nimport { getRuvSwarmConfigManager, RuvSwarmConfigManager } from './ruv-swarm-config.js';\r\n// import { createLogger } from '../core/logger.js';\r\n\r\n// Create logger for integration\r\n// const logger = createLogger('ruv-swarm-integration');\r\n\r\n/**\r\n * Integration manager that synchronizes configurations\r\n */\r\nexport class RuvSwarmIntegration {\r\n  private configManager: ConfigManager;\r\n  private ruvSwarmManager: RuvSwarmConfigManager;\r\n\r\n  constructor(configManager: ConfigManager, ruvSwarmManager: RuvSwarmConfigManager) {\r\n    this.configManager = configManager;\r\n    this.ruvSwarmManager = ruvSwarmManager;\r\n  }\r\n\r\n  /**\r\n   * Synchronize main config with ruv-swarm config\r\n   */\r\n  syncConfiguration(): void {\r\n    const mainConfig = this.configManager.getRuvSwarmConfig();\r\n    const ruvSwarmConfig = this.ruvSwarmManager.getConfig();\r\n\r\n    // Update ruv-swarm config from main config\r\n    if (mainConfig.enabled) {\r\n      this.ruvSwarmManager.updateSwarmConfig({\r\n        defaultTopology: mainConfig.defaultTopology,\r\n        maxAgents: mainConfig.maxAgents,\r\n        defaultStrategy: mainConfig.defaultStrategy,\r\n        enableHooks: mainConfig.enableHooks,\r\n      });\r\n\r\n      this.ruvSwarmManager.updateIntegrationConfig({\r\n        enableMCPTools: true,\r\n        enableCLICommands: true,\r\n        enableHooks: mainConfig.enableHooks,\r\n      });\r\n\r\n      this.ruvSwarmManager.updateMemoryConfig({\r\n        enablePersistence: mainConfig.enablePersistence,\r\n      });\r\n\r\n      this.ruvSwarmManager.updateNeuralConfig({\r\n        enableTraining: mainConfig.enableNeuralTraining,\r\n      });\r\n    }\r\n\r\n    // logger.debug('Configuration synchronized between main and ruv-swarm configs');\r\n  }\r\n\r\n  /**\r\n   * Get unified command arguments for ruv-swarm CLI\r\n   */\r\n  getUnifiedCommandArgs(): string[] {\r\n    const mainArgs = this.configManager.getRuvSwarmArgs();\r\n    const ruvSwarmArgs = this.ruvSwarmManager.getCommandArgs();\r\n\r\n    // Main config takes precedence, then ruv-swarm specific\r\n    const unified = [...mainArgs];\r\n\r\n    // Add ruv-swarm specific args that aren't in main config\r\n    for (let i = 0; i < ruvSwarmArgs.length; i += 2) {\r\n      const flag = ruvSwarmArgs[i];\r\n      const value = ruvSwarmArgs[i + 1];\r\n\r\n      // Skip if already set by main config\r\n      if (!unified.includes(flag)) {\r\n        unified.push(flag, value);\r\n      }\r\n    }\r\n\r\n    return unified;\r\n  }\r\n\r\n  /**\r\n   * Initialize ruv-swarm integration\r\n   */\r\n  async initialize(): Promise<{ success: boolean; message: string }> {\r\n    try {\r\n      // Check if ruv-swarm is enabled in main config\r\n      if (!this.configManager.isRuvSwarmEnabled()) {\r\n        return {\r\n          success: false,\r\n          message: 'ruv-swarm is disabled in main configuration',\r\n        };\r\n      }\r\n\r\n      // Sync configurations\r\n      this.syncConfiguration();\r\n\r\n      // Validate configurations\r\n      const mainValidation = this.validateMainConfig();\r\n      if (!mainValidation.valid) {\r\n        return {\r\n          success: false,\r\n          message: `Main config validation failed: ${mainValidation.errors.join(', ')}`,\r\n        };\r\n      }\r\n\r\n      const ruvSwarmValidation = this.ruvSwarmManager.validateConfig();\r\n      if (!ruvSwarmValidation.valid) {\r\n        return {\r\n          success: false,\r\n          message: `ruv-swarm config validation failed: ${ruvSwarmValidation.errors.join(', ')}`,\r\n        };\r\n      }\r\n\r\n      // logger.info('ruv-swarm integration initialized successfully');\r\n\r\n      return {\r\n        success: true,\r\n        message: 'ruv-swarm integration initialized and configured',\r\n      };\r\n    } catch (error) {\r\n      const message = `Failed to initialize ruv-swarm integration: ${(error as Error).message}`;\r\n      // logger.error(message, { error });\r\n\r\n      return {\r\n        success: false,\r\n        message,\r\n      };\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Validate main configuration for ruv-swarm compatibility\r\n   */\r\n  private validateMainConfig(): { valid: boolean; errors: string[] } {\r\n    const errors: string[] = [];\r\n    const ruvSwarmConfig = this.configManager.getRuvSwarmConfig();\r\n\r\n    // Check required fields\r\n    if (!ruvSwarmConfig.defaultTopology) {\r\n      errors.push('ruvSwarm.defaultTopology is required');\r\n    }\r\n\r\n    if (ruvSwarmConfig.maxAgents <= 0) {\r\n      errors.push('ruvSwarm.maxAgents must be greater than 0');\r\n    }\r\n\r\n    if (!ruvSwarmConfig.defaultStrategy) {\r\n      errors.push('ruvSwarm.defaultStrategy is required');\r\n    }\r\n\r\n    return {\r\n      valid: errors.length === 0,\r\n      errors,\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Get current integration status\r\n   */\r\n  getStatus(): {\r\n    enabled: boolean;\r\n    mainConfig: any;\r\n    ruvSwarmConfig: any;\r\n    synchronized: boolean;\r\n  } {\r\n    const mainConfig = this.configManager.getRuvSwarmConfig();\r\n    const ruvSwarmConfig = this.ruvSwarmManager.getConfig();\r\n\r\n    return {\r\n      enabled: mainConfig.enabled,\r\n      mainConfig,\r\n      ruvSwarmConfig,\r\n      synchronized: this.isConfigurationSynchronized(),\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Check if configurations are synchronized\r\n   */\r\n  private isConfigurationSynchronized(): boolean {\r\n    const mainConfig = this.configManager.getRuvSwarmConfig();\r\n    const ruvSwarmConfig = this.ruvSwarmManager.getConfig();\r\n\r\n    return (\r\n      ruvSwarmConfig.swarm.defaultTopology === mainConfig.defaultTopology &&\r\n      ruvSwarmConfig.swarm.maxAgents === mainConfig.maxAgents &&\r\n      ruvSwarmConfig.swarm.defaultStrategy === mainConfig.defaultStrategy &&\r\n      ruvSwarmConfig.swarm.enableHooks === mainConfig.enableHooks &&\r\n      ruvSwarmConfig.memory.enablePersistence === mainConfig.enablePersistence &&\r\n      ruvSwarmConfig.neural.enableTraining === mainConfig.enableNeuralTraining\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Update configuration and sync\r\n   */\r\n  updateConfiguration(updates: {\r\n    main?: Partial<Parameters<ConfigManager['setRuvSwarmConfig']>[0]>;\r\n    ruvSwarm?: Partial<Parameters<RuvSwarmConfigManager['updateConfig']>[0]>;\r\n  }): void {\r\n    if (updates.main) {\r\n      this.configManager.setRuvSwarmConfig(updates.main);\r\n    }\r\n\r\n    if (updates.ruvSwarm) {\r\n      this.ruvSwarmManager.updateConfig(updates.ruvSwarm);\r\n    }\r\n\r\n    // Re-sync after updates\r\n    this.syncConfiguration();\r\n  }\r\n}\r\n\r\n/**\r\n * Create singleton integration instance\r\n */\r\nlet integrationInstance: RuvSwarmIntegration | null = null;\r\n\r\nexport function getRuvSwarmIntegration(): RuvSwarmIntegration {\r\n  if (!integrationInstance) {\r\n    const ruvSwarmManager = getRuvSwarmConfigManager(logger);\r\n    integrationInstance = new RuvSwarmIntegration(configManager, ruvSwarmManager);\r\n  }\r\n  return integrationInstance;\r\n}\r\n\r\n/**\r\n * Initialize ruv-swarm integration with claude-flow\r\n */\r\nexport async function initializeRuvSwarmIntegration(): Promise<{\r\n  success: boolean;\r\n  message: string;\r\n}> {\r\n  const integration = getRuvSwarmIntegration();\r\n  return integration.initialize();\r\n}\r\n\r\n/**\r\n * Helper functions for CLI commands\r\n */\r\nexport class RuvSwarmConfigHelpers {\r\n  /**\r\n   * Quick setup for development environment\r\n   */\r\n  static setupDevelopmentConfig(): void {\r\n    const integration = getRuvSwarmIntegration();\r\n\r\n    integration.updateConfiguration({\r\n      main: {\r\n        enabled: true,\r\n        defaultTopology: 'hierarchical',\r\n        maxAgents: 8,\r\n        defaultStrategy: 'specialized',\r\n        autoInit: true,\r\n        enableHooks: true,\r\n        enablePersistence: true,\r\n        enableNeuralTraining: true,\r\n      },\r\n    });\r\n\r\n    // logger.info('Development configuration applied');\r\n  }\r\n\r\n  /**\r\n   * Quick setup for research environment\r\n   */\r\n  static setupResearchConfig(): void {\r\n    const integration = getRuvSwarmIntegration();\r\n\r\n    integration.updateConfiguration({\r\n      main: {\r\n        enabled: true,\r\n        defaultTopology: 'mesh',\r\n        maxAgents: 12,\r\n        defaultStrategy: 'adaptive',\r\n        autoInit: true,\r\n        enableHooks: true,\r\n        enablePersistence: true,\r\n        enableNeuralTraining: true,\r\n      },\r\n    });\r\n\r\n    // logger.info('Research configuration applied');\r\n  }\r\n\r\n  /**\r\n   * Quick setup for production environment\r\n   */\r\n  static setupProductionConfig(): void {\r\n    const integration = getRuvSwarmIntegration();\r\n\r\n    integration.updateConfiguration({\r\n      main: {\r\n        enabled: true,\r\n        defaultTopology: 'star',\r\n        maxAgents: 6,\r\n        defaultStrategy: 'balanced',\r\n        autoInit: false,\r\n        enableHooks: true,\r\n        enablePersistence: true,\r\n        enableNeuralTraining: false,\r\n      },\r\n    });\r\n\r\n    // logger.info('Production configuration applied');\r\n  }\r\n\r\n  /**\r\n   * Get configuration for specific use case\r\n   */\r\n  static getConfigForUseCase(useCase: 'development' | 'research' | 'production'): any {\r\n    const integration = getRuvSwarmIntegration();\r\n\r\n    switch (useCase) {\r\n      case 'development':\r\n        return {\r\n          topology: 'hierarchical',\r\n          maxAgents: 8,\r\n          strategy: 'specialized',\r\n          features: ['hooks', 'persistence', 'neural-training'],\r\n        };\r\n\r\n      case 'research':\r\n        return {\r\n          topology: 'mesh',\r\n          maxAgents: 12,\r\n          strategy: 'adaptive',\r\n          features: ['hooks', 'persistence', 'neural-training', 'advanced-metrics'],\r\n        };\r\n\r\n      case 'production':\r\n        return {\r\n          topology: 'star',\r\n          maxAgents: 6,\r\n          strategy: 'balanced',\r\n          features: ['hooks', 'persistence'],\r\n        };\r\n\r\n      default:\r\n        return integration.getStatus().mainConfig;\r\n    }\r\n  }\r\n}\r\n\r\nexport default {\r\n  RuvSwarmIntegration,\r\n  getRuvSwarmIntegration,\r\n  initializeRuvSwarmIntegration,\r\n  RuvSwarmConfigHelpers,\r\n};\r\n"],"names":["configManager","getRuvSwarmConfigManager","RuvSwarmIntegration","ruvSwarmManager","syncConfiguration","mainConfig","getRuvSwarmConfig","ruvSwarmConfig","getConfig","enabled","updateSwarmConfig","defaultTopology","maxAgents","defaultStrategy","enableHooks","updateIntegrationConfig","enableMCPTools","enableCLICommands","updateMemoryConfig","enablePersistence","updateNeuralConfig","enableTraining","enableNeuralTraining","getUnifiedCommandArgs","mainArgs","getRuvSwarmArgs","ruvSwarmArgs","getCommandArgs","unified","i","length","flag","value","includes","push","initialize","isRuvSwarmEnabled","success","message","mainValidation","validateMainConfig","valid","errors","join","ruvSwarmValidation","validateConfig","error","getStatus","synchronized","isConfigurationSynchronized","swarm","memory","neural","updateConfiguration","updates","main","setRuvSwarmConfig","ruvSwarm","updateConfig","integrationInstance","getRuvSwarmIntegration","logger","initializeRuvSwarmIntegration","integration","RuvSwarmConfigHelpers","setupDevelopmentConfig","autoInit","setupResearchConfig","setupProductionConfig","getConfigForUseCase","useCase","topology","strategy","features"],"mappings":"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"}