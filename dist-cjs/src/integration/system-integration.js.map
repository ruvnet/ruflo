{"version":3,"sources":["../../../src/integration/system-integration.ts"],"sourcesContent":["/**\r\n * Claude Flow v2.0.0 System Integration\r\n * Comprehensive integration manager for all system components\r\n */\r\n\r\nimport { EventBus } from '../core/event-bus.js';\r\nimport { Logger } from '../core/logger.js';\r\nimport type { ConfigManager } from '../config/config-manager.js';\r\nimport { MemoryManager } from '../memory/manager.js';\r\nimport type { MemoryConfig } from '../utils/types.js';\r\nimport { AgentManager } from '../agents/agent-manager.js';\r\nimport { TaskEngine } from '../task/engine.js';\r\nimport { RealTimeMonitor } from '../monitoring/real-time-monitor.js';\r\nimport { McpServer } from '../mcp/server.js';\r\nimport { getErrorMessage } from '../utils/error-handler.js';\r\nimport type { IntegrationConfig, SystemHealth, ComponentStatus } from './types.js';\r\n\r\nexport class SystemIntegration {\r\n  private static instance: SystemIntegration;\r\n  private eventBus: EventBus;\r\n  private logger: Logger;\r\n  private orchestrator: any | null = null;\r\n  private configManager: any | null = null;\r\n  private memoryManager: any | null = null;\r\n  private agentManager: any | null = null;\r\n  private swarmCoordinator: any | null = null;\r\n  private taskEngine: any | null = null;\r\n  private monitor: any | null = null;\r\n  private mcpServer: any | null = null;\r\n  private initialized = false;\r\n  private componentStatuses: Map<string, ComponentStatus> = new Map();\r\n\r\n  private constructor() {\r\n    this.eventBus = EventBus.getInstance();\r\n    this.logger = new Logger({ level: 'info', format: 'text', destination: 'console' });\r\n\r\n    // Initialize configManager safely\r\n    try {\r\n      // Dynamic import for ConfigManager if available\r\n      this.configManager = {\r\n        getInstance: () => ({ load: async () => {}, get: () => null, set: () => {} }),\r\n      };\r\n    } catch (error) {\r\n      this.logger.warn('ConfigManager not available, using mock');\r\n      this.configManager = { load: async () => {}, get: () => null, set: () => {} };\r\n    }\r\n\r\n    this.setupEventHandlers();\r\n  }\r\n\r\n  static getInstance(): SystemIntegration {\r\n    if (!SystemIntegration.instance) {\r\n      SystemIntegration.instance = new SystemIntegration();\r\n    }\r\n    return SystemIntegration.instance;\r\n  }\r\n\r\n  /**\r\n   * Initialize all system components in proper order\r\n   */\r\n  async initialize(config?: IntegrationConfig): Promise<void> {\r\n    if (this.initialized) {\r\n      this.logger.warn('System already initialized');\r\n      return;\r\n    }\r\n\r\n    this.logger.info('üöÄ Starting Claude Flow v2.0.0 System Integration');\r\n\r\n    try {\r\n      // Phase 1: Core Infrastructure\r\n      await this.initializeCore(config);\r\n\r\n      // Phase 2: Memory and Configuration\r\n      await this.initializeMemoryAndConfig();\r\n\r\n      // Phase 3: Agents and Coordination\r\n      await this.initializeAgentsAndCoordination();\r\n\r\n      // Phase 4: Task Management\r\n      await this.initializeTaskManagement();\r\n\r\n      // Phase 5: Monitoring and MCP\r\n      await this.initializeMonitoringAndMcp();\r\n\r\n      // Phase 6: Cross-component wiring\r\n      await this.wireComponents();\r\n\r\n      this.initialized = true;\r\n      this.logger.info('‚úÖ Claude Flow v2.0.0 System Integration Complete');\r\n\r\n      // Emit system ready event\r\n      this.eventBus.emit('system:ready', {\r\n        timestamp: Date.now(),\r\n        components: Array.from(this.componentStatuses.keys()),\r\n        health: await this.getSystemHealth(),\r\n      });\r\n    } catch (error) {\r\n      this.logger.error('‚ùå System Integration Failed:', getErrorMessage(error));\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Initialize core infrastructure components\r\n   */\r\n  private async initializeCore(config?: IntegrationConfig): Promise<void> {\r\n    this.logger.info('üîß Phase 1: Initializing Core Infrastructure');\r\n\r\n    try {\r\n      // Initialize configuration\r\n      if (this.configManager && typeof this.configManager.load === 'function') {\r\n        await this.configManager.load();\r\n        this.updateComponentStatus('config', 'healthy', 'Configuration loaded');\r\n      } else {\r\n        this.updateComponentStatus('config', 'warning', 'Configuration manager not available');\r\n      }\r\n\r\n      // Try to initialize orchestrator if available\r\n      try {\r\n        const { Orchestrator } = await import('../core/orchestrator-fixed.js');\r\n        this.orchestrator = new Orchestrator(this.configManager, this.eventBus, this.logger);\r\n        if (typeof this.orchestrator.initialize === 'function') {\r\n          await this.orchestrator.initialize();\r\n        }\r\n        this.updateComponentStatus('orchestrator', 'healthy', 'Orchestrator initialized');\r\n      } catch (error) {\r\n        this.logger.warn('Orchestrator not available:', getErrorMessage(error));\r\n        this.updateComponentStatus('orchestrator', 'warning', 'Orchestrator not available');\r\n      }\r\n\r\n      this.logger.info('‚úÖ Core Infrastructure Ready');\r\n    } catch (error) {\r\n      this.logger.error('Core initialization failed:', getErrorMessage(error));\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Initialize memory and configuration management\r\n   */\r\n  private async initializeMemoryAndConfig(): Promise<void> {\r\n    this.logger.info('üß† Phase 2: Initializing Memory and Configuration');\r\n\r\n    try {\r\n      // Initialize memory manager\r\n      try {\r\n        const { MemoryManager } = await import('../memory/manager.js');\r\n\r\n        // Create default memory configuration\r\n        const memoryConfig: MemoryConfig = {\r\n          backend: 'sqlite',\r\n          cacheSizeMB: 50,\r\n          syncInterval: 30000, // 30 seconds\r\n          conflictResolution: 'last-write',\r\n          retentionDays: 30,\r\n          sqlitePath: './.swarm/memory.db',\r\n        };\r\n\r\n        // Initialize MemoryManager with required parameters\r\n        this.memoryManager = new MemoryManager(memoryConfig, this.eventBus, this.logger);\r\n\r\n        if (typeof this.memoryManager.initialize === 'function') {\r\n          await this.memoryManager.initialize();\r\n        }\r\n        this.updateComponentStatus(\r\n          'memory',\r\n          'healthy',\r\n          'Memory manager initialized with SQLite backend',\r\n        );\r\n        this.logger.info('Memory manager initialized successfully', {\r\n          backend: memoryConfig.backend,\r\n          cacheSizeMB: memoryConfig.cacheSizeMB,\r\n          sqlitePath: memoryConfig.sqlitePath,\r\n        });\r\n      } catch (error) {\r\n        this.logger.warn('Memory manager initialization failed:', getErrorMessage(error));\r\n        this.updateComponentStatus('memory', 'warning', 'Memory manager not available');\r\n      }\r\n\r\n      this.logger.info('‚úÖ Memory and Configuration Ready');\r\n    } catch (error) {\r\n      this.logger.error('Memory initialization failed:', getErrorMessage(error));\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Initialize agents and coordination systems\r\n   */\r\n  private async initializeAgentsAndCoordination(): Promise<void> {\r\n    this.logger.info('ü§ñ Phase 3: Initializing Agents and Coordination');\r\n\r\n    try {\r\n      // Initialize agent manager\r\n      try {\r\n        const { AgentManager } = await import('../agents/agent-manager.js');\r\n        this.agentManager = new AgentManager(this.eventBus, this.logger);\r\n        if (typeof this.agentManager.initialize === 'function') {\r\n          await this.agentManager.initialize();\r\n        }\r\n        this.updateComponentStatus('agents', 'healthy', 'Agent manager initialized');\r\n      } catch (error) {\r\n        this.logger.warn('Agent manager not available, using mock:', getErrorMessage(error));\r\n        const { MockAgentManager } = await import('./mock-components.js');\r\n        this.agentManager = new MockAgentManager(this.eventBus, this.logger);\r\n        await this.agentManager.initialize();\r\n        this.updateComponentStatus('agents', 'warning', 'Using mock agent manager');\r\n      }\r\n\r\n      // Initialize swarm coordinator\r\n      try {\r\n        const { SwarmCoordinator } = await import('../coordination/swarm-coordinator.js');\r\n        this.swarmCoordinator = new SwarmCoordinator(\r\n          this.eventBus,\r\n          this.logger,\r\n          this.memoryManager!,\r\n        );\r\n        if (typeof this.swarmCoordinator.initialize === 'function') {\r\n          await this.swarmCoordinator.initialize();\r\n        }\r\n        this.updateComponentStatus('swarm', 'healthy', 'Swarm coordinator initialized');\r\n      } catch (error) {\r\n        this.logger.warn('Swarm coordinator not available, using mock:', getErrorMessage(error));\r\n        const { MockSwarmCoordinator } = await import('./mock-components.js');\r\n        this.swarmCoordinator = new MockSwarmCoordinator(\r\n          this.eventBus,\r\n          this.logger,\r\n          this.memoryManager!,\r\n        );\r\n        await this.swarmCoordinator.initialize();\r\n        this.updateComponentStatus('swarm', 'warning', 'Using mock swarm coordinator');\r\n      }\r\n\r\n      this.logger.info('‚úÖ Agents and Coordination Ready');\r\n    } catch (error) {\r\n      this.logger.error('Agents and coordination initialization failed:', getErrorMessage(error));\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Initialize task management system\r\n   */\r\n  private async initializeTaskManagement(): Promise<void> {\r\n    this.logger.info('üìã Phase 4: Initializing Task Management');\r\n\r\n    try {\r\n      // Initialize task engine\r\n      try {\r\n        const { TaskEngine } = await import('../task/engine.js');\r\n        this.taskEngine = new TaskEngine(this.eventBus, this.logger, this.memoryManager!);\r\n        if (typeof this.taskEngine.initialize === 'function') {\r\n          await this.taskEngine.initialize();\r\n        }\r\n        this.updateComponentStatus('tasks', 'healthy', 'Task engine initialized');\r\n      } catch (error) {\r\n        this.logger.warn('Task engine not available, using mock:', getErrorMessage(error));\r\n        const { MockTaskEngine } = await import('./mock-components.js');\r\n        this.taskEngine = new MockTaskEngine(this.eventBus, this.logger, this.memoryManager!);\r\n        await this.taskEngine.initialize();\r\n        this.updateComponentStatus('tasks', 'warning', 'Using mock task engine');\r\n      }\r\n\r\n      this.logger.info('‚úÖ Task Management Ready');\r\n    } catch (error) {\r\n      this.logger.error('Task management initialization failed:', getErrorMessage(error));\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Initialize monitoring and MCP systems\r\n   */\r\n  private async initializeMonitoringAndMcp(): Promise<void> {\r\n    this.logger.info('üìä Phase 5: Initializing Monitoring and MCP');\r\n\r\n    try {\r\n      // Initialize real-time monitor\r\n      try {\r\n        const { RealTimeMonitor } = await import('../monitoring/real-time-monitor.js');\r\n        this.monitor = new RealTimeMonitor(this.eventBus, this.logger);\r\n        if (typeof this.monitor.initialize === 'function') {\r\n          await this.monitor.initialize();\r\n        }\r\n        this.updateComponentStatus('monitor', 'healthy', 'Real-time monitor initialized');\r\n      } catch (error) {\r\n        this.logger.warn('Real-time monitor not available, using mock:', getErrorMessage(error));\r\n        const { MockRealTimeMonitor } = await import('./mock-components.js');\r\n        this.monitor = new MockRealTimeMonitor(this.eventBus, this.logger);\r\n        await this.monitor.initialize();\r\n        this.updateComponentStatus('monitor', 'warning', 'Using mock monitor');\r\n      }\r\n\r\n      // Initialize MCP server\r\n      try {\r\n        const { McpServer } = await import('../mcp/server.js');\r\n        this.mcpServer = new McpServer(this.eventBus, this.logger);\r\n        if (typeof this.mcpServer.initialize === 'function') {\r\n          await this.mcpServer.initialize();\r\n        }\r\n        this.updateComponentStatus('mcp', 'healthy', 'MCP server initialized');\r\n      } catch (error) {\r\n        this.logger.warn('MCP server not available, using mock:', getErrorMessage(error));\r\n        const { MockMcpServer } = await import('./mock-components.js');\r\n        this.mcpServer = new MockMcpServer(this.eventBus, this.logger);\r\n        await this.mcpServer.initialize();\r\n        this.updateComponentStatus('mcp', 'warning', 'Using mock MCP server');\r\n      }\r\n\r\n      this.logger.info('‚úÖ Monitoring and MCP Ready');\r\n    } catch (error) {\r\n      this.logger.error('Monitoring and MCP initialization failed:', getErrorMessage(error));\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Wire all components together for proper communication\r\n   */\r\n  private async wireComponents(): Promise<void> {\r\n    this.logger.info('üîó Phase 6: Wiring Components');\r\n\r\n    // Wire orchestrator to agents\r\n    if (this.orchestrator && this.agentManager) {\r\n      this.orchestrator.setAgentManager(this.agentManager);\r\n      this.agentManager.setOrchestrator(this.orchestrator);\r\n    }\r\n\r\n    // Wire swarm coordinator to agents and tasks\r\n    if (this.swarmCoordinator && this.agentManager && this.taskEngine) {\r\n      this.swarmCoordinator.setAgentManager(this.agentManager);\r\n      this.swarmCoordinator.setTaskEngine(this.taskEngine);\r\n      this.taskEngine.setSwarmCoordinator(this.swarmCoordinator);\r\n    }\r\n\r\n    // Wire monitor to all components\r\n    if (this.monitor) {\r\n      this.monitor.attachToOrchestrator(this.orchestrator!);\r\n      this.monitor.attachToAgentManager(this.agentManager!);\r\n      this.monitor.attachToSwarmCoordinator(this.swarmCoordinator!);\r\n      this.monitor.attachToTaskEngine(this.taskEngine!);\r\n    }\r\n\r\n    // Wire MCP server to core components\r\n    if (this.mcpServer) {\r\n      this.mcpServer.attachToOrchestrator(this.orchestrator!);\r\n      this.mcpServer.attachToAgentManager(this.agentManager!);\r\n      this.mcpServer.attachToSwarmCoordinator(this.swarmCoordinator!);\r\n      this.mcpServer.attachToTaskEngine(this.taskEngine!);\r\n      this.mcpServer.attachToMemoryManager(this.memoryManager!);\r\n    }\r\n\r\n    this.logger.info('‚úÖ Component Wiring Complete');\r\n  }\r\n\r\n  /**\r\n   * Setup event handlers for cross-component communication\r\n   */\r\n  private setupEventHandlers(): void {\r\n    // System health monitoring\r\n    this.eventBus.on('component:status', (event) => {\r\n      this.updateComponentStatus(event.component, event.status, event.message);\r\n    });\r\n\r\n    // Error handling\r\n    this.eventBus.on('system:error', (event) => {\r\n      this.logger.error(`System Error in ${event.component}:`, event.error);\r\n      this.updateComponentStatus(event.component, 'unhealthy', event.error.message);\r\n    });\r\n\r\n    // Performance monitoring\r\n    this.eventBus.on('performance:metric', (event) => {\r\n      this.logger.debug(`Performance Metric: ${event.metric} = ${event.value}`);\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Update component status\r\n   */\r\n  private updateComponentStatus(\r\n    component: string,\r\n    status: 'healthy' | 'unhealthy' | 'warning',\r\n    message?: string,\r\n  ): void {\r\n    const statusInfo: ComponentStatus = {\r\n      component,\r\n      status,\r\n      message: message || '',\r\n      timestamp: Date.now(),\r\n      lastHealthCheck: Date.now(),\r\n    };\r\n\r\n    this.componentStatuses.set(component, statusInfo);\r\n\r\n    // Emit status update\r\n    this.eventBus.emit('component:status:updated', statusInfo);\r\n  }\r\n\r\n  /**\r\n   * Get system health status\r\n   */\r\n  async getSystemHealth(): Promise<SystemHealth> {\r\n    const components = Array.from(this.componentStatuses.values());\r\n    const healthyComponents = components.filter((c) => c.status === 'healthy').length;\r\n    const unhealthyComponents = components.filter((c) => c.status === 'unhealthy').length;\r\n    const warningComponents = components.filter((c) => c.status === 'warning').length;\r\n\r\n    let overallStatus: 'healthy' | 'unhealthy' | 'warning' = 'healthy';\r\n    if (unhealthyComponents > 0) {\r\n      overallStatus = 'unhealthy';\r\n    } else if (warningComponents > 0) {\r\n      overallStatus = 'warning';\r\n    }\r\n\r\n    return {\r\n      overall: overallStatus,\r\n      components: Object.fromEntries(this.componentStatuses),\r\n      metrics: {\r\n        totalComponents: components.length,\r\n        healthyComponents,\r\n        unhealthyComponents,\r\n        warningComponents,\r\n        uptime: Date.now() - (this.initialized ? Date.now() : 0),\r\n      },\r\n      timestamp: Date.now(),\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Get specific component\r\n   */\r\n  getComponent<T>(name: string): T | null {\r\n    switch (name) {\r\n      case 'orchestrator':\r\n        return this.orchestrator as T;\r\n      case 'configManager':\r\n        return this.configManager as T;\r\n      case 'memoryManager':\r\n        return this.memoryManager as T;\r\n      case 'agentManager':\r\n        return this.agentManager as T;\r\n      case 'swarmCoordinator':\r\n        return this.swarmCoordinator as T;\r\n      case 'taskEngine':\r\n        return this.taskEngine as T;\r\n      case 'monitor':\r\n        return this.monitor as T;\r\n      case 'mcpServer':\r\n        return this.mcpServer as T;\r\n      case 'eventBus':\r\n        return this.eventBus as T;\r\n      case 'logger':\r\n        return this.logger as T;\r\n      default:\r\n        return null;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Shutdown all components gracefully\r\n   */\r\n  async shutdown(): Promise<void> {\r\n    this.logger.info('üõë Shutting down Claude Flow v2.0.0');\r\n\r\n    // Shutdown in reverse order\r\n    if (this.mcpServer) {\r\n      await this.mcpServer.shutdown();\r\n    }\r\n\r\n    if (this.monitor) {\r\n      await this.monitor.shutdown();\r\n    }\r\n\r\n    if (this.taskEngine) {\r\n      await this.taskEngine.shutdown();\r\n    }\r\n\r\n    if (this.swarmCoordinator) {\r\n      await this.swarmCoordinator.shutdown();\r\n    }\r\n\r\n    if (this.agentManager) {\r\n      await this.agentManager.shutdown();\r\n    }\r\n\r\n    if (this.memoryManager) {\r\n      await this.memoryManager.shutdown();\r\n    }\r\n\r\n    if (this.orchestrator) {\r\n      await this.orchestrator.shutdown();\r\n    }\r\n\r\n    this.initialized = false;\r\n    this.logger.info('‚úÖ Claude Flow v2.0.0 Shutdown Complete');\r\n  }\r\n\r\n  /**\r\n   * Check if system is ready\r\n   */\r\n  isReady(): boolean {\r\n    return this.initialized;\r\n  }\r\n\r\n  /**\r\n   * Get initialization status\r\n   */\r\n  getInitializationStatus(): {\r\n    initialized: boolean;\r\n    components: string[];\r\n    health: SystemHealth | null;\r\n  } {\r\n    return {\r\n      initialized: this.initialized,\r\n      components: Array.from(this.componentStatuses.keys()),\r\n      health: this.initialized ? null : null, // Will be populated after initialization\r\n    };\r\n  }\r\n}\r\n\r\n// Export singleton instance\r\nexport const systemIntegration = SystemIntegration.getInstance();\r\n"],"names":["EventBus","Logger","getErrorMessage","SystemIntegration","instance","eventBus","logger","orchestrator","configManager","memoryManager","agentManager","swarmCoordinator","taskEngine","monitor","mcpServer","initialized","componentStatuses","Map","getInstance","level","format","destination","load","get","set","error","warn","setupEventHandlers","initialize","config","info","initializeCore","initializeMemoryAndConfig","initializeAgentsAndCoordination","initializeTaskManagement","initializeMonitoringAndMcp","wireComponents","emit","timestamp","Date","now","components","Array","from","keys","health","getSystemHealth","updateComponentStatus","Orchestrator","MemoryManager","memoryConfig","backend","cacheSizeMB","syncInterval","conflictResolution","retentionDays","sqlitePath","AgentManager","MockAgentManager","SwarmCoordinator","MockSwarmCoordinator","TaskEngine","MockTaskEngine","RealTimeMonitor","MockRealTimeMonitor","McpServer","MockMcpServer","setAgentManager","setOrchestrator","setTaskEngine","setSwarmCoordinator","attachToOrchestrator","attachToAgentManager","attachToSwarmCoordinator","attachToTaskEngine","attachToMemoryManager","on","event","component","status","message","debug","metric","value","statusInfo","lastHealthCheck","values","healthyComponents","filter","c","length","unhealthyComponents","warningComponents","overallStatus","overall","Object","fromEntries","metrics","totalComponents","uptime","getComponent","name","shutdown","isReady","getInitializationStatus","systemIntegration"],"mappings":"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"}