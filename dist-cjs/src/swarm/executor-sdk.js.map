{"version":3,"sources":["../../../src/swarm/executor-sdk.ts"],"sourcesContent":["/**\r\n * Task Executor SDK Implementation\r\n * Claude-Flow v2.5-alpha.130\r\n *\r\n * Replaces custom retry logic with SDK-based execution\r\n */\r\n\r\nimport { spawn, ChildProcess } from 'node:child_process';\r\nimport { EventEmitter } from 'node:events';\r\nimport * as fs from 'node:fs/promises';\r\nimport * as path from 'node:path';\r\nimport chalk from 'chalk';\r\nimport { Logger } from '../core/logger.js';\r\nimport { generateId } from '../utils/helpers.js';\r\nimport { ClaudeFlowSDKAdapter } from '../sdk/sdk-config.js';\r\nimport { ClaudeClientV25 } from '../api/claude-client-v2.5.js';\r\nimport {\r\n  TaskDefinition,\r\n  AgentState,\r\n  TaskResult,\r\n  SwarmEvent,\r\n  EventType,\r\n  SWARM_CONSTANTS,\r\n} from './types.js';\r\n\r\nexport interface ExecutionConfig {\r\n  apiKey?: string;\r\n  maxRetries?: number;\r\n  timeout?: number;\r\n  swarmMode?: boolean;\r\n  checkpointInterval?: number;\r\n}\r\n\r\nexport interface ExecutionResult {\r\n  success: boolean;\r\n  output: any;\r\n  errors: string[];\r\n  executionTime: number;\r\n  tokensUsed: number;\r\n  retryCount?: number;\r\n  checkpointId?: string;\r\n}\r\n\r\n/**\r\n * Task Executor using SDK for retry and error handling\r\n */\r\nexport class TaskExecutorSDK extends EventEmitter {\r\n  private logger: Logger;\r\n  private claudeClient: ClaudeClientV25;\r\n  private sdkAdapter: ClaudeFlowSDKAdapter;\r\n  private config: ExecutionConfig;\r\n  private executionStats: Map<string, any> = new Map();\r\n\r\n  constructor(config: ExecutionConfig = {}) {\r\n    super();\r\n    this.config = {\r\n      apiKey: config.apiKey || process.env.ANTHROPIC_API_KEY,\r\n      maxRetries: config.maxRetries || 3,\r\n      timeout: config.timeout || 60000,\r\n      swarmMode: config.swarmMode !== false,\r\n      checkpointInterval: config.checkpointInterval || 30000\r\n    };\r\n\r\n    this.logger = new Logger('TaskExecutorSDK');\r\n\r\n    // Initialize SDK adapter\r\n    this.sdkAdapter = new ClaudeFlowSDKAdapter({\r\n      apiKey: this.config.apiKey,\r\n      maxRetries: this.config.maxRetries,\r\n      timeout: this.config.timeout,\r\n      swarmMode: this.config.swarmMode,\r\n      checkpointInterval: this.config.checkpointInterval\r\n    });\r\n\r\n    // Initialize Claude client with SDK\r\n    this.claudeClient = new ClaudeClientV25({\r\n      apiKey: this.config.apiKey!,\r\n      retryAttempts: this.config.maxRetries,\r\n      timeout: this.config.timeout,\r\n      enableSwarmMode: this.config.swarmMode\r\n    }, this.logger);\r\n\r\n    this.logger.info('Task Executor SDK initialized', {\r\n      swarmMode: this.config.swarmMode,\r\n      maxRetries: this.config.maxRetries\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Execute task with SDK-based retry handling\r\n   */\r\n  async executeTask(\r\n    task: TaskDefinition,\r\n    agent: AgentState\r\n  ): Promise<ExecutionResult> {\r\n    const executionId = generateId('exec');\r\n    const startTime = Date.now();\r\n\r\n    this.logger.info(`Executing task ${task.id} with agent ${agent.id}`, {\r\n      taskType: task.type,\r\n      agentType: agent.type\r\n    });\r\n\r\n    try {\r\n      // Emit start event\r\n      this.emit('task:start', {\r\n        executionId,\r\n        taskId: task.id,\r\n        agentId: agent.id\r\n      });\r\n\r\n      // Build the prompt for Claude\r\n      const prompt = this.buildPrompt(task, agent);\r\n\r\n      // Make request using SDK (retry is automatic)\r\n      const response = await this.claudeClient.makeRequest({\r\n        model: 'claude-3-sonnet-20240229',\r\n        messages: [\r\n          {\r\n            role: 'user',\r\n            content: prompt\r\n          }\r\n        ],\r\n        system: this.getSystemPrompt(agent),\r\n        max_tokens: 4000,\r\n        temperature: 0.7\r\n      });\r\n\r\n      // Extract and process the response\r\n      const output = this.processResponse(response);\r\n\r\n      // Calculate execution metrics\r\n      const executionTime = Date.now() - startTime;\r\n      const tokensUsed = response.usage.input_tokens + response.usage.output_tokens;\r\n\r\n      // Store execution stats\r\n      this.executionStats.set(executionId, {\r\n        taskId: task.id,\r\n        agentId: agent.id,\r\n        executionTime,\r\n        tokensUsed,\r\n        timestamp: Date.now()\r\n      });\r\n\r\n      // Emit success event\r\n      this.emit('task:complete', {\r\n        executionId,\r\n        taskId: task.id,\r\n        agentId: agent.id,\r\n        result: output\r\n      });\r\n\r\n      return {\r\n        success: true,\r\n        output,\r\n        errors: [],\r\n        executionTime,\r\n        tokensUsed,\r\n        retryCount: 0 // SDK handles retry internally\r\n      };\r\n\r\n    } catch (error) {\r\n      const executionTime = Date.now() - startTime;\r\n\r\n      this.logger.error(`Task execution failed for ${task.id}`, {\r\n        error: error instanceof Error ? error.message : 'Unknown error',\r\n        taskId: task.id,\r\n        agentId: agent.id\r\n      });\r\n\r\n      // Emit failure event\r\n      this.emit('task:error', {\r\n        executionId,\r\n        taskId: task.id,\r\n        agentId: agent.id,\r\n        error\r\n      });\r\n\r\n      return {\r\n        success: false,\r\n        output: null,\r\n        errors: [error instanceof Error ? error.message : 'Unknown error'],\r\n        executionTime,\r\n        tokensUsed: 0\r\n      };\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Execute task with streaming response\r\n   */\r\n  async executeStreamingTask(\r\n    task: TaskDefinition,\r\n    agent: AgentState,\r\n    onChunk?: (chunk: string) => void\r\n  ): Promise<ExecutionResult> {\r\n    const executionId = generateId('stream-exec');\r\n    const startTime = Date.now();\r\n\r\n    this.logger.info(`Executing streaming task ${task.id}`, {\r\n      taskType: task.type,\r\n      agentId: agent.id\r\n    });\r\n\r\n    try {\r\n      const prompt = this.buildPrompt(task, agent);\r\n      let fullOutput = '';\r\n\r\n      // Make streaming request\r\n      const response = await this.claudeClient.makeStreamingRequest(\r\n        {\r\n          model: 'claude-3-sonnet-20240229',\r\n          messages: [{ role: 'user', content: prompt }],\r\n          system: this.getSystemPrompt(agent),\r\n          max_tokens: 4000,\r\n          temperature: 0.7,\r\n          stream: true\r\n        },\r\n        (chunk) => {\r\n          if (chunk.type === 'content_block_delta' && chunk.delta?.text) {\r\n            fullOutput += chunk.delta.text;\r\n            onChunk?.(chunk.delta.text);\r\n          }\r\n        }\r\n      );\r\n\r\n      const executionTime = Date.now() - startTime;\r\n      const tokensUsed = response.usage.input_tokens + response.usage.output_tokens;\r\n\r\n      return {\r\n        success: true,\r\n        output: fullOutput,\r\n        errors: [],\r\n        executionTime,\r\n        tokensUsed\r\n      };\r\n\r\n    } catch (error) {\r\n      const executionTime = Date.now() - startTime;\r\n      return {\r\n        success: false,\r\n        output: null,\r\n        errors: [error instanceof Error ? error.message : 'Unknown error'],\r\n        executionTime,\r\n        tokensUsed: 0\r\n      };\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Execute Claude CLI task (backward compatibility)\r\n   */\r\n  async executeClaudeTask(\r\n    task: TaskDefinition,\r\n    agent: AgentState,\r\n    options?: { interactive?: boolean }\r\n  ): Promise<ExecutionResult> {\r\n    // For Claude CLI tasks, we still need to spawn a process\r\n    // But we can use the SDK for the API calls\r\n    if (options?.interactive) {\r\n      return this.executeInteractiveCLI(task, agent);\r\n    }\r\n\r\n    // For non-interactive, use SDK-based execution\r\n    return this.executeTask(task, agent);\r\n  }\r\n\r\n  /**\r\n   * Execute interactive CLI (legacy support)\r\n   */\r\n  private async executeInteractiveCLI(\r\n    task: TaskDefinition,\r\n    agent: AgentState\r\n  ): Promise<ExecutionResult> {\r\n    const startTime = Date.now();\r\n\r\n    return new Promise((resolve) => {\r\n      const args = ['--no-visual', task.description];\r\n      const claudeProcess = spawn('claude', args, {\r\n        stdio: 'pipe',\r\n        env: { ...process.env }\r\n      });\r\n\r\n      let output = '';\r\n      let errorOutput = '';\r\n\r\n      claudeProcess.stdout?.on('data', (data) => {\r\n        output += data.toString();\r\n      });\r\n\r\n      claudeProcess.stderr?.on('data', (data) => {\r\n        errorOutput += data.toString();\r\n      });\r\n\r\n      claudeProcess.on('close', (code) => {\r\n        const executionTime = Date.now() - startTime;\r\n        resolve({\r\n          success: code === 0,\r\n          output: output || errorOutput,\r\n          errors: code !== 0 ? [errorOutput] : [],\r\n          executionTime,\r\n          tokensUsed: 0\r\n        });\r\n      });\r\n\r\n      claudeProcess.on('error', (error) => {\r\n        const executionTime = Date.now() - startTime;\r\n        resolve({\r\n          success: false,\r\n          output: null,\r\n          errors: [error.message],\r\n          executionTime,\r\n          tokensUsed: 0\r\n        });\r\n      });\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Build prompt for task execution\r\n   */\r\n  private buildPrompt(task: TaskDefinition, agent: AgentState): string {\r\n    const agentContext = `\r\nYou are an AI agent with the following capabilities:\r\n- Type: ${agent.type}\r\n- Capabilities: ${agent.capabilities.join(', ')}\r\n- Status: ${agent.status}\r\n`;\r\n\r\n    const taskContext = `\r\nTask: ${task.description}\r\nType: ${task.type}\r\nPriority: ${task.priority || 'medium'}\r\n${task.dependencies?.length ? `Dependencies: ${task.dependencies.join(', ')}` : ''}\r\n`;\r\n\r\n    return `${agentContext}\\n\\n${taskContext}\\n\\nPlease complete this task and provide a detailed response.`;\r\n  }\r\n\r\n  /**\r\n   * Get system prompt for agent\r\n   */\r\n  private getSystemPrompt(agent: AgentState): string {\r\n    const prompts: Record<string, string> = {\r\n      'researcher': 'You are a research specialist. Analyze information thoroughly and provide comprehensive insights.',\r\n      'coder': 'You are a coding expert. Write clean, efficient, and well-documented code.',\r\n      'analyst': 'You are a data analyst. Analyze patterns, metrics, and provide actionable insights.',\r\n      'optimizer': 'You are an optimization specialist. Identify inefficiencies and suggest improvements.',\r\n      'coordinator': 'You are a coordination expert. Organize tasks, manage dependencies, and ensure smooth execution.'\r\n    };\r\n\r\n    return prompts[agent.type] || 'You are a helpful AI assistant. Complete tasks accurately and efficiently.';\r\n  }\r\n\r\n  /**\r\n   * Process Claude's response\r\n   */\r\n  private processResponse(response: any): any {\r\n    if (!response.content || response.content.length === 0) {\r\n      return null;\r\n    }\r\n\r\n    // Extract text content\r\n    const textContent = response.content\r\n      .filter((block: any) => block.type === 'text')\r\n      .map((block: any) => block.text)\r\n      .join('\\n');\r\n\r\n    return {\r\n      text: textContent,\r\n      model: response.model,\r\n      tokensUsed: response.usage,\r\n      stopReason: response.stop_reason\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Get execution statistics\r\n   */\r\n  getExecutionStats(): Map<string, any> {\r\n    return new Map(this.executionStats);\r\n  }\r\n\r\n  /**\r\n   * Clear execution statistics\r\n   */\r\n  clearExecutionStats(): void {\r\n    this.executionStats.clear();\r\n  }\r\n\r\n  /**\r\n   * Get health status\r\n   */\r\n  async getHealthStatus(): Promise<any> {\r\n    const health = await this.claudeClient.checkHealth();\r\n    return {\r\n      ...health,\r\n      executorStats: {\r\n        totalExecutions: this.executionStats.size,\r\n        swarmMode: this.config.swarmMode\r\n      }\r\n    };\r\n  }\r\n}\r\n\r\n// Export for backward compatibility\r\nexport { TaskExecutorSDK as TaskExecutor };"],"names":["spawn","EventEmitter","Logger","generateId","ClaudeFlowSDKAdapter","ClaudeClientV25","TaskExecutorSDK","logger","claudeClient","sdkAdapter","config","executionStats","Map","apiKey","process","env","ANTHROPIC_API_KEY","maxRetries","timeout","swarmMode","checkpointInterval","retryAttempts","enableSwarmMode","info","executeTask","task","agent","executionId","startTime","Date","now","id","taskType","type","agentType","emit","taskId","agentId","prompt","buildPrompt","response","makeRequest","model","messages","role","content","system","getSystemPrompt","max_tokens","temperature","output","processResponse","executionTime","tokensUsed","usage","input_tokens","output_tokens","set","timestamp","result","success","errors","retryCount","error","Error","message","executeStreamingTask","onChunk","fullOutput","makeStreamingRequest","stream","chunk","delta","text","executeClaudeTask","options","interactive","executeInteractiveCLI","Promise","resolve","args","description","claudeProcess","stdio","errorOutput","stdout","on","data","toString","stderr","code","agentContext","capabilities","join","status","taskContext","priority","dependencies","length","prompts","textContent","filter","block","map","stopReason","stop_reason","getExecutionStats","clearExecutionStats","clear","getHealthStatus","health","checkHealth","executorStats","totalExecutions","size","TaskExecutor"],"mappings":"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"}