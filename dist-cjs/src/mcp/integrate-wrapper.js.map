{"version":3,"sources":["../../../src/mcp/integrate-wrapper.ts"],"sourcesContent":["#!/usr/bin/env node\r\nimport { spawn } from 'child_process';\r\nimport { Client } from '@modelcontextprotocol/sdk/client/index.js';\r\nimport { StdioClientTransport } from '@modelcontextprotocol/sdk/client/stdio.js';\r\nimport { ClaudeCodeMCPWrapper } from './claude-code-wrapper.js';\r\n\r\n/**\r\n * Integration script that connects the Claude-Flow MCP wrapper\r\n * to the Claude Code MCP server\r\n */\r\nexport class MCPIntegration {\r\n  private claudeCodeClient?: Client;\r\n  private wrapper: ClaudeCodeMCPWrapper;\r\n\r\n  constructor() {\r\n    this.wrapper = new ClaudeCodeMCPWrapper();\r\n  }\r\n\r\n  async connectToClaudeCode(): Promise<void> {\r\n    try {\r\n      // Start Claude Code MCP server process\r\n      const claudeCodeProcess = spawn('npx', ['-y', '@anthropic/claude-code', 'mcp'], {\r\n        stdio: ['pipe', 'pipe', 'pipe'],\r\n      });\r\n\r\n      const transport = new StdioClientTransport({\r\n        command: 'npx',\r\n        args: ['-y', '@anthropic/claude-code', 'mcp'],\r\n      });\r\n\r\n      this.claudeCodeClient = new Client(\r\n        {\r\n          name: 'claude-flow-wrapper-client',\r\n          version: '1.0.0',\r\n        },\r\n        {\r\n          capabilities: {},\r\n        },\r\n      );\r\n\r\n      await this.claudeCodeClient.connect(transport);\r\n\r\n      // Inject the client into the wrapper\r\n      (this.wrapper as any).claudeCodeMCP = this.claudeCodeClient;\r\n\r\n      console.log('Connected to Claude Code MCP server');\r\n    } catch (error) {\r\n      console.error('Failed to connect to Claude Code MCP:', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  async start(): Promise<void> {\r\n    // Connect to Claude Code MCP\r\n    await this.connectToClaudeCode();\r\n\r\n    // Start the wrapper server\r\n    await this.wrapper.run();\r\n  }\r\n}\r\n\r\n// Update the wrapper to use the real Claude Code MCP client\r\nexport function injectClaudeCodeClient(wrapper: ClaudeCodeMCPWrapper, client: Client): void {\r\n  // Override the forwardToClaudeCode method\r\n  (wrapper as any).forwardToClaudeCode = async function (toolName: string, args: any) {\r\n    try {\r\n      const result = await client.callTool(toolName, args);\r\n      return result;\r\n    } catch (error) {\r\n      return {\r\n        content: [\r\n          {\r\n            type: 'text',\r\n            text: `Error calling Claude Code tool ${toolName}: ${error instanceof Error ? error.message : String(error)}`,\r\n          },\r\n        ],\r\n        isError: true,\r\n      };\r\n    }\r\n  };\r\n}\r\n\r\n// Main execution\r\nif (import.meta.url === `file://${process.argv[1]}`) {\r\n  const integration = new MCPIntegration();\r\n  integration.start().catch(console.error);\r\n}\r\n"],"names":["spawn","Client","StdioClientTransport","ClaudeCodeMCPWrapper","MCPIntegration","claudeCodeClient","wrapper","connectToClaudeCode","claudeCodeProcess","stdio","transport","command","args","name","version","capabilities","connect","claudeCodeMCP","console","log","error","start","run","injectClaudeCodeClient","client","forwardToClaudeCode","toolName","result","callTool","content","type","text","Error","message","String","isError","url","process","argv","integration","catch"],"mappings":";AACA,SAASA,KAAK,QAAQ,gBAAgB;AACtC,SAASC,MAAM,QAAQ,4CAA4C;AACnE,SAASC,oBAAoB,QAAQ,4CAA4C;AACjF,SAASC,oBAAoB,QAAQ,2BAA2B;AAMhE,OAAO,MAAMC;IACHC,iBAA0B;IAC1BC,QAA8B;IAEtC,aAAc;QACZ,IAAI,CAACA,OAAO,GAAG,IAAIH;IACrB;IAEA,MAAMI,sBAAqC;QACzC,IAAI;YAEF,MAAMC,oBAAoBR,MAAM,OAAO;gBAAC;gBAAM;gBAA0B;aAAM,EAAE;gBAC9ES,OAAO;oBAAC;oBAAQ;oBAAQ;iBAAO;YACjC;YAEA,MAAMC,YAAY,IAAIR,qBAAqB;gBACzCS,SAAS;gBACTC,MAAM;oBAAC;oBAAM;oBAA0B;iBAAM;YAC/C;YAEA,IAAI,CAACP,gBAAgB,GAAG,IAAIJ,OAC1B;gBACEY,MAAM;gBACNC,SAAS;YACX,GACA;gBACEC,cAAc,CAAC;YACjB;YAGF,MAAM,IAAI,CAACV,gBAAgB,CAACW,OAAO,CAACN;YAGnC,IAAI,CAACJ,OAAO,CAASW,aAAa,GAAG,IAAI,CAACZ,gBAAgB;YAE3Da,QAAQC,GAAG,CAAC;QACd,EAAE,OAAOC,OAAO;YACdF,QAAQE,KAAK,CAAC,yCAAyCA;YACvD,MAAMA;QACR;IACF;IAEA,MAAMC,QAAuB;QAE3B,MAAM,IAAI,CAACd,mBAAmB;QAG9B,MAAM,IAAI,CAACD,OAAO,CAACgB,GAAG;IACxB;AACF;AAGA,OAAO,SAASC,uBAAuBjB,OAA6B,EAAEkB,MAAc;IAEjFlB,QAAgBmB,mBAAmB,GAAG,eAAgBC,QAAgB,EAAEd,IAAS;QAChF,IAAI;YACF,MAAMe,SAAS,MAAMH,OAAOI,QAAQ,CAACF,UAAUd;YAC/C,OAAOe;QACT,EAAE,OAAOP,OAAO;YACd,OAAO;gBACLS,SAAS;oBACP;wBACEC,MAAM;wBACNC,MAAM,CAAC,+BAA+B,EAAEL,SAAS,EAAE,EAAEN,iBAAiBY,QAAQZ,MAAMa,OAAO,GAAGC,OAAOd,QAAQ;oBAC/G;iBACD;gBACDe,SAAS;YACX;QACF;IACF;AACF;AAGA,IAAI,YAAYC,GAAG,KAAK,CAAC,OAAO,EAAEC,QAAQC,IAAI,CAAC,EAAE,EAAE,EAAE;IACnD,MAAMC,cAAc,IAAInC;IACxBmC,YAAYlB,KAAK,GAAGmB,KAAK,CAACtB,QAAQE,KAAK;AACzC"}