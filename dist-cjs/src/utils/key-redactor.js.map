{"version":3,"sources":["../../../src/utils/key-redactor.js"],"sourcesContent":["/**\r\n * API Key Redaction Utility\r\n * Prevents sensitive data from leaking into logs, memory, or git commits\r\n */\r\n\r\nexport class KeyRedactor {\r\n  static API_KEY_PATTERNS = [\r\n    // Anthropic API keys\r\n    /sk-ant-[a-zA-Z0-9_-]{95,}/gi,\r\n\r\n    // OpenRouter API keys\r\n    /sk-or-[a-zA-Z0-9_-]{32,}/gi,\r\n\r\n    // Google/Gemini API keys\r\n    /AIza[a-zA-Z0-9_-]{35}/gi,\r\n\r\n    // Generic API keys\r\n    /[a-zA-Z0-9_-]{20,}API[a-zA-Z0-9_-]{20,}/gi,\r\n\r\n    // Bearer tokens\r\n    /Bearer\\s+[a-zA-Z0-9_\\-\\.]{20,}/gi,\r\n\r\n    // Environment variable format\r\n    /([A-Z_]+_API_KEY|[A-Z_]+_TOKEN|[A-Z_]+_SECRET)=[\"']?([^\"'\\s]+)[\"']?/gi,\r\n\r\n    // Supabase keys\r\n    /eyJ[a-zA-Z0-9_-]*\\.eyJ[a-zA-Z0-9_-]*\\.[a-zA-Z0-9_-]*/gi,\r\n  ];\r\n\r\n  static SENSITIVE_FIELDS = [\r\n    'apiKey',\r\n    'api_key',\r\n    'token',\r\n    'secret',\r\n    'password',\r\n    'private_key',\r\n    'privateKey',\r\n    'accessToken',\r\n    'access_token',\r\n    'refreshToken',\r\n    'refresh_token',\r\n  ];\r\n\r\n  /**\r\n   * Redact API keys and sensitive data from text\r\n   */\r\n  static redact(text, showPrefix = true) {\r\n    if (!text) return text;\r\n\r\n    let redacted = text;\r\n\r\n    // Redact using patterns\r\n    this.API_KEY_PATTERNS.forEach(pattern => {\r\n      redacted = redacted.replace(pattern, (match) => {\r\n        if (showPrefix && match.length > 8) {\r\n          const prefix = match.substring(0, 8);\r\n          return `${prefix}...[REDACTED]`;\r\n        }\r\n        return '[REDACTED_API_KEY]';\r\n      });\r\n    });\r\n\r\n    return redacted;\r\n  }\r\n\r\n  /**\r\n   * Redact sensitive fields in objects\r\n   */\r\n  static redactObject(obj, deep = true) {\r\n    if (!obj || typeof obj !== 'object') return obj;\r\n\r\n    const redacted = { ...obj };\r\n\r\n    Object.keys(redacted).forEach(key => {\r\n      const lowerKey = key.toLowerCase();\r\n\r\n      // Check if field name is sensitive\r\n      const isSensitive = this.SENSITIVE_FIELDS.some(field =>\r\n        lowerKey.includes(field)\r\n      );\r\n\r\n      if (isSensitive && typeof redacted[key] === 'string') {\r\n        const value = redacted[key];\r\n        if (value && value.length > 8) {\r\n          redacted[key] = `${value.substring(0, 4)}...[REDACTED]`;\r\n        } else {\r\n          redacted[key] = '[REDACTED]';\r\n        }\r\n      } else if (deep && typeof redacted[key] === 'object' && redacted[key] !== null) {\r\n        redacted[key] = this.redactObject(redacted[key], deep);\r\n      } else if (typeof redacted[key] === 'string') {\r\n        // Redact any API keys in string values\r\n        redacted[key] = this.redact(redacted[key]);\r\n      }\r\n    });\r\n\r\n    return redacted;\r\n  }\r\n\r\n  /**\r\n   * Sanitize text for safe logging\r\n   */\r\n  static sanitize(text) {\r\n    return this.redact(text, true);\r\n  }\r\n\r\n  /**\r\n   * Sanitize command arguments\r\n   */\r\n  static sanitizeArgs(args) {\r\n    return args.map(arg => {\r\n      // Check if arg is a flag value pair\r\n      if (arg.includes('key') || arg.includes('token') || arg.includes('secret')) {\r\n        return this.redact(arg);\r\n      }\r\n      return arg;\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Check if text contains unredacted sensitive data\r\n   */\r\n  static containsSensitiveData(text) {\r\n    return this.API_KEY_PATTERNS.some(pattern => pattern.test(text));\r\n  }\r\n\r\n  /**\r\n   * Validate that text is safe for logging/storage\r\n   */\r\n  static validate(text) {\r\n    const warnings = [];\r\n\r\n    this.API_KEY_PATTERNS.forEach((pattern, index) => {\r\n      if (pattern.test(text)) {\r\n        warnings.push(`Potential API key detected (pattern ${index + 1})`);\r\n      }\r\n    });\r\n\r\n    return {\r\n      safe: warnings.length === 0,\r\n      warnings,\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Redact environment variables\r\n   */\r\n  static redactEnv(env) {\r\n    const redacted = {};\r\n\r\n    Object.keys(env).forEach(key => {\r\n      const value = env[key];\r\n      if (!value) {\r\n        redacted[key] = '';\r\n        return;\r\n      }\r\n\r\n      const lowerKey = key.toLowerCase();\r\n      const isSensitive = lowerKey.includes('key') ||\r\n                         lowerKey.includes('token') ||\r\n                         lowerKey.includes('secret') ||\r\n                         lowerKey.includes('password');\r\n\r\n      if (isSensitive) {\r\n        redacted[key] = value.length > 8\r\n          ? `${value.substring(0, 4)}...[REDACTED]`\r\n          : '[REDACTED]';\r\n      } else {\r\n        redacted[key] = value;\r\n      }\r\n    });\r\n\r\n    return redacted;\r\n  }\r\n}\r\n\r\n// Export singleton instance\r\nexport const redactor = KeyRedactor;\r\n"],"names":["KeyRedactor","API_KEY_PATTERNS","SENSITIVE_FIELDS","redact","text","showPrefix","redacted","forEach","pattern","replace","match","length","prefix","substring","redactObject","obj","deep","Object","keys","key","lowerKey","toLowerCase","isSensitive","some","field","includes","value","sanitize","sanitizeArgs","args","map","arg","containsSensitiveData","test","validate","warnings","index","push","safe","redactEnv","env","redactor"],"mappings":"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"},MAAMO,QAAQc,GAAG,CAACrB,IAAI;YACtB,IAAI,CAACO,OAAO;gBACVpB,QAAQ,CAACa,IAAI,GAAG;gBAChB;YACF;YAEA,MAAMC,WAAWD,IAAIE,WAAW;YAChC,MAAMC,cAAcF,SAASK,QAAQ,CAAC,UACnBL,SAASK,QAAQ,CAAC,YAClBL,SAASK,QAAQ,CAAC,aAClBL,SAASK,QAAQ,CAAC;YAErC,IAAIH,aAAa;gBACfhB,QAAQ,CAACa,IAAI,GAAGO,MAAMf,MAAM,GAAG,IAC3B,GAAGe,MAAMb,SAAS,CAAC,GAAG,GAAG,aAAa,CAAC,GACvC;YACN,OAAO;gBACLP,QAAQ,CAACa,IAAI,GAAGO;YAClB;QACF;QAEA,OAAOpB;IACT;AACF;AAGA,OAAO,MAAMmC,WAAWzC,YAAY"}