{
  "version": 3,
  "sources": ["../../../src/swarm/workers/copy-worker.ts"],
  "sourcesContent": ["import { parentPort, workerData } from 'worker_threads';\nimport * as fs from 'fs/promises';\nimport * as path from 'path';\nimport { createHash } from 'crypto';\n\ninterface WorkerData {\n  files: Array<{\n    sourcePath: string;\n    destPath: string;\n    permissions?: number;\n    verify?: boolean;\n  }>;\n  workerId: number;\n}\n\ninterface WorkerResult {\n  success: boolean;\n  file: string;\n  error?: string;\n  hash?: string;\n}\n\nasync function copyFile(file: WorkerData['files'][0]): Promise<WorkerResult> {\n  try {\n    // Ensure destination directory exists\n    const destDir = path.dirname(file.destPath);\n    await fs.mkdir(destDir, { recursive: true });\n\n    // Copy the file\n    await fs.copyFile(file.sourcePath, file.destPath);\n\n    // Preserve permissions if requested\n    if (file.permissions) {\n      await fs.chmod(file.destPath, file.permissions);\n    }\n\n    let hash: string | undefined;\n\n    // Calculate hash if verification is requested\n    if (file.verify) {\n      const content = await fs.readFile(file.destPath);\n      hash = createHash('sha256').update(content).digest('hex');\n    }\n\n    return {\n      success: true,\n      file: file.sourcePath,\n      hash,\n    };\n  } catch (error) {\n    return {\n      success: false,\n      file: file.sourcePath,\n      error: error instanceof Error ? error.message : String(error),\n    };\n  }\n}\n\nasync function main() {\n  const data = workerData as WorkerData;\n\n  if (!parentPort) {\n    throw new Error('This script must be run as a worker thread');\n  }\n\n  for (const file of data.files) {\n    const result = await copyFile(file);\n    parentPort.postMessage(result);\n  }\n}\n\n// Run the worker\nmain().catch((error) => {\n  if (parentPort) {\n    parentPort.postMessage({\n      success: false,\n      file: 'worker',\n      error: error instanceof Error ? error.message : String(error),\n    });\n  }\n});\n"],
  "mappings": ";;;;;;;;;;;;;;;;;;;;;;;;AAAA,4BAAuC;AACvC,SAAoB;AACpB,WAAsB;AACtB,oBAA2B;AAmB3B,eAAe,SAAS,MAAqD;AAC3E,MAAI;AAEF,UAAM,UAAU,KAAK,QAAQ,KAAK,QAAQ;AAC1C,UAAM,GAAG,MAAM,SAAS,EAAE,WAAW,KAAK,CAAC;AAG3C,UAAM,GAAG,SAAS,KAAK,YAAY,KAAK,QAAQ;AAGhD,QAAI,KAAK,aAAa;AACpB,YAAM,GAAG,MAAM,KAAK,UAAU,KAAK,WAAW;AAAA,IAChD;AAEA,QAAI;AAGJ,QAAI,KAAK,QAAQ;AACf,YAAM,UAAU,MAAM,GAAG,SAAS,KAAK,QAAQ;AAC/C,iBAAO,0BAAW,QAAQ,EAAE,OAAO,OAAO,EAAE,OAAO,KAAK;AAAA,IAC1D;AAEA,WAAO;AAAA,MACL,SAAS;AAAA,MACT,MAAM,KAAK;AAAA,MACX;AAAA,IACF;AAAA,EACF,SAAS,OAAO;AACd,WAAO;AAAA,MACL,SAAS;AAAA,MACT,MAAM,KAAK;AAAA,MACX,OAAO,iBAAiB,QAAQ,MAAM,UAAU,OAAO,KAAK;AAAA,IAC9D;AAAA,EACF;AACF;AAlCe;AAoCf,eAAe,OAAO;AACpB,QAAM,OAAO;AAEb,MAAI,CAAC,kCAAY;AACf,UAAM,IAAI,MAAM,4CAA4C;AAAA,EAC9D;AAEA,aAAW,QAAQ,KAAK,OAAO;AAC7B,UAAM,SAAS,MAAM,SAAS,IAAI;AAClC,qCAAW,YAAY,MAAM;AAAA,EAC/B;AACF;AAXe;AAcf,KAAK,EAAE,MAAM,CAAC,UAAU;AACtB,MAAI,kCAAY;AACd,qCAAW,YAAY;AAAA,MACrB,SAAS;AAAA,MACT,MAAM;AAAA,MACN,OAAO,iBAAiB,QAAQ,MAAM,UAAU,OAAO,KAAK;AAAA,IAC9D,CAAC;AAAA,EACH;AACF,CAAC;",
  "names": []
}
