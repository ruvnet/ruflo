{"version":3,"sources":["../../../../../src/cli/simple-commands/init/index.js"],"sourcesContent":["// init/index.js - Initialize Claude Code integration files\r\nimport { printSuccess, printError, printWarning, exit } from '../../utils.js';\r\nimport { existsSync } from 'fs';\r\nimport process from 'process';\r\nimport os from 'os';\r\nimport { spawn, execSync } from 'child_process';\r\nimport { promisify } from 'util';\r\n\r\n// Helper to replace Deno.Command\r\nfunction runCommand(command, args, options = {}) {\r\n  return new Promise((resolve, reject) => {\r\n    const child = spawn(command, args, {\r\n      cwd: options.cwd,\r\n      env: { ...process.env, ...options.env },\r\n      stdio: options.stdout === 'inherit' ? 'inherit' : 'pipe'\r\n    });\r\n    \r\n    let stdout = '';\r\n    let stderr = '';\r\n    \r\n    if (options.stdout !== 'inherit') {\r\n      child.stdout.on('data', (data) => { stdout += data; });\r\n      child.stderr.on('data', (data) => { stderr += data; });\r\n    }\r\n    \r\n    child.on('close', (code) => {\r\n      if (code === 0) {\r\n        resolve({ success: true, code, stdout, stderr });\r\n      } else {\r\n        reject(new Error(`Command failed with exit code ${code}`));\r\n      }\r\n    });\r\n    \r\n    child.on('error', reject);\r\n  });\r\n}\r\nimport { createLocalExecutable } from './executable-wrapper.js';\r\nimport { createSparcStructureManually } from './sparc-structure.js';\r\nimport { createClaudeSlashCommands } from './claude-commands/slash-commands.js';\r\nimport { createOptimizedClaudeSlashCommands } from './claude-commands/optimized-slash-commands.js';\r\n// execSync imported above as execSyncOriginal\\nconst execSync = execSyncOriginal;\r\nimport { promises as fs } from 'fs';\r\nimport { copyTemplates } from './template-copier.js';\r\nimport { copyRevisedTemplates, validateTemplatesExist } from './copy-revised-templates.js';\r\nimport { copyAgentFiles, createAgentDirectories, validateAgentSystem, copyCommandFiles } from './agent-copier.js';\r\nimport { copySkillFiles, createSkillDirectories, validateSkillSystem } from './skills-copier.js';\r\nimport { showInitHelp } from './help.js';\r\nimport { batchInitCommand, batchInitFromConfig, validateBatchOptions } from './batch-init.js';\r\nimport { ValidationSystem, runFullValidation } from './validation/index.js';\r\nimport { RollbackSystem, createAtomicOperation } from './rollback/index.js';\r\nimport {\r\n  createEnhancedClaudeMd,\r\n  createEnhancedSettingsJson,\r\n  createWrapperScript,\r\n  createCommandDoc,\r\n  createHelperScript,\r\n  COMMAND_STRUCTURE,\r\n} from './templates/enhanced-templates.js';\r\nimport { createOptimizedSparcClaudeMd } from './templates/claude-md.js';\r\nimport { getIsolatedNpxEnv } from '../../../utils/npx-isolated-cache.js';\r\nimport { updateGitignore, needsGitignoreUpdate } from './gitignore-updater.js';\r\nimport {\r\n  createFullClaudeMd,\r\n  createSparcClaudeMd,\r\n  createMinimalClaudeMd,\r\n} from './templates/claude-md.js';\r\nimport {\r\n  createVerificationClaudeMd,\r\n  createVerificationSettingsJson,\r\n} from './templates/verification-claude-md.js';\r\nimport {\r\n  createFullMemoryBankMd,\r\n  createMinimalMemoryBankMd,\r\n} from './templates/memory-bank-md.js';\r\nimport {\r\n  createFullCoordinationMd,\r\n  createMinimalCoordinationMd,\r\n} from './templates/coordination-md.js';\r\nimport { createAgentsReadme, createSessionsReadme } from './templates/readme-files.js';\r\nimport { \r\n  initializeHiveMind, \r\n  getHiveMindStatus,\r\n  rollbackHiveMindInit\r\n} from './hive-mind-init.js';\r\n\r\n/**\r\n * Check if Claude Code CLI is installed\r\n */\r\nfunction isClaudeCodeInstalled() {\r\n  try {\r\n    execSync('which claude', { stdio: 'ignore' });\r\n    return true;\r\n  } catch {\r\n    return false;\r\n  }\r\n}\r\n\r\n/**\r\n * Set up MCP servers in Claude Code\r\n */\r\nasync function setupMcpServers(dryRun = false) {\r\n  console.log('\\nüîå Setting up MCP servers for Claude Code...');\r\n\r\n  const servers = [\r\n    {\r\n      name: 'claude-flow',\r\n      command: 'npx claude-flow@alpha mcp start',\r\n      description: 'Claude Flow MCP server with swarm orchestration (alpha)',\r\n    },\r\n    {\r\n      name: 'ruv-swarm',\r\n      command: 'npx ruv-swarm mcp start',\r\n      description: 'ruv-swarm MCP server for enhanced coordination',\r\n    },\r\n    {\r\n      name: 'flow-nexus',\r\n      command: 'npx flow-nexus@latest mcp start',\r\n      description: 'Flow Nexus Complete MCP server for advanced AI orchestration',\r\n    },\r\n  ];\r\n\r\n  for (const server of servers) {\r\n    try {\r\n      if (!dryRun) {\r\n        console.log(`  üîÑ Adding ${server.name}...`);\r\n        execSync(`claude mcp add ${server.name} ${server.command}`, { stdio: 'inherit' });\r\n        console.log(`  ‚úÖ Added ${server.name} - ${server.description}`);\r\n      } else {\r\n        console.log(`  [DRY RUN] Would add ${server.name} - ${server.description}`);\r\n      }\r\n    } catch (err) {\r\n      console.log(`  ‚ö†Ô∏è  Failed to add ${server.name}: ${err.message}`);\r\n      console.log(\r\n        `     You can add it manually with: claude mcp add ${server.name} ${server.command}`,\r\n      );\r\n    }\r\n  }\r\n\r\n  if (!dryRun) {\r\n    console.log('\\n  üìã Verifying MCP servers...');\r\n    try {\r\n      execSync('claude mcp list', { stdio: 'inherit' });\r\n    } catch (err) {\r\n      console.log('  ‚ö†Ô∏è  Could not verify MCP servers');\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * Create statusline script content (embedded fallback for binary builds)\r\n */\r\nfunction createStatuslineScript() {\r\n  return `\r\n#!/bin/bash\r\n\r\n# Read JSON input from stdin\r\nINPUT=$(cat)\r\nMODEL=$(echo \"$INPUT\" | jq -r \\'.model.display_name // \"Claude\"\\')\r\nCWD=$(echo \"$INPUT\" | jq -r \\'.workspace.current_dir // .cwd\\')\r\nDIR=$(basename \"$CWD\")\r\n\r\n# Replace claude-code-flow with branded name\r\nif [ \"$DIR\" = \"claude-code-flow\" ]; then\r\n  DIR=\"üåä Claude Flow\"\r\nfi\r\n\r\n# Get git branch\r\nBRANCH=$(cd \"$CWD\" 2>/dev/null && git branch --show-current 2>/dev/null)\r\n\r\n# Start building statusline\r\nprintf \"\\\\033[1m$MODEL\\\\033[0m in \\\\033[36m$DIR\\\\033[0m\"\r\n[ -n \"$BRANCH\" ] && printf \" on \\\\033[33m‚éá $BRANCH\\\\033[0m\"\r\n\r\n# Claude-Flow integration\r\nFLOW_DIR=\"$CWD/.claude-flow\"\r\n\r\nif [ -d \"$FLOW_DIR\" ]; then\r\n  printf \" ‚îÇ\"\r\n\r\n  # 1. Swarm Configuration & Topology\r\n  if [ -f \"$FLOW_DIR/swarm-config.json\" ]; then\r\n    STRATEGY=$(jq -r \\'.defaultStrategy // empty\\' \"$FLOW_DIR/swarm-config.json\" 2>/dev/null)\r\n    if [ -n \"$STRATEGY\" ]; then\r\n      # Map strategy to topology icon\r\n      case \"$STRATEGY\" in\r\n        \"balanced\") TOPO_ICON=\"‚ö°mesh\" ;;\r\n        \"conservative\") TOPO_ICON=\"‚ö°hier\" ;;\r\n        \"aggressive\") TOPO_ICON=\"‚ö°ring\" ;;\r\n        *) TOPO_ICON=\"‚ö°$STRATEGY\" ;;\r\n      esac\r\n      printf \" \\\\033[35m$TOPO_ICON\\\\033[0m\"\r\n\r\n      # Count agent profiles as \"configured agents\"\r\n      AGENT_COUNT=$(jq -r \\'.agentProfiles | length\\' \"$FLOW_DIR/swarm-config.json\" 2>/dev/null)\r\n      if [ -n \"$AGENT_COUNT\" ] && [ \"$AGENT_COUNT\" != \"null\" ] && [ \"$AGENT_COUNT\" -gt 0 ]; then\r\n        printf \"  \\\\033[35mü§ñ $AGENT_COUNT\\\\033[0m\"\r\n      fi\r\n    fi\r\n  fi\r\n\r\n  # 2. Real-time System Metrics\r\n  if [ -f \"$FLOW_DIR/metrics/system-metrics.json\" ]; then\r\n    # Get latest metrics (last entry in array)\r\n    LATEST=$(jq -r \\'.[-1]\\' \"$FLOW_DIR/metrics/system-metrics.json\" 2>/dev/null)\r\n\r\n    if [ -n \"$LATEST\" ] && [ \"$LATEST\" != \"null\" ]; then\r\n      # Memory usage\r\n      MEM_PERCENT=$(echo \"$LATEST\" | jq -r \\'.memoryUsagePercent // 0\\' | awk \\'{printf \"%.0f\", $1}\\')\r\n      if [ -n \"$MEM_PERCENT\" ] && [ \"$MEM_PERCENT\" != \"null\" ]; then\r\n        # Color-coded memory (green <60%, yellow 60-80%, red >80%)\r\n        if [ \"$MEM_PERCENT\" -lt 60 ]; then\r\n          MEM_COLOR=\"\\\\033[32m\"  # Green\r\n        elif [ \"$MEM_PERCENT\" -lt 80 ]; then\r\n          MEM_COLOR=\"\\\\033[33m\"  # Yellow\r\n        else\r\n          MEM_COLOR=\"\\\\033[31m\"  # Red\r\n        fi\r\n        printf \"  \\${MEM_COLOR}üíæ \\${MEM_PERCENT}%\\\\033[0m\"\r\n      fi\r\n\r\n      # CPU load\r\n      CPU_LOAD=$(echo \"$LATEST\" | jq -r \\'.cpuLoad // 0\\' | awk \\'{printf \"%.0f\", $1 * 100}\\')\r\n      if [ -n \"$CPU_LOAD\" ] && [ \"$CPU_LOAD\" != \"null\" ]; then\r\n        # Color-coded CPU (green <50%, yellow 50-75%, red >75%)\r\n        if [ \"$CPU_LOAD\" -lt 50 ]; then\r\n          CPU_COLOR=\"\\\\033[32m\"  # Green\r\n        elif [ \"$CPU_LOAD\" -lt 75 ]; then\r\n          CPU_COLOR=\"\\\\033[33m\"  # Yellow\r\n        else\r\n          CPU_COLOR=\"\\\\033[31m\"  # Red\r\n        fi\r\n        printf \"  \\${CPU_COLOR}‚öô \\${CPU_LOAD}%\\\\033[0m\"\r\n      fi\r\n    fi\r\n  fi\r\n\r\n  # 3. Session State\r\n  if [ -f \"$FLOW_DIR/session-state.json\" ]; then\r\n    SESSION_ID=$(jq -r \\'.sessionId // empty\\' \"$FLOW_DIR/session-state.json\" 2>/dev/null)\r\n    ACTIVE=$(jq -r \\'.active // false\\' \"$FLOW_DIR/session-state.json\" 2>/dev/null)\r\n\r\n    if [ \"$ACTIVE\" = \"true\" ] && [ -n \"$SESSION_ID\" ]; then\r\n      # Show abbreviated session ID\r\n      SHORT_ID=$(echo \"$SESSION_ID\" | cut -d\\'-\\' -f1)\r\n      printf \"  \\\\033[34müîÑ $SHORT_ID\\\\033[0m\"\r\n    fi\r\n  fi\r\n\r\n  # 4. Performance Metrics from task-metrics.json\r\n  if [ -f \"$FLOW_DIR/metrics/task-metrics.json\" ]; then\r\n    # Parse task metrics for success rate, avg time, and streak\r\n    METRICS=$(jq -r \\'\r\n      # Calculate metrics\r\n      (map(select(.success == true)) | length) as $successful |\r\n      (length) as $total |\r\n      (if $total > 0 then ($successful / $total * 100) else 0 end) as $success_rate |\r\n      (map(.duration // 0) | add / length) as $avg_duration |\r\n      # Calculate streak (consecutive successes from end)\r\n      (reverse |\r\n        reduce .[] as $task (0;\r\n          if $task.success == true then . + 1 else 0 end\r\n        )\r\n      ) as $streak |\r\n      {\r\n        success_rate: $success_rate,\r\n        avg_duration: $avg_duration,\r\n        streak: $streak,\r\n        total: $total\r\n      } | @json\r\n    \\' \"$FLOW_DIR/metrics/task-metrics.json\" 2>/dev/null)\r\n\r\n    if [ -n \"$METRICS\" ] && [ \"$METRICS\" != \"null\" ]; then\r\n      # Success Rate\r\n      SUCCESS_RATE=$(echo \"$METRICS\" | jq -r \\'.success_rate // 0\\' | awk \\'{printf \"%.0f\", $1}\\')\r\n      TOTAL_TASKS=$(echo \"$METRICS\" | jq -r \\'.total // 0\\')\r\n\r\n      if [ -n \"$SUCCESS_RATE\" ] && [ \"$TOTAL_TASKS\" -gt 0 ]; then\r\n        # Color-code: Green (>80%), Yellow (60-80%), Red (<60%)\r\n        if [ \"$SUCCESS_RATE\" -gt 80 ]; then\r\n          SUCCESS_COLOR=\"\\\\033[32m\"  # Green\r\n        elif [ \"$SUCCESS_RATE\" -ge 60 ]; then\r\n          SUCCESS_COLOR=\"\\\\033[33m\"  # Yellow\r\n        else\r\n          SUCCESS_COLOR=\"\\\\033[31m\"  # Red\r\n        fi\r\n        printf \"  \\${SUCCESS_COLOR}üéØ \\${SUCCESS_RATE}%\\\\033[0m\"\r\n      fi\r\n\r\n      # Average Time\r\n      AVG_TIME=$(echo \"$METRICS\" | jq -r \\'.avg_duration // 0\\')\r\n      if [ -n \"$AVG_TIME\" ] && [ \"$TOTAL_TASKS\" -gt 0 ]; then\r\n        # Format smartly: seconds, minutes, or hours\r\n        if [ $(echo \"$AVG_TIME < 60\" | bc -l 2>/dev/null || echo 0) -eq 1 ]; then\r\n          TIME_STR=$(echo \"$AVG_TIME\" | awk \\'{printf \"%.1fs\", $1}\\')\r\n        elif [ $(echo \"$AVG_TIME < 3600\" | bc -l 2>/dev/null || echo 0) -eq 1 ]; then\r\n          TIME_STR=$(echo \"$AVG_TIME\" | awk \\'{printf \"%.1fm\", $1/60}\\')\r\n        else\r\n          TIME_STR=$(echo \"$AVG_TIME\" | awk \\'{printf \"%.1fh\", $1/3600}\\')\r\n        fi\r\n        printf \"  \\\\033[36m‚è±Ô∏è  $TIME_STR\\\\033[0m\"\r\n      fi\r\n\r\n      # Streak (only show if > 0)\r\n      STREAK=$(echo \"$METRICS\" | jq -r \\'.streak // 0\\')\r\n      if [ -n \"$STREAK\" ] && [ \"$STREAK\" -gt 0 ]; then\r\n        printf \"  \\\\033[91müî• $STREAK\\\\033[0m\"\r\n      fi\r\n    fi\r\n  fi\r\n\r\n  # 5. Active Tasks (check for task files)\r\n  if [ -d \"$FLOW_DIR/tasks\" ]; then\r\n    TASK_COUNT=$(find \"$FLOW_DIR/tasks\" -name \"*.json\" -type f 2>/dev/null | wc -l)\r\n    if [ \"$TASK_COUNT\" -gt 0 ]; then\r\n      printf \"  \\\\033[36müìã $TASK_COUNT\\\\033[0m\"\r\n    fi\r\n  fi\r\n\r\n  # 6. Check for hooks activity\r\n  if [ -f \"$FLOW_DIR/hooks-state.json\" ]; then\r\n    HOOKS_ACTIVE=$(jq -r \\'.enabled // false\\' \"$FLOW_DIR/hooks-state.json\" 2>/dev/null)\r\n    if [ \"$HOOKS_ACTIVE\" = \"true\" ]; then\r\n      printf \" \\\\033[35müîó\\\\033[0m\"\r\n    fi\r\n  fi\r\nfi\r\n\r\necho\r\n`;\r\n}\r\n\r\nexport async function initCommand(subArgs, flags) {\r\n  // Show help if requested\r\n  if (flags.help || flags.h || subArgs.includes('--help') || subArgs.includes('-h')) {\r\n    showInitHelp();\r\n    return;\r\n  }\r\n\r\n  // Handle --env flag for .env template generation\r\n  if (flags.env || subArgs.includes('--env')) {\r\n    const { generateEnvTemplate } = await import('../env-template.js');\r\n    const workingDir = process.env.PWD || process.cwd();\r\n    const force = flags.force || flags.f;\r\n\r\n    console.log('üìã Generating .env template file...\\n');\r\n    const result = await generateEnvTemplate(workingDir, force);\r\n\r\n    if (result.created) {\r\n      console.log('\\nüìö Next steps:');\r\n      console.log('1. Open .env file and add your API keys');\r\n      console.log('2. Get keys from:');\r\n      console.log('   ‚Ä¢ Anthropic: https://console.anthropic.com/settings/keys');\r\n      console.log('   ‚Ä¢ OpenRouter: https://openrouter.ai/keys');\r\n      console.log('3. Enable memory: claude-flow agent run coder \"task\" --enable-memory\\n');\r\n      console.log('üí° See docs/REASONINGBANK-COST-OPTIMIZATION.md for cost savings tips');\r\n    } else if (result.exists) {\r\n      console.log('üí° To overwrite: claude-flow init --env --force');\r\n    }\r\n\r\n    return;\r\n  }\r\n\r\n  // Check for verification flags first\r\n  const hasVerificationFlags = subArgs.includes('--verify') || subArgs.includes('--pair') ||\r\n                               flags.verify || flags.pair;\r\n\r\n  // Handle Flow Nexus minimal init\r\n  if (flags['flow-nexus']) {\r\n    return await flowNexusMinimalInit(flags, subArgs);\r\n  }\r\n\r\n  // Default to enhanced Claude Flow v2 init unless other modes are specified\r\n  // Use --basic flag for old behavior, or verification flags for verification mode\r\n  if (!flags.basic && !flags.minimal && !flags.sparc && !hasVerificationFlags) {\r\n    return await enhancedClaudeFlowInit(flags, subArgs);\r\n  }\r\n\r\n  // Check for validation and rollback commands\r\n  if (subArgs.includes('--validate') || subArgs.includes('--validate-only')) {\r\n    return handleValidationCommand(subArgs, flags);\r\n  }\r\n\r\n  if (subArgs.includes('--rollback')) {\r\n    return handleRollbackCommand(subArgs, flags);\r\n  }\r\n\r\n  if (subArgs.includes('--list-backups')) {\r\n    return handleListBackups(subArgs, flags);\r\n  }\r\n\r\n  // Check for batch operations\r\n  const batchInitFlag = flags['batch-init'] || subArgs.includes('--batch-init');\r\n  const configFlag = flags.config || subArgs.includes('--config');\r\n\r\n  if (batchInitFlag || configFlag) {\r\n    return handleBatchInit(subArgs, flags);\r\n  }\r\n\r\n  // Check if enhanced initialization is requested\r\n  const useEnhanced = subArgs.includes('--enhanced') || subArgs.includes('--safe');\r\n\r\n  if (useEnhanced) {\r\n    return enhancedInitCommand(subArgs, flags);\r\n  }\r\n\r\n  // Parse init options\r\n  const initForce = subArgs.includes('--force') || subArgs.includes('-f') || flags.force;\r\n  const initMinimal = subArgs.includes('--minimal') || subArgs.includes('-m') || flags.minimal;\r\n  const initSparc = flags.roo || (subArgs && subArgs.includes('--roo')); // SPARC only with --roo flag\r\n  const initDryRun = subArgs.includes('--dry-run') || subArgs.includes('-d') || flags.dryRun;\r\n  const initOptimized = initSparc && initForce; // Use optimized templates when both flags are present\r\n  const selectedModes = flags.modes ? flags.modes.split(',') : null; // Support selective mode initialization\r\n  \r\n  // Check for verification and pair programming flags\r\n  const initVerify = subArgs.includes('--verify') || flags.verify;\r\n  const initPair = subArgs.includes('--pair') || flags.pair;\r\n\r\n  // Get the actual working directory (where the command was run from)\r\n  // Use PWD environment variable which preserves the original directory\r\n  const workingDir = process.env.PWD || cwd();\r\n  console.log(`üìÅ Initializing in: ${workingDir}`);\r\n\r\n  // Change to the working directory to ensure all file operations happen there\r\n  try {\r\n    process.chdir(workingDir);\r\n  } catch (err) {\r\n    printWarning(`Could not change to directory ${workingDir}: ${err.message}`);\r\n  }\r\n\r\n  try {\r\n    printSuccess('Initializing Claude Code integration files...');\r\n\r\n    // Check if files already exist in the working directory\r\n    const files = ['CLAUDE.md', 'memory-bank.md', 'coordination.md'];\r\n    const existingFiles = [];\r\n\r\n    for (const file of files) {\r\n      try {\r\n        await fs.stat(`${workingDir}/${file}`);\r\n        existingFiles.push(file);\r\n      } catch {\r\n        // File doesn't exist, which is what we want\r\n      }\r\n    }\r\n\r\n    if (existingFiles.length > 0 && !initForce) {\r\n      printWarning(`The following files already exist: ${existingFiles.join(', ')}`);\r\n      console.log('Use --force to overwrite existing files');\r\n      return;\r\n    }\r\n\r\n    // Use template copier to copy all template files\r\n    const templateOptions = {\r\n      sparc: initSparc,\r\n      minimal: initMinimal,\r\n      optimized: initOptimized,\r\n      dryRun: initDryRun,\r\n      force: initForce,\r\n      selectedModes: selectedModes,\r\n      verify: initVerify,\r\n      pair: initPair,\r\n    };\r\n\r\n    // If verification flags are set, always use generated templates for CLAUDE.md and settings.json\r\n    if (initVerify || initPair) {\r\n      console.log('  üìÅ Creating verification-focused configuration...');\r\n      \r\n      // Create verification CLAUDE.md\r\n      if (!initDryRun) {\r\n        const { createVerificationClaudeMd, createVerificationSettingsJson } = await import('./templates/verification-claude-md.js');\r\n        await fs.writeFile(`${workingDir}/CLAUDE.md`, createVerificationClaudeMd(), 'utf8');\r\n        \r\n        // Create .claude directory and settings\r\n        await fs.mkdir(`${workingDir}/.claude`, { recursive: true });\r\n        await fs.writeFile(`${workingDir}/.claude/settings.json`, createVerificationSettingsJson(), 'utf8');\r\n        console.log('  ‚úÖ Created verification-focused CLAUDE.md and settings.json');\r\n      } else {\r\n        console.log('  [DRY RUN] Would create verification-focused CLAUDE.md and settings.json');\r\n      }\r\n      \r\n      // Copy other template files from repository if available\r\n      const validation = validateTemplatesExist();\r\n      if (validation.valid) {\r\n        const revisedResults = await copyRevisedTemplates(workingDir, {\r\n          force: initForce,\r\n          dryRun: initDryRun,\r\n          verbose: false,\r\n          sparc: initSparc\r\n        });\r\n      }\r\n      \r\n      // Also create standard memory and coordination files\r\n      const copyResults = await copyTemplates(workingDir, {\r\n        ...templateOptions,\r\n        skipClaudeMd: true,  // Don't overwrite the verification CLAUDE.md\r\n        skipSettings: true   // Don't overwrite the verification settings.json\r\n      });\r\n      \r\n    } else {\r\n      // Standard template copying logic\r\n      const validation = validateTemplatesExist();\r\n      if (validation.valid) {\r\n        console.log('  üìÅ Copying revised template files...');\r\n        const revisedResults = await copyRevisedTemplates(workingDir, {\r\n          force: initForce,\r\n          dryRun: initDryRun,\r\n          verbose: true,\r\n          sparc: initSparc\r\n        });\r\n\r\n        if (revisedResults.success) {\r\n          console.log(`  ‚úÖ Copied ${revisedResults.copiedFiles.length} template files`);\r\n          if (revisedResults.skippedFiles.length > 0) {\r\n            console.log(`  ‚è≠Ô∏è  Skipped ${revisedResults.skippedFiles.length} existing files`);\r\n          }\r\n        } else {\r\n          console.log('  ‚ö†Ô∏è  Some template files could not be copied:');\r\n          revisedResults.errors.forEach(err => console.log(`    - ${err}`));\r\n        }\r\n      } else {\r\n        // Fall back to generated templates\r\n        console.log('  ‚ö†Ô∏è  Revised templates not available, using generated templates');\r\n        const copyResults = await copyTemplates(workingDir, templateOptions);\r\n\r\n        if (!copyResults.success) {\r\n          printError('Failed to copy templates:');\r\n          copyResults.errors.forEach(err => console.log(`  ‚ùå ${err}`));\r\n          return;\r\n        }\r\n      }\r\n    }\r\n\r\n    // Agent setup moved to end of function where execution is guaranteed\r\n\r\n    // Directory structure is created by template copier\r\n\r\n    // SPARC files are created by template copier when --sparc flag is used\r\n\r\n    // Memory README files and persistence database are created by template copier\r\n\r\n    // Create local claude-flow@alpha executable wrapper\r\n    if (!initDryRun) {\r\n      await createLocalExecutable(workingDir);\r\n    } else {\r\n      console.log('  [DRY RUN] Would create local claude-flow@alpha executable wrapper');\r\n    }\r\n\r\n    // SPARC initialization\r\n    if (initSparc) {\r\n      console.log('\\nüöÄ Initializing SPARC development environment...');\r\n\r\n      if (initDryRun) {\r\n        console.log('  [DRY RUN] Would run: npx -y create-sparc init --force');\r\n        console.log('  [DRY RUN] Would create SPARC environment with all modes');\r\n        console.log(\r\n          '  [DRY RUN] Would create Claude slash commands' +\r\n            (initOptimized ? ' (Batchtools-optimized)' : ''),\r\n        );\r\n        if (selectedModes) {\r\n          console.log(\r\n            `  [DRY RUN] Would create commands for selected modes: ${selectedModes.join(', ')}`,\r\n          );\r\n        }\r\n      } else {\r\n        // Check if create-sparc exists and run it\r\n        let sparcInitialized = false;\r\n        try {\r\n          // Use isolated NPX cache to prevent concurrent conflicts\r\n          console.log('  üîÑ Running: npx -y create-sparc init --force');\r\n          const createSparcResult = await runCommand('npx', ['-y', 'create-sparc', 'init', '--force'], {\r\n            cwd: workingDir,\r\n            stdout: 'inherit',\r\n            stderr: 'inherit',\r\n            env: getIsolatedNpxEnv({\r\n              PWD: workingDir,\r\n            }),\r\n          });\r\n\r\n          if (createSparcResult.success) {\r\n            console.log('  ‚úÖ SPARC environment initialized successfully');\r\n            sparcInitialized = true;\r\n          } else {\r\n            printWarning('create-sparc failed, creating basic SPARC structure manually...');\r\n\r\n            // Fallback: create basic SPARC structure manually\r\n            await createSparcStructureManually();\r\n            sparcInitialized = true; // Manual creation still counts as initialized\r\n          }\r\n        } catch (err) {\r\n          printWarning('create-sparc not available, creating basic SPARC structure manually...');\r\n\r\n          // Fallback: create basic SPARC structure manually\r\n          await createSparcStructureManually();\r\n          sparcInitialized = true; // Manual creation still counts as initialized\r\n        }\r\n\r\n        // Always create Claude slash commands after SPARC initialization\r\n        if (sparcInitialized) {\r\n          try {\r\n            if (initOptimized) {\r\n              await createOptimizedClaudeSlashCommands(workingDir, selectedModes);\r\n            } else {\r\n              await createClaudeSlashCommands(workingDir);\r\n            }\r\n          } catch (err) {\r\n            // Legacy slash command creation - silently skip if it fails\r\n            // SPARC slash commands are already created successfully above\r\n          }\r\n        }\r\n      }\r\n    }\r\n\r\n    if (initDryRun) {\r\n      printSuccess(\"üîç Dry run completed! Here's what would be created:\");\r\n      console.log('\\nüìã Summary of planned initialization:');\r\n      console.log(\r\n        `  ‚Ä¢ Configuration: ${initOptimized ? 'Batchtools-optimized SPARC' : initSparc ? 'SPARC-enhanced' : 'Standard'}`,\r\n      );\r\n      console.log(\r\n        `  ‚Ä¢ Template type: ${initOptimized ? 'Optimized for parallel processing' : 'Standard'}`,\r\n      );\r\n      console.log('  ‚Ä¢ Core files: CLAUDE.md, memory-bank.md, coordination.md');\r\n      console.log('  ‚Ä¢ Directory structure: memory/, coordination/, .claude/');\r\n      console.log('  ‚Ä¢ Local executable: ./claude-flow@alpha');\r\n      if (initSparc) {\r\n        console.log(\r\n          `  ‚Ä¢ Claude Code slash commands: ${selectedModes ? selectedModes.length : 'All'} SPARC mode commands`,\r\n        );\r\n        console.log('  ‚Ä¢ SPARC environment with all development modes');\r\n      }\r\n      if (initOptimized) {\r\n        console.log('  ‚Ä¢ Batchtools optimization: Enabled for parallel processing');\r\n        console.log('  ‚Ä¢ Performance enhancements: Smart batching, concurrent operations');\r\n      }\r\n      console.log('\\nüöÄ To proceed with initialization, run the same command without --dry-run');\r\n    } else {\r\n      printSuccess('üéâ Claude Code integration files initialized successfully!');\r\n\r\n      if (initOptimized) {\r\n        console.log('\\n‚ö° Batchtools Optimization Enabled!');\r\n        console.log('  ‚Ä¢ Parallel processing capabilities activated');\r\n        console.log('  ‚Ä¢ Performance improvements: 250-500% faster operations');\r\n        console.log('  ‚Ä¢ Smart batching and concurrent operations available');\r\n      }\r\n\r\n      console.log('\\nüìã What was created:');\r\n      console.log(\r\n        `  ‚úÖ CLAUDE.md (${initOptimized ? 'Batchtools-optimized' : initSparc ? 'SPARC-enhanced' : 'Standard configuration'})`,\r\n      );\r\n      console.log(\r\n        `  ‚úÖ memory-bank.md (${initOptimized ? 'With parallel processing' : 'Standard memory system'})`,\r\n      );\r\n      console.log(\r\n        `  ‚úÖ coordination.md (${initOptimized ? 'Enhanced with batchtools' : 'Standard coordination'})`,\r\n      );\r\n      console.log('  ‚úÖ Directory structure with memory/ and coordination/');\r\n      console.log('  ‚úÖ Local executable at ./claude-flow@alpha');\r\n      console.log('  ‚úÖ Persistence database at memory/claude-flow@alpha-data.json');\r\n      console.log('  ‚úÖ Agent system with 64 specialized agents in .claude/agents/');\r\n\r\n      if (initSparc) {\r\n        const modeCount = selectedModes ? selectedModes.length : '20+';\r\n        console.log(`  ‚úÖ Claude Code slash commands (${modeCount} SPARC modes)`);\r\n        console.log('  ‚úÖ Complete SPARC development environment');\r\n      }\r\n\r\n      console.log('\\nüöÄ Next steps:');\r\n      console.log('1. Review and customize the generated files for your project');\r\n      console.log(\"2. Run './claude-flow@alpha start' to begin the orchestration system\");\r\n      console.log(\"3. Use './claude-flow@alpha' instead of 'npx claude-flow@alpha' for all commands\");\r\n      console.log(\"4. Use 'claude --dangerously-skip-permissions' for unattended operation\");\r\n\r\n      if (initSparc) {\r\n        console.log(\r\n          '5. Use Claude Code slash commands: /sparc, /sparc-architect, /sparc-tdd, etc.',\r\n        );\r\n        console.log(\"6. Explore SPARC modes with './claude-flow@alpha sparc modes'\");\r\n        console.log('7. Try TDD workflow with \\'./claude-flow@alpha sparc tdd \"your task\"\\'');\r\n\r\n        if (initOptimized) {\r\n          console.log('8. Use batchtools commands: /batchtools, /performance for optimization');\r\n          console.log('9. Enable parallel processing with --parallel flags');\r\n          console.log(\"10. Monitor performance with './claude-flow@alpha performance monitor'\");\r\n        }\r\n      }\r\n\r\n      // Update .gitignore\r\n      const gitignoreResult = await updateGitignore(workingDir, initForce, initDryRun);\r\n      if (gitignoreResult.success) {\r\n        if (!initDryRun) {\r\n          console.log(`  ‚úÖ ${gitignoreResult.message}`);\r\n        } else {\r\n          console.log(`  ${gitignoreResult.message}`);\r\n        }\r\n      } else {\r\n        console.log(`  ‚ö†Ô∏è  ${gitignoreResult.message}`);\r\n      }\r\n\r\n      console.log('\\nüí° Tips:');\r\n      console.log(\"  ‚Ä¢ Type '/' in Claude Code to see all available slash commands\");\r\n      console.log(\"  ‚Ä¢ Use './claude-flow@alpha status' to check system health\");\r\n      console.log(\"  ‚Ä¢ Store important context with './claude-flow@alpha memory store'\");\r\n\r\n      if (initOptimized) {\r\n        console.log('  ‚Ä¢ Use --parallel flags for concurrent operations');\r\n        console.log('  ‚Ä¢ Enable batch processing for multiple related tasks');\r\n        console.log('  ‚Ä¢ Monitor performance with real-time metrics');\r\n      }\r\n\r\n      // Initialize hive-mind system for standard init\r\n      console.log('\\nüß† Initializing basic hive-mind system...');\r\n      try {\r\n        const hiveMindOptions = {\r\n          config: {\r\n            integration: {\r\n              claudeCode: { enabled: isClaudeCodeInstalled() },\r\n              mcpTools: { enabled: true }\r\n            },\r\n            monitoring: { enabled: false } // Basic setup for standard init\r\n          }\r\n        };\r\n        \r\n        const hiveMindResult = await initializeHiveMind(workingDir, hiveMindOptions, false);\r\n        \r\n        if (hiveMindResult.success) {\r\n          console.log('  ‚úÖ Basic hive-mind system initialized');\r\n          console.log('  üí° Use \"npx claude-flow@alpha hive-mind\" for advanced features');\r\n        } else {\r\n          console.log(`  ‚ö†Ô∏è  Hive-mind setup skipped: ${hiveMindResult.error}`);\r\n        }\r\n      } catch (err) {\r\n        console.log(`  ‚ö†Ô∏è  Hive-mind setup skipped: ${err.message}`);\r\n      }\r\n\r\n      // Check for Claude Code and set up MCP servers (always enabled by default)\r\n      if (!initDryRun && isClaudeCodeInstalled()) {\r\n        console.log('\\nüîç Claude Code CLI detected!');\r\n        const skipMcp = subArgs && subArgs.includes && subArgs.includes('--skip-mcp');\r\n\r\n        if (!skipMcp) {\r\n          await setupMcpServers(initDryRun);\r\n        } else {\r\n          console.log('  ‚ÑπÔ∏è  Skipping MCP setup (--skip-mcp flag used)');\r\n        }\r\n      } else if (!initDryRun && !isClaudeCodeInstalled()) {\r\n        console.log('\\n‚ö†Ô∏è  Claude Code CLI not detected!');\r\n        console.log('  üì• Install with: npm install -g @anthropic-ai/claude-code');\r\n        console.log('  üìã Then add MCP servers manually with:');\r\n        console.log('     claude mcp add claude-flow npx claude-flow@alpha mcp start');\r\n        console.log('     claude mcp add ruv-swarm npx ruv-swarm mcp start');\r\n        console.log('     claude mcp add flow-nexus npx flow-nexus@latest mcp start');\r\n      }\r\n    }\r\n  } catch (err) {\r\n    printError(`Failed to initialize files: ${err.message}`);\r\n  }\r\n}\r\n\r\n// Handle batch initialization\r\nasync function handleBatchInit(subArgs, flags) {\r\n  try {\r\n    // Options parsing from flags and subArgs\r\n    const options = {\r\n      parallel: !flags['no-parallel'] && flags.parallel !== false,\r\n      sparc: flags.sparc || flags.s,\r\n      minimal: flags.minimal || flags.m,\r\n      force: flags.force || flags.f,\r\n      maxConcurrency: flags['max-concurrent'] || 5,\r\n      progressTracking: true,\r\n      template: flags.template,\r\n      environments: flags.environments\r\n        ? flags.environments.split(',').map((env) => env.trim())\r\n        : ['dev'],\r\n    };\r\n\r\n    // Validate options\r\n    const validationErrors = validateBatchOptions(options);\r\n    if (validationErrors.length > 0) {\r\n      printError('Batch options validation failed:');\r\n      validationErrors.forEach((error) => console.error(`  - ${error}`));\r\n      return;\r\n    }\r\n\r\n    // Config file mode\r\n    if (flags.config) {\r\n      const configFile = flags.config;\r\n      printSuccess(`Loading batch configuration from: ${configFile}`);\r\n      const results = await batchInitFromConfig(configFile, options);\r\n      if (results) {\r\n        printSuccess('Batch initialization from config completed');\r\n      }\r\n      return;\r\n    }\r\n\r\n    // Batch init mode\r\n    if (flags['batch-init']) {\r\n      const projectsString = flags['batch-init'];\r\n      const projects = projectsString.split(',').map((project) => project.trim());\r\n\r\n      if (projects.length === 0) {\r\n        printError('No projects specified for batch initialization');\r\n        return;\r\n      }\r\n\r\n      printSuccess(`Initializing ${projects.length} projects in batch mode`);\r\n      const results = await batchInitCommand(projects, options);\r\n\r\n      if (results) {\r\n        const successful = results.filter((r) => r.success).length;\r\n        const failed = results.filter((r) => !r.success).length;\r\n\r\n        if (failed === 0) {\r\n          printSuccess(`All ${successful} projects initialized successfully`);\r\n        } else {\r\n          printWarning(`${successful} projects succeeded, ${failed} failed`);\r\n        }\r\n      }\r\n      return;\r\n    }\r\n\r\n    printError('No batch operation specified. Use --batch-init <projects> or --config <file>');\r\n  } catch (err) {\r\n    printError(`Batch initialization failed: ${err.message}`);\r\n  }\r\n}\r\n\r\n/**\r\n * Enhanced initialization command with validation and rollback\r\n */\r\nasync function enhancedInitCommand(subArgs, flags) {\r\n  console.log('üõ°Ô∏è  Starting enhanced initialization with validation and rollback...');\r\n\r\n  // Store parameters to avoid scope issues in async context\r\n  const args = subArgs || [];\r\n  const options = flags || {};\r\n\r\n  // Get the working directory\r\n  const workingDir = process.env.PWD || process.cwd();\r\n\r\n  // Initialize systems\r\n  const rollbackSystem = new RollbackSystem(workingDir);\r\n  const validationSystem = new ValidationSystem(workingDir);\r\n\r\n  let atomicOp = null;\r\n\r\n  try {\r\n    // Parse options\r\n    const initOptions = {\r\n      force: args.includes('--force') || args.includes('-f') || options.force,\r\n      minimal: args.includes('--minimal') || args.includes('-m') || options.minimal,\r\n      sparc: args.includes('--sparc') || args.includes('-s') || options.sparc,\r\n      skipPreValidation: args.includes('--skip-pre-validation'),\r\n      skipBackup: args.includes('--skip-backup'),\r\n      validateOnly: args.includes('--validate-only'),\r\n    };\r\n\r\n    // Phase 1: Pre-initialization validation\r\n    if (!initOptions.skipPreValidation) {\r\n      console.log('\\nüîç Phase 1: Pre-initialization validation...');\r\n      const preValidation = await validationSystem.validatePreInit(initOptions);\r\n\r\n      if (!preValidation.success) {\r\n        printError('Pre-initialization validation failed:');\r\n        preValidation.errors.forEach((error) => console.error(`  ‚ùå ${error}`));\r\n        return;\r\n      }\r\n\r\n      if (preValidation.warnings.length > 0) {\r\n        printWarning('Pre-initialization warnings:');\r\n        preValidation.warnings.forEach((warning) => console.warn(`  ‚ö†Ô∏è  ${warning}`));\r\n      }\r\n\r\n      printSuccess('Pre-initialization validation passed');\r\n    }\r\n\r\n    // Stop here if validation-only mode\r\n    if (options.validateOnly) {\r\n      console.log('\\n‚úÖ Validation-only mode completed');\r\n      return;\r\n    }\r\n\r\n    // Phase 2: Create backup\r\n    if (!options.skipBackup) {\r\n      console.log('\\nüíæ Phase 2: Creating backup...');\r\n      const backupResult = await rollbackSystem.createPreInitBackup();\r\n\r\n      if (!backupResult.success) {\r\n        printError('Backup creation failed:');\r\n        backupResult.errors.forEach((error) => console.error(`  ‚ùå ${error}`));\r\n        return;\r\n      }\r\n    }\r\n\r\n    // Phase 3: Initialize with atomic operations\r\n    console.log('\\nüîß Phase 3: Atomic initialization...');\r\n    atomicOp = createAtomicOperation(rollbackSystem, 'enhanced-init');\r\n\r\n    const atomicBegin = await atomicOp.begin();\r\n    if (!atomicBegin) {\r\n      printError('Failed to begin atomic operation');\r\n      return;\r\n    }\r\n\r\n    // Perform initialization steps with checkpoints\r\n    await performInitializationWithCheckpoints(rollbackSystem, options, workingDir, dryRun);\r\n\r\n    // Phase 4: Post-initialization validation\r\n    console.log('\\n‚úÖ Phase 4: Post-initialization validation...');\r\n    const postValidation = await validationSystem.validatePostInit();\r\n\r\n    if (!postValidation.success) {\r\n      printError('Post-initialization validation failed:');\r\n      postValidation.errors.forEach((error) => console.error(`  ‚ùå ${error}`));\r\n\r\n      // Attempt automatic rollback\r\n      console.log('\\nüîÑ Attempting automatic rollback...');\r\n      await atomicOp.rollback();\r\n      printWarning('Initialization rolled back due to validation failure');\r\n      return;\r\n    }\r\n\r\n    // Phase 5: Configuration validation\r\n    console.log('\\nüîß Phase 5: Configuration validation...');\r\n    const configValidation = await validationSystem.validateConfiguration();\r\n\r\n    if (configValidation.warnings.length > 0) {\r\n      printWarning('Configuration warnings:');\r\n      configValidation.warnings.forEach((warning) => console.warn(`  ‚ö†Ô∏è  ${warning}`));\r\n    }\r\n\r\n    // Phase 6: Health checks\r\n    console.log('\\nüè• Phase 6: System health checks...');\r\n    const healthChecks = await validationSystem.runHealthChecks();\r\n\r\n    if (healthChecks.warnings.length > 0) {\r\n      printWarning('Health check warnings:');\r\n      healthChecks.warnings.forEach((warning) => console.warn(`  ‚ö†Ô∏è  ${warning}`));\r\n    }\r\n\r\n    // Commit atomic operation\r\n    await atomicOp.commit();\r\n\r\n    // Generate and display validation report\r\n    const fullValidation = await runFullValidation(workingDir, {\r\n      postInit: true,\r\n      skipPreInit: options.skipPreValidation,\r\n    });\r\n\r\n    console.log('\\nüìä Validation Report:');\r\n    console.log(fullValidation.report);\r\n\r\n    printSuccess('üéâ Enhanced initialization completed successfully!');\r\n    console.log('\\n‚ú® Your SPARC environment is fully validated and ready to use');\r\n  } catch (error) {\r\n    printError(`Enhanced initialization failed: ${error.message}`);\r\n\r\n    // Attempt rollback if atomic operation is active\r\n    if (atomicOp && !atomicOp.completed) {\r\n      console.log('\\nüîÑ Performing emergency rollback...');\r\n      try {\r\n        await atomicOp.rollback();\r\n        printWarning('Emergency rollback completed');\r\n      } catch (rollbackError) {\r\n        printError(`Rollback also failed: ${rollbackError.message}`);\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * Handle validation commands\r\n */\r\nasync function handleValidationCommand(subArgs, flags) {\r\n  const workingDir = process.env.PWD || process.cwd();\r\n\r\n  console.log('üîç Running validation checks...');\r\n\r\n  const options = {\r\n    skipPreInit: subArgs.includes('--skip-pre-init'),\r\n    skipConfig: subArgs.includes('--skip-config'),\r\n    skipModeTest: subArgs.includes('--skip-mode-test'),\r\n    postInit: !subArgs.includes('--pre-init-only'),\r\n  };\r\n\r\n  try {\r\n    const validationResults = await runFullValidation(workingDir, options);\r\n\r\n    console.log('\\nüìä Validation Results:');\r\n    console.log(validationResults.report);\r\n\r\n    if (validationResults.success) {\r\n      printSuccess('‚úÖ All validation checks passed');\r\n    } else {\r\n      printError('‚ùå Some validation checks failed');\r\n      process.exit(1);\r\n    }\r\n  } catch (error) {\r\n    printError(`Validation failed: ${error.message}`);\r\n    process.exit(1);\r\n  }\r\n}\r\n\r\n/**\r\n * Handle rollback commands\r\n */\r\nasync function handleRollbackCommand(subArgs, flags) {\r\n  const workingDir = process.env.PWD || process.cwd();\r\n  const rollbackSystem = new RollbackSystem(workingDir);\r\n\r\n  try {\r\n    // Check for specific rollback options\r\n    if (subArgs.includes('--full')) {\r\n      console.log('üîÑ Performing full rollback...');\r\n      const result = await rollbackSystem.performFullRollback();\r\n\r\n      if (result.success) {\r\n        printSuccess('Full rollback completed successfully');\r\n      } else {\r\n        printError('Full rollback failed:');\r\n        result.errors.forEach((error) => console.error(`  ‚ùå ${error}`));\r\n      }\r\n    } else if (subArgs.includes('--partial')) {\r\n      const phaseIndex = subArgs.findIndex((arg) => arg === '--phase');\r\n      if (phaseIndex !== -1 && subArgs[phaseIndex + 1]) {\r\n        const phase = subArgs[phaseIndex + 1];\r\n        console.log(`üîÑ Performing partial rollback for phase: ${phase}`);\r\n\r\n        const result = await rollbackSystem.performPartialRollback(phase);\r\n\r\n        if (result.success) {\r\n          printSuccess(`Partial rollback completed for phase: ${phase}`);\r\n        } else {\r\n          printError(`Partial rollback failed for phase: ${phase}`);\r\n          result.errors.forEach((error) => console.error(`  ‚ùå ${error}`));\r\n        }\r\n      } else {\r\n        printError('Partial rollback requires --phase <phase-name>');\r\n      }\r\n    } else {\r\n      // Interactive rollback point selection\r\n      const rollbackPoints = await rollbackSystem.listRollbackPoints();\r\n\r\n      if (rollbackPoints.rollbackPoints.length === 0) {\r\n        printWarning('No rollback points available');\r\n        return;\r\n      }\r\n\r\n      console.log('\\nüìã Available rollback points:');\r\n      rollbackPoints.rollbackPoints.forEach((point, index) => {\r\n        const date = new Date(point.timestamp).toLocaleString();\r\n        console.log(`  ${index + 1}. ${point.type} - ${date}`);\r\n      });\r\n\r\n      // For now, rollback to the most recent point\r\n      const latest = rollbackPoints.rollbackPoints[0];\r\n      if (latest) {\r\n        console.log(\r\n          `\\nüîÑ Rolling back to: ${latest.type} (${new Date(latest.timestamp).toLocaleString()})`,\r\n        );\r\n        const result = await rollbackSystem.performFullRollback(latest.backupId);\r\n\r\n        if (result.success) {\r\n          printSuccess('Rollback completed successfully');\r\n        } else {\r\n          printError('Rollback failed');\r\n        }\r\n      }\r\n    }\r\n  } catch (error) {\r\n    printError(`Rollback operation failed: ${error.message}`);\r\n  }\r\n}\r\n\r\n/**\r\n * Handle list backups command\r\n */\r\nasync function handleListBackups(subArgs, flags) {\r\n  const workingDir = process.env.PWD || process.cwd();\r\n  const rollbackSystem = new RollbackSystem(workingDir);\r\n\r\n  try {\r\n    const rollbackPoints = await rollbackSystem.listRollbackPoints();\r\n\r\n    console.log('\\nüìã Rollback Points and Backups:');\r\n\r\n    if (rollbackPoints.rollbackPoints.length === 0) {\r\n      console.log('  No rollback points available');\r\n    } else {\r\n      console.log('\\nüîÑ Rollback Points:');\r\n      rollbackPoints.rollbackPoints.forEach((point, index) => {\r\n        const date = new Date(point.timestamp).toLocaleString();\r\n        console.log(`  ${index + 1}. ${point.type} - ${date} (${point.backupId || 'No backup'})`);\r\n      });\r\n    }\r\n\r\n    if (rollbackPoints.checkpoints.length > 0) {\r\n      console.log('\\nüìç Checkpoints:');\r\n      rollbackPoints.checkpoints.slice(-5).forEach((checkpoint, index) => {\r\n        const date = new Date(checkpoint.timestamp).toLocaleString();\r\n        console.log(`  ${index + 1}. ${checkpoint.phase} - ${date} (${checkpoint.status})`);\r\n      });\r\n    }\r\n  } catch (error) {\r\n    printError(`Failed to list backups: ${error.message}`);\r\n  }\r\n}\r\n\r\n/**\r\n * Perform initialization with checkpoints\r\n */\r\nasync function performInitializationWithCheckpoints(\r\n  rollbackSystem,\r\n  options,\r\n  workingDir,\r\n  dryRun = false,\r\n) {\r\n  const phases = [\r\n    { name: 'file-creation', action: () => createInitialFiles(options, workingDir, dryRun) },\r\n    { name: 'directory-structure', action: () => createDirectoryStructure(workingDir, dryRun) },\r\n    { name: 'memory-setup', action: () => setupMemorySystem(workingDir, dryRun) },\r\n    { name: 'coordination-setup', action: () => setupCoordinationSystem(workingDir, dryRun) },\r\n    { name: 'executable-creation', action: () => createLocalExecutable(workingDir, dryRun) },\r\n  ];\r\n\r\n  if (options.sparc) {\r\n    phases.push(\r\n      { name: 'sparc-init', action: () => createSparcStructureManually() },\r\n      { name: 'claude-commands', action: () => createClaudeSlashCommands(workingDir) },\r\n    );\r\n  }\r\n\r\n  for (const phase of phases) {\r\n    console.log(`  üîß ${phase.name}...`);\r\n\r\n    // Create checkpoint before phase\r\n    await rollbackSystem.createCheckpoint(phase.name, {\r\n      timestamp: Date.now(),\r\n      phase: phase.name,\r\n    });\r\n\r\n    try {\r\n      await phase.action();\r\n      console.log(`  ‚úÖ ${phase.name} completed`);\r\n    } catch (error) {\r\n      console.error(`  ‚ùå ${phase.name} failed: ${error.message}`);\r\n      throw error;\r\n    }\r\n  }\r\n}\r\n\r\n// Helper functions for atomic initialization\r\nasync function createInitialFiles(options, workingDir, dryRun = false) {\r\n  if (!dryRun) {\r\n    const claudeMd = options.sparc\r\n      ? createSparcClaudeMd()\r\n      : options.minimal\r\n        ? createMinimalClaudeMd()\r\n        : createFullClaudeMd();\r\n    await fs.writeFile(`${workingDir}/CLAUDE.md`, claudeMd, 'utf8');\r\n\r\n    const memoryBankMd = options.minimal ? createMinimalMemoryBankMd() : createFullMemoryBankMd();\r\n    await fs.writeFile(`${workingDir}/memory-bank.md`, memoryBankMd, 'utf8');\r\n\r\n    const coordinationMd = options.minimal\r\n      ? createMinimalCoordinationMd()\r\n      : createFullCoordinationMd();\r\n    await fs.writeFile(`${workingDir}/coordination.md`, coordinationMd, 'utf8');\r\n  }\r\n}\r\n\r\nasync function createDirectoryStructure(workingDir, dryRun = false) {\r\n  const directories = [\r\n    'memory',\r\n    'memory/agents',\r\n    'memory/sessions',\r\n    'coordination',\r\n    'coordination/memory_bank',\r\n    'coordination/subtasks',\r\n    'coordination/orchestration',\r\n    '.claude',\r\n    '.claude/commands',\r\n    '.claude/logs',\r\n  ];\r\n\r\n  if (!dryRun) {\r\n    for (const dir of directories) {\r\n      await fs.mkdir(`${workingDir}/${dir}`, { recursive: true });\r\n    }\r\n  }\r\n}\r\n\r\nasync function setupMemorySystem(workingDir, dryRun = false) {\r\n  if (!dryRun) {\r\n    const initialData = { agents: [], tasks: [], lastUpdated: Date.now() };\r\n    await fs.writeFile(\r\n      `${workingDir}/memory/claude-flow@alpha-data.json`, JSON.stringify(initialData, null, 2), 'utf8'\r\n    );\r\n\r\n    await fs.writeFile(`${workingDir}/memory/agents/README.md`, createAgentsReadme(), 'utf8');\r\n    await fs.writeFile(`${workingDir}/memory/sessions/README.md`, createSessionsReadme(), 'utf8');\r\n  }\r\n}\r\n\r\nasync function setupCoordinationSystem(workingDir, dryRun = false) {\r\n  // Coordination system is already set up by createDirectoryStructure\r\n  // This is a placeholder for future coordination setup logic\r\n}\r\n\r\n/**\r\n * Setup monitoring and telemetry for token tracking\r\n */\r\nasync function setupMonitoring(workingDir) {\r\n  console.log('  üìà Configuring token usage tracking...');\r\n  \r\n  const fs = await import('fs/promises');\r\n  const path = await import('path');\r\n  \r\n  try {\r\n    // Create .claude-flow@alpha directory for tracking data\r\n    const trackingDir = path.join(workingDir, '.claude-flow@alpha');\r\n    await fs.mkdir(trackingDir, { recursive: true });\r\n    \r\n    // Create initial token usage file\r\n    const tokenUsageFile = path.join(trackingDir, 'token-usage.json');\r\n    const initialData = {\r\n      total: 0,\r\n      input: 0,\r\n      output: 0,\r\n      byAgent: {},\r\n      lastUpdated: new Date().toISOString()\r\n    };\r\n    \r\n    await fs.writeFile(tokenUsageFile, JSON.stringify(initialData, null, 2));\r\n    printSuccess('  ‚úì Created token usage tracking file');\r\n    \r\n    // Add telemetry configuration to .claude/settings.json if it exists\r\n    const settingsPath = path.join(workingDir, '.claude', 'settings.json');\r\n    try {\r\n      const settingsContent = await fs.readFile(settingsPath, 'utf8');\r\n      const settings = JSON.parse(settingsContent);\r\n      \r\n      // Add telemetry hook\r\n      if (!settings.hooks) settings.hooks = {};\r\n      if (!settings.hooks['post-task']) settings.hooks['post-task'] = [];\r\n      \r\n      // Add token tracking hook\r\n      const tokenTrackingHook = 'npx claude-flow@alpha internal track-tokens --session-id {{session_id}} --tokens {{token_usage}}';\r\n      if (!settings.hooks['post-task'].includes(tokenTrackingHook)) {\r\n        settings.hooks['post-task'].push(tokenTrackingHook);\r\n      }\r\n      \r\n      await fs.writeFile(settingsPath, JSON.stringify(settings, null, 2));\r\n      printSuccess('  ‚úì Added token tracking hooks to settings');\r\n    } catch (err) {\r\n      console.log('  ‚ö†Ô∏è  Could not update settings.json:', err.message);\r\n    }\r\n    \r\n    // Create monitoring configuration\r\n    const monitoringConfig = {\r\n      enabled: true,\r\n      telemetry: {\r\n        claudeCode: {\r\n          env: 'CLAUDE_CODE_ENABLE_TELEMETRY',\r\n          value: '1',\r\n          description: 'Enable Claude Code OpenTelemetry metrics'\r\n        }\r\n      },\r\n      tracking: {\r\n        tokens: true,\r\n        costs: true,\r\n        agents: true,\r\n        sessions: true\r\n      },\r\n      storage: {\r\n        location: '.claude-flow@alpha/token-usage.json',\r\n        format: 'json',\r\n        rotation: 'monthly'\r\n      }\r\n    };\r\n    \r\n    const configPath = path.join(trackingDir, 'monitoring.config.json');\r\n    await fs.writeFile(configPath, JSON.stringify(monitoringConfig, null, 2));\r\n    printSuccess('  ‚úì Created monitoring configuration');\r\n    \r\n    // Create shell profile snippet for environment variable\r\n    const envSnippet = `\r\n# Claude Flow Token Tracking\r\n# Add this to your shell profile (.bashrc, .zshrc, etc.)\r\nexport CLAUDE_CODE_ENABLE_TELEMETRY=1\r\n\r\n# Optional: Set custom metrics path\r\n# export CLAUDE_METRICS_PATH=\"$HOME/.claude/metrics\"\r\n`;\r\n    \r\n    const envPath = path.join(trackingDir, 'env-setup.sh');\r\n    await fs.writeFile(envPath, envSnippet.trim());\r\n    printSuccess('  ‚úì Created environment setup script');\r\n    \r\n    console.log('\\n  üìã To enable Claude Code telemetry:');\r\n    console.log('     1. Add to your shell profile: export CLAUDE_CODE_ENABLE_TELEMETRY=1');\r\n    console.log('     2. Or run: source .claude-flow@alpha/env-setup.sh');\r\n    console.log('\\n  üí° Token usage will be tracked in .claude-flow@alpha/token-usage.json');\r\n    console.log('     Run: claude-flow@alpha analysis token-usage --breakdown --cost-analysis');\r\n    \r\n  } catch (err) {\r\n    printError(`  Failed to setup monitoring: ${err.message}`);\r\n  }\r\n}\r\n\r\n/**\r\n * Enhanced Claude Flow v2.0.0 initialization\r\n */\r\nasync function enhancedClaudeFlowInit(flags, subArgs = []) {\r\n  console.log('üöÄ Initializing Claude Flow v2.0.0 with enhanced features...');\r\n\r\n  const workingDir = process.cwd();\r\n  const force = flags.force || flags.f;\r\n  const dryRun = flags.dryRun || flags['dry-run'] || flags.d;\r\n  const initSparc = flags.roo || (subArgs && subArgs.includes('--roo')); // SPARC only with --roo flag\r\n\r\n  // Parse --agent flag for specialized agent setup\r\n  const agentType = flags.agent || (subArgs && subArgs.find(arg => arg.startsWith('--agent='))?.split('=')[1]);\r\n  const initReasoning = agentType === 'reasoning' || (subArgs && subArgs.includes('--agent') && subArgs.includes('reasoning'));\r\n\r\n  // Store parameters to avoid scope issues in async context\r\n  const args = subArgs || [];\r\n  const options = flags || {};\r\n\r\n  // Import fs, path, and os modules for Node.js\r\n  const fs = await import('fs/promises');\r\n  const { chmod } = fs;\r\n  const path = await import('path');\r\n  const os = await import('os');\r\n\r\n  try {\r\n    // Check existing files\r\n    const existingFiles = [];\r\n    const filesToCheck = [\r\n      'CLAUDE.md',\r\n      '.claude/settings.json',\r\n      '.mcp.json',\r\n      // Removed claude-flow@alpha.config.json per user request\r\n    ];\r\n\r\n    for (const file of filesToCheck) {\r\n      if (existsSync(`${workingDir}/${file}`)) {\r\n        existingFiles.push(file);\r\n      }\r\n    }\r\n\r\n    if (existingFiles.length > 0 && !force) {\r\n      printWarning(`The following files already exist: ${existingFiles.join(', ')}`);\r\n      console.log('Use --force to overwrite existing files');\r\n      return;\r\n    }\r\n\r\n    // Create CLAUDE.md\r\n    if (!dryRun) {\r\n      await fs.writeFile(`${workingDir}/CLAUDE.md`, createOptimizedSparcClaudeMd(), 'utf8');\r\n      printSuccess('‚úì Created CLAUDE.md (Claude Flow v2.0.0 - Optimized)');\r\n    } else {\r\n      console.log('[DRY RUN] Would create CLAUDE.md (Claude Flow v2.0.0 - Optimized)');\r\n    }\r\n\r\n    // Create .claude directory structure\r\n    const claudeDir = `${workingDir}/.claude`;\r\n    if (!dryRun) {\r\n      await fs.mkdir(claudeDir, { recursive: true });\r\n      await fs.mkdir(`${claudeDir}/commands`, { recursive: true });\r\n      await fs.mkdir(`${claudeDir}/helpers`, { recursive: true });\r\n      printSuccess('‚úì Created .claude directory structure');\r\n    } else {\r\n      console.log('[DRY RUN] Would create .claude directory structure');\r\n    }\r\n\r\n    // Create settings.json\r\n    if (!dryRun) {\r\n      await fs.writeFile(`${claudeDir}/settings.json`, createEnhancedSettingsJson(), 'utf8');\r\n      printSuccess('‚úì Created .claude/settings.json with hooks and MCP configuration');\r\n    } else {\r\n      console.log('[DRY RUN] Would create .claude/settings.json');\r\n    }\r\n\r\n    // Copy statusline script\r\n    try {\r\n      let statuslineTemplate;\r\n      try {\r\n        // Try to read from templates directory first\r\n        statuslineTemplate = await fs.readFile(\r\n          path.join(__dirname, 'templates', 'statusline-command.sh'),\r\n          'utf8'\r\n        );\r\n      } catch {\r\n        // Fallback to embedded content (for binary builds)\r\n        statuslineTemplate = createStatuslineScript();\r\n      }\r\n\r\n      if (!dryRun) {\r\n        // Write to project .claude directory\r\n        await fs.writeFile(`${claudeDir}/statusline-command.sh`, statuslineTemplate, 'utf8');\r\n        await fs.chmod(`${claudeDir}/statusline-command.sh`, 0o755);\r\n\r\n        // Also write to home ~/.claude directory for global use\r\n        const homeClaudeDir = path.join(os.homedir(), '.claude');\r\n        await fs.mkdir(homeClaudeDir, { recursive: true });\r\n        await fs.writeFile(path.join(homeClaudeDir, 'statusline-command.sh'), statuslineTemplate, 'utf8');\r\n        await fs.chmod(path.join(homeClaudeDir, 'statusline-command.sh'), 0o755);\r\n\r\n        printSuccess('‚úì Created statusline-command.sh in both .claude/ and ~/.claude/');\r\n      } else {\r\n        console.log('[DRY RUN] Would create .claude/statusline-command.sh and ~/.claude/statusline-command.sh');\r\n      }\r\n    } catch (err) {\r\n      // Not critical, just skip\r\n      if (!dryRun) {\r\n        console.log('  ‚ö†Ô∏è  Could not create statusline script, skipping...');\r\n        console.log(`  ‚ÑπÔ∏è  Error: ${err.message}`);\r\n      }\r\n    }\r\n\r\n    // Create settings.local.json with default MCP permissions\r\n    const settingsLocal = {\r\n      permissions: {\r\n        allow: ['mcp__ruv-swarm', 'mcp__claude-flow@alpha', 'mcp__flow-nexus'],\r\n        deny: [],\r\n      },\r\n    };\r\n\r\n    if (!dryRun) {\r\n      await fs.writeFile(\r\n        `${claudeDir}/settings.local.json`, JSON.stringify(settingsLocal, null, 2, 'utf8'),\r\n      );\r\n      printSuccess('‚úì Created .claude/settings.local.json with default MCP permissions');\r\n    } else {\r\n      console.log(\r\n        '[DRY RUN] Would create .claude/settings.local.json with default MCP permissions',\r\n      );\r\n    }\r\n\r\n    // Create .mcp.json at project root for MCP server configuration\r\n    const mcpConfig = {\r\n      mcpServers: {\r\n        'claude-flow@alpha': {\r\n          command: 'npx',\r\n          args: ['claude-flow@alpha', 'mcp', 'start'],\r\n          type: 'stdio',\r\n        },\r\n        'ruv-swarm': {\r\n          command: 'npx',\r\n          args: ['ruv-swarm@latest', 'mcp', 'start'],\r\n          type: 'stdio',\r\n        },\r\n        'flow-nexus': {\r\n          command: 'npx',\r\n          args: ['flow-nexus@latest', 'mcp', 'start'],\r\n          type: 'stdio',\r\n        },\r\n      },\r\n    };\r\n\r\n    if (!dryRun) {\r\n      await fs.writeFile(`${workingDir}/.mcp.json`, JSON.stringify(mcpConfig, null, 2, 'utf8'));\r\n      printSuccess('‚úì Created .mcp.json at project root for MCP server configuration');\r\n    } else {\r\n      console.log('[DRY RUN] Would create .mcp.json at project root for MCP server configuration');\r\n    }\r\n\r\n    // Removed claude-flow@alpha.config.json creation per user request\r\n\r\n    // Create command documentation\r\n    for (const [category, commands] of Object.entries(COMMAND_STRUCTURE)) {\r\n      const categoryDir = `${claudeDir}/commands/${category}`;\r\n\r\n      if (!dryRun) {\r\n        await fs.mkdir(categoryDir, { recursive: true });\r\n\r\n        // Create category README\r\n        const categoryReadme = `# ${category.charAt(0).toUpperCase() + category.slice(1)} Commands\r\n\r\nCommands for ${category} operations in Claude Flow.\r\n\r\n## Available Commands\r\n\r\n${commands.map((cmd) => `- [${cmd}](./${cmd}.md)`).join('\\n')}\r\n`;\r\n        await fs.writeFile(`${categoryDir}/README.md`, categoryReadme, 'utf8');\r\n\r\n        // Create individual command docs\r\n        for (const command of commands) {\r\n          const doc = createCommandDoc(category, command);\r\n          if (doc) {\r\n            await fs.writeFile(`${categoryDir}/${command}.md`, doc, 'utf8');\r\n          }\r\n        }\r\n\r\n        console.log(`  ‚úì Created ${commands.length} ${category} command docs`);\r\n      } else {\r\n        console.log(`[DRY RUN] Would create ${commands.length} ${category} command docs`);\r\n      }\r\n    }\r\n\r\n    // Create wrapper scripts using the dedicated function\r\n    if (!dryRun) {\r\n      await createLocalExecutable(workingDir, dryRun);\r\n    } else {\r\n      console.log('[DRY RUN] Would create wrapper scripts');\r\n    }\r\n\r\n    // Create helper scripts\r\n    const helpers = ['setup-mcp.sh', 'quick-start.sh', 'github-setup.sh', 'github-safe.js', 'standard-checkpoint-hooks.sh', 'checkpoint-manager.sh'];\r\n    for (const helper of helpers) {\r\n      if (!dryRun) {\r\n        const content = createHelperScript(helper);\r\n        if (content) {\r\n          await fs.writeFile(`${claudeDir}/helpers/${helper}`, content, 'utf8');\r\n          await fs.chmod(`${claudeDir}/helpers/${helper}`, 0o755);\r\n        }\r\n      }\r\n    }\r\n\r\n    if (!dryRun) {\r\n      printSuccess(`‚úì Created ${helpers.length} helper scripts`);\r\n    } else {\r\n      console.log(`[DRY RUN] Would create ${helpers.length} helper scripts`);\r\n    }\r\n\r\n    // Create standard directories from original init\r\n    const standardDirs = [\r\n      'memory',\r\n      'memory/agents',\r\n      'memory/sessions',\r\n      'coordination',\r\n      'coordination/memory_bank',\r\n      'coordination/subtasks',\r\n      'coordination/orchestration',\r\n      '.swarm', // Add .swarm directory for shared memory\r\n      '.hive-mind', // Add .hive-mind directory for hive-mind system\r\n      '.claude/checkpoints', // Add checkpoints directory for Git checkpoint system\r\n    ];\r\n\r\n    for (const dir of standardDirs) {\r\n      if (!dryRun) {\r\n        await fs.mkdir(`${workingDir}/${dir}`, { recursive: true });\r\n      }\r\n    }\r\n\r\n    if (!dryRun) {\r\n      printSuccess('‚úì Created standard directory structure');\r\n\r\n      // Initialize memory system\r\n      const initialData = { agents: [], tasks: [], lastUpdated: Date.now() };\r\n      await fs.writeFile(\r\n        `${workingDir}/memory/claude-flow@alpha-data.json`, JSON.stringify(initialData, null, 2, 'utf8'),\r\n      );\r\n\r\n      // Create README files\r\n      await fs.writeFile(`${workingDir}/memory/agents/README.md`, createAgentsReadme(), 'utf8');\r\n      await fs.writeFile(`${workingDir}/memory/sessions/README.md`, createSessionsReadme(), 'utf8');\r\n\r\n      printSuccess('‚úì Initialized memory system');\r\n\r\n      // Initialize memory database with fallback support\r\n      try {\r\n        // Check if database exists BEFORE creating it\r\n        const dbPath = '.swarm/memory.db';\r\n        const { existsSync } = await import('fs');\r\n        const dbExistedBefore = existsSync(dbPath);\r\n\r\n        // Handle ReasoningBank migration BEFORE FallbackMemoryStore initialization\r\n        // This prevents schema conflicts with old databases\r\n        if (dbExistedBefore) {\r\n          console.log('  üîç Checking existing database for ReasoningBank schema...');\r\n\r\n          try {\r\n            const {\r\n              initializeReasoningBank,\r\n              checkReasoningBankTables,\r\n              migrateReasoningBank\r\n            } = await import('../../../reasoningbank/reasoningbank-adapter.js');\r\n\r\n            // Set the database path for ReasoningBank\r\n            process.env.CLAUDE_FLOW_DB_PATH = dbPath;\r\n\r\n            const tableCheck = await checkReasoningBankTables();\r\n\r\n            if (tableCheck.exists) {\r\n              console.log('  ‚úÖ ReasoningBank schema already complete');\r\n            } else if (force) {\r\n              // User used --force flag, migrate the database\r\n              console.log(`  üîÑ Migrating database: ${tableCheck.missingTables.length} tables missing`);\r\n              console.log(`     Missing: ${tableCheck.missingTables.join(', ')}`);\r\n\r\n              const migrationResult = await migrateReasoningBank();\r\n\r\n              if (migrationResult.success) {\r\n                printSuccess(`  ‚úì Migration complete: added ${migrationResult.addedTables?.length || 0} tables`);\r\n                console.log('     Use --reasoningbank flag to enable AI-powered memory features');\r\n              } else {\r\n                console.log(`  ‚ö†Ô∏è  Migration failed: ${migrationResult.message}`);\r\n                console.log('     Basic memory will work, use: memory init --reasoningbank to retry');\r\n              }\r\n            } else {\r\n              // Database exists with missing tables but no --force flag\r\n              console.log(`  ‚ÑπÔ∏è  Database has ${tableCheck.missingTables.length} missing ReasoningBank tables`);\r\n              console.log(`     Missing: ${tableCheck.missingTables.join(', ')}`);\r\n              console.log('     Use --force to migrate existing database');\r\n              console.log('     Or use: memory init --reasoningbank');\r\n            }\r\n          } catch (rbErr) {\r\n            console.log(`  ‚ö†Ô∏è  ReasoningBank check failed: ${rbErr.message}`);\r\n            console.log('     Will attempt normal initialization...');\r\n          }\r\n        }\r\n\r\n        // Import and initialize FallbackMemoryStore to create the database\r\n        const { FallbackMemoryStore } = await import('../../../memory/fallback-store.js');\r\n        const memoryStore = new FallbackMemoryStore();\r\n        await memoryStore.initialize();\r\n\r\n        if (memoryStore.isUsingFallback()) {\r\n          printSuccess('‚úì Initialized memory system (in-memory fallback for npx compatibility)');\r\n          console.log(\r\n            '  üí° For persistent storage, install locally: npm install claude-flow@alpha',\r\n          );\r\n        } else {\r\n          printSuccess('‚úì Initialized memory database (.swarm/memory.db)');\r\n\r\n          // Initialize ReasoningBank schema for fresh databases\r\n          if (!dbExistedBefore) {\r\n            try {\r\n              const {\r\n                initializeReasoningBank\r\n              } = await import('../../../reasoningbank/reasoningbank-adapter.js');\r\n\r\n              // Set the database path for ReasoningBank\r\n              process.env.CLAUDE_FLOW_DB_PATH = dbPath;\r\n\r\n              console.log('  üß† Initializing ReasoningBank schema...');\r\n              await initializeReasoningBank();\r\n              printSuccess('  ‚úì ReasoningBank schema initialized (use --reasoningbank flag for AI-powered memory)');\r\n            } catch (rbErr) {\r\n              console.log(`  ‚ö†Ô∏è  ReasoningBank initialization failed: ${rbErr.message}`);\r\n              console.log('     Basic memory will work, use: memory init --reasoningbank to retry');\r\n            }\r\n          }\r\n        }\r\n\r\n        memoryStore.close();\r\n      } catch (err) {\r\n        console.log(`  ‚ö†Ô∏è  Could not initialize memory system: ${err.message}`);\r\n        console.log('     Memory will be initialized on first use');\r\n      }\r\n\r\n      // Initialize comprehensive hive-mind system\r\n      console.log('\\nüß† Initializing Hive Mind System...');\r\n      try {\r\n        const hiveMindOptions = {\r\n          config: {\r\n            integration: {\r\n              claudeCode: { enabled: isClaudeCodeInstalled() },\r\n              mcpTools: { enabled: true }\r\n            },\r\n            monitoring: { enabled: flags.monitoring || false }\r\n          }\r\n        };\r\n        \r\n        const hiveMindResult = await initializeHiveMind(workingDir, hiveMindOptions, dryRun);\r\n        \r\n        if (hiveMindResult.success) {\r\n          printSuccess(`‚úì Hive Mind System initialized with ${hiveMindResult.features.length} features`);\r\n          \r\n          // Log individual features\r\n          hiveMindResult.features.forEach(feature => {\r\n            console.log(`    ‚Ä¢ ${feature}`);\r\n          });\r\n        } else {\r\n          console.log(`  ‚ö†Ô∏è  Hive Mind initialization failed: ${hiveMindResult.error}`);\r\n          if (hiveMindResult.rollbackRequired) {\r\n            console.log('  üîÑ Automatic rollback may be required');\r\n          }\r\n        }\r\n      } catch (err) {\r\n        console.log(`  ‚ö†Ô∏è  Could not initialize hive-mind system: ${err.message}`);\r\n      }\r\n    }\r\n\r\n    // Update .gitignore with Claude Flow entries\r\n    const gitignoreResult = await updateGitignore(workingDir, force, dryRun);\r\n    if (gitignoreResult.success) {\r\n      if (!dryRun) {\r\n        printSuccess(`‚úì ${gitignoreResult.message}`);\r\n      } else {\r\n        console.log(gitignoreResult.message);\r\n      }\r\n    } else {\r\n      console.log(`  ‚ö†Ô∏è  ${gitignoreResult.message}`);\r\n    }\r\n\r\n    // SPARC initialization (only with --roo flag)\r\n    let sparcInitialized = false;\r\n    if (initSparc) {\r\n      console.log('\\nüöÄ Initializing SPARC development environment...');\r\n      try {\r\n        // Run create-sparc\r\n        console.log('  üîÑ Running: npx -y create-sparc init --force');\r\n        execSync('npx -y create-sparc init --force', {\r\n          cwd: workingDir,\r\n          stdio: 'inherit',\r\n        });\r\n        sparcInitialized = true;\r\n        printSuccess('‚úÖ SPARC environment initialized successfully');\r\n      } catch (err) {\r\n        console.log(`  ‚ö†Ô∏è  Could not run create-sparc: ${err.message}`);\r\n        console.log('     SPARC features will be limited to basic functionality');\r\n      }\r\n    }\r\n\r\n    // Create Claude slash commands for SPARC\r\n    if (sparcInitialized && !dryRun) {\r\n      console.log('\\nüìù Creating Claude Code slash commands...');\r\n      await createClaudeSlashCommands(workingDir);\r\n    }\r\n\r\n    // Check for Claude Code and set up MCP servers (always enabled by default)\r\n    if (!dryRun && isClaudeCodeInstalled()) {\r\n      console.log('\\nüîç Claude Code CLI detected!');\r\n      const skipMcp =\r\n        (options && options['skip-mcp']) ||\r\n        (subArgs && subArgs.includes && subArgs.includes('--skip-mcp'));\r\n\r\n      if (!skipMcp) {\r\n        await setupMcpServers(dryRun);\r\n      } else {\r\n        console.log('  ‚ÑπÔ∏è  Skipping MCP setup (--skip-mcp flag used)');\r\n        console.log('\\n  üìã To add MCP servers manually:');\r\n        console.log('     claude mcp add claude-flow npx claude-flow@alpha mcp start');\r\n        console.log('     claude mcp add ruv-swarm npx ruv-swarm@latest mcp start');\r\n        console.log('     claude mcp add flow-nexus npx flow-nexus@latest mcp start');\r\n        console.log('\\n  üí° MCP servers are defined in .mcp.json (project scope)');\r\n      }\r\n    } else if (!dryRun && !isClaudeCodeInstalled()) {\r\n      console.log('\\n‚ö†Ô∏è  Claude Code CLI not detected!');\r\n      console.log('\\n  üì• To install Claude Code:');\r\n      console.log('     npm install -g @anthropic-ai/claude-code');\r\n      console.log('\\n  üìã After installing, add MCP servers:');\r\n      console.log('     claude mcp add claude-flow@alpha npx claude-flow@alpha mcp start');\r\n      console.log('     claude mcp add ruv-swarm npx ruv-swarm@latest mcp start');\r\n      console.log('     claude mcp add flow-nexus npx flow-nexus@latest mcp start');\r\n      console.log('\\n  üí° MCP servers are defined in .mcp.json (project scope)');\r\n    }\r\n\r\n    // Create agent directories and copy all agent files\r\n    console.log('\\nü§ñ Setting up agent system...');\r\n    if (!dryRun) {\r\n      await createAgentDirectories(workingDir, dryRun);\r\n      const agentResult = await copyAgentFiles(workingDir, {\r\n        force: force,\r\n        dryRun: dryRun\r\n      });\r\n\r\n      if (agentResult.success) {\r\n        await validateAgentSystem(workingDir);\r\n\r\n        // Copy command files including Flow Nexus commands\r\n        console.log('\\nüìö Setting up command system...');\r\n        const commandResult = await copyCommandFiles(workingDir, {\r\n          force: force,\r\n          dryRun: dryRun\r\n        });\r\n\r\n        if (commandResult.success) {\r\n          console.log('‚úÖ ‚úì Command system setup complete with Flow Nexus integration');\r\n        } else {\r\n          console.log('‚ö†Ô∏è  Command system setup failed:', commandResult.error);\r\n        }\r\n\r\n        // Copy skill files including skill-builder\r\n        console.log('\\nüéØ Setting up skill system...');\r\n        const skillResult = await copySkillFiles(workingDir, {\r\n          force: force,\r\n          dryRun: dryRun\r\n        });\r\n\r\n        if (skillResult.success) {\r\n          await validateSkillSystem(workingDir);\r\n          console.log('‚úÖ ‚úì Skill system setup complete with skill-builder');\r\n        } else {\r\n          console.log('‚ö†Ô∏è  Skill system setup failed:', skillResult.error);\r\n        }\r\n\r\n        console.log('‚úÖ ‚úì Agent system setup complete with 64 specialized agents');\r\n      } else {\r\n        console.log('‚ö†Ô∏è  Agent system setup failed:', agentResult.error);\r\n      }\r\n\r\n      // Setup reasoning agents if --agent reasoning flag is used\r\n      if (initReasoning) {\r\n        console.log('\\nüß† Setting up reasoning agents with ReasoningBank integration...');\r\n        try {\r\n          const reasoningAgentsDir = `${workingDir}/.claude/agents/reasoning`;\r\n          await fs.mkdir(reasoningAgentsDir, { recursive: true });\r\n\r\n          // Import path module\r\n          const path = await import('path');\r\n          const { fileURLToPath } = await import('url');\r\n          const { dirname, join } = path.default;\r\n\r\n          // Get the source reasoning agents directory\r\n          const __filename = fileURLToPath(import.meta.url);\r\n          const __dirname = dirname(__filename);\r\n          const sourceReasoningDir = join(__dirname, '../../../../.claude/agents/reasoning');\r\n\r\n          // Copy reasoning agent files\r\n          try {\r\n            const reasoningFiles = await fs.readdir(sourceReasoningDir);\r\n            let copiedReasoningAgents = 0;\r\n\r\n            for (const file of reasoningFiles) {\r\n              if (file.endsWith('.md')) {\r\n                const sourcePath = join(sourceReasoningDir, file);\r\n                const destPath = join(reasoningAgentsDir, file);\r\n                const content = await fs.readFile(sourcePath, 'utf8');\r\n                await fs.writeFile(destPath, content);\r\n                copiedReasoningAgents++;\r\n              }\r\n            }\r\n\r\n            printSuccess(`‚úì Copied ${copiedReasoningAgents} reasoning agent files`);\r\n            console.log('  üìö Reasoning agents available:');\r\n            console.log('    ‚Ä¢ goal-planner - Goal-Oriented Action Planning specialist');\r\n            console.log('    ‚Ä¢ sublinear-goal-planner - Sub-linear complexity goal planning');\r\n            console.log('  üí° Use: npx agentic-flow --agent goal-planner --task \"your task\"');\r\n            console.log('  üìñ Documentation: .claude/agents/reasoning/README.md');\r\n          } catch (err) {\r\n            console.log(`  ‚ö†Ô∏è  Could not copy reasoning agents: ${err.message}`);\r\n            console.log('     Reasoning agents may not be available yet');\r\n          }\r\n        } catch (err) {\r\n          console.log(`  ‚ö†Ô∏è  Reasoning agent setup failed: ${err.message}`);\r\n        }\r\n      }\r\n    } else {\r\n      console.log('  [DRY RUN] Would create agent system with 64 specialized agents');\r\n      if (initReasoning) {\r\n        console.log('  [DRY RUN] Would also setup reasoning agents with ReasoningBank integration');\r\n      }\r\n    }\r\n\r\n    // Optional: Setup monitoring and telemetry\r\n    const enableMonitoring = flags.monitoring || flags['enable-monitoring'];\r\n    if (enableMonitoring && !dryRun) {\r\n      console.log('\\nüìä Setting up monitoring and telemetry...');\r\n      await setupMonitoring(workingDir);\r\n    }\r\n    \r\n    // Final instructions with hive-mind status\r\n    console.log('\\nüéâ Claude Flow v2.0.0 initialization complete!');\r\n    \r\n    // Display hive-mind status\r\n    const hiveMindStatus = getHiveMindStatus(workingDir);\r\n    console.log('\\nüß† Hive Mind System Status:');\r\n    console.log(`  Configuration: ${hiveMindStatus.configured ? '‚úÖ Ready' : '‚ùå Missing'}`);\r\n    console.log(`  Database: ${hiveMindStatus.database === 'sqlite' ? '‚úÖ SQLite' : hiveMindStatus.database === 'fallback' ? '‚ö†Ô∏è JSON Fallback' : '‚ùå Not initialized'}`);\r\n    console.log(`  Directory Structure: ${hiveMindStatus.directories ? '‚úÖ Created' : '‚ùå Missing'}`);\r\n    \r\n    console.log('\\nüìö Quick Start:');\r\n    if (isClaudeCodeInstalled()) {\r\n      console.log('1. View available commands: ls .claude/commands/');\r\n      console.log('2. Start a swarm: npx claude-flow@alpha swarm \"your objective\" --claude');\r\n      console.log('3. Use hive-mind: npx claude-flow@alpha hive-mind spawn \"command\" --claude');\r\n      console.log('4. Use MCP tools in Claude Code for enhanced coordination');\r\n      if (hiveMindStatus.configured) {\r\n        console.log('5. Initialize first swarm: npx claude-flow@alpha hive-mind init');\r\n      }\r\n    } else {\r\n      console.log('1. Install Claude Code: npm install -g @anthropic-ai/claude-code');\r\n      console.log('2. Add MCP servers (see instructions above)');\r\n      console.log('3. View available commands: ls .claude/commands/');\r\n      console.log('4. Start a swarm: npx claude-flow@alpha swarm \"your objective\" --claude');\r\n      console.log('5. Use hive-mind: npx claude-flow@alpha hive-mind spawn \"command\" --claude');\r\n      if (hiveMindStatus.configured) {\r\n        console.log('6. Initialize first swarm: npx claude-flow@alpha hive-mind init');\r\n      }\r\n    }\r\n    console.log('\\nüí° Tips:');\r\n    console.log('‚Ä¢ Check .claude/commands/ for detailed documentation');\r\n    console.log('‚Ä¢ Use --help with any command for options');\r\n    console.log('‚Ä¢ Run commands with --claude flag for best Claude Code integration');\r\n    console.log('‚Ä¢ Enable GitHub integration with .claude/helpers/github-setup.sh');\r\n    console.log('‚Ä¢ Git checkpoints are automatically enabled in settings.json');\r\n    console.log('‚Ä¢ Use .claude/helpers/checkpoint-manager.sh for easy rollback');\r\n  } catch (err) {\r\n    printError(`Failed to initialize Claude Flow v2.0.0: ${err.message}`);\r\n    \r\n    // Attempt hive-mind rollback if it was partially initialized\r\n    try {\r\n      const hiveMindStatus = getHiveMindStatus(workingDir);\r\n      if (hiveMindStatus.directories || hiveMindStatus.configured) {\r\n        console.log('\\nüîÑ Attempting hive-mind system rollback...');\r\n        const rollbackResult = await rollbackHiveMindInit(workingDir);\r\n        if (rollbackResult.success) {\r\n          console.log('  ‚úÖ Hive-mind rollback completed');\r\n        } else {\r\n          console.log(`  ‚ö†Ô∏è  Hive-mind rollback failed: ${rollbackResult.error}`);\r\n        }\r\n      }\r\n    } catch (rollbackErr) {\r\n      console.log(`  ‚ö†Ô∏è  Rollback error: ${rollbackErr.message}`);\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * Flow Nexus minimal initialization - only creates Flow Nexus CLAUDE.md, commands, and agents\r\n */\r\nasync function flowNexusMinimalInit(flags, subArgs) {\r\n  console.log('üåê Flow Nexus: Initializing minimal setup...');\r\n  \r\n  try {\r\n    const force = flags.force || flags.f;\r\n    \r\n    // Import functions we need\r\n    const { createFlowNexusClaudeMd } = await import('./templates/claude-md.js');\r\n    const { promises: fs } = await import('fs');\r\n    \r\n    // Create Flow Nexus CLAUDE.md\r\n    console.log('üìù Creating Flow Nexus CLAUDE.md...');\r\n    const flowNexusClaudeMd = createFlowNexusClaudeMd();\r\n    await fs.writeFile('CLAUDE.md', flowNexusClaudeMd);\r\n    console.log('  ‚úÖ Created CLAUDE.md with Flow Nexus integration');\r\n    \r\n    // Create .claude/commands/flow-nexus directory and copy commands\r\n    console.log('üìÅ Setting up Flow Nexus commands...');\r\n    await fs.mkdir('.claude/commands/flow-nexus', { recursive: true });\r\n    \r\n    // Copy Flow Nexus command files\r\n    const { fileURLToPath } = await import('url');\r\n    const { dirname, join } = await import('path');\r\n    const __filename = fileURLToPath(import.meta.url);\r\n    const __dirname = dirname(__filename);\r\n    const sourceCommandsDir = join(__dirname, '../../../../.claude/commands/flow-nexus');\r\n    try {\r\n      const commandFiles = await fs.readdir(sourceCommandsDir);\r\n      let copiedCommands = 0;\r\n      \r\n      for (const file of commandFiles) {\r\n        if (file.endsWith('.md')) {\r\n          const sourcePath = `${sourceCommandsDir}/${file}`;\r\n          const destPath = `.claude/commands/flow-nexus/${file}`;\r\n          const content = await fs.readFile(sourcePath, 'utf8');\r\n          await fs.writeFile(destPath, content);\r\n          copiedCommands++;\r\n        }\r\n      }\r\n      \r\n      console.log(`  ‚úÖ Copied ${copiedCommands} Flow Nexus command files`);\r\n    } catch (err) {\r\n      console.log('  ‚ö†Ô∏è  Could not copy Flow Nexus commands:', err.message);\r\n    }\r\n    \r\n    // Create .claude/agents/flow-nexus directory and copy agents\r\n    console.log('ü§ñ Setting up Flow Nexus agents...');\r\n    await fs.mkdir('.claude/agents/flow-nexus', { recursive: true });\r\n    \r\n    // Copy Flow Nexus agent files\r\n    const sourceAgentsDir = join(__dirname, '../../../../.claude/agents/flow-nexus');\r\n    try {\r\n      const agentFiles = await fs.readdir(sourceAgentsDir);\r\n      let copiedAgents = 0;\r\n      \r\n      for (const file of agentFiles) {\r\n        if (file.endsWith('.md')) {\r\n          const sourcePath = `${sourceAgentsDir}/${file}`;\r\n          const destPath = `.claude/agents/flow-nexus/${file}`;\r\n          const content = await fs.readFile(sourcePath, 'utf8');\r\n          await fs.writeFile(destPath, content);\r\n          copiedAgents++;\r\n        }\r\n      }\r\n      \r\n      console.log(`  ‚úÖ Copied ${copiedAgents} Flow Nexus agent files`);\r\n    } catch (err) {\r\n      console.log('  ‚ö†Ô∏è  Could not copy Flow Nexus agents:', err.message);\r\n    }\r\n    \r\n    console.log('\\nüéâ Flow Nexus minimal initialization complete!');\r\n    console.log('üìö Created: CLAUDE.md with Flow Nexus documentation');\r\n    console.log('üìÅ Created: .claude/commands/flow-nexus/ directory with command documentation');\r\n    console.log('ü§ñ Created: .claude/agents/flow-nexus/ directory with specialized agents');\r\n    console.log('');\r\n    console.log('üí° Quick Start:');\r\n    console.log('  1. Register: mcp__flow-nexus__user_register({ email, password })');\r\n    console.log('  2. Login: mcp__flow-nexus__user_login({ email, password })');\r\n    console.log('  3. Deploy: mcp__flow-nexus__swarm_init({ topology: \"mesh\", maxAgents: 5 })');\r\n    console.log('');\r\n    console.log('üîó Use Flow Nexus MCP tools in Claude Code for full functionality');\r\n    \r\n  } catch (err) {\r\n    console.log(`‚ùå Flow Nexus initialization failed: ${err.message}`);\r\n    console.log('Stack trace:', err.stack);\r\n    process.exit(1);\r\n  }\r\n}\r\n"],"names":["printSuccess","printError","printWarning","existsSync","process","spawn","execSync","runCommand","command","args","options","Promise","resolve","reject","child","cwd","env","stdio","stdout","stderr","on","data","code","success","Error","createLocalExecutable","createSparcStructureManually","createClaudeSlashCommands","createOptimizedClaudeSlashCommands","promises","fs","copyTemplates","copyRevisedTemplates","validateTemplatesExist","copyAgentFiles","createAgentDirectories","validateAgentSystem","copyCommandFiles","copySkillFiles","validateSkillSystem","showInitHelp","batchInitCommand","batchInitFromConfig","validateBatchOptions","ValidationSystem","runFullValidation","RollbackSystem","createAtomicOperation","createEnhancedSettingsJson","createCommandDoc","createHelperScript","COMMAND_STRUCTURE","createOptimizedSparcClaudeMd","getIsolatedNpxEnv","updateGitignore","createFullClaudeMd","createSparcClaudeMd","createMinimalClaudeMd","createFullMemoryBankMd","createMinimalMemoryBankMd","createFullCoordinationMd","createMinimalCoordinationMd","createAgentsReadme","createSessionsReadme","initializeHiveMind","getHiveMindStatus","rollbackHiveMindInit","isClaudeCodeInstalled","setupMcpServers","dryRun","console","log","servers","name","description","server","err","message","createStatuslineScript","initCommand","subArgs","flags","help","h","includes","generateEnvTemplate","workingDir","PWD","force","f","result","created","exists","hasVerificationFlags","verify","pair","flowNexusMinimalInit","basic","minimal","sparc","enhancedClaudeFlowInit","handleValidationCommand","handleRollbackCommand","handleListBackups","batchInitFlag","configFlag","config","handleBatchInit","useEnhanced","enhancedInitCommand","initForce","initMinimal","initSparc","roo","initDryRun","initOptimized","selectedModes","modes","split","initVerify","initPair","chdir","files","existingFiles","file","stat","push","length","join","templateOptions","optimized","createVerificationClaudeMd","createVerificationSettingsJson","writeFile","mkdir","recursive","validation","valid","revisedResults","verbose","copyResults","skipClaudeMd","skipSettings","copiedFiles","skippedFiles","errors","forEach","sparcInitialized","createSparcResult","modeCount","gitignoreResult","hiveMindOptions","integration","claudeCode","enabled","mcpTools","monitoring","hiveMindResult","error","skipMcp","parallel","s","m","maxConcurrency","progressTracking","template","environments","map","trim","validationErrors","configFile","results","projectsString","projects","project","successful","filter","r","failed","rollbackSystem","validationSystem","atomicOp","initOptions","skipPreValidation","skipBackup","validateOnly","preValidation","validatePreInit","warnings","warning","warn","backupResult","createPreInitBackup","atomicBegin","begin","performInitializationWithCheckpoints","postValidation","validatePostInit","rollback","configValidation","validateConfiguration","healthChecks","runHealthChecks","commit","fullValidation","postInit","skipPreInit","report","completed","rollbackError","skipConfig","skipModeTest","validationResults","exit","performFullRollback","phaseIndex","findIndex","arg","phase","performPartialRollback","rollbackPoints","listRollbackPoints","point","index","date","Date","timestamp","toLocaleString","type","latest","backupId","checkpoints","slice","checkpoint","status","phases","action","createInitialFiles","createDirectoryStructure","setupMemorySystem","setupCoordinationSystem","createCheckpoint","now","claudeMd","memoryBankMd","coordinationMd","directories","dir","initialData","agents","tasks","lastUpdated","JSON","stringify","setupMonitoring","path","trackingDir","tokenUsageFile","total","input","output","byAgent","toISOString","settingsPath","settingsContent","readFile","settings","parse","hooks","tokenTrackingHook","monitoringConfig","telemetry","value","tracking","tokens","costs","sessions","storage","location","format","rotation","configPath","envSnippet","envPath","d","agentType","agent","find","startsWith","initReasoning","chmod","os","filesToCheck","claudeDir","statuslineTemplate","__dirname","homeClaudeDir","homedir","settingsLocal","permissions","allow","deny","mcpConfig","mcpServers","category","commands","Object","entries","categoryDir","categoryReadme","charAt","toUpperCase","cmd","doc","helpers","helper","content","standardDirs","dbPath","dbExistedBefore","initializeReasoningBank","checkReasoningBankTables","migrateReasoningBank","CLAUDE_FLOW_DB_PATH","tableCheck","missingTables","migrationResult","addedTables","rbErr","FallbackMemoryStore","memoryStore","initialize","isUsingFallback","close","features","feature","rollbackRequired","agentResult","commandResult","skillResult","reasoningAgentsDir","fileURLToPath","dirname","default","__filename","url","sourceReasoningDir","reasoningFiles","readdir","copiedReasoningAgents","endsWith","sourcePath","destPath","enableMonitoring","hiveMindStatus","configured","database","rollbackResult","rollbackErr","createFlowNexusClaudeMd","flowNexusClaudeMd","sourceCommandsDir","commandFiles","copiedCommands","sourceAgentsDir","agentFiles","copiedAgents","stack"],"mappings":"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"}