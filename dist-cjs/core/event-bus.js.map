{
  "version": 3,
  "sources": ["../../src/core/event-bus.ts"],
  "sourcesContent": ["/**\n * Event bus implementation for Claude-Flow\n */\n\nimport { SystemEvents } from '../utils/types.js';\nimport type { EventMap } from '../utils/types.js';\nimport { TypedEventEmitter } from '../utils/helpers.js';\n\nexport interface IEventBus {\n  emit(event: string, data?: unknown): void;\n  on(event: string, handler: (data: unknown) => void): void;\n  off(event: string, handler: (data: unknown) => void): void;\n  once(event: string, handler: (data: unknown) => void): void;\n}\n\n/**\n * Internal typed event bus\n */\nclass TypedEventBus extends TypedEventEmitter<EventMap> {\n  private eventCounts = new Map<keyof EventMap, number>();\n  private lastEventTimes = new Map<keyof EventMap, number>();\n  private debug: boolean;\n\n  constructor(debug = false) {\n    super();\n    this.debug = debug;\n  }\n\n  /**\n   * Emits an event with logging\n   */\n  override emit<K extends keyof EventMap>(event: K, data: EventMap[K]): void {\n    if (this.debug) {\n      console.debug(`[EventBus] Emitting event: ${String(event)}`, data);\n    }\n\n    // Track event metrics\n    const count = this.eventCounts.get(event) || 0;\n    this.eventCounts.set(event, count + 1);\n    this.lastEventTimes.set(event, Date.now());\n\n    super.emit(event, data);\n  }\n\n  /**\n   * Get event statistics\n   */\n  getEventStats(): { event: string; count: number; lastEmitted: Date | null }[] {\n    const stats: { event: string; count: number; lastEmitted: Date | null }[] = [];\n\n    for (const [event, count] of this.eventCounts.entries()) {\n      const lastTime = this.lastEventTimes.get(event);\n      stats.push({\n        event: String(event),\n        count,\n        lastEmitted: lastTime ? new Date(lastTime) : null,\n      });\n    }\n\n    return stats.sort((a, b) => b.count - a.count);\n  }\n\n  /**\n   * Reset event statistics\n   */\n  resetStats(): void {\n    this.eventCounts.clear();\n    this.lastEventTimes.clear();\n  }\n}\n\n/**\n * Global event bus for system-wide communication\n */\nexport class EventBus implements IEventBus {\n  private static instance: EventBus;\n  private typedBus: TypedEventBus;\n\n  private constructor(debug = false) {\n    this.typedBus = new TypedEventBus(debug);\n  }\n\n  /**\n   * Gets the singleton instance of the event bus\n   */\n  static getInstance(debug = false): EventBus {\n    if (!EventBus.instance) {\n      EventBus.instance = new EventBus(debug);\n    }\n    return EventBus.instance;\n  }\n\n  /**\n   * Emits an event\n   */\n  emit(event: string, data?: unknown): void {\n    // Type-safe emission for known events\n    if (event in SystemEvents) {\n      this.typedBus.emit(event as keyof EventMap, data as any);\n    } else {\n      // For custom events, emit as-is\n      this.typedBus.emit(event as any, data as any);\n    }\n  }\n\n  /**\n   * Registers an event handler\n   */\n  on(event: string, handler: (data: unknown) => void): void {\n    this.typedBus.on(event as any, handler);\n  }\n\n  /**\n   * Removes an event handler\n   */\n  off(event: string, handler: (data: unknown) => void): void {\n    this.typedBus.off(event as any, handler);\n  }\n\n  /**\n   * Registers a one-time event handler\n   */\n  once(event: string, handler: (data: unknown) => void): void {\n    this.typedBus.once(event as any, handler);\n  }\n\n  /**\n   * Waits for an event to occur\n   */\n  async waitFor(event: string, timeoutMs?: number): Promise<unknown> {\n    return new Promise((resolve, reject) => {\n      const handler = (data: unknown) => {\n        if (timer) clearTimeout(timer);\n        resolve(data);\n      };\n\n      let timer: number | undefined;\n      if (timeoutMs) {\n        timer = setTimeout(() => {\n          this.off(event, handler);\n          reject(new Error(`Timeout waiting for event: ${event}`));\n        }, timeoutMs);\n      }\n\n      this.once(event, handler);\n    });\n  }\n\n  /**\n   * Creates a filtered event listener\n   */\n  onFiltered(\n    event: string,\n    filter: (data: unknown) => boolean,\n    handler: (data: unknown) => void,\n  ): void {\n    this.on(event, (data) => {\n      if (filter(data)) {\n        handler(data);\n      }\n    });\n  }\n\n  /**\n   * Get event statistics\n   */\n  getEventStats(): { event: string; count: number; lastEmitted: Date | null }[] {\n    return this.typedBus.getEventStats();\n  }\n\n  /**\n   * Reset event statistics\n   */\n  resetStats(): void {\n    this.typedBus.resetStats();\n  }\n\n  /**\n   * Remove all listeners for an event\n   */\n  removeAllListeners(event?: string): void {\n    this.typedBus.removeAllListeners(event as any);\n  }\n}\n\n// Export singleton instance\nexport const eventBus = EventBus.getInstance();\n"],
  "mappings": ";;;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAIA,mBAA6B;AAE7B,qBAAkC;AAYlC,MAAM,sBAAsB,iCAA4B;AAAA,EAlBxD,OAkBwD;AAAA;AAAA;AAAA,EAC9C,cAAc,oBAAI,IAA4B;AAAA,EAC9C,iBAAiB,oBAAI,IAA4B;AAAA,EACjD;AAAA,EAER,YAAY,QAAQ,OAAO;AACzB,UAAM;AACN,SAAK,QAAQ;AAAA,EACf;AAAA;AAAA;AAAA;AAAA,EAKS,KAA+B,OAAU,MAAyB;AACzE,QAAI,KAAK,OAAO;AACd,cAAQ,MAAM,8BAA8B,OAAO,KAAK,CAAC,IAAI,IAAI;AAAA,IACnE;AAGA,UAAM,QAAQ,KAAK,YAAY,IAAI,KAAK,KAAK;AAC7C,SAAK,YAAY,IAAI,OAAO,QAAQ,CAAC;AACrC,SAAK,eAAe,IAAI,OAAO,KAAK,IAAI,CAAC;AAEzC,UAAM,KAAK,OAAO,IAAI;AAAA,EACxB;AAAA;AAAA;AAAA;AAAA,EAKA,gBAA8E;AAC5E,UAAM,QAAsE,CAAC;AAE7E,eAAW,CAAC,OAAO,KAAK,KAAK,KAAK,YAAY,QAAQ,GAAG;AACvD,YAAM,WAAW,KAAK,eAAe,IAAI,KAAK;AAC9C,YAAM,KAAK;AAAA,QACT,OAAO,OAAO,KAAK;AAAA,QACnB;AAAA,QACA,aAAa,WAAW,IAAI,KAAK,QAAQ,IAAI;AAAA,MAC/C,CAAC;AAAA,IACH;AAEA,WAAO,MAAM,KAAK,CAAC,GAAG,MAAM,EAAE,QAAQ,EAAE,KAAK;AAAA,EAC/C;AAAA;AAAA;AAAA;AAAA,EAKA,aAAmB;AACjB,SAAK,YAAY,MAAM;AACvB,SAAK,eAAe,MAAM;AAAA,EAC5B;AACF;AAKO,MAAM,SAA8B;AAAA,EA1E3C,OA0E2C;AAAA;AAAA;AAAA,EACzC,OAAe;AAAA,EACP;AAAA,EAEA,YAAY,QAAQ,OAAO;AACjC,SAAK,WAAW,IAAI,cAAc,KAAK;AAAA,EACzC;AAAA;AAAA;AAAA;AAAA,EAKA,OAAO,YAAY,QAAQ,OAAiB;AAC1C,QAAI,CAAC,SAAS,UAAU;AACtB,eAAS,WAAW,IAAI,SAAS,KAAK;AAAA,IACxC;AACA,WAAO,SAAS;AAAA,EAClB;AAAA;AAAA;AAAA;AAAA,EAKA,KAAK,OAAe,MAAsB;AAExC,QAAI,SAAS,2BAAc;AACzB,WAAK,SAAS,KAAK,OAAyB,IAAW;AAAA,IACzD,OAAO;AAEL,WAAK,SAAS,KAAK,OAAc,IAAW;AAAA,IAC9C;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,GAAG,OAAe,SAAwC;AACxD,SAAK,SAAS,GAAG,OAAc,OAAO;AAAA,EACxC;AAAA;AAAA;AAAA;AAAA,EAKA,IAAI,OAAe,SAAwC;AACzD,SAAK,SAAS,IAAI,OAAc,OAAO;AAAA,EACzC;AAAA;AAAA;AAAA;AAAA,EAKA,KAAK,OAAe,SAAwC;AAC1D,SAAK,SAAS,KAAK,OAAc,OAAO;AAAA,EAC1C;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,QAAQ,OAAe,WAAsC;AACjE,WAAO,IAAI,QAAQ,CAAC,SAAS,WAAW;AACtC,YAAM,UAAU,wBAAC,SAAkB;AACjC,YAAI;AAAO,uBAAa,KAAK;AAC7B,gBAAQ,IAAI;AAAA,MACd,GAHgB;AAKhB,UAAI;AACJ,UAAI,WAAW;AACb,gBAAQ,WAAW,MAAM;AACvB,eAAK,IAAI,OAAO,OAAO;AACvB,iBAAO,IAAI,MAAM,8BAA8B,KAAK,EAAE,CAAC;AAAA,QACzD,GAAG,SAAS;AAAA,MACd;AAEA,WAAK,KAAK,OAAO,OAAO;AAAA,IAC1B,CAAC;AAAA,EACH;AAAA;AAAA;AAAA;AAAA,EAKA,WACE,OACA,QACA,SACM;AACN,SAAK,GAAG,OAAO,CAAC,SAAS;AACvB,UAAI,OAAO,IAAI,GAAG;AAChB,gBAAQ,IAAI;AAAA,MACd;AAAA,IACF,CAAC;AAAA,EACH;AAAA;AAAA;AAAA;AAAA,EAKA,gBAA8E;AAC5E,WAAO,KAAK,SAAS,cAAc;AAAA,EACrC;AAAA;AAAA;AAAA;AAAA,EAKA,aAAmB;AACjB,SAAK,SAAS,WAAW;AAAA,EAC3B;AAAA;AAAA;AAAA;AAAA,EAKA,mBAAmB,OAAsB;AACvC,SAAK,SAAS,mBAAmB,KAAY;AAAA,EAC/C;AACF;AAGO,MAAM,WAAW,SAAS,YAAY;",
  "names": []
}
