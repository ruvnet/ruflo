{"version":3,"sources":["../../../../../src/mcp/tools/system/status.ts"],"sourcesContent":["/**\r\n * System Status Tool\r\n *\r\n * Returns comprehensive system status including:\r\n * - Uptime and version information\r\n * - Active agents and tasks\r\n * - Memory usage\r\n * - Performance metrics\r\n */\r\n\r\nimport type { MCPTool, ClaudeFlowToolContext } from '../../types.js';\r\nimport type { ILogger } from '../../../interfaces/logger.js';\r\n\r\ninterface SystemStatusInput {\r\n  includeMetrics?: boolean;\r\n  includeAgents?: boolean;\r\n  includeTasks?: boolean;\r\n}\r\n\r\ninterface SystemStatusResult {\r\n  success: boolean;\r\n  status: 'healthy' | 'degraded' | 'unhealthy';\r\n  uptime: number;\r\n  version: string;\r\n  timestamp: string;\r\n  agents?: {\r\n    total: number;\r\n    active: number;\r\n    idle: number;\r\n  };\r\n  tasks?: {\r\n    total: number;\r\n    running: number;\r\n    completed: number;\r\n    failed: number;\r\n  };\r\n  metrics?: {\r\n    memoryUsage: number;\r\n    cpuUsage: number;\r\n    avgResponseTime: number;\r\n  };\r\n}\r\n\r\nexport function createSystemStatusTool(logger: ILogger): MCPTool {\r\n  return {\r\n    name: 'system/status',\r\n    description: 'Get comprehensive system status including uptime, active agents, tasks, and performance metrics. Use this to check system health.',\r\n\r\n    inputSchema: {\r\n      type: 'object',\r\n      properties: {\r\n        includeMetrics: {\r\n          type: 'boolean',\r\n          description: 'Include performance metrics',\r\n          default: false,\r\n        },\r\n        includeAgents: {\r\n          type: 'boolean',\r\n          description: 'Include agent statistics',\r\n          default: true,\r\n        },\r\n        includeTasks: {\r\n          type: 'boolean',\r\n          description: 'Include task statistics',\r\n          default: true,\r\n        },\r\n      },\r\n      required: [],\r\n    },\r\n\r\n    metadata: {\r\n      category: 'system',\r\n      tags: ['status', 'health', 'monitoring', 'metrics'],\r\n      examples: [\r\n        {\r\n          description: 'Get basic system status',\r\n          input: {},\r\n          expectedOutput: {\r\n            success: true,\r\n            status: 'healthy',\r\n            uptime: 3600000,\r\n            version: '2.7.32',\r\n          },\r\n        },\r\n        {\r\n          description: 'Get full system status with metrics',\r\n          input: {\r\n            includeMetrics: true,\r\n            includeAgents: true,\r\n            includeTasks: true,\r\n          },\r\n          expectedOutput: {\r\n            success: true,\r\n            status: 'healthy',\r\n            agents: { total: 5, active: 3, idle: 2 },\r\n            tasks: { total: 20, running: 5, completed: 12, failed: 3 },\r\n            metrics: { memoryUsage: 250, cpuUsage: 45, avgResponseTime: 150 },\r\n          },\r\n        },\r\n      ],\r\n      detailLevel: 'standard',\r\n    },\r\n\r\n    handler: async (\r\n      input: any,\r\n      context?: ClaudeFlowToolContext\r\n    ): Promise<SystemStatusResult> => {\r\n      if (!context?.orchestrator) {\r\n        throw new Error('Orchestrator not available in tool context');\r\n      }\r\n\r\n      const validatedInput = input as SystemStatusInput;\r\n\r\n      logger.info('system/status invoked', {\r\n        input: validatedInput,\r\n        sessionId: context.sessionId,\r\n      });\r\n\r\n      try {\r\n        // Get base status\r\n        const result: SystemStatusResult = {\r\n          success: true,\r\n          status: 'healthy',\r\n          uptime: process.uptime() * 1000, // Convert to milliseconds\r\n          version: process.env.npm_package_version || '2.7.32',\r\n          timestamp: new Date().toISOString(),\r\n        };\r\n\r\n        // Get agent statistics if requested\r\n        if (validatedInput.includeAgents !== false) {\r\n          try {\r\n            const agentStats = await context.orchestrator.getAgentStats?.();\r\n            if (agentStats) {\r\n              result.agents = {\r\n                total: agentStats.total || 0,\r\n                active: agentStats.active || 0,\r\n                idle: agentStats.idle || 0,\r\n              };\r\n            }\r\n          } catch (error) {\r\n            logger.warn('Failed to get agent statistics', { error });\r\n          }\r\n        }\r\n\r\n        // Get task statistics if requested\r\n        if (validatedInput.includeTasks !== false) {\r\n          try {\r\n            const taskStats = await context.orchestrator.getTaskStats?.();\r\n            if (taskStats) {\r\n              result.tasks = {\r\n                total: taskStats.total || 0,\r\n                running: taskStats.running || 0,\r\n                completed: taskStats.completed || 0,\r\n                failed: taskStats.failed || 0,\r\n              };\r\n            }\r\n          } catch (error) {\r\n            logger.warn('Failed to get task statistics', { error });\r\n          }\r\n        }\r\n\r\n        // Get performance metrics if requested\r\n        if (validatedInput.includeMetrics) {\r\n          try {\r\n            const memUsage = process.memoryUsage();\r\n            result.metrics = {\r\n              memoryUsage: Math.round(memUsage.heapUsed / 1024 / 1024), // MB\r\n              cpuUsage: Math.round(process.cpuUsage().user / 1000), // Approximate %\r\n              avgResponseTime: 0, // TODO: Get from metrics store\r\n            };\r\n          } catch (error) {\r\n            logger.warn('Failed to get performance metrics', { error });\r\n          }\r\n        }\r\n\r\n        // Determine overall health status\r\n        if (result.agents && result.agents.active === 0 && result.agents.total > 0) {\r\n          result.status = 'degraded';\r\n        }\r\n        if (result.tasks && result.tasks.failed > result.tasks.completed / 2) {\r\n          result.status = 'unhealthy';\r\n        }\r\n\r\n        logger.info('system/status completed successfully', {\r\n          status: result.status,\r\n          uptime: result.uptime,\r\n        });\r\n\r\n        return result;\r\n      } catch (error) {\r\n        logger.error('system/status failed', {\r\n          error,\r\n          input: validatedInput,\r\n        });\r\n        throw error;\r\n      }\r\n    },\r\n  };\r\n}\r\n\r\nexport const toolMetadata = {\r\n  name: 'system/status',\r\n  description: 'Get system health status and metrics',\r\n  category: 'system',\r\n  detailLevel: 'standard' as const,\r\n};\r\n"],"names":["createSystemStatusTool","logger","name","description","inputSchema","type","properties","includeMetrics","default","includeAgents","includeTasks","required","metadata","category","tags","examples","input","expectedOutput","success","status","uptime","version","agents","total","active","idle","tasks","running","completed","failed","metrics","memoryUsage","cpuUsage","avgResponseTime","detailLevel","handler","context","orchestrator","Error","validatedInput","info","sessionId","result","process","env","npm_package_version","timestamp","Date","toISOString","agentStats","getAgentStats","error","warn","taskStats","getTaskStats","memUsage","Math","round","heapUsed","user","toolMetadata"],"mappings":"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"}