{"version":3,"sources":["../../../src/swarm/hive-mind-integration.ts"],"sourcesContent":["/**\r\n * Hive-Mind System Integration Interface\r\n * \r\n * This module provides seamless integration with the existing hive-mind system,\r\n * enabling swarms to leverage collective intelligence, shared memory, and\r\n * distributed coordination capabilities while maintaining compatibility\r\n * with the current claude-flow architecture.\r\n */\r\n\r\nimport { EventEmitter } from 'node:events';\r\nimport { Logger } from '../core/logger.js';\r\nimport { generateId } from '../utils/helpers.js';\r\nimport { MemoryManager } from '../memory/manager.js';\r\nimport type { AdvancedSwarmOrchestrator } from './advanced-orchestrator.js';\r\nimport {\r\n  SwarmExecutionContext,\r\n  SwarmAgent,\r\n  SwarmTask,\r\n  TaskResult,\r\n  SwarmObjective,\r\n  AgentState,\r\n  SwarmMetrics,\r\n} from './types.js';\r\n\r\nexport interface HiveMindConfig {\r\n  enableSharedIntelligence: boolean;\r\n  enableCollectiveMemory: boolean;\r\n  enableDistributedLearning: boolean;\r\n  enableKnowledgeSharing: boolean;\r\n  hiveMindEndpoint?: string;\r\n  syncInterval: number;\r\n  maxSharedMemorySize: number;\r\n  intelligencePoolSize: number;\r\n  learningRate: number;\r\n  knowledgeRetentionPeriod: number;\r\n}\r\n\r\nexport interface HiveMindSession {\r\n  id: string;\r\n  swarmId: string;\r\n  participants: string[];\r\n  sharedMemory: Map<string, any>;\r\n  collectiveIntelligence: CollectiveIntelligence;\r\n  knowledgeBase: KnowledgeBase;\r\n  distributedLearning: DistributedLearning;\r\n  status: 'active' | 'paused' | 'terminated';\r\n  startTime: Date;\r\n  lastSync: Date;\r\n}\r\n\r\nexport interface CollectiveIntelligence {\r\n  patterns: Map<string, Pattern>;\r\n  insights: Map<string, Insight>;\r\n  decisions: Map<string, CollectiveDecision>;\r\n  predictions: Map<string, Prediction>;\r\n}\r\n\r\nexport interface Pattern {\r\n  id: string;\r\n  type: 'behavioral' | 'performance' | 'error' | 'success';\r\n  description: string;\r\n  frequency: number;\r\n  confidence: number;\r\n  contexts: string[];\r\n  impact: 'low' | 'medium' | 'high';\r\n  discoveredBy: string[];\r\n  lastSeen: Date;\r\n}\r\n\r\nexport interface Insight {\r\n  id: string;\r\n  category: 'optimization' | 'coordination' | 'quality' | 'efficiency';\r\n  title: string;\r\n  description: string;\r\n  evidence: any[];\r\n  confidence: number;\r\n  applicability: string[];\r\n  contributingAgents: string[];\r\n  timestamp: Date;\r\n}\r\n\r\nexport interface CollectiveDecision {\r\n  id: string;\r\n  question: string;\r\n  options: DecisionOption[];\r\n  votingResults: Map<string, string>;\r\n  consensus: string;\r\n  confidence: number;\r\n  reasoning: string;\r\n  participants: string[];\r\n  timestamp: Date;\r\n}\r\n\r\nexport interface DecisionOption {\r\n  id: string;\r\n  description: string;\r\n  pros: string[];\r\n  cons: string[];\r\n  risk: 'low' | 'medium' | 'high';\r\n  effort: 'low' | 'medium' | 'high';\r\n  expectedOutcome: string;\r\n}\r\n\r\nexport interface Prediction {\r\n  id: string;\r\n  target: string;\r\n  predicted_value: any;\r\n  confidence: number;\r\n  timeframe: string;\r\n  methodology: string;\r\n  factors: string[];\r\n  accuracy?: number;\r\n  createdBy: string[];\r\n  timestamp: Date;\r\n}\r\n\r\nexport interface KnowledgeBase {\r\n  facts: Map<string, Fact>;\r\n  procedures: Map<string, Procedure>;\r\n  bestPractices: Map<string, BestPractice>;\r\n  lessons: Map<string, Lesson>;\r\n}\r\n\r\nexport interface Fact {\r\n  id: string;\r\n  statement: string;\r\n  category: string;\r\n  confidence: number;\r\n  sources: string[];\r\n  validatedBy: string[];\r\n  contexts: string[];\r\n  timestamp: Date;\r\n}\r\n\r\nexport interface Procedure {\r\n  id: string;\r\n  name: string;\r\n  description: string;\r\n  steps: ProcedureStep[];\r\n  preconditions: string[];\r\n  postconditions: string[];\r\n  successRate: number;\r\n  contexts: string[];\r\n  lastUsed: Date;\r\n}\r\n\r\nexport interface ProcedureStep {\r\n  order: number;\r\n  action: string;\r\n  parameters: Record<string, any>;\r\n  expectedResult: string;\r\n  alternatives: string[];\r\n}\r\n\r\nexport interface BestPractice {\r\n  id: string;\r\n  domain: string;\r\n  practice: string;\r\n  rationale: string;\r\n  benefits: string[];\r\n  applicableContexts: string[];\r\n  effectiveness: number;\r\n  adoptionRate: number;\r\n  validatedBy: string[];\r\n  timestamp: Date;\r\n}\r\n\r\nexport interface Lesson {\r\n  id: string;\r\n  title: string;\r\n  situation: string;\r\n  actions: string[];\r\n  outcome: string;\r\n  learning: string;\r\n  applicability: string[];\r\n  importance: 'low' | 'medium' | 'high' | 'critical';\r\n  learnedBy: string[];\r\n  timestamp: Date;\r\n}\r\n\r\nexport interface DistributedLearning {\r\n  models: Map<string, LearningModel>;\r\n  experiences: Map<string, Experience>;\r\n  adaptations: Map<string, Adaptation>;\r\n  performance: PerformanceTrends;\r\n}\r\n\r\nexport interface LearningModel {\r\n  id: string;\r\n  type: 'neural' | 'statistical' | 'heuristic' | 'ensemble';\r\n  purpose: string;\r\n  parameters: Record<string, any>;\r\n  performance: ModelPerformance;\r\n  trainingData: string[];\r\n  lastUpdated: Date;\r\n  version: string;\r\n}\r\n\r\nexport interface ModelPerformance {\r\n  accuracy: number;\r\n  precision: number;\r\n  recall: number;\r\n  f1Score: number;\r\n  validationResults: any[];\r\n  benchmarkResults: any[];\r\n}\r\n\r\nexport interface Experience {\r\n  id: string;\r\n  context: string;\r\n  situation: string;\r\n  actions: string[];\r\n  results: any[];\r\n  feedback: number;\r\n  tags: string[];\r\n  agentId: string;\r\n  timestamp: Date;\r\n}\r\n\r\nexport interface Adaptation {\r\n  id: string;\r\n  trigger: string;\r\n  change: string;\r\n  reason: string;\r\n  effectiveness: number;\r\n  rollbackPlan: string;\r\n  approvedBy: string[];\r\n  implementedAt: Date;\r\n}\r\n\r\nexport interface PerformanceTrends {\r\n  metrics: Map<string, number[]>;\r\n  improvements: string[];\r\n  degradations: string[];\r\n  stability: number;\r\n  trends: TrendAnalysis[];\r\n}\r\n\r\nexport interface TrendAnalysis {\r\n  metric: string;\r\n  direction: 'increasing' | 'decreasing' | 'stable' | 'volatile';\r\n  magnitude: number;\r\n  confidence: number;\r\n  timeframe: string;\r\n  factors: string[];\r\n}\r\n\r\nexport class HiveMindIntegration extends EventEmitter {\r\n  private logger: Logger;\r\n  private config: HiveMindConfig;\r\n  private memoryManager: MemoryManager;\r\n  private activeSessions: Map<string, HiveMindSession> = new Map();\r\n  private globalKnowledgeBase: KnowledgeBase;\r\n  private globalIntelligence: CollectiveIntelligence;\r\n  private syncInterval?: NodeJS.Timeout;\r\n  private isInitialized: boolean = false;\r\n\r\n  constructor(\r\n    config: Partial<HiveMindConfig> = {},\r\n    memoryManager: MemoryManager\r\n  ) {\r\n    super();\r\n    \r\n    this.logger = new Logger('HiveMindIntegration');\r\n    this.config = this.createDefaultConfig(config);\r\n    this.memoryManager = memoryManager;\r\n    this.globalKnowledgeBase = this.initializeKnowledgeBase();\r\n    this.globalIntelligence = this.initializeCollectiveIntelligence();\r\n\r\n    this.setupEventHandlers();\r\n  }\r\n\r\n  /**\r\n   * Initialize the hive-mind integration\r\n   */\r\n  async initialize(): Promise<void> {\r\n    if (this.isInitialized) {\r\n      this.logger.warn('Hive-mind integration already initialized');\r\n      return;\r\n    }\r\n\r\n    this.logger.info('Initializing hive-mind integration...');\r\n\r\n    try {\r\n      // Load existing knowledge base from memory\r\n      await this.loadKnowledgeBase();\r\n\r\n      // Load collective intelligence data\r\n      await this.loadCollectiveIntelligence();\r\n\r\n      // Start synchronization if enabled\r\n      if (this.config.syncInterval > 0) {\r\n        this.startPeriodicSync();\r\n      }\r\n\r\n      this.isInitialized = true;\r\n      this.logger.info('Hive-mind integration initialized successfully');\r\n      this.emit('initialized');\r\n\r\n    } catch (error) {\r\n      this.logger.error('Failed to initialize hive-mind integration', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Shutdown the integration gracefully\r\n   */\r\n  async shutdown(): Promise<void> {\r\n    if (!this.isInitialized) return;\r\n\r\n    this.logger.info('Shutting down hive-mind integration...');\r\n\r\n    try {\r\n      // Stop synchronization\r\n      if (this.syncInterval) {\r\n        clearInterval(this.syncInterval);\r\n      }\r\n\r\n      // Save current state\r\n      await this.saveKnowledgeBase();\r\n      await this.saveCollectiveIntelligence();\r\n\r\n      // Terminate active sessions\r\n      const terminationPromises = Array.from(this.activeSessions.keys())\r\n        .map(sessionId => this.terminateSession(sessionId));\r\n      \r\n      await Promise.allSettled(terminationPromises);\r\n\r\n      this.isInitialized = false;\r\n      this.logger.info('Hive-mind integration shut down successfully');\r\n      this.emit('shutdown');\r\n\r\n    } catch (error) {\r\n      this.logger.error('Error during hive-mind integration shutdown', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Create a new hive-mind session for a swarm\r\n   */\r\n  async createSession(\r\n    swarmId: string,\r\n    orchestrator: AdvancedSwarmOrchestrator\r\n  ): Promise<string> {\r\n    const sessionId = generateId('hive-session');\r\n    \r\n    this.logger.info('Creating hive-mind session', {\r\n      sessionId,\r\n      swarmId,\r\n    });\r\n\r\n    const session: HiveMindSession = {\r\n      id: sessionId,\r\n      swarmId,\r\n      participants: [],\r\n      sharedMemory: new Map(),\r\n      collectiveIntelligence: this.initializeCollectiveIntelligence(),\r\n      knowledgeBase: this.initializeKnowledgeBase(),\r\n      distributedLearning: this.initializeDistributedLearning(),\r\n      status: 'active',\r\n      startTime: new Date(),\r\n      lastSync: new Date(),\r\n    };\r\n\r\n    this.activeSessions.set(sessionId, session);\r\n\r\n    // Initialize session with global knowledge\r\n    await this.initializeSessionWithGlobalKnowledge(session);\r\n\r\n    this.emit('session:created', {\r\n      sessionId,\r\n      swarmId,\r\n    });\r\n\r\n    return sessionId;\r\n  }\r\n\r\n  /**\r\n   * Add an agent to a hive-mind session\r\n   */\r\n  async addAgentToSession(\r\n    sessionId: string,\r\n    agentId: string,\r\n    agent: SwarmAgent\r\n  ): Promise<void> {\r\n    const session = this.activeSessions.get(sessionId);\r\n    if (!session) {\r\n      throw new Error(`Hive-mind session not found: ${sessionId}`);\r\n    }\r\n\r\n    if (!session.participants.includes(agentId)) {\r\n      session.participants.push(agentId);\r\n      \r\n      this.logger.info('Agent added to hive-mind session', {\r\n        sessionId,\r\n        agentId,\r\n        participantCount: session.participants.length,\r\n      });\r\n\r\n      // Share relevant knowledge with the agent\r\n      await this.shareKnowledgeWithAgent(session, agentId, agent);\r\n\r\n      this.emit('agent:joined', {\r\n        sessionId,\r\n        agentId,\r\n        participantCount: session.participants.length,\r\n      });\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Remove an agent from a hive-mind session\r\n   */\r\n  async removeAgentFromSession(\r\n    sessionId: string,\r\n    agentId: string\r\n  ): Promise<void> {\r\n    const session = this.activeSessions.get(sessionId);\r\n    if (!session) {\r\n      throw new Error(`Hive-mind session not found: ${sessionId}`);\r\n    }\r\n\r\n    const index = session.participants.indexOf(agentId);\r\n    if (index !== -1) {\r\n      session.participants.splice(index, 1);\r\n      \r\n      this.logger.info('Agent removed from hive-mind session', {\r\n        sessionId,\r\n        agentId,\r\n        participantCount: session.participants.length,\r\n      });\r\n\r\n      this.emit('agent:left', {\r\n        sessionId,\r\n        agentId,\r\n        participantCount: session.participants.length,\r\n      });\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Share knowledge or experience with the hive-mind\r\n   */\r\n  async shareWithHive(\r\n    sessionId: string,\r\n    agentId: string,\r\n    type: 'knowledge' | 'experience' | 'insight' | 'pattern',\r\n    data: any\r\n  ): Promise<void> {\r\n    const session = this.activeSessions.get(sessionId);\r\n    if (!session) {\r\n      throw new Error(`Hive-mind session not found: ${sessionId}`);\r\n    }\r\n\r\n    this.logger.debug('Sharing with hive-mind', {\r\n      sessionId,\r\n      agentId,\r\n      type,\r\n    });\r\n\r\n    switch (type) {\r\n      case 'knowledge':\r\n        await this.addKnowledge(session, agentId, data);\r\n        break;\r\n      case 'experience':\r\n        await this.addExperience(session, agentId, data);\r\n        break;\r\n      case 'insight':\r\n        await this.addInsight(session, agentId, data);\r\n        break;\r\n      case 'pattern':\r\n        await this.addPattern(session, agentId, data);\r\n        break;\r\n    }\r\n\r\n    this.emit('knowledge:shared', {\r\n      sessionId,\r\n      agentId,\r\n      type,\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Request collective decision making\r\n   */\r\n  async requestCollectiveDecision(\r\n    sessionId: string,\r\n    question: string,\r\n    options: DecisionOption[],\r\n    requesterAgentId: string\r\n  ): Promise<string> {\r\n    const session = this.activeSessions.get(sessionId);\r\n    if (!session) {\r\n      throw new Error(`Hive-mind session not found: ${sessionId}`);\r\n    }\r\n\r\n    const decisionId = generateId('decision');\r\n    \r\n    this.logger.info('Requesting collective decision', {\r\n      sessionId,\r\n      decisionId,\r\n      question,\r\n      optionCount: options.length,\r\n      requesterAgentId,\r\n    });\r\n\r\n    const decision: CollectiveDecision = {\r\n      id: decisionId,\r\n      question,\r\n      options,\r\n      votingResults: new Map(),\r\n      consensus: '',\r\n      confidence: 0,\r\n      reasoning: '',\r\n      participants: [...session.participants],\r\n      timestamp: new Date(),\r\n    };\r\n\r\n    session.collectiveIntelligence.decisions.set(decisionId, decision);\r\n\r\n    // Initiate voting process\r\n    await this.initiateVoting(session, decision);\r\n\r\n    this.emit('decision:requested', {\r\n      sessionId,\r\n      decisionId,\r\n      question,\r\n    });\r\n\r\n    return decisionId;\r\n  }\r\n\r\n  /**\r\n   * Get collective decision result\r\n   */\r\n  getCollectiveDecision(sessionId: string, decisionId: string): CollectiveDecision | null {\r\n    const session = this.activeSessions.get(sessionId);\r\n    if (!session) return null;\r\n\r\n    return session.collectiveIntelligence.decisions.get(decisionId) || null;\r\n  }\r\n\r\n  /**\r\n   * Query the hive-mind knowledge base\r\n   */\r\n  async queryKnowledge(\r\n    sessionId: string,\r\n    query: {\r\n      type: 'fact' | 'procedure' | 'bestPractice' | 'lesson';\r\n      keywords?: string[];\r\n      context?: string;\r\n      category?: string;\r\n    }\r\n  ): Promise<any[]> {\r\n    const session = this.activeSessions.get(sessionId);\r\n    if (!session) {\r\n      throw new Error(`Hive-mind session not found: ${sessionId}`);\r\n    }\r\n\r\n    this.logger.debug('Querying hive-mind knowledge', {\r\n      sessionId,\r\n      query,\r\n    });\r\n\r\n    let results: any[] = [];\r\n\r\n    switch (query.type) {\r\n      case 'fact':\r\n        results = this.queryFacts(session, query);\r\n        break;\r\n      case 'procedure':\r\n        results = this.queryProcedures(session, query);\r\n        break;\r\n      case 'bestPractice':\r\n        results = this.queryBestPractices(session, query);\r\n        break;\r\n      case 'lesson':\r\n        results = this.queryLessons(session, query);\r\n        break;\r\n    }\r\n\r\n    this.emit('knowledge:queried', {\r\n      sessionId,\r\n      query,\r\n      resultCount: results.length,\r\n    });\r\n\r\n    return results;\r\n  }\r\n\r\n  /**\r\n   * Get collective insights for a swarm\r\n   */\r\n  getCollectiveInsights(sessionId: string): Insight[] {\r\n    const session = this.activeSessions.get(sessionId);\r\n    if (!session) return [];\r\n\r\n    return Array.from(session.collectiveIntelligence.insights.values());\r\n  }\r\n\r\n  /**\r\n   * Get identified patterns\r\n   */\r\n  getIdentifiedPatterns(sessionId: string): Pattern[] {\r\n    const session = this.activeSessions.get(sessionId);\r\n    if (!session) return [];\r\n\r\n    return Array.from(session.collectiveIntelligence.patterns.values());\r\n  }\r\n\r\n  /**\r\n   * Get performance predictions\r\n   */\r\n  getPerformancePredictions(sessionId: string): Prediction[] {\r\n    const session = this.activeSessions.get(sessionId);\r\n    if (!session) return [];\r\n\r\n    return Array.from(session.collectiveIntelligence.predictions.values());\r\n  }\r\n\r\n  /**\r\n   * Terminate a hive-mind session\r\n   */\r\n  async terminateSession(sessionId: string): Promise<void> {\r\n    const session = this.activeSessions.get(sessionId);\r\n    if (!session) return;\r\n\r\n    this.logger.info('Terminating hive-mind session', {\r\n      sessionId,\r\n      participantCount: session.participants.length,\r\n      duration: Date.now() - session.startTime.getTime(),\r\n    });\r\n\r\n    // Save session knowledge to global knowledge base\r\n    await this.consolidateSessionKnowledge(session);\r\n\r\n    // Update status and cleanup\r\n    session.status = 'terminated';\r\n    this.activeSessions.delete(sessionId);\r\n\r\n    this.emit('session:terminated', {\r\n      sessionId,\r\n      duration: Date.now() - session.startTime.getTime(),\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Get hive-mind session status\r\n   */\r\n  getSessionStatus(sessionId: string): HiveMindSession | null {\r\n    return this.activeSessions.get(sessionId) || null;\r\n  }\r\n\r\n  /**\r\n   * Get integration metrics\r\n   */\r\n  getIntegrationMetrics(): {\r\n    activeSessions: number;\r\n    totalParticipants: number;\r\n    knowledgeItems: number;\r\n    insights: number;\r\n    patterns: number;\r\n    decisions: number;\r\n    predictions: number;\r\n    learningModels: number;\r\n  } {\r\n    const sessions = Array.from(this.activeSessions.values());\r\n    \r\n    return {\r\n      activeSessions: sessions.length,\r\n      totalParticipants: sessions.reduce((sum, s) => sum + s.participants.length, 0),\r\n      knowledgeItems: this.countKnowledgeItems(),\r\n      insights: this.globalIntelligence.insights.size,\r\n      patterns: this.globalIntelligence.patterns.size,\r\n      decisions: this.globalIntelligence.decisions.size,\r\n      predictions: this.globalIntelligence.predictions.size,\r\n      learningModels: sessions.reduce((sum, s) => sum + s.distributedLearning.models.size, 0),\r\n    };\r\n  }\r\n\r\n  // Private methods\r\n\r\n  private async loadKnowledgeBase(): Promise<void> {\r\n    try {\r\n      const knowledgeEntries = await this.memoryManager.retrieve({\r\n        namespace: 'hive-mind-knowledge',\r\n        type: 'knowledge-base',\r\n      });\r\n\r\n      for (const entry of knowledgeEntries) {\r\n        const data = JSON.parse(entry.content);\r\n        // Load facts, procedures, best practices, and lessons\r\n        this.loadKnowledgeData(data);\r\n      }\r\n\r\n      this.logger.debug('Knowledge base loaded', {\r\n        factsCount: this.globalKnowledgeBase.facts.size,\r\n        proceduresCount: this.globalKnowledgeBase.procedures.size,\r\n        bestPracticesCount: this.globalKnowledgeBase.bestPractices.size,\r\n        lessonsCount: this.globalKnowledgeBase.lessons.size,\r\n      });\r\n\r\n    } catch (error) {\r\n      this.logger.warn('Failed to load knowledge base, starting fresh', error);\r\n    }\r\n  }\r\n\r\n  private async loadCollectiveIntelligence(): Promise<void> {\r\n    try {\r\n      const intelligenceEntries = await this.memoryManager.retrieve({\r\n        namespace: 'hive-mind-intelligence',\r\n        type: 'collective-intelligence',\r\n      });\r\n\r\n      for (const entry of intelligenceEntries) {\r\n        const data = JSON.parse(entry.content);\r\n        this.loadIntelligenceData(data);\r\n      }\r\n\r\n      this.logger.debug('Collective intelligence loaded', {\r\n        patternsCount: this.globalIntelligence.patterns.size,\r\n        insightsCount: this.globalIntelligence.insights.size,\r\n        decisionsCount: this.globalIntelligence.decisions.size,\r\n        predictionsCount: this.globalIntelligence.predictions.size,\r\n      });\r\n\r\n    } catch (error) {\r\n      this.logger.warn('Failed to load collective intelligence, starting fresh', error);\r\n    }\r\n  }\r\n\r\n  private async saveKnowledgeBase(): Promise<void> {\r\n    try {\r\n      const knowledgeData = {\r\n        facts: Array.from(this.globalKnowledgeBase.facts.entries()),\r\n        procedures: Array.from(this.globalKnowledgeBase.procedures.entries()),\r\n        bestPractices: Array.from(this.globalKnowledgeBase.bestPractices.entries()),\r\n        lessons: Array.from(this.globalKnowledgeBase.lessons.entries()),\r\n      };\r\n\r\n      await this.memoryManager.store({\r\n        id: `knowledge-base-${Date.now()}`,\r\n        agentId: 'hive-mind-integration',\r\n        type: 'knowledge-base',\r\n        content: JSON.stringify(knowledgeData),\r\n        namespace: 'hive-mind-knowledge',\r\n        timestamp: new Date(),\r\n        metadata: {\r\n          type: 'knowledge-base-snapshot',\r\n          itemCount: this.countKnowledgeItems(),\r\n        },\r\n      });\r\n\r\n    } catch (error) {\r\n      this.logger.error('Failed to save knowledge base', error);\r\n    }\r\n  }\r\n\r\n  private async saveCollectiveIntelligence(): Promise<void> {\r\n    try {\r\n      const intelligenceData = {\r\n        patterns: Array.from(this.globalIntelligence.patterns.entries()),\r\n        insights: Array.from(this.globalIntelligence.insights.entries()),\r\n        decisions: Array.from(this.globalIntelligence.decisions.entries()),\r\n        predictions: Array.from(this.globalIntelligence.predictions.entries()),\r\n      };\r\n\r\n      await this.memoryManager.store({\r\n        id: `collective-intelligence-${Date.now()}`,\r\n        agentId: 'hive-mind-integration',\r\n        type: 'collective-intelligence',\r\n        content: JSON.stringify(intelligenceData),\r\n        namespace: 'hive-mind-intelligence',\r\n        timestamp: new Date(),\r\n        metadata: {\r\n          type: 'intelligence-snapshot',\r\n          itemCount: this.globalIntelligence.patterns.size + \r\n                     this.globalIntelligence.insights.size +\r\n                     this.globalIntelligence.decisions.size +\r\n                     this.globalIntelligence.predictions.size,\r\n        },\r\n      });\r\n\r\n    } catch (error) {\r\n      this.logger.error('Failed to save collective intelligence', error);\r\n    }\r\n  }\r\n\r\n  private startPeriodicSync(): void {\r\n    this.syncInterval = setInterval(async () => {\r\n      try {\r\n        await this.performPeriodicSync();\r\n      } catch (error) {\r\n        this.logger.error('Error during periodic sync', error);\r\n      }\r\n    }, this.config.syncInterval);\r\n  }\r\n\r\n  private async performPeriodicSync(): Promise<void> {\r\n    // Sync with external hive-mind endpoint if configured\r\n    if (this.config.hiveMindEndpoint) {\r\n      // Implementation would sync with external system\r\n      this.logger.debug('Performing external hive-mind sync');\r\n    }\r\n\r\n    // Update session knowledge bases\r\n    for (const session of this.activeSessions.values()) {\r\n      await this.syncSessionKnowledge(session);\r\n      session.lastSync = new Date();\r\n    }\r\n\r\n    this.emit('sync:completed', {\r\n      sessionsSynced: this.activeSessions.size,\r\n      timestamp: new Date(),\r\n    });\r\n  }\r\n\r\n  private async initializeSessionWithGlobalKnowledge(session: HiveMindSession): Promise<void> {\r\n    // Copy relevant global knowledge to session\r\n    for (const [id, fact] of this.globalKnowledgeBase.facts) {\r\n      session.knowledgeBase.facts.set(id, fact);\r\n    }\r\n\r\n    for (const [id, insight] of this.globalIntelligence.insights) {\r\n      session.collectiveIntelligence.insights.set(id, insight);\r\n    }\r\n\r\n    for (const [id, pattern] of this.globalIntelligence.patterns) {\r\n      session.collectiveIntelligence.patterns.set(id, pattern);\r\n    }\r\n  }\r\n\r\n  private async shareKnowledgeWithAgent(\r\n    session: HiveMindSession,\r\n    agentId: string,\r\n    agent: SwarmAgent\r\n  ): Promise<void> {\r\n    // Share relevant knowledge based on agent capabilities\r\n    const relevantKnowledge = this.getRelevantKnowledge(session, agent.capabilities);\r\n    \r\n    this.logger.debug('Sharing knowledge with agent', {\r\n      sessionId: session.id,\r\n      agentId,\r\n      knowledgeItems: relevantKnowledge.length,\r\n    });\r\n\r\n    // Implementation would send knowledge to agent through MCP tools\r\n  }\r\n\r\n  private getRelevantKnowledge(session: HiveMindSession, capabilities: string[]): any[] {\r\n    const relevantItems: any[] = [];\r\n\r\n    // Filter facts by capabilities\r\n    for (const fact of session.knowledgeBase.facts.values()) {\r\n      if (capabilities.some(cap => fact.category.includes(cap))) {\r\n        relevantItems.push(fact);\r\n      }\r\n    }\r\n\r\n    // Filter procedures by capabilities\r\n    for (const procedure of session.knowledgeBase.procedures.values()) {\r\n      if (capabilities.some(cap => procedure.contexts.includes(cap))) {\r\n        relevantItems.push(procedure);\r\n      }\r\n    }\r\n\r\n    return relevantItems;\r\n  }\r\n\r\n  private async addKnowledge(session: HiveMindSession, agentId: string, data: any): Promise<void> {\r\n    // Add new knowledge item to session\r\n    if (data.type === 'fact') {\r\n      const fact: Fact = {\r\n        id: generateId('fact'),\r\n        statement: data.statement,\r\n        category: data.category || 'general',\r\n        confidence: data.confidence || 0.8,\r\n        sources: [agentId],\r\n        validatedBy: [agentId],\r\n        contexts: data.contexts || [],\r\n        timestamp: new Date(),\r\n      };\r\n      \r\n      session.knowledgeBase.facts.set(fact.id, fact);\r\n    }\r\n    // Similar implementations for procedures, best practices, and lessons\r\n  }\r\n\r\n  private async addExperience(session: HiveMindSession, agentId: string, data: any): Promise<void> {\r\n    const experience: Experience = {\r\n      id: generateId('experience'),\r\n      context: data.context || 'general',\r\n      situation: data.situation,\r\n      actions: data.actions || [],\r\n      results: data.results || [],\r\n      feedback: data.feedback || 0,\r\n      tags: data.tags || [],\r\n      agentId,\r\n      timestamp: new Date(),\r\n    };\r\n\r\n    session.distributedLearning.experiences.set(experience.id, experience);\r\n  }\r\n\r\n  private async addInsight(session: HiveMindSession, agentId: string, data: any): Promise<void> {\r\n    const insight: Insight = {\r\n      id: generateId('insight'),\r\n      category: data.category || 'optimization',\r\n      title: data.title,\r\n      description: data.description,\r\n      evidence: data.evidence || [],\r\n      confidence: data.confidence || 0.7,\r\n      applicability: data.applicability || [],\r\n      contributingAgents: [agentId],\r\n      timestamp: new Date(),\r\n    };\r\n\r\n    session.collectiveIntelligence.insights.set(insight.id, insight);\r\n  }\r\n\r\n  private async addPattern(session: HiveMindSession, agentId: string, data: any): Promise<void> {\r\n    const pattern: Pattern = {\r\n      id: generateId('pattern'),\r\n      type: data.type || 'behavioral',\r\n      description: data.description,\r\n      frequency: data.frequency || 1,\r\n      confidence: data.confidence || 0.7,\r\n      contexts: data.contexts || [],\r\n      impact: data.impact || 'medium',\r\n      discoveredBy: [agentId],\r\n      lastSeen: new Date(),\r\n    };\r\n\r\n    session.collectiveIntelligence.patterns.set(pattern.id, pattern);\r\n  }\r\n\r\n  private async initiateVoting(session: HiveMindSession, decision: CollectiveDecision): Promise<void> {\r\n    // Implementation would send voting request to all participants\r\n    // For now, simulate consensus building\r\n    this.logger.debug('Initiating collective voting', {\r\n      sessionId: session.id,\r\n      decisionId: decision.id,\r\n      participantCount: decision.participants.length,\r\n    });\r\n\r\n    // Placeholder implementation - in reality, this would involve\r\n    // sophisticated consensus algorithms\r\n    setTimeout(() => {\r\n      this.processVotingResults(session, decision);\r\n    }, 5000);\r\n  }\r\n\r\n  private processVotingResults(session: HiveMindSession, decision: CollectiveDecision): void {\r\n    // Placeholder implementation\r\n    decision.consensus = decision.options[0].id;\r\n    decision.confidence = 0.8;\r\n    decision.reasoning = 'Consensus reached through collective voting';\r\n\r\n    this.emit('decision:completed', {\r\n      sessionId: session.id,\r\n      decisionId: decision.id,\r\n      consensus: decision.consensus,\r\n      confidence: decision.confidence,\r\n    });\r\n  }\r\n\r\n  private queryFacts(session: HiveMindSession, query: any): Fact[] {\r\n    const results: Fact[] = [];\r\n    \r\n    for (const fact of session.knowledgeBase.facts.values()) {\r\n      let matches = true;\r\n      \r\n      if (query.category && !fact.category.includes(query.category)) {\r\n        matches = false;\r\n      }\r\n      \r\n      if (query.keywords && !query.keywords.some(keyword => \r\n        fact.statement.toLowerCase().includes(keyword.toLowerCase()))) {\r\n        matches = false;\r\n      }\r\n      \r\n      if (query.context && !fact.contexts.includes(query.context)) {\r\n        matches = false;\r\n      }\r\n      \r\n      if (matches) {\r\n        results.push(fact);\r\n      }\r\n    }\r\n    \r\n    return results;\r\n  }\r\n\r\n  private queryProcedures(session: HiveMindSession, query: any): Procedure[] {\r\n    // Similar implementation to queryFacts but for procedures\r\n    return Array.from(session.knowledgeBase.procedures.values());\r\n  }\r\n\r\n  private queryBestPractices(session: HiveMindSession, query: any): BestPractice[] {\r\n    // Similar implementation to queryFacts but for best practices\r\n    return Array.from(session.knowledgeBase.bestPractices.values());\r\n  }\r\n\r\n  private queryLessons(session: HiveMindSession, query: any): Lesson[] {\r\n    // Similar implementation to queryFacts but for lessons\r\n    return Array.from(session.knowledgeBase.lessons.values());\r\n  }\r\n\r\n  private async consolidateSessionKnowledge(session: HiveMindSession): Promise<void> {\r\n    // Merge session knowledge into global knowledge base\r\n    for (const [id, fact] of session.knowledgeBase.facts) {\r\n      if (!this.globalKnowledgeBase.facts.has(id)) {\r\n        this.globalKnowledgeBase.facts.set(id, fact);\r\n      }\r\n    }\r\n\r\n    for (const [id, insight] of session.collectiveIntelligence.insights) {\r\n      if (!this.globalIntelligence.insights.has(id)) {\r\n        this.globalIntelligence.insights.set(id, insight);\r\n      }\r\n    }\r\n\r\n    // Similar consolidation for other knowledge types\r\n  }\r\n\r\n  private async syncSessionKnowledge(session: HiveMindSession): Promise<void> {\r\n    // Sync session with global knowledge base\r\n    // Implementation would handle bidirectional sync\r\n  }\r\n\r\n  private loadKnowledgeData(data: any): void {\r\n    // Load knowledge data from stored format\r\n    if (data.facts) {\r\n      for (const [id, fact] of data.facts) {\r\n        this.globalKnowledgeBase.facts.set(id, fact);\r\n      }\r\n    }\r\n    // Similar loading for other knowledge types\r\n  }\r\n\r\n  private loadIntelligenceData(data: any): void {\r\n    // Load intelligence data from stored format\r\n    if (data.patterns) {\r\n      for (const [id, pattern] of data.patterns) {\r\n        this.globalIntelligence.patterns.set(id, pattern);\r\n      }\r\n    }\r\n    // Similar loading for other intelligence types\r\n  }\r\n\r\n  private countKnowledgeItems(): number {\r\n    return this.globalKnowledgeBase.facts.size +\r\n           this.globalKnowledgeBase.procedures.size +\r\n           this.globalKnowledgeBase.bestPractices.size +\r\n           this.globalKnowledgeBase.lessons.size;\r\n  }\r\n\r\n  private initializeKnowledgeBase(): KnowledgeBase {\r\n    return {\r\n      facts: new Map(),\r\n      procedures: new Map(),\r\n      bestPractices: new Map(),\r\n      lessons: new Map(),\r\n    };\r\n  }\r\n\r\n  private initializeCollectiveIntelligence(): CollectiveIntelligence {\r\n    return {\r\n      patterns: new Map(),\r\n      insights: new Map(),\r\n      decisions: new Map(),\r\n      predictions: new Map(),\r\n    };\r\n  }\r\n\r\n  private initializeDistributedLearning(): DistributedLearning {\r\n    return {\r\n      models: new Map(),\r\n      experiences: new Map(),\r\n      adaptations: new Map(),\r\n      performance: {\r\n        metrics: new Map(),\r\n        improvements: [],\r\n        degradations: [],\r\n        stability: 1.0,\r\n        trends: [],\r\n      },\r\n    };\r\n  }\r\n\r\n  private createDefaultConfig(config: Partial<HiveMindConfig>): HiveMindConfig {\r\n    return {\r\n      enableSharedIntelligence: true,\r\n      enableCollectiveMemory: true,\r\n      enableDistributedLearning: true,\r\n      enableKnowledgeSharing: true,\r\n      syncInterval: 30000, // 30 seconds\r\n      maxSharedMemorySize: 100 * 1024 * 1024, // 100MB\r\n      intelligencePoolSize: 1000,\r\n      learningRate: 0.1,\r\n      knowledgeRetentionPeriod: 7 * 24 * 60 * 60 * 1000, // 7 days\r\n      ...config,\r\n    };\r\n  }\r\n\r\n  private setupEventHandlers(): void {\r\n    this.on('session:created', (data) => {\r\n      this.logger.info('Hive-mind session created', data);\r\n    });\r\n\r\n    this.on('agent:joined', (data) => {\r\n      this.logger.info('Agent joined hive-mind', data);\r\n    });\r\n\r\n    this.on('knowledge:shared', (data) => {\r\n      this.logger.debug('Knowledge shared with hive-mind', data);\r\n    });\r\n\r\n    this.on('decision:completed', (data) => {\r\n      this.logger.info('Collective decision completed', data);\r\n    });\r\n  }\r\n}\r\n\r\nexport default HiveMindIntegration;"],"names":["EventEmitter","Logger","generateId","HiveMindIntegration","logger","config","memoryManager","activeSessions","Map","globalKnowledgeBase","globalIntelligence","syncInterval","isInitialized","createDefaultConfig","initializeKnowledgeBase","initializeCollectiveIntelligence","setupEventHandlers","initialize","warn","info","loadKnowledgeBase","loadCollectiveIntelligence","startPeriodicSync","emit","error","shutdown","clearInterval","saveKnowledgeBase","saveCollectiveIntelligence","terminationPromises","Array","from","keys","map","sessionId","terminateSession","Promise","allSettled","createSession","swarmId","orchestrator","session","id","participants","sharedMemory","collectiveIntelligence","knowledgeBase","distributedLearning","initializeDistributedLearning","status","startTime","Date","lastSync","set","initializeSessionWithGlobalKnowledge","addAgentToSession","agentId","agent","get","Error","includes","push","participantCount","length","shareKnowledgeWithAgent","removeAgentFromSession","index","indexOf","splice","shareWithHive","type","data","debug","addKnowledge","addExperience","addInsight","addPattern","requestCollectiveDecision","question","options","requesterAgentId","decisionId","optionCount","decision","votingResults","consensus","confidence","reasoning","timestamp","decisions","initiateVoting","getCollectiveDecision","queryKnowledge","query","results","queryFacts","queryProcedures","queryBestPractices","queryLessons","resultCount","getCollectiveInsights","insights","values","getIdentifiedPatterns","patterns","getPerformancePredictions","predictions","duration","now","getTime","consolidateSessionKnowledge","delete","getSessionStatus","getIntegrationMetrics","sessions","totalParticipants","reduce","sum","s","knowledgeItems","countKnowledgeItems","size","learningModels","models","knowledgeEntries","retrieve","namespace","entry","JSON","parse","content","loadKnowledgeData","factsCount","facts","proceduresCount","procedures","bestPracticesCount","bestPractices","lessonsCount","lessons","intelligenceEntries","loadIntelligenceData","patternsCount","insightsCount","decisionsCount","predictionsCount","knowledgeData","entries","store","stringify","metadata","itemCount","intelligenceData","setInterval","performPeriodicSync","hiveMindEndpoint","syncSessionKnowledge","sessionsSynced","fact","insight","pattern","relevantKnowledge","getRelevantKnowledge","capabilities","relevantItems","some","cap","category","procedure","contexts","statement","sources","validatedBy","experience","context","situation","actions","feedback","tags","experiences","title","description","evidence","applicability","contributingAgents","frequency","impact","discoveredBy","lastSeen","setTimeout","processVotingResults","matches","keywords","keyword","toLowerCase","has","adaptations","performance","metrics","improvements","degradations","stability","trends","enableSharedIntelligence","enableCollectiveMemory","enableDistributedLearning","enableKnowledgeSharing","maxSharedMemorySize","intelligencePoolSize","learningRate","knowledgeRetentionPeriod","on"],"mappings":"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"}