{"version":3,"sources":["../../../src/swarm/claude-code-interface.ts"],"sourcesContent":["/**\r\n * Claude Code Coordination Interface\r\n * \r\n * This module provides the interface layer for coordinating with Claude Code\r\n * instances, managing agent spawning through the claude CLI, handling process\r\n * lifecycle, and enabling seamless communication between the swarm system\r\n * and individual Claude agents.\r\n */\r\n\r\nimport { EventEmitter } from 'node:events';\r\nimport { spawn, ChildProcess } from 'node:child_process';\r\nimport { performance } from 'node:perf_hooks';\r\nimport * as path from 'node:path';\r\nimport * as fs from 'node:fs/promises';\r\nimport { Logger } from '../core/logger.js';\r\nimport { generateId } from '../utils/helpers.js';\r\nimport { MemoryManager } from '../memory/manager.js';\r\nimport TaskExecutor, { \r\n  ClaudeExecutionOptions,\r\n  ExecutionResult,\r\n  ExecutionContext\r\n} from './executor.js';\r\nimport {\r\n  SwarmAgent,\r\n  SwarmTask,\r\n  TaskDefinition,\r\n  AgentState,\r\n  AgentCapabilities,\r\n  TaskResult,\r\n  SwarmExecutionContext,\r\n} from './types.js';\r\n\r\nexport interface ClaudeCodeConfig {\r\n  claudeExecutablePath: string;\r\n  defaultModel: string;\r\n  maxTokens: number;\r\n  temperature: number;\r\n  timeout: number;\r\n  maxConcurrentAgents: number;\r\n  enableStreaming: boolean;\r\n  enableLogging: boolean;\r\n  workingDirectory: string;\r\n  environmentVariables: Record<string, string>;\r\n  agentPoolSize: number;\r\n  processRecycling: boolean;\r\n  healthCheckInterval: number;\r\n}\r\n\r\nexport interface ClaudeAgent {\r\n  id: string;\r\n  processId: number;\r\n  process: ChildProcess;\r\n  type: string;\r\n  capabilities: string[];\r\n  status: 'initializing' | 'idle' | 'busy' | 'error' | 'terminated';\r\n  currentTask?: string;\r\n  spawnedAt: Date;\r\n  lastActivity: Date;\r\n  totalTasks: number;\r\n  totalDuration: number;\r\n  metrics: ClaudeAgentMetrics;\r\n}\r\n\r\nexport interface ClaudeAgentMetrics {\r\n  tasksCompleted: number;\r\n  tasksFailed: number;\r\n  averageResponseTime: number;\r\n  totalTokensUsed: number;\r\n  memoryUsage: number;\r\n  cpuUsage: number;\r\n  errorRate: number;\r\n  successRate: number;\r\n}\r\n\r\nexport interface ClaudeTaskExecution {\r\n  id: string;\r\n  taskId: string;\r\n  agentId: string;\r\n  startTime: Date;\r\n  endTime?: Date;\r\n  status: 'queued' | 'running' | 'completed' | 'failed' | 'cancelled';\r\n  input: any;\r\n  output?: any;\r\n  error?: string;\r\n  duration?: number;\r\n  tokensUsed?: number;\r\n  retryCount: number;\r\n  maxRetries: number;\r\n}\r\n\r\nexport interface ClaudeSpawnOptions {\r\n  type: string;\r\n  name?: string;\r\n  capabilities?: string[];\r\n  systemPrompt?: string;\r\n  model?: string;\r\n  maxTokens?: number;\r\n  temperature?: number;\r\n  workingDirectory?: string;\r\n  environment?: Record<string, string>;\r\n  tools?: string[];\r\n  priority?: number;\r\n}\r\n\r\nexport interface ProcessPool {\r\n  idle: ClaudeAgent[];\r\n  busy: ClaudeAgent[];\r\n  failed: ClaudeAgent[];\r\n  totalSpawned: number;\r\n  totalTerminated: number;\r\n  recyclingEnabled: boolean;\r\n  maxAge: number;\r\n  maxTasks: number;\r\n}\r\n\r\nexport class ClaudeCodeInterface extends EventEmitter {\r\n  private logger: Logger;\r\n  private config: ClaudeCodeConfig;\r\n  private memoryManager: MemoryManager;\r\n  private processPool: ProcessPool;\r\n  private activeExecutions: Map<string, ClaudeTaskExecution> = new Map();\r\n  private agents: Map<string, ClaudeAgent> = new Map();\r\n  private taskExecutor: TaskExecutor;\r\n  private healthCheckInterval?: NodeJS.Timeout;\r\n  private isInitialized: boolean = false;\r\n\r\n  constructor(\r\n    config: Partial<ClaudeCodeConfig> = {},\r\n    memoryManager: MemoryManager\r\n  ) {\r\n    super();\r\n    \r\n    this.logger = new Logger('ClaudeCodeInterface');\r\n    this.config = this.createDefaultConfig(config);\r\n    this.memoryManager = memoryManager;\r\n    this.processPool = this.initializeProcessPool();\r\n    \r\n    this.taskExecutor = new TaskExecutor({\r\n      timeoutMs: this.config.timeout,\r\n      enableMetrics: true,\r\n      captureOutput: true,\r\n      streamOutput: this.config.enableStreaming,\r\n    });\r\n\r\n    this.setupEventHandlers();\r\n  }\r\n\r\n  /**\r\n   * Initialize the Claude Code interface\r\n   */\r\n  async initialize(): Promise<void> {\r\n    if (this.isInitialized) {\r\n      this.logger.warn('Claude Code interface already initialized');\r\n      return;\r\n    }\r\n\r\n    this.logger.info('Initializing Claude Code interface...');\r\n\r\n    try {\r\n      // Verify Claude executable exists\r\n      await this.verifyClaudeExecutable();\r\n\r\n      // Initialize task executor\r\n      await this.taskExecutor.initialize();\r\n\r\n      // Pre-warm agent pool if configured\r\n      if (this.config.agentPoolSize > 0) {\r\n        await this.prewarmAgentPool();\r\n      }\r\n\r\n      // Start health checks\r\n      this.startHealthChecks();\r\n\r\n      this.isInitialized = true;\r\n      this.logger.info('Claude Code interface initialized successfully', {\r\n        poolSize: this.processPool.idle.length,\r\n        maxConcurrent: this.config.maxConcurrentAgents,\r\n      });\r\n\r\n      this.emit('initialized');\r\n\r\n    } catch (error) {\r\n      this.logger.error('Failed to initialize Claude Code interface', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Shutdown the interface gracefully\r\n   */\r\n  async shutdown(): Promise<void> {\r\n    if (!this.isInitialized) return;\r\n\r\n    this.logger.info('Shutting down Claude Code interface...');\r\n\r\n    try {\r\n      // Stop health checks\r\n      if (this.healthCheckInterval) {\r\n        clearInterval(this.healthCheckInterval);\r\n      }\r\n\r\n      // Cancel active executions\r\n      const cancellationPromises = Array.from(this.activeExecutions.keys())\r\n        .map(executionId => this.cancelExecution(executionId, 'Interface shutdown'));\r\n      \r\n      await Promise.allSettled(cancellationPromises);\r\n\r\n      // Terminate all agents\r\n      await this.terminateAllAgents();\r\n\r\n      // Shutdown task executor\r\n      await this.taskExecutor.shutdown();\r\n\r\n      this.isInitialized = false;\r\n      this.logger.info('Claude Code interface shut down successfully');\r\n      this.emit('shutdown');\r\n\r\n    } catch (error) {\r\n      this.logger.error('Error during Claude Code interface shutdown', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Spawn a new Claude agent with specified configuration\r\n   */\r\n  async spawnAgent(options: ClaudeSpawnOptions): Promise<string> {\r\n    this.logger.info('Spawning Claude agent', {\r\n      type: options.type,\r\n      name: options.name,\r\n      capabilities: options.capabilities,\r\n    });\r\n\r\n    try {\r\n      // Check if we can spawn more agents\r\n      if (this.getTotalActiveAgents() >= this.config.maxConcurrentAgents) {\r\n        throw new Error('Maximum concurrent agents limit reached');\r\n      }\r\n\r\n      // Build Claude command\r\n      const command = this.buildClaudeCommand(options);\r\n      \r\n      // Spawn process\r\n      const process = spawn(command.executable, command.args, {\r\n        cwd: options.workingDirectory || this.config.workingDirectory,\r\n        env: {\r\n          ...process.env,\r\n          ...this.config.environmentVariables,\r\n          ...options.environment,\r\n        },\r\n        stdio: ['pipe', 'pipe', 'pipe'],\r\n        detached: false,\r\n      });\r\n\r\n      if (!process.pid) {\r\n        throw new Error('Failed to spawn Claude process');\r\n      }\r\n\r\n      // Create agent record\r\n      const agentId = generateId('claude-agent');\r\n      const agent: ClaudeAgent = {\r\n        id: agentId,\r\n        processId: process.pid,\r\n        process,\r\n        type: options.type,\r\n        capabilities: options.capabilities || [],\r\n        status: 'initializing',\r\n        spawnedAt: new Date(),\r\n        lastActivity: new Date(),\r\n        totalTasks: 0,\r\n        totalDuration: 0,\r\n        metrics: this.initializeAgentMetrics(),\r\n      };\r\n\r\n      this.agents.set(agentId, agent);\r\n      this.processPool.idle.push(agent);\r\n      this.processPool.totalSpawned++;\r\n\r\n      // Setup process event handlers\r\n      this.setupProcessEventHandlers(agent);\r\n\r\n      // Wait for agent to be ready\r\n      await this.waitForAgentReady(agent);\r\n\r\n      agent.status = 'idle';\r\n      agent.lastActivity = new Date();\r\n\r\n      this.logger.info('Claude agent spawned successfully', {\r\n        agentId,\r\n        processId: process.pid,\r\n        type: options.type,\r\n      });\r\n\r\n      this.emit('agent:spawned', {\r\n        agentId,\r\n        type: options.type,\r\n        processId: process.pid,\r\n      });\r\n\r\n      return agentId;\r\n\r\n    } catch (error) {\r\n      this.logger.error('Failed to spawn Claude agent', {\r\n        type: options.type,\r\n        error: error instanceof Error ? error.message : String(error),\r\n      });\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Execute a task using a Claude agent\r\n   */\r\n  async executeTask(\r\n    taskDefinition: TaskDefinition,\r\n    agentId?: string,\r\n    options: Partial<ClaudeExecutionOptions> = {}\r\n  ): Promise<ClaudeTaskExecution> {\r\n    const executionId = generateId('claude-execution');\r\n    \r\n    this.logger.info('Executing task with Claude agent', {\r\n      executionId,\r\n      taskId: taskDefinition.id.id,\r\n      agentId,\r\n    });\r\n\r\n    try {\r\n      // Get or select agent\r\n      const agent = agentId ? this.agents.get(agentId) : await this.selectOptimalAgent(taskDefinition);\r\n      \r\n      if (!agent) {\r\n        throw new Error(agentId ? `Agent not found: ${agentId}` : 'No suitable agent available');\r\n      }\r\n\r\n      if (agent.status !== 'idle') {\r\n        throw new Error(`Agent ${agent.id} is not available (status: ${agent.status})`);\r\n      }\r\n\r\n      // Create execution record\r\n      const execution: ClaudeTaskExecution = {\r\n        id: executionId,\r\n        taskId: taskDefinition.id.id,\r\n        agentId: agent.id,\r\n        startTime: new Date(),\r\n        status: 'queued',\r\n        input: {\r\n          task: taskDefinition,\r\n          options,\r\n        },\r\n        retryCount: 0,\r\n        maxRetries: options.maxRetries || 3,\r\n      };\r\n\r\n      this.activeExecutions.set(executionId, execution);\r\n\r\n      // Update agent status\r\n      agent.status = 'busy';\r\n      agent.currentTask = executionId;\r\n      agent.lastActivity = new Date();\r\n\r\n      // Move agent from idle to busy pool\r\n      this.moveAgentToBusyPool(agent);\r\n\r\n      // Execute task\r\n      execution.status = 'running';\r\n      const result = await this.executeTaskWithAgent(agent, taskDefinition, options);\r\n\r\n      // Update execution record\r\n      execution.endTime = new Date();\r\n      execution.duration = execution.endTime.getTime() - execution.startTime.getTime();\r\n      execution.output = result.result;\r\n      execution.tokensUsed = result.metadata?.tokensUsed;\r\n\r\n      if (result.success) {\r\n        execution.status = 'completed';\r\n        agent.metrics.tasksCompleted++;\r\n      } else {\r\n        execution.status = 'failed';\r\n        execution.error = result.error;\r\n        agent.metrics.tasksFailed++;\r\n      }\r\n\r\n      // Update agent metrics\r\n      this.updateAgentMetrics(agent, execution);\r\n\r\n      // Return agent to idle pool\r\n      this.returnAgentToIdlePool(agent);\r\n\r\n      this.logger.info('Task execution completed', {\r\n        executionId,\r\n        success: result.success,\r\n        duration: execution.duration,\r\n        tokensUsed: execution.tokensUsed,\r\n      });\r\n\r\n      this.emit('task:completed', {\r\n        executionId,\r\n        taskId: taskDefinition.id.id,\r\n        agentId: agent.id,\r\n        success: result.success,\r\n        duration: execution.duration,\r\n      });\r\n\r\n      return execution;\r\n\r\n    } catch (error) {\r\n      const execution = this.activeExecutions.get(executionId);\r\n      if (execution) {\r\n        execution.status = 'failed';\r\n        execution.error = error instanceof Error ? error.message : String(error);\r\n        execution.endTime = new Date();\r\n        execution.duration = execution.endTime.getTime() - execution.startTime.getTime();\r\n\r\n        // Return agent to pool if it was assigned\r\n        const agent = this.agents.get(execution.agentId);\r\n        if (agent) {\r\n          this.returnAgentToIdlePool(agent);\r\n        }\r\n      }\r\n\r\n      this.logger.error('Task execution failed', {\r\n        executionId,\r\n        error: error instanceof Error ? error.message : String(error),\r\n      });\r\n\r\n      throw error;\r\n    } finally {\r\n      this.activeExecutions.delete(executionId);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Cancel a running task execution\r\n   */\r\n  async cancelExecution(executionId: string, reason: string): Promise<void> {\r\n    const execution = this.activeExecutions.get(executionId);\r\n    if (!execution) {\r\n      throw new Error(`Execution not found: ${executionId}`);\r\n    }\r\n\r\n    this.logger.info('Cancelling task execution', {\r\n      executionId,\r\n      reason,\r\n      taskId: execution.taskId,\r\n      agentId: execution.agentId,\r\n    });\r\n\r\n    try {\r\n      execution.status = 'cancelled';\r\n      execution.error = reason;\r\n      execution.endTime = new Date();\r\n      execution.duration = execution.endTime.getTime() - execution.startTime.getTime();\r\n\r\n      // Cancel agent task if running\r\n      const agent = this.agents.get(execution.agentId);\r\n      if (agent && agent.currentTask === executionId) {\r\n        await this.cancelAgentTask(agent);\r\n        this.returnAgentToIdlePool(agent);\r\n      }\r\n\r\n      this.emit('task:cancelled', {\r\n        executionId,\r\n        reason,\r\n        taskId: execution.taskId,\r\n        agentId: execution.agentId,\r\n      });\r\n\r\n    } finally {\r\n      this.activeExecutions.delete(executionId);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Terminate a specific agent\r\n   */\r\n  async terminateAgent(agentId: string, reason: string = 'Manual termination'): Promise<void> {\r\n    const agent = this.agents.get(agentId);\r\n    if (!agent) {\r\n      throw new Error(`Agent not found: ${agentId}`);\r\n    }\r\n\r\n    this.logger.info('Terminating Claude agent', {\r\n      agentId,\r\n      processId: agent.processId,\r\n      reason,\r\n    });\r\n\r\n    try {\r\n      // Cancel current task if any\r\n      if (agent.currentTask) {\r\n        await this.cancelExecution(agent.currentTask, 'Agent termination');\r\n      }\r\n\r\n      // Update status\r\n      agent.status = 'terminated';\r\n\r\n      // Terminate process\r\n      await this.terminateProcess(agent.process);\r\n\r\n      // Remove from pools and agents map\r\n      this.removeAgentFromPools(agent);\r\n      this.agents.delete(agentId);\r\n      this.processPool.totalTerminated++;\r\n\r\n      this.logger.info('Claude agent terminated successfully', {\r\n        agentId,\r\n        reason,\r\n        totalTasks: agent.totalTasks,\r\n        totalDuration: agent.totalDuration,\r\n      });\r\n\r\n      this.emit('agent:terminated', {\r\n        agentId,\r\n        reason,\r\n        metrics: agent.metrics,\r\n      });\r\n\r\n    } catch (error) {\r\n      this.logger.error('Error terminating agent', {\r\n        agentId,\r\n        error: error instanceof Error ? error.message : String(error),\r\n      });\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get agent status and metrics\r\n   */\r\n  getAgentStatus(agentId: string): ClaudeAgent | null {\r\n    return this.agents.get(agentId) || null;\r\n  }\r\n\r\n  /**\r\n   * Get all active agents\r\n   */\r\n  getAllAgents(): ClaudeAgent[] {\r\n    return Array.from(this.agents.values());\r\n  }\r\n\r\n  /**\r\n   * Get execution status\r\n   */\r\n  getExecutionStatus(executionId: string): ClaudeTaskExecution | null {\r\n    return this.activeExecutions.get(executionId) || null;\r\n  }\r\n\r\n  /**\r\n   * Get comprehensive interface metrics\r\n   */\r\n  getInterfaceMetrics(): {\r\n    agents: {\r\n      total: number;\r\n      idle: number;\r\n      busy: number;\r\n      failed: number;\r\n      terminated: number;\r\n    };\r\n    executions: {\r\n      active: number;\r\n      completed: number;\r\n      failed: number;\r\n      cancelled: number;\r\n    };\r\n    performance: {\r\n      averageResponseTime: number;\r\n      totalTokensUsed: number;\r\n      successRate: number;\r\n      throughput: number;\r\n    };\r\n    pool: {\r\n      totalSpawned: number;\r\n      totalTerminated: number;\r\n      recyclingEnabled: boolean;\r\n      poolUtilization: number;\r\n    };\r\n  } {\r\n    const agents = Array.from(this.agents.values());\r\n    const executions = Array.from(this.activeExecutions.values());\r\n\r\n    const totalCompleted = agents.reduce((sum, a) => sum + a.metrics.tasksCompleted, 0);\r\n    const totalFailed = agents.reduce((sum, a) => sum + a.metrics.tasksFailed, 0);\r\n    const totalTokens = agents.reduce((sum, a) => sum + a.metrics.totalTokensUsed, 0);\r\n    const avgResponseTime = agents.length > 0 \r\n      ? agents.reduce((sum, a) => sum + a.metrics.averageResponseTime, 0) / agents.length \r\n      : 0;\r\n\r\n    return {\r\n      agents: {\r\n        total: agents.length,\r\n        idle: this.processPool.idle.length,\r\n        busy: this.processPool.busy.length,\r\n        failed: this.processPool.failed.length,\r\n        terminated: this.processPool.totalTerminated,\r\n      },\r\n      executions: {\r\n        active: executions.filter(e => e.status === 'running').length,\r\n        completed: totalCompleted,\r\n        failed: totalFailed,\r\n        cancelled: executions.filter(e => e.status === 'cancelled').length,\r\n      },\r\n      performance: {\r\n        averageResponseTime: avgResponseTime,\r\n        totalTokensUsed: totalTokens,\r\n        successRate: totalCompleted + totalFailed > 0 ? totalCompleted / (totalCompleted + totalFailed) : 0,\r\n        throughput: this.calculateThroughput(),\r\n      },\r\n      pool: {\r\n        totalSpawned: this.processPool.totalSpawned,\r\n        totalTerminated: this.processPool.totalTerminated,\r\n        recyclingEnabled: this.processPool.recyclingEnabled,\r\n        poolUtilization: this.calculatePoolUtilization(),\r\n      },\r\n    };\r\n  }\r\n\r\n  // Private methods\r\n\r\n  private async verifyClaudeExecutable(): Promise<void> {\r\n    try {\r\n      const { spawn } = await import('node:child_process');\r\n      const process = spawn(this.config.claudeExecutablePath, ['--version'], {\r\n        stdio: ['ignore', 'pipe', 'pipe'],\r\n      });\r\n\r\n      return new Promise((resolve, reject) => {\r\n        let output = '';\r\n        \r\n        process.stdout?.on('data', (data) => {\r\n          output += data.toString();\r\n        });\r\n\r\n        process.on('close', (code) => {\r\n          if (code === 0) {\r\n            this.logger.info('Claude executable verified', {\r\n              path: this.config.claudeExecutablePath,\r\n              version: output.trim(),\r\n            });\r\n            resolve();\r\n          } else {\r\n            reject(new Error(`Claude executable verification failed with code ${code}`));\r\n          }\r\n        });\r\n\r\n        process.on('error', reject);\r\n      });\r\n\r\n    } catch (error) {\r\n      throw new Error(`Claude executable not found: ${this.config.claudeExecutablePath}`);\r\n    }\r\n  }\r\n\r\n  private async prewarmAgentPool(): Promise<void> {\r\n    this.logger.info('Pre-warming agent pool', {\r\n      targetSize: this.config.agentPoolSize,\r\n    });\r\n\r\n    const promises: Promise<string>[] = [];\r\n    \r\n    for (let i = 0; i < this.config.agentPoolSize; i++) {\r\n      promises.push(this.spawnAgent({\r\n        type: 'general',\r\n        name: `pool-agent-${i}`,\r\n        capabilities: ['general'],\r\n      }));\r\n    }\r\n\r\n    const results = await Promise.allSettled(promises);\r\n    const successful = results.filter(r => r.status === 'fulfilled').length;\r\n    const failed = results.filter(r => r.status === 'rejected').length;\r\n\r\n    this.logger.info('Agent pool pre-warming completed', {\r\n      successful,\r\n      failed,\r\n      targetSize: this.config.agentPoolSize,\r\n    });\r\n  }\r\n\r\n  private buildClaudeCommand(options: ClaudeSpawnOptions): {\r\n    executable: string;\r\n    args: string[];\r\n  } {\r\n    const args: string[] = [];\r\n\r\n    // Add model\r\n    args.push('--model', options.model || this.config.defaultModel);\r\n\r\n    // Add max tokens\r\n    args.push('--max-tokens', String(options.maxTokens || this.config.maxTokens));\r\n\r\n    // Add temperature\r\n    args.push('--temperature', String(options.temperature || this.config.temperature));\r\n\r\n    // Add system prompt if provided\r\n    if (options.systemPrompt) {\r\n      args.push('--system', options.systemPrompt);\r\n    }\r\n\r\n    // Add tools if specified\r\n    if (options.tools && options.tools.length > 0) {\r\n      args.push('--allowedTools', options.tools.join(','));\r\n    }\r\n\r\n    // Enable streaming if configured\r\n    if (this.config.enableStreaming) {\r\n      args.push('--stream');\r\n    }\r\n\r\n    // Skip permissions for swarm execution\r\n    args.push('--dangerously-skip-permissions');\r\n\r\n    return {\r\n      executable: this.config.claudeExecutablePath,\r\n      args,\r\n    };\r\n  }\r\n\r\n  private setupProcessEventHandlers(agent: ClaudeAgent): void {\r\n    const { process } = agent;\r\n\r\n    process.on('exit', (code, signal) => {\r\n      this.logger.info('Claude agent process exited', {\r\n        agentId: agent.id,\r\n        processId: agent.processId,\r\n        code,\r\n        signal,\r\n      });\r\n\r\n      if (agent.status !== 'terminated') {\r\n        agent.status = 'error';\r\n        this.moveAgentToFailedPool(agent);\r\n      }\r\n\r\n      this.emit('agent:exited', {\r\n        agentId: agent.id,\r\n        code,\r\n        signal,\r\n      });\r\n    });\r\n\r\n    process.on('error', (error) => {\r\n      this.logger.error('Claude agent process error', {\r\n        agentId: agent.id,\r\n        processId: agent.processId,\r\n        error: error.message,\r\n      });\r\n\r\n      agent.status = 'error';\r\n      this.moveAgentToFailedPool(agent);\r\n\r\n      this.emit('agent:error', {\r\n        agentId: agent.id,\r\n        error: error.message,\r\n      });\r\n    });\r\n\r\n    // Handle stdout/stderr if needed\r\n    if (this.config.enableLogging) {\r\n      process.stdout?.on('data', (data) => {\r\n        this.logger.debug('Agent stdout', {\r\n          agentId: agent.id,\r\n          data: data.toString().trim(),\r\n        });\r\n      });\r\n\r\n      process.stderr?.on('data', (data) => {\r\n        this.logger.debug('Agent stderr', {\r\n          agentId: agent.id,\r\n          data: data.toString().trim(),\r\n        });\r\n      });\r\n    }\r\n  }\r\n\r\n  private async waitForAgentReady(agent: ClaudeAgent, timeout: number = 30000): Promise<void> {\r\n    return new Promise((resolve, reject) => {\r\n      const startTime = Date.now();\r\n      const checkInterval = 1000; // 1 second\r\n\r\n      const checkReady = () => {\r\n        const elapsed = Date.now() - startTime;\r\n        \r\n        if (elapsed > timeout) {\r\n          reject(new Error(`Agent ${agent.id} failed to become ready within ${timeout}ms`));\r\n          return;\r\n        }\r\n\r\n        // Check if process is still running\r\n        if (agent.process.killed || agent.process.exitCode !== null) {\r\n          reject(new Error(`Agent ${agent.id} process terminated during initialization`));\r\n          return;\r\n        }\r\n\r\n        // For now, assume agent is ready after a short delay\r\n        // In a real implementation, you might check for specific output or response\r\n        if (elapsed > 2000) { // 2 seconds\r\n          resolve();\r\n        } else {\r\n          setTimeout(checkReady, checkInterval);\r\n        }\r\n      };\r\n\r\n      checkReady();\r\n    });\r\n  }\r\n\r\n  private async selectOptimalAgent(taskDefinition: TaskDefinition): Promise<ClaudeAgent | null> {\r\n    const availableAgents = this.processPool.idle.filter(agent => agent.status === 'idle');\r\n    \r\n    if (availableAgents.length === 0) {\r\n      // Try to spawn a new agent if under limit\r\n      if (this.getTotalActiveAgents() < this.config.maxConcurrentAgents) {\r\n        const agentId = await this.spawnAgent({\r\n          type: 'task-specific',\r\n          capabilities: taskDefinition.requirements.capabilities,\r\n        });\r\n        return this.agents.get(agentId) || null;\r\n      }\r\n      return null;\r\n    }\r\n\r\n    // Select agent based on capabilities and performance\r\n    const scoredAgents = availableAgents.map(agent => ({\r\n      agent,\r\n      score: this.calculateAgentScore(agent, taskDefinition),\r\n    }));\r\n\r\n    scoredAgents.sort((a, b) => b.score - a.score);\r\n    return scoredAgents[0].agent;\r\n  }\r\n\r\n  private calculateAgentScore(agent: ClaudeAgent, taskDefinition: TaskDefinition): number {\r\n    let score = 0;\r\n\r\n    // Capability match\r\n    const requiredCapabilities = taskDefinition.requirements.capabilities;\r\n    const matchingCapabilities = agent.capabilities.filter(cap => \r\n      requiredCapabilities.includes(cap)\r\n    );\r\n    score += (matchingCapabilities.length / requiredCapabilities.length) * 100;\r\n\r\n    // Performance metrics\r\n    score += agent.metrics.successRate * 50;\r\n    score += Math.max(0, 50 - agent.metrics.averageResponseTime / 1000) * 10; // Prefer faster agents\r\n\r\n    // Load balancing - prefer agents with fewer completed tasks\r\n    const maxTasks = Math.max(...this.processPool.idle.map(a => a.totalTasks), 1);\r\n    score += (1 - agent.totalTasks / maxTasks) * 20;\r\n\r\n    return score;\r\n  }\r\n\r\n  private async executeTaskWithAgent(\r\n    agent: ClaudeAgent,\r\n    taskDefinition: TaskDefinition,\r\n    options: Partial<ClaudeExecutionOptions>\r\n  ): Promise<ExecutionResult> {\r\n    const startTime = performance.now();\r\n\r\n    try {\r\n      // Create execution context for the agent\r\n      const context: ExecutionContext = {\r\n        task: taskDefinition,\r\n        agent: this.convertToAgentState(agent),\r\n        workingDirectory: options.workingDirectory || this.config.workingDirectory,\r\n        tempDirectory: path.join(this.config.workingDirectory, 'temp', agent.id),\r\n        logDirectory: path.join(this.config.workingDirectory, 'logs', agent.id),\r\n        environment: {\r\n          ...this.config.environmentVariables,\r\n          CLAUDE_AGENT_ID: agent.id,\r\n          CLAUDE_TASK_ID: taskDefinition.id.id,\r\n        },\r\n        resources: {\r\n          maxMemory: taskDefinition.requirements.memoryRequired || 512 * 1024 * 1024,\r\n          maxCpuTime: taskDefinition.requirements.maxDuration || 300000,\r\n          maxDiskSpace: 1024 * 1024 * 1024,\r\n          maxNetworkConnections: 10,\r\n          maxFileHandles: 100,\r\n          priority: 1,\r\n        },\r\n      };\r\n\r\n      // Execute using task executor\r\n      const result = await this.taskExecutor.executeClaudeTask(\r\n        taskDefinition,\r\n        context.agent,\r\n        {\r\n          model: options.model || this.config.defaultModel,\r\n          maxTokens: options.maxTokens || this.config.maxTokens,\r\n          temperature: options.temperature || this.config.temperature,\r\n          timeout: options.timeout || this.config.timeout,\r\n          claudePath: this.config.claudeExecutablePath,\r\n          ...options,\r\n        }\r\n      );\r\n\r\n      const duration = performance.now() - startTime;\r\n      \r\n      // Update agent activity\r\n      agent.lastActivity = new Date();\r\n      agent.totalTasks++;\r\n      agent.totalDuration += duration;\r\n\r\n      return result;\r\n\r\n    } catch (error) {\r\n      const duration = performance.now() - startTime;\r\n      agent.totalDuration += duration;\r\n      \r\n      throw error;\r\n    }\r\n  }\r\n\r\n  private convertToAgentState(agent: ClaudeAgent): AgentState {\r\n    // Convert ClaudeAgent to AgentState for compatibility\r\n    return {\r\n      id: {\r\n        id: agent.id,\r\n        swarmId: 'claude-interface',\r\n        type: agent.type as any,\r\n        instance: 1,\r\n      },\r\n      name: `Claude-${agent.id}`,\r\n      type: agent.type as any,\r\n      status: agent.status as any,\r\n      capabilities: this.createAgentCapabilities(agent.capabilities),\r\n      metrics: {\r\n        tasksCompleted: agent.metrics.tasksCompleted,\r\n        tasksFailed: agent.metrics.tasksFailed,\r\n        averageExecutionTime: agent.metrics.averageResponseTime,\r\n        successRate: agent.metrics.successRate,\r\n        cpuUsage: agent.metrics.cpuUsage,\r\n        memoryUsage: agent.metrics.memoryUsage,\r\n        diskUsage: 0,\r\n        networkUsage: 0,\r\n        codeQuality: 0.8,\r\n        testCoverage: 0.7,\r\n        bugRate: 0.1,\r\n        userSatisfaction: 0.9,\r\n        totalUptime: Date.now() - agent.spawnedAt.getTime(),\r\n        lastActivity: agent.lastActivity,\r\n        responseTime: agent.metrics.averageResponseTime,\r\n      },\r\n      currentTask: agent.currentTask ? {\r\n        id: agent.currentTask,\r\n        swarmId: 'claude-interface',\r\n        sequence: 0,\r\n        priority: 1,\r\n      } : undefined,\r\n      workload: agent.status === 'busy' ? 1 : 0,\r\n      health: agent.status === 'error' ? 0 : 1,\r\n      config: {\r\n        autonomyLevel: 0.8,\r\n        learningEnabled: false,\r\n        adaptationEnabled: false,\r\n        maxTasksPerHour: 60,\r\n        maxConcurrentTasks: 1,\r\n        timeoutThreshold: this.config.timeout,\r\n        reportingInterval: 10000,\r\n        heartbeatInterval: 5000,\r\n        permissions: ['read', 'write', 'execute'],\r\n        trustedAgents: [],\r\n        expertise: {},\r\n        preferences: {},\r\n      },\r\n      environment: {\r\n        runtime: 'claude',\r\n        version: '1.0.0',\r\n        workingDirectory: this.config.workingDirectory,\r\n        tempDirectory: path.join(this.config.workingDirectory, 'temp', agent.id),\r\n        logDirectory: path.join(this.config.workingDirectory, 'logs', agent.id),\r\n        apiEndpoints: {},\r\n        credentials: {},\r\n        availableTools: agent.capabilities,\r\n        toolConfigs: {},\r\n      },\r\n      endpoints: [],\r\n      lastHeartbeat: agent.lastActivity,\r\n      taskHistory: [],\r\n      errorHistory: [],\r\n      parentAgent: undefined,\r\n      childAgents: [],\r\n      collaborators: [],\r\n    };\r\n  }\r\n\r\n  private createAgentCapabilities(capabilities: string[]): AgentCapabilities {\r\n    return {\r\n      codeGeneration: capabilities.includes('coding') || capabilities.includes('codeGeneration'),\r\n      codeReview: capabilities.includes('review') || capabilities.includes('codeReview'),\r\n      testing: capabilities.includes('testing'),\r\n      documentation: capabilities.includes('documentation'),\r\n      research: capabilities.includes('research'),\r\n      analysis: capabilities.includes('analysis'),\r\n      webSearch: capabilities.includes('webSearch'),\r\n      apiIntegration: capabilities.includes('apiIntegration'),\r\n      fileSystem: capabilities.includes('fileSystem'),\r\n      terminalAccess: capabilities.includes('terminal'),\r\n      languages: capabilities.filter(c => ['javascript', 'typescript', 'python', 'java'].includes(c)),\r\n      frameworks: capabilities.filter(c => ['react', 'node', 'express'].includes(c)),\r\n      domains: capabilities.filter(c => ['web', 'api', 'database'].includes(c)),\r\n      tools: capabilities.filter(c => ['bash', 'git', 'npm'].includes(c)),\r\n      maxConcurrentTasks: 1,\r\n      maxMemoryUsage: 512 * 1024 * 1024,\r\n      maxExecutionTime: this.config.timeout,\r\n      reliability: 0.9,\r\n      speed: 1.0,\r\n      quality: 0.8,\r\n    };\r\n  }\r\n\r\n  private async cancelAgentTask(agent: ClaudeAgent): Promise<void> {\r\n    if (agent.process && !agent.process.killed) {\r\n      // Send interrupt signal\r\n      agent.process.kill('SIGINT');\r\n      \r\n      // Wait briefly for graceful shutdown\r\n      await new Promise(resolve => setTimeout(resolve, 1000));\r\n      \r\n      // Force kill if still running\r\n      if (!agent.process.killed) {\r\n        agent.process.kill('SIGKILL');\r\n      }\r\n    }\r\n\r\n    agent.currentTask = undefined;\r\n    agent.status = 'idle';\r\n    agent.lastActivity = new Date();\r\n  }\r\n\r\n  private async terminateProcess(process: ChildProcess): Promise<void> {\r\n    if (process.killed || process.exitCode !== null) {\r\n      return;\r\n    }\r\n\r\n    // Send termination signal\r\n    process.kill('SIGTERM');\r\n    \r\n    // Wait for graceful shutdown\r\n    await new Promise(resolve => setTimeout(resolve, 2000));\r\n    \r\n    // Force kill if still running\r\n    if (!process.killed && process.exitCode === null) {\r\n      process.kill('SIGKILL');\r\n    }\r\n  }\r\n\r\n  private async terminateAllAgents(): Promise<void> {\r\n    const terminationPromises = Array.from(this.agents.keys())\r\n      .map(agentId => this.terminateAgent(agentId, 'Interface shutdown'));\r\n    \r\n    await Promise.allSettled(terminationPromises);\r\n  }\r\n\r\n  private moveAgentToBusyPool(agent: ClaudeAgent): void {\r\n    const idleIndex = this.processPool.idle.indexOf(agent);\r\n    if (idleIndex !== -1) {\r\n      this.processPool.idle.splice(idleIndex, 1);\r\n      this.processPool.busy.push(agent);\r\n    }\r\n  }\r\n\r\n  private returnAgentToIdlePool(agent: ClaudeAgent): void {\r\n    agent.status = 'idle';\r\n    agent.currentTask = undefined;\r\n    agent.lastActivity = new Date();\r\n\r\n    const busyIndex = this.processPool.busy.indexOf(agent);\r\n    if (busyIndex !== -1) {\r\n      this.processPool.busy.splice(busyIndex, 1);\r\n      this.processPool.idle.push(agent);\r\n    }\r\n  }\r\n\r\n  private moveAgentToFailedPool(agent: ClaudeAgent): void {\r\n    // Remove from other pools\r\n    this.removeAgentFromPools(agent);\r\n    this.processPool.failed.push(agent);\r\n  }\r\n\r\n  private removeAgentFromPools(agent: ClaudeAgent): void {\r\n    const idleIndex = this.processPool.idle.indexOf(agent);\r\n    if (idleIndex !== -1) {\r\n      this.processPool.idle.splice(idleIndex, 1);\r\n    }\r\n\r\n    const busyIndex = this.processPool.busy.indexOf(agent);\r\n    if (busyIndex !== -1) {\r\n      this.processPool.busy.splice(busyIndex, 1);\r\n    }\r\n\r\n    const failedIndex = this.processPool.failed.indexOf(agent);\r\n    if (failedIndex !== -1) {\r\n      this.processPool.failed.splice(failedIndex, 1);\r\n    }\r\n  }\r\n\r\n  private updateAgentMetrics(agent: ClaudeAgent, execution: ClaudeTaskExecution): void {\r\n    const metrics = agent.metrics;\r\n    \r\n    // Update averages\r\n    const totalTasks = metrics.tasksCompleted + metrics.tasksFailed;\r\n    if (execution.duration) {\r\n      metrics.averageResponseTime = totalTasks > 0 \r\n        ? ((metrics.averageResponseTime * (totalTasks - 1)) + execution.duration) / totalTasks\r\n        : execution.duration;\r\n    }\r\n\r\n    // Update success rate\r\n    metrics.successRate = totalTasks > 0 \r\n      ? metrics.tasksCompleted / totalTasks \r\n      : 0;\r\n\r\n    // Update error rate\r\n    metrics.errorRate = 1 - metrics.successRate;\r\n\r\n    // Update token usage if available\r\n    if (execution.tokensUsed) {\r\n      metrics.totalTokensUsed += execution.tokensUsed;\r\n    }\r\n  }\r\n\r\n  private getTotalActiveAgents(): number {\r\n    return this.processPool.idle.length + this.processPool.busy.length;\r\n  }\r\n\r\n  private calculateThroughput(): number {\r\n    const agents = Array.from(this.agents.values());\r\n    const totalTasks = agents.reduce((sum, a) => sum + a.totalTasks, 0);\r\n    const totalTime = agents.reduce((sum, a) => sum + a.totalDuration, 0);\r\n    \r\n    return totalTime > 0 ? (totalTasks / totalTime) * 60000 : 0; // tasks per minute\r\n  }\r\n\r\n  private calculatePoolUtilization(): number {\r\n    const total = this.getTotalActiveAgents();\r\n    const busy = this.processPool.busy.length;\r\n    \r\n    return total > 0 ? busy / total : 0;\r\n  }\r\n\r\n  private startHealthChecks(): void {\r\n    this.healthCheckInterval = setInterval(() => {\r\n      this.performHealthCheck();\r\n    }, this.config.healthCheckInterval);\r\n  }\r\n\r\n  private performHealthCheck(): void {\r\n    const now = Date.now();\r\n    \r\n    for (const agent of this.agents.values()) {\r\n      // Check for stalled agents\r\n      const inactiveTime = now - agent.lastActivity.getTime();\r\n      \r\n      if (agent.status === 'busy' && inactiveTime > this.config.timeout * 2) {\r\n        this.logger.warn('Agent appears stalled', {\r\n          agentId: agent.id,\r\n          inactiveTime,\r\n          currentTask: agent.currentTask,\r\n        });\r\n\r\n        // Try to recover the agent\r\n        this.recoverStalledAgent(agent);\r\n      }\r\n\r\n      // Check for failed processes\r\n      if (agent.process.killed || agent.process.exitCode !== null) {\r\n        if (agent.status !== 'terminated') {\r\n          this.logger.warn('Agent process died unexpectedly', {\r\n            agentId: agent.id,\r\n            exitCode: agent.process.exitCode,\r\n          });\r\n          \r\n          agent.status = 'error';\r\n          this.moveAgentToFailedPool(agent);\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  private async recoverStalledAgent(agent: ClaudeAgent): Promise<void> {\r\n    try {\r\n      if (agent.currentTask) {\r\n        await this.cancelExecution(agent.currentTask, 'Agent recovery');\r\n      }\r\n      \r\n      this.returnAgentToIdlePool(agent);\r\n      \r\n      this.logger.info('Agent recovered from stalled state', {\r\n        agentId: agent.id,\r\n      });\r\n\r\n    } catch (error) {\r\n      this.logger.error('Failed to recover stalled agent', {\r\n        agentId: agent.id,\r\n        error: error instanceof Error ? error.message : String(error),\r\n      });\r\n      \r\n      // Terminate the problematic agent\r\n      await this.terminateAgent(agent.id, 'Recovery failed');\r\n    }\r\n  }\r\n\r\n  private initializeProcessPool(): ProcessPool {\r\n    return {\r\n      idle: [],\r\n      busy: [],\r\n      failed: [],\r\n      totalSpawned: 0,\r\n      totalTerminated: 0,\r\n      recyclingEnabled: this.config.processRecycling,\r\n      maxAge: 3600000, // 1 hour\r\n      maxTasks: 100,\r\n    };\r\n  }\r\n\r\n  private initializeAgentMetrics(): ClaudeAgentMetrics {\r\n    return {\r\n      tasksCompleted: 0,\r\n      tasksFailed: 0,\r\n      averageResponseTime: 0,\r\n      totalTokensUsed: 0,\r\n      memoryUsage: 0,\r\n      cpuUsage: 0,\r\n      errorRate: 0,\r\n      successRate: 0,\r\n    };\r\n  }\r\n\r\n  private createDefaultConfig(config: Partial<ClaudeCodeConfig>): ClaudeCodeConfig {\r\n    return {\r\n      claudeExecutablePath: 'claude',\r\n      defaultModel: 'claude-3-5-sonnet-20241022',\r\n      maxTokens: 4096,\r\n      temperature: 0.7,\r\n      timeout: 300000, // 5 minutes\r\n      maxConcurrentAgents: 10,\r\n      enableStreaming: false,\r\n      enableLogging: true,\r\n      workingDirectory: process.cwd(),\r\n      environmentVariables: {},\r\n      agentPoolSize: 0,\r\n      processRecycling: true,\r\n      healthCheckInterval: 30000, // 30 seconds\r\n      ...config,\r\n    };\r\n  }\r\n\r\n  private setupEventHandlers(): void {\r\n    this.on('agent:spawned', (data) => {\r\n      this.logger.info('Agent spawned event', data);\r\n    });\r\n\r\n    this.on('agent:terminated', (data) => {\r\n      this.logger.info('Agent terminated event', data);\r\n    });\r\n\r\n    this.on('task:completed', (data) => {\r\n      this.logger.info('Task completed event', data);\r\n    });\r\n\r\n    this.on('task:cancelled', (data) => {\r\n      this.logger.warn('Task cancelled event', data);\r\n    });\r\n  }\r\n}\r\n\r\nexport default ClaudeCodeInterface;"],"names":["EventEmitter","spawn","performance","path","Logger","generateId","TaskExecutor","ClaudeCodeInterface","logger","config","memoryManager","processPool","activeExecutions","Map","agents","taskExecutor","healthCheckInterval","isInitialized","createDefaultConfig","initializeProcessPool","timeoutMs","timeout","enableMetrics","captureOutput","streamOutput","enableStreaming","setupEventHandlers","initialize","warn","info","verifyClaudeExecutable","agentPoolSize","prewarmAgentPool","startHealthChecks","poolSize","idle","length","maxConcurrent","maxConcurrentAgents","emit","error","shutdown","clearInterval","cancellationPromises","Array","from","keys","map","executionId","cancelExecution","Promise","allSettled","terminateAllAgents","spawnAgent","options","type","name","capabilities","getTotalActiveAgents","Error","command","buildClaudeCommand","process","executable","args","cwd","workingDirectory","env","environmentVariables","environment","stdio","detached","pid","agentId","agent","id","processId","status","spawnedAt","Date","lastActivity","totalTasks","totalDuration","metrics","initializeAgentMetrics","set","push","totalSpawned","setupProcessEventHandlers","waitForAgentReady","message","String","executeTask","taskDefinition","taskId","get","selectOptimalAgent","execution","startTime","input","task","retryCount","maxRetries","currentTask","moveAgentToBusyPool","result","executeTaskWithAgent","endTime","duration","getTime","output","tokensUsed","metadata","success","tasksCompleted","tasksFailed","updateAgentMetrics","returnAgentToIdlePool","delete","reason","cancelAgentTask","terminateAgent","terminateProcess","removeAgentFromPools","totalTerminated","getAgentStatus","getAllAgents","values","getExecutionStatus","getInterfaceMetrics","executions","totalCompleted","reduce","sum","a","totalFailed","totalTokens","totalTokensUsed","avgResponseTime","averageResponseTime","total","busy","failed","terminated","active","filter","e","completed","cancelled","successRate","throughput","calculateThroughput","pool","recyclingEnabled","poolUtilization","calculatePoolUtilization","claudeExecutablePath","resolve","reject","stdout","on","data","toString","code","version","trim","targetSize","promises","i","results","successful","r","model","defaultModel","maxTokens","temperature","systemPrompt","tools","join","signal","moveAgentToFailedPool","enableLogging","debug","stderr","now","checkInterval","checkReady","elapsed","killed","exitCode","setTimeout","availableAgents","requirements","scoredAgents","score","calculateAgentScore","sort","b","requiredCapabilities","matchingCapabilities","cap","includes","Math","max","maxTasks","context","convertToAgentState","tempDirectory","logDirectory","CLAUDE_AGENT_ID","CLAUDE_TASK_ID","resources","maxMemory","memoryRequired","maxCpuTime","maxDuration","maxDiskSpace","maxNetworkConnections","maxFileHandles","priority","executeClaudeTask","claudePath","swarmId","instance","createAgentCapabilities","averageExecutionTime","cpuUsage","memoryUsage","diskUsage","networkUsage","codeQuality","testCoverage","bugRate","userSatisfaction","totalUptime","responseTime","sequence","undefined","workload","health","autonomyLevel","learningEnabled","adaptationEnabled","maxTasksPerHour","maxConcurrentTasks","timeoutThreshold","reportingInterval","heartbeatInterval","permissions","trustedAgents","expertise","preferences","runtime","apiEndpoints","credentials","availableTools","toolConfigs","endpoints","lastHeartbeat","taskHistory","errorHistory","parentAgent","childAgents","collaborators","codeGeneration","codeReview","testing","documentation","research","analysis","webSearch","apiIntegration","fileSystem","terminalAccess","languages","c","frameworks","domains","maxMemoryUsage","maxExecutionTime","reliability","speed","quality","kill","terminationPromises","idleIndex","indexOf","splice","busyIndex","failedIndex","errorRate","totalTime","setInterval","performHealthCheck","inactiveTime","recoverStalledAgent","processRecycling","maxAge"],"mappings":"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"}