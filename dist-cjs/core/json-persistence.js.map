{
  "version": 3,
  "sources": ["../../src/core/json-persistence.ts"],
  "sourcesContent": ["/**\n * JSON-based persistence layer for Claude-Flow\n */\n\nimport { join } from 'path';\nimport { mkdir, access, readFile, writeFile } from 'fs/promises';\n\nexport interface PersistedAgent {\n  id: string;\n  type: string;\n  name: string;\n  status: string;\n  capabilities: string[];\n  systemPrompt: string;\n  maxConcurrentTasks: number;\n  priority: number;\n  createdAt: number;\n}\n\nexport interface PersistedTask {\n  id: string;\n  type: string;\n  description: string;\n  status: string;\n  priority: number;\n  dependencies: string[];\n  metadata: Record<string, unknown>;\n  assignedAgent?: string;\n  progress: number;\n  error?: string;\n  createdAt: number;\n  completedAt?: number;\n}\n\ninterface PersistenceData {\n  agents: PersistedAgent[];\n  tasks: PersistedTask[];\n  lastUpdated: number;\n}\n\nexport class JsonPersistenceManager {\n  private dataPath: string;\n  private data: PersistenceData;\n\n  constructor(dataDir: string = './memory') {\n    this.dataPath = join(dataDir, 'claude-flow-data.json');\n    this.data = {\n      agents: [],\n      tasks: [],\n      lastUpdated: Date.now(),\n    };\n  }\n\n  async initialize(): Promise<void> {\n    // Ensure directory exists\n    await mkdir(join(this.dataPath, '..'), { recursive: true });\n\n    // Load existing data if available\n    try {\n      await access(this.dataPath);\n      const content = await readFile(this.dataPath, 'utf-8');\n      this.data = JSON.parse(content);\n    } catch (error) {\n      // File doesn't exist or can't be read, keep default empty data\n      console.error('Failed to load persistence data:', error);\n    }\n  }\n\n  private async save(): Promise<void> {\n    this.data.lastUpdated = Date.now();\n    await writeFile(this.dataPath, JSON.stringify(this.data, null, 2));\n  }\n\n  // Agent operations\n  async saveAgent(agent: PersistedAgent): Promise<void> {\n    // Remove existing agent if updating\n    this.data.agents = this.data.agents.filter((a) => a.id !== agent.id);\n    this.data.agents.push(agent);\n    await this.save();\n  }\n\n  async getAgent(id: string): Promise<PersistedAgent | null> {\n    return this.data.agents.find((a) => a.id === id) || null;\n  }\n\n  async getActiveAgents(): Promise<PersistedAgent[]> {\n    return this.data.agents.filter((a) => a.status === 'active' || a.status === 'idle');\n  }\n\n  async getAllAgents(): Promise<PersistedAgent[]> {\n    return this.data.agents;\n  }\n\n  async updateAgentStatus(id: string, status: string): Promise<void> {\n    const agent = this.data.agents.find((a) => a.id === id);\n    if (agent) {\n      agent.status = status;\n      await this.save();\n    }\n  }\n\n  // Task operations\n  async saveTask(task: PersistedTask): Promise<void> {\n    // Remove existing task if updating\n    this.data.tasks = this.data.tasks.filter((t) => t.id !== task.id);\n    this.data.tasks.push(task);\n    await this.save();\n  }\n\n  async getTask(id: string): Promise<PersistedTask | null> {\n    return this.data.tasks.find((t) => t.id === id) || null;\n  }\n\n  async getActiveTasks(): Promise<PersistedTask[]> {\n    return this.data.tasks.filter(\n      (t) => t.status === 'pending' || t.status === 'in_progress' || t.status === 'assigned',\n    );\n  }\n\n  async getAllTasks(): Promise<PersistedTask[]> {\n    return this.data.tasks;\n  }\n\n  async updateTaskStatus(id: string, status: string, assignedAgent?: string): Promise<void> {\n    const task = this.data.tasks.find((t) => t.id === id);\n    if (task) {\n      task.status = status;\n      if (assignedAgent !== undefined) {\n        task.assignedAgent = assignedAgent;\n      }\n      if (status === 'completed') {\n        task.completedAt = Date.now();\n      }\n      await this.save();\n    }\n  }\n\n  async updateTaskProgress(id: string, progress: number): Promise<void> {\n    const task = this.data.tasks.find((t) => t.id === id);\n    if (task) {\n      task.progress = progress;\n      await this.save();\n    }\n  }\n\n  // Statistics\n  async getStats(): Promise<{\n    totalAgents: number;\n    activeAgents: number;\n    totalTasks: number;\n    pendingTasks: number;\n    completedTasks: number;\n  }> {\n    const activeAgents = this.data.agents.filter(\n      (a) => a.status === 'active' || a.status === 'idle',\n    ).length;\n\n    const pendingTasks = this.data.tasks.filter(\n      (t) => t.status === 'pending' || t.status === 'in_progress' || t.status === 'assigned',\n    ).length;\n\n    const completedTasks = this.data.tasks.filter((t) => t.status === 'completed').length;\n\n    return {\n      totalAgents: this.data.agents.length,\n      activeAgents,\n      totalTasks: this.data.tasks.length,\n      pendingTasks,\n      completedTasks,\n    };\n  }\n\n  close(): void {\n    // No-op for JSON persistence\n  }\n}\n"],
  "mappings": "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",
  "names": []
}
