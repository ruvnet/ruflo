{
  "version": 3,
  "sources": ["../../../src/hive-mind/integration/ConsensusEngine.ts"],
  "sourcesContent": ["/**\n * ConsensusEngine Class\n *\n * Manages consensus mechanisms, voting, and collective decision-making\n * within the Hive Mind swarm.\n */\n\nimport { EventEmitter } from 'events';\nimport { DatabaseManager } from '../core/DatabaseManager.js';\nimport { MCPToolWrapper } from './MCPToolWrapper.js';\nimport {\n  ConsensusProposal,\n  ConsensusVote,\n  ConsensusResult,\n  VotingStrategy,\n  ConsensusMetrics,\n} from '../types.js';\n\nexport class ConsensusEngine extends EventEmitter {\n  private threshold: number;\n  private db: DatabaseManager;\n  private mcpWrapper: MCPToolWrapper;\n  private activeProposals: Map<string, ConsensusProposal>;\n  private votingStrategies: Map<string, VotingStrategy>;\n  private metrics: ConsensusMetrics;\n  private isActive: boolean = false;\n\n  constructor(threshold: number = 0.66) {\n    super();\n    this.threshold = threshold;\n    this.activeProposals = new Map();\n    this.votingStrategies = new Map();\n    this.metrics = {\n      totalProposals: 0,\n      achievedConsensus: 0,\n      failedConsensus: 0,\n      avgVotingTime: 0,\n      avgParticipation: 0,\n    };\n\n    this.initializeVotingStrategies();\n  }\n\n  /**\n   * Initialize consensus engine\n   */\n  async initialize(): Promise<void> {\n    this.db = await DatabaseManager.getInstance();\n    this.mcpWrapper = new MCPToolWrapper();\n\n    // Start consensus monitoring\n    this.startProposalMonitor();\n    this.startTimeoutChecker();\n    this.startMetricsCollector();\n\n    this.isActive = true;\n    this.emit('initialized');\n  }\n\n  /**\n   * Create a new consensus proposal\n   */\n  async createProposal(proposal: ConsensusProposal): Promise<string> {\n    // Store in database\n    await this.db.createConsensusProposal(proposal);\n\n    // Add to active proposals\n    this.activeProposals.set(proposal.id, proposal);\n\n    // Update metrics\n    this.metrics.totalProposals++;\n\n    // Initiate voting\n    await this.initiateVoting(proposal);\n\n    this.emit('proposalCreated', proposal);\n\n    return proposal.id;\n  }\n\n  /**\n   * Submit a vote for a proposal\n   */\n  async submitVote(vote: ConsensusVote): Promise<void> {\n    const proposal = this.activeProposals.get(vote.proposalId);\n    if (!proposal) {\n      throw new Error('Proposal not found or no longer active');\n    }\n\n    // Validate vote\n    if (!this.validateVote(vote, proposal)) {\n      throw new Error('Invalid vote');\n    }\n\n    // Store vote\n    await this.db.submitConsensusVote(vote.proposalId, vote.agentId, vote.vote, vote.reason);\n\n    // Check if consensus achieved\n    await this.checkConsensus(proposal);\n\n    this.emit('voteSubmitted', vote);\n  }\n\n  /**\n   * Get proposal status\n   */\n  async getProposalStatus(proposalId: string): Promise<any> {\n    const dbProposal = await this.db.getConsensusProposal(proposalId);\n    if (!dbProposal) {\n      throw new Error('Proposal not found');\n    }\n\n    const votes = JSON.parse(dbProposal.votes || '{}');\n    const voteCount = Object.keys(votes).length;\n    const positiveVotes = Object.values(votes).filter((v: any) => v.vote).length;\n\n    return {\n      id: proposalId,\n      status: dbProposal.status,\n      proposal: JSON.parse(dbProposal.proposal),\n      requiredThreshold: dbProposal.required_threshold,\n      currentVotes: dbProposal.current_votes,\n      totalVoters: dbProposal.total_voters,\n      currentRatio: voteCount > 0 ? positiveVotes / voteCount : 0,\n      votes: votes,\n      deadline: dbProposal.deadline_at,\n      timeRemaining: new Date(dbProposal.deadline_at).getTime() - Date.now(),\n    };\n  }\n\n  /**\n   * Get voting recommendation for an agent\n   */\n  async getVotingRecommendation(\n    proposalId: string,\n    agentId: string,\n    agentType: string,\n  ): Promise<any> {\n    const proposal = this.activeProposals.get(proposalId);\n    if (!proposal) {\n      throw new Error('Proposal not found');\n    }\n\n    // Analyze proposal using neural patterns\n    const analysis = await this.mcpWrapper.analyzePattern({\n      action: 'analyze',\n      operation: 'consensus_proposal',\n      metadata: {\n        proposal: proposal.proposal,\n        agentType,\n        requiredThreshold: proposal.requiredThreshold,\n      },\n    });\n\n    // Get strategy recommendation\n    const strategy = this.selectVotingStrategy(proposal, agentType);\n    const recommendation = strategy.recommend(proposal, analysis);\n\n    return {\n      proposalId,\n      recommendation: recommendation.vote,\n      confidence: recommendation.confidence,\n      reasoning: recommendation.reasoning,\n      factors: recommendation.factors,\n    };\n  }\n\n  /**\n   * Force consensus check (for testing or manual intervention)\n   */\n  async forceConsensusCheck(proposalId: string): Promise<ConsensusResult> {\n    const proposal = this.activeProposals.get(proposalId);\n    if (!proposal) {\n      throw new Error('Proposal not found');\n    }\n\n    return this.checkConsensus(proposal);\n  }\n\n  /**\n   * Get consensus metrics\n   */\n  getMetrics(): ConsensusMetrics {\n    return { ...this.metrics };\n  }\n\n  /**\n   * Initialize voting strategies\n   */\n  private initializeVotingStrategies(): void {\n    // Simple majority strategy\n    this.votingStrategies.set('simple_majority', {\n      name: 'Simple Majority',\n      description: 'Requires more than 50% positive votes',\n      threshold: 0.5,\n      recommend: (proposal, analysis) => ({\n        vote: analysis.data?.recommendation || true,\n        confidence: 0.7,\n        reasoning: 'Based on simple majority principle',\n        factors: ['proposal_quality', 'impact_assessment'],\n      }),\n    });\n\n    // Supermajority strategy\n    this.votingStrategies.set('supermajority', {\n      name: 'Supermajority',\n      description: 'Requires 2/3 or more positive votes',\n      threshold: 0.66,\n      recommend: (proposal, analysis) => ({\n        vote: analysis.data?.strongRecommendation || false,\n        confidence: 0.8,\n        reasoning: 'Requires strong consensus for critical decisions',\n        factors: ['criticality', 'risk_assessment', 'broad_support'],\n      }),\n    });\n\n    // Unanimous strategy\n    this.votingStrategies.set('unanimous', {\n      name: 'Unanimous',\n      description: 'Requires 100% agreement',\n      threshold: 1.0,\n      recommend: (proposal, analysis) => ({\n        vote: analysis.data?.perfectAlignment || false,\n        confidence: 0.9,\n        reasoning: 'All agents must agree for this decision',\n        factors: ['absolute_necessity', 'zero_dissent'],\n      }),\n    });\n\n    // Qualified majority strategy\n    this.votingStrategies.set('qualified_majority', {\n      name: 'Qualified Majority',\n      description: 'Weighted voting based on agent expertise',\n      threshold: 0.6,\n      recommend: (proposal, analysis) => {\n        const expertise = analysis.data?.expertiseAlignment || 0.5;\n        return {\n          vote: expertise > 0.6,\n          confidence: expertise,\n          reasoning: 'Based on agent expertise and proposal alignment',\n          factors: ['expertise_level', 'domain_knowledge', 'past_performance'],\n        };\n      },\n    });\n  }\n\n  /**\n   * Initiate voting process\n   */\n  private async initiateVoting(proposal: ConsensusProposal): Promise<void> {\n    // Broadcast proposal to all eligible voters\n    await this.db.createCommunication({\n      from_agent_id: 'consensus-engine',\n      to_agent_id: null, // broadcast\n      swarm_id: proposal.swarmId,\n      message_type: 'consensus',\n      content: JSON.stringify({\n        type: 'voting_request',\n        proposal,\n      }),\n      priority: 'high',\n      requires_response: true,\n    });\n\n    // Set up voting deadline monitoring\n    if (proposal.deadline) {\n      const timeUntilDeadline = proposal.deadline.getTime() - Date.now();\n\n      setTimeout(async () => {\n        await this.handleVotingDeadline(proposal.id);\n      }, timeUntilDeadline);\n    }\n  }\n\n  /**\n   * Validate a vote\n   */\n  private validateVote(vote: ConsensusVote, proposal: ConsensusProposal): boolean {\n    // Check if voting is still open\n    if (proposal.deadline && new Date() > proposal.deadline) {\n      return false;\n    }\n\n    // Check if agent already voted\n    // This would be checked in the database layer\n\n    // Validate vote structure\n    if (typeof vote.vote !== 'boolean') {\n      return false;\n    }\n\n    return true;\n  }\n\n  /**\n   * Check if consensus has been achieved\n   */\n  private async checkConsensus(proposal: ConsensusProposal): Promise<ConsensusResult> {\n    const status = await this.getProposalStatus(proposal.id);\n\n    const result: ConsensusResult = {\n      proposalId: proposal.id,\n      achieved: false,\n      finalRatio: status.currentRatio,\n      totalVotes: status.currentVotes,\n      positiveVotes: Math.round(status.currentVotes * status.currentRatio),\n      negativeVotes: status.currentVotes - Math.round(status.currentVotes * status.currentRatio),\n      participationRate: status.totalVoters > 0 ? status.currentVotes / status.totalVoters : 0,\n    };\n\n    // Check if threshold met\n    if (status.currentRatio >= proposal.requiredThreshold) {\n      result.achieved = true;\n      await this.handleConsensusAchieved(proposal, result);\n    } else if (status.currentVotes === status.totalVoters) {\n      // All votes are in but consensus not achieved\n      await this.handleConsensusFailed(proposal, result);\n    }\n\n    return result;\n  }\n\n  /**\n   * Handle consensus achieved\n   */\n  private async handleConsensusAchieved(\n    proposal: ConsensusProposal,\n    result: ConsensusResult,\n  ): Promise<void> {\n    // Update proposal status\n    await this.db.updateConsensusStatus(proposal.id, 'achieved');\n\n    // Remove from active proposals\n    this.activeProposals.delete(proposal.id);\n\n    // Update metrics\n    this.metrics.achievedConsensus++;\n    this.updateAverageMetrics(result);\n\n    // Notify all agents\n    await this.broadcastConsensusResult(proposal, result, true);\n\n    // Execute consensus decision if applicable\n    if (proposal.taskId) {\n      await this.executeConsensusDecision(proposal, result);\n    }\n\n    this.emit('consensusAchieved', { proposal, result });\n  }\n\n  /**\n   * Handle consensus failed\n   */\n  private async handleConsensusFailed(\n    proposal: ConsensusProposal,\n    result: ConsensusResult,\n  ): Promise<void> {\n    // Update proposal status\n    await this.db.updateConsensusStatus(proposal.id, 'failed');\n\n    // Remove from active proposals\n    this.activeProposals.delete(proposal.id);\n\n    // Update metrics\n    this.metrics.failedConsensus++;\n    this.updateAverageMetrics(result);\n\n    // Notify all agents\n    await this.broadcastConsensusResult(proposal, result, false);\n\n    this.emit('consensusFailed', { proposal, result });\n  }\n\n  /**\n   * Handle voting deadline\n   */\n  private async handleVotingDeadline(proposalId: string): Promise<void> {\n    const proposal = this.activeProposals.get(proposalId);\n    if (!proposal) return;\n\n    const result = await this.checkConsensus(proposal);\n\n    if (!result.achieved) {\n      await this.handleConsensusFailed(proposal, result);\n    }\n  }\n\n  /**\n   * Select voting strategy\n   */\n  private selectVotingStrategy(proposal: ConsensusProposal, agentType: string): VotingStrategy {\n    // Select strategy based on threshold\n    if (proposal.requiredThreshold >= 1.0) {\n      return this.votingStrategies.get('unanimous')!;\n    } else if (proposal.requiredThreshold >= 0.66) {\n      return this.votingStrategies.get('supermajority')!;\n    } else {\n      return this.votingStrategies.get('simple_majority')!;\n    }\n  }\n\n  /**\n   * Update average metrics\n   */\n  private updateAverageMetrics(result: ConsensusResult): void {\n    // Update average participation rate\n    const totalDecisions = this.metrics.achievedConsensus + this.metrics.failedConsensus;\n    this.metrics.avgParticipation =\n      (this.metrics.avgParticipation * (totalDecisions - 1) + result.participationRate) /\n      totalDecisions;\n  }\n\n  /**\n   * Broadcast consensus result\n   */\n  private async broadcastConsensusResult(\n    proposal: ConsensusProposal,\n    result: ConsensusResult,\n    achieved: boolean,\n  ): Promise<void> {\n    await this.db.createCommunication({\n      from_agent_id: 'consensus-engine',\n      to_agent_id: null, // broadcast\n      swarm_id: proposal.swarmId,\n      message_type: 'consensus',\n      content: JSON.stringify({\n        type: 'consensus_result',\n        proposal,\n        result,\n        achieved,\n      }),\n      priority: 'high',\n    });\n  }\n\n  /**\n   * Execute consensus decision\n   */\n  private async executeConsensusDecision(\n    proposal: ConsensusProposal,\n    result: ConsensusResult,\n  ): Promise<void> {\n    if (!proposal.taskId) return;\n\n    // Update task based on consensus decision\n    const decision = proposal.proposal;\n\n    if (decision.action === 'approve_task') {\n      await this.db.updateTaskStatus(proposal.taskId, 'approved');\n    } else if (decision.action === 'modify_task') {\n      await this.db.updateTask(proposal.taskId, decision.modifications);\n    } else if (decision.action === 'cancel_task') {\n      await this.db.updateTaskStatus(proposal.taskId, 'cancelled');\n    }\n\n    this.emit('consensusExecuted', { proposal, result, taskId: proposal.taskId });\n  }\n\n  /**\n   * Start proposal monitor\n   */\n  private startProposalMonitor(): void {\n    setInterval(async () => {\n      if (!this.isActive) return;\n\n      try {\n        // Check active proposals for updates\n        for (const proposal of this.activeProposals.values()) {\n          await this.checkConsensus(proposal);\n        }\n      } catch (error) {\n        this.emit('error', error);\n      }\n    }, 5000); // Every 5 seconds\n  }\n\n  /**\n   * Start timeout checker\n   */\n  private startTimeoutChecker(): void {\n    setInterval(async () => {\n      if (!this.isActive) return;\n\n      try {\n        const now = Date.now();\n\n        for (const proposal of this.activeProposals.values()) {\n          if (proposal.deadline && proposal.deadline.getTime() < now) {\n            await this.handleVotingDeadline(proposal.id);\n          }\n        }\n      } catch (error) {\n        this.emit('error', error);\n      }\n    }, 1000); // Every second\n  }\n\n  /**\n   * Start metrics collector\n   */\n  private startMetricsCollector(): void {\n    setInterval(async () => {\n      if (!this.isActive) return;\n\n      try {\n        // Calculate average voting time\n        const recentProposals = await this.db.getRecentConsensusProposals(10);\n\n        if (recentProposals.length > 0) {\n          const votingTimes = recentProposals\n            .filter((p) => p.completed_at)\n            .map((p) => new Date(p.completed_at).getTime() - new Date(p.created_at).getTime());\n\n          if (votingTimes.length > 0) {\n            this.metrics.avgVotingTime =\n              votingTimes.reduce((a, b) => a + b, 0) / votingTimes.length;\n          }\n        }\n\n        // Store metrics\n        await this.storeMetrics();\n      } catch (error) {\n        this.emit('error', error);\n      }\n    }, 60000); // Every minute\n  }\n\n  /**\n   * Store consensus metrics\n   */\n  private async storeMetrics(): Promise<void> {\n    await this.mcpWrapper.storeMemory({\n      action: 'store',\n      key: 'consensus-metrics',\n      value: JSON.stringify(this.metrics),\n      namespace: 'performance-metrics',\n      ttl: 86400 * 30, // 30 days\n    });\n  }\n\n  /**\n   * Database helper methods (to be implemented in DatabaseManager)\n   */\n  private async getConsensusProposal(id: string): Promise<any> {\n    return this.db.prepare('SELECT * FROM consensus WHERE id = ?').get(id);\n  }\n\n  private async updateConsensusStatus(id: string, status: string): Promise<void> {\n    this.db\n      .prepare('UPDATE consensus SET status = ?, completed_at = CURRENT_TIMESTAMP WHERE id = ?')\n      .run(status, id);\n  }\n\n  private async getRecentConsensusProposals(limit: number): Promise<any[]> {\n    return this.db.prepare('SELECT * FROM consensus ORDER BY created_at DESC LIMIT ?').all(limit);\n  }\n\n  /**\n   * Shutdown consensus engine\n   */\n  async shutdown(): Promise<void> {\n    this.isActive = false;\n\n    // Clear active proposals\n    this.activeProposals.clear();\n\n    this.emit('shutdown');\n  }\n}\n"],
  "mappings": "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",
  "names": []
}
