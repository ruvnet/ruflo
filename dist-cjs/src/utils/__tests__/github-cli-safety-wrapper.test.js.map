{"version":3,"sources":["../../../../src/utils/__tests__/github-cli-safety-wrapper.test.js"],"sourcesContent":["/**\r\n * Test suite for GitHub CLI Safety Wrapper\r\n * \r\n * Tests all security features, error handling, and functionality\r\n */\r\n\r\nimport { jest } from '@jest/globals';\r\nimport { \r\n  GitHubCliSafe, \r\n  createGitHubCliSafe, \r\n  githubCli,\r\n  GitHubCliError,\r\n  GitHubCliTimeoutError,\r\n  GitHubCliValidationError,\r\n  GitHubCliRateLimitError\r\n} from '../github-cli-safety-wrapper.js';\r\nimport { spawn } from 'child_process';\r\nimport { promises as fs } from 'fs';\r\n\r\n// Mock child_process and fs\r\njest.mock('child_process');\r\njest.mock('fs', () => ({\r\n  promises: {\r\n    writeFile: jest.fn(),\r\n    unlink: jest.fn(),\r\n  }\r\n}));\r\n\r\ndescribe('GitHubCliSafe', () => {\r\n  let ghSafe;\r\n  let mockSpawn;\r\n  let mockChild;\r\n\r\n  beforeEach(() => {\r\n    ghSafe = new GitHubCliSafe({\r\n      timeout: 5000,\r\n      enableRateLimit: false,\r\n      enableLogging: false\r\n    });\r\n\r\n    mockChild = {\r\n      kill: jest.fn(),\r\n      on: jest.fn(),\r\n      stdout: { on: jest.fn() },\r\n      stderr: { on: jest.fn() }\r\n    };\r\n\r\n    mockSpawn = spawn.mockReturnValue(mockChild);\r\n    fs.writeFile.mockResolvedValue();\r\n    fs.unlink.mockResolvedValue();\r\n  });\r\n\r\n  afterEach(() => {\r\n    jest.clearAllMocks();\r\n  });\r\n\r\n  describe('Input Validation', () => {\r\n    test('should validate allowed commands', () => {\r\n      expect(() => ghSafe.validateCommand('issue create')).not.toThrow();\r\n      expect(() => ghSafe.validateCommand('pr comment')).not.toThrow();\r\n      \r\n      expect(() => ghSafe.validateCommand('rm -rf /')).toThrow(GitHubCliValidationError);\r\n      expect(() => ghSafe.validateCommand('maliciouscommand')).toThrow(GitHubCliValidationError);\r\n    });\r\n\r\n    test('should reject empty or invalid commands', () => {\r\n      expect(() => ghSafe.validateCommand('')).toThrow(GitHubCliValidationError);\r\n      expect(() => ghSafe.validateCommand(null)).toThrow(GitHubCliValidationError);\r\n      expect(() => ghSafe.validateCommand(undefined)).toThrow(GitHubCliValidationError);\r\n    });\r\n\r\n    test('should sanitize dangerous input patterns', () => {\r\n      const dangerousInputs = [\r\n        '$(rm -rf /)',\r\n        '`rm -rf /`',\r\n        'test && rm -rf /',\r\n        'test || rm -rf /',\r\n        'test; rm -rf /',\r\n        'test <(echo malicious)',\r\n        'test > /dev/null',\r\n        'test | sh',\r\n        'eval(\"malicious\")',\r\n        'exec(\"malicious\")'\r\n      ];\r\n\r\n      dangerousInputs.forEach(input => {\r\n        expect(() => ghSafe.sanitizeInput(input)).toThrow(GitHubCliValidationError);\r\n      });\r\n    });\r\n\r\n    test('should allow safe input', () => {\r\n      const safeInputs = [\r\n        'This is a normal comment',\r\n        'Code example: console.log(\"hello\")',\r\n        'File path: /src/components/Button.jsx',\r\n        'Numbers: 123, versions: v1.2.3',\r\n        'Special chars: @#$%^&*()_+-=[]{}|;:,.<>?'\r\n      ];\r\n\r\n      safeInputs.forEach(input => {\r\n        expect(() => ghSafe.sanitizeInput(input)).not.toThrow();\r\n      });\r\n    });\r\n\r\n    test('should validate body size limits', () => {\r\n      const largeBody = 'x'.repeat(1024 * 1024 + 1); // > 1MB\r\n      expect(() => ghSafe.validateBodySize(largeBody)).toThrow(GitHubCliValidationError);\r\n      \r\n      const normalBody = 'x'.repeat(1000);\r\n      expect(() => ghSafe.validateBodySize(normalBody)).not.toThrow();\r\n    });\r\n  });\r\n\r\n  describe('Process Management', () => {\r\n    test('should spawn process with correct arguments', async () => {\r\n      const mockProcess = setupMockProcess(0, 'success', '');\r\n      \r\n      await ghSafe.execute('issue create', {\r\n        title: 'Test Issue',\r\n        body: 'Test body'\r\n      });\r\n\r\n      expect(spawn).toHaveBeenCalledWith('gh', \r\n        expect.arrayContaining(['issue', 'create', '--title', 'Test Issue']),\r\n        expect.objectContaining({\r\n          stdio: ['ignore', 'pipe', 'pipe'],\r\n          shell: false\r\n        })\r\n      );\r\n    });\r\n\r\n    test('should handle process timeout', async () => {\r\n      setupMockProcess(null, '', '', true); // Never completes\r\n\r\n      await expect(\r\n        ghSafe.execute('issue create', { title: 'Test' })\r\n      ).rejects.toThrow(GitHubCliTimeoutError);\r\n    });\r\n\r\n    test('should handle process failure', async () => {\r\n      setupMockProcess(1, '', 'Command failed');\r\n\r\n      await expect(\r\n        ghSafe.execute('issue create', { title: 'Test' })\r\n      ).rejects.toThrow(GitHubCliError);\r\n    });\r\n\r\n    test('should cleanup processes on timeout', async () => {\r\n      setupMockProcess(null, '', '', true); // Never completes\r\n\r\n      try {\r\n        await ghSafe.execute('issue create', { title: 'Test' });\r\n      } catch (error) {\r\n        expect(mockChild.kill).toHaveBeenCalledWith('SIGTERM');\r\n      }\r\n    });\r\n  });\r\n\r\n  describe('Retry Logic', () => {\r\n    test('should retry on transient failures', async () => {\r\n      let attemptCount = 0;\r\n      const operation = jest.fn(() => {\r\n        attemptCount++;\r\n        if (attemptCount < 3) {\r\n          throw new GitHubCliError('Transient error');\r\n        }\r\n        return { success: true };\r\n      });\r\n\r\n      const result = await ghSafe.withRetry(operation, 3);\r\n      expect(result.success).toBe(true);\r\n      expect(operation).toHaveBeenCalledTimes(3);\r\n    });\r\n\r\n    test('should not retry validation errors', async () => {\r\n      const operation = jest.fn(() => {\r\n        throw new GitHubCliValidationError('Invalid input');\r\n      });\r\n\r\n      await expect(ghSafe.withRetry(operation, 3)).rejects.toThrow(GitHubCliValidationError);\r\n      expect(operation).toHaveBeenCalledTimes(1);\r\n    });\r\n\r\n    test('should not retry rate limit errors', async () => {\r\n      const operation = jest.fn(() => {\r\n        throw new GitHubCliRateLimitError('Rate limited');\r\n      });\r\n\r\n      await expect(ghSafe.withRetry(operation, 3)).rejects.toThrow(GitHubCliRateLimitError);\r\n      expect(operation).toHaveBeenCalledTimes(1);\r\n    });\r\n  });\r\n\r\n  describe('Rate Limiting', () => {\r\n    test('should enforce rate limits', async () => {\r\n      const rateLimitedGh = new GitHubCliSafe({\r\n        enableRateLimit: true,\r\n        maxRequestsPerWindow: 2,\r\n        rateLimitWindow: 1000\r\n      });\r\n\r\n      // Mock successful executions\r\n      setupMockProcess(0, 'success', '');\r\n\r\n      // First two requests should succeed\r\n      await rateLimitedGh.execute('auth status');\r\n      await rateLimitedGh.execute('auth status');\r\n\r\n      // Third request should be rate limited\r\n      await expect(\r\n        rateLimitedGh.execute('auth status')\r\n      ).rejects.toThrow(GitHubCliRateLimitError);\r\n    });\r\n  });\r\n\r\n  describe('Temp File Handling', () => {\r\n    test('should create secure temp files for body content', async () => {\r\n      setupMockProcess(0, 'success', '');\r\n\r\n      await ghSafe.execute('issue create', {\r\n        title: 'Test',\r\n        body: 'Test body'\r\n      });\r\n\r\n      expect(fs.writeFile).toHaveBeenCalledWith(\r\n        expect.stringMatching(/gh-safe-.*\\.tmp$/),\r\n        'Test body',\r\n        { mode: 0o600 }\r\n      );\r\n    });\r\n\r\n    test('should cleanup temp files even on error', async () => {\r\n      setupMockProcess(1, '', 'Error');\r\n\r\n      try {\r\n        await ghSafe.execute('issue create', {\r\n          title: 'Test',\r\n          body: 'Test body'\r\n        });\r\n      } catch (error) {\r\n        // Expected to fail\r\n      }\r\n\r\n      expect(fs.unlink).toHaveBeenCalled();\r\n    });\r\n  });\r\n\r\n  describe('High-level Operations', () => {\r\n    beforeEach(() => {\r\n      setupMockProcess(0, 'Issue created successfully', '');\r\n    });\r\n\r\n    test('should create issue with proper arguments', async () => {\r\n      await ghSafe.createIssue({\r\n        title: 'Bug Report',\r\n        body: 'Found a bug',\r\n        labels: ['bug', 'high-priority'],\r\n        assignees: ['user1', 'user2']\r\n      });\r\n\r\n      expect(spawn).toHaveBeenCalledWith('gh', \r\n        expect.arrayContaining([\r\n          'issue', 'create',\r\n          '--title', 'Bug Report',\r\n          '--body-file', expect.stringMatching(/gh-safe-.*\\.tmp$/),\r\n          '--label', 'bug,high-priority',\r\n          '--assignee', 'user1,user2'\r\n        ]),\r\n        expect.any(Object)\r\n      );\r\n    });\r\n\r\n    test('should create PR with proper arguments', async () => {\r\n      await ghSafe.createPR({\r\n        title: 'Feature: Add new component',\r\n        body: 'Adds new component',\r\n        base: 'develop',\r\n        head: 'feature/new-component',\r\n        draft: true\r\n      });\r\n\r\n      expect(spawn).toHaveBeenCalledWith('gh',\r\n        expect.arrayContaining([\r\n          'pr', 'create',\r\n          '--title', 'Feature: Add new component',\r\n          '--body-file', expect.stringMatching(/gh-safe-.*\\.tmp$/),\r\n          '--base', 'develop',\r\n          '--head', 'feature/new-component',\r\n          '--draft'\r\n        ]),\r\n        expect.any(Object)\r\n      );\r\n    });\r\n\r\n    test('should add issue comment', async () => {\r\n      await ghSafe.addIssueComment(123, 'This is a comment');\r\n\r\n      expect(spawn).toHaveBeenCalledWith('gh',\r\n        expect.arrayContaining([\r\n          'issue', 'comment', '123',\r\n          '--body-file', expect.stringMatching(/gh-safe-.*\\.tmp$/)\r\n        ]),\r\n        expect.any(Object)\r\n      );\r\n    });\r\n  });\r\n\r\n  describe('Utility Methods', () => {\r\n    test('should check GitHub CLI availability', async () => {\r\n      // Mock execSync for version check\r\n      const { execSync } = require('child_process');\r\n      jest.spyOn(require('child_process'), 'execSync').mockImplementation(() => 'gh version 2.0.0');\r\n\r\n      const isAvailable = await ghSafe.checkGitHubCli();\r\n      expect(isAvailable).toBe(true);\r\n    });\r\n\r\n    test('should get stats', () => {\r\n      const stats = ghSafe.getStats();\r\n      expect(stats).toHaveProperty('totalRequests');\r\n      expect(stats).toHaveProperty('successfulRequests');\r\n      expect(stats).toHaveProperty('failedRequests');\r\n    });\r\n\r\n    test('should cleanup active processes', async () => {\r\n      ghSafe.activeProcesses.set('test-process', mockChild);\r\n      \r\n      await ghSafe.cleanup();\r\n      \r\n      expect(mockChild.kill).toHaveBeenCalledWith('SIGTERM');\r\n      expect(ghSafe.activeProcesses.size).toBe(0);\r\n    });\r\n  });\r\n\r\n  describe('Factory Function', () => {\r\n    test('should create configured instance', () => {\r\n      const instance = createGitHubCliSafe({\r\n        timeout: 10000,\r\n        maxRetries: 5\r\n      });\r\n\r\n      expect(instance).toBeInstanceOf(GitHubCliSafe);\r\n      expect(instance.options.timeout).toBe(10000);\r\n      expect(instance.options.maxRetries).toBe(5);\r\n    });\r\n  });\r\n\r\n  describe('Singleton Instance', () => {\r\n    test('should provide default singleton', () => {\r\n      expect(githubCli).toBeInstanceOf(GitHubCliSafe);\r\n    });\r\n  });\r\n\r\n  // Helper function to setup mock process behavior\r\n  function setupMockProcess(exitCode, stdout = '', stderr = '', neverComplete = false) {\r\n    let closeCallback, errorCallback;\r\n    let stdoutCallback, stderrCallback;\r\n\r\n    mockChild.on.mockImplementation((event, callback) => {\r\n      if (event === 'close') closeCallback = callback;\r\n      if (event === 'error') errorCallback = callback;\r\n    });\r\n\r\n    mockChild.stdout.on.mockImplementation((event, callback) => {\r\n      if (event === 'data') stdoutCallback = callback;\r\n    });\r\n\r\n    mockChild.stderr.on.mockImplementation((event, callback) => {\r\n      if (event === 'data') stderrCallback = callback;\r\n    });\r\n\r\n    // Simulate process execution\r\n    if (!neverComplete) {\r\n      setTimeout(() => {\r\n        if (stdoutCallback && stdout) stdoutCallback(Buffer.from(stdout));\r\n        if (stderrCallback && stderr) stderrCallback(Buffer.from(stderr));\r\n        if (closeCallback) closeCallback(exitCode);\r\n      }, 10);\r\n    }\r\n  }\r\n});\r\n\r\ndescribe('Error Classes', () => {\r\n  test('GitHubCliError should contain proper details', () => {\r\n    const error = new GitHubCliError('Test error', 'TEST_CODE', { test: true });\r\n    \r\n    expect(error.name).toBe('GitHubCliError');\r\n    expect(error.code).toBe('TEST_CODE');\r\n    expect(error.details).toEqual({ test: true });\r\n    expect(error.timestamp).toBeDefined();\r\n  });\r\n\r\n  test('GitHubCliTimeoutError should extend GitHubCliError', () => {\r\n    const error = new GitHubCliTimeoutError(5000, 'gh issue create');\r\n    \r\n    expect(error).toBeInstanceOf(GitHubCliError);\r\n    expect(error.name).toBe('GitHubCliTimeoutError');\r\n    expect(error.code).toBe('TIMEOUT');\r\n  });\r\n\r\n  test('GitHubCliValidationError should contain field info', () => {\r\n    const error = new GitHubCliValidationError('Invalid field', 'testField', 'testValue');\r\n    \r\n    expect(error.name).toBe('GitHubCliValidationError');\r\n    expect(error.details.field).toBe('testField');\r\n    expect(error.details.value).toBe('testValue');\r\n  });\r\n});"],"names":["jest","GitHubCliSafe","createGitHubCliSafe","githubCli","GitHubCliError","GitHubCliTimeoutError","GitHubCliValidationError","GitHubCliRateLimitError","spawn","promises","fs","mock","writeFile","fn","unlink","describe","ghSafe","mockSpawn","mockChild","beforeEach","timeout","enableRateLimit","enableLogging","kill","on","stdout","stderr","mockReturnValue","mockResolvedValue","afterEach","clearAllMocks","test","expect","validateCommand","not","toThrow","undefined","dangerousInputs","forEach","input","sanitizeInput","safeInputs","largeBody","repeat","validateBodySize","normalBody","mockProcess","setupMockProcess","execute","title","body","toHaveBeenCalledWith","arrayContaining","objectContaining","stdio","shell","rejects","error","attemptCount","operation","success","result","withRetry","toBe","toHaveBeenCalledTimes","rateLimitedGh","maxRequestsPerWindow","rateLimitWindow","stringMatching","mode","toHaveBeenCalled","createIssue","labels","assignees","any","Object","createPR","base","head","draft","addIssueComment","execSync","require","spyOn","mockImplementation","isAvailable","checkGitHubCli","stats","getStats","toHaveProperty","activeProcesses","set","cleanup","size","instance","maxRetries","toBeInstanceOf","options","exitCode","neverComplete","closeCallback","errorCallback","stdoutCallback","stderrCallback","event","callback","setTimeout","Buffer","from","name","code","details","toEqual","timestamp","toBeDefined","field","value"],"mappings":"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"}