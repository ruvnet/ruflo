{"version":3,"sources":["../../../../src/mcp/implementations/daa-tools.js"],"sourcesContent":["/**\r\n * DAA (Decentralized Autonomous Agents) Tools Implementation\r\n * Ported from UI console implementation to MCP tools\r\n */\r\n\r\nclass DAAManager {\r\n  constructor() {\r\n    this.agents = new Map();\r\n    this.resources = new Map();\r\n    this.communications = new Map();\r\n    this.consensus = new Map();\r\n    this.capabilities = new Map();\r\n    \r\n    // Metrics tracking\r\n    this.metrics = {\r\n      totalAgents: 0,\r\n      activeAgents: 0,\r\n      resourceUtilization: 0,\r\n      communicationLatency: 0,\r\n      consensusTime: 0,\r\n      faultCount: 0,\r\n    };\r\n  }\r\n\r\n  // Tool 1: Dynamic Agent Creation\r\n  daa_agent_create(config) {\r\n    const agentId = `daa_agent_${Date.now()}_${Math.random().toString(36).substr(2, 6)}`;\r\n    const agent = {\r\n      id: agentId,\r\n      type: config.agent_type || config.type || 'generic',\r\n      capabilities: config.capabilities || [],\r\n      resources: config.resources || {},\r\n      status: 'initializing',\r\n      created: new Date().toISOString(),\r\n      lastActivity: new Date().toISOString(),\r\n      tasks: [],\r\n      metadata: config.metadata || {},\r\n    };\r\n\r\n    this.agents.set(agentId, agent);\r\n    this.metrics.totalAgents++;\r\n    this.metrics.activeAgents++;\r\n\r\n    // Initialize agent\r\n    this.initializeAgent(agent);\r\n    \r\n    // Track in global agent tracker if available\r\n    if (global.agentTracker) {\r\n      global.agentTracker.trackAgent(agentId, agent);\r\n    }\r\n\r\n    return {\r\n      success: true,\r\n      agentId: agentId,\r\n      agent: agent,\r\n      timestamp: new Date().toISOString(),\r\n    };\r\n  }\r\n\r\n  // Tool 2: Capability Matching System\r\n  daa_capability_match(args) {\r\n    const requirements = args.task_requirements || [];\r\n    const availableAgents = args.available_agents || [];\r\n    const matches = [];\r\n\r\n    // If specific agents provided, use those; otherwise use all DAA agents\r\n    const agentsToCheck = availableAgents.length > 0 \r\n      ? availableAgents.map(id => this.agents.get(id)).filter(Boolean)\r\n      : Array.from(this.agents.values());\r\n\r\n    for (const agent of agentsToCheck) {\r\n      if (agent.status !== 'active' && agent.status !== 'initializing') continue;\r\n\r\n      const score = this.calculateCapabilityScore(agent.capabilities, requirements);\r\n      if (score > 0) {\r\n        matches.push({\r\n          agentId: agent.id,\r\n          agentType: agent.type,\r\n          score: score,\r\n          capabilities: agent.capabilities,\r\n          matchedRequirements: agent.capabilities.filter(cap =>\r\n            requirements.some(req => this.matchCapability(cap, req))\r\n          ),\r\n        });\r\n      }\r\n    }\r\n\r\n    // Sort by score descending\r\n    matches.sort((a, b) => b.score - a.score);\r\n\r\n    return {\r\n      success: true,\r\n      matches: matches,\r\n      totalCandidates: matches.length,\r\n      bestMatch: matches[0] || null,\r\n      timestamp: new Date().toISOString(),\r\n    };\r\n  }\r\n\r\n  // Tool 3: Resource Allocation\r\n  daa_resource_alloc(args) {\r\n    const resources = args.resources || {};\r\n    const agents = args.agents || [];\r\n    \r\n    const allocationId = `alloc_${Date.now()}_${Math.random().toString(36).substr(2, 6)}`;\r\n    const allocation = {\r\n      id: allocationId,\r\n      resources: resources,\r\n      agents: agents,\r\n      allocated: {},\r\n      timestamp: new Date().toISOString(),\r\n    };\r\n\r\n    // Simple allocation strategy: divide resources equally among agents\r\n    const agentCount = agents.length || 1;\r\n    const allocatedPerAgent = {};\r\n    \r\n    for (const [resourceType, amount] of Object.entries(resources)) {\r\n      allocatedPerAgent[resourceType] = Math.floor(amount / agentCount);\r\n    }\r\n\r\n    // Assign resources to each agent\r\n    for (const agentId of agents) {\r\n      allocation.allocated[agentId] = allocatedPerAgent;\r\n      \r\n      // Update agent resources\r\n      const agent = this.agents.get(agentId);\r\n      if (agent) {\r\n        agent.resources = { ...agent.resources, ...allocatedPerAgent };\r\n        agent.lastActivity = new Date().toISOString();\r\n      }\r\n    }\r\n\r\n    this.resources.set(allocationId, allocation);\r\n    this.metrics.resourceUtilization = this.calculateResourceUtilization();\r\n\r\n    return {\r\n      success: true,\r\n      allocationId: allocationId,\r\n      allocation: allocation,\r\n      utilization: this.metrics.resourceUtilization,\r\n      timestamp: new Date().toISOString(),\r\n    };\r\n  }\r\n\r\n  // Tool 4: Lifecycle Management\r\n  daa_lifecycle_manage(args) {\r\n    const agentId = args.agentId || args.agent_id;\r\n    const action = args.action;\r\n    \r\n    const agent = this.agents.get(agentId);\r\n    if (!agent) {\r\n      return {\r\n        success: false,\r\n        error: `Agent ${agentId} not found`,\r\n        timestamp: new Date().toISOString(),\r\n      };\r\n    }\r\n\r\n    let result = { success: true };\r\n    const previousStatus = agent.status;\r\n\r\n    switch (action) {\r\n      case 'start':\r\n        agent.status = 'active';\r\n        this.metrics.activeAgents++;\r\n        result.message = 'Agent started';\r\n        break;\r\n      case 'stop':\r\n        agent.status = 'stopped';\r\n        this.metrics.activeAgents--;\r\n        result.message = 'Agent stopped';\r\n        break;\r\n      case 'pause':\r\n        agent.status = 'paused';\r\n        result.message = 'Agent paused';\r\n        break;\r\n      case 'resume':\r\n        agent.status = 'active';\r\n        result.message = 'Agent resumed';\r\n        break;\r\n      case 'terminate':\r\n        agent.status = 'terminated';\r\n        this.metrics.activeAgents--;\r\n        this.metrics.totalAgents--;\r\n        result.message = 'Agent terminated';\r\n        break;\r\n      default:\r\n        result.success = false;\r\n        result.error = `Unknown action: ${action}`;\r\n    }\r\n\r\n    if (result.success) {\r\n      agent.lastActivity = new Date().toISOString();\r\n      result.agentId = agentId;\r\n      result.previousStatus = previousStatus;\r\n      result.currentStatus = agent.status;\r\n    }\r\n\r\n    result.timestamp = new Date().toISOString();\r\n    return result;\r\n  }\r\n\r\n  // Tool 5: Communication System\r\n  daa_communication(args) {\r\n    const from = args.from;\r\n    const to = args.to;\r\n    const message = args.message;\r\n    \r\n    const messageId = `msg_${Date.now()}_${Math.random().toString(36).substr(2, 6)}`;\r\n    const communication = {\r\n      id: messageId,\r\n      from: from,\r\n      to: to,\r\n      message: message,\r\n      timestamp: new Date().toISOString(),\r\n      delivered: false,\r\n    };\r\n\r\n    // Check if sender and receiver exist\r\n    const sender = this.agents.get(from);\r\n    const receiver = this.agents.get(to);\r\n\r\n    if (!sender) {\r\n      return {\r\n        success: false,\r\n        error: `Sender agent ${from} not found`,\r\n        timestamp: new Date().toISOString(),\r\n      };\r\n    }\r\n\r\n    if (!receiver) {\r\n      return {\r\n        success: false,\r\n        error: `Receiver agent ${to} not found`,\r\n        timestamp: new Date().toISOString(),\r\n      };\r\n    }\r\n\r\n    // Store communication\r\n    this.communications.set(messageId, communication);\r\n    \r\n    // Simulate delivery\r\n    communication.delivered = true;\r\n    communication.deliveredAt = new Date().toISOString();\r\n    \r\n    // Update agent activity\r\n    sender.lastActivity = new Date().toISOString();\r\n    receiver.lastActivity = new Date().toISOString();\r\n\r\n    return {\r\n      success: true,\r\n      messageId: messageId,\r\n      from: from,\r\n      to: to,\r\n      delivered: true,\r\n      timestamp: new Date().toISOString(),\r\n    };\r\n  }\r\n\r\n  // Tool 6: Consensus Mechanism\r\n  daa_consensus(args) {\r\n    const agents = args.agents || [];\r\n    const proposal = args.proposal || {};\r\n    \r\n    const consensusId = `consensus_${Date.now()}_${Math.random().toString(36).substr(2, 6)}`;\r\n    const votes = new Map();\r\n    \r\n    // Simulate voting - each agent votes based on simple criteria\r\n    for (const agentId of agents) {\r\n      const agent = this.agents.get(agentId);\r\n      if (agent && agent.status === 'active') {\r\n        // Simple voting logic: 70% chance of approval\r\n        const vote = Math.random() > 0.3;\r\n        votes.set(agentId, vote);\r\n      }\r\n    }\r\n\r\n    const totalVotes = votes.size;\r\n    const approvals = Array.from(votes.values()).filter(v => v).length;\r\n    const approved = approvals > totalVotes / 2;\r\n\r\n    const consensus = {\r\n      id: consensusId,\r\n      proposal: proposal,\r\n      agents: agents,\r\n      votes: Object.fromEntries(votes),\r\n      totalVotes: totalVotes,\r\n      approvals: approvals,\r\n      rejections: totalVotes - approvals,\r\n      approved: approved,\r\n      timestamp: new Date().toISOString(),\r\n    };\r\n\r\n    this.consensus.set(consensusId, consensus);\r\n\r\n    return {\r\n      success: true,\r\n      consensusId: consensusId,\r\n      approved: approved,\r\n      votes: consensus.votes,\r\n      summary: {\r\n        total: totalVotes,\r\n        approvals: approvals,\r\n        rejections: totalVotes - approvals,\r\n        approvalRate: totalVotes > 0 ? (approvals / totalVotes) : 0,\r\n      },\r\n      timestamp: new Date().toISOString(),\r\n    };\r\n  }\r\n\r\n  // Helper methods\r\n  initializeAgent(agent) {\r\n    setTimeout(() => {\r\n      agent.status = 'active';\r\n      agent.lastActivity = new Date().toISOString();\r\n    }, 100);\r\n  }\r\n\r\n  calculateCapabilityScore(agentCaps, requirements) {\r\n    if (!agentCaps || !requirements) return 0;\r\n    \r\n    let matches = 0;\r\n    for (const req of requirements) {\r\n      if (agentCaps.some(cap => this.matchCapability(cap, req))) {\r\n        matches++;\r\n      }\r\n    }\r\n    \r\n    return requirements.length > 0 ? (matches / requirements.length) : 0;\r\n  }\r\n\r\n  matchCapability(capability, requirement) {\r\n    // Simple string matching for now\r\n    return capability.toLowerCase().includes(requirement.toLowerCase()) ||\r\n           requirement.toLowerCase().includes(capability.toLowerCase());\r\n  }\r\n\r\n  calculateResourceUtilization() {\r\n    let totalAllocated = 0;\r\n    let totalCapacity = 0;\r\n    \r\n    for (const allocation of this.resources.values()) {\r\n      for (const amount of Object.values(allocation.resources)) {\r\n        totalCapacity += amount;\r\n      }\r\n      for (const agentAlloc of Object.values(allocation.allocated)) {\r\n        for (const amount of Object.values(agentAlloc)) {\r\n          totalAllocated += amount;\r\n        }\r\n      }\r\n    }\r\n    \r\n    return totalCapacity > 0 ? (totalAllocated / totalCapacity) : 0;\r\n  }\r\n}\r\n\r\n// Create singleton instance\r\nconst daaManager = new DAAManager();\r\n\r\n// Export for use in MCP tools\r\nif (typeof module !== 'undefined' && module.exports) {\r\n  module.exports = daaManager;\r\n}\r\n\r\n// Also make available globally\r\nif (typeof global !== 'undefined') {\r\n  global.daaManager = daaManager;\r\n}"],"names":["DAAManager","agents","Map","resources","communications","consensus","capabilities","metrics","totalAgents","activeAgents","resourceUtilization","communicationLatency","consensusTime","faultCount","daa_agent_create","config","agentId","Date","now","Math","random","toString","substr","agent","id","type","agent_type","status","created","toISOString","lastActivity","tasks","metadata","set","initializeAgent","global","agentTracker","trackAgent","success","timestamp","daa_capability_match","args","requirements","task_requirements","availableAgents","available_agents","matches","agentsToCheck","length","map","get","filter","Boolean","Array","from","values","score","calculateCapabilityScore","push","agentType","matchedRequirements","cap","some","req","matchCapability","sort","a","b","totalCandidates","bestMatch","daa_resource_alloc","allocationId","allocation","allocated","agentCount","allocatedPerAgent","resourceType","amount","Object","entries","floor","calculateResourceUtilization","utilization","daa_lifecycle_manage","agent_id","action","error","result","previousStatus","message","currentStatus","daa_communication","to","messageId","communication","delivered","sender","receiver","deliveredAt","daa_consensus","proposal","consensusId","votes","vote","totalVotes","size","approvals","v","approved","fromEntries","rejections","summary","total","approvalRate","setTimeout","agentCaps","capability","requirement","toLowerCase","includes","totalAllocated","totalCapacity","agentAlloc","daaManager","module","exports"],"mappings":"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"}