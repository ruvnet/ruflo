{"version":3,"sources":["../../../../src/cli/simple-commands/web-server.js"],"sourcesContent":["/**\r\n * Web Server for Claude Code Console\r\n * Serves the web-based UI and provides WebSocket communication\r\n */\r\n\r\nimport { createServer } from 'http';\r\nimport { join, dirname } from 'path';\r\nimport { fileURLToPath } from 'url';\r\nimport { readFileSync, existsSync } from 'fs';\r\nimport { WebSocketServer } from 'ws';\r\nimport { printSuccess, printError, printWarning, printInfo } from '../utils.js';\r\nimport { compat } from '../runtime-detector.js';\r\n\r\nconst __filename = fileURLToPath(import.meta.url);\r\nconst __dirname = dirname(__filename);\r\n\r\nexport class ClaudeCodeWebServer {\r\n  constructor(port = 3000) {\r\n    this.port = port;\r\n    this.server = null;\r\n    this.wss = null;\r\n    this.connections = new Set();\r\n    this.uiPath = join(__dirname, '../../ui/console');\r\n    this.isRunning = false;\r\n  }\r\n\r\n  async createAPIRoutes() {\r\n    const express = await import('express');\r\n    const router = express.Router();\r\n\r\n    // Health check endpoint\r\n    router.get('/health', (req, res) => {\r\n      res.json({ status: 'ok', uptime: process.uptime() });\r\n    });\r\n\r\n    // System status endpoint\r\n    router.get('/status', (req, res) => {\r\n      res.json({\r\n        connections: this.connections.size,\r\n        isRunning: this.isRunning,\r\n        port: this.port,\r\n      });\r\n    });\r\n\r\n    return router;\r\n  }\r\n\r\n  /**\r\n   * Start the web server\r\n   */\r\n  async start() {\r\n    if (this.isRunning) {\r\n      printWarning('Web server is already running');\r\n      return;\r\n    }\r\n\r\n    try {\r\n      // Create HTTP server with express\r\n      const express = await import('express');\r\n      const app = express.default();\r\n\r\n      // Enable CORS\r\n      app.use((req, res, next) => {\r\n        res.header('Access-Control-Allow-Origin', '*');\r\n        res.header('Access-Control-Allow-Methods', 'GET, POST, PUT, DELETE, OPTIONS');\r\n        res.header('Access-Control-Allow-Headers', 'Content-Type, Authorization');\r\n        next();\r\n      });\r\n\r\n      // Serve static files\r\n      app.use('/console', express.static(this.uiPath));\r\n      app.use('/api', await this.createAPIRoutes());\r\n\r\n      // Default route redirects to console\r\n      app.get('/', (req, res) => {\r\n        res.redirect('/console');\r\n      });\r\n\r\n      this.server = createServer(app);\r\n\r\n      // Create WebSocket server\r\n      this.wss = new WebSocketServer({\r\n        server: this.server,\r\n        path: '/ws',\r\n      });\r\n\r\n      this.setupWebSocketServer();\r\n\r\n      // Start listening\r\n      await new Promise((resolve, reject) => {\r\n        this.server.listen(this.port, (err) => {\r\n          if (err) {\r\n            reject(err);\r\n          } else {\r\n            resolve();\r\n          }\r\n        });\r\n      });\r\n\r\n      this.isRunning = true;\r\n      printSuccess(`üåê Claude Code Web UI started successfully`);\r\n      console.log(`üìç Web Interface: http://localhost:${this.port}/console`);\r\n      console.log(`üîó WebSocket: ws://localhost:${this.port}/ws`);\r\n      console.log(`üìÅ Serving UI from: ${this.uiPath}`);\r\n      console.log();\r\n    } catch (error) {\r\n      printError(`Failed to start web server: ${error.message}`);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Stop the web server\r\n   */\r\n  async stop() {\r\n    if (!this.isRunning) return;\r\n\r\n    // Close all WebSocket connections\r\n    this.connections.forEach((ws) => {\r\n      if (ws.readyState === ws.OPEN) {\r\n        ws.close(1000, 'Server shutting down');\r\n      }\r\n    });\r\n\r\n    // Close WebSocket server\r\n    if (this.wss) {\r\n      this.wss.close();\r\n    }\r\n\r\n    // Close HTTP server\r\n    if (this.server) {\r\n      await new Promise((resolve) => {\r\n        this.server.close(resolve);\r\n      });\r\n    }\r\n\r\n    this.isRunning = false;\r\n    printInfo('Web server stopped');\r\n  }\r\n\r\n  /**\r\n   * Handle HTTP requests\r\n   */\r\n  handleRequest(req, res) {\r\n    const url = req.url;\r\n\r\n    // CORS headers\r\n    res.setHeader('Access-Control-Allow-Origin', '*');\r\n    res.setHeader('Access-Control-Allow-Methods', 'GET, POST, OPTIONS');\r\n    res.setHeader('Access-Control-Allow-Headers', 'Content-Type, Authorization');\r\n\r\n    if (req.method === 'OPTIONS') {\r\n      res.writeHead(200);\r\n      res.end();\r\n      return;\r\n    }\r\n\r\n    // Route handling\r\n    if (url === '/' || url === '/console' || url === '/console/') {\r\n      this.serveConsoleHTML(res);\r\n    } else if (url.startsWith('/console/')) {\r\n      // Remove /console prefix and serve static files\r\n      const filePath = url.substring('/console/'.length);\r\n      this.serveStaticFile(res, filePath);\r\n    } else if (url === '/health') {\r\n      this.handleHealthCheck(res);\r\n    } else if (url === '/api/status') {\r\n      this.handleStatusAPI(res);\r\n    } else if (url === '/favicon.ico') {\r\n      this.handleFavicon(res);\r\n    } else {\r\n      this.handle404(res);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Serve the console HTML with corrected paths\r\n   */\r\n  serveConsoleHTML(res) {\r\n    const filePath = join(this.uiPath, 'index.html');\r\n\r\n    if (!existsSync(filePath)) {\r\n      this.handle404(res);\r\n      return;\r\n    }\r\n\r\n    try {\r\n      let content = readFileSync(filePath, 'utf8');\r\n\r\n      // Fix relative paths to be relative to /console/\r\n      content = content.replace(/href=\"styles\\//g, 'href=\"/console/styles/');\r\n      content = content.replace(/src=\"js\\//g, 'src=\"/console/js/');\r\n\r\n      res.writeHead(200, { 'Content-Type': 'text/html' });\r\n      res.end(content);\r\n    } catch (error) {\r\n      this.handle500(res, error);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Serve a specific file from the UI directory\r\n   */\r\n  serveFile(res, filename, contentType) {\r\n    const filePath = join(this.uiPath, filename);\r\n\r\n    if (!existsSync(filePath)) {\r\n      this.handle404(res);\r\n      return;\r\n    }\r\n\r\n    try {\r\n      const content = readFileSync(filePath);\r\n      res.writeHead(200, { 'Content-Type': contentType });\r\n      res.end(content);\r\n    } catch (error) {\r\n      this.handle500(res, error);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Serve static files (CSS, JS, etc.)\r\n   */\r\n  serveStaticFile(res, requestPath) {\r\n    // Security: prevent directory traversal\r\n    if (requestPath.includes('..') || requestPath.includes('\\0')) {\r\n      this.handle403(res);\r\n      return;\r\n    }\r\n\r\n    const filePath = join(this.uiPath, requestPath);\r\n\r\n    if (!existsSync(filePath)) {\r\n      this.handle404(res);\r\n      return;\r\n    }\r\n\r\n    // Determine content type\r\n    const contentType = this.getContentType(requestPath);\r\n\r\n    try {\r\n      const content = readFileSync(filePath);\r\n      res.writeHead(200, { 'Content-Type': contentType });\r\n      res.end(content);\r\n    } catch (error) {\r\n      this.handle500(res, error);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get content type based on file extension\r\n   */\r\n  getContentType(filePath) {\r\n    const ext = filePath.split('.').pop().toLowerCase();\r\n\r\n    const contentTypes = {\r\n      html: 'text/html',\r\n      css: 'text/css',\r\n      js: 'application/javascript',\r\n      json: 'application/json',\r\n      png: 'image/png',\r\n      jpg: 'image/jpeg',\r\n      jpeg: 'image/jpeg',\r\n      gif: 'image/gif',\r\n      svg: 'image/svg+xml',\r\n      ico: 'image/x-icon',\r\n      woff: 'font/woff',\r\n      woff2: 'font/woff2',\r\n      ttf: 'font/ttf',\r\n      eot: 'application/vnd.ms-fontobject',\r\n    };\r\n\r\n    return contentTypes[ext] || 'text/plain';\r\n  }\r\n\r\n  /**\r\n   * Handle health check endpoint\r\n   */\r\n  handleHealthCheck(res) {\r\n    const health = {\r\n      status: 'ok',\r\n      timestamp: new Date().toISOString(),\r\n      uptime: process.uptime(),\r\n      connections: this.connections.size,\r\n      memory: process.memoryUsage(),\r\n      platform: compat.platform,\r\n    };\r\n\r\n    res.writeHead(200, { 'Content-Type': 'application/json' });\r\n    res.end(JSON.stringify(health, null, 2));\r\n  }\r\n\r\n  /**\r\n   * Handle status API endpoint\r\n   */\r\n  handleStatusAPI(res) {\r\n    const status = {\r\n      server: {\r\n        running: this.isRunning,\r\n        port: this.port,\r\n        connections: this.connections.size,\r\n      },\r\n      claudeFlow: {\r\n        initialized: true,\r\n        version: '1.0.72',\r\n      },\r\n      runtime: compat.runtime,\r\n      platform: compat.platform,\r\n    };\r\n\r\n    res.writeHead(200, { 'Content-Type': 'application/json' });\r\n    res.end(JSON.stringify(status, null, 2));\r\n  }\r\n\r\n  /**\r\n   * Handle favicon request\r\n   */\r\n  handleFavicon(res) {\r\n    // Simple SVG favicon\r\n    const favicon = `<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 32 32\">\r\n      <rect width=\"32\" height=\"32\" fill=\"#1f6feb\"/>\r\n      <text x=\"16\" y=\"20\" text-anchor=\"middle\" fill=\"white\" font-family=\"monospace\" font-size=\"18\">‚ö°</text>\r\n    </svg>`;\r\n\r\n    res.writeHead(200, { 'Content-Type': 'image/svg+xml' });\r\n    res.end(favicon);\r\n  }\r\n\r\n  /**\r\n   * Handle 403 Forbidden\r\n   */\r\n  handle403(res) {\r\n    res.writeHead(403, { 'Content-Type': 'text/plain' });\r\n    res.end('403 Forbidden');\r\n  }\r\n\r\n  /**\r\n   * Handle 404 Not Found\r\n   */\r\n  handle404(res) {\r\n    res.writeHead(404, { 'Content-Type': 'text/plain' });\r\n    res.end('404 Not Found');\r\n  }\r\n\r\n  /**\r\n   * Handle 500 Internal Server Error\r\n   */\r\n  handle500(res, error) {\r\n    console.error('Server error:', error);\r\n    res.writeHead(500, { 'Content-Type': 'text/plain' });\r\n    res.end('500 Internal Server Error');\r\n  }\r\n\r\n  /**\r\n   * Setup WebSocket server\r\n   */\r\n  setupWebSocketServer() {\r\n    this.wss.on('connection', (ws, req) => {\r\n      this.handleWebSocketConnection(ws, req);\r\n    });\r\n\r\n    this.wss.on('error', (error) => {\r\n      console.error('WebSocket server error:', error);\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Handle new WebSocket connection\r\n   */\r\n  handleWebSocketConnection(ws, req) {\r\n    const clientIP = req.socket.remoteAddress;\r\n    console.log(`üîó New WebSocket connection from ${clientIP}`);\r\n\r\n    this.connections.add(ws);\r\n\r\n    // Send welcome message\r\n    this.sendMessage(ws, {\r\n      jsonrpc: '2.0',\r\n      method: 'connection/established',\r\n      params: {\r\n        server: 'claude-flow-web-server',\r\n        version: '2.0.0',\r\n        timestamp: new Date().toISOString(),\r\n      },\r\n    });\r\n\r\n    // Handle messages\r\n    ws.on('message', (data) => {\r\n      this.handleWebSocketMessage(ws, data);\r\n    });\r\n\r\n    // Handle close\r\n    ws.on('close', (code, reason) => {\r\n      console.log(`‚ùå WebSocket connection closed: ${code} ${reason}`);\r\n      this.connections.delete(ws);\r\n    });\r\n\r\n    // Handle error\r\n    ws.on('error', (error) => {\r\n      console.error('WebSocket connection error:', error);\r\n      this.connections.delete(ws);\r\n    });\r\n\r\n    // Setup ping/pong for connection health\r\n    ws.on('pong', () => {\r\n      ws.isAlive = true;\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Handle incoming WebSocket messages\r\n   */\r\n  handleWebSocketMessage(ws, data) {\r\n    try {\r\n      const message = JSON.parse(data.toString());\r\n      console.log('Received WebSocket message:', message.method, message.id);\r\n\r\n      // Handle different message types\r\n      switch (message.method) {\r\n        case 'initialize':\r\n          this.handleInitialize(ws, message);\r\n          break;\r\n\r\n        case 'ping':\r\n          this.handlePing(ws, message);\r\n          break;\r\n\r\n        case 'tools/call':\r\n          this.handleToolCall(ws, message);\r\n          break;\r\n\r\n        case 'tools/list':\r\n          console.log('Handling tools/list request');\r\n          this.handleToolsList(ws, message);\r\n          break;\r\n\r\n        default:\r\n          console.log('Unknown method:', message.method);\r\n          this.handleUnknownMethod(ws, message);\r\n      }\r\n    } catch (error) {\r\n      console.error('Error processing WebSocket message:', error);\r\n      this.sendError(ws, null, 'Invalid JSON message');\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Handle initialize request\r\n   */\r\n  handleInitialize(ws, message) {\r\n    const response = {\r\n      jsonrpc: '2.0',\r\n      id: message.id,\r\n      result: {\r\n        protocolVersion: { major: 2024, minor: 11, patch: 5 },\r\n        serverInfo: {\r\n          name: 'claude-flow-web-server',\r\n          version: '2.0.0',\r\n        },\r\n        capabilities: {\r\n          logging: { level: 'info' },\r\n          tools: { listChanged: true },\r\n          resources: { listChanged: false, subscribe: false },\r\n          prompts: { listChanged: false },\r\n        },\r\n      },\r\n    };\r\n\r\n    this.sendMessage(ws, response);\r\n  }\r\n\r\n  /**\r\n   * Handle ping request\r\n   */\r\n  handlePing(ws, message) {\r\n    this.sendMessage(ws, {\r\n      jsonrpc: '2.0',\r\n      method: 'pong',\r\n      params: {\r\n        timestamp: Date.now(),\r\n        original: message.params,\r\n      },\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Handle tool call request\r\n   */\r\n  handleToolCall(ws, message) {\r\n    const { name, arguments: args } = message.params;\r\n\r\n    // Mock tool execution for demonstration\r\n    const result = this.executeMockTool(name, args);\r\n\r\n    const response = {\r\n      jsonrpc: '2.0',\r\n      id: message.id,\r\n      result: {\r\n        content: [\r\n          {\r\n            type: 'text',\r\n            text: result,\r\n          },\r\n        ],\r\n      },\r\n    };\r\n\r\n    this.sendMessage(ws, response);\r\n  }\r\n\r\n  /**\r\n   * Handle tools list request\r\n   */\r\n  handleToolsList(ws, message) {\r\n    const tools = [\r\n      {\r\n        name: 'claude-flow/execute',\r\n        description: 'Execute Claude Flow commands (start, stop, status, modes)',\r\n        inputSchema: {\r\n          type: 'object',\r\n          properties: {\r\n            command: { type: 'string', description: 'Command to execute' },\r\n            args: { type: 'object', description: 'Command arguments' },\r\n          },\r\n          required: ['command'],\r\n        },\r\n      },\r\n      {\r\n        name: 'swarm/orchestrate',\r\n        description: 'Manage swarm orchestration (create, start, stop, status)',\r\n        inputSchema: {\r\n          type: 'object',\r\n          properties: {\r\n            action: { type: 'string', description: 'Action to perform' },\r\n            args: { type: 'array', description: 'Action arguments' },\r\n          },\r\n          required: ['action'],\r\n        },\r\n      },\r\n      {\r\n        name: 'system/health',\r\n        description: 'Get comprehensive system health status',\r\n        inputSchema: {\r\n          type: 'object',\r\n          properties: {\r\n            detailed: { type: 'boolean', description: 'Include detailed metrics' },\r\n          },\r\n        },\r\n      },\r\n      {\r\n        name: 'memory/manage',\r\n        description: 'Manage persistent memory and storage',\r\n        inputSchema: {\r\n          type: 'object',\r\n          properties: {\r\n            operation: { type: 'string', description: 'Operation: store, retrieve, list, delete' },\r\n            key: { type: 'string', description: 'Memory key' },\r\n            value: { type: 'string', description: 'Value to store' },\r\n          },\r\n          required: ['operation'],\r\n        },\r\n      },\r\n      {\r\n        name: 'agents/manage',\r\n        description: 'Manage AI agents and their coordination',\r\n        inputSchema: {\r\n          type: 'object',\r\n          properties: {\r\n            action: { type: 'string', description: 'Action: list, create, start, stop, status' },\r\n            agentType: { type: 'string', description: 'Agent type for creation' },\r\n            agentId: { type: 'string', description: 'Agent ID for operations' },\r\n          },\r\n          required: ['action'],\r\n        },\r\n      },\r\n      {\r\n        name: 'sparc/execute',\r\n        description: 'Execute SPARC mode operations',\r\n        inputSchema: {\r\n          type: 'object',\r\n          properties: {\r\n            mode: { type: 'string', description: 'SPARC mode: coder, architect, analyzer, etc.' },\r\n            task: { type: 'string', description: 'Task description' },\r\n            options: { type: 'object', description: 'Additional options' },\r\n          },\r\n          required: ['mode'],\r\n        },\r\n      },\r\n      {\r\n        name: 'benchmark/run',\r\n        description: 'Run performance benchmarks',\r\n        inputSchema: {\r\n          type: 'object',\r\n          properties: {\r\n            suite: { type: 'string', description: 'Benchmark suite to run' },\r\n            iterations: { type: 'number', description: 'Number of iterations' },\r\n          },\r\n        },\r\n      },\r\n    ];\r\n\r\n    const response = {\r\n      jsonrpc: '2.0',\r\n      id: message.id,\r\n      result: { tools },\r\n    };\r\n\r\n    this.sendMessage(ws, response);\r\n  }\r\n\r\n  /**\r\n   * Handle unknown method\r\n   */\r\n  handleUnknownMethod(ws, message) {\r\n    this.sendError(ws, message.id, `Unknown method: ${message.method}`);\r\n  }\r\n\r\n  /**\r\n   * Execute mock tool for demonstration\r\n   */\r\n  executeMockTool(name, args) {\r\n    switch (name) {\r\n      case 'claude-flow/execute':\r\n        return this.executeClaudeFlowCommand(args.command, args.args);\r\n\r\n      case 'system/health':\r\n        const healthData = {\r\n          status: 'healthy',\r\n          uptime: Math.floor(process.uptime()),\r\n          memory: process.memoryUsage(),\r\n          connections: this.connections.size,\r\n          platform: compat.platform,\r\n          timestamp: new Date().toISOString(),\r\n        };\r\n\r\n        if (args.detailed) {\r\n          healthData.detailed = {\r\n            nodeVersion: process.version,\r\n            architecture: process.arch,\r\n            pid: process.pid,\r\n            cpuUsage: process.cpuUsage(),\r\n            resourceUsage: process.resourceUsage ? process.resourceUsage() : 'N/A',\r\n          };\r\n        }\r\n\r\n        return JSON.stringify(healthData, null, 2);\r\n\r\n      case 'swarm/orchestrate':\r\n        return this.executeSwarmCommand(args.action, args.args);\r\n\r\n      case 'swarm/status':\r\n        return this.executeSwarmCommand('status', args.args);\r\n\r\n      case 'memory/manage':\r\n        return this.executeMemoryCommand(args.operation, args.key, args.value);\r\n\r\n      case 'agents/manage':\r\n        return this.executeAgentsCommand(args.action, args.agentType, args.agentId);\r\n\r\n      case 'sparc/execute':\r\n        return this.executeSPARCCommand(args.mode, args.task, args.options);\r\n\r\n      case 'benchmark/run':\r\n        return this.executeBenchmarkCommand(args.suite, args.iterations);\r\n\r\n      default:\r\n        return `Tool '${name}' executed successfully with args: ${JSON.stringify(args)}`;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Execute Claude Flow command simulation\r\n   */\r\n  executeClaudeFlowCommand(command, args = {}) {\r\n    switch (command) {\r\n      case 'status':\r\n        return `Claude Flow Status:\r\n  Version: 2.0.0\r\n  Mode: Web Console\r\n  Active Processes: 3\r\n  Memory Usage: ${Math.round(process.memoryUsage().heapUsed / 1024 / 1024)}MB\r\n  Uptime: ${Math.floor(process.uptime())}s`;\r\n\r\n      case 'init':\r\n        return `Claude Flow initialization complete:\r\n  ‚úÖ Project structure created\r\n  ‚úÖ Configuration files generated\r\n  ‚úÖ Memory bank initialized\r\n  ‚úÖ Ready for development`;\r\n\r\n      case 'agents':\r\n        return `Active Agents:\r\n  ‚Ä¢ Research Agent (idle) - 0 tasks\r\n  ‚Ä¢ Code Developer (working) - 2 tasks  \r\n  ‚Ä¢ Data Analyst (idle) - 0 tasks\r\n  \r\n  Total: 3 agents`;\r\n\r\n      default:\r\n        return `Claude Flow command '${command}' executed successfully`;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Execute swarm command simulation\r\n   */\r\n  executeSwarmCommand(action = 'status', args = []) {\r\n    switch (action) {\r\n      case 'status':\r\n        return `Swarm Orchestration Status:\r\n  üêù Swarm: ACTIVE\r\n  üèóÔ∏è Topology: hierarchical\r\n  üë• Agents: 5/8 active\r\n  üìä Tasks: 12 total (4 complete, 6 in-progress, 2 pending)\r\n  ‚ö° Mode: parallel execution\r\n  üß† Memory: 15 coordination points stored\r\n  üìà Efficiency: 78%`;\r\n\r\n      case 'init':\r\n        return `Swarm initialization complete:\r\n  ‚úÖ Hierarchical topology established\r\n  ‚úÖ 5 agents spawned successfully\r\n  ‚úÖ Coordination protocols active\r\n  ‚úÖ Memory synchronization enabled`;\r\n\r\n      case 'agents':\r\n        return `Swarm Agent Status:\r\n  üü¢ architect: Designing system components...\r\n  üü¢ coder-1: Implementing user authentication...\r\n  üü¢ coder-2: Building API endpoints...\r\n  üü° analyst: Analyzing performance metrics...\r\n  üî¥ tester: Waiting for code completion...`;\r\n\r\n      case 'test':\r\n        return `Swarm Test Results:\r\n  ‚úÖ Agent communication: PASS\r\n  ‚úÖ Task distribution: PASS  \r\n  ‚úÖ Memory coordination: PASS\r\n  ‚úÖ Error handling: PASS\r\n  üìä Overall health: 95%`;\r\n\r\n      default:\r\n        return `Swarm ${action} completed successfully`;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Execute memory command simulation\r\n   */\r\n  executeMemoryCommand(operation, key, value) {\r\n    switch (operation) {\r\n      case 'store':\r\n        return `Memory stored successfully:\\n  Key: ${key}\\n  Value: ${value}\\n  Timestamp: ${new Date().toISOString()}`;\r\n\r\n      case 'retrieve':\r\n        return `Memory retrieved:\\n  Key: ${key}\\n  Value: \"example stored value\"\\n  Last Modified: ${new Date().toISOString()}`;\r\n\r\n      case 'list':\r\n        return `Memory Keys:\\n  ‚Ä¢ project/settings\\n  ‚Ä¢ swarm/topology\\n  ‚Ä¢ agents/coordination\\n  ‚Ä¢ session/state\\n  ‚Ä¢ benchmark/results\\n  \\n  Total: 5 entries`;\r\n\r\n      case 'delete':\r\n        return `Memory deleted:\\n  Key: ${key}\\n  Status: Success`;\r\n\r\n      default:\r\n        return `Memory operation '${operation}' completed`;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Execute agents command simulation\r\n   */\r\n  executeAgentsCommand(action, agentType, agentId) {\r\n    switch (action) {\r\n      case 'list':\r\n        return `Active Agents:\\n  üü¢ agent-001 (architect) - Designing system components\\n  üü¢ agent-002 (coder) - Implementing features\\n  üü° agent-003 (analyst) - Analyzing performance\\n  üî¥ agent-004 (tester) - Waiting for code\\n  üü¢ agent-005 (coordinator) - Managing workflow\\n  \\n  Total: 5 agents`;\r\n\r\n      case 'create':\r\n        return `Agent created successfully:\\n  Type: ${agentType}\\n  ID: agent-${Math.floor(\r\n          Math.random() * 1000,\r\n        )\r\n          .toString()\r\n          .padStart(3, '0')}\\n  Status: Active\\n  Capabilities: Full ${agentType} functionality`;\r\n\r\n      case 'start':\r\n        return `Agent started:\\n  ID: ${agentId}\\n  Status: Running\\n  Tasks: Ready to accept work`;\r\n\r\n      case 'stop':\r\n        return `Agent stopped:\\n  ID: ${agentId}\\n  Status: Stopped\\n  Tasks: Completed gracefully`;\r\n\r\n      case 'status':\r\n        return `Agent Status:\\n  ID: ${agentId}\\n  Status: Active\\n  Type: researcher\\n  Current Task: Data analysis\\n  Uptime: 2h 15m\\n  Tasks Completed: 12\\n  Efficiency: 92%`;\r\n\r\n      default:\r\n        return `Agent ${action} completed for ${agentId || agentType}`;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Execute SPARC command simulation\r\n   */\r\n  executeSPARCCommand(mode, task, options = {}) {\r\n    const modes = {\r\n      coder: 'Code development and implementation',\r\n      architect: 'System design and architecture',\r\n      analyzer: 'Data analysis and insights',\r\n      researcher: 'Research and information gathering',\r\n      reviewer: 'Code review and quality assurance',\r\n      tester: 'Testing and validation',\r\n      debugger: 'Bug finding and resolution',\r\n      documenter: 'Documentation and specifications',\r\n      optimizer: 'Performance optimization',\r\n      designer: 'UI/UX design and prototyping',\r\n    };\r\n\r\n    return `SPARC Mode Execution:\\n  Mode: ${mode} (${modes[mode] || 'Unknown mode'})\\n  Task: ${task || 'No task specified'}\\n  Status: Initialized\\n  Estimated Duration: 15-30 minutes\\n  Resources Allocated: 2 agents\\n  Options: ${JSON.stringify(options)}\\n  \\n  Ready to begin execution...`;\r\n  }\r\n\r\n  /**\r\n   * Execute benchmark command simulation\r\n   */\r\n  executeBenchmarkCommand(suite = 'default', iterations = 10) {\r\n    const suites = {\r\n      default: 'General performance benchmark',\r\n      memory: 'Memory usage and allocation',\r\n      cpu: 'CPU intensive operations',\r\n      network: 'Network communication speed',\r\n      swarm: 'Swarm coordination efficiency',\r\n    };\r\n\r\n    return `Benchmark Results:\\n  Suite: ${suite} (${suites[suite] || 'Custom suite'})\\n  Iterations: ${iterations}\\n  \\n  üìä Results:\\n  ‚Ä¢ Average Response Time: 245ms\\n  ‚Ä¢ Memory Usage: 128MB\\n  ‚Ä¢ CPU Utilization: 15%\\n  ‚Ä¢ Success Rate: 98.5%\\n  ‚Ä¢ Throughput: 420 ops/sec\\n  \\n  üèÜ Performance Grade: A+\\n  ‚ö° Optimization Suggestions: Enable caching for 12% improvement`;\r\n  }\r\n\r\n  /**\r\n   * Send message to WebSocket client\r\n   */\r\n  sendMessage(ws, message) {\r\n    if (ws.readyState === ws.OPEN) {\r\n      ws.send(JSON.stringify(message));\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Send error response\r\n   */\r\n  sendError(ws, id, errorMessage) {\r\n    const response = {\r\n      jsonrpc: '2.0',\r\n      id,\r\n      error: {\r\n        code: -32600,\r\n        message: errorMessage,\r\n      },\r\n    };\r\n\r\n    this.sendMessage(ws, response);\r\n  }\r\n\r\n  /**\r\n   * Broadcast message to all connected clients\r\n   */\r\n  broadcast(message) {\r\n    this.connections.forEach((ws) => {\r\n      this.sendMessage(ws, message);\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Start heartbeat to check connection health\r\n   */\r\n  startHeartbeat() {\r\n    setInterval(() => {\r\n      this.connections.forEach((ws) => {\r\n        if (ws.isAlive === false) {\r\n          ws.terminate();\r\n          this.connections.delete(ws);\r\n          return;\r\n        }\r\n\r\n        ws.isAlive = false;\r\n        ws.ping();\r\n      });\r\n    }, 30000); // 30 seconds\r\n  }\r\n\r\n  /**\r\n   * Get server status\r\n   */\r\n  getStatus() {\r\n    return {\r\n      running: this.isRunning,\r\n      port: this.port,\r\n      connections: this.connections.size,\r\n      uiPath: this.uiPath,\r\n    };\r\n  }\r\n}\r\n\r\n/**\r\n * Start web server command\r\n */\r\nexport async function startWebServer(port = 3000) {\r\n  const server = new ClaudeCodeWebServer(port);\r\n\r\n  try {\r\n    await server.start();\r\n\r\n    // Setup graceful shutdown\r\n    const shutdown = async () => {\r\n      console.log('\\n‚èπÔ∏è  Shutting down web server...');\r\n      await server.stop();\r\n      process.exit(0);\r\n    };\r\n\r\n    compat.terminal.onSignal('SIGINT', shutdown);\r\n    compat.terminal.onSignal('SIGTERM', shutdown);\r\n\r\n    // Keep server running\r\n    return server;\r\n  } catch (error) {\r\n    printError(`Failed to start web server: ${error.message}`);\r\n    process.exit(1);\r\n  }\r\n}\r\n\r\n// Auto-run if called directly\r\nif (import.meta.url === `file://${process.argv[1]}`) {\r\n  const port = process.argv[2] ? parseInt(process.argv[2]) : 3000;\r\n  await startWebServer(port);\r\n}\r\n"],"names":["createServer","join","dirname","fileURLToPath","readFileSync","existsSync","WebSocketServer","printSuccess","printError","printWarning","printInfo","compat","__filename","url","__dirname","ClaudeCodeWebServer","port","server","wss","connections","Set","uiPath","isRunning","createAPIRoutes","express","router","Router","get","req","res","json","status","uptime","process","size","start","app","default","use","next","header","static","redirect","path","setupWebSocketServer","Promise","resolve","reject","listen","err","console","log","error","message","stop","forEach","ws","readyState","OPEN","close","handleRequest","setHeader","method","writeHead","end","serveConsoleHTML","startsWith","filePath","substring","length","serveStaticFile","handleHealthCheck","handleStatusAPI","handleFavicon","handle404","content","replace","handle500","serveFile","filename","contentType","requestPath","includes","handle403","getContentType","ext","split","pop","toLowerCase","contentTypes","html","css","js","png","jpg","jpeg","gif","svg","ico","woff","woff2","ttf","eot","health","timestamp","Date","toISOString","memory","memoryUsage","platform","JSON","stringify","running","claudeFlow","initialized","version","runtime","favicon","on","handleWebSocketConnection","clientIP","socket","remoteAddress","add","sendMessage","jsonrpc","params","data","handleWebSocketMessage","code","reason","delete","isAlive","parse","toString","id","handleInitialize","handlePing","handleToolCall","handleToolsList","handleUnknownMethod","sendError","response","result","protocolVersion","major","minor","patch","serverInfo","name","capabilities","logging","level","tools","listChanged","resources","subscribe","prompts","now","original","arguments","args","executeMockTool","type","text","description","inputSchema","properties","command","required","action","detailed","operation","key","value","agentType","agentId","mode","task","options","suite","iterations","executeClaudeFlowCommand","healthData","Math","floor","nodeVersion","architecture","arch","pid","cpuUsage","resourceUsage","executeSwarmCommand","executeMemoryCommand","executeAgentsCommand","executeSPARCCommand","executeBenchmarkCommand","round","heapUsed","random","padStart","modes","coder","architect","analyzer","researcher","reviewer","tester","debugger","documenter","optimizer","designer","suites","cpu","network","swarm","send","errorMessage","broadcast","startHeartbeat","setInterval","terminate","ping","getStatus","startWebServer","shutdown","exit","terminal","onSignal","argv","parseInt"],"mappings":"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"}