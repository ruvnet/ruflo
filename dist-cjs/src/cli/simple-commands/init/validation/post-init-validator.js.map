{"version":3,"sources":["../../../../../../src/cli/simple-commands/init/validation/post-init-validator.js"],"sourcesContent":["import { promises as fs } from 'fs';\r\n// post-init-validator.js - Post-initialization verification checks\r\n\r\nexport class PostInitValidator {\r\n  constructor(workingDir) {\r\n    this.workingDir = workingDir;\r\n  }\r\n\r\n  /**\r\n   * Check file integrity (existence, size, readability)\r\n   */\r\n  async checkFileIntegrity() {\r\n    const result = {\r\n      success: true,\r\n      errors: [],\r\n      warnings: [],\r\n      files: {},\r\n    };\r\n\r\n    const expectedFiles = [\r\n      { path: 'CLAUDE.md', minSize: 100 },\r\n      { path: 'memory-bank.md', minSize: 50 },\r\n      { path: 'coordination.md', minSize: 50 },\r\n      { path: 'memory/claude-flow-data.json', minSize: 10 },\r\n      { path: 'memory/agents/README.md', minSize: 10 },\r\n      { path: 'memory/sessions/README.md', minSize: 10 },\r\n      { path: 'claude-flow', minSize: 50, executable: true },\r\n    ];\r\n\r\n    for (const file of expectedFiles) {\r\n      const filePath = `${this.workingDir}/${file.path}`;\r\n\r\n      try {\r\n        const stat = await fs.stat(filePath);\r\n\r\n        // Check if it exists and is a file\r\n        if (!stat.isFile) {\r\n          result.success = false;\r\n          result.errors.push(`Expected file but found directory: ${file.path}`);\r\n          result.files[file.path] = { status: 'not_file' };\r\n          continue;\r\n        }\r\n\r\n        // Check file size\r\n        if (stat.size < file.minSize) {\r\n          result.success = false;\r\n          result.errors.push(\r\n            `File too small: ${file.path} (${stat.size} bytes, expected >= ${file.minSize})`,\r\n          );\r\n          result.files[file.path] = { status: 'too_small', size: stat.size };\r\n          continue;\r\n        }\r\n\r\n        // Check if executable (if required)\r\n        if (file.executable && Deno.build.os !== 'windows') {\r\n          const isExecutable = (stat.mode & 0o111) !== 0;\r\n          if (!isExecutable) {\r\n            result.warnings.push(`File not executable: ${file.path}`);\r\n            result.files[file.path] = { status: 'not_executable', size: stat.size };\r\n            continue;\r\n          }\r\n        }\r\n\r\n        // Try to read the file\r\n        try {\r\n          await fs.readFile(filePath, 'utf8');\r\n          result.files[file.path] = { status: 'ok', size: stat.size };\r\n        } catch (readError) {\r\n          result.success = false;\r\n          result.errors.push(`Cannot read file: ${file.path} - ${readError.message}`);\r\n          result.files[file.path] = { status: 'unreadable', size: stat.size };\r\n        }\r\n      } catch (error) {\r\n        result.success = false;\r\n        result.errors.push(`File not found: ${file.path}`);\r\n        result.files[file.path] = { status: 'missing' };\r\n      }\r\n    }\r\n\r\n    return result;\r\n  }\r\n\r\n  /**\r\n   * Check completeness of initialization\r\n   */\r\n  async checkCompleteness() {\r\n    const result = {\r\n      success: true,\r\n      errors: [],\r\n      warnings: [],\r\n      missing: [],\r\n    };\r\n\r\n    const requiredDirs = [\r\n      'memory',\r\n      'memory/agents',\r\n      'memory/sessions',\r\n      'coordination',\r\n      'coordination/memory_bank',\r\n      'coordination/subtasks',\r\n      'coordination/orchestration',\r\n      '.claude',\r\n      '.claude/commands',\r\n      '.claude/logs',\r\n    ];\r\n\r\n    const optionalDirs = [\r\n      '.roo',\r\n      '.roo/templates',\r\n      '.roo/workflows',\r\n      '.roo/modes',\r\n      '.roo/configs',\r\n      '.claude/commands/sparc',\r\n    ];\r\n\r\n    // Check required directories\r\n    for (const dir of requiredDirs) {\r\n      const dirPath = `${this.workingDir}/${dir}`;\r\n\r\n      try {\r\n        const stat = await fs.stat(dirPath);\r\n        if (!stat.isDirectory) {\r\n          result.success = false;\r\n          result.errors.push(`Expected directory but found file: ${dir}`);\r\n          result.missing.push(dir);\r\n        }\r\n      } catch {\r\n        result.success = false;\r\n        result.errors.push(`Required directory missing: ${dir}`);\r\n        result.missing.push(dir);\r\n      }\r\n    }\r\n\r\n    // Check optional directories (SPARC-related)\r\n    for (const dir of optionalDirs) {\r\n      const dirPath = `${this.workingDir}/${dir}`;\r\n\r\n      try {\r\n        await fs.stat(dirPath);\r\n      } catch {\r\n        if (dir.includes('.roo') || dir.includes('sparc')) {\r\n          result.warnings.push(`Optional SPARC directory missing: ${dir}`);\r\n        }\r\n      }\r\n    }\r\n\r\n    return result;\r\n  }\r\n\r\n  /**\r\n   * Validate directory structure and organization\r\n   */\r\n  async validateStructure() {\r\n    const result = {\r\n      success: true,\r\n      errors: [],\r\n      warnings: [],\r\n      structure: {},\r\n    };\r\n\r\n    try {\r\n      // Check memory structure\r\n      const memoryStructure = await this.validateMemoryStructure();\r\n      result.structure.memory = memoryStructure;\r\n      if (!memoryStructure.valid) {\r\n        result.warnings.push('Memory directory structure is incomplete');\r\n      }\r\n\r\n      // Check coordination structure\r\n      const coordinationStructure = await this.validateCoordinationStructure();\r\n      result.structure.coordination = coordinationStructure;\r\n      if (!coordinationStructure.valid) {\r\n        result.warnings.push('Coordination directory structure is incomplete');\r\n      }\r\n\r\n      // Check Claude integration structure\r\n      const claudeStructure = await this.validateClaudeStructure();\r\n      result.structure.claude = claudeStructure;\r\n      if (!claudeStructure.valid) {\r\n        result.warnings.push('Claude integration structure is incomplete');\r\n      }\r\n\r\n      // Check SPARC structure (if present)\r\n      const sparcExists = await this.checkSparcExists();\r\n      if (sparcExists) {\r\n        const sparcStructure = await this.validateSparcStructure();\r\n        result.structure.sparc = sparcStructure;\r\n        if (!sparcStructure.valid) {\r\n          result.warnings.push('SPARC structure is incomplete');\r\n        }\r\n      }\r\n    } catch (error) {\r\n      result.success = false;\r\n      result.errors.push(`Structure validation failed: ${error.message}`);\r\n    }\r\n\r\n    return result;\r\n  }\r\n\r\n  /**\r\n   * Check permissions on created files and directories\r\n   */\r\n  async checkPermissions() {\r\n    const result = {\r\n      success: true,\r\n      errors: [],\r\n      warnings: [],\r\n      permissions: {},\r\n    };\r\n\r\n    const itemsToCheck = [\r\n      { path: 'CLAUDE.md', type: 'file', requiredMode: 0o644 },\r\n      { path: 'memory-bank.md', type: 'file', requiredMode: 0o644 },\r\n      { path: 'coordination.md', type: 'file', requiredMode: 0o644 },\r\n      { path: 'claude-flow', type: 'file', requiredMode: 0o755 },\r\n      { path: 'memory', type: 'dir', requiredMode: 0o755 },\r\n      { path: 'coordination', type: 'dir', requiredMode: 0o755 },\r\n      { path: '.claude', type: 'dir', requiredMode: 0o755 },\r\n    ];\r\n\r\n    // Skip permission checks on Windows\r\n    if (Deno.build.os === 'windows') {\r\n      result.warnings.push('Permission checks skipped on Windows');\r\n      return result;\r\n    }\r\n\r\n    for (const item of itemsToCheck) {\r\n      const itemPath = `${this.workingDir}/${item.path}`;\r\n\r\n      try {\r\n        const stat = await fs.stat(itemPath);\r\n        const actualMode = stat.mode & 0o777;\r\n        const expectedMode = item.requiredMode;\r\n\r\n        result.permissions[item.path] = {\r\n          actual: actualMode.toString(8),\r\n          expected: expectedMode.toString(8),\r\n          correct: actualMode === expectedMode,\r\n        };\r\n\r\n        if (actualMode !== expectedMode) {\r\n          result.warnings.push(\r\n            `Incorrect permissions on ${item.path}: ` +\r\n              `${actualMode.toString(8)} (expected ${expectedMode.toString(8)})`,\r\n          );\r\n        }\r\n      } catch (error) {\r\n        result.warnings.push(`Could not check permissions for ${item.path}: ${error.message}`);\r\n      }\r\n    }\r\n\r\n    return result;\r\n  }\r\n\r\n  // Helper methods\r\n\r\n  async validateMemoryStructure() {\r\n    const structure = {\r\n      valid: true,\r\n      dirs: [],\r\n      files: [],\r\n    };\r\n\r\n    const expectedDirs = ['agents', 'sessions'];\r\n    const expectedFiles = ['claude-flow-data.json', 'agents/README.md', 'sessions/README.md'];\r\n\r\n    for (const dir of expectedDirs) {\r\n      try {\r\n        await fs.stat(`${this.workingDir}/memory/${dir}`);\r\n        structure.dirs.push(dir);\r\n      } catch {\r\n        structure.valid = false;\r\n      }\r\n    }\r\n\r\n    for (const file of expectedFiles) {\r\n      try {\r\n        await fs.stat(`${this.workingDir}/memory/${file}`);\r\n        structure.files.push(file);\r\n      } catch {\r\n        structure.valid = false;\r\n      }\r\n    }\r\n\r\n    return structure;\r\n  }\r\n\r\n  async validateCoordinationStructure() {\r\n    const structure = {\r\n      valid: true,\r\n      dirs: [],\r\n    };\r\n\r\n    const expectedDirs = ['memory_bank', 'subtasks', 'orchestration'];\r\n\r\n    for (const dir of expectedDirs) {\r\n      try {\r\n        await fs.stat(`${this.workingDir}/coordination/${dir}`);\r\n        structure.dirs.push(dir);\r\n      } catch {\r\n        structure.valid = false;\r\n      }\r\n    }\r\n\r\n    return structure;\r\n  }\r\n\r\n  async validateClaudeStructure() {\r\n    const structure = {\r\n      valid: true,\r\n      dirs: [],\r\n      hasCommands: false,\r\n    };\r\n\r\n    const expectedDirs = ['commands', 'logs'];\r\n\r\n    for (const dir of expectedDirs) {\r\n      try {\r\n        await fs.stat(`${this.workingDir}/.claude/${dir}`);\r\n        structure.dirs.push(dir);\r\n      } catch {\r\n        structure.valid = false;\r\n      }\r\n    }\r\n\r\n    // Check if there are any command files\r\n    try {\r\n      const entries = [];\r\n      for await (const entry of fs.readdir(`${this.workingDir}/.claude/commands`)) {\r\n        if (entry.isFile && entry.name.endsWith('.js')) {\r\n          entries.push(entry.name);\r\n        }\r\n      }\r\n      structure.hasCommands = entries.length > 0;\r\n      structure.commandCount = entries.length;\r\n    } catch {\r\n      structure.hasCommands = false;\r\n    }\r\n\r\n    return structure;\r\n  }\r\n\r\n  async checkSparcExists() {\r\n    try {\r\n      await fs.stat(`${this.workingDir}/.roomodes`);\r\n      return true;\r\n    } catch {\r\n      return false;\r\n    }\r\n  }\r\n\r\n  async validateSparcStructure() {\r\n    const structure = {\r\n      valid: true,\r\n      hasRoomodes: false,\r\n      hasRooDir: false,\r\n      dirs: [],\r\n    };\r\n\r\n    // Check .roomodes file\r\n    try {\r\n      const stat = await fs.stat(`${this.workingDir}/.roomodes`);\r\n      structure.hasRoomodes = stat.isFile;\r\n    } catch {\r\n      structure.valid = false;\r\n    }\r\n\r\n    // Check .roo directory\r\n    try {\r\n      const stat = await fs.stat(`${this.workingDir}/.roo`);\r\n      structure.hasRooDir = stat.isDirectory;\r\n\r\n      if (structure.hasRooDir) {\r\n        const expectedDirs = ['templates', 'workflows', 'modes', 'configs'];\r\n        for (const dir of expectedDirs) {\r\n          try {\r\n            await fs.stat(`${this.workingDir}/.roo/${dir}`);\r\n            structure.dirs.push(dir);\r\n          } catch {\r\n            // Optional subdirectories\r\n          }\r\n        }\r\n      }\r\n    } catch {\r\n      // .roo directory is optional\r\n    }\r\n\r\n    return structure;\r\n  }\r\n}\r\n"],"names":["promises","fs","PostInitValidator","workingDir","checkFileIntegrity","result","success","errors","warnings","files","expectedFiles","path","minSize","executable","file","filePath","stat","isFile","push","status","size","Deno","build","os","isExecutable","mode","readFile","readError","message","error","checkCompleteness","missing","requiredDirs","optionalDirs","dir","dirPath","isDirectory","includes","validateStructure","structure","memoryStructure","validateMemoryStructure","memory","valid","coordinationStructure","validateCoordinationStructure","coordination","claudeStructure","validateClaudeStructure","claude","sparcExists","checkSparcExists","sparcStructure","validateSparcStructure","sparc","checkPermissions","permissions","itemsToCheck","type","requiredMode","item","itemPath","actualMode","expectedMode","actual","toString","expected","correct","dirs","expectedDirs","hasCommands","entries","entry","readdir","name","endsWith","length","commandCount","hasRoomodes","hasRooDir"],"mappings":"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"}