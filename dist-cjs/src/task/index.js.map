{"version":3,"sources":["../../../src/task/index.ts"],"sourcesContent":["/**\r\n * Task Management System - Main Export\r\n * Comprehensive task management with orchestration features\r\n * Integrates with TodoWrite/TodoRead for coordination and Memory for persistence\r\n */\r\n\r\nexport {\r\n  TaskEngine,\r\n  type WorkflowTask,\r\n  type TaskDependency,\r\n  type ResourceRequirement,\r\n  type TaskSchedule,\r\n  type TaskExecution,\r\n  type TaskMetrics,\r\n  type TaskLog,\r\n  type Workflow,\r\n  type TaskFilter,\r\n  type TaskSort,\r\n  type TaskCheckpoint,\r\n} from './engine.js';\r\n\r\nexport {\r\n  createTaskCreateCommand,\r\n  createTaskListCommand,\r\n  createTaskStatusCommand,\r\n  createTaskCancelCommand,\r\n  createTaskWorkflowCommand,\r\n} from './commands.js';\r\n\r\nexport {\r\n  type TaskCommandContext,\r\n  type TodoItem,\r\n  type MemoryEntry,\r\n  type CoordinationContext,\r\n  type TaskMetadata,\r\n} from './types.js';\r\n\r\nexport { TaskCoordinator } from './coordination.js';\r\n\r\n/**\r\n * Initialize the complete task management system\r\n */\r\nexport async function initializeTaskManagement(\r\n  config: {\r\n    maxConcurrentTasks?: number;\r\n    memoryManager?: any;\r\n    logger?: any;\r\n  } = {},\r\n): Promise<{\r\n  taskEngine: any;\r\n  taskCoordinator: any;\r\n  commands: {\r\n    create: any;\r\n    list: any;\r\n    status: any;\r\n    cancel: any;\r\n    workflow: any;\r\n  };\r\n}> {\r\n  // Import required classes dynamically to avoid circular dependencies\r\n  const { TaskEngine } = await import('./engine.js');\r\n  const { TaskCoordinator } = await import('./coordination.js');\r\n  const {\r\n    createTaskCreateCommand,\r\n    createTaskListCommand,\r\n    createTaskStatusCommand,\r\n    createTaskCancelCommand,\r\n    createTaskWorkflowCommand,\r\n  } = await import('./commands.js');\r\n\r\n  const taskEngine = new TaskEngine(config.maxConcurrentTasks || 10, config.memoryManager);\r\n\r\n  const taskCoordinator = new TaskCoordinator(taskEngine, config.memoryManager);\r\n\r\n  const commandContext = {\r\n    taskEngine,\r\n    taskCoordinator,\r\n    memoryManager: config.memoryManager,\r\n    logger: config.logger,\r\n  };\r\n\r\n  const commands = {\r\n    create: createTaskCreateCommand(commandContext),\r\n    list: createTaskListCommand(commandContext),\r\n    status: createTaskStatusCommand(commandContext),\r\n    cancel: createTaskCancelCommand(commandContext),\r\n    workflow: createTaskWorkflowCommand(commandContext),\r\n  };\r\n\r\n  return {\r\n    taskEngine,\r\n    taskCoordinator,\r\n    commands,\r\n  };\r\n}\r\n\r\n/**\r\n * Helper function to create TodoWrite-style task breakdown\r\n */\r\nexport async function createTaskTodos(\r\n  objective: string,\r\n  options: {\r\n    strategy?: 'research' | 'development' | 'analysis' | 'testing' | 'optimization' | 'maintenance';\r\n    maxTasks?: number;\r\n    batchOptimized?: boolean;\r\n    parallelExecution?: boolean;\r\n    memoryCoordination?: boolean;\r\n  } = {},\r\n  coordinator?: any,\r\n): Promise<any[]> {\r\n  if (!coordinator) {\r\n    throw new Error('TaskCoordinator instance required for todo creation');\r\n  }\r\n\r\n  const context = {\r\n    sessionId: `session-${Date.now()}`,\r\n    coordinationMode: options.batchOptimized ? 'distributed' : 'centralized',\r\n  };\r\n\r\n  return await coordinator.createTaskTodos(objective, context, options);\r\n}\r\n\r\n/**\r\n * Helper function to launch parallel agents (Task tool pattern)\r\n */\r\nexport async function launchParallelAgents(\r\n  tasks: Array<{\r\n    agentType: string;\r\n    objective: string;\r\n    mode?: string;\r\n    configuration?: Record<string, unknown>;\r\n    memoryKey?: string;\r\n    batchOptimized?: boolean;\r\n  }>,\r\n  coordinator?: any,\r\n): Promise<string[]> {\r\n  if (!coordinator) {\r\n    throw new Error('TaskCoordinator instance required for agent launching');\r\n  }\r\n\r\n  const context = {\r\n    sessionId: `session-${Date.now()}`,\r\n    coordinationMode: 'distributed',\r\n  };\r\n\r\n  return await coordinator.launchParallelAgents(tasks, context);\r\n}\r\n\r\n/**\r\n * Helper function to store coordination data in Memory\r\n */\r\nexport async function storeCoordinationData(\r\n  key: string,\r\n  value: any,\r\n  options: {\r\n    namespace?: string;\r\n    tags?: string[];\r\n    expiresAt?: Date;\r\n  } = {},\r\n  coordinator?: any,\r\n): Promise<void> {\r\n  if (!coordinator) {\r\n    throw new Error('TaskCoordinator instance required for memory storage');\r\n  }\r\n\r\n  await coordinator.storeInMemory(key, value, options);\r\n}\r\n\r\n/**\r\n * Helper function to retrieve coordination data from Memory\r\n */\r\nexport async function retrieveCoordinationData(\r\n  key: string,\r\n  namespace?: string,\r\n  coordinator?: any,\r\n): Promise<any | null> {\r\n  if (!coordinator) {\r\n    throw new Error('TaskCoordinator instance required for memory retrieval');\r\n  }\r\n\r\n  return await coordinator.retrieveFromMemory(key, namespace);\r\n}\r\n\r\n/**\r\n * Examples and usage patterns for Claude Code integration\r\n */\r\nexport const USAGE_EXAMPLES = {\r\n  todoWrite: `\r\n// Example: Using TodoWrite for task coordination\r\nimport { createTaskTodos } from './task.js';\r\n\r\nconst todos = await createTaskTodos(\r\n  \"Build e-commerce platform\",\r\n  {\r\n    strategy: 'development',\r\n    batchOptimized: true,\r\n    parallelExecution: true,\r\n    memoryCoordination: true\r\n  },\r\n  coordinator\r\n);\r\n\r\n// This creates a structured todo list with:\r\n// - System architecture design (high priority)\r\n// - Frontend development (parallel execution)\r\n// - Backend development (parallel execution) \r\n// - Testing and integration (depends on frontend/backend)\r\n`,\r\n\r\n  taskTool: `\r\n// Example: Using Task tool pattern for parallel agents\r\nimport { launchParallelAgents } from './task.js';\r\n\r\nconst agentIds = await launchParallelAgents([\r\n  {\r\n    agentType: 'researcher',\r\n    objective: 'Research best practices for microservices',\r\n    mode: 'researcher',\r\n    memoryKey: 'microservices_research',\r\n    batchOptimized: true\r\n  },\r\n  {\r\n    agentType: 'architect',\r\n    objective: 'Design system architecture based on research',\r\n    mode: 'architect',\r\n    memoryKey: 'system_architecture',\r\n    batchOptimized: true\r\n  },\r\n  {\r\n    agentType: 'coder',\r\n    objective: 'Implement core services',\r\n    mode: 'coder',\r\n    memoryKey: 'core_implementation',\r\n    batchOptimized: true\r\n  }\r\n], coordinator);\r\n`,\r\n\r\n  memoryCoordination: `\r\n// Example: Using Memory for cross-agent coordination\r\nimport { storeCoordinationData, retrieveCoordinationData } from './task.js';\r\n\r\n// Store research findings for other agents\r\nawait storeCoordinationData(\r\n  'research_findings',\r\n  {\r\n    bestPractices: [...],\r\n    technologies: [...],\r\n    patterns: [...]\r\n  },\r\n  {\r\n    namespace: 'project_coordination',\r\n    tags: ['research', 'architecture']\r\n  },\r\n  coordinator\r\n);\r\n\r\n// Retrieve findings in another agent\r\nconst findings = await retrieveCoordinationData(\r\n  'research_findings',\r\n  'project_coordination',\r\n  coordinator\r\n);\r\n`,\r\n\r\n  batchOperations: `\r\n// Example: Coordinated batch operations\r\nimport { TaskCoordinator } from './task.js';\r\n\r\nconst results = await coordinator.coordinateBatchOperations([\r\n  {\r\n    type: 'read',\r\n    targets: ['src/**/*.ts'],\r\n    configuration: { pattern: 'class.*{' }\r\n  },\r\n  {\r\n    type: 'analyze',\r\n    targets: ['package.json', 'tsconfig.json'],\r\n    configuration: { focus: 'dependencies' }\r\n  },\r\n  {\r\n    type: 'search',\r\n    targets: ['docs/**/*.md'],\r\n    configuration: { term: 'API documentation' }\r\n  }\r\n], context);\r\n`,\r\n\r\n  swarmCoordination: `\r\n// Example: Swarm coordination patterns\r\nawait coordinator.coordinateSwarm(\r\n  \"Comprehensive system development\",\r\n  {\r\n    sessionId: 'dev-session-1',\r\n    coordinationMode: 'hierarchical'\r\n  },\r\n  [\r\n    { type: 'lead-architect', role: 'team-lead', capabilities: ['design', 'coordination'] },\r\n    { type: 'frontend-dev-1', role: 'coder', capabilities: ['react', 'ui'] },\r\n    { type: 'frontend-dev-2', role: 'coder', capabilities: ['react', 'testing'] },\r\n    { type: 'backend-dev-1', role: 'coder', capabilities: ['nodejs', 'api'] },\r\n    { type: 'backend-dev-2', role: 'coder', capabilities: ['database', 'scaling'] },\r\n    { type: 'devops-engineer', role: 'specialist', capabilities: ['deployment', 'monitoring'] }\r\n  ]\r\n);\r\n`,\r\n};\r\n\r\n/**\r\n * Command line usage examples\r\n */\r\nexport const CLI_EXAMPLES = {\r\n  taskCreate: `\r\n# Create a complex task with dependencies and scheduling\r\nclaude-flow task create development \"Implement user authentication system\" \\\\\r\n  --priority 80 \\\\\r\n  --dependencies \"task-123,task-456\" \\\\\r\n  --dep-type finish-to-start \\\\\r\n  --assign backend-team \\\\\r\n  --tags \"auth,security,backend\" \\\\\r\n  --deadline \"2024-02-15T18:00:00Z\" \\\\\r\n  --cpu 2 \\\\\r\n  --memory 1024 \\\\\r\n  --max-retries 5 \\\\\r\n  --rollback previous-checkpoint\r\n`,\r\n\r\n  taskList: `\r\n# List tasks with advanced filtering and visualization\r\nclaude-flow task list \\\\\r\n  --status running,pending \\\\\r\n  --priority 70-100 \\\\\r\n  --tags auth,security \\\\\r\n  --sort deadline \\\\\r\n  --sort-dir asc \\\\\r\n  --format table \\\\\r\n  --show-dependencies \\\\\r\n  --show-progress \\\\\r\n  --limit 20\r\n`,\r\n\r\n  taskStatus: `\r\n# Get detailed task status with all metrics\r\nclaude-flow task status task-789 \\\\\r\n  --show-logs \\\\\r\n  --show-checkpoints \\\\\r\n  --show-metrics \\\\\r\n  --show-dependencies \\\\\r\n  --show-resources \\\\\r\n  --watch\r\n`,\r\n\r\n  taskCancel: `\r\n# Cancel task with safe rollback and cascade\r\nclaude-flow task cancel task-789 \\\\\r\n  --reason \"Requirements changed\" \\\\\r\n  --cascade \\\\\r\n  --dry-run\r\n`,\r\n\r\n  taskWorkflow: `\r\n# Create and execute workflows\r\nclaude-flow task workflow create \"E-commerce Platform\" \\\\\r\n  --description \"Complete e-commerce development workflow\" \\\\\r\n  --max-concurrent 8 \\\\\r\n  --strategy priority-based \\\\\r\n  --error-handling continue-on-error\r\n\r\nclaude-flow task workflow execute workflow-123 \\\\\r\n  --variables '{\"environment\":\"staging\",\"version\":\"2.1.0\"}' \\\\\r\n  --monitor\r\n\r\nclaude-flow task workflow visualize workflow-123 \\\\\r\n  --format dot \\\\\r\n  --output workflow-graph.dot\r\n`,\r\n};\r\n\r\nexport default {\r\n  initializeTaskManagement,\r\n  createTaskTodos,\r\n  launchParallelAgents,\r\n  storeCoordinationData,\r\n  retrieveCoordinationData,\r\n  USAGE_EXAMPLES,\r\n  CLI_EXAMPLES,\r\n};\r\n"],"names":["TaskEngine","createTaskCreateCommand","createTaskListCommand","createTaskStatusCommand","createTaskCancelCommand","createTaskWorkflowCommand","TaskCoordinator","initializeTaskManagement","config","taskEngine","maxConcurrentTasks","memoryManager","taskCoordinator","commandContext","logger","commands","create","list","status","cancel","workflow","createTaskTodos","objective","options","coordinator","Error","context","sessionId","Date","now","coordinationMode","batchOptimized","launchParallelAgents","tasks","storeCoordinationData","key","value","storeInMemory","retrieveCoordinationData","namespace","retrieveFromMemory","USAGE_EXAMPLES","todoWrite","taskTool","memoryCoordination","batchOperations","swarmCoordination","CLI_EXAMPLES","taskCreate","taskList","taskStatus","taskCancel","taskWorkflow"],"mappings":"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"}