{"version":3,"sources":["../../../src/swarm/json-output-aggregator.ts"],"sourcesContent":["/**\r\n * JSON Output Aggregator for Non-Interactive Swarm Execution\r\n * Collects and formats swarm results into a comprehensive JSON structure\r\n */\r\n\r\nimport { EventEmitter } from 'events';\r\nimport { promises as fs } from 'node:fs';\r\nimport { generateId } from '../utils/helpers.js';\r\nimport { Logger } from '../core/logger.js';\r\nimport type {\r\n  SwarmId,\r\n  AgentId,\r\n  TaskId,\r\n  AgentState,\r\n  TaskDefinition,\r\n  SwarmResults,\r\n  SwarmMetrics,\r\n  TaskResult,\r\n} from './types.js';\r\n\r\nexport interface SwarmOutputAggregate {\r\n  swarmId: string;\r\n  objective: string;\r\n  startTime: string;\r\n  endTime: string;\r\n  duration: number;\r\n  status: 'completed' | 'failed' | 'timeout' | 'cancelled';\r\n  summary: {\r\n    totalAgents: number;\r\n    totalTasks: number;\r\n    completedTasks: number;\r\n    failedTasks: number;\r\n    successRate: number;\r\n  };\r\n  agents: AgentOutputData[];\r\n  tasks: TaskOutputData[];\r\n  results: {\r\n    artifacts: Record<string, any>;\r\n    outputs: string[];\r\n    errors: string[];\r\n    insights: string[];\r\n  };\r\n  metrics: SwarmMetrics;\r\n  metadata: {\r\n    strategy: string;\r\n    mode: string;\r\n    configuration: Record<string, any>;\r\n    version: string;\r\n  };\r\n}\r\n\r\nexport interface AgentOutputData {\r\n  agentId: string;\r\n  name: string;\r\n  type: string;\r\n  status: string;\r\n  startTime: string;\r\n  endTime?: string;\r\n  duration?: number;\r\n  tasksCompleted: number;\r\n  outputs: string[];\r\n  errors: string[];\r\n  metrics: {\r\n    tokensUsed?: number;\r\n    memoryAccess: number;\r\n    operationsPerformed: number;\r\n  };\r\n}\r\n\r\nexport interface TaskOutputData {\r\n  taskId: string;\r\n  name: string;\r\n  type: string;\r\n  status: string;\r\n  assignedAgent?: string;\r\n  startTime: string;\r\n  endTime?: string;\r\n  duration?: number;\r\n  priority: string;\r\n  output?: string;\r\n  result?: TaskResult;\r\n  artifacts?: Record<string, any>;\r\n  error?: string;\r\n}\r\n\r\nexport class SwarmJsonOutputAggregator extends EventEmitter {\r\n  private logger: Logger;\r\n  private swarmId: string;\r\n  private objective: string;\r\n  private startTime: Date;\r\n  private endTime?: Date;\r\n  private configuration: Record<string, any>;\r\n\r\n  // Data collection\r\n  private agents: Map<string, AgentOutputData> = new Map();\r\n  private tasks: Map<string, TaskOutputData> = new Map();\r\n  private outputs: string[] = [];\r\n  private errors: string[] = [];\r\n  private insights: string[] = [];\r\n  private artifacts: Record<string, any> = {};\r\n  private metrics: SwarmMetrics = this.initializeMetrics();\r\n\r\n  constructor(swarmId: string, objective: string, configuration: Record<string, any> = {}) {\r\n    super();\r\n    this.swarmId = swarmId;\r\n    this.objective = objective;\r\n    this.configuration = configuration;\r\n    this.startTime = new Date();\r\n\r\n    this.logger = new Logger(\r\n      { level: 'info', format: 'json', destination: 'console' },\r\n      { component: 'SwarmJsonAggregator' },\r\n    );\r\n\r\n    this.logger.info('JSON output aggregator initialized', {\r\n      swarmId,\r\n      objective,\r\n      timestamp: this.startTime.toISOString(),\r\n    });\r\n  }\r\n\r\n  // Agent tracking methods\r\n  addAgent(agent: AgentState): void {\r\n    // Handle null/undefined agent IDs gracefully\r\n    if (!agent || !agent.id) {\r\n      this.logger.warn('Attempted to add agent with null/undefined ID, skipping');\r\n      return;\r\n    }\r\n\r\n    const agentIdStr = typeof agent.id === 'string' ? agent.id : agent.id.id;\r\n    const agentData: AgentOutputData = {\r\n      agentId: agentIdStr,\r\n      name: agent.name || agentIdStr,\r\n      type: agent.type,\r\n      status: agent.status,\r\n      startTime: new Date().toISOString(),\r\n      tasksCompleted: 0,\r\n      outputs: [],\r\n      errors: [],\r\n      metrics: {\r\n        memoryAccess: 0,\r\n        operationsPerformed: 0,\r\n      },\r\n    };\r\n\r\n    this.agents.set(agentIdStr, agentData);\r\n    this.logger.debug('Agent added to output tracking', { agentId: agentIdStr });\r\n  }\r\n\r\n  updateAgent(agentId: string, updates: Partial<AgentOutputData>): void {\r\n    const agent = this.agents.get(agentId);\r\n    if (agent) {\r\n      Object.assign(agent, updates);\r\n      this.logger.debug('Agent updated in output tracking', { agentId, updates });\r\n    }\r\n  }\r\n\r\n  addAgentOutput(agentId: string, output: string): void {\r\n    const agent = this.agents.get(agentId);\r\n    if (agent) {\r\n      agent.outputs.push(output);\r\n      agent.metrics.operationsPerformed++;\r\n    }\r\n    this.outputs.push(`[${agentId}] ${output}`);\r\n  }\r\n\r\n  addAgentError(agentId: string, error: string): void {\r\n    const agent = this.agents.get(agentId);\r\n    if (agent) {\r\n      agent.errors.push(error);\r\n    }\r\n    this.errors.push(`[${agentId}] ${error}`);\r\n  }\r\n\r\n  // Task tracking methods\r\n  addTask(task: TaskDefinition): void {\r\n    // Handle null/undefined task IDs gracefully\r\n    if (!task || !task.id) {\r\n      this.logger.warn('Attempted to add task with null/undefined ID, skipping');\r\n      return;\r\n    }\r\n\r\n    const taskIdStr = typeof task.id === 'string' ? task.id : task.id.id;\r\n    const taskData: TaskOutputData = {\r\n      taskId: taskIdStr,\r\n      name: task.name || taskIdStr,\r\n      type: task.type,\r\n      status: task.status,\r\n      assignedAgent: task.assignedAt\r\n        ? typeof task.assignedAt === 'string'\r\n          ? task.assignedAt\r\n          : task.assignedAt.toString()\r\n        : undefined,\r\n      startTime: new Date().toISOString(),\r\n      priority: task.priority || 'normal',\r\n    };\r\n\r\n    this.tasks.set(taskIdStr, taskData);\r\n    this.logger.debug('Task added to output tracking', { taskId: taskIdStr });\r\n  }\r\n\r\n  updateTask(taskId: string, updates: Partial<TaskOutputData>): void {\r\n    const task = this.tasks.get(taskId);\r\n    if (task) {\r\n      Object.assign(task, updates);\r\n      this.logger.debug('Task updated in output tracking', { taskId, updates });\r\n    }\r\n  }\r\n\r\n  completeTask(taskId: string, result: TaskResult): void {\r\n    const task = this.tasks.get(taskId);\r\n    if (task) {\r\n      task.status = 'completed';\r\n      task.endTime = new Date().toISOString();\r\n      task.duration = task.startTime ? Date.now() - new Date(task.startTime).getTime() : 0;\r\n      task.result = result;\r\n      task.output = result.output;\r\n      task.artifacts = result.artifacts;\r\n\r\n      // Update agent completion count\r\n      if (task.assignedAgent) {\r\n        const agent = this.agents.get(task.assignedAgent);\r\n        if (agent) {\r\n          agent.tasksCompleted++;\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  // Global tracking methods\r\n  addInsight(insight: string): void {\r\n    this.insights.push(insight);\r\n    this.logger.debug('Insight added', { insight });\r\n  }\r\n\r\n  addArtifact(key: string, artifact: any): void {\r\n    this.artifacts[key] = artifact;\r\n    this.logger.debug('Artifact added', { key });\r\n  }\r\n\r\n  updateMetrics(updates: Partial<SwarmMetrics>): void {\r\n    Object.assign(this.metrics, updates);\r\n  }\r\n\r\n  // Finalization and output\r\n  finalize(\r\n    status: 'completed' | 'failed' | 'timeout' | 'cancelled' = 'completed',\r\n  ): SwarmOutputAggregate {\r\n    this.endTime = new Date();\r\n    const duration = this.endTime.getTime() - this.startTime.getTime();\r\n\r\n    // Calculate summary statistics\r\n    const totalTasks = this.tasks.size;\r\n    const completedTasks = Array.from(this.tasks.values()).filter(\r\n      (task) => task.status === 'completed',\r\n    ).length;\r\n    const failedTasks = Array.from(this.tasks.values()).filter(\r\n      (task) => task.status === 'failed',\r\n    ).length;\r\n    const successRate = totalTasks > 0 ? completedTasks / totalTasks : 0;\r\n\r\n    // Finalize agent data\r\n    this.agents.forEach((agent) => {\r\n      if (!agent.endTime) {\r\n        agent.endTime = this.endTime.toISOString();\r\n        agent.duration = Date.now() - new Date(agent.startTime).getTime();\r\n      }\r\n    });\r\n\r\n    const aggregate: SwarmOutputAggregate = {\r\n      swarmId: this.swarmId,\r\n      objective: this.objective,\r\n      startTime: this.startTime.toISOString(),\r\n      endTime: this.endTime.toISOString(),\r\n      duration,\r\n      status,\r\n      summary: {\r\n        totalAgents: this.agents.size,\r\n        totalTasks,\r\n        completedTasks,\r\n        failedTasks,\r\n        successRate,\r\n      },\r\n      agents: Array.from(this.agents.values()),\r\n      tasks: Array.from(this.tasks.values()),\r\n      results: {\r\n        artifacts: this.artifacts,\r\n        outputs: this.outputs,\r\n        errors: this.errors,\r\n        insights: this.insights,\r\n      },\r\n      metrics: this.metrics,\r\n      metadata: {\r\n        strategy: this.configuration.strategy || 'auto',\r\n        mode: this.configuration.mode || 'centralized',\r\n        configuration: this.configuration,\r\n        version: '2.0.0-alpha',\r\n      },\r\n    };\r\n\r\n    this.logger.info('Swarm output aggregation finalized', {\r\n      swarmId: this.swarmId,\r\n      status,\r\n      duration,\r\n      summary: aggregate.summary,\r\n    });\r\n\r\n    return aggregate;\r\n  }\r\n\r\n  async saveToFile(\r\n    filePath: string,\r\n    status: 'completed' | 'failed' | 'timeout' | 'cancelled' = 'completed',\r\n  ): Promise<void> {\r\n    const aggregate = this.finalize(status);\r\n    const json = JSON.stringify(aggregate, this.circularReplacer(), 2);\r\n    await fs.writeFile(filePath, json, 'utf8');\r\n    this.logger.info('Swarm output saved to file', { filePath, size: json.length });\r\n  }\r\n\r\n  getJsonOutput(status: 'completed' | 'failed' | 'timeout' | 'cancelled' = 'completed'): string {\r\n    const aggregate = this.finalize(status);\r\n    return JSON.stringify(aggregate, this.circularReplacer(), 2);\r\n  }\r\n\r\n  // Handle circular references in JSON serialization\r\n  private circularReplacer(): (key: string, value: any) => any {\r\n    const seen = new WeakSet();\r\n    return (key: string, value: any) => {\r\n      if (typeof value === 'object' && value !== null) {\r\n        if (seen.has(value)) {\r\n          return '[Circular]';\r\n        }\r\n        seen.add(value);\r\n      }\r\n      return value;\r\n    };\r\n  }\r\n\r\n  private initializeMetrics(): SwarmMetrics {\r\n    return {\r\n      // Performance metrics\r\n      throughput: 0,\r\n      latency: 0,\r\n      efficiency: 0,\r\n      reliability: 0,\r\n\r\n      // Quality metrics\r\n      averageQuality: 0,\r\n      defectRate: 0,\r\n      reworkRate: 0,\r\n\r\n      // Resource metrics\r\n      resourceUtilization: {\r\n        cpu: 0,\r\n        memory: 0,\r\n        disk: 0,\r\n        network: 0,\r\n      },\r\n      costEfficiency: 0,\r\n\r\n      // Agent metrics\r\n      agentUtilization: 0,\r\n      agentSatisfaction: 0,\r\n      collaborationEffectiveness: 0,\r\n\r\n      // Timeline metrics\r\n      scheduleVariance: 0,\r\n      deadlineAdherence: 0,\r\n    };\r\n  }\r\n}\r\n"],"names":["EventEmitter","promises","fs","Logger","SwarmJsonOutputAggregator","logger","swarmId","objective","startTime","endTime","configuration","agents","Map","tasks","outputs","errors","insights","artifacts","metrics","initializeMetrics","Date","level","format","destination","component","info","timestamp","toISOString","addAgent","agent","id","warn","agentIdStr","agentData","agentId","name","type","status","tasksCompleted","memoryAccess","operationsPerformed","set","debug","updateAgent","updates","get","Object","assign","addAgentOutput","output","push","addAgentError","error","addTask","task","taskIdStr","taskData","taskId","assignedAgent","assignedAt","toString","undefined","priority","updateTask","completeTask","result","duration","now","getTime","addInsight","insight","addArtifact","key","artifact","updateMetrics","finalize","totalTasks","size","completedTasks","Array","from","values","filter","length","failedTasks","successRate","forEach","aggregate","summary","totalAgents","results","metadata","strategy","mode","version","saveToFile","filePath","json","JSON","stringify","circularReplacer","writeFile","getJsonOutput","seen","WeakSet","value","has","add","throughput","latency","efficiency","reliability","averageQuality","defectRate","reworkRate","resourceUtilization","cpu","memory","disk","network","costEfficiency","agentUtilization","agentSatisfaction","collaborationEffectiveness","scheduleVariance","deadlineAdherence"],"mappings":"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"}