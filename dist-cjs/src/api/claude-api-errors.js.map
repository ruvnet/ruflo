{"version":3,"sources":["../../../src/api/claude-api-errors.ts"],"sourcesContent":["/**\r\n * Claude API specific error types with enhanced error handling\r\n */\r\n\r\nimport { ClaudeFlowError } from '../utils/errors.js';\r\n\r\n/**\r\n * Base error class for Claude API errors\r\n */\r\nexport class ClaudeAPIError extends ClaudeFlowError {\r\n  constructor(\r\n    message: string,\r\n    public readonly statusCode?: number,\r\n    public readonly retryable: boolean = false,\r\n    details?: unknown,\r\n  ) {\r\n    super(message, 'CLAUDE_API_ERROR', details);\r\n    this.name = 'ClaudeAPIError';\r\n  }\r\n}\r\n\r\n/**\r\n * Error for 500 Internal Server Error\r\n */\r\nexport class ClaudeInternalServerError extends ClaudeAPIError {\r\n  constructor(message: string, details?: unknown) {\r\n    super(\r\n      message || 'Claude API internal server error. The service may be temporarily unavailable.',\r\n      500,\r\n      true, // Retryable\r\n      details,\r\n    );\r\n    this.name = 'ClaudeInternalServerError';\r\n  }\r\n}\r\n\r\n/**\r\n * Error for 503 Service Unavailable\r\n */\r\nexport class ClaudeServiceUnavailableError extends ClaudeAPIError {\r\n  constructor(message: string, details?: unknown) {\r\n    super(\r\n      message || 'Claude API service is temporarily unavailable. Please try again later.',\r\n      503,\r\n      true, // Retryable\r\n      details,\r\n    );\r\n    this.name = 'ClaudeServiceUnavailableError';\r\n  }\r\n}\r\n\r\n/**\r\n * Error for 429 Too Many Requests (Rate Limit)\r\n */\r\nexport class ClaudeRateLimitError extends ClaudeAPIError {\r\n  constructor(\r\n    message: string,\r\n    public readonly retryAfter?: number,\r\n    details?: unknown,\r\n  ) {\r\n    super(\r\n      message || 'Rate limit exceeded. Please wait before making more requests.',\r\n      429,\r\n      true, // Retryable\r\n      details,\r\n    );\r\n    this.name = 'ClaudeRateLimitError';\r\n  }\r\n}\r\n\r\n/**\r\n * Error for network timeouts\r\n */\r\nexport class ClaudeTimeoutError extends ClaudeAPIError {\r\n  constructor(message: string, public readonly timeout: number, details?: unknown) {\r\n    super(\r\n      message || `Request timed out after ${timeout}ms. The API may be slow or unreachable.`,\r\n      undefined,\r\n      true, // Retryable\r\n      details,\r\n    );\r\n    this.name = 'ClaudeTimeoutError';\r\n  }\r\n}\r\n\r\n/**\r\n * Error for network-related issues\r\n */\r\nexport class ClaudeNetworkError extends ClaudeAPIError {\r\n  constructor(message: string, details?: unknown) {\r\n    super(\r\n      message || 'Network error occurred. Please check your internet connection.',\r\n      undefined,\r\n      true, // Retryable\r\n      details,\r\n    );\r\n    this.name = 'ClaudeNetworkError';\r\n  }\r\n}\r\n\r\n/**\r\n * Error for authentication issues\r\n */\r\nexport class ClaudeAuthenticationError extends ClaudeAPIError {\r\n  constructor(message: string, details?: unknown) {\r\n    super(\r\n      message || 'Authentication failed. Please check your API key.',\r\n      401,\r\n      false, // Not retryable\r\n      details,\r\n    );\r\n    this.name = 'ClaudeAuthenticationError';\r\n  }\r\n}\r\n\r\n/**\r\n * Error for invalid requests\r\n */\r\nexport class ClaudeValidationError extends ClaudeAPIError {\r\n  constructor(message: string, details?: unknown) {\r\n    super(\r\n      message || 'Invalid request. Please check your parameters.',\r\n      400,\r\n      false, // Not retryable\r\n      details,\r\n    );\r\n    this.name = 'ClaudeValidationError';\r\n  }\r\n}\r\n\r\n/**\r\n * Health check result\r\n */\r\nexport interface HealthCheckResult {\r\n  healthy: boolean;\r\n  latency?: number;\r\n  error?: string;\r\n  timestamp: Date;\r\n}\r\n\r\n/**\r\n * User-friendly error messages and fallback suggestions\r\n */\r\nexport const ERROR_MESSAGES = {\r\n  INTERNAL_SERVER_ERROR: {\r\n    title: 'Claude API Service Error',\r\n    message: 'The Claude API is experiencing technical difficulties.',\r\n    suggestions: [\r\n      'Wait a few minutes and try again',\r\n      'Check the Anthropic status page for service updates',\r\n      'Consider using a fallback AI service if available',\r\n      'Cache previous responses for offline usage',\r\n    ],\r\n  },\r\n  SERVICE_UNAVAILABLE: {\r\n    title: 'Service Temporarily Unavailable',\r\n    message: 'Claude API is temporarily unavailable or undergoing maintenance.',\r\n    suggestions: [\r\n      'Try again in 5-10 minutes',\r\n      'Check if there\\'s scheduled maintenance',\r\n      'Use cached responses if available',\r\n      'Consider implementing a queue for requests',\r\n    ],\r\n  },\r\n  RATE_LIMIT: {\r\n    title: 'Rate Limit Exceeded',\r\n    message: 'You\\'ve made too many requests to the Claude API.',\r\n    suggestions: [\r\n      'Implement request throttling',\r\n      'Batch multiple requests together',\r\n      'Consider upgrading your API plan',\r\n      'Use exponential backoff for retries',\r\n    ],\r\n  },\r\n  TIMEOUT: {\r\n    title: 'Request Timeout',\r\n    message: 'The request took too long to complete.',\r\n    suggestions: [\r\n      'Check your internet connection',\r\n      'Try a simpler request',\r\n      'Increase the timeout duration',\r\n      'Break large requests into smaller ones',\r\n    ],\r\n  },\r\n  NETWORK_ERROR: {\r\n    title: 'Network Connection Error',\r\n    message: 'Unable to connect to the Claude API.',\r\n    suggestions: [\r\n      'Check your internet connection',\r\n      'Verify firewall/proxy settings',\r\n      'Try using a different network',\r\n      'Check if the API endpoint is correct',\r\n    ],\r\n  },\r\n  AUTHENTICATION: {\r\n    title: 'Authentication Failed',\r\n    message: 'Unable to authenticate with the Claude API.',\r\n    suggestions: [\r\n      'Verify your API key is correct',\r\n      'Check if your API key has expired',\r\n      'Ensure the API key has proper permissions',\r\n      'Generate a new API key if needed',\r\n    ],\r\n  },\r\n  VALIDATION: {\r\n    title: 'Invalid Request',\r\n    message: 'The request contains invalid parameters.',\r\n    suggestions: [\r\n      'Check the request parameters',\r\n      'Verify the model name is correct',\r\n      'Ensure message format is valid',\r\n      'Review the API documentation',\r\n    ],\r\n  },\r\n};\r\n\r\n/**\r\n * Get user-friendly error information\r\n */\r\nexport function getUserFriendlyError(error: ClaudeAPIError): {\r\n  title: string;\r\n  message: string;\r\n  suggestions: string[];\r\n  retryable: boolean;\r\n} {\r\n  let errorInfo = ERROR_MESSAGES.INTERNAL_SERVER_ERROR; // Default\r\n  \r\n  if (error instanceof ClaudeInternalServerError) {\r\n    errorInfo = ERROR_MESSAGES.INTERNAL_SERVER_ERROR;\r\n  } else if (error instanceof ClaudeServiceUnavailableError) {\r\n    errorInfo = ERROR_MESSAGES.SERVICE_UNAVAILABLE;\r\n  } else if (error instanceof ClaudeRateLimitError) {\r\n    errorInfo = ERROR_MESSAGES.RATE_LIMIT;\r\n  } else if (error instanceof ClaudeTimeoutError) {\r\n    errorInfo = ERROR_MESSAGES.TIMEOUT;\r\n  } else if (error instanceof ClaudeNetworkError) {\r\n    errorInfo = ERROR_MESSAGES.NETWORK_ERROR;\r\n  } else if (error instanceof ClaudeAuthenticationError) {\r\n    errorInfo = ERROR_MESSAGES.AUTHENTICATION;\r\n  } else if (error instanceof ClaudeValidationError) {\r\n    errorInfo = ERROR_MESSAGES.VALIDATION;\r\n  }\r\n\r\n  return {\r\n    ...errorInfo,\r\n    retryable: error.retryable,\r\n  };\r\n}"],"names":["ClaudeFlowError","ClaudeAPIError","message","statusCode","retryable","details","name","ClaudeInternalServerError","ClaudeServiceUnavailableError","ClaudeRateLimitError","retryAfter","ClaudeTimeoutError","timeout","undefined","ClaudeNetworkError","ClaudeAuthenticationError","ClaudeValidationError","ERROR_MESSAGES","INTERNAL_SERVER_ERROR","title","suggestions","SERVICE_UNAVAILABLE","RATE_LIMIT","TIMEOUT","NETWORK_ERROR","AUTHENTICATION","VALIDATION","getUserFriendlyError","error","errorInfo"],"mappings":"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"}