{"version":3,"sources":["../../../../src/cli/__tests__/command-registry.test.js"],"sourcesContent":["/**\r\n * Tests for command-registry.js\r\n */\r\n\r\nimport { jest } from '@jest/globals';\r\nimport {\r\n  commandRegistry,\r\n  registerCoreCommands,\r\n  executeCommand,\r\n  hasCommand,\r\n  showCommandHelp,\r\n  showAllCommands,\r\n  listCommands,\r\n} from '../command-registry.js';\r\n\r\n// Mock all command modules\r\njest.mock('../simple-commands/init.js', () => ({\r\n  initCommand: jest.fn().mockResolvedValue(undefined),\r\n}));\r\n\r\njest.mock('../simple-commands/memory.js', () => ({\r\n  memoryCommand: jest.fn().mockResolvedValue(undefined),\r\n}));\r\n\r\njest.mock('../simple-commands/agent.js', () => ({\r\n  agentCommand: jest.fn().mockResolvedValue(undefined),\r\n}));\r\n\r\njest.mock('../simple-commands/task.js', () => ({\r\n  taskCommand: jest.fn().mockResolvedValue(undefined),\r\n}));\r\n\r\njest.mock('../simple-commands/swarm.js', () => ({\r\n  swarmCommand: jest.fn().mockResolvedValue(undefined),\r\n}));\r\n\r\njest.mock('../simple-commands/config.js', () => ({\r\n  configCommand: jest.fn().mockResolvedValue(undefined),\r\n}));\r\n\r\njest.mock('../simple-commands/status.js', () => ({\r\n  statusCommand: jest.fn().mockResolvedValue(undefined),\r\n}));\r\n\r\njest.mock('../simple-commands/mcp.js', () => ({\r\n  mcpCommand: jest.fn().mockResolvedValue(undefined),\r\n}));\r\n\r\njest.mock('../simple-commands/monitor.js', () => ({\r\n  monitorCommand: jest.fn().mockResolvedValue(undefined),\r\n}));\r\n\r\njest.mock('../simple-commands/start.js', () => ({\r\n  startCommand: jest.fn().mockResolvedValue(undefined),\r\n}));\r\n\r\njest.mock('../simple-commands/sparc.js', () => ({\r\n  sparcCommand: jest.fn().mockResolvedValue(undefined),\r\n}));\r\n\r\njest.mock('../simple-commands/batch-manager.js', () => ({\r\n  batchManagerCommand: jest.fn().mockResolvedValue(undefined),\r\n}));\r\n\r\njest.mock('../commands/ruv-swarm.js', () => ({\r\n  ruvSwarmAction: jest.fn().mockResolvedValue(undefined),\r\n}));\r\n\r\njest.mock('../commands/config-integration.js', () => ({\r\n  configIntegrationAction: jest.fn().mockResolvedValue(undefined),\r\n}));\r\n\r\ndescribe('Command Registry', () => {\r\n  let consoleLogSpy;\r\n  let consoleErrorSpy;\r\n\r\n  beforeEach(() => {\r\n    commandRegistry.clear();\r\n    consoleLogSpy = jest.spyOn(console, 'log').mockImplementation();\r\n    consoleErrorSpy = jest.spyOn(console, 'error').mockImplementation();\r\n    jest.clearAllMocks();\r\n  });\r\n\r\n  afterEach(() => {\r\n    consoleLogSpy.mockRestore();\r\n    consoleErrorSpy.mockRestore();\r\n  });\r\n\r\n  describe('registerCoreCommands', () => {\r\n    test('should register all core commands', () => {\r\n      registerCoreCommands();\r\n\r\n      const expectedCommands = [\r\n        'init',\r\n        'start',\r\n        'memory',\r\n        'sparc',\r\n        'agent',\r\n        'task',\r\n        'config',\r\n        'status',\r\n        'mcp',\r\n        'monitor',\r\n        'swarm',\r\n        'batch-manager',\r\n        'github',\r\n        'docker',\r\n        'ruv-swarm',\r\n        'config-integration',\r\n      ];\r\n\r\n      expectedCommands.forEach((cmd) => {\r\n        expect(commandRegistry.has(cmd)).toBe(true);\r\n      });\r\n    });\r\n\r\n    test('should register commands with correct metadata', () => {\r\n      registerCoreCommands();\r\n\r\n      const initCmd = commandRegistry.get('init');\r\n      expect(initCmd).toHaveProperty('handler');\r\n      expect(initCmd).toHaveProperty('description');\r\n      expect(initCmd).toHaveProperty('usage');\r\n      expect(initCmd).toHaveProperty('examples');\r\n      expect(initCmd.description).toContain('Initialize Claude Code integration');\r\n    });\r\n  });\r\n\r\n  describe('hasCommand', () => {\r\n    beforeEach(() => {\r\n      registerCoreCommands();\r\n    });\r\n\r\n    test('should return true for registered commands', () => {\r\n      expect(hasCommand('init')).toBe(true);\r\n      expect(hasCommand('swarm')).toBe(true);\r\n      expect(hasCommand('agent')).toBe(true);\r\n    });\r\n\r\n    test('should return false for unregistered commands', () => {\r\n      expect(hasCommand('nonexistent')).toBe(false);\r\n      expect(hasCommand('')).toBe(false);\r\n      expect(hasCommand(null)).toBe(false);\r\n    });\r\n  });\r\n\r\n  describe('executeCommand', () => {\r\n    beforeEach(() => {\r\n      registerCoreCommands();\r\n    });\r\n\r\n    test('should execute command handler with arguments', async () => {\r\n      const { initCommand } = await import('../simple-commands/init.js');\r\n\r\n      await executeCommand('init', ['--sparc'], { force: true });\r\n\r\n      expect(initCommand).toHaveBeenCalledWith(['--sparc'], { force: true });\r\n    });\r\n\r\n    test('should throw error for unknown command', async () => {\r\n      await expect(executeCommand('unknown', [], {})).rejects.toThrow('Unknown command: unknown');\r\n    });\r\n\r\n    test('should handle command execution errors', async () => {\r\n      const { swarmCommand } = await import('../simple-commands/swarm.js');\r\n      swarmCommand.mockRejectedValue(new Error('Command failed'));\r\n\r\n      await expect(executeCommand('swarm', ['test'], {})).rejects.toThrow('Command failed');\r\n    });\r\n  });\r\n\r\n  describe('showCommandHelp', () => {\r\n    beforeEach(() => {\r\n      registerCoreCommands();\r\n    });\r\n\r\n    test('should display help for existing command', () => {\r\n      showCommandHelp('init');\r\n\r\n      const output = consoleLogSpy.mock.calls.flat().join('\\n');\r\n      expect(output).toContain('init');\r\n      expect(output).toContain('Initialize Claude Code integration');\r\n      expect(output).toContain('Usage:');\r\n      expect(output).toContain('Examples:');\r\n    });\r\n\r\n    test('should show error for unknown command', () => {\r\n      showCommandHelp('unknown');\r\n\r\n      expect(consoleErrorSpy).toHaveBeenCalledWith(\r\n        expect.stringContaining('Unknown command: unknown'),\r\n      );\r\n    });\r\n  });\r\n\r\n  describe('showAllCommands', () => {\r\n    test('should display all registered commands grouped by category', () => {\r\n      registerCoreCommands();\r\n      showAllCommands();\r\n\r\n      const output = consoleLogSpy.mock.calls.flat().join('\\n');\r\n\r\n      // Check for categories\r\n      expect(output).toContain('SWARM INTELLIGENCE COMMANDS');\r\n      expect(output).toContain('WORKFLOW AUTOMATION');\r\n      expect(output).toContain('DEVELOPMENT & TESTING');\r\n      expect(output).toContain('INFRASTRUCTURE');\r\n\r\n      // Check for specific commands\r\n      expect(output).toContain('swarm');\r\n      expect(output).toContain('agent');\r\n      expect(output).toContain('task');\r\n      expect(output).toContain('github');\r\n      expect(output).toContain('docker');\r\n    });\r\n  });\r\n\r\n  describe('listCommands', () => {\r\n    test('should return array of all command names', () => {\r\n      registerCoreCommands();\r\n      const commands = listCommands();\r\n\r\n      expect(Array.isArray(commands)).toBe(true);\r\n      expect(commands).toContain('init');\r\n      expect(commands).toContain('swarm');\r\n      expect(commands).toContain('agent');\r\n      expect(commands.length).toBeGreaterThan(10);\r\n    });\r\n\r\n    test('should return empty array when no commands registered', () => {\r\n      commandRegistry.clear();\r\n      const commands = listCommands();\r\n\r\n      expect(commands).toEqual([]);\r\n    });\r\n  });\r\n});\r\n"],"names":["jest","commandRegistry","registerCoreCommands","executeCommand","hasCommand","showCommandHelp","showAllCommands","listCommands","mock","initCommand","fn","mockResolvedValue","undefined","memoryCommand","agentCommand","taskCommand","swarmCommand","configCommand","statusCommand","mcpCommand","monitorCommand","startCommand","sparcCommand","batchManagerCommand","ruvSwarmAction","configIntegrationAction","describe","consoleLogSpy","consoleErrorSpy","beforeEach","clear","spyOn","console","mockImplementation","clearAllMocks","afterEach","mockRestore","test","expectedCommands","forEach","cmd","expect","has","toBe","initCmd","get","toHaveProperty","description","toContain","force","toHaveBeenCalledWith","rejects","toThrow","mockRejectedValue","Error","output","calls","flat","join","stringContaining","commands","Array","isArray","length","toBeGreaterThan","toEqual"],"mappings":"AAIA,SAASA,IAAI,QAAQ,gBAAgB;AACrC,SACEC,eAAe,EACfC,oBAAoB,EACpBC,cAAc,EACdC,UAAU,EACVC,eAAe,EACfC,eAAe,EACfC,YAAY,QACP,yBAAyB;AAGhCP,KAAKQ,IAAI,CAAC,8BAA8B,IAAO,CAAA;QAC7CC,aAAaT,KAAKU,EAAE,GAAGC,iBAAiB,CAACC;IAC3C,CAAA;AAEAZ,KAAKQ,IAAI,CAAC,gCAAgC,IAAO,CAAA;QAC/CK,eAAeb,KAAKU,EAAE,GAAGC,iBAAiB,CAACC;IAC7C,CAAA;AAEAZ,KAAKQ,IAAI,CAAC,+BAA+B,IAAO,CAAA;QAC9CM,cAAcd,KAAKU,EAAE,GAAGC,iBAAiB,CAACC;IAC5C,CAAA;AAEAZ,KAAKQ,IAAI,CAAC,8BAA8B,IAAO,CAAA;QAC7CO,aAAaf,KAAKU,EAAE,GAAGC,iBAAiB,CAACC;IAC3C,CAAA;AAEAZ,KAAKQ,IAAI,CAAC,+BAA+B,IAAO,CAAA;QAC9CQ,cAAchB,KAAKU,EAAE,GAAGC,iBAAiB,CAACC;IAC5C,CAAA;AAEAZ,KAAKQ,IAAI,CAAC,gCAAgC,IAAO,CAAA;QAC/CS,eAAejB,KAAKU,EAAE,GAAGC,iBAAiB,CAACC;IAC7C,CAAA;AAEAZ,KAAKQ,IAAI,CAAC,gCAAgC,IAAO,CAAA;QAC/CU,eAAelB,KAAKU,EAAE,GAAGC,iBAAiB,CAACC;IAC7C,CAAA;AAEAZ,KAAKQ,IAAI,CAAC,6BAA6B,IAAO,CAAA;QAC5CW,YAAYnB,KAAKU,EAAE,GAAGC,iBAAiB,CAACC;IAC1C,CAAA;AAEAZ,KAAKQ,IAAI,CAAC,iCAAiC,IAAO,CAAA;QAChDY,gBAAgBpB,KAAKU,EAAE,GAAGC,iBAAiB,CAACC;IAC9C,CAAA;AAEAZ,KAAKQ,IAAI,CAAC,+BAA+B,IAAO,CAAA;QAC9Ca,cAAcrB,KAAKU,EAAE,GAAGC,iBAAiB,CAACC;IAC5C,CAAA;AAEAZ,KAAKQ,IAAI,CAAC,+BAA+B,IAAO,CAAA;QAC9Cc,cAActB,KAAKU,EAAE,GAAGC,iBAAiB,CAACC;IAC5C,CAAA;AAEAZ,KAAKQ,IAAI,CAAC,uCAAuC,IAAO,CAAA;QACtDe,qBAAqBvB,KAAKU,EAAE,GAAGC,iBAAiB,CAACC;IACnD,CAAA;AAEAZ,KAAKQ,IAAI,CAAC,4BAA4B,IAAO,CAAA;QAC3CgB,gBAAgBxB,KAAKU,EAAE,GAAGC,iBAAiB,CAACC;IAC9C,CAAA;AAEAZ,KAAKQ,IAAI,CAAC,qCAAqC,IAAO,CAAA;QACpDiB,yBAAyBzB,KAAKU,EAAE,GAAGC,iBAAiB,CAACC;IACvD,CAAA;AAEAc,SAAS,oBAAoB;IAC3B,IAAIC;IACJ,IAAIC;IAEJC,WAAW;QACT5B,gBAAgB6B,KAAK;QACrBH,gBAAgB3B,KAAK+B,KAAK,CAACC,SAAS,OAAOC,kBAAkB;QAC7DL,kBAAkB5B,KAAK+B,KAAK,CAACC,SAAS,SAASC,kBAAkB;QACjEjC,KAAKkC,aAAa;IACpB;IAEAC,UAAU;QACRR,cAAcS,WAAW;QACzBR,gBAAgBQ,WAAW;IAC7B;IAEAV,SAAS,wBAAwB;QAC/BW,KAAK,qCAAqC;YACxCnC;YAEA,MAAMoC,mBAAmB;gBACvB;gBACA;gBACA;gBACA;gBACA;gBACA;gBACA;gBACA;gBACA;gBACA;gBACA;gBACA;gBACA;gBACA;gBACA;gBACA;aACD;YAEDA,iBAAiBC,OAAO,CAAC,CAACC;gBACxBC,OAAOxC,gBAAgByC,GAAG,CAACF,MAAMG,IAAI,CAAC;YACxC;QACF;QAEAN,KAAK,kDAAkD;YACrDnC;YAEA,MAAM0C,UAAU3C,gBAAgB4C,GAAG,CAAC;YACpCJ,OAAOG,SAASE,cAAc,CAAC;YAC/BL,OAAOG,SAASE,cAAc,CAAC;YAC/BL,OAAOG,SAASE,cAAc,CAAC;YAC/BL,OAAOG,SAASE,cAAc,CAAC;YAC/BL,OAAOG,QAAQG,WAAW,EAAEC,SAAS,CAAC;QACxC;IACF;IAEAtB,SAAS,cAAc;QACrBG,WAAW;YACT3B;QACF;QAEAmC,KAAK,8CAA8C;YACjDI,OAAOrC,WAAW,SAASuC,IAAI,CAAC;YAChCF,OAAOrC,WAAW,UAAUuC,IAAI,CAAC;YACjCF,OAAOrC,WAAW,UAAUuC,IAAI,CAAC;QACnC;QAEAN,KAAK,iDAAiD;YACpDI,OAAOrC,WAAW,gBAAgBuC,IAAI,CAAC;YACvCF,OAAOrC,WAAW,KAAKuC,IAAI,CAAC;YAC5BF,OAAOrC,WAAW,OAAOuC,IAAI,CAAC;QAChC;IACF;IAEAjB,SAAS,kBAAkB;QACzBG,WAAW;YACT3B;QACF;QAEAmC,KAAK,iDAAiD;YACpD,MAAM,EAAE5B,WAAW,EAAE,GAAG,MAAM,MAAM,CAAC;YAErC,MAAMN,eAAe,QAAQ;gBAAC;aAAU,EAAE;gBAAE8C,OAAO;YAAK;YAExDR,OAAOhC,aAAayC,oBAAoB,CAAC;gBAAC;aAAU,EAAE;gBAAED,OAAO;YAAK;QACtE;QAEAZ,KAAK,0CAA0C;YAC7C,MAAMI,OAAOtC,eAAe,WAAW,EAAE,EAAE,CAAC,IAAIgD,OAAO,CAACC,OAAO,CAAC;QAClE;QAEAf,KAAK,0CAA0C;YAC7C,MAAM,EAAErB,YAAY,EAAE,GAAG,MAAM,MAAM,CAAC;YACtCA,aAAaqC,iBAAiB,CAAC,IAAIC,MAAM;YAEzC,MAAMb,OAAOtC,eAAe,SAAS;gBAAC;aAAO,EAAE,CAAC,IAAIgD,OAAO,CAACC,OAAO,CAAC;QACtE;IACF;IAEA1B,SAAS,mBAAmB;QAC1BG,WAAW;YACT3B;QACF;QAEAmC,KAAK,4CAA4C;YAC/ChC,gBAAgB;YAEhB,MAAMkD,SAAS5B,cAAcnB,IAAI,CAACgD,KAAK,CAACC,IAAI,GAAGC,IAAI,CAAC;YACpDjB,OAAOc,QAAQP,SAAS,CAAC;YACzBP,OAAOc,QAAQP,SAAS,CAAC;YACzBP,OAAOc,QAAQP,SAAS,CAAC;YACzBP,OAAOc,QAAQP,SAAS,CAAC;QAC3B;QAEAX,KAAK,yCAAyC;YAC5ChC,gBAAgB;YAEhBoC,OAAOb,iBAAiBsB,oBAAoB,CAC1CT,OAAOkB,gBAAgB,CAAC;QAE5B;IACF;IAEAjC,SAAS,mBAAmB;QAC1BW,KAAK,8DAA8D;YACjEnC;YACAI;YAEA,MAAMiD,SAAS5B,cAAcnB,IAAI,CAACgD,KAAK,CAACC,IAAI,GAAGC,IAAI,CAAC;YAGpDjB,OAAOc,QAAQP,SAAS,CAAC;YACzBP,OAAOc,QAAQP,SAAS,CAAC;YACzBP,OAAOc,QAAQP,SAAS,CAAC;YACzBP,OAAOc,QAAQP,SAAS,CAAC;YAGzBP,OAAOc,QAAQP,SAAS,CAAC;YACzBP,OAAOc,QAAQP,SAAS,CAAC;YACzBP,OAAOc,QAAQP,SAAS,CAAC;YACzBP,OAAOc,QAAQP,SAAS,CAAC;YACzBP,OAAOc,QAAQP,SAAS,CAAC;QAC3B;IACF;IAEAtB,SAAS,gBAAgB;QACvBW,KAAK,4CAA4C;YAC/CnC;YACA,MAAM0D,WAAWrD;YAEjBkC,OAAOoB,MAAMC,OAAO,CAACF,WAAWjB,IAAI,CAAC;YACrCF,OAAOmB,UAAUZ,SAAS,CAAC;YAC3BP,OAAOmB,UAAUZ,SAAS,CAAC;YAC3BP,OAAOmB,UAAUZ,SAAS,CAAC;YAC3BP,OAAOmB,SAASG,MAAM,EAAEC,eAAe,CAAC;QAC1C;QAEA3B,KAAK,yDAAyD;YAC5DpC,gBAAgB6B,KAAK;YACrB,MAAM8B,WAAWrD;YAEjBkC,OAAOmB,UAAUK,OAAO,CAAC,EAAE;QAC7B;IACF;AACF"}