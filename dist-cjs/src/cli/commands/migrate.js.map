{"version":3,"sources":["../../../../src/cli/commands/migrate.ts"],"sourcesContent":["/**\r\n * Migration CLI Command Integration\r\n */\r\n\r\nimport { Command } from '../commander-fix.js';\r\nimport { MigrationRunner } from '../../migration/migration-runner.js';\r\nimport { MigrationAnalyzer } from '../../migration/migration-analyzer.js';\r\nimport { RollbackManager } from '../../migration/rollback-manager.js';\r\nimport type { MigrationStrategy } from '../../migration/types.js';\r\nimport { logger } from '../../migration/logger.js';\r\nimport * as path from 'path';\r\nimport chalk from 'chalk';\r\n\r\nexport function createMigrateCommand(): Command {\r\n  const command = new Command('migrate');\r\n\r\n  command\r\n    .description('Migrate existing claude-flow projects to optimized prompts')\r\n    .option('-p, --path <path>', 'Project path', '.')\r\n    .option('-s, --strategy <type>', 'Migration strategy: full, selective, merge', 'selective')\r\n    .option('-b, --backup <dir>', 'Backup directory', '.claude-backup')\r\n    .option('-f, --force', 'Force migration without prompts')\r\n    .option('--dry-run', 'Simulate migration without making changes')\r\n    .option('--preserve-custom', 'Preserve custom commands and configurations')\r\n    .option('--skip-validation', 'Skip post-migration validation')\r\n    .option('--analyze-only', 'Only analyze project without migrating')\r\n    .option('--verbose', 'Show detailed output')\r\n    .action(async (options) => {\r\n      try {\r\n        const projectPath = path.resolve(options.path);\r\n\r\n        if (options.analyzeOnly) {\r\n          await analyzeProject(projectPath, options);\r\n        } else {\r\n          await runMigration(projectPath, options);\r\n        }\r\n      } catch (error) {\r\n        logger.error('Migration command failed:', error);\r\n        process.exit(1);\r\n      }\r\n    });\r\n\r\n  // Sub-commands\r\n  command\r\n    .command('analyze [path]')\r\n    .description('Analyze project for migration readiness')\r\n    .option('-d, --detailed', 'Show detailed analysis')\r\n    .option('-o, --output <file>', 'Output analysis to file')\r\n    .action(async (projectPath = '.', options) => {\r\n      await analyzeProject(path.resolve(projectPath), options);\r\n    });\r\n\r\n  command\r\n    .command('rollback [path]')\r\n    .description('Rollback to previous configuration')\r\n    .option('-b, --backup <dir>', 'Backup directory', '.claude-backup')\r\n    .option('-t, --timestamp <time>', 'Restore from specific timestamp')\r\n    .option('-f, --force', 'Force rollback without prompts')\r\n    .option('--list', 'List available backups')\r\n    .action(async (projectPath = '.', options) => {\r\n      const { RollbackManager } = await import('../../migration/rollback-manager.js');\r\n      const rollbackManager = new RollbackManager(path.resolve(projectPath), options.backup);\r\n\r\n      if (options.list) {\r\n        const backups = await rollbackManager.listBackups();\r\n        rollbackManager.printBackupSummary(backups);\r\n        return;\r\n      }\r\n\r\n      await rollbackManager.rollback(options.timestamp, !options.force);\r\n    });\r\n\r\n  command\r\n    .command('validate [path]')\r\n    .description('Validate migration was successful')\r\n    .option('-v, --verbose', 'Show detailed validation results')\r\n    .action(async (projectPath = '.', options) => {\r\n      const { MigrationRunner } = await import('../../migration/migration-runner.js');\r\n      const runner = new MigrationRunner({\r\n        projectPath: path.resolve(projectPath),\r\n        strategy: 'full',\r\n      });\r\n\r\n      const isValid = await runner.validate(options.verbose);\r\n      process.exit(isValid ? 0 : 1);\r\n    });\r\n\r\n  command\r\n    .command('status [path]')\r\n    .description('Show migration status and available backups')\r\n    .action(async (projectPath = '.') => {\r\n      await showMigrationStatus(path.resolve(projectPath));\r\n    });\r\n\r\n  return command;\r\n}\r\n\r\nasync function analyzeProject(projectPath: string, options: any): Promise<void> {\r\n  logger.info(`Analyzing project at ${projectPath}...`);\r\n\r\n  const { MigrationAnalyzer } = await import('../../migration/migration-analyzer.js');\r\n  const analyzer = new MigrationAnalyzer();\r\n  const analysis = await analyzer.analyze(projectPath);\r\n\r\n  if (options.output) {\r\n    await analyzer.saveAnalysis(analysis, options.output);\r\n    logger.success(`Analysis saved to ${options.output}`);\r\n  }\r\n\r\n  analyzer.printAnalysis(analysis, options.detailed || options.verbose);\r\n}\r\n\r\nasync function runMigration(projectPath: string, options: any): Promise<void> {\r\n  const { MigrationRunner } = await import('../../migration/migration-runner.js');\r\n  const runner = new MigrationRunner({\r\n    projectPath,\r\n    strategy: options.strategy as MigrationStrategy,\r\n    backupDir: options.backup,\r\n    force: options.force,\r\n    dryRun: options.dryRun,\r\n    preserveCustom: options.preserveCustom,\r\n    skipValidation: options.skipValidation,\r\n  });\r\n\r\n  const result = await runner.run();\r\n\r\n  if (!result.success) {\r\n    process.exit(1);\r\n  }\r\n}\r\n\r\nasync function showMigrationStatus(projectPath: string): Promise<void> {\r\n  console.log(chalk.bold('\\nðŸ“Š Migration Status'));\r\n  console.log(chalk.gray('â”€'.repeat(50)));\r\n\r\n  // Project analysis\r\n  const { MigrationAnalyzer } = await import('../../migration/migration-analyzer.js');\r\n  const analyzer = new MigrationAnalyzer();\r\n  const analysis = await analyzer.analyze(projectPath);\r\n\r\n  console.log(`\\n${chalk.bold('Project:')} ${projectPath}`);\r\n  console.log(\r\n    `${chalk.bold('Status:')} ${analysis.hasOptimizedPrompts ? chalk.green('Migrated') : chalk.yellow('Not Migrated')}`,\r\n  );\r\n  console.log(`${chalk.bold('Custom Commands:')} ${analysis.customCommands.length}`);\r\n  console.log(`${chalk.bold('Conflicts:')} ${analysis.conflictingFiles.length}`);\r\n\r\n  // Backup status\r\n  const { RollbackManager } = await import('../../migration/rollback-manager.js');\r\n  const rollbackManager = new RollbackManager(projectPath);\r\n  const backups = await rollbackManager.listBackups();\r\n\r\n  console.log(`\\n${chalk.bold('Backups Available:')} ${backups.length}`);\r\n\r\n  if (backups.length > 0) {\r\n    const latestBackup = backups[0];\r\n    console.log(`${chalk.bold('Latest Backup:')} ${latestBackup.timestamp.toLocaleString()}`);\r\n  }\r\n\r\n  // Recommendations\r\n  if (!analysis.hasOptimizedPrompts) {\r\n    console.log(chalk.bold('\\nðŸ’¡ Recommendations:'));\r\n    console.log('  â€¢ Run migration analysis: claude-flow migrate analyze');\r\n    console.log('  â€¢ Start with dry run: claude-flow migrate --dry-run');\r\n    console.log('  â€¢ Use selective strategy: claude-flow migrate --strategy selective');\r\n  }\r\n\r\n  console.log(chalk.gray('\\n' + 'â”€'.repeat(50)));\r\n}\r\n"],"names":["Command","logger","path","chalk","createMigrateCommand","command","description","option","action","options","projectPath","resolve","analyzeOnly","analyzeProject","runMigration","error","process","exit","RollbackManager","rollbackManager","backup","list","backups","listBackups","printBackupSummary","rollback","timestamp","force","MigrationRunner","runner","strategy","isValid","validate","verbose","showMigrationStatus","info","MigrationAnalyzer","analyzer","analysis","analyze","output","saveAnalysis","success","printAnalysis","detailed","backupDir","dryRun","preserveCustom","skipValidation","result","run","console","log","bold","gray","repeat","hasOptimizedPrompts","green","yellow","customCommands","length","conflictingFiles","latestBackup","toLocaleString"],"mappings":"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"}