{"version":3,"sources":["../../../../src/cli/simple-commands/training-pipeline.js"],"sourcesContent":["#!/usr/bin/env node\r\n/**\r\n * Training Pipeline with Real Task Execution\r\n * Executes actual code and learns from real test results\r\n */\r\n\r\nimport fs from 'fs/promises';\r\nimport path from 'path';\r\nimport { execSync, spawn } from 'child_process';\r\nimport { promisify } from 'util';\r\nimport { exec } from 'child_process';\r\n\r\nconst execAsync = promisify(exec);\r\n\r\n/**\r\n * Training Pipeline that executes real tasks and learns from actual results\r\n */\r\nexport class TrainingPipeline {\r\n  constructor() {\r\n    this.pipelineConfig = '.claude-flow/pipeline-config.json';\r\n    this.trainingLog = '.claude-flow/training/pipeline-log.jsonl';\r\n    this.improvementMetrics = '.claude-flow/metrics/improvements.json';\r\n    this.agentProfiles = '.claude-flow/agents/profiles.json';\r\n    this.realTasksDir = '.claude-flow/training/real-tasks';\r\n    this.initialized = false;\r\n  }\r\n\r\n  /**\r\n   * Initialize the training pipeline\r\n   */\r\n  async initialize() {\r\n    // Create necessary directories\r\n    const dirs = [\r\n      '.claude-flow/pipeline',\r\n      '.claude-flow/training',\r\n      '.claude-flow/training/real-tasks',\r\n      '.claude-flow/metrics',\r\n      '.claude-flow/agents',\r\n      '.claude-flow/validation',\r\n      '.claude-flow/benchmarks'\r\n    ];\r\n\r\n    for (const dir of dirs) {\r\n      await fs.mkdir(dir, { recursive: true });\r\n    }\r\n\r\n    // Load or create pipeline configuration\r\n    await this.loadPipelineConfig();\r\n    \r\n    console.log('üöÄ Training Pipeline initialized');\r\n    this.initialized = true;\r\n  }\r\n\r\n  /**\r\n   * STAGE 1: Generate Training Tasks\r\n   * Creates actual code files that can be tested\r\n   */\r\n  async generateTrainingTasks(complexity = 'medium') {\r\n    const taskId = Date.now();\r\n    const taskDir = path.join(this.realTasksDir, `task-${taskId}`);\r\n    await fs.mkdir(taskDir, { recursive: true });\r\n\r\n    const tasks = {\r\n      easy: [\r\n        {\r\n          type: 'function',\r\n          name: 'validateEmail',\r\n          task: 'Create email validation function',\r\n          code: `function validateEmail(email) {\r\n  const regex = /^[^\\\\s@]+@[^\\\\s@]+\\\\.[^\\\\s@]+$/;\r\n  return regex.test(email);\r\n}\r\n\r\nmodule.exports = { validateEmail };`,\r\n          test: `\r\nconst { validateEmail } = require('./index');\r\n\r\ndescribe('validateEmail', () => {\r\n  test('validates correct email', () => {\r\n    expect(validateEmail('test@example.com')).toBe(true);\r\n  });\r\n  \r\n  test('rejects invalid email', () => {\r\n    expect(validateEmail('invalid')).toBe(false);\r\n  });\r\n});\r\n`\r\n        }\r\n      ],\r\n      medium: [\r\n        {\r\n          type: 'api',\r\n          name: 'userApi',\r\n          task: 'Build user API endpoint',\r\n          code: `\r\nconst express = require('express');\r\nconst app = express();\r\n\r\napp.use(express.json());\r\n\r\nconst users = [];\r\n\r\napp.get('/users', (req, res) => {\r\n  res.json(users);\r\n});\r\n\r\napp.post('/users', (req, res) => {\r\n  const { name, email } = req.body;\r\n  if (!name || !email) {\r\n    return res.status(400).json({ error: 'Name and email required' });\r\n  }\r\n  const user = { id: users.length + 1, name, email };\r\n  users.push(user);\r\n  res.status(201).json(user);\r\n});\r\n\r\nmodule.exports = app;\r\n`,\r\n          test: `\r\nconst request = require('supertest');\r\nconst app = require('./index');\r\n\r\ndescribe('User API', () => {\r\n  test('GET /users returns empty array initially', async () => {\r\n    const res = await request(app).get('/users');\r\n    expect(res.status).toBe(200);\r\n    expect(res.body).toEqual([]);\r\n  });\r\n  \r\n  test('POST /users creates a user', async () => {\r\n    const res = await request(app)\r\n      .post('/users')\r\n      .send({ name: 'Test', email: 'test@test.com' });\r\n    expect(res.status).toBe(201);\r\n    expect(res.body.name).toBe('Test');\r\n  });\r\n});\r\n`\r\n        }\r\n      ],\r\n      hard: [\r\n        {\r\n          type: 'algorithm',\r\n          name: 'sortAlgorithm',\r\n          task: 'Implement efficient sorting',\r\n          code: `\r\nfunction quickSort(arr) {\r\n  if (arr.length <= 1) return arr;\r\n  \r\n  const pivot = arr[Math.floor(arr.length / 2)];\r\n  const left = arr.filter(x => x < pivot);\r\n  const middle = arr.filter(x => x === pivot);\r\n  const right = arr.filter(x => x > pivot);\r\n  \r\n  return [...quickSort(left), ...middle, ...quickSort(right)];\r\n}\r\n\r\nfunction mergeSort(arr) {\r\n  if (arr.length <= 1) return arr;\r\n  \r\n  const mid = Math.floor(arr.length / 2);\r\n  const left = mergeSort(arr.slice(0, mid));\r\n  const right = mergeSort(arr.slice(mid));\r\n  \r\n  const result = [];\r\n  let i = 0, j = 0;\r\n  \r\n  while (i < left.length && j < right.length) {\r\n    if (left[i] < right[j]) {\r\n      result.push(left[i++]);\r\n    } else {\r\n      result.push(right[j++]);\r\n    }\r\n  }\r\n  \r\n  return result.concat(left.slice(i)).concat(right.slice(j));\r\n}\r\n\r\nmodule.exports = { quickSort, mergeSort };\r\n`,\r\n          test: `\r\nconst { quickSort, mergeSort } = require('./index');\r\n\r\ndescribe('Sorting Algorithms', () => {\r\n  const unsorted = [3, 1, 4, 1, 5, 9, 2, 6];\r\n  const sorted = [1, 1, 2, 3, 4, 5, 6, 9];\r\n  \r\n  test('quickSort sorts correctly', () => {\r\n    expect(quickSort(unsorted)).toEqual(sorted);\r\n  });\r\n  \r\n  test('mergeSort sorts correctly', () => {\r\n    expect(mergeSort(unsorted)).toEqual(sorted);\r\n  });\r\n  \r\n  test('handles empty arrays', () => {\r\n    expect(quickSort([])).toEqual([]);\r\n    expect(mergeSort([])).toEqual([]);\r\n  });\r\n});\r\n`\r\n        }\r\n      ]\r\n    };\r\n\r\n    const selectedTasks = tasks[complexity] || tasks.medium;\r\n    const realTasks = [];\r\n\r\n    // Create real task files\r\n    for (const task of selectedTasks) {\r\n      const projectDir = path.join(taskDir, task.name);\r\n      await fs.mkdir(projectDir, { recursive: true });\r\n      \r\n      // Write actual code file\r\n      await fs.writeFile(path.join(projectDir, 'index.js'), task.code);\r\n      \r\n      // Write test file\r\n      await fs.writeFile(path.join(projectDir, 'index.test.js'), task.test);\r\n      \r\n      // Create package.json with real dependencies\r\n      const packageJson = {\r\n        name: task.name,\r\n        version: \"1.0.0\",\r\n        scripts: {\r\n          test: \"jest --silent\",\r\n          lint: \"eslint index.js || true\",\r\n          typecheck: \"echo 'No TypeScript' || true\"\r\n        },\r\n        devDependencies: {\r\n          jest: \"^29.0.0\",\r\n          eslint: \"^8.0.0\",\r\n          supertest: \"^6.0.0\"\r\n        },\r\n        dependencies: {\r\n          express: task.type === 'api' ? \"^4.18.0\" : undefined\r\n        }\r\n      };\r\n      \r\n      await fs.writeFile(\r\n        path.join(projectDir, 'package.json'), \r\n        JSON.stringify(packageJson, null, 2)\r\n      );\r\n\r\n      realTasks.push({\r\n        ...task,\r\n        projectDir,\r\n        taskId\r\n      });\r\n    }\r\n\r\n    console.log(`üìù Generated ${realTasks.length} ${complexity} training tasks`);\r\n    return realTasks;\r\n  }\r\n\r\n  /**\r\n   * STAGE 2: Execute Tasks with Different Strategies\r\n   * Actually runs npm install, tests, and measures real performance\r\n   */\r\n  async executeTrainingRun(tasks, agentConfig = {}) {\r\n    const results = [];\r\n    \r\n    for (const task of tasks) {\r\n      console.log(`\\nüîÑ Executing task: ${task.task}`);\r\n      \r\n      // Install dependencies (only once per task)\r\n      try {\r\n        console.log(`   üì¶ Installing dependencies...`);\r\n        execSync('npm install --silent', { \r\n          cwd: task.projectDir,\r\n          stdio: 'pipe'\r\n        });\r\n      } catch (e) {\r\n        console.log(`   ‚ö†Ô∏è Install warning: ${e.message.slice(0, 50)}`);\r\n      }\r\n\r\n      // Test different strategies with REAL variations\r\n      const strategies = agentConfig.strategies || ['conservative', 'balanced', 'aggressive'];\r\n      \r\n      for (const strategy of strategies) {\r\n        const result = await this.executeTaskWithStrategy(task, strategy);\r\n        results.push({\r\n          task: task.task,\r\n          type: task.type,\r\n          strategy,\r\n          ...result,\r\n          timestamp: new Date().toISOString()\r\n        });\r\n      }\r\n    }\r\n\r\n    // Save real results\r\n    const resultsFile = `.claude-flow/training/real-results-${Date.now()}.json`;\r\n    await fs.writeFile(resultsFile, JSON.stringify(results, null, 2));\r\n\r\n    return results;\r\n  }\r\n\r\n  /**\r\n   * Execute a task with a specific strategy\r\n   * Strategies affect how we modify and test the code\r\n   */\r\n  async executeTaskWithStrategy(task, strategy) {\r\n    const startTime = Date.now();\r\n    const checks = {};\r\n    \r\n    // Save original code\r\n    const originalCode = await fs.readFile(path.join(task.projectDir, 'index.js'), 'utf8');\r\n    \r\n    // Modify code based on strategy (but more carefully!)\r\n    if (strategy === 'aggressive') {\r\n      // Aggressive: Skip some validation (but keep valid syntax)\r\n      const aggressiveCode = originalCode.replace(\r\n        /if \\(!(\\w+)\\)/g, \r\n        'if (false && !$1)'\r\n      );\r\n      await fs.writeFile(path.join(task.projectDir, 'index.js'), aggressiveCode);\r\n    } else if (strategy === 'conservative') {\r\n      // Conservative: Add validation at the top of functions\r\n      const conservativeCode = originalCode.replace(\r\n        /function (\\w+)\\((.*?)\\) {/g,\r\n        'function $1($2) {\\n  // Extra validation for conservative strategy\\n  if (arguments.length === 0) throw new Error(\"No arguments provided\");'\r\n      );\r\n      await fs.writeFile(path.join(task.projectDir, 'index.js'), conservativeCode);\r\n    }\r\n    // Balanced: Keep original code\r\n\r\n    // Run REAL tests\r\n    try {\r\n      const testResult = execSync('npm test', { \r\n        cwd: task.projectDir,\r\n        encoding: 'utf8',\r\n        stdio: 'pipe'\r\n      });\r\n      checks.test = { \r\n        passed: true, \r\n        score: 1.0,\r\n        output: testResult.slice(0, 100)\r\n      };\r\n    } catch (e) {\r\n      checks.test = { \r\n        passed: false, \r\n        score: 0.3,\r\n        error: e.message.slice(0, 100)\r\n      };\r\n    }\r\n\r\n    // Run REAL lint\r\n    try {\r\n      const lintResult = execSync('npm run lint', { \r\n        cwd: task.projectDir,\r\n        encoding: 'utf8',\r\n        stdio: 'pipe'\r\n      });\r\n      const hasErrors = lintResult.includes('error');\r\n      checks.lint = { \r\n        passed: !hasErrors, \r\n        score: hasErrors ? 0.5 : 1.0\r\n      };\r\n    } catch (e) {\r\n      checks.lint = { \r\n        passed: false, \r\n        score: 0.3\r\n      };\r\n    }\r\n\r\n    // Restore original code after testing\r\n    await fs.writeFile(path.join(task.projectDir, 'index.js'), originalCode);\r\n    \r\n    // Calculate REAL performance metrics\r\n    const executionTime = Date.now() - startTime;\r\n    const successRate = Object.values(checks).filter(c => c.passed).length / Object.values(checks).length;\r\n    \r\n    // Strategy-specific scoring based on REAL results\r\n    let strategyBonus = 0;\r\n    if (strategy === 'aggressive' && executionTime < 1000) {\r\n      strategyBonus = 0.2; // Bonus for fast execution\r\n    } else if (strategy === 'conservative' && successRate === 1.0) {\r\n      strategyBonus = 0.3; // Bonus for perfect reliability\r\n    } else if (strategy === 'balanced' && successRate > 0.5 && executionTime < 2000) {\r\n      strategyBonus = 0.25; // Bonus for good balance\r\n    }\r\n    \r\n    const score = (successRate * 60) + (Math.max(0, 1 - executionTime/5000) * 20) + (strategyBonus * 20);\r\n    \r\n    return {\r\n      executionTime,\r\n      successRate,\r\n      checks,\r\n      strategy,\r\n      score,\r\n      real: true // Mark as real execution\r\n    };\r\n  }\r\n\r\n  /**\r\n   * STAGE 3: Learn from Results\r\n   * Updates profiles based on actual performance\r\n   */\r\n  async learnFromResults(results) {\r\n    console.log('\\nüß† Learning from results...');\r\n    \r\n    // Load current agent profiles\r\n    let profiles = {};\r\n    try {\r\n      const data = await fs.readFile(this.agentProfiles, 'utf8');\r\n      profiles = JSON.parse(data);\r\n    } catch {\r\n      profiles = this.getDefaultProfiles();\r\n    }\r\n\r\n    // Analyze REAL results by strategy\r\n    const strategyPerformance = {};\r\n    for (const result of results) {\r\n      if (!strategyPerformance[result.strategy]) {\r\n        strategyPerformance[result.strategy] = {\r\n          totalScore: 0,\r\n          count: 0,\r\n          avgExecutionTime: 0,\r\n          successRate: 0,\r\n          realExecutions: 0\r\n        };\r\n      }\r\n      \r\n      const perf = strategyPerformance[result.strategy];\r\n      perf.totalScore += result.score;\r\n      perf.count++;\r\n      perf.avgExecutionTime += result.executionTime;\r\n      perf.successRate += result.successRate;\r\n      if (result.real) perf.realExecutions++;\r\n    }\r\n\r\n    // Calculate averages and update profiles with REAL data\r\n    for (const [strategy, perf] of Object.entries(strategyPerformance)) {\r\n      perf.avgScore = perf.totalScore / perf.count;\r\n      perf.avgExecutionTime = perf.avgExecutionTime / perf.count;\r\n      perf.successRate = perf.successRate / perf.count;\r\n\r\n      // Update with stronger learning for real executions\r\n      const learningRate = perf.realExecutions > 0 ? 0.4 : 0.1;\r\n      this.updateAgentProfile(profiles, strategy, perf, learningRate);\r\n    }\r\n\r\n    // Save updated profiles\r\n    await fs.writeFile(this.agentProfiles, JSON.stringify(profiles, null, 2));\r\n\r\n    // Generate recommendations based on performance\r\n    const recommendations = this.generateRecommendations(strategyPerformance);\r\n    \r\n    console.log('\\nüìä Learning Results:');\r\n    for (const [strategy, perf] of Object.entries(strategyPerformance)) {\r\n      console.log(`   ${strategy}: Score ${perf.avgScore.toFixed(2)}, Success ${(perf.successRate * 100).toFixed(1)}%, Time ${perf.avgExecutionTime.toFixed(0)}ms`);\r\n    }\r\n\r\n    return { profiles, recommendations };\r\n  }\r\n\r\n  updateAgentProfile(profiles, strategy, performance, learningRate = 0.3) {\r\n    if (!profiles[strategy]) {\r\n      profiles[strategy] = {\r\n        successRate: 0.5,\r\n        avgScore: 50,\r\n        avgExecutionTime: 2000,\r\n        uses: 0,\r\n        realExecutions: 0\r\n      };\r\n    }\r\n\r\n    const profile = profiles[strategy];\r\n    \r\n    // Update with exponential moving average\r\n    profile.successRate = profile.successRate * (1 - learningRate) + performance.successRate * learningRate;\r\n    profile.avgScore = profile.avgScore * (1 - learningRate) + performance.avgScore * learningRate;\r\n    profile.avgExecutionTime = profile.avgExecutionTime * (1 - learningRate) + performance.avgExecutionTime * learningRate;\r\n    profile.uses++;\r\n    if (performance.realExecutions) {\r\n      profile.realExecutions = (profile.realExecutions || 0) + performance.realExecutions;\r\n    }\r\n\r\n    // Add performance trend\r\n    if (!profile.trend) profile.trend = [];\r\n    profile.trend.push({\r\n      score: performance.avgScore,\r\n      timestamp: new Date().toISOString(),\r\n      real: performance.realExecutions > 0\r\n    });\r\n    if (profile.trend.length > 20) {\r\n      profile.trend = profile.trend.slice(-20);\r\n    }\r\n\r\n    // Mark improvement\r\n    if (profile.trend.length > 1) {\r\n      const recent = profile.trend.slice(-5).reduce((sum, t) => sum + t.score, 0) / Math.min(5, profile.trend.length);\r\n      const older = profile.trend.slice(0, -5).reduce((sum, t) => sum + t.score, 0) / Math.max(1, profile.trend.length - 5);\r\n      profile.improving = recent > older;\r\n      profile.improvementRate = ((recent - older) / older * 100).toFixed(1);\r\n    }\r\n  }\r\n\r\n  generateRecommendations(strategyPerformance) {\r\n    const recommendations = [];\r\n\r\n    for (const [strategy, perf] of Object.entries(strategyPerformance)) {\r\n      if (perf.successRate < 0.7) {\r\n        recommendations.push({\r\n          type: 'improve_reliability',\r\n          strategy,\r\n          action: `${strategy} needs better error handling (${(perf.successRate * 100).toFixed(1)}% success)`,\r\n          priority: 'high'\r\n        });\r\n      }\r\n\r\n      if (perf.avgExecutionTime > 3000) {\r\n        recommendations.push({\r\n          type: 'optimize_speed',\r\n          strategy,\r\n          action: `${strategy} is too slow (${perf.avgExecutionTime.toFixed(0)}ms avg)`,\r\n          priority: 'medium'\r\n        });\r\n      }\r\n\r\n      if (perf.avgScore > 75) {\r\n        recommendations.push({\r\n          type: 'good_performance',\r\n          strategy,\r\n          action: `${strategy} performing well (${perf.avgScore.toFixed(1)} score)`,\r\n          priority: 'info'\r\n        });\r\n      }\r\n    }\r\n\r\n    return recommendations;\r\n  }\r\n\r\n  /**\r\n   * Full Training Pipeline Execution\r\n   */\r\n  async runFullPipeline(options = {}) {\r\n    const {\r\n      complexity = 'medium',\r\n      iterations = 3,\r\n      validate = true\r\n    } = options;\r\n\r\n    console.log('üéØ Starting Training Pipeline');\r\n    console.log('‚îÅ'.repeat(50));\r\n\r\n    await this.initialize();\r\n\r\n    // Capture baseline metrics\r\n    const baselineMetrics = await this.captureMetrics();\r\n    \r\n    let cumulativeResults = [];\r\n    \r\n    for (let i = 1; i <= iterations; i++) {\r\n      console.log(`\\nüìç Iteration ${i}/${iterations}`);\r\n      console.log('‚îÄ'.repeat(40));\r\n\r\n      // Stage 1: Generate tasks\r\n      const tasks = await this.generateTrainingTasks(complexity);\r\n\r\n      // Stage 2: Execute with real code\r\n      const results = await this.executeTrainingRun(tasks);\r\n      cumulativeResults = [...cumulativeResults, ...results];\r\n\r\n      // Stage 3: Learn from results\r\n      const { profiles, recommendations } = await this.learnFromResults(results);\r\n\r\n      // Show recommendations\r\n      if (recommendations.length > 0) {\r\n        console.log('\\nüí° Recommendations:');\r\n        for (const rec of recommendations.slice(0, 3)) {\r\n          console.log(`   ‚Ä¢ ${rec.action}`);\r\n        }\r\n      }\r\n\r\n      // Stage 4: Validate if enabled\r\n      if (validate && i === iterations) {\r\n        const currentMetrics = await this.captureMetrics();\r\n        const validation = await this.validateImprovements(baselineMetrics, currentMetrics);\r\n        \r\n        if (validation.summary.overallImprovement) {\r\n          console.log('‚úÖ Improvement detected!');\r\n        } else {\r\n          console.log('‚ö†Ô∏è  More training needed for significant improvement');\r\n        }\r\n      }\r\n    }\r\n\r\n    // Generate final report\r\n    const report = await this.generateFinalReport(cumulativeResults);\r\n    console.log('\\n' + report);\r\n\r\n    return {\r\n      success: true,\r\n      totalTasks: cumulativeResults.length,\r\n      realExecutions: cumulativeResults.filter(r => r.real).length,\r\n      improvements: await this.calculateOverallImprovement(baselineMetrics)\r\n    };\r\n  }\r\n\r\n  // Reuse helper methods from original\r\n  async captureMetrics() {\r\n    try {\r\n      const data = await fs.readFile(this.agentProfiles, 'utf8');\r\n      const profiles = JSON.parse(data);\r\n      \r\n      // Calculate weighted average from all strategies\r\n      let totalScore = 0;\r\n      let totalSuccess = 0;\r\n      let totalTime = 0;\r\n      let count = 0;\r\n      \r\n      for (const profile of Object.values(profiles)) {\r\n        if (profile.uses > 0) {\r\n          totalScore += profile.avgScore;\r\n          totalSuccess += profile.successRate;\r\n          totalTime += profile.avgExecutionTime;\r\n          count++;\r\n        }\r\n      }\r\n      \r\n      return {\r\n        successRate: count > 0 ? totalSuccess / count : 0,\r\n        executionTime: count > 0 ? totalTime / count : 0,\r\n        score: count > 0 ? totalScore / count : 0\r\n      };\r\n    } catch {\r\n      return {\r\n        successRate: 0,\r\n        executionTime: 0,\r\n        score: 0\r\n      };\r\n    }\r\n  }\r\n\r\n  async validateImprovements(beforeMetrics, afterMetrics) {\r\n    const validation = {\r\n      improved: [],\r\n      declined: [],\r\n      unchanged: [],\r\n      summary: {}\r\n    };\r\n\r\n    const metrics = ['successRate', 'executionTime', 'score'];\r\n    \r\n    for (const metric of metrics) {\r\n      const before = beforeMetrics[metric] || 0.01; // Avoid division by zero\r\n      const after = afterMetrics[metric] || 0;\r\n      const change = after - before;\r\n      const percentChange = (change / before) * 100;\r\n\r\n      if (percentChange > 5) {\r\n        validation.improved.push({ metric, change: percentChange });\r\n      } else if (percentChange < -5) {\r\n        validation.declined.push({ metric, change: percentChange });\r\n      } else {\r\n        validation.unchanged.push({ metric, change: percentChange });\r\n      }\r\n    }\r\n\r\n    validation.summary = {\r\n      overallImprovement: validation.improved.length > validation.declined.length,\r\n      improvementScore: validation.improved.length - validation.declined.length,\r\n      timestamp: new Date().toISOString()\r\n    };\r\n\r\n    console.log(`\\n‚úÖ Validating improvements...`);\r\n    console.log(`   Improved: ${validation.improved.length} metrics`);\r\n    console.log(`   Declined: ${validation.declined.length} metrics`);\r\n    console.log(`   Unchanged: ${validation.unchanged.length} metrics`);\r\n\r\n    return validation;\r\n  }\r\n\r\n  async calculateOverallImprovement(baselineMetrics) {\r\n    const currentMetrics = await this.captureMetrics();\r\n    \r\n    const base = {\r\n      successRate: baselineMetrics.successRate || 0.01,\r\n      executionTime: baselineMetrics.executionTime || 1,\r\n      score: baselineMetrics.score || 0.01\r\n    };\r\n    \r\n    return {\r\n      successRate: ((currentMetrics.successRate - base.successRate) / base.successRate) * 100,\r\n      executionTime: ((base.executionTime - currentMetrics.executionTime) / base.executionTime) * 100,\r\n      score: ((currentMetrics.score - base.score) / base.score) * 100\r\n    };\r\n  }\r\n\r\n  async generateFinalReport(results) {\r\n    const realResults = results.filter(r => r.real);\r\n    const successRates = {};\r\n    const scores = {};\r\n    const times = {};\r\n    \r\n    for (const result of realResults) {\r\n      if (!successRates[result.strategy]) {\r\n        successRates[result.strategy] = [];\r\n        scores[result.strategy] = [];\r\n        times[result.strategy] = [];\r\n      }\r\n      successRates[result.strategy].push(result.successRate);\r\n      scores[result.strategy].push(result.score);\r\n      times[result.strategy].push(result.executionTime);\r\n    }\r\n\r\n    let report = 'üìä Training Pipeline Report\\n';\r\n    report += '‚îÅ'.repeat(50) + '\\n\\n';\r\n    \r\n    for (const strategy of Object.keys(successRates)) {\r\n      const avgSuccess = successRates[strategy].reduce((a, b) => a + b, 0) / successRates[strategy].length;\r\n      const avgScore = scores[strategy].reduce((a, b) => a + b, 0) / scores[strategy].length;\r\n      const avgTime = times[strategy].reduce((a, b) => a + b, 0) / times[strategy].length;\r\n      \r\n      report += `Strategy: ${strategy}\\n`;\r\n      report += `  Average Success Rate: ${(avgSuccess * 100).toFixed(1)}%\\n`;\r\n      report += `  Average Score: ${avgScore.toFixed(2)}\\n`;\r\n      report += `  Average Time: ${avgTime.toFixed(0)}ms\\n`;\r\n      report += `  Real Executions: ${successRates[strategy].length}\\n`;\r\n      report += '\\n';\r\n    }\r\n\r\n    return report;\r\n  }\r\n\r\n  getDefaultProfiles() {\r\n    return {\r\n      conservative: {\r\n        successRate: 0.5,\r\n        avgScore: 50,\r\n        avgExecutionTime: 3000,\r\n        uses: 0,\r\n        realExecutions: 0\r\n      },\r\n      balanced: {\r\n        successRate: 0.5,\r\n        avgScore: 50,\r\n        avgExecutionTime: 2000,\r\n        uses: 0,\r\n        realExecutions: 0\r\n      },\r\n      aggressive: {\r\n        successRate: 0.5,\r\n        avgScore: 50,\r\n        avgExecutionTime: 1000,\r\n        uses: 0,\r\n        realExecutions: 0\r\n      }\r\n    };\r\n  }\r\n\r\n  async loadPipelineConfig() {\r\n    try {\r\n      const data = await fs.readFile(this.pipelineConfig, 'utf8');\r\n      return JSON.parse(data);\r\n    } catch {\r\n      const defaultConfig = {\r\n        version: '2.0.0',\r\n        strategies: ['conservative', 'balanced', 'aggressive'],\r\n        learningRate: 0.4,\r\n        minSamplesForUpdate: 3,\r\n        useRealExecution: true,\r\n        created: new Date().toISOString()\r\n      };\r\n      \r\n      await fs.writeFile(this.pipelineConfig, JSON.stringify(defaultConfig, null, 2));\r\n      return defaultConfig;\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * CLI Command Handler\r\n */\r\nexport async function trainingPipelineCommand(args, flags) {\r\n  const pipeline = new TrainingPipeline();\r\n  const subcommand = args[0] || 'run';\r\n\r\n  switch (subcommand) {\r\n    case 'run':\r\n      // Run real pipeline\r\n      const options = {\r\n        complexity: flags.complexity || 'medium',\r\n        iterations: parseInt(flags.iterations) || 3,\r\n        validate: flags.validate !== false\r\n      };\r\n      \r\n      console.log('üöÄ Starting Training Pipeline');\r\n      console.log(`   Complexity: ${options.complexity}`);\r\n      console.log(`   Iterations: ${options.iterations}`);\r\n      console.log(`   Validation: ${options.validate ? 'Enabled' : 'Disabled'}`);\r\n      \r\n      const result = await pipeline.runFullPipeline(options);\r\n      \r\n      if (result.success) {\r\n        console.log('\\n‚úÖ Training Pipeline completed');\r\n        console.log(`   Total tasks: ${result.totalTasks}`);\r\n        console.log(`   Real executions: ${result.realExecutions}`);\r\n        \r\n        if (result.improvements) {\r\n          console.log('\\nüìà Improvements:');\r\n          console.log(`   Success Rate: ${result.improvements.successRate > 0 ? '+' : ''}${result.improvements.successRate.toFixed(1)}%`);\r\n          console.log(`   Execution Time: ${result.improvements.executionTime > 0 ? '+' : ''}${result.improvements.executionTime.toFixed(1)}%`);\r\n          console.log(`   Score: ${result.improvements.score > 0 ? '+' : ''}${result.improvements.score.toFixed(1)}%`);\r\n        }\r\n      }\r\n      break;\r\n\r\n    case 'status':\r\n      // Show real pipeline status\r\n      await pipeline.initialize();\r\n      \r\n      let profiles = {};\r\n      try {\r\n        const data = await fs.readFile(pipeline.agentProfiles, 'utf8');\r\n        profiles = JSON.parse(data);\r\n      } catch {\r\n        profiles = pipeline.getDefaultProfiles();\r\n      }\r\n\r\n      console.log('\\nüìä Training Pipeline Status');\r\n      console.log('‚îÅ'.repeat(50));\r\n      \r\n      console.log('\\nü§ñ Strategy Profiles:');\r\n      for (const [strategy, profile] of Object.entries(profiles)) {\r\n        console.log(`   ${strategy}:`);\r\n        console.log(`     Success Rate: ${(profile.successRate * 100).toFixed(1)}%`);\r\n        console.log(`     Average Score: ${profile.avgScore.toFixed(2)}`);\r\n        console.log(`     Execution Time: ${profile.avgExecutionTime.toFixed(0)}ms`);\r\n        console.log(`     Total Uses: ${profile.uses}`);\r\n        console.log(`     Real Executions: ${profile.realExecutions || 0}`);\r\n        if (profile.improving !== undefined) {\r\n          console.log(`     Trend: ${profile.improving ? 'üìà Improving' : 'üìâ Declining'} (${profile.improvementRate}%)`);\r\n        }\r\n      }\r\n      break;\r\n\r\n    case 'validate':\r\n      // Validate current performance\r\n      await pipeline.initialize();\r\n      const metrics = await pipeline.captureMetrics();\r\n      console.log('\\nüìä Current Performance:');\r\n      console.log(`   Success Rate: ${(metrics.successRate * 100).toFixed(1)}%`);\r\n      console.log(`   Avg Execution Time: ${metrics.executionTime.toFixed(0)}ms`);\r\n      console.log(`   Average Score: ${metrics.score.toFixed(2)}`);\r\n      break;\r\n\r\n    default:\r\n      console.log('Usage: train-pipeline <command> [options]');\r\n      console.log('\\nCommands:');\r\n      console.log('  run       - Run training pipeline with real code');\r\n      console.log('  status    - Show pipeline status');\r\n      console.log('  validate  - Check current performance');\r\n      console.log('\\nOptions:');\r\n      console.log('  --complexity <level>  - easy/medium/hard');\r\n      console.log('  --iterations <n>      - Training cycles');\r\n  }\r\n}\r\n\r\nexport default TrainingPipeline;"],"names":["fs","path","execSync","promisify","exec","execAsync","TrainingPipeline","pipelineConfig","trainingLog","improvementMetrics","agentProfiles","realTasksDir","initialized","initialize","dirs","dir","mkdir","recursive","loadPipelineConfig","console","log","generateTrainingTasks","complexity","taskId","Date","now","taskDir","join","tasks","easy","type","name","task","code","test","medium","hard","selectedTasks","realTasks","projectDir","writeFile","packageJson","version","scripts","lint","typecheck","devDependencies","jest","eslint","supertest","dependencies","express","undefined","JSON","stringify","push","length","executeTrainingRun","agentConfig","results","cwd","stdio","e","message","slice","strategies","strategy","result","executeTaskWithStrategy","timestamp","toISOString","resultsFile","startTime","checks","originalCode","readFile","aggressiveCode","replace","conservativeCode","testResult","encoding","passed","score","output","error","lintResult","hasErrors","includes","executionTime","successRate","Object","values","filter","c","strategyBonus","Math","max","real","learnFromResults","profiles","data","parse","getDefaultProfiles","strategyPerformance","totalScore","count","avgExecutionTime","realExecutions","perf","entries","avgScore","learningRate","updateAgentProfile","recommendations","generateRecommendations","toFixed","performance","uses","profile","trend","recent","reduce","sum","t","min","older","improving","improvementRate","action","priority","runFullPipeline","options","iterations","validate","repeat","baselineMetrics","captureMetrics","cumulativeResults","i","rec","currentMetrics","validation","validateImprovements","summary","overallImprovement","report","generateFinalReport","success","totalTasks","r","improvements","calculateOverallImprovement","totalSuccess","totalTime","beforeMetrics","afterMetrics","improved","declined","unchanged","metrics","metric","before","after","change","percentChange","improvementScore","base","realResults","successRates","scores","times","keys","avgSuccess","a","b","avgTime","conservative","balanced","aggressive","defaultConfig","minSamplesForUpdate","useRealExecution","created","trainingPipelineCommand","args","flags","pipeline","subcommand","parseInt"],"mappings":"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"}