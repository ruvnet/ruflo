{"version":3,"sources":["../../../../src/cli/commands/verification.ts"],"sourcesContent":["/**\r\n * Verification Commands for Claude Flow CLI\r\n * \r\n * Provides CLI commands for verification system management and execution.\r\n * Integrates with the existing claude-flow command structure.\r\n */\r\n\r\nimport { Logger } from '../../core/logger.js';\r\nimport { \r\n  verificationHookManager,\r\n  VerificationCLICommands,\r\n  createVerificationCommand,\r\n  executeVerificationFromCLI\r\n} from '../../verification/index.js';\r\n\r\nconst logger = new Logger({\r\n  level: 'info',\r\n  format: 'text',\r\n  destination: 'console'\r\n}, { prefix: 'VerificationCLI' });\r\n\r\n/**\r\n * Main verification command that provides subcommands\r\n */\r\nexport async function verificationCommand(args: any): Promise<any> {\r\n  const { subcommand = 'status', ...subArgs } = args;\r\n  \r\n  try {\r\n    logger.debug(`Executing verification subcommand: ${subcommand}`);\r\n    \r\n    switch (subcommand) {\r\n      case 'status':\r\n        return await executeStatusCommand(subArgs);\r\n        \r\n      case 'check':\r\n        return await executeCheckCommand(subArgs);\r\n        \r\n      case 'config':\r\n        return await executeConfigCommand(subArgs);\r\n        \r\n      case 'validate':\r\n        return await executeValidateCommand(subArgs);\r\n        \r\n      case 'cleanup':\r\n        return await executeCleanupCommand(subArgs);\r\n        \r\n      case 'pre-task':\r\n        return await executePreTaskCommand(subArgs);\r\n        \r\n      case 'post-task':\r\n        return await executePostTaskCommand(subArgs);\r\n        \r\n      case 'integration':\r\n        return await executeIntegrationCommand(subArgs);\r\n        \r\n      case 'truth':\r\n        return await executeTruthCommand(subArgs);\r\n        \r\n      case 'rollback':\r\n        return await executeRollbackCommand(subArgs);\r\n        \r\n      case 'help':\r\n        return showVerificationHelp();\r\n        \r\n      default:\r\n        throw new Error(`Unknown verification subcommand: ${subcommand}`);\r\n    }\r\n  } catch (error) {\r\n    logger.error(`Verification command failed:`, error);\r\n    throw error;\r\n  }\r\n}\r\n\r\n/**\r\n * Execute status command\r\n */\r\nasync function executeStatusCommand(args: any): Promise<any> {\r\n  const command = VerificationCLICommands.status();\r\n  return await command.execute(args);\r\n}\r\n\r\n/**\r\n * Execute check command\r\n */\r\nasync function executeCheckCommand(args: any): Promise<any> {\r\n  const command = VerificationCLICommands.check();\r\n  return await command.execute(args);\r\n}\r\n\r\n/**\r\n * Execute config command\r\n */\r\nasync function executeConfigCommand(args: any): Promise<any> {\r\n  const command = VerificationCLICommands.config();\r\n  return await command.execute(args);\r\n}\r\n\r\n/**\r\n * Execute validate command\r\n */\r\nasync function executeValidateCommand(args: any): Promise<any> {\r\n  const command = VerificationCLICommands.validate();\r\n  return await command.execute(args);\r\n}\r\n\r\n/**\r\n * Execute cleanup command\r\n */\r\nasync function executeCleanupCommand(args: any): Promise<any> {\r\n  const command = VerificationCLICommands.cleanup();\r\n  return await command.execute(args);\r\n}\r\n\r\n/**\r\n * Execute pre-task verification\r\n */\r\nasync function executePreTaskCommand(args: any): Promise<any> {\r\n  return await executeVerificationFromCLI('pre-task', args);\r\n}\r\n\r\n/**\r\n * Execute post-task verification\r\n */\r\nasync function executePostTaskCommand(args: any): Promise<any> {\r\n  return await executeVerificationFromCLI('post-task', args);\r\n}\r\n\r\n/**\r\n * Execute integration tests\r\n */\r\nasync function executeIntegrationCommand(args: any): Promise<any> {\r\n  return await executeVerificationFromCLI('integration', args);\r\n}\r\n\r\n/**\r\n * Execute truth telemetry\r\n */\r\nasync function executeTruthCommand(args: any): Promise<any> {\r\n  return await executeVerificationFromCLI('truth', args);\r\n}\r\n\r\n/**\r\n * Execute rollback\r\n */\r\nasync function executeRollbackCommand(args: any): Promise<any> {\r\n  return await executeVerificationFromCLI('rollback', args);\r\n}\r\n\r\n/**\r\n * Show verification help\r\n */\r\nfunction showVerificationHelp(): any {\r\n  const help = `\r\nüîç Claude Flow Verification System\r\n\r\nUSAGE:\r\n  npx claude-flow verification <subcommand> [options]\r\n\r\nSUBCOMMANDS:\r\n  status      Show verification system status and metrics\r\n  check       Run verification checks for a specific task\r\n  config      View or update verification configuration\r\n  validate    Run post-task validation for a completed task\r\n  cleanup     Cleanup old verification contexts and snapshots\r\n  pre-task    Run pre-task verification hooks\r\n  post-task   Run post-task verification hooks\r\n  integration Run integration test hooks\r\n  truth       Run truth telemetry hooks\r\n  rollback    Execute rollback procedures\r\n  help        Show this help message\r\n\r\nEXAMPLES:\r\n  npx claude-flow verification status\r\n  npx claude-flow verification check --taskId task-123\r\n  npx claude-flow verification config --action set --key preTask.enabled --value true\r\n  npx claude-flow verification validate --taskId task-123\r\n  npx claude-flow verification cleanup --force --maxAge 86400000\r\n  npx claude-flow verification pre-task --taskId task-123 --sessionId session-456\r\n  npx claude-flow verification post-task --taskId task-123\r\n  npx claude-flow verification integration --parallel true\r\n  npx claude-flow verification truth --metric accuracy --threshold 0.8\r\n  npx claude-flow verification rollback --taskId task-123 --strategy automatic\r\n\r\nGLOBAL OPTIONS:\r\n  --json      Output results in JSON format\r\n  --verbose   Enable verbose logging\r\n  --help      Show help for specific subcommand\r\n\r\nFor more information about a specific subcommand:\r\n  npx claude-flow verification <subcommand> --help\r\n`;\r\n\r\n  console.log(help);\r\n  return { help: true };\r\n}\r\n\r\n/**\r\n * Hook command for direct hook execution (for backward compatibility)\r\n */\r\nexport async function hookCommand(args: any): Promise<any> {\r\n  const { type, ...hookArgs } = args;\r\n  \r\n  try {\r\n    logger.info(`Executing hook command: ${type}`);\r\n    \r\n    switch (type) {\r\n      case 'pre-task':\r\n      case 'pre_task':\r\n        return await executeVerificationFromCLI('pre-task', hookArgs);\r\n        \r\n      case 'post-task':\r\n      case 'post_task':\r\n        return await executeVerificationFromCLI('post-task', hookArgs);\r\n        \r\n      case 'validation':\r\n        const validateCommand = VerificationCLICommands.validate();\r\n        return await validateCommand.execute(hookArgs);\r\n        \r\n      case 'integration':\r\n      case 'integration-test':\r\n        return await executeVerificationFromCLI('integration', hookArgs);\r\n        \r\n      case 'truth':\r\n      case 'truth-telemetry':\r\n        return await executeVerificationFromCLI('truth', hookArgs);\r\n        \r\n      case 'rollback':\r\n        return await executeVerificationFromCLI('rollback', hookArgs);\r\n        \r\n      default:\r\n        throw new Error(`Unknown hook type: ${type}`);\r\n    }\r\n  } catch (error) {\r\n    logger.error(`Hook command failed:`, error);\r\n    throw error;\r\n  }\r\n}\r\n\r\n/**\r\n * Command definitions for CLI integration\r\n */\r\nexport const VERIFICATION_COMMANDS = {\r\n  verification: {\r\n    name: 'verification',\r\n    description: 'Verification system management and execution',\r\n    handler: verificationCommand,\r\n    subcommands: {\r\n      status: {\r\n        name: 'status',\r\n        description: 'Show verification system status',\r\n        options: {\r\n          json: { type: 'boolean', description: 'Output in JSON format' }\r\n        }\r\n      },\r\n      check: {\r\n        name: 'check',\r\n        description: 'Run verification checks',\r\n        options: {\r\n          taskId: { type: 'string', required: true, description: 'Task ID to check' },\r\n          type: { type: 'string', description: 'Type of checks to run' },\r\n          json: { type: 'boolean', description: 'Output in JSON format' }\r\n        }\r\n      },\r\n      config: {\r\n        name: 'config',\r\n        description: 'Manage verification configuration',\r\n        options: {\r\n          action: { type: 'string', description: 'Action to perform (show, set)' },\r\n          key: { type: 'string', description: 'Configuration key' },\r\n          value: { type: 'string', description: 'Configuration value' },\r\n          json: { type: 'boolean', description: 'Output in JSON format' }\r\n        }\r\n      },\r\n      validate: {\r\n        name: 'validate',\r\n        description: 'Run post-task validation',\r\n        options: {\r\n          taskId: { type: 'string', required: true, description: 'Task ID to validate' },\r\n          force: { type: 'boolean', description: 'Force validation even if not complete' },\r\n          json: { type: 'boolean', description: 'Output in JSON format' }\r\n        }\r\n      },\r\n      cleanup: {\r\n        name: 'cleanup',\r\n        description: 'Cleanup old verification data',\r\n        options: {\r\n          maxAge: { type: 'number', description: 'Maximum age in milliseconds' },\r\n          force: { type: 'boolean', description: 'Force cleanup without confirmation' },\r\n          json: { type: 'boolean', description: 'Output in JSON format' }\r\n        }\r\n      }\r\n    }\r\n  },\r\n  \r\n  hook: {\r\n    name: 'hook',\r\n    description: 'Execute verification hooks directly',\r\n    handler: hookCommand,\r\n    options: {\r\n      type: { type: 'string', required: true, description: 'Hook type to execute' },\r\n      taskId: { type: 'string', description: 'Task ID for context' },\r\n      sessionId: { type: 'string', description: 'Session ID for context' },\r\n      json: { type: 'boolean', description: 'Output in JSON format' }\r\n    }\r\n  }\r\n};\r\n\r\n/**\r\n * Integration function for registering commands with CLI framework\r\n */\r\nexport function registerVerificationCommands(commandRegistry: any): void {\r\n  try {\r\n    // Register main verification command\r\n    commandRegistry.register({\r\n      name: 'verification',\r\n      description: 'Verification system management',\r\n      handler: verificationCommand,\r\n      examples: [\r\n        'npx claude-flow verification status',\r\n        'npx claude-flow verification check --taskId task-123',\r\n        'npx claude-flow verification validate --taskId task-123'\r\n      ]\r\n    });\r\n\r\n    // Register hook command for backward compatibility\r\n    commandRegistry.register({\r\n      name: 'hook',\r\n      description: 'Execute verification hooks',\r\n      handler: hookCommand,\r\n      examples: [\r\n        'npx claude-flow hook --type pre-task --taskId task-123',\r\n        'npx claude-flow hook --type post-task --taskId task-123'\r\n      ]\r\n    });\r\n\r\n    logger.info('Verification commands registered successfully');\r\n  } catch (error) {\r\n    logger.error('Failed to register verification commands:', error);\r\n    throw error;\r\n  }\r\n}\r\n\r\n/**\r\n * Default export for CLI integration\r\n */\r\nexport default {\r\n  commands: VERIFICATION_COMMANDS,\r\n  register: registerVerificationCommands,\r\n  handlers: {\r\n    verification: verificationCommand,\r\n    hook: hookCommand\r\n  }\r\n};"],"names":["Logger","VerificationCLICommands","executeVerificationFromCLI","logger","level","format","destination","prefix","verificationCommand","args","subcommand","subArgs","debug","executeStatusCommand","executeCheckCommand","executeConfigCommand","executeValidateCommand","executeCleanupCommand","executePreTaskCommand","executePostTaskCommand","executeIntegrationCommand","executeTruthCommand","executeRollbackCommand","showVerificationHelp","Error","error","command","status","execute","check","config","validate","cleanup","help","console","log","hookCommand","type","hookArgs","info","validateCommand","VERIFICATION_COMMANDS","verification","name","description","handler","subcommands","options","json","taskId","required","action","key","value","force","maxAge","hook","sessionId","registerVerificationCommands","commandRegistry","register","examples","commands","handlers"],"mappings":"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"}