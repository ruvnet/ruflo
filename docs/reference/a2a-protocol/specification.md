# A2A Protocol Integration Specification

## Overview

This document specifies the integration of the official **Agent2Agent (A2A) Protocol** with Claude-Flow infrastructure. The A2A Protocol is an open standard introduced by Google in April 2025, designed to enable communication and interoperability between independent AI agent systems. This specification details how Claude-Flow implements and extends the A2A protocol for enterprise-scale multi-agent systems.

## Official A2A Protocol Context

### Google's Agent2Agent (A2A) Protocol
The **Agent2Agent (A2A) Protocol** is an official open standard developed by Google Cloud with support from 50+ technology partners including Atlassian, Box, Cohere, Intuit, Langchain, MongoDB, PayPal, Salesforce, SAP, ServiceNow, UKG, and Workday. The protocol enables AI agents to communicate with each other, securely exchange information, and coordinate actions across different platforms and vendors.

### Key A2A Protocol Features
- **Standardized Communication**: JSON-RPC 2.0 over HTTP(S)
- **Agent Discovery**: Via "Agent Cards" detailing capabilities and connection info
- **Flexible Interaction**: Supports synchronous request/response, streaming (SSE), and asynchronous push notifications
- **Rich Data Exchange**: Handles text, files, and structured JSON data
- **Enterprise-Ready**: Designed with security, authentication, and observability in mind

### A2A Protocol Design Principles
1. **Embrace agentic capabilities**: Focus on enabling agents to collaborate in their natural, unstructured modalities
2. **Build on existing standards**: Built on HTTP, SSE, JSON-RPC for easy integration
3. **Secure by default**: Enterprise-grade authentication and authorization
4. **Support for long-running tasks**: Flexible support for quick tasks to deep research
5. **Modality agnostic**: Support for various modalities including audio and video streaming

## Claude-Flow A2A Integration Principles

### Core Integration Principles
1. **A2A Protocol Compliance**: Full adherence to the official A2A Protocol specification v0.3.0
2. **Claude-Flow Enhancement**: Extends A2A with Claude-Flow's advanced features and patterns
3. **Backward Compatibility**: Maintains compatibility with existing MCP and EventBus systems
4. **Enterprise Extension**: Adds enterprise-grade features beyond the base A2A specification
5. **Performance Optimization**: Implements Claude-Flow's performance optimizations on top of A2A
6. **Security Enhancement**: Extends A2A's security model with Claude-Flow's advanced security features
7. **Memory Integration**: Integrates A2A with Claude-Flow's distributed memory system
8. **Agent Ecosystem**: Supports Claude-Flow's extensive agent ecosystem (65+ agent types)

### A2A Protocol Core Concepts (Official)
- **A2A Client**: Application or agent that initiates requests to an A2A Server
- **A2A Server (Remote Agent)**: Agent that exposes an A2A-compliant HTTP endpoint
- **Agent Card**: JSON metadata document describing agent identity, capabilities, and endpoints
- **Message**: Communication turn between client and remote agent with role and parts
- **Task**: Fundamental unit of work managed by A2A with defined lifecycle
- **Part**: Smallest unit of content within a Message or Artifact (TextPart, FilePart, DataPart)
- **Artifact**: Output generated by the agent as a result of a task
- **Streaming (SSE)**: Real-time, incremental updates via Server-Sent Events
- **Push Notifications**: Asynchronous task updates via server-initiated HTTP POST requests

## A2A Protocol Architecture (Official)

### 1. Official A2A Message Format

The official A2A Protocol defines the following core message structure:

```typescript
// Official A2A Message (from specification v0.3.0)
interface Message {
  readonly role: "user" | "agent";     // Identifies the sender
  parts: Part[];                      // Array of content parts
  metadata?: {[key: string]: any};    // Optional metadata for extensions
  extensions?: string[];              // URIs of relevant extensions
  referenceTaskIds?: string[];        // References to other task IDs
  messageId: string;                  // Unique identifier (UUID)
  taskId?: string;                    // ID of the task this message is part of
  contextId?: string;                 // Context ID for grouping interactions
  readonly kind: "message";          // Discriminator type
}

// Official A2A Part Union Type
type Part = TextPart | FilePart | DataPart;

interface TextPart {
  readonly kind: "text";
  text: string;
  metadata?: {[key: string]: any};
}

interface FilePart {
  readonly kind: "file";
  file: FileWithBytes | FileWithUri;
  metadata?: {[key: string]: any};
}

interface DataPart {
  readonly kind: "data";
  data: {[key: string]: any};
  metadata?: {[key: string]: any};
}
```

### 2. Official A2A Task Structure

```typescript
// Official A2A Task (from specification v0.3.0)
interface Task {
  id: string;                         // Unique identifier (UUID)
  contextId: string;                  // Server-generated context identifier
  status: TaskStatus;                 // Current status including state and message
  history?: Message[];                // Array of messages exchanged during task
  artifacts?: Artifact[];             // Collection of artifacts generated
  metadata?: {[key: string]: any};   // Optional metadata for extensions
  readonly kind: "task";             // Discriminator type
}

interface TaskStatus {
  state: TaskState;                   // Current state of the task lifecycle
  message?: Message;                  // Optional descriptive message
  timestamp?: string;                 // ISO 8601 datetime string
}

enum TaskState {
  Submitted = "submitted",            // Task has been submitted and awaiting execution
  Working = "working",               // Agent is actively working on the task
  InputRequired = "input-required",   // Task is paused waiting for user input
  Completed = "completed",           // Task has been successfully completed
  Canceled = "canceled",             // Task has been canceled by the user
  Failed = "failed",                 // Task failed due to an error
  Rejected = "rejected",             // Task was rejected by the agent
  AuthRequired = "auth-required",    // Task requires authentication to proceed
  Unknown = "unknown"                // Task is in an unknown state
}
```

### 3. Official A2A Agent Card

```typescript
// Official A2A Agent Card (from specification v0.3.0)
interface AgentCard {
  protocolVersion: string;            // Version of A2A protocol supported
  name: string;                      // Human-readable name for the agent
  description: string;               // Human-readable description
  url: string;                       // Preferred endpoint URL
  preferredTransport?: TransportProtocol; // Preferred transport (defaults to "JSONRPC")
  additionalInterfaces?: AgentInterface[]; // Additional supported interfaces
  iconUrl?: string;                  // Optional URL to an icon
  provider?: AgentProvider;          // Information about the service provider
  version: string;                   // Agent's own version number
  documentationUrl?: string;         // Optional URL to documentation
  capabilities: AgentCapabilities;   // Declaration of optional capabilities
  securitySchemes?: {[scheme: string]: SecurityScheme}; // Security schemes
  security?: {[scheme: string]: string[]}[]; // Security requirements
  defaultInputModes: string[];       // Default supported input MIME types
  defaultOutputModes: string[];       // Default supported output MIME types
  skills: AgentSkill[];              // Set of skills the agent can perform
  supportsAuthenticatedExtendedCard?: boolean; // Whether extended card is available
  signatures?: AgentCardSignature[]; // JSON Web Signatures for verification
}

enum TransportProtocol {
  JSONRPC = "JSONRPC",              // JSON-RPC 2.0 over HTTP
  GRPC = "GRPC",                    // gRPC over HTTP/2
  HTTP_JSON = "HTTP+JSON"           // REST-style HTTP with JSON
}
```

### 4. Official A2A Transport Protocols

The A2A Protocol supports three core transport protocols:

#### 4.1 JSON-RPC 2.0 Transport
- **Primary data format**: JSON-RPC 2.0 for all requests and responses
- **Content-Type**: `application/json`
- **Method naming**: `{category}/{action}` pattern (e.g., `message/send`, `tasks/get`)
- **Streaming**: Server-Sent Events (SSE) with `text/event-stream` content type

#### 4.2 gRPC Transport
- **Protocol Definition**: Uses Protocol Buffers definition in `specification/grpc/a2a.proto`
- **Message Serialization**: Protocol Buffers version 3
- **Service Definition**: Implements `A2AService` gRPC service
- **Transport Security**: TLS encryption (gRPC over HTTP/2 with TLS)

#### 4.3 HTTP+JSON/REST Transport
- **HTTP Methods**: Appropriate HTTP verbs (GET, POST, PUT, DELETE)
- **URL Patterns**: Resource-based URLs (e.g., `/v1/message:send`, `/v1/tasks/{id}`)
- **Content-Type**: `application/json`
- **HTTP Status Codes**: Standard HTTP status codes

### 5. Official A2A RPC Methods

The A2A Protocol defines the following core methods:

#### 5.1 Core Methods (Required)
- `message/send` - Send messages and initiate tasks
- `tasks/get` - Retrieve task status and results  
- `tasks/cancel` - Request task cancellation

#### 5.2 Optional Methods
- `message/stream` - Streaming message interaction (requires `capabilities.streaming: true`)
- `tasks/resubscribe` - Resume streaming for existing tasks
- `tasks/pushNotificationConfig/set` - Configure push notifications
- `tasks/pushNotificationConfig/get` - Retrieve push notification config
- `tasks/pushNotificationConfig/list` - List push notification configs
- `tasks/pushNotificationConfig/delete` - Delete push notification config
- `agent/getAuthenticatedExtendedCard` - Retrieve authenticated agent card

## Claude-Flow A2A Integration

### 6. Claude-Flow Extensions to A2A Protocol

While Claude-Flow fully implements the official A2A Protocol, it extends it with additional enterprise features:

#### 6.1 Enhanced Agent Identity
```typescript
// Claude-Flow extends A2A Agent Card with additional metadata
interface ClaudeFlowAgentCard extends AgentCard {
  // Claude-Flow specific extensions
  claudeFlowVersion: string;           // Claude-Flow version
  swarmCapabilities: SwarmCapabilities; // Swarm coordination features
  memoryIntegration: MemoryConfig;     // Distributed memory configuration
  performanceMetrics: PerformanceConfig; // Performance optimization settings
  
  // Enhanced agent metadata
  agentType: ClaudeFlowAgentType;      // Claude-Flow agent type (coder, reviewer, etc.)
  swarmId?: string;                     // Swarm membership identifier
  region?: string;                      // Geographic region
  environment?: string;                  // Environment (dev, staging, prod)
  
  // Advanced capabilities
  supportsSwarmCoordination: boolean;   // Can participate in swarm operations
  supportsMemorySharing: boolean;       // Can share memory across agents
  supportsEventStreaming: boolean;      // Can stream events via EventBus
  supportsMCPIntegration: boolean;      // Can integrate with MCP servers
}

enum ClaudeFlowAgentType {
  Coder = "coder",
  Reviewer = "reviewer", 
  Tester = "tester",
  Planner = "planner",
  Researcher = "researcher",
  SwarmCoordinator = "swarm-coordinator",
  MemoryManager = "memory-manager",
  // ... 65+ total agent types
}
```

#### 6.2 Claude-Flow Memory Integration
```typescript
// Claude-Flow extends A2A with distributed memory capabilities
interface ClaudeFlowMemoryExtension {
  // Memory operations integrated with A2A tasks
  memoryOperations: {
    store: (key: string, value: any, namespace?: string) => Promise<void>;
    retrieve: (key: string, namespace?: string) => Promise<any>;
    query: (query: MemoryQuery) => Promise<MemoryResult[]>;
    delete: (key: string, namespace?: string) => Promise<void>;
  };
  
  // Swarm memory coordination
  swarmMemory: {
    partition: string;                  // Memory partition identifier
    replicationFactor: number;           // Replication factor for reliability
    consistencyLevel: ConsistencyLevel;  // Consistency requirements
  };
  
  // Memory sharing across agents
  sharedMemory: {
    enabled: boolean;                    // Whether memory sharing is enabled
    accessControl: AccessControl[];      // Access control policies
    encryption: boolean;                 // Whether shared memory is encrypted
  };
}
```

#### 6.3 Claude-Flow Event Integration
```typescript
// Claude-Flow extends A2A with EventBus integration
interface ClaudeFlowEventExtension {
  // Event streaming capabilities
  eventStreaming: {
    enabled: boolean;                    // Whether event streaming is enabled
    eventTypes: string[];               // Supported event types
    batchSize: number;                  // Event batching configuration
  };
  
  // Event-driven coordination
  coordination: {
    swarmEvents: SwarmEvent[];          // Swarm coordination events
    memoryEvents: MemoryEvent[];        // Memory synchronization events
    taskEvents: TaskEvent[];            // Task lifecycle events
  };
  
  // Real-time updates
  realTimeUpdates: {
    enabled: boolean;                    // Whether real-time updates are enabled
    updateFrequency: number;             // Update frequency in milliseconds
    compressionEnabled: boolean;         // Whether updates are compressed
  };
}
```

### 7. Claude-Flow A2A Implementation

#### 7.1 A2A Protocol Handler Implementation
```typescript
// Claude-Flow's A2A Protocol Handler implementation
class ClaudeFlowA2AHandler implements A2AProtocolHandler {
  private messageBus: MessageBus;
  private memorySystem: DistributedMemorySystem;
  private eventBus: EventBus;
  private swarmCoordinator: SwarmCoordinator;
  
  constructor(config: ClaudeFlowA2AConfig) {
    this.messageBus = new MessageBus(config.messageBus);
    this.memorySystem = new DistributedMemorySystem(config.memory);
    this.eventBus = new EventBus(config.eventBus);
    this.swarmCoordinator = new SwarmCoordinator(config.swarm);
  }
  
  // Implement A2A Protocol methods
  async sendMessage(params: MessageSendParams): Promise<Task | Message> {
    // Validate A2A message format
    const a2aMessage = this.validateA2AMessage(params.message);
    
    // Integrate with Claude-Flow systems
    const claudeFlowContext = await this.createClaudeFlowContext(a2aMessage);
    
    // Process through Claude-Flow pipeline
    const result = await this.processThroughClaudeFlow(a2aMessage, claudeFlowContext);
    
    // Return A2A-compliant response
    return this.formatA2AResponse(result);
  }
  
  async getTask(params: TaskQueryParams): Promise<Task> {
    // Retrieve task from Claude-Flow task management
    const task = await this.taskManager.getTask(params.id);
    
    // Enhance with Claude-Flow metadata
    const enhancedTask = await this.enhanceTaskWithClaudeFlowData(task);
    
    return enhancedTask;
  }
  
  // Claude-Flow specific extensions
  async storeMemory(key: string, value: any, namespace?: string): Promise<void> {
    return this.memorySystem.store(key, value, namespace);
  }
  
  async retrieveMemory(key: string, namespace?: string): Promise<any> {
    return this.memorySystem.retrieve(key, namespace);
  }
  
  async emitEvent(event: ClaudeFlowEvent): Promise<void> {
    return this.eventBus.emit(event.type, event.data);
  }
}
```

#### 7.2 Agent Discovery and Registration
```typescript
// Claude-Flow agent discovery using A2A Agent Cards
class ClaudeFlowAgentDiscovery {
  private agentRegistry: Map<string, ClaudeFlowAgentCard>;
  private discoveryService: AgentDiscoveryService;
  
  async registerAgent(agentCard: ClaudeFlowAgentCard): Promise<void> {
    // Validate A2A Agent Card format
    this.validateA2AAgentCard(agentCard);
    
    // Register with Claude-Flow systems
    await this.registerWithSwarmCoordinator(agentCard);
    await this.registerWithMemorySystem(agentCard);
    await this.registerWithEventBus(agentCard);
    
    // Store in registry
    this.agentRegistry.set(agentCard.name, agentCard);
  }
  
  async discoverAgents(query: AgentDiscoveryQuery): Promise<ClaudeFlowAgentCard[]> {
    // Use A2A discovery mechanisms
    const a2aAgents = await this.discoveryService.discoverAgents(query);
    
    // Filter for Claude-Flow compatible agents
    const claudeFlowAgents = a2aAgents.filter(agent => 
      agent.capabilities?.extensions?.some(ext => 
        ext.uri.startsWith('https://claude-flow.dev/')
      )
    );
    
    return claudeFlowAgents;
  }
}
```

### 8. Claude-Flow A2A Integration Benefits

#### 8.1 Protocol Compliance
- **Full A2A Compliance**: Claude-Flow implements 100% of the official A2A Protocol specification
- **Industry Standard**: Uses Google's official A2A Protocol with 50+ industry partners
- **Future-Proof**: Built on established standards (HTTP, JSON-RPC, SSE) for long-term compatibility
- **Interoperability**: Can communicate with any A2A-compliant agent across different platforms

#### 8.2 Enterprise Enhancements
- **Advanced Memory Management**: Extends A2A with Claude-Flow's distributed memory system
- **Swarm Coordination**: Adds swarm intelligence capabilities beyond basic A2A communication
- **Performance Optimization**: Implements Claude-Flow's performance optimizations (2.8-4.4x speed improvement)
- **Security Enhancement**: Extends A2A's security model with advanced enterprise features

#### 8.3 Developer Experience
- **Familiar API**: Uses standard A2A Protocol methods developers already know
- **Rich Ecosystem**: Leverages Claude-Flow's 65+ agent types and extensive tooling
- **Comprehensive Documentation**: Official A2A Protocol documentation + Claude-Flow extensions
- **SDK Support**: Official A2A SDKs (Python, JavaScript, Java, .NET) + Claude-Flow enhancements

### 9. Migration from Custom Protocol

#### 9.1 Migration Strategy
```typescript
// Migration from custom Claude-Flow protocol to official A2A
class A2AMigrationService {
  async migrateCustomMessage(customMessage: CustomClaudeFlowMessage): Promise<Message> {
    // Convert custom message format to A2A Message
    const a2aMessage: Message = {
      role: customMessage.sender.type === 'user' ? 'user' : 'agent',
      parts: this.convertCustomPartsToA2AParts(customMessage.content),
      messageId: customMessage.id,
      taskId: customMessage.taskId,
      contextId: customMessage.contextId,
      kind: 'message'
    };
    
    return a2aMessage;
  }
  
  async migrateCustomTask(customTask: CustomClaudeFlowTask): Promise<Task> {
    // Convert custom task format to A2A Task
    const a2aTask: Task = {
      id: customTask.id,
      contextId: customTask.contextId,
      status: this.convertCustomStatusToA2AStatus(customTask.status),
      history: await this.migrateCustomHistory(customTask.history),
      artifacts: await this.migrateCustomArtifacts(customTask.artifacts),
      kind: 'task'
    };
    
    return a2aTask;
  }
}
```

#### 9.2 Backward Compatibility
- **Gradual Migration**: Support both custom and A2A protocols during transition
- **Automatic Translation**: Convert between custom and A2A formats automatically
- **Feature Parity**: Ensure all custom features are available in A2A implementation
- **Testing Suite**: Comprehensive testing to ensure migration success

### 10. Conclusion

The integration of the official **Agent2Agent (A2A) Protocol** with Claude-Flow represents a significant advancement in agent communication standards. By adopting Google's official A2A Protocol, Claude-Flow gains:

1. **Industry Standard Compliance**: Full compliance with the official A2A Protocol specification
2. **Enhanced Interoperability**: Communication with any A2A-compliant agent across platforms
3. **Future-Proof Architecture**: Built on established standards for long-term compatibility
4. **Enterprise Features**: Claude-Flow's advanced features extend A2A for enterprise use cases
5. **Developer Adoption**: Leverages the growing A2A ecosystem and developer community

This specification provides a comprehensive framework for implementing A2A Protocol compliance within Claude-Flow while maintaining and enhancing its unique enterprise capabilities. The result is a robust, standards-compliant, and highly performant agent communication system that serves both current needs and future growth.

## References

- [Official A2A Protocol Specification](https://a2a-protocol.org/latest/specification/)
- [Google A2A Protocol Announcement](https://developers.googleblog.com/en/a2a-a-new-era-of-agent-interoperability/)
- [A2A Protocol GitHub Repository](https://github.com/a2aproject/A2A)
- [A2A Protocol Documentation](https://a2a-protocol.org/)
- [Claude-Flow Documentation](https://github.com/ruvnet/claude-flow)