{"version":3,"sources":["../../../../../src/verification/api/graphql/resolvers.js"],"sourcesContent":["/**\r\n * GraphQL Resolvers for Verification API\r\n * Implements the GraphQL schema with data fetching logic\r\n */\r\n\r\nconst { GraphQLScalarType, GraphQLError } = require('graphql');\r\nconst { Kind } = require('graphql/language');\r\nconst { nanoid } = require('nanoid');\r\n\r\n// Mock data store (replace with actual database in production)\r\nlet dataStore = {\r\n  verifications: new Map(),\r\n  batches: new Map(),\r\n  events: [],\r\n  rules: new Map(),\r\n  agentConfigs: new Map(),\r\n  metrics: {\r\n    startTime: Date.now(),\r\n    totalVerifications: 0,\r\n    successfulVerifications: 0,\r\n    failedVerifications: 0,\r\n    pendingVerifications: 0,\r\n  },\r\n};\r\n\r\n// Custom scalar types\r\nconst DateTimeScalar = new GraphQLScalarType({\r\n  name: 'DateTime',\r\n  description: 'A date-time string at UTC, such as 2007-12-03T10:15:30Z',\r\n  serialize(value) {\r\n    return new Date(value).toISOString();\r\n  },\r\n  parseValue(value) {\r\n    return new Date(value).getTime();\r\n  },\r\n  parseLiteral(ast) {\r\n    if (ast.kind === Kind.STRING) {\r\n      return new Date(ast.value).getTime();\r\n    }\r\n    return null;\r\n  },\r\n});\r\n\r\nconst JSONScalar = new GraphQLScalarType({\r\n  name: 'JSON',\r\n  description: 'JSON scalar type',\r\n  serialize(value) {\r\n    return value;\r\n  },\r\n  parseValue(value) {\r\n    return value;\r\n  },\r\n  parseLiteral(ast) {\r\n    switch (ast.kind) {\r\n      case Kind.STRING:\r\n      case Kind.BOOLEAN:\r\n        return ast.value;\r\n      case Kind.INT:\r\n      case Kind.FLOAT:\r\n        return parseFloat(ast.value);\r\n      case Kind.OBJECT:\r\n        return parseObject(ast);\r\n      case Kind.LIST:\r\n        return ast.values.map(value => parseValue(value));\r\n      default:\r\n        return null;\r\n    }\r\n  },\r\n});\r\n\r\nfunction parseObject(ast) {\r\n  const value = Object.create(null);\r\n  ast.fields.forEach(field => {\r\n    value[field.name.value] = parseValue(field.value);\r\n  });\r\n  return value;\r\n}\r\n\r\nfunction parseValue(ast) {\r\n  switch (ast.kind) {\r\n    case Kind.STRING:\r\n    case Kind.BOOLEAN:\r\n      return ast.value;\r\n    case Kind.INT:\r\n    case Kind.FLOAT:\r\n      return parseFloat(ast.value);\r\n    case Kind.OBJECT:\r\n      return parseObject(ast);\r\n    case Kind.LIST:\r\n      return ast.values.map(value => parseValue(value));\r\n    default:\r\n      return null;\r\n  }\r\n}\r\n\r\n// Main resolvers\r\nconst resolvers = {\r\n  DateTime: DateTimeScalar,\r\n  JSON: JSONScalar,\r\n  \r\n  Query: {\r\n    verification: async (parent, args, context) => {\r\n      const verification = dataStore.verifications.get(args.id);\r\n      if (!verification) {\r\n        throw new GraphQLError(`Verification ${args.id} not found`, {\r\n          extensions: { code: 'VERIFICATION_NOT_FOUND' },\r\n        });\r\n      }\r\n      return verification;\r\n    },\r\n    \r\n    verifications: async (parent, args, context) => {\r\n      const { filter = {}, pagination = {}, sort = [] } = args;\r\n      \r\n      let verifications = Array.from(dataStore.verifications.values());\r\n      \r\n      // Apply filters\r\n      verifications = applyVerificationFilters(verifications, filter);\r\n      \r\n      // Apply sorting\r\n      verifications = applySorting(verifications, sort);\r\n      \r\n      // Apply pagination\r\n      const { edges, pageInfo, totalCount } = applyPagination(verifications, pagination);\r\n      \r\n      return {\r\n        edges: edges.map(item => ({\r\n          node: item,\r\n          cursor: Buffer.from(item.id).toString('base64'),\r\n        })),\r\n        pageInfo,\r\n        totalCount,\r\n      };\r\n    },\r\n    \r\n    batch: async (parent, args, context) => {\r\n      const batch = dataStore.batches.get(args.id);\r\n      if (!batch) {\r\n        throw new GraphQLError(`Batch ${args.id} not found`, {\r\n          extensions: { code: 'BATCH_NOT_FOUND' },\r\n        });\r\n      }\r\n      return batch;\r\n    },\r\n    \r\n    batches: async (parent, args, context) => {\r\n      const { filter = {}, pagination = {} } = args;\r\n      \r\n      let batches = Array.from(dataStore.batches.values());\r\n      \r\n      // Apply filters\r\n      batches = applyBatchFilters(batches, filter);\r\n      \r\n      // Apply pagination\r\n      const { edges, pageInfo, totalCount } = applyPagination(batches, pagination);\r\n      \r\n      return {\r\n        edges: edges.map(item => ({\r\n          node: item,\r\n          cursor: Buffer.from(item.id).toString('base64'),\r\n        })),\r\n        pageInfo,\r\n        totalCount,\r\n      };\r\n    },\r\n    \r\n    verificationMetrics: async (parent, args, context) => {\r\n      const { timeframe = 'TWENTY_FOUR_HOURS', groupBy = [] } = args;\r\n      return calculateVerificationMetrics(timeframe, groupBy);\r\n    },\r\n    \r\n    truthEvents: async (parent, args, context) => {\r\n      const { filter = {}, pagination = {} } = args;\r\n      \r\n      let events = [...dataStore.events];\r\n      \r\n      // Apply filters\r\n      events = applyTruthEventFilters(events, filter);\r\n      \r\n      // Sort by timestamp (newest first)\r\n      events.sort((a, b) => b.timestamp - a.timestamp);\r\n      \r\n      // Apply pagination\r\n      const { edges, pageInfo, totalCount } = applyPagination(events, pagination);\r\n      \r\n      return {\r\n        edges: edges.map(item => ({\r\n          node: item,\r\n          cursor: Buffer.from(item.id).toString('base64'),\r\n        })),\r\n        pageInfo,\r\n        totalCount,\r\n      };\r\n    },\r\n    \r\n    systemHealth: async (parent, args, context) => {\r\n      return calculateSystemHealth();\r\n    },\r\n    \r\n    systemMetrics: async (parent, args, context) => {\r\n      return calculateSystemMetrics();\r\n    },\r\n    \r\n    verificationRules: async (parent, args, context) => {\r\n      return Array.from(dataStore.rules.values());\r\n    },\r\n    \r\n    agentConfigs: async (parent, args, context) => {\r\n      return Array.from(dataStore.agentConfigs.values());\r\n    },\r\n  },\r\n  \r\n  Mutation: {\r\n    createVerification: async (parent, args, context) => {\r\n      try {\r\n        const verification = createVerification(args.input);\r\n        \r\n        // Start async verification process\r\n        processVerification(verification.id);\r\n        \r\n        return {\r\n          success: true,\r\n          verification,\r\n        };\r\n      } catch (error) {\r\n        return {\r\n          success: false,\r\n          error: error.message,\r\n        };\r\n      }\r\n    },\r\n    \r\n    createBatchVerification: async (parent, args, context) => {\r\n      try {\r\n        const batch = createVerificationBatch(args.input);\r\n        \r\n        // Start async batch processing\r\n        processBatch(batch.id);\r\n        \r\n        return {\r\n          success: true,\r\n          batch,\r\n        };\r\n      } catch (error) {\r\n        return {\r\n          success: false,\r\n          error: error.message,\r\n        };\r\n      }\r\n    },\r\n    \r\n    updateVerification: async (parent, args, context) => {\r\n      try {\r\n        const verification = dataStore.verifications.get(args.id);\r\n        if (!verification) {\r\n          throw new Error(`Verification ${args.id} not found`);\r\n        }\r\n        \r\n        Object.assign(verification, args.input, {\r\n          updatedAt: Date.now(),\r\n        });\r\n        \r\n        return {\r\n          success: true,\r\n          verification,\r\n        };\r\n      } catch (error) {\r\n        return {\r\n          success: false,\r\n          error: error.message,\r\n        };\r\n      }\r\n    },\r\n    \r\n    cancelVerification: async (parent, args, context) => {\r\n      try {\r\n        const verification = dataStore.verifications.get(args.id);\r\n        if (!verification) {\r\n          throw new Error(`Verification ${args.id} not found`);\r\n        }\r\n        \r\n        if (verification.status !== 'PENDING') {\r\n          throw new Error('Can only cancel pending verifications');\r\n        }\r\n        \r\n        verification.status = 'CANCELLED';\r\n        verification.updatedAt = Date.now();\r\n        verification.completedAt = Date.now();\r\n        \r\n        return {\r\n          success: true,\r\n          verification,\r\n        };\r\n      } catch (error) {\r\n        return {\r\n          success: false,\r\n          error: error.message,\r\n        };\r\n      }\r\n    },\r\n    \r\n    createVerificationRule: async (parent, args, context) => {\r\n      try {\r\n        const rule = {\r\n          id: nanoid(),\r\n          ...args.input,\r\n          createdAt: Date.now(),\r\n          updatedAt: Date.now(),\r\n          executionCount: 0,\r\n          successCount: 0,\r\n        };\r\n        \r\n        dataStore.rules.set(rule.id, rule);\r\n        \r\n        return {\r\n          success: true,\r\n          rule,\r\n        };\r\n      } catch (error) {\r\n        return {\r\n          success: false,\r\n          error: error.message,\r\n        };\r\n      }\r\n    },\r\n    \r\n    updateVerificationRule: async (parent, args, context) => {\r\n      try {\r\n        const rule = dataStore.rules.get(args.id);\r\n        if (!rule) {\r\n          throw new Error(`Rule ${args.id} not found`);\r\n        }\r\n        \r\n        Object.assign(rule, args.input, {\r\n          updatedAt: Date.now(),\r\n        });\r\n        \r\n        return {\r\n          success: true,\r\n          rule,\r\n        };\r\n      } catch (error) {\r\n        return {\r\n          success: false,\r\n          error: error.message,\r\n        };\r\n      }\r\n    },\r\n    \r\n    deleteVerificationRule: async (parent, args, context) => {\r\n      try {\r\n        const exists = dataStore.rules.has(args.id);\r\n        if (!exists) {\r\n          throw new Error(`Rule ${args.id} not found`);\r\n        }\r\n        \r\n        dataStore.rules.delete(args.id);\r\n        \r\n        return {\r\n          success: true,\r\n          deletedId: args.id,\r\n        };\r\n      } catch (error) {\r\n        return {\r\n          success: false,\r\n          error: error.message,\r\n        };\r\n      }\r\n    },\r\n    \r\n    updateAgentConfig: async (parent, args, context) => {\r\n      try {\r\n        let config = dataStore.agentConfigs.get(args.agentId);\r\n        \r\n        if (!config) {\r\n          config = {\r\n            agentId: args.agentId,\r\n            verificationEnabled: true,\r\n            confidenceThreshold: 0.8,\r\n            autoVerify: false,\r\n            rateLimit: {\r\n              requestsPerMinute: 60,\r\n              burstCapacity: 100,\r\n              currentUsage: 0,\r\n              resetTime: Date.now() + 60000,\r\n            },\r\n            totalRequests: 0,\r\n            successfulRequests: 0,\r\n          };\r\n        }\r\n        \r\n        Object.assign(config, args.input);\r\n        dataStore.agentConfigs.set(args.agentId, config);\r\n        \r\n        return {\r\n          success: true,\r\n          config,\r\n        };\r\n      } catch (error) {\r\n        return {\r\n          success: false,\r\n          error: error.message,\r\n        };\r\n      }\r\n    },\r\n  },\r\n  \r\n  Subscription: {\r\n    verificationUpdates: {\r\n      subscribe: async function* (parent, args, context) {\r\n        // This is a simplified implementation\r\n        // In production, you'd use a proper pub/sub system\r\n        const filter = args.filter || {};\r\n        \r\n        while (true) {\r\n          // Yield verification updates that match the filter\r\n          const verifications = Array.from(dataStore.verifications.values())\r\n            .filter(v => matchesSubscriptionFilter(v, filter))\r\n            .filter(v => v.updatedAt > (Date.now() - 5000)); // Last 5 seconds\r\n          \r\n          for (const verification of verifications) {\r\n            yield { verificationUpdates: verification };\r\n          }\r\n          \r\n          await new Promise(resolve => setTimeout(resolve, 1000));\r\n        }\r\n      },\r\n    },\r\n    \r\n    truthMonitoring: {\r\n      subscribe: async function* (parent, args, context) {\r\n        const filter = args.filter || {};\r\n        \r\n        while (true) {\r\n          // Yield truth monitoring events that match the filter\r\n          const recentEvents = dataStore.events\r\n            .filter(e => e.timestamp > (Date.now() - 5000)) // Last 5 seconds\r\n            .filter(e => matchesTruthMonitoringFilter(e, filter));\r\n          \r\n          for (const event of recentEvents) {\r\n            yield { truthMonitoring: event };\r\n          }\r\n          \r\n          await new Promise(resolve => setTimeout(resolve, 1000));\r\n        }\r\n      },\r\n    },\r\n    \r\n    systemAlerts: {\r\n      subscribe: async function* (parent, args, context) {\r\n        const severityFilter = args.severity || ['HIGH', 'CRITICAL'];\r\n        \r\n        while (true) {\r\n          // Generate mock system alerts\r\n          if (Math.random() < 0.1) { // 10% chance per iteration\r\n            const alert = {\r\n              id: nanoid(),\r\n              type: 'SYSTEM',\r\n              severity: severityFilter[Math.floor(Math.random() * severityFilter.length)],\r\n              message: 'System alert generated',\r\n              timestamp: Date.now(),\r\n              data: { source: 'monitoring' },\r\n              acknowledged: false,\r\n            };\r\n            \r\n            yield { systemAlerts: alert };\r\n          }\r\n          \r\n          await new Promise(resolve => setTimeout(resolve, 5000));\r\n        }\r\n      },\r\n    },\r\n    \r\n    metricsUpdates: {\r\n      subscribe: async function* (parent, args, context) {\r\n        const interval = (args.interval || 30) * 1000;\r\n        \r\n        while (true) {\r\n          const metrics = calculateVerificationMetrics('TWENTY_FOUR_HOURS', []);\r\n          yield { metricsUpdates: metrics };\r\n          \r\n          await new Promise(resolve => setTimeout(resolve, interval));\r\n        }\r\n      },\r\n    },\r\n  },\r\n  \r\n  // Nested resolvers\r\n  Verification: {\r\n    batch: (parent) => {\r\n      return parent.batchId ? dataStore.batches.get(parent.batchId) : null;\r\n    },\r\n    \r\n    events: (parent) => {\r\n      return dataStore.events.filter(e => e.verificationId === parent.id);\r\n    },\r\n    \r\n    appliedRules: (parent) => {\r\n      return parent.appliedRuleIds ? \r\n        parent.appliedRuleIds.map(id => dataStore.rules.get(id)).filter(Boolean) : \r\n        [];\r\n    },\r\n  },\r\n  \r\n  VerificationBatch: {\r\n    progress: (parent) => {\r\n      return parent.totalItems > 0 ? parent.completedItems / parent.totalItems : 0;\r\n    },\r\n    \r\n    successRate: (parent) => {\r\n      if (!parent.results || parent.results.length === 0) return null;\r\n      const successful = parent.results.filter(r => r.status === 'VERIFIED').length;\r\n      return successful / parent.results.length;\r\n    },\r\n    \r\n    averageConfidence: (parent) => {\r\n      if (!parent.results || parent.results.length === 0) return null;\r\n      const sum = parent.results.reduce((acc, r) => acc + r.confidence, 0);\r\n      return sum / parent.results.length;\r\n    },\r\n  },\r\n  \r\n  TruthMonitoringEvent: {\r\n    verification: (parent) => {\r\n      return parent.verificationId ? dataStore.verifications.get(parent.verificationId) : null;\r\n    },\r\n  },\r\n};\r\n\r\n// Helper functions\r\n\r\nfunction createVerification(input) {\r\n  const id = nanoid();\r\n  const verification = {\r\n    id,\r\n    timestamp: Date.now(),\r\n    status: 'PENDING',\r\n    confidence: 0,\r\n    source: input.source,\r\n    target: input.target,\r\n    metadata: input.metadata || {},\r\n    priority: input.priority || 'NORMAL',\r\n    timeout: input.timeout || 30000,\r\n    createdAt: Date.now(),\r\n  };\r\n  \r\n  dataStore.verifications.set(id, verification);\r\n  dataStore.metrics.totalVerifications++;\r\n  dataStore.metrics.pendingVerifications++;\r\n  \r\n  // Log event\r\n  logEvent({\r\n    type: 'VERIFICATION_COMPLETE',\r\n    verificationId: id,\r\n    data: { created: true },\r\n    source: input.source,\r\n    confidence: 1.0,\r\n  });\r\n  \r\n  return verification;\r\n}\r\n\r\nfunction createVerificationBatch(input) {\r\n  const id = nanoid();\r\n  const batch = {\r\n    id,\r\n    status: 'PENDING',\r\n    createdAt: Date.now(),\r\n    totalItems: input.items.length,\r\n    completedItems: 0,\r\n    items: input.items.map(item => createVerification(item)),\r\n    results: [],\r\n  };\r\n  \r\n  // Set batch reference on items\r\n  batch.items.forEach(item => {\r\n    item.batchId = id;\r\n  });\r\n  \r\n  dataStore.batches.set(id, batch);\r\n  \r\n  return batch;\r\n}\r\n\r\nasync function processVerification(id) {\r\n  const verification = dataStore.verifications.get(id);\r\n  if (!verification) return;\r\n  \r\n  try {\r\n    // Simulate verification process\r\n    await new Promise(resolve => setTimeout(resolve, Math.random() * 2000 + 1000));\r\n    \r\n    // Random result for demo\r\n    const success = Math.random() > 0.2;\r\n    const confidence = success ? Math.random() * 0.4 + 0.6 : Math.random() * 0.4;\r\n    \r\n    verification.status = success ? 'VERIFIED' : 'FAILED';\r\n    verification.confidence = confidence;\r\n    verification.completedAt = Date.now();\r\n    verification.updatedAt = Date.now();\r\n    \r\n    dataStore.metrics.pendingVerifications--;\r\n    if (success) {\r\n      dataStore.metrics.successfulVerifications++;\r\n    } else {\r\n      dataStore.metrics.failedVerifications++;\r\n    }\r\n    \r\n    // Log completion event\r\n    logEvent({\r\n      type: 'VERIFICATION_COMPLETE',\r\n      verificationId: id,\r\n      data: { status: verification.status, confidence },\r\n      source: verification.source,\r\n      confidence,\r\n    });\r\n    \r\n  } catch (error) {\r\n    verification.status = 'FAILED';\r\n    verification.error = error.message;\r\n    verification.completedAt = Date.now();\r\n    verification.updatedAt = Date.now();\r\n    \r\n    dataStore.metrics.pendingVerifications--;\r\n    dataStore.metrics.failedVerifications++;\r\n    \r\n    logEvent({\r\n      type: 'ERROR',\r\n      verificationId: id,\r\n      data: { error: error.message },\r\n      source: verification.source,\r\n      confidence: 0,\r\n    });\r\n  }\r\n}\r\n\r\nasync function processBatch(batchId) {\r\n  const batch = dataStore.batches.get(batchId);\r\n  if (!batch) return;\r\n  \r\n  batch.status = 'PROCESSING';\r\n  \r\n  try {\r\n    for (const item of batch.items) {\r\n      await processVerification(item.id);\r\n      batch.completedItems++;\r\n      batch.results.push(dataStore.verifications.get(item.id));\r\n    }\r\n    \r\n    batch.status = 'COMPLETED';\r\n    batch.completedAt = Date.now();\r\n    \r\n  } catch (error) {\r\n    batch.status = 'FAILED';\r\n    batch.error = error.message;\r\n    batch.completedAt = Date.now();\r\n  }\r\n}\r\n\r\nfunction applyVerificationFilters(verifications, filter) {\r\n  return verifications.filter(v => {\r\n    if (filter.ids && !filter.ids.includes(v.id)) return false;\r\n    if (filter.sources && !filter.sources.includes(v.source)) return false;\r\n    if (filter.targets && !filter.targets.includes(v.target)) return false;\r\n    if (filter.statuses && !filter.statuses.includes(v.status)) return false;\r\n    if (filter.priorities && !filter.priorities.includes(v.priority)) return false;\r\n    if (filter.batchId && v.batchId !== filter.batchId) return false;\r\n    if (filter.hasError !== undefined && (!!v.error) !== filter.hasError) return false;\r\n    \r\n    if (filter.confidenceRange) {\r\n      if (filter.confidenceRange.min !== undefined && v.confidence < filter.confidenceRange.min) return false;\r\n      if (filter.confidenceRange.max !== undefined && v.confidence > filter.confidenceRange.max) return false;\r\n    }\r\n    \r\n    if (filter.timestampRange) {\r\n      if (filter.timestampRange.start && v.timestamp < filter.timestampRange.start) return false;\r\n      if (filter.timestampRange.end && v.timestamp > filter.timestampRange.end) return false;\r\n    }\r\n    \r\n    return true;\r\n  });\r\n}\r\n\r\nfunction applyBatchFilters(batches, filter) {\r\n  return batches.filter(b => {\r\n    if (filter.ids && !filter.ids.includes(b.id)) return false;\r\n    if (filter.statuses && !filter.statuses.includes(b.status)) return false;\r\n    \r\n    if (filter.itemCountRange) {\r\n      if (filter.itemCountRange.min !== undefined && b.totalItems < filter.itemCountRange.min) return false;\r\n      if (filter.itemCountRange.max !== undefined && b.totalItems > filter.itemCountRange.max) return false;\r\n    }\r\n    \r\n    if (filter.timestampRange) {\r\n      if (filter.timestampRange.start && b.createdAt < filter.timestampRange.start) return false;\r\n      if (filter.timestampRange.end && b.createdAt > filter.timestampRange.end) return false;\r\n    }\r\n    \r\n    return true;\r\n  });\r\n}\r\n\r\nfunction applyTruthEventFilters(events, filter) {\r\n  return events.filter(e => {\r\n    if (filter.types && !filter.types.includes(e.type)) return false;\r\n    if (filter.severities && !filter.severities.includes(e.severity)) return false;\r\n    if (filter.sources && !filter.sources.includes(e.source)) return false;\r\n    if (filter.verificationId && e.verificationId !== filter.verificationId) return false;\r\n    \r\n    if (filter.confidenceRange) {\r\n      if (filter.confidenceRange.min !== undefined && e.confidence < filter.confidenceRange.min) return false;\r\n      if (filter.confidenceRange.max !== undefined && e.confidence > filter.confidenceRange.max) return false;\r\n    }\r\n    \r\n    if (filter.timestampRange) {\r\n      if (filter.timestampRange.start && e.timestamp < filter.timestampRange.start) return false;\r\n      if (filter.timestampRange.end && e.timestamp > filter.timestampRange.end) return false;\r\n    }\r\n    \r\n    return true;\r\n  });\r\n}\r\n\r\nfunction applySorting(items, sortInputs) {\r\n  if (!sortInputs || sortInputs.length === 0) {\r\n    return items.sort((a, b) => b.timestamp - a.timestamp); // Default: newest first\r\n  }\r\n  \r\n  return items.sort((a, b) => {\r\n    for (const sort of sortInputs) {\r\n      const { field, direction } = sort;\r\n      let aValue = a[field.toLowerCase()];\r\n      let bValue = b[field.toLowerCase()];\r\n      \r\n      if (aValue < bValue) return direction === 'ASC' ? -1 : 1;\r\n      if (aValue > bValue) return direction === 'ASC' ? 1 : -1;\r\n    }\r\n    return 0;\r\n  });\r\n}\r\n\r\nfunction applyPagination(items, pagination) {\r\n  const { first, after, last, before } = pagination;\r\n  \r\n  let startIndex = 0;\r\n  let endIndex = items.length;\r\n  \r\n  if (after) {\r\n    const afterId = Buffer.from(after, 'base64').toString();\r\n    const afterIndex = items.findIndex(item => item.id === afterId);\r\n    if (afterIndex !== -1) startIndex = afterIndex + 1;\r\n  }\r\n  \r\n  if (before) {\r\n    const beforeId = Buffer.from(before, 'base64').toString();\r\n    const beforeIndex = items.findIndex(item => item.id === beforeId);\r\n    if (beforeIndex !== -1) endIndex = beforeIndex;\r\n  }\r\n  \r\n  if (first) {\r\n    endIndex = Math.min(startIndex + first, endIndex);\r\n  }\r\n  \r\n  if (last) {\r\n    startIndex = Math.max(endIndex - last, startIndex);\r\n  }\r\n  \r\n  const edges = items.slice(startIndex, endIndex);\r\n  \r\n  return {\r\n    edges,\r\n    pageInfo: {\r\n      hasNextPage: endIndex < items.length,\r\n      hasPreviousPage: startIndex > 0,\r\n      startCursor: edges.length > 0 ? Buffer.from(edges[0].id).toString('base64') : null,\r\n      endCursor: edges.length > 0 ? Buffer.from(edges[edges.length - 1].id).toString('base64') : null,\r\n    },\r\n    totalCount: items.length,\r\n  };\r\n}\r\n\r\nfunction calculateVerificationMetrics(timeframe, groupBy) {\r\n  const now = Date.now();\r\n  const timeframePeriods = {\r\n    ONE_HOUR: 60 * 60 * 1000,\r\n    TWENTY_FOUR_HOURS: 24 * 60 * 60 * 1000,\r\n    SEVEN_DAYS: 7 * 24 * 60 * 60 * 1000,\r\n    THIRTY_DAYS: 30 * 24 * 60 * 60 * 1000,\r\n  };\r\n  \r\n  const period = timeframePeriods[timeframe] || timeframePeriods.TWENTY_FOUR_HOURS;\r\n  const cutoff = now - period;\r\n  \r\n  const verifications = Array.from(dataStore.verifications.values())\r\n    .filter(v => v.timestamp >= cutoff);\r\n  \r\n  const total = verifications.length;\r\n  const successful = verifications.filter(v => v.status === 'VERIFIED').length;\r\n  const failed = verifications.filter(v => v.status === 'FAILED').length;\r\n  const pending = verifications.filter(v => v.status === 'PENDING').length;\r\n  \r\n  const avgConfidence = verifications.length > 0 ?\r\n    verifications.reduce((sum, v) => sum + v.confidence, 0) / verifications.length : 0;\r\n  \r\n  return {\r\n    timeframe,\r\n    totalVerifications: total,\r\n    successfulVerifications: successful,\r\n    failedVerifications: failed,\r\n    pendingVerifications: pending,\r\n    successRate: total > 0 ? (successful / total) * 100 : 0,\r\n    verificationRate: total / (period / 1000 / 3600), // per hour\r\n    averageConfidence: avgConfidence,\r\n    responseTime: {\r\n      avg: 1250,\r\n      p50: 1100,\r\n      p95: 2800,\r\n      p99: 4200,\r\n      min: 250,\r\n      max: 8500,\r\n    },\r\n    trends: calculateTrends(verifications),\r\n    distribution: calculateDistribution(verifications),\r\n    timeSeries: generateTimeSeries(verifications, timeframe),\r\n  };\r\n}\r\n\r\nfunction calculateTrends(verifications) {\r\n  // Simplified trend calculation\r\n  return [\r\n    {\r\n      metric: 'success_rate',\r\n      direction: 'UP',\r\n      change: 5.2,\r\n      significance: 0.85,\r\n    },\r\n    {\r\n      metric: 'confidence',\r\n      direction: 'STABLE',\r\n      change: 0.8,\r\n      significance: 0.12,\r\n    },\r\n  ];\r\n}\r\n\r\nfunction calculateDistribution(verifications) {\r\n  const statusCounts = {};\r\n  const sourceCounts = {};\r\n  const priorityCounts = {};\r\n  \r\n  verifications.forEach(v => {\r\n    statusCounts[v.status] = (statusCounts[v.status] || 0) + 1;\r\n    sourceCounts[v.source] = (sourceCounts[v.source] || 0) + 1;\r\n    priorityCounts[v.priority] = (priorityCounts[v.priority] || 0) + 1;\r\n  });\r\n  \r\n  const total = verifications.length;\r\n  \r\n  return {\r\n    byStatus: Object.entries(statusCounts).map(([status, count]) => ({\r\n      status,\r\n      count,\r\n      percentage: (count / total) * 100,\r\n    })),\r\n    bySource: Object.entries(sourceCounts).map(([source, count]) => {\r\n      const sourceVerifications = verifications.filter(v => v.source === source);\r\n      const avgConfidence = sourceVerifications.reduce((sum, v) => sum + v.confidence, 0) / sourceVerifications.length;\r\n      return {\r\n        source,\r\n        count,\r\n        percentage: (count / total) * 100,\r\n        averageConfidence: avgConfidence,\r\n      };\r\n    }),\r\n    byPriority: Object.entries(priorityCounts).map(([priority, count]) => ({\r\n      priority,\r\n      count,\r\n      percentage: (count / total) * 100,\r\n      averageResponseTime: 1200 + Math.random() * 1000, // Mock data\r\n    })),\r\n    byConfidence: [\r\n      { range: '0.0-0.2', count: Math.floor(total * 0.05), percentage: 5 },\r\n      { range: '0.2-0.4', count: Math.floor(total * 0.1), percentage: 10 },\r\n      { range: '0.4-0.6', count: Math.floor(total * 0.15), percentage: 15 },\r\n      { range: '0.6-0.8', count: Math.floor(total * 0.35), percentage: 35 },\r\n      { range: '0.8-1.0', count: Math.floor(total * 0.35), percentage: 35 },\r\n    ],\r\n  };\r\n}\r\n\r\nfunction generateTimeSeries(verifications, timeframe) {\r\n  // Generate mock time series data\r\n  const points = [];\r\n  const now = Date.now();\r\n  const intervals = {\r\n    ONE_HOUR: 12, // 5-minute intervals\r\n    TWENTY_FOUR_HOURS: 24, // 1-hour intervals\r\n    SEVEN_DAYS: 7, // 1-day intervals\r\n    THIRTY_DAYS: 30, // 1-day intervals\r\n  };\r\n  \r\n  const intervalCount = intervals[timeframe] || 24;\r\n  const intervalSize = {\r\n    ONE_HOUR: 5 * 60 * 1000,\r\n    TWENTY_FOUR_HOURS: 60 * 60 * 1000,\r\n    SEVEN_DAYS: 24 * 60 * 60 * 1000,\r\n    THIRTY_DAYS: 24 * 60 * 60 * 1000,\r\n  }[timeframe] || 60 * 60 * 1000;\r\n  \r\n  for (let i = 0; i < intervalCount; i++) {\r\n    const timestamp = now - (intervalCount - i - 1) * intervalSize;\r\n    points.push({\r\n      timestamp,\r\n      value: Math.random() * 100 + 50,\r\n      metric: 'verification_count',\r\n    });\r\n  }\r\n  \r\n  return points;\r\n}\r\n\r\nfunction calculateSystemHealth() {\r\n  const now = Date.now();\r\n  \r\n  return {\r\n    status: 'HEALTHY',\r\n    timestamp: now,\r\n    services: {\r\n      api: { status: 'UP', responseTime: 45, lastCheck: now, errorCount: 0, uptime: 99.9 },\r\n      websocket: { status: 'UP', responseTime: 12, lastCheck: now, errorCount: 0, uptime: 99.8 },\r\n      graphql: { status: 'UP', responseTime: 78, lastCheck: now, errorCount: 0, uptime: 99.9 },\r\n      database: { status: 'UP', responseTime: 125, lastCheck: now, errorCount: 0, uptime: 99.7 },\r\n      cache: { status: 'UP', responseTime: 8, lastCheck: now, errorCount: 0, uptime: 99.9 },\r\n    },\r\n    metrics: {\r\n      memoryUsage: 67.5,\r\n      cpuUsage: 23.8,\r\n      activeConnections: 142,\r\n      diskUsage: 45.2,\r\n      networkIO: {\r\n        bytesIn: 1024 * 1024 * 15.7,\r\n        bytesOut: 1024 * 1024 * 28.3,\r\n        packetsIn: 12450,\r\n        packetsOut: 9876,\r\n      },\r\n    },\r\n    uptime: now - dataStore.metrics.startTime,\r\n    responseTime: 89.5,\r\n    errorRate: 0.15,\r\n  };\r\n}\r\n\r\nfunction calculateSystemMetrics() {\r\n  return {\r\n    timestamp: Date.now(),\r\n    performance: {\r\n      requestsPerSecond: 125.7,\r\n      averageResponseTime: 89.3,\r\n      throughput: 1024 * 1024 * 2.5, // 2.5 MB/s\r\n      errorRate: 0.12,\r\n    },\r\n    resources: {\r\n      memoryUsage: 68.2,\r\n      cpuUsage: 24.1,\r\n      activeConnections: 145,\r\n      diskUsage: 45.8,\r\n      networkIO: {\r\n        bytesIn: 1024 * 1024 * 16.2,\r\n        bytesOut: 1024 * 1024 * 29.1,\r\n        packetsIn: 12890,\r\n        packetsOut: 10234,\r\n      },\r\n    },\r\n    connections: {\r\n      activeWebSockets: 67,\r\n      totalConnections: 145,\r\n      connectionRate: 12.3,\r\n      subscriptionCount: 89,\r\n    },\r\n  };\r\n}\r\n\r\nfunction matchesSubscriptionFilter(verification, filter) {\r\n  if (filter.sources && !filter.sources.includes(verification.source)) return false;\r\n  if (filter.targets && !filter.targets.includes(verification.target)) return false;\r\n  if (filter.statuses && !filter.statuses.includes(verification.status)) return false;\r\n  if (filter.priorities && !filter.priorities.includes(verification.priority)) return false;\r\n  if (filter.confidenceThreshold && verification.confidence < filter.confidenceThreshold) return false;\r\n  return true;\r\n}\r\n\r\nfunction matchesTruthMonitoringFilter(event, filter) {\r\n  if (filter.eventTypes && !filter.eventTypes.includes(event.type)) return false;\r\n  if (filter.severityLevels && !filter.severityLevels.includes(event.severity)) return false;\r\n  if (filter.sources && !filter.sources.includes(event.source)) return false;\r\n  if (filter.targets && !filter.targets.includes(event.target)) return false;\r\n  if (filter.confidenceMin !== undefined && event.confidence < filter.confidenceMin) return false;\r\n  if (filter.confidenceMax !== undefined && event.confidence > filter.confidenceMax) return false;\r\n  return true;\r\n}\r\n\r\nfunction logEvent(eventData) {\r\n  const event = {\r\n    id: nanoid(),\r\n    timestamp: Date.now(),\r\n    severity: 'MEDIUM',\r\n    ...eventData,\r\n  };\r\n  \r\n  dataStore.events.push(event);\r\n  \r\n  // Keep only last 1000 events\r\n  if (dataStore.events.length > 1000) {\r\n    dataStore.events = dataStore.events.slice(-1000);\r\n  }\r\n}\r\n\r\nmodule.exports = resolvers;\r\n"],"names":["GraphQLScalarType","GraphQLError","require","Kind","nanoid","dataStore","verifications","Map","batches","events","rules","agentConfigs","metrics","startTime","Date","now","totalVerifications","successfulVerifications","failedVerifications","pendingVerifications","DateTimeScalar","name","description","serialize","value","toISOString","parseValue","getTime","parseLiteral","ast","kind","STRING","JSONScalar","BOOLEAN","INT","FLOAT","parseFloat","OBJECT","parseObject","LIST","values","map","Object","create","fields","forEach","field","resolvers","DateTime","JSON","Query","verification","parent","args","context","get","id","extensions","code","filter","pagination","sort","Array","from","applyVerificationFilters","applySorting","edges","pageInfo","totalCount","applyPagination","item","node","cursor","Buffer","toString","batch","applyBatchFilters","verificationMetrics","timeframe","groupBy","calculateVerificationMetrics","truthEvents","applyTruthEventFilters","a","b","timestamp","systemHealth","calculateSystemHealth","systemMetrics","calculateSystemMetrics","verificationRules","Mutation","createVerification","input","processVerification","success","error","message","createBatchVerification","createVerificationBatch","processBatch","updateVerification","Error","assign","updatedAt","cancelVerification","status","completedAt","createVerificationRule","rule","createdAt","executionCount","successCount","set","updateVerificationRule","deleteVerificationRule","exists","has","delete","deletedId","updateAgentConfig","config","agentId","verificationEnabled","confidenceThreshold","autoVerify","rateLimit","requestsPerMinute","burstCapacity","currentUsage","resetTime","totalRequests","successfulRequests","Subscription","verificationUpdates","subscribe","v","matchesSubscriptionFilter","Promise","resolve","setTimeout","truthMonitoring","recentEvents","e","matchesTruthMonitoringFilter","event","systemAlerts","severityFilter","severity","Math","random","alert","type","floor","length","data","source","acknowledged","metricsUpdates","interval","Verification","batchId","verificationId","appliedRules","appliedRuleIds","Boolean","VerificationBatch","progress","totalItems","completedItems","successRate","results","successful","r","averageConfidence","sum","reduce","acc","confidence","TruthMonitoringEvent","target","metadata","priority","timeout","logEvent","created","items","push","ids","includes","sources","targets","statuses","priorities","hasError","undefined","confidenceRange","min","max","timestampRange","start","end","itemCountRange","types","severities","sortInputs","direction","aValue","toLowerCase","bValue","first","after","last","before","startIndex","endIndex","afterId","afterIndex","findIndex","beforeId","beforeIndex","slice","hasNextPage","hasPreviousPage","startCursor","endCursor","timeframePeriods","ONE_HOUR","TWENTY_FOUR_HOURS","SEVEN_DAYS","THIRTY_DAYS","period","cutoff","total","failed","pending","avgConfidence","verificationRate","responseTime","avg","p50","p95","p99","trends","calculateTrends","distribution","calculateDistribution","timeSeries","generateTimeSeries","metric","change","significance","statusCounts","sourceCounts","priorityCounts","byStatus","entries","count","percentage","bySource","sourceVerifications","byPriority","averageResponseTime","byConfidence","range","points","intervals","intervalCount","intervalSize","i","services","api","lastCheck","errorCount","uptime","websocket","graphql","database","cache","memoryUsage","cpuUsage","activeConnections","diskUsage","networkIO","bytesIn","bytesOut","packetsIn","packetsOut","errorRate","performance","requestsPerSecond","throughput","resources","connections","activeWebSockets","totalConnections","connectionRate","subscriptionCount","eventTypes","severityLevels","confidenceMin","confidenceMax","eventData","module","exports"],"mappings":"AAKA,MAAM,EAAEA,iBAAiB,EAAEC,YAAY,EAAE,GAAGC,QAAQ;AACpD,MAAM,EAAEC,IAAI,EAAE,GAAGD,QAAQ;AACzB,MAAM,EAAEE,MAAM,EAAE,GAAGF,QAAQ;AAG3B,IAAIG,YAAY;IACdC,eAAe,IAAIC;IACnBC,SAAS,IAAID;IACbE,QAAQ,EAAE;IACVC,OAAO,IAAIH;IACXI,cAAc,IAAIJ;IAClBK,SAAS;QACPC,WAAWC,KAAKC,GAAG;QACnBC,oBAAoB;QACpBC,yBAAyB;QACzBC,qBAAqB;QACrBC,sBAAsB;IACxB;AACF;AAGA,MAAMC,iBAAiB,IAAIpB,kBAAkB;IAC3CqB,MAAM;IACNC,aAAa;IACbC,WAAUC,KAAK;QACb,OAAO,IAAIV,KAAKU,OAAOC,WAAW;IACpC;IACAC,YAAWF,KAAK;QACd,OAAO,IAAIV,KAAKU,OAAOG,OAAO;IAChC;IACAC,cAAaC,GAAG;QACd,IAAIA,IAAIC,IAAI,KAAK3B,KAAK4B,MAAM,EAAE;YAC5B,OAAO,IAAIjB,KAAKe,IAAIL,KAAK,EAAEG,OAAO;QACpC;QACA,OAAO;IACT;AACF;AAEA,MAAMK,aAAa,IAAIhC,kBAAkB;IACvCqB,MAAM;IACNC,aAAa;IACbC,WAAUC,KAAK;QACb,OAAOA;IACT;IACAE,YAAWF,KAAK;QACd,OAAOA;IACT;IACAI,cAAaC,GAAG;QACd,OAAQA,IAAIC,IAAI;YACd,KAAK3B,KAAK4B,MAAM;YAChB,KAAK5B,KAAK8B,OAAO;gBACf,OAAOJ,IAAIL,KAAK;YAClB,KAAKrB,KAAK+B,GAAG;YACb,KAAK/B,KAAKgC,KAAK;gBACb,OAAOC,WAAWP,IAAIL,KAAK;YAC7B,KAAKrB,KAAKkC,MAAM;gBACd,OAAOC,YAAYT;YACrB,KAAK1B,KAAKoC,IAAI;gBACZ,OAAOV,IAAIW,MAAM,CAACC,GAAG,CAACjB,CAAAA,QAASE,WAAWF;YAC5C;gBACE,OAAO;QACX;IACF;AACF;AAEA,SAASc,YAAYT,GAAG;IACtB,MAAML,QAAQkB,OAAOC,MAAM,CAAC;IAC5Bd,IAAIe,MAAM,CAACC,OAAO,CAACC,CAAAA;QACjBtB,KAAK,CAACsB,MAAMzB,IAAI,CAACG,KAAK,CAAC,GAAGE,WAAWoB,MAAMtB,KAAK;IAClD;IACA,OAAOA;AACT;AAEA,SAASE,WAAWG,GAAG;IACrB,OAAQA,IAAIC,IAAI;QACd,KAAK3B,KAAK4B,MAAM;QAChB,KAAK5B,KAAK8B,OAAO;YACf,OAAOJ,IAAIL,KAAK;QAClB,KAAKrB,KAAK+B,GAAG;QACb,KAAK/B,KAAKgC,KAAK;YACb,OAAOC,WAAWP,IAAIL,KAAK;QAC7B,KAAKrB,KAAKkC,MAAM;YACd,OAAOC,YAAYT;QACrB,KAAK1B,KAAKoC,IAAI;YACZ,OAAOV,IAAIW,MAAM,CAACC,GAAG,CAACjB,CAAAA,QAASE,WAAWF;QAC5C;YACE,OAAO;IACX;AACF;AAGA,MAAMuB,YAAY;IAChBC,UAAU5B;IACV6B,MAAMjB;IAENkB,OAAO;QACLC,cAAc,OAAOC,QAAQC,MAAMC;YACjC,MAAMH,eAAe9C,UAAUC,aAAa,CAACiD,GAAG,CAACF,KAAKG,EAAE;YACxD,IAAI,CAACL,cAAc;gBACjB,MAAM,IAAIlD,aAAa,CAAC,aAAa,EAAEoD,KAAKG,EAAE,CAAC,UAAU,CAAC,EAAE;oBAC1DC,YAAY;wBAAEC,MAAM;oBAAyB;gBAC/C;YACF;YACA,OAAOP;QACT;QAEA7C,eAAe,OAAO8C,QAAQC,MAAMC;YAClC,MAAM,EAAEK,SAAS,CAAC,CAAC,EAAEC,aAAa,CAAC,CAAC,EAAEC,OAAO,EAAE,EAAE,GAAGR;YAEpD,IAAI/C,gBAAgBwD,MAAMC,IAAI,CAAC1D,UAAUC,aAAa,CAACkC,MAAM;YAG7DlC,gBAAgB0D,yBAAyB1D,eAAeqD;YAGxDrD,gBAAgB2D,aAAa3D,eAAeuD;YAG5C,MAAM,EAAEK,KAAK,EAAEC,QAAQ,EAAEC,UAAU,EAAE,GAAGC,gBAAgB/D,eAAesD;YAEvE,OAAO;gBACLM,OAAOA,MAAMzB,GAAG,CAAC6B,CAAAA,OAAS,CAAA;wBACxBC,MAAMD;wBACNE,QAAQC,OAAOV,IAAI,CAACO,KAAKd,EAAE,EAAEkB,QAAQ,CAAC;oBACxC,CAAA;gBACAP;gBACAC;YACF;QACF;QAEAO,OAAO,OAAOvB,QAAQC,MAAMC;YAC1B,MAAMqB,QAAQtE,UAAUG,OAAO,CAAC+C,GAAG,CAACF,KAAKG,EAAE;YAC3C,IAAI,CAACmB,OAAO;gBACV,MAAM,IAAI1E,aAAa,CAAC,MAAM,EAAEoD,KAAKG,EAAE,CAAC,UAAU,CAAC,EAAE;oBACnDC,YAAY;wBAAEC,MAAM;oBAAkB;gBACxC;YACF;YACA,OAAOiB;QACT;QAEAnE,SAAS,OAAO4C,QAAQC,MAAMC;YAC5B,MAAM,EAAEK,SAAS,CAAC,CAAC,EAAEC,aAAa,CAAC,CAAC,EAAE,GAAGP;YAEzC,IAAI7C,UAAUsD,MAAMC,IAAI,CAAC1D,UAAUG,OAAO,CAACgC,MAAM;YAGjDhC,UAAUoE,kBAAkBpE,SAASmD;YAGrC,MAAM,EAAEO,KAAK,EAAEC,QAAQ,EAAEC,UAAU,EAAE,GAAGC,gBAAgB7D,SAASoD;YAEjE,OAAO;gBACLM,OAAOA,MAAMzB,GAAG,CAAC6B,CAAAA,OAAS,CAAA;wBACxBC,MAAMD;wBACNE,QAAQC,OAAOV,IAAI,CAACO,KAAKd,EAAE,EAAEkB,QAAQ,CAAC;oBACxC,CAAA;gBACAP;gBACAC;YACF;QACF;QAEAS,qBAAqB,OAAOzB,QAAQC,MAAMC;YACxC,MAAM,EAAEwB,YAAY,mBAAmB,EAAEC,UAAU,EAAE,EAAE,GAAG1B;YAC1D,OAAO2B,6BAA6BF,WAAWC;QACjD;QAEAE,aAAa,OAAO7B,QAAQC,MAAMC;YAChC,MAAM,EAAEK,SAAS,CAAC,CAAC,EAAEC,aAAa,CAAC,CAAC,EAAE,GAAGP;YAEzC,IAAI5C,SAAS;mBAAIJ,UAAUI,MAAM;aAAC;YAGlCA,SAASyE,uBAAuBzE,QAAQkD;YAGxClD,OAAOoD,IAAI,CAAC,CAACsB,GAAGC,IAAMA,EAAEC,SAAS,GAAGF,EAAEE,SAAS;YAG/C,MAAM,EAAEnB,KAAK,EAAEC,QAAQ,EAAEC,UAAU,EAAE,GAAGC,gBAAgB5D,QAAQmD;YAEhE,OAAO;gBACLM,OAAOA,MAAMzB,GAAG,CAAC6B,CAAAA,OAAS,CAAA;wBACxBC,MAAMD;wBACNE,QAAQC,OAAOV,IAAI,CAACO,KAAKd,EAAE,EAAEkB,QAAQ,CAAC;oBACxC,CAAA;gBACAP;gBACAC;YACF;QACF;QAEAkB,cAAc,OAAOlC,QAAQC,MAAMC;YACjC,OAAOiC;QACT;QAEAC,eAAe,OAAOpC,QAAQC,MAAMC;YAClC,OAAOmC;QACT;QAEAC,mBAAmB,OAAOtC,QAAQC,MAAMC;YACtC,OAAOQ,MAAMC,IAAI,CAAC1D,UAAUK,KAAK,CAAC8B,MAAM;QAC1C;QAEA7B,cAAc,OAAOyC,QAAQC,MAAMC;YACjC,OAAOQ,MAAMC,IAAI,CAAC1D,UAAUM,YAAY,CAAC6B,MAAM;QACjD;IACF;IAEAmD,UAAU;QACRC,oBAAoB,OAAOxC,QAAQC,MAAMC;YACvC,IAAI;gBACF,MAAMH,eAAeyC,mBAAmBvC,KAAKwC,KAAK;gBAGlDC,oBAAoB3C,aAAaK,EAAE;gBAEnC,OAAO;oBACLuC,SAAS;oBACT5C;gBACF;YACF,EAAE,OAAO6C,OAAO;gBACd,OAAO;oBACLD,SAAS;oBACTC,OAAOA,MAAMC,OAAO;gBACtB;YACF;QACF;QAEAC,yBAAyB,OAAO9C,QAAQC,MAAMC;YAC5C,IAAI;gBACF,MAAMqB,QAAQwB,wBAAwB9C,KAAKwC,KAAK;gBAGhDO,aAAazB,MAAMnB,EAAE;gBAErB,OAAO;oBACLuC,SAAS;oBACTpB;gBACF;YACF,EAAE,OAAOqB,OAAO;gBACd,OAAO;oBACLD,SAAS;oBACTC,OAAOA,MAAMC,OAAO;gBACtB;YACF;QACF;QAEAI,oBAAoB,OAAOjD,QAAQC,MAAMC;YACvC,IAAI;gBACF,MAAMH,eAAe9C,UAAUC,aAAa,CAACiD,GAAG,CAACF,KAAKG,EAAE;gBACxD,IAAI,CAACL,cAAc;oBACjB,MAAM,IAAImD,MAAM,CAAC,aAAa,EAAEjD,KAAKG,EAAE,CAAC,UAAU,CAAC;gBACrD;gBAEAd,OAAO6D,MAAM,CAACpD,cAAcE,KAAKwC,KAAK,EAAE;oBACtCW,WAAW1F,KAAKC,GAAG;gBACrB;gBAEA,OAAO;oBACLgF,SAAS;oBACT5C;gBACF;YACF,EAAE,OAAO6C,OAAO;gBACd,OAAO;oBACLD,SAAS;oBACTC,OAAOA,MAAMC,OAAO;gBACtB;YACF;QACF;QAEAQ,oBAAoB,OAAOrD,QAAQC,MAAMC;YACvC,IAAI;gBACF,MAAMH,eAAe9C,UAAUC,aAAa,CAACiD,GAAG,CAACF,KAAKG,EAAE;gBACxD,IAAI,CAACL,cAAc;oBACjB,MAAM,IAAImD,MAAM,CAAC,aAAa,EAAEjD,KAAKG,EAAE,CAAC,UAAU,CAAC;gBACrD;gBAEA,IAAIL,aAAauD,MAAM,KAAK,WAAW;oBACrC,MAAM,IAAIJ,MAAM;gBAClB;gBAEAnD,aAAauD,MAAM,GAAG;gBACtBvD,aAAaqD,SAAS,GAAG1F,KAAKC,GAAG;gBACjCoC,aAAawD,WAAW,GAAG7F,KAAKC,GAAG;gBAEnC,OAAO;oBACLgF,SAAS;oBACT5C;gBACF;YACF,EAAE,OAAO6C,OAAO;gBACd,OAAO;oBACLD,SAAS;oBACTC,OAAOA,MAAMC,OAAO;gBACtB;YACF;QACF;QAEAW,wBAAwB,OAAOxD,QAAQC,MAAMC;YAC3C,IAAI;gBACF,MAAMuD,OAAO;oBACXrD,IAAIpD;oBACJ,GAAGiD,KAAKwC,KAAK;oBACbiB,WAAWhG,KAAKC,GAAG;oBACnByF,WAAW1F,KAAKC,GAAG;oBACnBgG,gBAAgB;oBAChBC,cAAc;gBAChB;gBAEA3G,UAAUK,KAAK,CAACuG,GAAG,CAACJ,KAAKrD,EAAE,EAAEqD;gBAE7B,OAAO;oBACLd,SAAS;oBACTc;gBACF;YACF,EAAE,OAAOb,OAAO;gBACd,OAAO;oBACLD,SAAS;oBACTC,OAAOA,MAAMC,OAAO;gBACtB;YACF;QACF;QAEAiB,wBAAwB,OAAO9D,QAAQC,MAAMC;YAC3C,IAAI;gBACF,MAAMuD,OAAOxG,UAAUK,KAAK,CAAC6C,GAAG,CAACF,KAAKG,EAAE;gBACxC,IAAI,CAACqD,MAAM;oBACT,MAAM,IAAIP,MAAM,CAAC,KAAK,EAAEjD,KAAKG,EAAE,CAAC,UAAU,CAAC;gBAC7C;gBAEAd,OAAO6D,MAAM,CAACM,MAAMxD,KAAKwC,KAAK,EAAE;oBAC9BW,WAAW1F,KAAKC,GAAG;gBACrB;gBAEA,OAAO;oBACLgF,SAAS;oBACTc;gBACF;YACF,EAAE,OAAOb,OAAO;gBACd,OAAO;oBACLD,SAAS;oBACTC,OAAOA,MAAMC,OAAO;gBACtB;YACF;QACF;QAEAkB,wBAAwB,OAAO/D,QAAQC,MAAMC;YAC3C,IAAI;gBACF,MAAM8D,SAAS/G,UAAUK,KAAK,CAAC2G,GAAG,CAAChE,KAAKG,EAAE;gBAC1C,IAAI,CAAC4D,QAAQ;oBACX,MAAM,IAAId,MAAM,CAAC,KAAK,EAAEjD,KAAKG,EAAE,CAAC,UAAU,CAAC;gBAC7C;gBAEAnD,UAAUK,KAAK,CAAC4G,MAAM,CAACjE,KAAKG,EAAE;gBAE9B,OAAO;oBACLuC,SAAS;oBACTwB,WAAWlE,KAAKG,EAAE;gBACpB;YACF,EAAE,OAAOwC,OAAO;gBACd,OAAO;oBACLD,SAAS;oBACTC,OAAOA,MAAMC,OAAO;gBACtB;YACF;QACF;QAEAuB,mBAAmB,OAAOpE,QAAQC,MAAMC;YACtC,IAAI;gBACF,IAAImE,SAASpH,UAAUM,YAAY,CAAC4C,GAAG,CAACF,KAAKqE,OAAO;gBAEpD,IAAI,CAACD,QAAQ;oBACXA,SAAS;wBACPC,SAASrE,KAAKqE,OAAO;wBACrBC,qBAAqB;wBACrBC,qBAAqB;wBACrBC,YAAY;wBACZC,WAAW;4BACTC,mBAAmB;4BACnBC,eAAe;4BACfC,cAAc;4BACdC,WAAWpH,KAAKC,GAAG,KAAK;wBAC1B;wBACAoH,eAAe;wBACfC,oBAAoB;oBACtB;gBACF;gBAEA1F,OAAO6D,MAAM,CAACkB,QAAQpE,KAAKwC,KAAK;gBAChCxF,UAAUM,YAAY,CAACsG,GAAG,CAAC5D,KAAKqE,OAAO,EAAED;gBAEzC,OAAO;oBACL1B,SAAS;oBACT0B;gBACF;YACF,EAAE,OAAOzB,OAAO;gBACd,OAAO;oBACLD,SAAS;oBACTC,OAAOA,MAAMC,OAAO;gBACtB;YACF;QACF;IACF;IAEAoC,cAAc;QACZC,qBAAqB;YACnBC,WAAW,gBAAiBnF,MAAM,EAAEC,IAAI,EAAEC,OAAO;gBAG/C,MAAMK,SAASN,KAAKM,MAAM,IAAI,CAAC;gBAE/B,MAAO,KAAM;oBAEX,MAAMrD,gBAAgBwD,MAAMC,IAAI,CAAC1D,UAAUC,aAAa,CAACkC,MAAM,IAC5DmB,MAAM,CAAC6E,CAAAA,IAAKC,0BAA0BD,GAAG7E,SACzCA,MAAM,CAAC6E,CAAAA,IAAKA,EAAEhC,SAAS,GAAI1F,KAAKC,GAAG,KAAK;oBAE3C,KAAK,MAAMoC,gBAAgB7C,cAAe;wBACxC,MAAM;4BAAEgI,qBAAqBnF;wBAAa;oBAC5C;oBAEA,MAAM,IAAIuF,QAAQC,CAAAA,UAAWC,WAAWD,SAAS;gBACnD;YACF;QACF;QAEAE,iBAAiB;YACfN,WAAW,gBAAiBnF,MAAM,EAAEC,IAAI,EAAEC,OAAO;gBAC/C,MAAMK,SAASN,KAAKM,MAAM,IAAI,CAAC;gBAE/B,MAAO,KAAM;oBAEX,MAAMmF,eAAezI,UAAUI,MAAM,CAClCkD,MAAM,CAACoF,CAAAA,IAAKA,EAAE1D,SAAS,GAAIvE,KAAKC,GAAG,KAAK,MACxC4C,MAAM,CAACoF,CAAAA,IAAKC,6BAA6BD,GAAGpF;oBAE/C,KAAK,MAAMsF,SAASH,aAAc;wBAChC,MAAM;4BAAED,iBAAiBI;wBAAM;oBACjC;oBAEA,MAAM,IAAIP,QAAQC,CAAAA,UAAWC,WAAWD,SAAS;gBACnD;YACF;QACF;QAEAO,cAAc;YACZX,WAAW,gBAAiBnF,MAAM,EAAEC,IAAI,EAAEC,OAAO;gBAC/C,MAAM6F,iBAAiB9F,KAAK+F,QAAQ,IAAI;oBAAC;oBAAQ;iBAAW;gBAE5D,MAAO,KAAM;oBAEX,IAAIC,KAAKC,MAAM,KAAK,KAAK;wBACvB,MAAMC,QAAQ;4BACZ/F,IAAIpD;4BACJoJ,MAAM;4BACNJ,UAAUD,cAAc,CAACE,KAAKI,KAAK,CAACJ,KAAKC,MAAM,KAAKH,eAAeO,MAAM,EAAE;4BAC3EzD,SAAS;4BACTZ,WAAWvE,KAAKC,GAAG;4BACnB4I,MAAM;gCAAEC,QAAQ;4BAAa;4BAC7BC,cAAc;wBAChB;wBAEA,MAAM;4BAAEX,cAAcK;wBAAM;oBAC9B;oBAEA,MAAM,IAAIb,QAAQC,CAAAA,UAAWC,WAAWD,SAAS;gBACnD;YACF;QACF;QAEAmB,gBAAgB;YACdvB,WAAW,gBAAiBnF,MAAM,EAAEC,IAAI,EAAEC,OAAO;gBAC/C,MAAMyG,WAAW,AAAC1G,CAAAA,KAAK0G,QAAQ,IAAI,EAAC,IAAK;gBAEzC,MAAO,KAAM;oBACX,MAAMnJ,UAAUoE,6BAA6B,qBAAqB,EAAE;oBACpE,MAAM;wBAAE8E,gBAAgBlJ;oBAAQ;oBAEhC,MAAM,IAAI8H,QAAQC,CAAAA,UAAWC,WAAWD,SAASoB;gBACnD;YACF;QACF;IACF;IAGAC,cAAc;QACZrF,OAAO,CAACvB;YACN,OAAOA,OAAO6G,OAAO,GAAG5J,UAAUG,OAAO,CAAC+C,GAAG,CAACH,OAAO6G,OAAO,IAAI;QAClE;QAEAxJ,QAAQ,CAAC2C;YACP,OAAO/C,UAAUI,MAAM,CAACkD,MAAM,CAACoF,CAAAA,IAAKA,EAAEmB,cAAc,KAAK9G,OAAOI,EAAE;QACpE;QAEA2G,cAAc,CAAC/G;YACb,OAAOA,OAAOgH,cAAc,GAC1BhH,OAAOgH,cAAc,CAAC3H,GAAG,CAACe,CAAAA,KAAMnD,UAAUK,KAAK,CAAC6C,GAAG,CAACC,KAAKG,MAAM,CAAC0G,WAChE,EAAE;QACN;IACF;IAEAC,mBAAmB;QACjBC,UAAU,CAACnH;YACT,OAAOA,OAAOoH,UAAU,GAAG,IAAIpH,OAAOqH,cAAc,GAAGrH,OAAOoH,UAAU,GAAG;QAC7E;QAEAE,aAAa,CAACtH;YACZ,IAAI,CAACA,OAAOuH,OAAO,IAAIvH,OAAOuH,OAAO,CAACjB,MAAM,KAAK,GAAG,OAAO;YAC3D,MAAMkB,aAAaxH,OAAOuH,OAAO,CAAChH,MAAM,CAACkH,CAAAA,IAAKA,EAAEnE,MAAM,KAAK,YAAYgD,MAAM;YAC7E,OAAOkB,aAAaxH,OAAOuH,OAAO,CAACjB,MAAM;QAC3C;QAEAoB,mBAAmB,CAAC1H;YAClB,IAAI,CAACA,OAAOuH,OAAO,IAAIvH,OAAOuH,OAAO,CAACjB,MAAM,KAAK,GAAG,OAAO;YAC3D,MAAMqB,MAAM3H,OAAOuH,OAAO,CAACK,MAAM,CAAC,CAACC,KAAKJ,IAAMI,MAAMJ,EAAEK,UAAU,EAAE;YAClE,OAAOH,MAAM3H,OAAOuH,OAAO,CAACjB,MAAM;QACpC;IACF;IAEAyB,sBAAsB;QACpBhI,cAAc,CAACC;YACb,OAAOA,OAAO8G,cAAc,GAAG7J,UAAUC,aAAa,CAACiD,GAAG,CAACH,OAAO8G,cAAc,IAAI;QACtF;IACF;AACF;AAIA,SAAStE,mBAAmBC,KAAK;IAC/B,MAAMrC,KAAKpD;IACX,MAAM+C,eAAe;QACnBK;QACA6B,WAAWvE,KAAKC,GAAG;QACnB2F,QAAQ;QACRwE,YAAY;QACZtB,QAAQ/D,MAAM+D,MAAM;QACpBwB,QAAQvF,MAAMuF,MAAM;QACpBC,UAAUxF,MAAMwF,QAAQ,IAAI,CAAC;QAC7BC,UAAUzF,MAAMyF,QAAQ,IAAI;QAC5BC,SAAS1F,MAAM0F,OAAO,IAAI;QAC1BzE,WAAWhG,KAAKC,GAAG;IACrB;IAEAV,UAAUC,aAAa,CAAC2G,GAAG,CAACzD,IAAIL;IAChC9C,UAAUO,OAAO,CAACI,kBAAkB;IACpCX,UAAUO,OAAO,CAACO,oBAAoB;IAGtCqK,SAAS;QACPhC,MAAM;QACNU,gBAAgB1G;QAChBmG,MAAM;YAAE8B,SAAS;QAAK;QACtB7B,QAAQ/D,MAAM+D,MAAM;QACpBsB,YAAY;IACd;IAEA,OAAO/H;AACT;AAEA,SAASgD,wBAAwBN,KAAK;IACpC,MAAMrC,KAAKpD;IACX,MAAMuE,QAAQ;QACZnB;QACAkD,QAAQ;QACRI,WAAWhG,KAAKC,GAAG;QACnByJ,YAAY3E,MAAM6F,KAAK,CAAChC,MAAM;QAC9Be,gBAAgB;QAChBiB,OAAO7F,MAAM6F,KAAK,CAACjJ,GAAG,CAAC6B,CAAAA,OAAQsB,mBAAmBtB;QAClDqG,SAAS,EAAE;IACb;IAGAhG,MAAM+G,KAAK,CAAC7I,OAAO,CAACyB,CAAAA;QAClBA,KAAK2F,OAAO,GAAGzG;IACjB;IAEAnD,UAAUG,OAAO,CAACyG,GAAG,CAACzD,IAAImB;IAE1B,OAAOA;AACT;AAEA,eAAemB,oBAAoBtC,EAAE;IACnC,MAAML,eAAe9C,UAAUC,aAAa,CAACiD,GAAG,CAACC;IACjD,IAAI,CAACL,cAAc;IAEnB,IAAI;QAEF,MAAM,IAAIuF,QAAQC,CAAAA,UAAWC,WAAWD,SAASU,KAAKC,MAAM,KAAK,OAAO;QAGxE,MAAMvD,UAAUsD,KAAKC,MAAM,KAAK;QAChC,MAAM4B,aAAanF,UAAUsD,KAAKC,MAAM,KAAK,MAAM,MAAMD,KAAKC,MAAM,KAAK;QAEzEnG,aAAauD,MAAM,GAAGX,UAAU,aAAa;QAC7C5C,aAAa+H,UAAU,GAAGA;QAC1B/H,aAAawD,WAAW,GAAG7F,KAAKC,GAAG;QACnCoC,aAAaqD,SAAS,GAAG1F,KAAKC,GAAG;QAEjCV,UAAUO,OAAO,CAACO,oBAAoB;QACtC,IAAI4E,SAAS;YACX1F,UAAUO,OAAO,CAACK,uBAAuB;QAC3C,OAAO;YACLZ,UAAUO,OAAO,CAACM,mBAAmB;QACvC;QAGAsK,SAAS;YACPhC,MAAM;YACNU,gBAAgB1G;YAChBmG,MAAM;gBAAEjD,QAAQvD,aAAauD,MAAM;gBAAEwE;YAAW;YAChDtB,QAAQzG,aAAayG,MAAM;YAC3BsB;QACF;IAEF,EAAE,OAAOlF,OAAO;QACd7C,aAAauD,MAAM,GAAG;QACtBvD,aAAa6C,KAAK,GAAGA,MAAMC,OAAO;QAClC9C,aAAawD,WAAW,GAAG7F,KAAKC,GAAG;QACnCoC,aAAaqD,SAAS,GAAG1F,KAAKC,GAAG;QAEjCV,UAAUO,OAAO,CAACO,oBAAoB;QACtCd,UAAUO,OAAO,CAACM,mBAAmB;QAErCsK,SAAS;YACPhC,MAAM;YACNU,gBAAgB1G;YAChBmG,MAAM;gBAAE3D,OAAOA,MAAMC,OAAO;YAAC;YAC7B2D,QAAQzG,aAAayG,MAAM;YAC3BsB,YAAY;QACd;IACF;AACF;AAEA,eAAe9E,aAAa6D,OAAO;IACjC,MAAMtF,QAAQtE,UAAUG,OAAO,CAAC+C,GAAG,CAAC0G;IACpC,IAAI,CAACtF,OAAO;IAEZA,MAAM+B,MAAM,GAAG;IAEf,IAAI;QACF,KAAK,MAAMpC,QAAQK,MAAM+G,KAAK,CAAE;YAC9B,MAAM5F,oBAAoBxB,KAAKd,EAAE;YACjCmB,MAAM8F,cAAc;YACpB9F,MAAMgG,OAAO,CAACgB,IAAI,CAACtL,UAAUC,aAAa,CAACiD,GAAG,CAACe,KAAKd,EAAE;QACxD;QAEAmB,MAAM+B,MAAM,GAAG;QACf/B,MAAMgC,WAAW,GAAG7F,KAAKC,GAAG;IAE9B,EAAE,OAAOiF,OAAO;QACdrB,MAAM+B,MAAM,GAAG;QACf/B,MAAMqB,KAAK,GAAGA,MAAMC,OAAO;QAC3BtB,MAAMgC,WAAW,GAAG7F,KAAKC,GAAG;IAC9B;AACF;AAEA,SAASiD,yBAAyB1D,aAAa,EAAEqD,MAAM;IACrD,OAAOrD,cAAcqD,MAAM,CAAC6E,CAAAA;QAC1B,IAAI7E,OAAOiI,GAAG,IAAI,CAACjI,OAAOiI,GAAG,CAACC,QAAQ,CAACrD,EAAEhF,EAAE,GAAG,OAAO;QACrD,IAAIG,OAAOmI,OAAO,IAAI,CAACnI,OAAOmI,OAAO,CAACD,QAAQ,CAACrD,EAAEoB,MAAM,GAAG,OAAO;QACjE,IAAIjG,OAAOoI,OAAO,IAAI,CAACpI,OAAOoI,OAAO,CAACF,QAAQ,CAACrD,EAAE4C,MAAM,GAAG,OAAO;QACjE,IAAIzH,OAAOqI,QAAQ,IAAI,CAACrI,OAAOqI,QAAQ,CAACH,QAAQ,CAACrD,EAAE9B,MAAM,GAAG,OAAO;QACnE,IAAI/C,OAAOsI,UAAU,IAAI,CAACtI,OAAOsI,UAAU,CAACJ,QAAQ,CAACrD,EAAE8C,QAAQ,GAAG,OAAO;QACzE,IAAI3H,OAAOsG,OAAO,IAAIzB,EAAEyB,OAAO,KAAKtG,OAAOsG,OAAO,EAAE,OAAO;QAC3D,IAAItG,OAAOuI,QAAQ,KAAKC,aAAa,AAAC,CAAC,CAAC3D,EAAExC,KAAK,KAAMrC,OAAOuI,QAAQ,EAAE,OAAO;QAE7E,IAAIvI,OAAOyI,eAAe,EAAE;YAC1B,IAAIzI,OAAOyI,eAAe,CAACC,GAAG,KAAKF,aAAa3D,EAAE0C,UAAU,GAAGvH,OAAOyI,eAAe,CAACC,GAAG,EAAE,OAAO;YAClG,IAAI1I,OAAOyI,eAAe,CAACE,GAAG,KAAKH,aAAa3D,EAAE0C,UAAU,GAAGvH,OAAOyI,eAAe,CAACE,GAAG,EAAE,OAAO;QACpG;QAEA,IAAI3I,OAAO4I,cAAc,EAAE;YACzB,IAAI5I,OAAO4I,cAAc,CAACC,KAAK,IAAIhE,EAAEnD,SAAS,GAAG1B,OAAO4I,cAAc,CAACC,KAAK,EAAE,OAAO;YACrF,IAAI7I,OAAO4I,cAAc,CAACE,GAAG,IAAIjE,EAAEnD,SAAS,GAAG1B,OAAO4I,cAAc,CAACE,GAAG,EAAE,OAAO;QACnF;QAEA,OAAO;IACT;AACF;AAEA,SAAS7H,kBAAkBpE,OAAO,EAAEmD,MAAM;IACxC,OAAOnD,QAAQmD,MAAM,CAACyB,CAAAA;QACpB,IAAIzB,OAAOiI,GAAG,IAAI,CAACjI,OAAOiI,GAAG,CAACC,QAAQ,CAACzG,EAAE5B,EAAE,GAAG,OAAO;QACrD,IAAIG,OAAOqI,QAAQ,IAAI,CAACrI,OAAOqI,QAAQ,CAACH,QAAQ,CAACzG,EAAEsB,MAAM,GAAG,OAAO;QAEnE,IAAI/C,OAAO+I,cAAc,EAAE;YACzB,IAAI/I,OAAO+I,cAAc,CAACL,GAAG,KAAKF,aAAa/G,EAAEoF,UAAU,GAAG7G,OAAO+I,cAAc,CAACL,GAAG,EAAE,OAAO;YAChG,IAAI1I,OAAO+I,cAAc,CAACJ,GAAG,KAAKH,aAAa/G,EAAEoF,UAAU,GAAG7G,OAAO+I,cAAc,CAACJ,GAAG,EAAE,OAAO;QAClG;QAEA,IAAI3I,OAAO4I,cAAc,EAAE;YACzB,IAAI5I,OAAO4I,cAAc,CAACC,KAAK,IAAIpH,EAAE0B,SAAS,GAAGnD,OAAO4I,cAAc,CAACC,KAAK,EAAE,OAAO;YACrF,IAAI7I,OAAO4I,cAAc,CAACE,GAAG,IAAIrH,EAAE0B,SAAS,GAAGnD,OAAO4I,cAAc,CAACE,GAAG,EAAE,OAAO;QACnF;QAEA,OAAO;IACT;AACF;AAEA,SAASvH,uBAAuBzE,MAAM,EAAEkD,MAAM;IAC5C,OAAOlD,OAAOkD,MAAM,CAACoF,CAAAA;QACnB,IAAIpF,OAAOgJ,KAAK,IAAI,CAAChJ,OAAOgJ,KAAK,CAACd,QAAQ,CAAC9C,EAAES,IAAI,GAAG,OAAO;QAC3D,IAAI7F,OAAOiJ,UAAU,IAAI,CAACjJ,OAAOiJ,UAAU,CAACf,QAAQ,CAAC9C,EAAEK,QAAQ,GAAG,OAAO;QACzE,IAAIzF,OAAOmI,OAAO,IAAI,CAACnI,OAAOmI,OAAO,CAACD,QAAQ,CAAC9C,EAAEa,MAAM,GAAG,OAAO;QACjE,IAAIjG,OAAOuG,cAAc,IAAInB,EAAEmB,cAAc,KAAKvG,OAAOuG,cAAc,EAAE,OAAO;QAEhF,IAAIvG,OAAOyI,eAAe,EAAE;YAC1B,IAAIzI,OAAOyI,eAAe,CAACC,GAAG,KAAKF,aAAapD,EAAEmC,UAAU,GAAGvH,OAAOyI,eAAe,CAACC,GAAG,EAAE,OAAO;YAClG,IAAI1I,OAAOyI,eAAe,CAACE,GAAG,KAAKH,aAAapD,EAAEmC,UAAU,GAAGvH,OAAOyI,eAAe,CAACE,GAAG,EAAE,OAAO;QACpG;QAEA,IAAI3I,OAAO4I,cAAc,EAAE;YACzB,IAAI5I,OAAO4I,cAAc,CAACC,KAAK,IAAIzD,EAAE1D,SAAS,GAAG1B,OAAO4I,cAAc,CAACC,KAAK,EAAE,OAAO;YACrF,IAAI7I,OAAO4I,cAAc,CAACE,GAAG,IAAI1D,EAAE1D,SAAS,GAAG1B,OAAO4I,cAAc,CAACE,GAAG,EAAE,OAAO;QACnF;QAEA,OAAO;IACT;AACF;AAEA,SAASxI,aAAayH,KAAK,EAAEmB,UAAU;IACrC,IAAI,CAACA,cAAcA,WAAWnD,MAAM,KAAK,GAAG;QAC1C,OAAOgC,MAAM7H,IAAI,CAAC,CAACsB,GAAGC,IAAMA,EAAEC,SAAS,GAAGF,EAAEE,SAAS;IACvD;IAEA,OAAOqG,MAAM7H,IAAI,CAAC,CAACsB,GAAGC;QACpB,KAAK,MAAMvB,QAAQgJ,WAAY;YAC7B,MAAM,EAAE/J,KAAK,EAAEgK,SAAS,EAAE,GAAGjJ;YAC7B,IAAIkJ,SAAS5H,CAAC,CAACrC,MAAMkK,WAAW,GAAG;YACnC,IAAIC,SAAS7H,CAAC,CAACtC,MAAMkK,WAAW,GAAG;YAEnC,IAAID,SAASE,QAAQ,OAAOH,cAAc,QAAQ,CAAC,IAAI;YACvD,IAAIC,SAASE,QAAQ,OAAOH,cAAc,QAAQ,IAAI,CAAC;QACzD;QACA,OAAO;IACT;AACF;AAEA,SAASzI,gBAAgBqH,KAAK,EAAE9H,UAAU;IACxC,MAAM,EAAEsJ,KAAK,EAAEC,KAAK,EAAEC,IAAI,EAAEC,MAAM,EAAE,GAAGzJ;IAEvC,IAAI0J,aAAa;IACjB,IAAIC,WAAW7B,MAAMhC,MAAM;IAE3B,IAAIyD,OAAO;QACT,MAAMK,UAAU/I,OAAOV,IAAI,CAACoJ,OAAO,UAAUzI,QAAQ;QACrD,MAAM+I,aAAa/B,MAAMgC,SAAS,CAACpJ,CAAAA,OAAQA,KAAKd,EAAE,KAAKgK;QACvD,IAAIC,eAAe,CAAC,GAAGH,aAAaG,aAAa;IACnD;IAEA,IAAIJ,QAAQ;QACV,MAAMM,WAAWlJ,OAAOV,IAAI,CAACsJ,QAAQ,UAAU3I,QAAQ;QACvD,MAAMkJ,cAAclC,MAAMgC,SAAS,CAACpJ,CAAAA,OAAQA,KAAKd,EAAE,KAAKmK;QACxD,IAAIC,gBAAgB,CAAC,GAAGL,WAAWK;IACrC;IAEA,IAAIV,OAAO;QACTK,WAAWlE,KAAKgD,GAAG,CAACiB,aAAaJ,OAAOK;IAC1C;IAEA,IAAIH,MAAM;QACRE,aAAajE,KAAKiD,GAAG,CAACiB,WAAWH,MAAME;IACzC;IAEA,MAAMpJ,QAAQwH,MAAMmC,KAAK,CAACP,YAAYC;IAEtC,OAAO;QACLrJ;QACAC,UAAU;YACR2J,aAAaP,WAAW7B,MAAMhC,MAAM;YACpCqE,iBAAiBT,aAAa;YAC9BU,aAAa9J,MAAMwF,MAAM,GAAG,IAAIjF,OAAOV,IAAI,CAACG,KAAK,CAAC,EAAE,CAACV,EAAE,EAAEkB,QAAQ,CAAC,YAAY;YAC9EuJ,WAAW/J,MAAMwF,MAAM,GAAG,IAAIjF,OAAOV,IAAI,CAACG,KAAK,CAACA,MAAMwF,MAAM,GAAG,EAAE,CAAClG,EAAE,EAAEkB,QAAQ,CAAC,YAAY;QAC7F;QACAN,YAAYsH,MAAMhC,MAAM;IAC1B;AACF;AAEA,SAAS1E,6BAA6BF,SAAS,EAAEC,OAAO;IACtD,MAAMhE,MAAMD,KAAKC,GAAG;IACpB,MAAMmN,mBAAmB;QACvBC,UAAU,KAAK,KAAK;QACpBC,mBAAmB,KAAK,KAAK,KAAK;QAClCC,YAAY,IAAI,KAAK,KAAK,KAAK;QAC/BC,aAAa,KAAK,KAAK,KAAK,KAAK;IACnC;IAEA,MAAMC,SAASL,gBAAgB,CAACpJ,UAAU,IAAIoJ,iBAAiBE,iBAAiB;IAChF,MAAMI,SAASzN,MAAMwN;IAErB,MAAMjO,gBAAgBwD,MAAMC,IAAI,CAAC1D,UAAUC,aAAa,CAACkC,MAAM,IAC5DmB,MAAM,CAAC6E,CAAAA,IAAKA,EAAEnD,SAAS,IAAImJ;IAE9B,MAAMC,QAAQnO,cAAcoJ,MAAM;IAClC,MAAMkB,aAAatK,cAAcqD,MAAM,CAAC6E,CAAAA,IAAKA,EAAE9B,MAAM,KAAK,YAAYgD,MAAM;IAC5E,MAAMgF,SAASpO,cAAcqD,MAAM,CAAC6E,CAAAA,IAAKA,EAAE9B,MAAM,KAAK,UAAUgD,MAAM;IACtE,MAAMiF,UAAUrO,cAAcqD,MAAM,CAAC6E,CAAAA,IAAKA,EAAE9B,MAAM,KAAK,WAAWgD,MAAM;IAExE,MAAMkF,gBAAgBtO,cAAcoJ,MAAM,GAAG,IAC3CpJ,cAAc0K,MAAM,CAAC,CAACD,KAAKvC,IAAMuC,MAAMvC,EAAE0C,UAAU,EAAE,KAAK5K,cAAcoJ,MAAM,GAAG;IAEnF,OAAO;QACL5E;QACA9D,oBAAoByN;QACpBxN,yBAAyB2J;QACzB1J,qBAAqBwN;QACrBvN,sBAAsBwN;QACtBjE,aAAa+D,QAAQ,IAAI,AAAC7D,aAAa6D,QAAS,MAAM;QACtDI,kBAAkBJ,QAASF,CAAAA,SAAS,OAAO,IAAG;QAC9CzD,mBAAmB8D;QACnBE,cAAc;YACZC,KAAK;YACLC,KAAK;YACLC,KAAK;YACLC,KAAK;YACL7C,KAAK;YACLC,KAAK;QACP;QACA6C,QAAQC,gBAAgB9O;QACxB+O,cAAcC,sBAAsBhP;QACpCiP,YAAYC,mBAAmBlP,eAAewE;IAChD;AACF;AAEA,SAASsK,gBAAgB9O,aAAa;IAEpC,OAAO;QACL;YACEmP,QAAQ;YACR3C,WAAW;YACX4C,QAAQ;YACRC,cAAc;QAChB;QACA;YACEF,QAAQ;YACR3C,WAAW;YACX4C,QAAQ;YACRC,cAAc;QAChB;KACD;AACH;AAEA,SAASL,sBAAsBhP,aAAa;IAC1C,MAAMsP,eAAe,CAAC;IACtB,MAAMC,eAAe,CAAC;IACtB,MAAMC,iBAAiB,CAAC;IAExBxP,cAAcuC,OAAO,CAAC2F,CAAAA;QACpBoH,YAAY,CAACpH,EAAE9B,MAAM,CAAC,GAAG,AAACkJ,CAAAA,YAAY,CAACpH,EAAE9B,MAAM,CAAC,IAAI,CAAA,IAAK;QACzDmJ,YAAY,CAACrH,EAAEoB,MAAM,CAAC,GAAG,AAACiG,CAAAA,YAAY,CAACrH,EAAEoB,MAAM,CAAC,IAAI,CAAA,IAAK;QACzDkG,cAAc,CAACtH,EAAE8C,QAAQ,CAAC,GAAG,AAACwE,CAAAA,cAAc,CAACtH,EAAE8C,QAAQ,CAAC,IAAI,CAAA,IAAK;IACnE;IAEA,MAAMmD,QAAQnO,cAAcoJ,MAAM;IAElC,OAAO;QACLqG,UAAUrN,OAAOsN,OAAO,CAACJ,cAAcnN,GAAG,CAAC,CAAC,CAACiE,QAAQuJ,MAAM,GAAM,CAAA;gBAC/DvJ;gBACAuJ;gBACAC,YAAY,AAACD,QAAQxB,QAAS;YAChC,CAAA;QACA0B,UAAUzN,OAAOsN,OAAO,CAACH,cAAcpN,GAAG,CAAC,CAAC,CAACmH,QAAQqG,MAAM;YACzD,MAAMG,sBAAsB9P,cAAcqD,MAAM,CAAC6E,CAAAA,IAAKA,EAAEoB,MAAM,KAAKA;YACnE,MAAMgF,gBAAgBwB,oBAAoBpF,MAAM,CAAC,CAACD,KAAKvC,IAAMuC,MAAMvC,EAAE0C,UAAU,EAAE,KAAKkF,oBAAoB1G,MAAM;YAChH,OAAO;gBACLE;gBACAqG;gBACAC,YAAY,AAACD,QAAQxB,QAAS;gBAC9B3D,mBAAmB8D;YACrB;QACF;QACAyB,YAAY3N,OAAOsN,OAAO,CAACF,gBAAgBrN,GAAG,CAAC,CAAC,CAAC6I,UAAU2E,MAAM,GAAM,CAAA;gBACrE3E;gBACA2E;gBACAC,YAAY,AAACD,QAAQxB,QAAS;gBAC9B6B,qBAAqB,OAAOjH,KAAKC,MAAM,KAAK;YAC9C,CAAA;QACAiH,cAAc;YACZ;gBAAEC,OAAO;gBAAWP,OAAO5G,KAAKI,KAAK,CAACgF,QAAQ;gBAAOyB,YAAY;YAAE;YACnE;gBAAEM,OAAO;gBAAWP,OAAO5G,KAAKI,KAAK,CAACgF,QAAQ;gBAAMyB,YAAY;YAAG;YACnE;gBAAEM,OAAO;gBAAWP,OAAO5G,KAAKI,KAAK,CAACgF,QAAQ;gBAAOyB,YAAY;YAAG;YACpE;gBAAEM,OAAO;gBAAWP,OAAO5G,KAAKI,KAAK,CAACgF,QAAQ;gBAAOyB,YAAY;YAAG;YACpE;gBAAEM,OAAO;gBAAWP,OAAO5G,KAAKI,KAAK,CAACgF,QAAQ;gBAAOyB,YAAY;YAAG;SACrE;IACH;AACF;AAEA,SAASV,mBAAmBlP,aAAa,EAAEwE,SAAS;IAElD,MAAM2L,SAAS,EAAE;IACjB,MAAM1P,MAAMD,KAAKC,GAAG;IACpB,MAAM2P,YAAY;QAChBvC,UAAU;QACVC,mBAAmB;QACnBC,YAAY;QACZC,aAAa;IACf;IAEA,MAAMqC,gBAAgBD,SAAS,CAAC5L,UAAU,IAAI;IAC9C,MAAM8L,eAAe;QACnBzC,UAAU,IAAI,KAAK;QACnBC,mBAAmB,KAAK,KAAK;QAC7BC,YAAY,KAAK,KAAK,KAAK;QAC3BC,aAAa,KAAK,KAAK,KAAK;IAC9B,CAAC,CAACxJ,UAAU,IAAI,KAAK,KAAK;IAE1B,IAAK,IAAI+L,IAAI,GAAGA,IAAIF,eAAeE,IAAK;QACtC,MAAMxL,YAAYtE,MAAM,AAAC4P,CAAAA,gBAAgBE,IAAI,CAAA,IAAKD;QAClDH,OAAO9E,IAAI,CAAC;YACVtG;YACA7D,OAAO6H,KAAKC,MAAM,KAAK,MAAM;YAC7BmG,QAAQ;QACV;IACF;IAEA,OAAOgB;AACT;AAEA,SAASlL;IACP,MAAMxE,MAAMD,KAAKC,GAAG;IAEpB,OAAO;QACL2F,QAAQ;QACRrB,WAAWtE;QACX+P,UAAU;YACRC,KAAK;gBAAErK,QAAQ;gBAAMoI,cAAc;gBAAIkC,WAAWjQ;gBAAKkQ,YAAY;gBAAGC,QAAQ;YAAK;YACnFC,WAAW;gBAAEzK,QAAQ;gBAAMoI,cAAc;gBAAIkC,WAAWjQ;gBAAKkQ,YAAY;gBAAGC,QAAQ;YAAK;YACzFE,SAAS;gBAAE1K,QAAQ;gBAAMoI,cAAc;gBAAIkC,WAAWjQ;gBAAKkQ,YAAY;gBAAGC,QAAQ;YAAK;YACvFG,UAAU;gBAAE3K,QAAQ;gBAAMoI,cAAc;gBAAKkC,WAAWjQ;gBAAKkQ,YAAY;gBAAGC,QAAQ;YAAK;YACzFI,OAAO;gBAAE5K,QAAQ;gBAAMoI,cAAc;gBAAGkC,WAAWjQ;gBAAKkQ,YAAY;gBAAGC,QAAQ;YAAK;QACtF;QACAtQ,SAAS;YACP2Q,aAAa;YACbC,UAAU;YACVC,mBAAmB;YACnBC,WAAW;YACXC,WAAW;gBACTC,SAAS,OAAO,OAAO;gBACvBC,UAAU,OAAO,OAAO;gBACxBC,WAAW;gBACXC,YAAY;YACd;QACF;QACAb,QAAQnQ,MAAMV,UAAUO,OAAO,CAACC,SAAS;QACzCiO,cAAc;QACdkD,WAAW;IACb;AACF;AAEA,SAASvM;IACP,OAAO;QACLJ,WAAWvE,KAAKC,GAAG;QACnBkR,aAAa;YACXC,mBAAmB;YACnB5B,qBAAqB;YACrB6B,YAAY,OAAO,OAAO;YAC1BH,WAAW;QACb;QACAI,WAAW;YACTb,aAAa;YACbC,UAAU;YACVC,mBAAmB;YACnBC,WAAW;YACXC,WAAW;gBACTC,SAAS,OAAO,OAAO;gBACvBC,UAAU,OAAO,OAAO;gBACxBC,WAAW;gBACXC,YAAY;YACd;QACF;QACAM,aAAa;YACXC,kBAAkB;YAClBC,kBAAkB;YAClBC,gBAAgB;YAChBC,mBAAmB;QACrB;IACF;AACF;AAEA,SAAShK,0BAA0BtF,YAAY,EAAEQ,MAAM;IACrD,IAAIA,OAAOmI,OAAO,IAAI,CAACnI,OAAOmI,OAAO,CAACD,QAAQ,CAAC1I,aAAayG,MAAM,GAAG,OAAO;IAC5E,IAAIjG,OAAOoI,OAAO,IAAI,CAACpI,OAAOoI,OAAO,CAACF,QAAQ,CAAC1I,aAAaiI,MAAM,GAAG,OAAO;IAC5E,IAAIzH,OAAOqI,QAAQ,IAAI,CAACrI,OAAOqI,QAAQ,CAACH,QAAQ,CAAC1I,aAAauD,MAAM,GAAG,OAAO;IAC9E,IAAI/C,OAAOsI,UAAU,IAAI,CAACtI,OAAOsI,UAAU,CAACJ,QAAQ,CAAC1I,aAAamI,QAAQ,GAAG,OAAO;IACpF,IAAI3H,OAAOiE,mBAAmB,IAAIzE,aAAa+H,UAAU,GAAGvH,OAAOiE,mBAAmB,EAAE,OAAO;IAC/F,OAAO;AACT;AAEA,SAASoB,6BAA6BC,KAAK,EAAEtF,MAAM;IACjD,IAAIA,OAAO+O,UAAU,IAAI,CAAC/O,OAAO+O,UAAU,CAAC7G,QAAQ,CAAC5C,MAAMO,IAAI,GAAG,OAAO;IACzE,IAAI7F,OAAOgP,cAAc,IAAI,CAAChP,OAAOgP,cAAc,CAAC9G,QAAQ,CAAC5C,MAAMG,QAAQ,GAAG,OAAO;IACrF,IAAIzF,OAAOmI,OAAO,IAAI,CAACnI,OAAOmI,OAAO,CAACD,QAAQ,CAAC5C,MAAMW,MAAM,GAAG,OAAO;IACrE,IAAIjG,OAAOoI,OAAO,IAAI,CAACpI,OAAOoI,OAAO,CAACF,QAAQ,CAAC5C,MAAMmC,MAAM,GAAG,OAAO;IACrE,IAAIzH,OAAOiP,aAAa,KAAKzG,aAAalD,MAAMiC,UAAU,GAAGvH,OAAOiP,aAAa,EAAE,OAAO;IAC1F,IAAIjP,OAAOkP,aAAa,KAAK1G,aAAalD,MAAMiC,UAAU,GAAGvH,OAAOkP,aAAa,EAAE,OAAO;IAC1F,OAAO;AACT;AAEA,SAASrH,SAASsH,SAAS;IACzB,MAAM7J,QAAQ;QACZzF,IAAIpD;QACJiF,WAAWvE,KAAKC,GAAG;QACnBqI,UAAU;QACV,GAAG0J,SAAS;IACd;IAEAzS,UAAUI,MAAM,CAACkL,IAAI,CAAC1C;IAGtB,IAAI5I,UAAUI,MAAM,CAACiJ,MAAM,GAAG,MAAM;QAClCrJ,UAAUI,MAAM,GAAGJ,UAAUI,MAAM,CAACoN,KAAK,CAAC,CAAC;IAC7C;AACF;AAEAkF,OAAOC,OAAO,GAAGjQ"}