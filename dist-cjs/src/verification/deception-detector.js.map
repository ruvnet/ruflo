{"version":3,"sources":["../../../src/verification/deception-detector.ts"],"sourcesContent":["/**\n * Deception Detector - AI Agent Truth Verification System\n *\n * Analyzes agent behavior patterns to detect and classify deceptive reporting:\n * - Overconfidence: Agents exaggerating success rates\n * - Fabrication: Creating false evidence or results\n * - Selective Reporting: Hiding failures or negative outcomes\n * - Gaslighting: Contradicting other agents or rewriting history\n * - Collusion: Multiple agents coordinating false reports\n */\n\nimport * as fs from 'fs/promises';\nimport * as path from 'path';\n\ninterface AgentReport {\n  id: string;\n  agentId: string;\n  taskId: string;\n  claimedOutcome: TaskOutcome;\n  evidence: any;\n  timestamp: number;\n  truthScore?: number;\n  verified: boolean;\n  conflicts: string[];\n}\n\ninterface TaskOutcome {\n  success: boolean;\n  testsPass: boolean;\n  noErrors: boolean;\n  performance: {\n    improvement: number;\n    metrics: Record<string, number>;\n  };\n  quality: {\n    codeQuality: number;\n    documentation: number;\n    maintainability: number;\n  };\n}\n\ninterface DeceptionAnalysis {\n  reportId?: string;\n  agentId: string;\n  truthScore: number;\n  deceptionDetected: boolean;\n  deceptionType: string[];\n  confidence: number;\n  evidence: any;\n  recommendations: string[];\n}\n\nexport class DeceptionDetector {\n  private truthCalculator: any;\n  private tempDir: string;\n  private analysisHistory: Map<string, DeceptionAnalysis[]> = new Map();\n\n  constructor(truthCalculator: any, tempDir: string) {\n    this.truthCalculator = truthCalculator;\n    this.tempDir = tempDir;\n  }\n\n  async initialize(): Promise<void> {\n    // Create directories for storing detection data\n    await fs.mkdir(path.join(this.tempDir, 'deception-analysis'), { recursive: true });\n    await fs.mkdir(path.join(this.tempDir, 'agent-patterns'), { recursive: true });\n  }\n\n  /**\n   * Analyze a pattern of reports from an agent to detect deception\n   */\n  async analyzeAgentPattern(agentId: string, reports: AgentReport[]): Promise<DeceptionAnalysis> {\n    const analysis: DeceptionAnalysis = {\n      agentId,\n      truthScore: 1.0,\n      deceptionDetected: false,\n      deceptionType: [],\n      confidence: 0,\n      evidence: {},\n      recommendations: []\n    };\n\n    if (reports.length === 0) {\n      return analysis;\n    }\n\n    // Calculate success rate discrepancies\n    const successRateAnalysis = this.analyzeSuccessRates(reports);\n    if (successRateAnalysis.discrepancy > 0.15) {\n      analysis.deceptionDetected = true;\n      analysis.deceptionType.push('overconfidence');\n      analysis.evidence.successRateDiscrepancy = successRateAnalysis.discrepancy;\n      analysis.confidence += 0.3;\n    }\n\n    // Analyze performance claims\n    const performanceAnalysis = this.analyzePerformanceClaims(reports);\n    if (performanceAnalysis.exaggeration > 0.1) {\n      analysis.deceptionDetected = true;\n      analysis.deceptionType.push('exaggeration');\n      analysis.evidence.performanceExaggeration = performanceAnalysis.exaggeration;\n      analysis.confidence += 0.25;\n    }\n\n    // Analyze quality claims\n    const qualityAnalysis = this.analyzeQualityClaims(reports);\n    if (qualityAnalysis.inflation > 0.15) {\n      analysis.deceptionDetected = true;\n      analysis.deceptionType.push('quality-inflation');\n      analysis.evidence.qualityInflation = qualityAnalysis.inflation;\n      analysis.confidence += 0.2;\n    }\n\n    // Check for pattern consistency\n    const consistencyAnalysis = this.analyzeConsistency(reports);\n    if (consistencyAnalysis.consistency < 0.5) {\n      analysis.deceptionDetected = true;\n      analysis.deceptionType.push('inconsistency');\n      analysis.evidence.inconsistencyScore = 1 - consistencyAnalysis.consistency;\n      analysis.confidence += 0.25;\n    }\n\n    // Calculate overall truth score\n    analysis.truthScore = this.calculateOverallTruthScore(reports, analysis);\n\n    // Ensure confidence doesn't exceed 1.0\n    analysis.confidence = Math.min(analysis.confidence, 1.0);\n\n    // Generate recommendations\n    analysis.recommendations = this.generateRecommendations(analysis);\n\n    // Store analysis\n    if (!this.analysisHistory.has(agentId)) {\n      this.analysisHistory.set(agentId, []);\n    }\n    this.analysisHistory.get(agentId)!.push(analysis);\n\n    return analysis;\n  }\n\n  /**\n   * Analyze single report for deception indicators\n   */\n  async analyzeSingleReport(report: AgentReport, historicalReports: AgentReport[]): Promise<DeceptionAnalysis> {\n    const allReports = [...historicalReports, report];\n    const analysis = await this.analyzeAgentPattern(report.agentId, allReports);\n    analysis.reportId = report.id;\n    return analysis;\n  }\n\n  /**\n   * Detect fabrication patterns\n   */\n  detectFabrication(report: AgentReport): {\n    isFabricated: boolean;\n    confidence: number;\n    indicators: string[];\n  } {\n    const indicators: string[] = [];\n    let fabricationScore = 0;\n\n    // Check for suspiciously perfect results\n    if (report.claimedOutcome.testsPass &&\n        report.claimedOutcome.noErrors &&\n        report.claimedOutcome.success &&\n        report.claimedOutcome.quality.codeQuality > 0.95) {\n      indicators.push('suspiciously-perfect-results');\n      fabricationScore += 0.3;\n    }\n\n    // Check for lack of detailed evidence\n    if (!report.evidence || Object.keys(report.evidence).length < 3) {\n      indicators.push('insufficient-evidence');\n      fabricationScore += 0.2;\n    }\n\n    // Check for unrealistic timing\n    if (report.timestamp && report.evidence?.duration) {\n      if (report.evidence.duration < 1000) {\n        indicators.push('unrealistically-fast-completion');\n        fabricationScore += 0.25;\n      }\n    }\n\n    // Check for pattern of consistent overperformance\n    if (report.claimedOutcome.performance.improvement > 0.5) {\n      indicators.push('unrealistic-performance-improvement');\n      fabricationScore += 0.25;\n    }\n\n    return {\n      isFabricated: fabricationScore > 0.5,\n      confidence: Math.min(fabricationScore, 1.0),\n      indicators\n    };\n  }\n\n  /**\n   * Detect selective reporting patterns\n   */\n  detectSelectiveReporting(reports: AgentReport[]): {\n    isSelective: boolean;\n    confidence: number;\n    evidence: any;\n  } {\n    if (reports.length < 5) {\n      return { isSelective: false, confidence: 0, evidence: {} };\n    }\n\n    const successCount = reports.filter(r => r.claimedOutcome.success).length;\n    const successRate = successCount / reports.length;\n\n    // If agent reports almost 100% success, likely selective reporting\n    if (successRate > 0.95 && reports.length > 10) {\n      return {\n        isSelective: true,\n        confidence: 0.8,\n        evidence: {\n          reportedSuccessRate: successRate,\n          totalReports: reports.length,\n          pattern: 'always-positive'\n        }\n      };\n    }\n\n    // Check for missing failure reports\n    const errorReports = reports.filter(r => !r.claimedOutcome.noErrors);\n    if (errorReports.length === 0 && reports.length > 15) {\n      return {\n        isSelective: true,\n        confidence: 0.7,\n        evidence: {\n          pattern: 'no-errors-reported',\n          totalReports: reports.length\n        }\n      };\n    }\n\n    return { isSelective: false, confidence: 0, evidence: {} };\n  }\n\n  /**\n   * Detect gaslighting patterns (contradicting others or rewriting history)\n   */\n  detectGaslighting(report: AgentReport, otherReports: AgentReport[]): {\n    isGaslighting: boolean;\n    confidence: number;\n    contradictions: string[];\n  } {\n    const contradictions: string[] = [];\n\n    // Check for contradictions with other agents on same task\n    const sameTaskReports = otherReports.filter(r => r.taskId === report.taskId && r.agentId !== report.agentId);\n\n    for (const otherReport of sameTaskReports) {\n      if (report.claimedOutcome.success !== otherReport.claimedOutcome.success) {\n        contradictions.push(`Contradicts ${otherReport.agentId} on task success`);\n      }\n\n      if (Math.abs(report.claimedOutcome.performance.improvement - otherReport.claimedOutcome.performance.improvement) > 0.3) {\n        contradictions.push(`Large discrepancy in performance claims vs ${otherReport.agentId}`);\n      }\n    }\n\n    return {\n      isGaslighting: contradictions.length >= 2,\n      confidence: Math.min(contradictions.length * 0.3, 1.0),\n      contradictions\n    };\n  }\n\n  private analyzeSuccessRates(reports: AgentReport[]): { discrepancy: number } {\n    // In a real scenario, we'd compare claimed vs actual\n    // For testing, we'll simulate this by checking consistency\n    const claimedSuccesses = reports.filter(r => r.claimedOutcome.success).length;\n    const claimedRate = claimedSuccesses / reports.length;\n\n    // Assume 70% is realistic - anything significantly higher is suspicious\n    const realisticRate = 0.7;\n    const discrepancy = Math.max(0, claimedRate - realisticRate);\n\n    return { discrepancy };\n  }\n\n  private analyzePerformanceClaims(reports: AgentReport[]): { exaggeration: number } {\n    const avgImprovement = reports.reduce((sum, r) =>\n      sum + r.claimedOutcome.performance.improvement, 0) / reports.length;\n\n    // Typical improvement is 10-20%, anything significantly higher is suspicious\n    const realisticImprovement = 0.15;\n    const exaggeration = Math.max(0, avgImprovement - realisticImprovement);\n\n    return { exaggeration };\n  }\n\n  private analyzeQualityClaims(reports: AgentReport[]): { inflation: number } {\n    const avgQuality = reports.reduce((sum, r) =>\n      sum + r.claimedOutcome.quality.codeQuality, 0) / reports.length;\n\n    // Typical quality is 0.6-0.7, anything consistently above 0.85 is suspicious\n    const realisticQuality = 0.7;\n    const inflation = Math.max(0, avgQuality - realisticQuality);\n\n    return { inflation };\n  }\n\n  private analyzeConsistency(reports: AgentReport[]): { consistency: number } {\n    if (reports.length < 2) {\n      return { consistency: 1.0 };\n    }\n\n    // Check variance in reported metrics\n    const improvements = reports.map(r => r.claimedOutcome.performance.improvement);\n    const avgImprovement = improvements.reduce((a, b) => a + b, 0) / improvements.length;\n    const variance = improvements.reduce((sum, val) =>\n      sum + Math.pow(val - avgImprovement, 2), 0) / improvements.length;\n\n    // High variance indicates inconsistency (possible deception)\n    const stdDev = Math.sqrt(variance);\n    const consistency = Math.max(0, 1 - stdDev * 2);\n\n    return { consistency };\n  }\n\n  private calculateOverallTruthScore(reports: AgentReport[], analysis: DeceptionAnalysis): number {\n    let score = 1.0;\n\n    // Deduct for each deception type detected\n    if (analysis.deceptionType.includes('overconfidence')) {\n      score -= 0.25;\n    }\n    if (analysis.deceptionType.includes('exaggeration')) {\n      score -= 0.2;\n    }\n    if (analysis.deceptionType.includes('quality-inflation')) {\n      score -= 0.15;\n    }\n    if (analysis.deceptionType.includes('inconsistency')) {\n      score -= 0.2;\n    }\n\n    // Ensure score is between 0 and 1\n    return Math.max(0, Math.min(1, score));\n  }\n\n  private generateRecommendations(analysis: DeceptionAnalysis): string[] {\n    const recommendations: string[] = [];\n\n    if (analysis.deceptionType.includes('overconfidence')) {\n      recommendations.push('Implement stricter verification for this agent');\n      recommendations.push('Require additional evidence for success claims');\n    }\n\n    if (analysis.deceptionType.includes('exaggeration')) {\n      recommendations.push('Cross-verify performance claims with actual metrics');\n      recommendations.push('Implement automated performance testing');\n    }\n\n    if (analysis.deceptionType.includes('quality-inflation')) {\n      recommendations.push('Add mandatory code review by independent agent');\n      recommendations.push('Implement automated quality assessment');\n    }\n\n    if (analysis.deceptionType.includes('inconsistency')) {\n      recommendations.push('Flag for manual review due to inconsistent reporting');\n      recommendations.push('Increase monitoring frequency');\n    }\n\n    if (analysis.confidence > 0.8) {\n      recommendations.push('CRITICAL: High confidence deception detected - escalate immediately');\n    }\n\n    return recommendations;\n  }\n\n  /**\n   * Get historical analysis for an agent\n   */\n  getAgentHistory(agentId: string): DeceptionAnalysis[] {\n    return this.analysisHistory.get(agentId) || [];\n  }\n\n  /**\n   * Calculate agent's overall deception risk score\n   */\n  calculateRiskScore(agentId: string): {\n    riskScore: number;\n    riskLevel: 'low' | 'medium' | 'high' | 'critical';\n    recentPatterns: string[];\n  } {\n    const history = this.getAgentHistory(agentId);\n\n    if (history.length === 0) {\n      return { riskScore: 0, riskLevel: 'low', recentPatterns: [] };\n    }\n\n    const avgTruthScore = history.reduce((sum, a) => sum + a.truthScore, 0) / history.length;\n    const avgConfidence = history.reduce((sum, a) => sum + a.confidence, 0) / history.length;\n    const deceptionCount = history.filter(a => a.deceptionDetected).length;\n    const deceptionRate = deceptionCount / history.length;\n\n    const riskScore = (1 - avgTruthScore) * 0.4 + avgConfidence * 0.3 + deceptionRate * 0.3;\n\n    let riskLevel: 'low' | 'medium' | 'high' | 'critical';\n    if (riskScore < 0.3) riskLevel = 'low';\n    else if (riskScore < 0.5) riskLevel = 'medium';\n    else if (riskScore < 0.7) riskLevel = 'high';\n    else riskLevel = 'critical';\n\n    // Get recent patterns (last 5 analyses)\n    const recentAnalyses = history.slice(-5);\n    const recentPatterns = Array.from(new Set(\n      recentAnalyses.flatMap(a => a.deceptionType)\n    ));\n\n    return { riskScore, riskLevel, recentPatterns };\n  }\n}\n"],"names":["fs","path","DeceptionDetector","truthCalculator","tempDir","analysisHistory","Map","initialize","mkdir","join","recursive","analyzeAgentPattern","agentId","reports","analysis","truthScore","deceptionDetected","deceptionType","confidence","evidence","recommendations","length","successRateAnalysis","analyzeSuccessRates","discrepancy","push","successRateDiscrepancy","performanceAnalysis","analyzePerformanceClaims","exaggeration","performanceExaggeration","qualityAnalysis","analyzeQualityClaims","inflation","qualityInflation","consistencyAnalysis","analyzeConsistency","consistency","inconsistencyScore","calculateOverallTruthScore","Math","min","generateRecommendations","has","set","get","analyzeSingleReport","report","historicalReports","allReports","reportId","id","detectFabrication","indicators","fabricationScore","claimedOutcome","testsPass","noErrors","success","quality","codeQuality","Object","keys","timestamp","duration","performance","improvement","isFabricated","detectSelectiveReporting","isSelective","successCount","filter","r","successRate","reportedSuccessRate","totalReports","pattern","errorReports","detectGaslighting","otherReports","contradictions","sameTaskReports","taskId","otherReport","abs","isGaslighting","claimedSuccesses","claimedRate","realisticRate","max","avgImprovement","reduce","sum","realisticImprovement","avgQuality","realisticQuality","improvements","map","a","b","variance","val","pow","stdDev","sqrt","score","includes","getAgentHistory","calculateRiskScore","history","riskScore","riskLevel","recentPatterns","avgTruthScore","avgConfidence","deceptionCount","deceptionRate","recentAnalyses","slice","Array","from","Set","flatMap"],"mappings":"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"}