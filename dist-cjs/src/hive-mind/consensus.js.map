{"version":3,"sources":["../../../src/hive-mind/consensus.js"],"sourcesContent":["/**\r\n * Hive Mind Consensus Engine\r\n * \r\n * Implements multiple consensus algorithms for distributed decision making:\r\n * - Majority voting (simple and weighted)\r\n * - Byzantine fault tolerance\r\n * - Dynamic threshold adjustment\r\n * - Quorum management\r\n */\r\n\r\nimport { EventEmitter } from 'node:events';\r\nimport { generateId } from '../utils/helpers.js';\r\n\r\nexport class ConsensusEngine extends EventEmitter {\r\n  constructor(config = {}) {\r\n    super();\r\n    \r\n    this.config = {\r\n      defaultThreshold: 0.6,\r\n      byzantineTolerance: 0.33, // Max 33% Byzantine actors\r\n      quorumSize: 0.75, // Minimum 75% participation\r\n      votingTimeout: 30000, // 30 seconds\r\n      maxRetries: 3,\r\n      weightDecay: 0.95, // Weight decay for agents with failures\r\n      ...config\r\n    };\r\n    \r\n    this.proposals = new Map();\r\n    this.agents = new Map();\r\n    this.votingHistory = new Map();\r\n    this.metrics = {\r\n      totalProposals: 0,\r\n      successfulConsensus: 0,\r\n      failedConsensus: 0,\r\n      byzantineDetected: 0,\r\n      avgVotingTime: 0\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Register agent with initial reputation weight\r\n   */\r\n  registerAgent(agentId, initialWeight = 1.0, capabilities = []) {\r\n    this.agents.set(agentId, {\r\n      id: agentId,\r\n      weight: initialWeight,\r\n      reputation: 1.0,\r\n      capabilities,\r\n      votescast: 0,\r\n      correctVotes: 0,\r\n      byzantineFlags: 0,\r\n      lastActivity: Date.now(),\r\n      isOnline: true\r\n    });\r\n    \r\n    this.emit('agent:registered', { agentId, weight: initialWeight });\r\n  }\r\n\r\n  /**\r\n   * Create a new consensus proposal\r\n   */\r\n  async createProposal(data) {\r\n    const proposalId = generateId('proposal');\r\n    const proposal = {\r\n      id: proposalId,\r\n      type: data.type || 'general',\r\n      content: data.content,\r\n      threshold: data.threshold || this.config.defaultThreshold,\r\n      algorithm: data.algorithm || 'weighted_majority',\r\n      creator: data.creator,\r\n      requiredCapabilities: data.requiredCapabilities || [],\r\n      metadata: data.metadata || {},\r\n      \r\n      // Voting state\r\n      votes: new Map(),\r\n      eligibleAgents: new Set(),\r\n      startTime: Date.now(),\r\n      deadline: Date.now() + (data.timeout || this.config.votingTimeout),\r\n      status: 'active',\r\n      \r\n      // Results\r\n      result: null,\r\n      finalRatio: 0,\r\n      participationRate: 0,\r\n      consensus: false,\r\n      \r\n      // Byzantine detection\r\n      suspiciousVotes: new Set(),\r\n      consistencyChecks: new Map()\r\n    };\r\n\r\n    // Determine eligible agents based on capabilities\r\n    this.determineEligibleAgents(proposal);\r\n    \r\n    this.proposals.set(proposalId, proposal);\r\n    this.metrics.totalProposals++;\r\n    \r\n    this.emit('proposal:created', proposal);\r\n    \r\n    // Set timeout for proposal\r\n    setTimeout(() => this.finalizeProposal(proposalId), proposal.deadline - proposal.startTime);\r\n    \r\n    return proposalId;\r\n  }\r\n\r\n  /**\r\n   * Determine which agents are eligible to vote\r\n   */\r\n  determineEligibleAgents(proposal) {\r\n    for (const [agentId, agent] of this.agents) {\r\n      if (!agent.isOnline) continue;\r\n      \r\n      // Check capabilities if required\r\n      if (proposal.requiredCapabilities.length > 0) {\r\n        const hasRequiredCapability = proposal.requiredCapabilities.some(cap => \r\n          agent.capabilities.includes(cap)\r\n        );\r\n        if (!hasRequiredCapability) continue;\r\n      }\r\n      \r\n      // Exclude agents with too many Byzantine flags\r\n      if (agent.byzantineFlags > 3) continue;\r\n      \r\n      proposal.eligibleAgents.add(agentId);\r\n    }\r\n    \r\n    console.log(`Proposal ${proposal.id}: ${proposal.eligibleAgents.size} eligible agents`);\r\n  }\r\n\r\n  /**\r\n   * Submit a vote for a proposal\r\n   */\r\n  async submitVote(proposalId, agentId, vote, reasoning = '') {\r\n    const proposal = this.proposals.get(proposalId);\r\n    if (!proposal) {\r\n      throw new Error(`Proposal ${proposalId} not found`);\r\n    }\r\n\r\n    if (proposal.status !== 'active') {\r\n      throw new Error(`Proposal ${proposalId} is no longer active`);\r\n    }\r\n\r\n    if (!proposal.eligibleAgents.has(agentId)) {\r\n      throw new Error(`Agent ${agentId} is not eligible to vote on this proposal`);\r\n    }\r\n\r\n    if (Date.now() > proposal.deadline) {\r\n      throw new Error(`Voting deadline has passed for proposal ${proposalId}`);\r\n    }\r\n\r\n    const agent = this.agents.get(agentId);\r\n    if (!agent) {\r\n      throw new Error(`Agent ${agentId} not registered`);\r\n    }\r\n\r\n    // Record the vote\r\n    const voteRecord = {\r\n      agentId,\r\n      vote: Boolean(vote),\r\n      weight: agent.weight,\r\n      reasoning,\r\n      timestamp: Date.now(),\r\n      confidence: this.calculateVoteConfidence(agent, proposal)\r\n    };\r\n\r\n    proposal.votes.set(agentId, voteRecord);\r\n    agent.votescast++;\r\n    agent.lastActivity = Date.now();\r\n\r\n    this.emit('vote:submitted', { proposalId, agentId, vote, reasoning });\r\n\r\n    // Perform Byzantine detection\r\n    this.detectByzantineBehavior(proposal, voteRecord);\r\n\r\n    // Check if we can finalize early\r\n    if (this.canFinalizeEarly(proposal)) {\r\n      return this.finalizeProposal(proposalId);\r\n    }\r\n\r\n    return { status: 'recorded', proposal: proposal.id };\r\n  }\r\n\r\n  /**\r\n   * Calculate vote confidence based on agent history\r\n   */\r\n  calculateVoteConfidence(agent, proposal) {\r\n    const reputationFactor = agent.reputation;\r\n    const experienceFactor = Math.min(agent.votescast / 10, 1.0);\r\n    const consistencyFactor = agent.votescast > 0 ? agent.correctVotes / agent.votescast : 0.5;\r\n    const recencyFactor = Math.max(0.1, 1.0 - (Date.now() - agent.lastActivity) / (24 * 60 * 60 * 1000));\r\n    \r\n    return (reputationFactor + experienceFactor + consistencyFactor + recencyFactor) / 4;\r\n  }\r\n\r\n  /**\r\n   * Detect Byzantine behavior patterns\r\n   */\r\n  detectByzantineBehavior(proposal, voteRecord) {\r\n    const { agentId, vote, confidence } = voteRecord;\r\n    const agent = this.agents.get(agentId);\r\n    \r\n    // Pattern 1: Vote flipping (changing votes frequently)\r\n    const recentVotes = Array.from(this.votingHistory.values())\r\n      .filter(v => v.agentId === agentId && Date.now() - v.timestamp < 3600000) // Last hour\r\n      .slice(-5);\r\n    \r\n    if (recentVotes.length >= 3) {\r\n      const voteChanges = recentVotes.reduce((changes, v, i) => \r\n        i > 0 && v.vote !== recentVotes[i-1].vote ? changes + 1 : changes, 0);\r\n      \r\n      if (voteChanges >= 2) {\r\n        this.flagByzantineAgent(agentId, 'vote_flipping', proposal.id);\r\n      }\r\n    }\r\n\r\n    // Pattern 2: Extremely low confidence with definitive votes\r\n    if (confidence < 0.3 && Math.abs(vote ? 1 : 0) === 1) {\r\n      this.flagByzantineAgent(agentId, 'confidence_mismatch', proposal.id);\r\n    }\r\n\r\n    // Pattern 3: Consistent minority voting (contrarian behavior)\r\n    const agentHistory = Array.from(this.votingHistory.values())\r\n      .filter(v => v.agentId === agentId)\r\n      .slice(-10);\r\n    \r\n    if (agentHistory.length >= 5) {\r\n      const minorityVotes = agentHistory.filter(v => {\r\n        const proposalResult = this.proposals.get(v.proposalId);\r\n        return proposalResult && proposalResult.consensus !== v.vote;\r\n      }).length;\r\n      \r\n      if (minorityVotes / agentHistory.length > 0.8) {\r\n        this.flagByzantineAgent(agentId, 'contrarian_pattern', proposal.id);\r\n      }\r\n    }\r\n\r\n    // Store vote in history\r\n    this.votingHistory.set(`${proposal.id}:${agentId}`, {\r\n      proposalId: proposal.id,\r\n      agentId,\r\n      vote,\r\n      timestamp: Date.now()\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Flag an agent for Byzantine behavior\r\n   */\r\n  flagByzantineAgent(agentId, reason, proposalId) {\r\n    const agent = this.agents.get(agentId);\r\n    if (!agent) return;\r\n\r\n    agent.byzantineFlags++;\r\n    agent.weight *= this.config.weightDecay;\r\n    this.metrics.byzantineDetected++;\r\n    \r\n    console.warn(`Byzantine behavior detected: Agent ${agentId}, Reason: ${reason}, Proposal: ${proposalId}`);\r\n    this.emit('byzantine:detected', { agentId, reason, proposalId, newWeight: agent.weight });\r\n    \r\n    // Quarantine agent if too many flags\r\n    if (agent.byzantineFlags >= 5) {\r\n      agent.isOnline = false;\r\n      this.emit('agent:quarantined', { agentId, flags: agent.byzantineFlags });\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Check if proposal can be finalized early\r\n   */\r\n  canFinalizeEarly(proposal) {\r\n    const totalEligible = proposal.eligibleAgents.size;\r\n    const votesReceived = proposal.votes.size;\r\n    \r\n    // Early finalization conditions:\r\n    // 1. Unanimous agreement\r\n    // 2. Impossible to change outcome\r\n    // 3. Sufficient participation with clear majority\r\n    \r\n    if (votesReceived < Math.ceil(totalEligible * this.config.quorumSize)) {\r\n      return false;\r\n    }\r\n\r\n    const { positiveVotes, negativeVotes } = this.calculateVotes(proposal);\r\n    const totalWeightedVotes = positiveVotes + negativeVotes;\r\n    const ratio = totalWeightedVotes > 0 ? positiveVotes / totalWeightedVotes : 0;\r\n    \r\n    // Unanimous or overwhelming majority\r\n    if (ratio >= 0.95 || ratio <= 0.05) {\r\n      return true;\r\n    }\r\n    \r\n    // Mathematically impossible to change outcome\r\n    const remainingVotes = totalEligible - votesReceived;\r\n    const maxPossibleChange = remainingVotes * Math.max(...Array.from(this.agents.values()).map(a => a.weight));\r\n    \r\n    if (ratio > proposal.threshold && positiveVotes - negativeVotes > maxPossibleChange) {\r\n      return true;\r\n    }\r\n    \r\n    if (ratio < proposal.threshold && negativeVotes - positiveVotes > maxPossibleChange) {\r\n      return true;\r\n    }\r\n    \r\n    return false;\r\n  }\r\n\r\n  /**\r\n   * Calculate weighted votes\r\n   */\r\n  calculateVotes(proposal) {\r\n    let positiveVotes = 0;\r\n    let negativeVotes = 0;\r\n    let totalWeight = 0;\r\n    \r\n    for (const [agentId, vote] of proposal.votes) {\r\n      const agent = this.agents.get(agentId);\r\n      if (!agent) continue;\r\n      \r\n      const voteWeight = agent.weight;\r\n      totalWeight += voteWeight;\r\n      \r\n      if (vote.vote) {\r\n        positiveVotes += voteWeight;\r\n      } else {\r\n        negativeVotes += voteWeight;\r\n      }\r\n    }\r\n    \r\n    return { positiveVotes, negativeVotes, totalWeight };\r\n  }\r\n\r\n  /**\r\n   * Apply different consensus algorithms\r\n   */\r\n  applyConsensusAlgorithm(proposal) {\r\n    switch (proposal.algorithm) {\r\n      case 'simple_majority':\r\n        return this.simpleMajorityConsensus(proposal);\r\n      case 'weighted_majority':\r\n        return this.weightedMajorityConsensus(proposal);\r\n      case 'byzantine_tolerant':\r\n        return this.byzantineTolerantConsensus(proposal);\r\n      case 'unanimous':\r\n        return this.unanimousConsensus(proposal);\r\n      default:\r\n        return this.weightedMajorityConsensus(proposal);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Simple majority consensus (one vote per agent)\r\n   */\r\n  simpleMajorityConsensus(proposal) {\r\n    const votes = Array.from(proposal.votes.values());\r\n    const positiveVotes = votes.filter(v => v.vote).length;\r\n    const negativeVotes = votes.filter(v => !v.vote).length;\r\n    const totalVotes = votes.length;\r\n    \r\n    const ratio = totalVotes > 0 ? positiveVotes / totalVotes : 0;\r\n    const consensus = ratio >= proposal.threshold;\r\n    \r\n    return {\r\n      consensus,\r\n      ratio,\r\n      positiveVotes,\r\n      negativeVotes,\r\n      totalVotes,\r\n      algorithm: 'simple_majority'\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Weighted majority consensus\r\n   */\r\n  weightedMajorityConsensus(proposal) {\r\n    const { positiveVotes, negativeVotes, totalWeight } = this.calculateVotes(proposal);\r\n    const ratio = totalWeight > 0 ? positiveVotes / totalWeight : 0;\r\n    const consensus = ratio >= proposal.threshold;\r\n    \r\n    return {\r\n      consensus,\r\n      ratio,\r\n      positiveVotes,\r\n      negativeVotes,\r\n      totalWeight,\r\n      algorithm: 'weighted_majority'\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Byzantine fault tolerant consensus\r\n   */\r\n  byzantineTolerantConsensus(proposal) {\r\n    const votes = Array.from(proposal.votes.values());\r\n    const trustedVotes = votes.filter(v => {\r\n      const agent = this.agents.get(v.agentId);\r\n      return agent && agent.byzantineFlags === 0 && agent.reputation > 0.7;\r\n    });\r\n    \r\n    if (trustedVotes.length === 0) {\r\n      return this.weightedMajorityConsensus(proposal);\r\n    }\r\n    \r\n    const positiveVotes = trustedVotes.filter(v => v.vote).length;\r\n    const totalTrusted = trustedVotes.length;\r\n    const ratio = positiveVotes / totalTrusted;\r\n    \r\n    // Require higher threshold for Byzantine tolerance\r\n    const byzantineThreshold = Math.max(proposal.threshold, 0.67);\r\n    const consensus = ratio >= byzantineThreshold;\r\n    \r\n    return {\r\n      consensus,\r\n      ratio,\r\n      positiveVotes,\r\n      negativeVotes: totalTrusted - positiveVotes,\r\n      totalVotes: totalTrusted,\r\n      algorithm: 'byzantine_tolerant',\r\n      trustedVotesOnly: true\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Unanimous consensus\r\n   */\r\n  unanimousConsensus(proposal) {\r\n    const votes = Array.from(proposal.votes.values());\r\n    const allAgree = votes.every(v => v.vote) || votes.every(v => !v.vote);\r\n    const consensus = allAgree && votes.length > 0;\r\n    \r\n    return {\r\n      consensus,\r\n      ratio: consensus ? 1.0 : 0.0,\r\n      positiveVotes: votes.filter(v => v.vote).length,\r\n      negativeVotes: votes.filter(v => !v.vote).length,\r\n      totalVotes: votes.length,\r\n      algorithm: 'unanimous'\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Finalize a proposal\r\n   */\r\n  async finalizeProposal(proposalId) {\r\n    const proposal = this.proposals.get(proposalId);\r\n    if (!proposal || proposal.status !== 'active') {\r\n      return null;\r\n    }\r\n\r\n    proposal.status = 'finalized';\r\n    proposal.endTime = Date.now();\r\n    \r\n    // Check quorum\r\n    const participationRate = proposal.votes.size / proposal.eligibleAgents.size;\r\n    proposal.participationRate = participationRate;\r\n    \r\n    if (participationRate < this.config.quorumSize) {\r\n      proposal.result = this.handleInsufficientQuorum(proposal);\r\n    } else {\r\n      proposal.result = this.applyConsensusAlgorithm(proposal);\r\n    }\r\n    \r\n    proposal.consensus = proposal.result.consensus;\r\n    proposal.finalRatio = proposal.result.ratio;\r\n    \r\n    // Update metrics\r\n    if (proposal.consensus) {\r\n      this.metrics.successfulConsensus++;\r\n    } else {\r\n      this.metrics.failedConsensus++;\r\n    }\r\n    \r\n    const votingTime = proposal.endTime - proposal.startTime;\r\n    this.metrics.avgVotingTime = \r\n      (this.metrics.avgVotingTime * (this.metrics.totalProposals - 1) + votingTime) / \r\n      this.metrics.totalProposals;\r\n    \r\n    // Update agent reputations\r\n    this.updateAgentReputations(proposal);\r\n    \r\n    this.emit('proposal:finalized', proposal);\r\n    \r\n    return proposal;\r\n  }\r\n\r\n  /**\r\n   * Handle insufficient quorum\r\n   */\r\n  handleInsufficientQuorum(proposal) {\r\n    return {\r\n      consensus: false,\r\n      ratio: 0,\r\n      positiveVotes: 0,\r\n      negativeVotes: 0,\r\n      totalVotes: proposal.votes.size,\r\n      algorithm: 'quorum_failed',\r\n      error: `Insufficient quorum: ${proposal.participationRate.toFixed(2)} < ${this.config.quorumSize}`\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Update agent reputations based on consensus accuracy\r\n   */\r\n  updateAgentReputations(proposal) {\r\n    if (!proposal.consensus) return;\r\n    \r\n    const majorityVote = proposal.finalRatio >= 0.5;\r\n    \r\n    for (const [agentId, vote] of proposal.votes) {\r\n      const agent = this.agents.get(agentId);\r\n      if (!agent) continue;\r\n      \r\n      const votedWithMajority = vote.vote === majorityVote;\r\n      \r\n      if (votedWithMajority) {\r\n        agent.correctVotes++;\r\n        agent.reputation = Math.min(2.0, agent.reputation * 1.05);\r\n        agent.weight = Math.min(2.0, agent.weight * 1.02);\r\n      } else {\r\n        agent.reputation *= 0.98;\r\n        agent.weight *= 0.99;\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get consensus metrics\r\n   */\r\n  getMetrics() {\r\n    const activeProposals = Array.from(this.proposals.values()).filter(p => p.status === 'active');\r\n    const totalAgents = this.agents.size;\r\n    const onlineAgents = Array.from(this.agents.values()).filter(a => a.isOnline).length;\r\n    const byzantineAgents = Array.from(this.agents.values()).filter(a => a.byzantineFlags > 0).length;\r\n    \r\n    return {\r\n      ...this.metrics,\r\n      activeProposals: activeProposals.length,\r\n      totalAgents,\r\n      onlineAgents,\r\n      byzantineAgents,\r\n      successRate: this.metrics.totalProposals > 0 ? \r\n        this.metrics.successfulConsensus / this.metrics.totalProposals : 0,\r\n      avgParticipationRate: this.calculateAverageParticipation()\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Calculate average participation rate\r\n   */\r\n  calculateAverageParticipation() {\r\n    const finalizedProposals = Array.from(this.proposals.values())\r\n      .filter(p => p.status === 'finalized');\r\n    \r\n    if (finalizedProposals.length === 0) return 0;\r\n    \r\n    return finalizedProposals.reduce((sum, p) => sum + p.participationRate, 0) / \r\n           finalizedProposals.length;\r\n  }\r\n\r\n  /**\r\n   * Get proposal status\r\n   */\r\n  getProposal(proposalId) {\r\n    return this.proposals.get(proposalId);\r\n  }\r\n\r\n  /**\r\n   * Get agent information\r\n   */\r\n  getAgent(agentId) {\r\n    return this.agents.get(agentId);\r\n  }\r\n\r\n  /**\r\n   * List all proposals\r\n   */\r\n  listProposals(filter = {}) {\r\n    let proposals = Array.from(this.proposals.values());\r\n    \r\n    if (filter.status) {\r\n      proposals = proposals.filter(p => p.status === filter.status);\r\n    }\r\n    \r\n    if (filter.type) {\r\n      proposals = proposals.filter(p => p.type === filter.type);\r\n    }\r\n    \r\n    if (filter.creator) {\r\n      proposals = proposals.filter(p => p.creator === filter.creator);\r\n    }\r\n    \r\n    return proposals.sort((a, b) => b.startTime - a.startTime);\r\n  }\r\n\r\n  /**\r\n   * Cleanup expired proposals and old history\r\n   */\r\n  cleanup() {\r\n    const now = Date.now();\r\n    const maxAge = 24 * 60 * 60 * 1000; // 24 hours\r\n    \r\n    // Remove old proposals\r\n    for (const [id, proposal] of this.proposals) {\r\n      if (now - proposal.startTime > maxAge && proposal.status === 'finalized') {\r\n        this.proposals.delete(id);\r\n      }\r\n    }\r\n    \r\n    // Remove old voting history\r\n    for (const [key, vote] of this.votingHistory) {\r\n      if (now - vote.timestamp > maxAge) {\r\n        this.votingHistory.delete(key);\r\n      }\r\n    }\r\n    \r\n    this.emit('cleanup:completed', {\r\n      proposalsRemoved: this.proposals.size,\r\n      historyRemoved: this.votingHistory.size\r\n    });\r\n  }\r\n}"],"names":["EventEmitter","generateId","ConsensusEngine","config","defaultThreshold","byzantineTolerance","quorumSize","votingTimeout","maxRetries","weightDecay","proposals","Map","agents","votingHistory","metrics","totalProposals","successfulConsensus","failedConsensus","byzantineDetected","avgVotingTime","registerAgent","agentId","initialWeight","capabilities","set","id","weight","reputation","votescast","correctVotes","byzantineFlags","lastActivity","Date","now","isOnline","emit","createProposal","data","proposalId","proposal","type","content","threshold","algorithm","creator","requiredCapabilities","metadata","votes","eligibleAgents","Set","startTime","deadline","timeout","status","result","finalRatio","participationRate","consensus","suspiciousVotes","consistencyChecks","determineEligibleAgents","setTimeout","finalizeProposal","agent","length","hasRequiredCapability","some","cap","includes","add","console","log","size","submitVote","vote","reasoning","get","Error","has","voteRecord","Boolean","timestamp","confidence","calculateVoteConfidence","detectByzantineBehavior","canFinalizeEarly","reputationFactor","experienceFactor","Math","min","consistencyFactor","recencyFactor","max","recentVotes","Array","from","values","filter","v","slice","voteChanges","reduce","changes","i","flagByzantineAgent","abs","agentHistory","minorityVotes","proposalResult","reason","warn","newWeight","flags","totalEligible","votesReceived","ceil","positiveVotes","negativeVotes","calculateVotes","totalWeightedVotes","ratio","remainingVotes","maxPossibleChange","map","a","totalWeight","voteWeight","applyConsensusAlgorithm","simpleMajorityConsensus","weightedMajorityConsensus","byzantineTolerantConsensus","unanimousConsensus","totalVotes","trustedVotes","totalTrusted","byzantineThreshold","trustedVotesOnly","allAgree","every","endTime","handleInsufficientQuorum","votingTime","updateAgentReputations","error","toFixed","majorityVote","votedWithMajority","getMetrics","activeProposals","p","totalAgents","onlineAgents","byzantineAgents","successRate","avgParticipationRate","calculateAverageParticipation","finalizedProposals","sum","getProposal","getAgent","listProposals","sort","b","cleanup","maxAge","delete","key","proposalsRemoved","historyRemoved"],"mappings":"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"}