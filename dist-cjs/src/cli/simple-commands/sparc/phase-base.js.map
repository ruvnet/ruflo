{"version":3,"sources":["../../../../../src/cli/simple-commands/sparc/phase-base.js"],"sourcesContent":["// Base class for SPARC phases\r\n// Provides common functionality for all phases\r\n\r\nexport class SparcPhase {\r\n  constructor(phaseName, taskDescription, options = {}) {\r\n    this.phaseName = phaseName;\r\n    this.taskDescription = taskDescription;\r\n    this.options = options;\r\n    this.startTime = null;\r\n    this.endTime = null;\r\n    this.artifacts = [];\r\n    this.memory = {};\r\n    this.swarmContext = null;\r\n    this.remediationContext = null;\r\n  }\r\n\r\n  /**\r\n   * Initialize phase execution\r\n   */\r\n  async initializePhase() {\r\n    this.startTime = Date.now();\r\n    console.log(`ðŸš€ Initializing ${this.phaseName} phase`);\r\n\r\n    // Load previous context from memory\r\n    if (this.options.swarmEnabled) {\r\n      await this.loadSwarmContext();\r\n    }\r\n\r\n    // Store phase start in memory\r\n    await this.storeInMemory(`${this.phaseName}_started`, {\r\n      timestamp: this.startTime,\r\n      taskDescription: this.taskDescription,\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Finalize phase execution\r\n   */\r\n  async finalizePhase() {\r\n    this.endTime = Date.now();\r\n    const duration = this.endTime - this.startTime;\r\n\r\n    console.log(`âœ… ${this.phaseName} phase completed in ${duration}ms`);\r\n\r\n    // Store phase completion in memory\r\n    await this.storeInMemory(`${this.phaseName}_completed`, {\r\n      timestamp: this.endTime,\r\n      duration: duration,\r\n      artifacts: this.artifacts,\r\n    });\r\n\r\n    // Update swarm context if enabled\r\n    if (this.options.swarmEnabled) {\r\n      await this.updateSwarmContext();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Store data in memory system\r\n   */\r\n  async storeInMemory(key, data) {\r\n    try {\r\n      const memoryKey = `${this.options.namespace}_${key}`;\r\n      const memoryData = JSON.stringify(data);\r\n\r\n      // Store in local memory\r\n      this.memory[key] = data;\r\n\r\n      // Store in swarm memory if enabled\r\n      if (this.options.swarmEnabled) {\r\n        await this.storeInSwarmMemory(memoryKey, memoryData);\r\n      }\r\n\r\n      console.log(`ðŸ’¾ Stored in memory: ${memoryKey}`);\r\n    } catch (error) {\r\n      console.warn(`âš ï¸ Failed to store in memory: ${error.message}`);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Retrieve data from memory system\r\n   */\r\n  async retrieveFromMemory(key) {\r\n    try {\r\n      const memoryKey = `${this.options.namespace}_${key}`;\r\n\r\n      // Try local memory first\r\n      if (this.memory[key]) {\r\n        return this.memory[key];\r\n      }\r\n\r\n      // Try swarm memory if enabled\r\n      if (this.options.swarmEnabled) {\r\n        return await this.retrieveFromSwarmMemory(memoryKey);\r\n      }\r\n\r\n      return null;\r\n    } catch (error) {\r\n      console.warn(`âš ï¸ Failed to retrieve from memory: ${error.message}`);\r\n      return null;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Store data in swarm memory\r\n   */\r\n  async storeInSwarmMemory(key, data) {\r\n    if (!this.options.swarmEnabled) return;\r\n\r\n    try {\r\n      // Use ruv-swarm memory hooks\r\n      const { spawn } = await import('child_process');\r\n\r\n      return new Promise((resolve, reject) => {\r\n        const process = spawn(\r\n          'npx',\r\n          ['ruv-swarm', 'hook', 'memory-store', '--key', key, '--data', data],\r\n          {\r\n            stdio: 'pipe',\r\n          },\r\n        );\r\n\r\n        let output = '';\r\n        process.stdout.on('data', (data) => {\r\n          output += data.toString();\r\n        });\r\n\r\n        process.on('close', (code) => {\r\n          if (code === 0) {\r\n            resolve(output);\r\n          } else {\r\n            reject(new Error(`Memory store failed with code ${code}`));\r\n          }\r\n        });\r\n      });\r\n    } catch (error) {\r\n      console.warn(`âš ï¸ Failed to store in swarm memory: ${error.message}`);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Retrieve data from swarm memory\r\n   */\r\n  async retrieveFromSwarmMemory(key) {\r\n    if (!this.options.swarmEnabled) return null;\r\n\r\n    try {\r\n      const { spawn } = await import('child_process');\r\n\r\n      return new Promise((resolve, reject) => {\r\n        const process = spawn('npx', ['ruv-swarm', 'hook', 'memory-retrieve', '--key', key], {\r\n          stdio: 'pipe',\r\n        });\r\n\r\n        let output = '';\r\n        process.stdout.on('data', (data) => {\r\n          output += data.toString();\r\n        });\r\n\r\n        process.on('close', (code) => {\r\n          if (code === 0) {\r\n            try {\r\n              const data = JSON.parse(output);\r\n              resolve(data);\r\n            } catch (parseError) {\r\n              resolve(null);\r\n            }\r\n          } else {\r\n            resolve(null);\r\n          }\r\n        });\r\n      });\r\n    } catch (error) {\r\n      console.warn(`âš ï¸ Failed to retrieve from swarm memory: ${error.message}`);\r\n      return null;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Load swarm context\r\n   */\r\n  async loadSwarmContext() {\r\n    try {\r\n      this.swarmContext = await this.retrieveFromSwarmMemory(\r\n        `${this.options.namespace}_swarm_context`,\r\n      );\r\n      if (this.swarmContext) {\r\n        console.log(`ðŸ Loaded swarm context for ${this.phaseName}`);\r\n      }\r\n    } catch (error) {\r\n      console.warn(`âš ï¸ Failed to load swarm context: ${error.message}`);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Update swarm context\r\n   */\r\n  async updateSwarmContext() {\r\n    try {\r\n      const contextUpdate = {\r\n        phase: this.phaseName,\r\n        timestamp: Date.now(),\r\n        artifacts: this.artifacts,\r\n        memory: this.memory,\r\n        status: 'completed',\r\n      };\r\n\r\n      await this.storeInSwarmMemory(\r\n        `${this.options.namespace}_swarm_context`,\r\n        JSON.stringify(contextUpdate),\r\n      );\r\n      console.log(`ðŸ Updated swarm context for ${this.phaseName}`);\r\n    } catch (error) {\r\n      console.warn(`âš ï¸ Failed to update swarm context: ${error.message}`);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Save artifact to file system\r\n   */\r\n  async saveArtifact(filename, content) {\r\n    try {\r\n      const fs = await import('fs/promises');\r\n      const path = await import('path');\r\n\r\n      const artifactDir = path.join(process.cwd(), 'sparc-artifacts', this.options.namespace);\r\n      await fs.mkdir(artifactDir, { recursive: true });\r\n\r\n      const filePath = path.join(artifactDir, filename);\r\n      await fs.writeFile(filePath, content, 'utf8');\r\n\r\n      this.artifacts.push({\r\n        filename,\r\n        path: filePath,\r\n        timestamp: Date.now(),\r\n      });\r\n\r\n      console.log(`ðŸ“„ Saved artifact: ${filename}`);\r\n      return filePath;\r\n    } catch (error) {\r\n      console.warn(`âš ï¸ Failed to save artifact: ${error.message}`);\r\n      return null;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Load artifact from file system\r\n   */\r\n  async loadArtifact(filename) {\r\n    try {\r\n      const fs = await import('fs/promises');\r\n      const path = await import('path');\r\n\r\n      const artifactDir = path.join(process.cwd(), 'sparc-artifacts', this.options.namespace);\r\n      const filePath = path.join(artifactDir, filename);\r\n\r\n      const content = await fs.readFile(filePath, 'utf8');\r\n      return content;\r\n    } catch (error) {\r\n      console.warn(`âš ï¸ Failed to load artifact: ${error.message}`);\r\n      return null;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Set remediation context for quality gate failures\r\n   */\r\n  setRemediationContext(qualityGate) {\r\n    this.remediationContext = qualityGate;\r\n    console.log(\r\n      `ðŸ”§ Set remediation context for ${this.phaseName}: ${qualityGate.reasons.join(', ')}`,\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Get phase metrics\r\n   */\r\n  getMetrics() {\r\n    return {\r\n      phaseName: this.phaseName,\r\n      duration: this.endTime ? this.endTime - this.startTime : null,\r\n      artifactsCount: this.artifacts.length,\r\n      memoryKeys: Object.keys(this.memory).length,\r\n      hasSwarmContext: !!this.swarmContext,\r\n      hasRemediationContext: !!this.remediationContext,\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Validate phase prerequisites\r\n   */\r\n  async validatePrerequisites() {\r\n    // Base validation - override in subclasses\r\n    return { valid: true, reasons: [] };\r\n  }\r\n\r\n  /**\r\n   * Execute phase - must be implemented by subclasses\r\n   */\r\n  async execute() {\r\n    throw new Error(`Execute method must be implemented by ${this.phaseName} phase`);\r\n  }\r\n\r\n  /**\r\n   * Get phase status\r\n   */\r\n  getStatus() {\r\n    return {\r\n      phase: this.phaseName,\r\n      started: !!this.startTime,\r\n      completed: !!this.endTime,\r\n      duration: this.endTime ? this.endTime - this.startTime : null,\r\n      artifacts: this.artifacts.length,\r\n      hasContext: !!this.swarmContext,\r\n      hasRemediation: !!this.remediationContext,\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Neural learning hook\r\n   */\r\n  async recordLearning(learningData) {\r\n    if (!this.options.neuralLearning) return;\r\n\r\n    try {\r\n      const learningRecord = {\r\n        phase: this.phaseName,\r\n        timestamp: Date.now(),\r\n        data: learningData,\r\n        context: {\r\n          task: this.taskDescription,\r\n          options: this.options,\r\n          metrics: this.getMetrics(),\r\n        },\r\n      };\r\n\r\n      await this.storeInMemory(`learning_${Date.now()}`, learningRecord);\r\n\r\n      // Store in neural learning system if available\r\n      if (this.options.swarmEnabled) {\r\n        await this.storeInSwarmMemory(\r\n          `neural_learning_${this.phaseName}`,\r\n          JSON.stringify(learningRecord),\r\n        );\r\n      }\r\n\r\n      console.log(`ðŸ§  Recorded learning for ${this.phaseName}`);\r\n    } catch (error) {\r\n      console.warn(`âš ï¸ Failed to record learning: ${error.message}`);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get learning insights\r\n   */\r\n  async getLearningInsights() {\r\n    if (!this.options.neuralLearning) return [];\r\n\r\n    try {\r\n      const insights = [];\r\n\r\n      // Analyze previous executions\r\n      const learningKeys = Object.keys(this.memory).filter((key) => key.startsWith('learning_'));\r\n\r\n      for (const key of learningKeys) {\r\n        const record = this.memory[key];\r\n        if (record && record.phase === this.phaseName) {\r\n          insights.push({\r\n            timestamp: record.timestamp,\r\n            insight: this.generateInsight(record),\r\n            confidence: this.calculateConfidence(record),\r\n          });\r\n        }\r\n      }\r\n\r\n      return insights;\r\n    } catch (error) {\r\n      console.warn(`âš ï¸ Failed to get learning insights: ${error.message}`);\r\n      return [];\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Generate insight from learning record\r\n   */\r\n  generateInsight(record) {\r\n    // Basic insight generation - can be enhanced with ML\r\n    const patterns = this.identifyPatterns(record);\r\n    return `Pattern identified: ${patterns.join(', ')}`;\r\n  }\r\n\r\n  /**\r\n   * Calculate confidence score\r\n   */\r\n  calculateConfidence(record) {\r\n    // Simple confidence calculation based on recency and success\r\n    const age = Date.now() - record.timestamp;\r\n    const recencyScore = Math.max(0, 1 - age / (24 * 60 * 60 * 1000)); // Decay over 24 hours\r\n    const successScore = record.data.success ? 1 : 0.5;\r\n\r\n    return (recencyScore + successScore) / 2;\r\n  }\r\n\r\n  /**\r\n   * Identify patterns in learning data\r\n   */\r\n  identifyPatterns(record) {\r\n    const patterns = [];\r\n\r\n    if (record.data.duration) {\r\n      if (record.data.duration > 60000) {\r\n        patterns.push('Long execution time');\r\n      } else if (record.data.duration < 10000) {\r\n        patterns.push('Fast execution');\r\n      }\r\n    }\r\n\r\n    if (record.data.errors && record.data.errors.length > 0) {\r\n      patterns.push('Error prone');\r\n    }\r\n\r\n    if (record.data.qualityGate && !record.data.qualityGate.passed) {\r\n      patterns.push('Quality gate failures');\r\n    }\r\n\r\n    return patterns;\r\n  }\r\n}\r\n\r\nexport default SparcPhase;\r\n"],"names":["SparcPhase","phaseName","taskDescription","options","startTime","endTime","artifacts","memory","swarmContext","remediationContext","initializePhase","Date","now","console","log","swarmEnabled","loadSwarmContext","storeInMemory","timestamp","finalizePhase","duration","updateSwarmContext","key","data","memoryKey","namespace","memoryData","JSON","stringify","storeInSwarmMemory","error","warn","message","retrieveFromMemory","retrieveFromSwarmMemory","spawn","Promise","resolve","reject","process","stdio","output","stdout","on","toString","code","Error","parse","parseError","contextUpdate","phase","status","saveArtifact","filename","content","fs","path","artifactDir","join","cwd","mkdir","recursive","filePath","writeFile","push","loadArtifact","readFile","setRemediationContext","qualityGate","reasons","getMetrics","artifactsCount","length","memoryKeys","Object","keys","hasSwarmContext","hasRemediationContext","validatePrerequisites","valid","execute","getStatus","started","completed","hasContext","hasRemediation","recordLearning","learningData","neuralLearning","learningRecord","context","task","metrics","getLearningInsights","insights","learningKeys","filter","startsWith","record","insight","generateInsight","confidence","calculateConfidence","patterns","identifyPatterns","age","recencyScore","Math","max","successScore","success","errors","passed"],"mappings":"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"}