{"version":3,"sources":["../../../src/monitoring/real-time-monitor.ts"],"sourcesContent":["/**\r\n * Real-time monitoring system for swarm operations\r\n */\r\n\r\nimport { EventEmitter } from 'node:events';\r\nimport type { ILogger } from '../core/logger.js';\r\nimport type { IEventBus } from '../core/event-bus.js';\r\nimport type {\r\n  SystemMetrics,\r\n  Alert,\r\n  AlertLevel,\r\n  AlertType,\r\n  MonitoringConfig,\r\n  AgentMetrics,\r\n  SwarmMetrics,\r\n  AgentId,\r\n} from '../swarm/types.js';\r\nimport type { DistributedMemorySystem } from '../memory/distributed-memory.js';\r\n\r\nexport interface MonitorConfig {\r\n  updateInterval: number;\r\n  retentionPeriod: number;\r\n  alertingEnabled: boolean;\r\n  alertThresholds: AlertThresholds;\r\n  metricsEnabled: boolean;\r\n  tracingEnabled: boolean;\r\n  dashboardEnabled: boolean;\r\n  exportEnabled: boolean;\r\n  exportFormat: 'json' | 'csv' | 'prometheus';\r\n  debugMode: boolean;\r\n}\r\n\r\nexport interface AlertThresholds {\r\n  cpu: { warning: number; critical: number };\r\n  memory: { warning: number; critical: number };\r\n  disk: { warning: number; critical: number };\r\n  errorRate: { warning: number; critical: number };\r\n  responseTime: { warning: number; critical: number };\r\n  queueDepth: { warning: number; critical: number };\r\n  agentHealth: { warning: number; critical: number };\r\n  swarmUtilization: { warning: number; critical: number };\r\n}\r\n\r\nexport interface MetricPoint {\r\n  timestamp: Date;\r\n  value: number;\r\n  tags: Record<string, string>;\r\n  metadata?: Record<string, any>;\r\n}\r\n\r\nexport interface TimeSeries {\r\n  name: string;\r\n  points: MetricPoint[];\r\n  aggregations: {\r\n    min: number;\r\n    max: number;\r\n    avg: number;\r\n    sum: number;\r\n    count: number;\r\n  };\r\n  lastUpdated: Date;\r\n}\r\n\r\nexport interface MonitoringDashboard {\r\n  title: string;\r\n  panels: DashboardPanel[];\r\n  refreshInterval: number;\r\n  timeRange: { start: Date; end: Date };\r\n  filters: Record<string, any>;\r\n}\r\n\r\nexport interface DashboardPanel {\r\n  id: string;\r\n  title: string;\r\n  type: 'line' | 'bar' | 'gauge' | 'table' | 'heatmap' | 'stat';\r\n  metrics: string[];\r\n  config: {\r\n    width: number;\r\n    height: number;\r\n    position: { x: number; y: number };\r\n    visualization: Record<string, any>;\r\n  };\r\n}\r\n\r\nexport interface AlertRule {\r\n  id: string;\r\n  name: string;\r\n  enabled: boolean;\r\n  metric: string;\r\n  condition: 'gt' | 'lt' | 'eq' | 'gte' | 'lte';\r\n  threshold: number;\r\n  duration: number; // How long condition must persist\r\n  severity: AlertLevel;\r\n  tags: Record<string, string>;\r\n  actions: AlertAction[];\r\n  suppressions: AlertSuppression[];\r\n}\r\n\r\nexport interface AlertAction {\r\n  type: 'email' | 'webhook' | 'slack' | 'log' | 'auto-scale' | 'restart';\r\n  config: Record<string, any>;\r\n  enabled: boolean;\r\n}\r\n\r\nexport interface AlertSuppression {\r\n  condition: string;\r\n  duration: number;\r\n  reason: string;\r\n}\r\n\r\nexport interface HealthCheck {\r\n  name: string;\r\n  type: 'http' | 'tcp' | 'custom';\r\n  target: string;\r\n  interval: number;\r\n  timeout: number;\r\n  retries: number;\r\n  expectedResponse?: any;\r\n  customCheck?: () => Promise<boolean>;\r\n}\r\n\r\n/**\r\n * Comprehensive real-time monitoring and alerting system\r\n */\r\nexport class RealTimeMonitor extends EventEmitter {\r\n  private logger: ILogger;\r\n  private eventBus: IEventBus;\r\n  private memory: DistributedMemorySystem;\r\n  private config: MonitorConfig;\r\n\r\n  // Metrics storage\r\n  private timeSeries = new Map<string, TimeSeries>();\r\n  private activeAlerts = new Map<string, Alert>();\r\n  private alertHistory: Alert[] = [];\r\n\r\n  // Monitoring state\r\n  private monitoringInterval?: NodeJS.Timeout;\r\n  private healthCheckInterval?: NodeJS.Timeout;\r\n  private alertRules = new Map<string, AlertRule>();\r\n  private healthChecks = new Map<string, HealthCheck>();\r\n\r\n  // System state tracking\r\n  private systemMetrics: SystemMetrics;\r\n  private agentMetrics = new Map<string, AgentMetrics>();\r\n  private swarmMetrics: SwarmMetrics;\r\n\r\n  // Dashboards\r\n  private dashboards = new Map<string, MonitoringDashboard>();\r\n\r\n  // Performance tracking\r\n  private lastMetricsUpdate = new Date();\r\n  private metricsBuffer: MetricPoint[] = [];\r\n  private alertProcessor?: NodeJS.Timeout;\r\n\r\n  constructor(\r\n    config: Partial<MonitorConfig>,\r\n    logger: ILogger,\r\n    eventBus: IEventBus,\r\n    memory: DistributedMemorySystem,\r\n  ) {\r\n    super();\r\n    this.logger = logger;\r\n    this.eventBus = eventBus;\r\n    this.memory = memory;\r\n\r\n    this.config = {\r\n      updateInterval: 5000,\r\n      retentionPeriod: 86400000, // 24 hours\r\n      alertingEnabled: true,\r\n      alertThresholds: {\r\n        cpu: { warning: 70, critical: 90 },\r\n        memory: { warning: 80, critical: 95 },\r\n        disk: { warning: 85, critical: 95 },\r\n        errorRate: { warning: 5, critical: 10 },\r\n        responseTime: { warning: 5000, critical: 10000 },\r\n        queueDepth: { warning: 10, critical: 20 },\r\n        agentHealth: { warning: 0.7, critical: 0.5 },\r\n        swarmUtilization: { warning: 0.8, critical: 0.95 },\r\n      },\r\n      metricsEnabled: true,\r\n      tracingEnabled: true,\r\n      dashboardEnabled: true,\r\n      exportEnabled: false,\r\n      exportFormat: 'json',\r\n      debugMode: false,\r\n      ...config,\r\n    };\r\n\r\n    this.systemMetrics = this.initializeSystemMetrics();\r\n    this.swarmMetrics = this.initializeSwarmMetrics();\r\n\r\n    this.setupEventHandlers();\r\n    this.initializeDefaultAlertRules();\r\n    this.initializeDefaultDashboards();\r\n  }\r\n\r\n  private setupEventHandlers(): void {\r\n    // Agent events\r\n    this.eventBus.on('agent:metrics-update', (data) => {\r\n      this.updateAgentMetrics(data.agentId, data.metrics);\r\n    });\r\n\r\n    this.eventBus.on('agent:status-changed', (data) => {\r\n      this.recordMetric('agent.status.change', 1, {\r\n        agentId: data.agentId,\r\n        from: data.from,\r\n        to: data.to,\r\n      });\r\n    });\r\n\r\n    // Task events\r\n    this.eventBus.on('task:started', (data) => {\r\n      this.recordMetric('task.started', 1, { taskId: data.taskId, agentId: data.agentId });\r\n    });\r\n\r\n    this.eventBus.on('task:completed', (data) => {\r\n      this.recordMetric('task.completed', 1, { taskId: data.taskId });\r\n      this.recordMetric('task.duration', data.duration, { taskId: data.taskId });\r\n    });\r\n\r\n    this.eventBus.on('task:failed', (data) => {\r\n      this.recordMetric('task.failed', 1, { taskId: data.taskId, error: data.error });\r\n    });\r\n\r\n    // System events\r\n    this.eventBus.on('system:resource-update', (data) => {\r\n      this.updateSystemMetrics(data);\r\n    });\r\n\r\n    this.eventBus.on('swarm:metrics-update', (data) => {\r\n      this.updateSwarmMetrics(data.metrics);\r\n    });\r\n\r\n    // Error events\r\n    this.eventBus.on('error', (data) => {\r\n      this.handleError(data);\r\n    });\r\n  }\r\n\r\n  async initialize(): Promise<void> {\r\n    this.logger.info('Initializing real-time monitor', {\r\n      updateInterval: this.config.updateInterval,\r\n      alerting: this.config.alertingEnabled,\r\n      dashboard: this.config.dashboardEnabled,\r\n    });\r\n\r\n    // Start monitoring loops\r\n    this.startMetricsCollection();\r\n    this.startHealthChecks();\r\n\r\n    if (this.config.alertingEnabled) {\r\n      this.startAlertProcessing();\r\n    }\r\n\r\n    // Initialize default health checks\r\n    this.initializeHealthChecks();\r\n\r\n    this.emit('monitor:initialized');\r\n  }\r\n\r\n  async shutdown(): Promise<void> {\r\n    this.logger.info('Shutting down real-time monitor');\r\n\r\n    // Stop all intervals\r\n    if (this.monitoringInterval) clearInterval(this.monitoringInterval);\r\n    if (this.healthCheckInterval) clearInterval(this.healthCheckInterval);\r\n    if (this.alertProcessor) clearInterval(this.alertProcessor);\r\n\r\n    // Flush any remaining metrics\r\n    await this.flushMetrics();\r\n\r\n    this.emit('monitor:shutdown');\r\n  }\r\n\r\n  // === METRICS COLLECTION ===\r\n\r\n  private startMetricsCollection(): void {\r\n    this.monitoringInterval = setInterval(() => {\r\n      this.collectSystemMetrics();\r\n      this.processMetricsBuffer();\r\n      this.cleanupOldMetrics();\r\n    }, this.config.updateInterval);\r\n\r\n    this.logger.info('Started metrics collection', {\r\n      interval: this.config.updateInterval,\r\n    });\r\n  }\r\n\r\n  private async collectSystemMetrics(): Promise<void> {\r\n    try {\r\n      // Update system metrics\r\n      this.systemMetrics = {\r\n        ...this.systemMetrics,\r\n        timestamp: new Date(),\r\n        cpuUsage: await this.getCpuUsage(),\r\n        memoryUsage: await this.getMemoryUsage(),\r\n        diskUsage: await this.getDiskUsage(),\r\n        networkUsage: await this.getNetworkUsage(),\r\n      };\r\n\r\n      // Record as time series\r\n      this.recordMetric('system.cpu', this.systemMetrics.cpuUsage);\r\n      this.recordMetric('system.memory', this.systemMetrics.memoryUsage);\r\n      this.recordMetric('system.disk', this.systemMetrics.diskUsage);\r\n      this.recordMetric('system.network', this.systemMetrics.networkUsage);\r\n\r\n      // Update swarm-level metrics\r\n      await this.updateSwarmLevelMetrics();\r\n    } catch (error) {\r\n      this.logger.error('Failed to collect system metrics', error);\r\n    }\r\n  }\r\n\r\n  private async updateSwarmLevelMetrics(): Promise<void> {\r\n    const agents = Array.from(this.agentMetrics.values());\r\n\r\n    this.swarmMetrics = {\r\n      ...this.swarmMetrics,\r\n      agentUtilization: this.calculateAgentUtilization(agents),\r\n      throughput: this.calculateSwarmThroughput(agents),\r\n      latency: this.calculateAverageLatency(agents),\r\n      efficiency: this.calculateSwarmEfficiency(agents),\r\n      reliability: this.calculateSwarmReliability(agents),\r\n      averageQuality: this.calculateAverageQuality(agents),\r\n    };\r\n\r\n    // Record swarm metrics\r\n    this.recordMetric('swarm.utilization', this.swarmMetrics.agentUtilization);\r\n    this.recordMetric('swarm.throughput', this.swarmMetrics.throughput);\r\n    this.recordMetric('swarm.latency', this.swarmMetrics.latency);\r\n    this.recordMetric('swarm.efficiency', this.swarmMetrics.efficiency);\r\n    this.recordMetric('swarm.reliability', this.swarmMetrics.reliability);\r\n  }\r\n\r\n  recordMetric(name: string, value: number, tags: Record<string, string> = {}): void {\r\n    const point: MetricPoint = {\r\n      timestamp: new Date(),\r\n      value,\r\n      tags,\r\n    };\r\n\r\n    // Add to buffer for batch processing\r\n    this.metricsBuffer.push({ ...point, tags: { ...tags, metric: name } });\r\n\r\n    // Immediate processing for critical metrics\r\n    if (this.isCriticalMetric(name)) {\r\n      this.processMetricPoint(name, point);\r\n    }\r\n  }\r\n\r\n  private processMetricsBuffer(): void {\r\n    if (this.metricsBuffer.length === 0) return;\r\n\r\n    // Group by metric name\r\n    const metricGroups = new Map<string, MetricPoint[]>();\r\n    for (const point of this.metricsBuffer) {\r\n      const metricName = point.tags.metric || 'unknown';\r\n      const group = metricGroups.get(metricName) || [];\r\n      group.push(point);\r\n      metricGroups.set(metricName, group);\r\n    }\r\n\r\n    // Process each metric group\r\n    for (const [metricName, points] of metricGroups) {\r\n      for (const point of points) {\r\n        this.processMetricPoint(metricName, point);\r\n      }\r\n    }\r\n\r\n    // Clear buffer\r\n    this.metricsBuffer = [];\r\n  }\r\n\r\n  private processMetricPoint(metricName: string, point: MetricPoint): void {\r\n    let series = this.timeSeries.get(metricName);\r\n\r\n    if (!series) {\r\n      series = {\r\n        name: metricName,\r\n        points: [],\r\n        aggregations: {\r\n          min: point.value,\r\n          max: point.value,\r\n          avg: point.value,\r\n          sum: point.value,\r\n          count: 1,\r\n        },\r\n        lastUpdated: point.timestamp,\r\n      };\r\n      this.timeSeries.set(metricName, series);\r\n    }\r\n\r\n    // Add point\r\n    series.points.push(point);\r\n    series.lastUpdated = point.timestamp;\r\n\r\n    // Update aggregations\r\n    series.aggregations.count++;\r\n    series.aggregations.sum += point.value;\r\n    series.aggregations.avg = series.aggregations.sum / series.aggregations.count;\r\n    series.aggregations.min = Math.min(series.aggregations.min, point.value);\r\n    series.aggregations.max = Math.max(series.aggregations.max, point.value);\r\n\r\n    // Trigger alert checking for this metric\r\n    if (this.config.alertingEnabled) {\r\n      this.checkAlertsForMetric(metricName, point);\r\n    }\r\n  }\r\n\r\n  // === ALERTING ===\r\n\r\n  private startAlertProcessing(): void {\r\n    this.alertProcessor = setInterval(() => {\r\n      this.processAlerts();\r\n    }, 1000); // Process alerts every second\r\n\r\n    this.logger.info('Started alert processing');\r\n  }\r\n\r\n  private processAlerts(): void {\r\n    const now = new Date();\r\n\r\n    // Check for alert resolution\r\n    for (const [alertId, alert] of this.activeAlerts) {\r\n      if (!alert.resolved) {\r\n        const rule = this.alertRules.get(alert.context.ruleId);\r\n        if (rule && this.isAlertResolved(rule, alert)) {\r\n          this.resolveAlert(alertId, 'condition_resolved');\r\n        }\r\n      }\r\n    }\r\n\r\n    // Clean up old resolved alerts\r\n    this.cleanupResolvedAlerts();\r\n  }\r\n\r\n  private checkAlertsForMetric(metricName: string, point: MetricPoint): void {\r\n    for (const [ruleId, rule] of this.alertRules) {\r\n      if (rule.enabled && rule.metric === metricName) {\r\n        this.evaluateAlertRule(rule, point);\r\n      }\r\n    }\r\n  }\r\n\r\n  private evaluateAlertRule(rule: AlertRule, point: MetricPoint): void {\r\n    const conditionMet = this.evaluateCondition(rule.condition, point.value, rule.threshold);\r\n\r\n    if (conditionMet) {\r\n      // Check if we already have an active alert for this rule\r\n      const existingAlert = Array.from(this.activeAlerts.values()).find(\r\n        (alert) => alert.context.ruleId === rule.id && !alert.resolved,\r\n      );\r\n\r\n      if (!existingAlert) {\r\n        this.createAlert(rule, point);\r\n      }\r\n    }\r\n  }\r\n\r\n  private createAlert(rule: AlertRule, triggeringPoint: MetricPoint): void {\r\n    const alertId = `alert-${Date.now()}-${Math.random().toString(36).slice(2)}`;\r\n\r\n    const alert: Alert = {\r\n      id: alertId,\r\n      timestamp: new Date(),\r\n      level: rule.severity,\r\n      type: this.getAlertTypeFromMetric(rule.metric),\r\n      message: `${rule.name}: ${rule.metric} ${rule.condition} ${rule.threshold} (current: ${triggeringPoint.value})`,\r\n      source: 'real-time-monitor',\r\n      context: {\r\n        ruleId: rule.id,\r\n        metric: rule.metric,\r\n        value: triggeringPoint.value,\r\n        threshold: rule.threshold,\r\n        tags: { ...rule.tags, ...triggeringPoint.tags },\r\n      },\r\n      acknowledged: false,\r\n      resolved: false,\r\n      escalationLevel: 0,\r\n    };\r\n\r\n    this.activeAlerts.set(alertId, alert);\r\n    this.alertHistory.push(alert);\r\n\r\n    this.logger.warn('Alert created', {\r\n      alertId,\r\n      rule: rule.name,\r\n      metric: rule.metric,\r\n      value: triggeringPoint.value,\r\n      threshold: rule.threshold,\r\n    });\r\n\r\n    this.emit('alert:created', { alert });\r\n\r\n    // Execute alert actions\r\n    this.executeAlertActions(rule, alert);\r\n  }\r\n\r\n  private executeAlertActions(rule: AlertRule, alert: Alert): void {\r\n    for (const action of rule.actions) {\r\n      if (!action.enabled) continue;\r\n\r\n      try {\r\n        switch (action.type) {\r\n          case 'log':\r\n            this.logger.warn(`ALERT: ${alert.message}`, alert.context);\r\n            break;\r\n\r\n          case 'email':\r\n            this.sendEmailAlert(alert, action.config);\r\n            break;\r\n\r\n          case 'webhook':\r\n            this.sendWebhookAlert(alert, action.config);\r\n            break;\r\n\r\n          case 'auto-scale':\r\n            this.triggerAutoScale(alert, action.config);\r\n            break;\r\n\r\n          case 'restart':\r\n            this.triggerRestart(alert, action.config);\r\n            break;\r\n\r\n          default:\r\n            this.logger.warn('Unknown alert action type', { type: action.type });\r\n        }\r\n      } catch (error) {\r\n        this.logger.error('Failed to execute alert action', {\r\n          alertId: alert.id,\r\n          actionType: action.type,\r\n          error,\r\n        });\r\n      }\r\n    }\r\n  }\r\n\r\n  private resolveAlert(alertId: string, reason: string): void {\r\n    const alert = this.activeAlerts.get(alertId);\r\n    if (!alert) return;\r\n\r\n    alert.resolved = true;\r\n    alert.context.resolutionReason = reason;\r\n    alert.context.resolvedAt = new Date();\r\n\r\n    this.logger.info('Alert resolved', { alertId, reason });\r\n    this.emit('alert:resolved', { alert, reason });\r\n  }\r\n\r\n  // === HEALTH CHECKS ===\r\n\r\n  private startHealthChecks(): void {\r\n    this.healthCheckInterval = setInterval(() => {\r\n      this.performHealthChecks();\r\n    }, 30000); // Every 30 seconds\r\n\r\n    this.logger.info('Started health checks');\r\n  }\r\n\r\n  private async performHealthChecks(): Promise<void> {\r\n    const checks = Array.from(this.healthChecks.values());\r\n    const promises = checks.map((check) => this.executeHealthCheck(check));\r\n\r\n    await Promise.allSettled(promises);\r\n  }\r\n\r\n  private async executeHealthCheck(check: HealthCheck): Promise<void> {\r\n    try {\r\n      let isHealthy = false;\r\n\r\n      switch (check.type) {\r\n        case 'http':\r\n          isHealthy = await this.performHttpHealthCheck(check);\r\n          break;\r\n        case 'tcp':\r\n          isHealthy = await this.performTcpHealthCheck(check);\r\n          break;\r\n        case 'custom':\r\n          if (check.customCheck) {\r\n            isHealthy = await check.customCheck();\r\n          }\r\n          break;\r\n      }\r\n\r\n      this.recordMetric(`healthcheck.${check.name}`, isHealthy ? 1 : 0, {\r\n        type: check.type,\r\n        target: check.target,\r\n      });\r\n    } catch (error) {\r\n      this.logger.error('Health check failed', { check: check.name, error });\r\n      this.recordMetric(`healthcheck.${check.name}`, 0, {\r\n        type: check.type,\r\n        target: check.target,\r\n        error: error instanceof Error ? error.message : String(error),\r\n      });\r\n    }\r\n  }\r\n\r\n  // === DASHBOARD MANAGEMENT ===\r\n\r\n  createDashboard(title: string, panels: DashboardPanel[]): string {\r\n    const dashboardId = `dashboard-${Date.now()}`;\r\n\r\n    const dashboard: MonitoringDashboard = {\r\n      title,\r\n      panels,\r\n      refreshInterval: 30000,\r\n      timeRange: {\r\n        start: new Date(Date.now() - 3600000), // Last hour\r\n        end: new Date(),\r\n      },\r\n      filters: {},\r\n    };\r\n\r\n    this.dashboards.set(dashboardId, dashboard);\r\n    this.emit('dashboard:created', { dashboardId, dashboard });\r\n\r\n    return dashboardId;\r\n  }\r\n\r\n  getDashboardData(dashboardId: string): any {\r\n    const dashboard = this.dashboards.get(dashboardId);\r\n    if (!dashboard) return null;\r\n\r\n    const data: any = {\r\n      dashboard,\r\n      panels: [],\r\n    };\r\n\r\n    for (const panel of dashboard.panels) {\r\n      const panelData = {\r\n        id: panel.id,\r\n        title: panel.title,\r\n        type: panel.type,\r\n        data: this.getPanelData(panel, dashboard.timeRange),\r\n      };\r\n      data.panels.push(panelData);\r\n    }\r\n\r\n    return data;\r\n  }\r\n\r\n  private getPanelData(panel: DashboardPanel, timeRange: { start: Date; end: Date }): any {\r\n    const data: any = {};\r\n\r\n    for (const metricName of panel.metrics) {\r\n      const series = this.timeSeries.get(metricName);\r\n      if (series) {\r\n        // Filter points by time range\r\n        const filteredPoints = series.points.filter(\r\n          (point) => point.timestamp >= timeRange.start && point.timestamp <= timeRange.end,\r\n        );\r\n\r\n        data[metricName] = {\r\n          points: filteredPoints,\r\n          aggregations: this.calculateAggregations(filteredPoints),\r\n        };\r\n      }\r\n    }\r\n\r\n    return data;\r\n  }\r\n\r\n  // === UTILITY METHODS ===\r\n\r\n  private async getCpuUsage(): Promise<number> {\r\n    // Placeholder - would use actual system APIs\r\n    return Math.random() * 100;\r\n  }\r\n\r\n  private async getMemoryUsage(): Promise<number> {\r\n    // Placeholder - would use actual system APIs\r\n    return Math.random() * 100;\r\n  }\r\n\r\n  private async getDiskUsage(): Promise<number> {\r\n    // Placeholder - would use actual system APIs\r\n    return Math.random() * 100;\r\n  }\r\n\r\n  private async getNetworkUsage(): Promise<number> {\r\n    // Placeholder - would use actual system APIs\r\n    return Math.random() * 1024 * 1024; // bytes\r\n  }\r\n\r\n  private updateAgentMetrics(agentId: string, metrics: AgentMetrics): void {\r\n    this.agentMetrics.set(agentId, metrics);\r\n\r\n    // Record individual agent metrics\r\n    this.recordMetric('agent.cpu', metrics.cpuUsage, { agentId });\r\n    this.recordMetric('agent.memory', metrics.memoryUsage, { agentId });\r\n    this.recordMetric('agent.tasks.completed', metrics.tasksCompleted, { agentId });\r\n    this.recordMetric('agent.tasks.failed', metrics.tasksFailed, { agentId });\r\n    this.recordMetric('agent.response.time', metrics.responseTime, { agentId });\r\n  }\r\n\r\n  private updateSystemMetrics(data: Partial<SystemMetrics>): void {\r\n    this.systemMetrics = { ...this.systemMetrics, ...data };\r\n  }\r\n\r\n  private updateSwarmMetrics(metrics: SwarmMetrics): void {\r\n    this.swarmMetrics = { ...this.swarmMetrics, ...metrics };\r\n  }\r\n\r\n  private handleError(data: any): void {\r\n    this.recordMetric('error.count', 1, {\r\n      type: data.type || 'unknown',\r\n      source: data.source || 'unknown',\r\n    });\r\n\r\n    // Create critical alert for errors\r\n    if (data.severity === 'critical') {\r\n      const alertId = `error-alert-${Date.now()}`;\r\n      const alert: Alert = {\r\n        id: alertId,\r\n        timestamp: new Date(),\r\n        level: 'critical',\r\n        type: 'system',\r\n        message: `Critical error: ${data.message}`,\r\n        source: data.source || 'unknown',\r\n        context: data,\r\n        acknowledged: false,\r\n        resolved: false,\r\n        escalationLevel: 0,\r\n      };\r\n\r\n      this.activeAlerts.set(alertId, alert);\r\n      this.emit('alert:created', { alert });\r\n    }\r\n  }\r\n\r\n  private isCriticalMetric(name: string): boolean {\r\n    const criticalMetrics = [\r\n      'system.cpu',\r\n      'system.memory',\r\n      'system.disk',\r\n      'agent.health',\r\n      'task.failed',\r\n      'error.count',\r\n    ];\r\n    return criticalMetrics.includes(name);\r\n  }\r\n\r\n  private evaluateCondition(condition: string, value: number, threshold: number): boolean {\r\n    switch (condition) {\r\n      case 'gt':\r\n        return value > threshold;\r\n      case 'gte':\r\n        return value >= threshold;\r\n      case 'lt':\r\n        return value < threshold;\r\n      case 'lte':\r\n        return value <= threshold;\r\n      case 'eq':\r\n        return value === threshold;\r\n      default:\r\n        return false;\r\n    }\r\n  }\r\n\r\n  private isAlertResolved(rule: AlertRule, alert: Alert): boolean {\r\n    // Get recent metric values\r\n    const series = this.timeSeries.get(rule.metric);\r\n    if (!series || series.points.length === 0) return false;\r\n\r\n    // Check if condition is no longer met\r\n    const recentPoints = series.points.slice(-5); // Last 5 points\r\n    const allResolved = recentPoints.every(\r\n      (point) => !this.evaluateCondition(rule.condition, point.value, rule.threshold),\r\n    );\r\n\r\n    return allResolved;\r\n  }\r\n\r\n  private getAlertTypeFromMetric(metric: string): AlertType {\r\n    if (metric.includes('system')) return 'system';\r\n    if (metric.includes('agent')) return 'agent';\r\n    if (metric.includes('task')) return 'task';\r\n    if (metric.includes('swarm')) return 'swarm';\r\n    if (metric.includes('performance')) return 'performance';\r\n    if (metric.includes('resource')) return 'resource';\r\n    return 'custom';\r\n  }\r\n\r\n  private calculateAgentUtilization(agents: AgentMetrics[]): number {\r\n    if (agents.length === 0) return 0;\r\n    const totalUtilization = agents.reduce((sum, agent) => sum + agent.cpuUsage, 0);\r\n    return totalUtilization / agents.length;\r\n  }\r\n\r\n  private calculateSwarmThroughput(agents: AgentMetrics[]): number {\r\n    return agents.reduce((sum, agent) => sum + (agent.tasksCompleted || 0), 0);\r\n  }\r\n\r\n  private calculateAverageLatency(agents: AgentMetrics[]): number {\r\n    if (agents.length === 0) return 0;\r\n    const totalLatency = agents.reduce((sum, agent) => sum + agent.responseTime, 0);\r\n    return totalLatency / agents.length;\r\n  }\r\n\r\n  private calculateSwarmEfficiency(agents: AgentMetrics[]): number {\r\n    if (agents.length === 0) return 0;\r\n    const totalTasks = agents.reduce(\r\n      (sum, agent) => sum + (agent.tasksCompleted || 0) + (agent.tasksFailed || 0),\r\n      0,\r\n    );\r\n    const completedTasks = agents.reduce((sum, agent) => sum + (agent.tasksCompleted || 0), 0);\r\n    return totalTasks > 0 ? completedTasks / totalTasks : 1;\r\n  }\r\n\r\n  private calculateSwarmReliability(agents: AgentMetrics[]): number {\r\n    if (agents.length === 0) return 1;\r\n    const totalReliability = agents.reduce((sum, agent) => sum + (agent.successRate || 1), 0);\r\n    return totalReliability / agents.length;\r\n  }\r\n\r\n  private calculateAverageQuality(agents: AgentMetrics[]): number {\r\n    if (agents.length === 0) return 0.8;\r\n    const totalQuality = agents.reduce((sum, agent) => sum + (agent.codeQuality || 0.8), 0);\r\n    return totalQuality / agents.length;\r\n  }\r\n\r\n  private calculateAggregations(points: MetricPoint[]): any {\r\n    if (points.length === 0) {\r\n      return { min: 0, max: 0, avg: 0, sum: 0, count: 0 };\r\n    }\r\n\r\n    const values = points.map((p) => p.value);\r\n    return {\r\n      min: Math.min(...values),\r\n      max: Math.max(...values),\r\n      avg: values.reduce((sum, val) => sum + val, 0) / values.length,\r\n      sum: values.reduce((sum, val) => sum + val, 0),\r\n      count: values.length,\r\n    };\r\n  }\r\n\r\n  private cleanupOldMetrics(): void {\r\n    const cutoff = new Date(Date.now() - this.config.retentionPeriod);\r\n\r\n    for (const [name, series] of this.timeSeries) {\r\n      series.points = series.points.filter((point) => point.timestamp > cutoff);\r\n\r\n      if (series.points.length === 0) {\r\n        this.timeSeries.delete(name);\r\n      }\r\n    }\r\n  }\r\n\r\n  private cleanupResolvedAlerts(): void {\r\n    const cutoff = new Date(Date.now() - 86400000); // 24 hours\r\n\r\n    // Remove old resolved alerts from active alerts\r\n    for (const [alertId, alert] of this.activeAlerts) {\r\n      if (alert.resolved && alert.timestamp < cutoff) {\r\n        this.activeAlerts.delete(alertId);\r\n      }\r\n    }\r\n\r\n    // Trim alert history\r\n    this.alertHistory = this.alertHistory.filter((alert) => alert.timestamp > cutoff).slice(-1000); // Keep last 1000 alerts max\r\n  }\r\n\r\n  private async flushMetrics(): Promise<void> {\r\n    if (this.metricsBuffer.length > 0) {\r\n      this.processMetricsBuffer();\r\n    }\r\n\r\n    // Persist metrics to memory if enabled\r\n    if (this.config.exportEnabled) {\r\n      await this.exportMetrics();\r\n    }\r\n  }\r\n\r\n  private async exportMetrics(): Promise<void> {\r\n    try {\r\n      const exportData = {\r\n        timestamp: new Date(),\r\n        timeSeries: Array.from(this.timeSeries.entries()),\r\n        systemMetrics: this.systemMetrics,\r\n        swarmMetrics: this.swarmMetrics,\r\n        activeAlerts: Array.from(this.activeAlerts.values()),\r\n      };\r\n\r\n      await this.memory.store('monitoring:export', exportData, {\r\n        type: 'monitoring-export',\r\n        partition: 'metrics',\r\n      });\r\n    } catch (error) {\r\n      this.logger.error('Failed to export metrics', error);\r\n    }\r\n  }\r\n\r\n  private initializeDefaultAlertRules(): void {\r\n    const rules: AlertRule[] = [\r\n      {\r\n        id: 'cpu-warning',\r\n        name: 'High CPU Usage',\r\n        enabled: true,\r\n        metric: 'system.cpu',\r\n        condition: 'gt',\r\n        threshold: this.config.alertThresholds.cpu.warning,\r\n        duration: 60000,\r\n        severity: 'warning',\r\n        tags: { category: 'system' },\r\n        actions: [{ type: 'log', config: {}, enabled: true }],\r\n        suppressions: [],\r\n      },\r\n      {\r\n        id: 'memory-critical',\r\n        name: 'Critical Memory Usage',\r\n        enabled: true,\r\n        metric: 'system.memory',\r\n        condition: 'gt',\r\n        threshold: this.config.alertThresholds.memory.critical,\r\n        duration: 30000,\r\n        severity: 'critical',\r\n        tags: { category: 'system' },\r\n        actions: [\r\n          { type: 'log', config: {}, enabled: true },\r\n          { type: 'auto-scale', config: { action: 'scale-down' }, enabled: true },\r\n        ],\r\n        suppressions: [],\r\n      },\r\n    ];\r\n\r\n    rules.forEach((rule) => this.alertRules.set(rule.id, rule));\r\n  }\r\n\r\n  private initializeDefaultDashboards(): void {\r\n    const systemDashboard = this.createDashboard('System Overview', [\r\n      {\r\n        id: 'cpu-panel',\r\n        title: 'CPU Usage',\r\n        type: 'line',\r\n        metrics: ['system.cpu'],\r\n        config: {\r\n          width: 6,\r\n          height: 4,\r\n          position: { x: 0, y: 0 },\r\n          visualization: { yAxis: { max: 100 } },\r\n        },\r\n      },\r\n      {\r\n        id: 'memory-panel',\r\n        title: 'Memory Usage',\r\n        type: 'gauge',\r\n        metrics: ['system.memory'],\r\n        config: {\r\n          width: 6,\r\n          height: 4,\r\n          position: { x: 6, y: 0 },\r\n          visualization: { max: 100, threshold: [70, 90] },\r\n        },\r\n      },\r\n    ]);\r\n\r\n    this.logger.info('Created default dashboard', { dashboardId: systemDashboard });\r\n  }\r\n\r\n  private initializeHealthChecks(): void {\r\n    // Add default health checks\r\n    this.healthChecks.set('system', {\r\n      name: 'system',\r\n      type: 'custom',\r\n      target: 'local',\r\n      interval: 30000,\r\n      timeout: 5000,\r\n      retries: 3,\r\n      customCheck: async () => {\r\n        // Basic system health check\r\n        return this.systemMetrics.cpuUsage < 95 && this.systemMetrics.memoryUsage < 95;\r\n      },\r\n    });\r\n  }\r\n\r\n  private async performHttpHealthCheck(check: HealthCheck): Promise<boolean> {\r\n    // Placeholder for HTTP health check\r\n    return true;\r\n  }\r\n\r\n  private async performTcpHealthCheck(check: HealthCheck): Promise<boolean> {\r\n    // Placeholder for TCP health check\r\n    return true;\r\n  }\r\n\r\n  private async sendEmailAlert(alert: Alert, config: any): Promise<void> {\r\n    // Placeholder for email alert\r\n    this.logger.info('Email alert sent', { alertId: alert.id });\r\n  }\r\n\r\n  private async sendWebhookAlert(alert: Alert, config: any): Promise<void> {\r\n    // Placeholder for webhook alert\r\n    this.logger.info('Webhook alert sent', { alertId: alert.id });\r\n  }\r\n\r\n  private async triggerAutoScale(alert: Alert, config: any): Promise<void> {\r\n    // Placeholder for auto-scaling\r\n    this.logger.info('Auto-scale triggered', { alertId: alert.id, action: config.action });\r\n    this.eventBus.emit('autoscale:triggered', { alert, config });\r\n  }\r\n\r\n  private async triggerRestart(alert: Alert, config: any): Promise<void> {\r\n    // Placeholder for restart action\r\n    this.logger.info('Restart triggered', { alertId: alert.id });\r\n    this.eventBus.emit('restart:triggered', { alert, config });\r\n  }\r\n\r\n  private initializeSystemMetrics(): SystemMetrics {\r\n    return {\r\n      timestamp: new Date(),\r\n      cpuUsage: 0,\r\n      memoryUsage: 0,\r\n      diskUsage: 0,\r\n      networkUsage: 0,\r\n      activeSwarms: 0,\r\n      totalAgents: 0,\r\n      activeAgents: 0,\r\n      totalTasks: 0,\r\n      runningTasks: 0,\r\n      throughput: 0,\r\n      latency: 0,\r\n      errorRate: 0,\r\n      successRate: 100,\r\n      resourceUtilization: {},\r\n      queueLengths: {},\r\n    };\r\n  }\r\n\r\n  private initializeSwarmMetrics(): SwarmMetrics {\r\n    return {\r\n      throughput: 0,\r\n      latency: 0,\r\n      efficiency: 1.0,\r\n      reliability: 1.0,\r\n      averageQuality: 0.8,\r\n      defectRate: 0,\r\n      reworkRate: 0,\r\n      resourceUtilization: {},\r\n      costEfficiency: 1.0,\r\n      agentUtilization: 0,\r\n      agentSatisfaction: 0.8,\r\n      collaborationEffectiveness: 0.8,\r\n      scheduleVariance: 0,\r\n      deadlineAdherence: 1.0,\r\n    };\r\n  }\r\n\r\n  // === PUBLIC API ===\r\n\r\n  getSystemMetrics(): SystemMetrics {\r\n    return { ...this.systemMetrics };\r\n  }\r\n\r\n  getSwarmMetrics(): SwarmMetrics {\r\n    return { ...this.swarmMetrics };\r\n  }\r\n\r\n  getActiveAlerts(): Alert[] {\r\n    return Array.from(this.activeAlerts.values());\r\n  }\r\n\r\n  getAlertHistory(limit: number = 100): Alert[] {\r\n    return this.alertHistory.slice(-limit);\r\n  }\r\n\r\n  getTimeSeries(metricName: string): TimeSeries | undefined {\r\n    return this.timeSeries.get(metricName);\r\n  }\r\n\r\n  getAllTimeSeries(): TimeSeries[] {\r\n    return Array.from(this.timeSeries.values());\r\n  }\r\n\r\n  acknowledgeAlert(alertId: string, acknowledgedBy: string): void {\r\n    const alert = this.activeAlerts.get(alertId);\r\n    if (alert) {\r\n      alert.acknowledged = true;\r\n      alert.assignedTo = acknowledgedBy;\r\n      this.emit('alert:acknowledged', { alert, acknowledgedBy });\r\n    }\r\n  }\r\n\r\n  createAlertRule(rule: Omit<AlertRule, 'id'>): string {\r\n    const ruleId = `rule-${Date.now()}`;\r\n    this.alertRules.set(ruleId, { ...rule, id: ruleId });\r\n    return ruleId;\r\n  }\r\n\r\n  updateAlertRule(ruleId: string, updates: Partial<AlertRule>): void {\r\n    const rule = this.alertRules.get(ruleId);\r\n    if (rule) {\r\n      this.alertRules.set(ruleId, { ...rule, ...updates });\r\n    }\r\n  }\r\n\r\n  deleteAlertRule(ruleId: string): void {\r\n    this.alertRules.delete(ruleId);\r\n  }\r\n\r\n  getAlertRules(): AlertRule[] {\r\n    return Array.from(this.alertRules.values());\r\n  }\r\n\r\n  getMonitoringStatistics(): {\r\n    metricsCount: number;\r\n    activeAlerts: number;\r\n    alertRules: number;\r\n    healthChecks: number;\r\n    dashboards: number;\r\n    uptime: number;\r\n  } {\r\n    return {\r\n      metricsCount: this.timeSeries.size,\r\n      activeAlerts: this.activeAlerts.size,\r\n      alertRules: this.alertRules.size,\r\n      healthChecks: this.healthChecks.size,\r\n      dashboards: this.dashboards.size,\r\n      uptime: Date.now() - this.lastMetricsUpdate.getTime(),\r\n    };\r\n  }\r\n}\r\n"],"names":["EventEmitter","RealTimeMonitor","logger","eventBus","memory","config","timeSeries","Map","activeAlerts","alertHistory","monitoringInterval","healthCheckInterval","alertRules","healthChecks","systemMetrics","agentMetrics","swarmMetrics","dashboards","lastMetricsUpdate","Date","metricsBuffer","alertProcessor","updateInterval","retentionPeriod","alertingEnabled","alertThresholds","cpu","warning","critical","disk","errorRate","responseTime","queueDepth","agentHealth","swarmUtilization","metricsEnabled","tracingEnabled","dashboardEnabled","exportEnabled","exportFormat","debugMode","initializeSystemMetrics","initializeSwarmMetrics","setupEventHandlers","initializeDefaultAlertRules","initializeDefaultDashboards","on","data","updateAgentMetrics","agentId","metrics","recordMetric","from","to","taskId","duration","error","updateSystemMetrics","updateSwarmMetrics","handleError","initialize","info","alerting","dashboard","startMetricsCollection","startHealthChecks","startAlertProcessing","initializeHealthChecks","emit","shutdown","clearInterval","flushMetrics","setInterval","collectSystemMetrics","processMetricsBuffer","cleanupOldMetrics","interval","timestamp","cpuUsage","getCpuUsage","memoryUsage","getMemoryUsage","diskUsage","getDiskUsage","networkUsage","getNetworkUsage","updateSwarmLevelMetrics","agents","Array","values","agentUtilization","calculateAgentUtilization","throughput","calculateSwarmThroughput","latency","calculateAverageLatency","efficiency","calculateSwarmEfficiency","reliability","calculateSwarmReliability","averageQuality","calculateAverageQuality","name","value","tags","point","push","metric","isCriticalMetric","processMetricPoint","length","metricGroups","metricName","group","get","set","points","series","aggregations","min","max","avg","sum","count","lastUpdated","Math","checkAlertsForMetric","processAlerts","now","alertId","alert","resolved","rule","context","ruleId","isAlertResolved","resolveAlert","cleanupResolvedAlerts","enabled","evaluateAlertRule","conditionMet","evaluateCondition","condition","threshold","existingAlert","find","id","createAlert","triggeringPoint","random","toString","slice","level","severity","type","getAlertTypeFromMetric","message","source","acknowledged","escalationLevel","warn","executeAlertActions","action","actions","sendEmailAlert","sendWebhookAlert","triggerAutoScale","triggerRestart","actionType","reason","resolutionReason","resolvedAt","performHealthChecks","checks","promises","map","check","executeHealthCheck","Promise","allSettled","isHealthy","performHttpHealthCheck","performTcpHealthCheck","customCheck","target","Error","String","createDashboard","title","panels","dashboardId","refreshInterval","timeRange","start","end","filters","getDashboardData","panel","panelData","getPanelData","filteredPoints","filter","calculateAggregations","tasksCompleted","tasksFailed","criticalMetrics","includes","recentPoints","allResolved","every","totalUtilization","reduce","agent","totalLatency","totalTasks","completedTasks","totalReliability","successRate","totalQuality","codeQuality","p","val","cutoff","delete","exportMetrics","exportData","entries","store","partition","rules","category","suppressions","forEach","systemDashboard","width","height","position","x","y","visualization","yAxis","timeout","retries","activeSwarms","totalAgents","activeAgents","runningTasks","resourceUtilization","queueLengths","defectRate","reworkRate","costEfficiency","agentSatisfaction","collaborationEffectiveness","scheduleVariance","deadlineAdherence","getSystemMetrics","getSwarmMetrics","getActiveAlerts","getAlertHistory","limit","getTimeSeries","getAllTimeSeries","acknowledgeAlert","acknowledgedBy","assignedTo","createAlertRule","updateAlertRule","updates","deleteAlertRule","getAlertRules","getMonitoringStatistics","metricsCount","size","uptime","getTime"],"mappings":"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"}