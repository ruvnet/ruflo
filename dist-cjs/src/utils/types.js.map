{"version":3,"sources":["../../../src/utils/types.ts"],"sourcesContent":["/**\r\n * Core type definitions for Claude-Flow\r\n */\r\n\r\n// Configuration interface\r\nexport interface Config {\r\n  env: 'development' | 'production' | 'test';\r\n  logLevel: 'debug' | 'info' | 'warn' | 'error';\r\n  enableMetrics?: boolean;\r\n  orchestrator?: {\r\n    dataDir?: string;\r\n    maxAgents?: number;\r\n    taskTimeout?: number;\r\n    persistSessions?: boolean;\r\n    shutdownTimeout?: number;\r\n    maxConcurrentAgents?: number;\r\n  };\r\n  logging?: LoggingConfig;\r\n  terminal?: {\r\n    shell?: string;\r\n    timeout?: number;\r\n    maxSessions?: number;\r\n  };\r\n  memory?: {\r\n    backend?: 'sqlite' | 'memory';\r\n    ttl?: number;\r\n    maxEntries?: number;\r\n  };\r\n  coordination?: {\r\n    enabled?: boolean;\r\n    maxConnections?: number;\r\n  };\r\n  mcp?: {\r\n    enabled?: boolean;\r\n    port?: number;\r\n  };\r\n  database?: {\r\n    url: string;\r\n    poolSize?: number;\r\n  };\r\n  redis?: {\r\n    url: string;\r\n    keyPrefix?: string;\r\n  };\r\n  api?: {\r\n    port: number;\r\n    host: string;\r\n    cors?: {\r\n      origin: string[];\r\n      credentials: boolean;\r\n    };\r\n  };\r\n  agents?: {\r\n    maxConcurrent: number;\r\n    timeout: number;\r\n  };\r\n  security?: {\r\n    jwtSecret: string;\r\n    encryptionKey: string;\r\n  };\r\n}\r\n\r\n// Logging configuration interface\r\nexport interface LoggingConfig {\r\n  level: 'debug' | 'info' | 'warn' | 'error';\r\n  format: 'text' | 'json';\r\n  destination: 'console' | 'file' | 'both';\r\n  file?: {\r\n    path: string;\r\n    maxSize: number;\r\n    maxFiles: number;\r\n  };\r\n  enableTimestamps?: boolean;\r\n  enableContext?: boolean;\r\n}\r\n\r\n// Import orchestrator metrics type\r\nexport interface OrchestratorMetrics {\r\n  uptime: number;\r\n  totalAgents: number;\r\n  activeAgents: number;\r\n  totalTasks: number;\r\n  completedTasks: number;\r\n  failedTasks: number;\r\n  queuedTasks: number;\r\n  avgTaskDuration: number;\r\n  memoryUsage: {\r\n    rss: number;\r\n    heapUsed: number;\r\n    heapTotal: number;\r\n    external: number;\r\n    arrayBuffers: number;\r\n  };\r\n  cpuUsage: {\r\n    user: number;\r\n    system: number;\r\n  };\r\n  timestamp: Date;\r\n}\r\n\r\n// Agent-related types\r\nexport interface AgentProfile {\r\n  id: string;\r\n  name: string;\r\n  type: 'coordinator' | 'researcher' | 'implementer' | 'analyst' | 'custom';\r\n  capabilities: string[];\r\n  systemPrompt?: string;\r\n  maxConcurrentTasks: number;\r\n  priority?: number;\r\n  environment?: Record<string, string>;\r\n  workingDirectory?: string;\r\n  shell?: string;\r\n  metadata?: Record<string, unknown>;\r\n}\r\n\r\nexport interface AgentSession {\r\n  id: string;\r\n  agentId: string;\r\n  terminalId: string;\r\n  startTime: Date;\r\n  endTime?: Date;\r\n  status: 'active' | 'idle' | 'terminated' | 'error';\r\n  lastActivity: Date;\r\n  memoryBankId: string;\r\n}\r\n\r\n// Task-related types\r\nexport interface Task {\r\n  id: string;\r\n  type: string;\r\n  description: string;\r\n  priority: number;\r\n  dependencies: string[];\r\n  assignedAgent?: string;\r\n  status: TaskStatus;\r\n  input: Record<string, unknown>;\r\n  output?: Record<string, unknown>;\r\n  error?: Error;\r\n  createdAt: Date;\r\n  startedAt?: Date;\r\n  completedAt?: Date;\r\n  metadata?: Record<string, unknown>;\r\n}\r\n\r\nexport type TaskStatus =\r\n  | 'pending'\r\n  | 'queued'\r\n  | 'assigned'\r\n  | 'running'\r\n  | 'completed'\r\n  | 'failed'\r\n  | 'cancelled';\r\n\r\n// Memory-related types\r\nexport interface MemoryEntry {\r\n  id: string;\r\n  agentId: string;\r\n  sessionId: string;\r\n  type: 'observation' | 'insight' | 'decision' | 'artifact' | 'error';\r\n  content: string;\r\n  context: Record<string, unknown>;\r\n  timestamp: Date;\r\n  tags: string[];\r\n  version: number;\r\n  parentId?: string;\r\n  metadata?: Record<string, unknown>;\r\n}\r\n\r\nexport interface MemoryQuery {\r\n  agentId?: string;\r\n  sessionId?: string;\r\n  type?: MemoryEntry['type'];\r\n  tags?: string[];\r\n  startTime?: Date;\r\n  endTime?: Date;\r\n  search?: string;\r\n  limit?: number;\r\n  offset?: number;\r\n  namespace?: string;\r\n}\r\n\r\n// Event-related types\r\nexport enum SystemEvents {\r\n  // Agent events\r\n  AGENT_SPAWNED = 'agent:spawned',\r\n  AGENT_TERMINATED = 'agent:terminated',\r\n  AGENT_ERROR = 'agent:error',\r\n  AGENT_IDLE = 'agent:idle',\r\n  AGENT_ACTIVE = 'agent:active',\r\n\r\n  // Task events\r\n  TASK_CREATED = 'task:created',\r\n  TASK_ASSIGNED = 'task:assigned',\r\n  TASK_STARTED = 'task:started',\r\n  TASK_COMPLETED = 'task:completed',\r\n  TASK_FAILED = 'task:failed',\r\n  TASK_CANCELLED = 'task:cancelled',\r\n\r\n  // Memory events\r\n  MEMORY_CREATED = 'memory:created',\r\n  MEMORY_UPDATED = 'memory:updated',\r\n  MEMORY_DELETED = 'memory:deleted',\r\n  MEMORY_SYNCED = 'memory:synced',\r\n\r\n  // System events\r\n  SYSTEM_READY = 'system:ready',\r\n  SYSTEM_SHUTDOWN = 'system:shutdown',\r\n  SYSTEM_ERROR = 'system:error',\r\n  SYSTEM_HEALTHCHECK = 'system:healthcheck',\r\n\r\n  // Coordination events\r\n  RESOURCE_ACQUIRED = 'resource:acquired',\r\n  RESOURCE_RELEASED = 'resource:released',\r\n  DEADLOCK_DETECTED = 'deadlock:detected',\r\n  MESSAGE_SENT = 'message:sent',\r\n  MESSAGE_RECEIVED = 'message:received',\r\n}\r\n\r\nexport interface EventMap extends Record<string, unknown> {\r\n  [SystemEvents.AGENT_SPAWNED]: { agentId: string; profile: AgentProfile; sessionId: string };\r\n  [SystemEvents.AGENT_TERMINATED]: { agentId: string; reason: string };\r\n  [SystemEvents.AGENT_ERROR]: { agentId: string; error: Error };\r\n  [SystemEvents.AGENT_IDLE]: { agentId: string };\r\n  [SystemEvents.AGENT_ACTIVE]: { agentId: string; taskId: string };\r\n\r\n  [SystemEvents.TASK_CREATED]: { task: Task };\r\n  [SystemEvents.TASK_ASSIGNED]: { taskId: string; agentId: string };\r\n  [SystemEvents.TASK_STARTED]: { taskId: string; agentId: string };\r\n  [SystemEvents.TASK_COMPLETED]: { taskId: string; result: unknown };\r\n  [SystemEvents.TASK_FAILED]: { taskId: string; error: Error };\r\n  [SystemEvents.TASK_CANCELLED]: { taskId: string; reason: string };\r\n\r\n  [SystemEvents.MEMORY_CREATED]: { entry: MemoryEntry };\r\n  [SystemEvents.MEMORY_UPDATED]: { entry: MemoryEntry; previousVersion: number };\r\n  [SystemEvents.MEMORY_DELETED]: { entryId: string };\r\n  [SystemEvents.MEMORY_SYNCED]: { entries: MemoryEntry[] };\r\n\r\n  [SystemEvents.SYSTEM_READY]: { timestamp: Date };\r\n  [SystemEvents.SYSTEM_SHUTDOWN]: { reason: string };\r\n  [SystemEvents.SYSTEM_ERROR]: { error: Error; component: string };\r\n  [SystemEvents.SYSTEM_HEALTHCHECK]: { status: HealthStatus };\r\n\r\n  [SystemEvents.RESOURCE_ACQUIRED]: { resourceId: string; agentId: string };\r\n  [SystemEvents.RESOURCE_RELEASED]: { resourceId: string; agentId: string };\r\n  [SystemEvents.DEADLOCK_DETECTED]: { agents: string[]; resources: string[] };\r\n  [SystemEvents.MESSAGE_SENT]: { from: string; to: string; message: Message };\r\n  [SystemEvents.MESSAGE_RECEIVED]: { from: string; to: string; message: Message };\r\n\r\n  // Additional events\r\n  'metrics:collected': OrchestratorMetrics;\r\n}\r\n\r\n// Configuration types\r\nexport interface Config {\r\n  orchestrator: OrchestratorConfig;\r\n  terminal: TerminalConfig;\r\n  memory: MemoryConfig;\r\n  coordination: CoordinationConfig;\r\n  mcp: MCPConfig;\r\n  logging: LoggingConfig;\r\n  credentials?: CredentialsConfig;\r\n  security?: SecurityConfig;\r\n}\r\n\r\nexport interface OrchestratorConfig {\r\n  maxConcurrentAgents: number;\r\n  taskQueueSize: number;\r\n  healthCheckInterval: number;\r\n  shutdownTimeout: number;\r\n  maintenanceInterval?: number;\r\n  metricsInterval?: number;\r\n  persistSessions?: boolean;\r\n  dataDir?: string;\r\n  sessionRetentionMs?: number;\r\n  taskHistoryRetentionMs?: number;\r\n  taskMaxRetries?: number;\r\n}\r\n\r\nexport interface TerminalConfig {\r\n  type: 'vscode' | 'native' | 'auto';\r\n  poolSize: number;\r\n  recycleAfter: number;\r\n  healthCheckInterval: number;\r\n  commandTimeout: number;\r\n}\r\n\r\nexport interface MemoryConfig {\r\n  backend: 'sqlite' | 'markdown' | 'hybrid';\r\n  cacheSizeMB: number;\r\n  syncInterval: number;\r\n  conflictResolution: 'last-write' | 'crdt' | 'manual';\r\n  retentionDays: number;\r\n  sqlitePath?: string;\r\n  markdownDir?: string;\r\n}\r\n\r\nexport interface CoordinationConfig {\r\n  maxRetries: number;\r\n  retryDelay: number;\r\n  deadlockDetection: boolean;\r\n  resourceTimeout: number;\r\n  messageTimeout: number;\r\n}\r\n\r\nexport interface MCPConfig {\r\n  transport: 'stdio' | 'http' | 'websocket';\r\n  host?: string;\r\n  port?: number;\r\n  tlsEnabled?: boolean;\r\n  authToken?: string;\r\n  auth?: MCPAuthConfig;\r\n  loadBalancer?: MCPLoadBalancerConfig;\r\n  sessionTimeout?: number;\r\n  maxSessions?: number;\r\n  enableMetrics?: boolean;\r\n  corsEnabled?: boolean;\r\n  corsOrigins?: string[];\r\n}\r\n\r\nexport interface LoggingConfig {\r\n  level: 'debug' | 'info' | 'warn' | 'error';\r\n  format: 'json' | 'text';\r\n  destination: 'console' | 'file' | 'both';\r\n  filePath?: string;\r\n  maxFileSize?: number;\r\n  maxFiles?: number;\r\n}\r\n\r\n// Health and monitoring types\r\nexport interface HealthStatus {\r\n  status: 'healthy' | 'degraded' | 'unhealthy';\r\n  components: Record<string, ComponentHealth>;\r\n  timestamp: Date;\r\n}\r\n\r\nexport interface ComponentHealth {\r\n  name: string;\r\n  status: 'healthy' | 'degraded' | 'unhealthy';\r\n  lastCheck: Date;\r\n  error?: string;\r\n  metrics?: Record<string, number>;\r\n}\r\n\r\n// Message passing types\r\nexport interface Message {\r\n  id: string;\r\n  type: string;\r\n  payload: unknown;\r\n  timestamp: Date;\r\n  priority: number;\r\n  expiry?: Date;\r\n}\r\n\r\n// Resource management types\r\nexport interface Resource {\r\n  id: string;\r\n  type: string;\r\n  owner?: string;\r\n  locked: boolean;\r\n  lockedBy?: string;\r\n  lockedAt?: Date;\r\n  metadata?: Record<string, unknown>;\r\n}\r\n\r\n// MCP types - Full protocol compliance\r\nexport interface MCPProtocolVersion {\r\n  major: number;\r\n  minor: number;\r\n  patch: number;\r\n}\r\n\r\nexport interface MCPCapabilities {\r\n  logging?: {\r\n    level?: 'debug' | 'info' | 'warn' | 'error';\r\n  };\r\n  prompts?: {\r\n    listChanged?: boolean;\r\n  };\r\n  resources?: {\r\n    listChanged?: boolean;\r\n    subscribe?: boolean;\r\n  };\r\n  tools?: {\r\n    listChanged?: boolean;\r\n  };\r\n  sampling?: Record<string, unknown>;\r\n}\r\n\r\nexport interface MCPInitializeParams {\r\n  protocolVersion: MCPProtocolVersion;\r\n  capabilities: MCPCapabilities;\r\n  clientInfo: {\r\n    name: string;\r\n    version: string;\r\n  };\r\n}\r\n\r\nexport interface MCPInitializeResult {\r\n  protocolVersion: MCPProtocolVersion;\r\n  capabilities: MCPCapabilities;\r\n  serverInfo: {\r\n    name: string;\r\n    version: string;\r\n  };\r\n  instructions?: string;\r\n}\r\n\r\nexport interface MCPTool {\r\n  name: string;\r\n  description: string;\r\n  inputSchema: Record<string, unknown>;\r\n  handler: (input: unknown, context?: MCPContext) => Promise<unknown>;\r\n}\r\n\r\nexport interface MCPPrompt {\r\n  name: string;\r\n  description?: string;\r\n  arguments?: Array<{\r\n    name: string;\r\n    description?: string;\r\n    required?: boolean;\r\n  }>;\r\n}\r\n\r\nexport interface MCPResource {\r\n  uri: string;\r\n  name: string;\r\n  description?: string;\r\n  mimeType?: string;\r\n}\r\n\r\nexport interface MCPRequest {\r\n  jsonrpc: '2.0';\r\n  id: string | number;\r\n  method: string;\r\n  params?: unknown;\r\n}\r\n\r\nexport interface MCPResponse {\r\n  jsonrpc: '2.0';\r\n  id: string | number;\r\n  result?: unknown;\r\n  error?: MCPError;\r\n}\r\n\r\nexport interface MCPNotification {\r\n  jsonrpc: '2.0';\r\n  method: string;\r\n  params?: unknown;\r\n}\r\n\r\nexport interface MCPError {\r\n  code: number;\r\n  message: string;\r\n  data?: unknown;\r\n}\r\n\r\nexport interface MCPToolCall {\r\n  name: string;\r\n  arguments?: Record<string, unknown>;\r\n}\r\n\r\nexport interface MCPToolResult {\r\n  content: Array<{\r\n    type: 'text' | 'image' | 'resource';\r\n    text?: string;\r\n    data?: string;\r\n    mimeType?: string;\r\n  }>;\r\n  isError?: boolean;\r\n}\r\n\r\nexport interface MCPLogEntry {\r\n  level: 'debug' | 'info' | 'warn' | 'error';\r\n  data?: unknown;\r\n  logger?: string;\r\n}\r\n\r\nexport interface MCPSession {\r\n  id: string;\r\n  clientInfo: {\r\n    name: string;\r\n    version: string;\r\n  };\r\n  protocolVersion: MCPProtocolVersion;\r\n  capabilities: MCPCapabilities;\r\n  isInitialized: boolean;\r\n  createdAt: Date;\r\n  lastActivity: Date;\r\n  transport: 'stdio' | 'http' | 'websocket';\r\n  authenticated: boolean;\r\n  authData?: {\r\n    token?: string;\r\n    user?: string;\r\n    permissions?: string[];\r\n  };\r\n}\r\n\r\nexport interface MCPAuthConfig {\r\n  enabled: boolean;\r\n  method: 'token' | 'basic' | 'oauth';\r\n  tokens?: string[];\r\n  users?: Array<{\r\n    username: string;\r\n    password: string;\r\n    permissions: string[];\r\n    roles?: string[];\r\n  }>;\r\n  jwtSecret?: string;\r\n  sessionTimeout?: number;\r\n}\r\n\r\nexport interface MCPLoadBalancerConfig {\r\n  enabled: boolean;\r\n  strategy: 'round-robin' | 'least-connections' | 'weighted';\r\n  maxRequestsPerSecond: number;\r\n  healthCheckInterval: number;\r\n  circuitBreakerThreshold: number;\r\n}\r\n\r\nexport interface MCPMetrics {\r\n  totalRequests: number;\r\n  successfulRequests: number;\r\n  failedRequests: number;\r\n  averageResponseTime: number;\r\n  activeSessions: number;\r\n  toolInvocations: Record<string, number>;\r\n  errors: Record<string, number>;\r\n  lastReset: Date;\r\n}\r\n\r\n// Interface declarations for dependency injection\r\nexport interface ILogger {\r\n  debug(message: string, meta?: unknown): void;\r\n  info(message: string, meta?: unknown): void;\r\n  warn(message: string, meta?: unknown): void;\r\n  error(message: string, error?: unknown): void;\r\n  configure(config: LoggingConfig): Promise<void>;\r\n}\r\n\r\nexport interface IEventBus {\r\n  emit(event: string, data?: unknown): void;\r\n  on(event: string, handler: (data: unknown) => void): void;\r\n  off(event: string, handler: (data: unknown) => void): void;\r\n  once(event: string, handler: (data: unknown) => void): void;\r\n}\r\n\r\n// Terminal types\r\nexport interface Terminal {\r\n  id: string;\r\n  pid?: number;\r\n  type: 'vscode' | 'native';\r\n  status: 'active' | 'idle' | 'dead';\r\n}\r\n\r\nexport interface TerminalCommand {\r\n  command: string;\r\n  args?: string[];\r\n  env?: Record<string, string>;\r\n  cwd?: string;\r\n  timeout?: number;\r\n}\r\n\r\nexport interface MCPContext {\r\n  sessionId: string;\r\n  agentId?: string;\r\n  logger: ILogger;\r\n}\r\n\r\n// Additional configuration interfaces\r\nexport interface CredentialsConfig {\r\n  apiKey?: string;\r\n  token?: string;\r\n  password?: string;\r\n  secret?: string;\r\n  [key: string]: string | undefined;\r\n}\r\n\r\nexport interface SecurityConfig {\r\n  encryptionEnabled: boolean;\r\n  auditLogging: boolean;\r\n  maskSensitiveValues: boolean;\r\n  allowEnvironmentOverrides: boolean;\r\n}\r\n"],"names":["SystemEvents"],"mappings":"AAsLA,OAAO,IAAA,AAAKA,sCAAAA;;;;;;;;;;;;;;;;;;;;;;;;;WAAAA;MAkCX"}