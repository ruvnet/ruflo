{
  "version": 3,
  "sources": ["../../../src/cli/utils/environment-detector.ts"],
  "sourcesContent": ["/**\n * Environment Detection Utility for Claude-Flow v2.0\n * Detects execution environment and recommends appropriate flags\n */\n\nimport chalk from 'chalk';\n\nexport interface ExecutionEnvironment {\n  isInteractive: boolean;\n  isVSCode: boolean;\n  isVSCodeInsiders: boolean;\n  isCI: boolean;\n  isDocker: boolean;\n  isSSH: boolean;\n  isGitBash: boolean;\n  isWindowsTerminal: boolean;\n  isWSL: boolean;\n  isWindows: boolean;\n  supportsRawMode: boolean;\n  supportsColor: boolean;\n  terminalType: string;\n  recommendedFlags: string[];\n  warnings: string[];\n}\n\nexport interface EnvironmentOptions {\n  skipWarnings?: boolean;\n  autoApplyDefaults?: boolean;\n  verbose?: boolean;\n}\n\n/**\n * Detects the current execution environment\n */\nexport function detectExecutionEnvironment(options: EnvironmentOptions = {}): ExecutionEnvironment {\n  const env: ExecutionEnvironment = {\n    isInteractive: false,\n    isVSCode: false,\n    isVSCodeInsiders: false,\n    isCI: false,\n    isDocker: false,\n    isSSH: false,\n    isGitBash: false,\n    isWindowsTerminal: false,\n    isWSL: false,\n    isWindows: false,\n    supportsRawMode: false,\n    supportsColor: true,\n    terminalType: 'unknown',\n    recommendedFlags: [],\n    warnings: [],\n  };\n\n  // Basic TTY check\n  env.isInteractive = Boolean(process.stdin.isTTY && process.stdout.isTTY);\n\n  // Terminal program detection\n  const termProgram = process.env.TERM_PROGRAM?.toLowerCase() || '';\n  env.isVSCode = termProgram === 'vscode';\n  env.isVSCodeInsiders = termProgram === 'vscode-insiders';\n  env.terminalType = termProgram || process.env.TERM || 'unknown';\n\n  // CI environment detection\n  env.isCI = Boolean(\n    process.env.CI ||\n      process.env.GITHUB_ACTIONS ||\n      process.env.GITLAB_CI ||\n      process.env.JENKINS_URL ||\n      process.env.CIRCLECI ||\n      process.env.TRAVIS ||\n      process.env.BUILDKITE ||\n      process.env.DRONE,\n  );\n\n  // Docker detection\n  env.isDocker = Boolean(\n    process.env.DOCKER_CONTAINER ||\n      existsSync('/.dockerenv') ||\n      (existsSync('/proc/1/cgroup') && readFileSync('/proc/1/cgroup', 'utf8').includes('docker')),\n  );\n\n  // SSH detection\n  env.isSSH = Boolean(process.env.SSH_CLIENT || process.env.SSH_TTY);\n\n  // Git Bash detection\n  env.isGitBash =\n    process.env.TERM_PROGRAM === 'mintty' || process.env.MSYSTEM?.startsWith('MINGW') || false;\n\n  // Windows Terminal detection\n  env.isWindowsTerminal = Boolean(process.env.WT_SESSION);\n\n  // Windows detection\n  env.isWindows = process.platform === 'win32';\n\n  // WSL detection\n  env.isWSL = Boolean(\n    process.env.WSL_DISTRO_NAME ||\n      process.env.WSL_INTEROP ||\n      (existsSync('/proc/version') &&\n        readFileSync('/proc/version', 'utf8').toLowerCase().includes('microsoft')),\n  );\n\n  // Raw mode support check\n  env.supportsRawMode = checkRawModeSupport();\n\n  // Color support check\n  env.supportsColor =\n    process.env.NO_COLOR !== '1' &&\n    process.env.TERM !== 'dumb' &&\n    (process.stdout.isTTY || process.env.FORCE_COLOR === '1');\n\n  // Generate recommendations based on environment\n  generateRecommendations(env);\n\n  // Show warnings if requested\n  if (!options.skipWarnings && env.warnings.length > 0) {\n    showEnvironmentWarnings(env);\n  }\n\n  return env;\n}\n\n/**\n * Checks if raw mode is supported\n */\nfunction checkRawModeSupport(): boolean {\n  try {\n    if (!process.stdin.isTTY) return false;\n    if (typeof process.stdin.setRawMode !== 'function') return false;\n\n    // Try to set raw mode and immediately restore\n    const originalRawMode = process.stdin.isRaw;\n    process.stdin.setRawMode(true);\n    process.stdin.setRawMode(originalRawMode);\n\n    return true;\n  } catch {\n    return false;\n  }\n}\n\n/**\n * Generates recommendations based on environment\n */\nfunction generateRecommendations(env: ExecutionEnvironment): void {\n  // VS Code specific recommendations\n  if (env.isVSCode || env.isVSCodeInsiders) {\n    env.recommendedFlags.push('--dangerously-skip-permissions');\n    env.recommendedFlags.push('--non-interactive');\n    env.warnings.push('VS Code integrated terminal detected - interactive features may be limited');\n  }\n\n  // CI environment recommendations\n  if (env.isCI) {\n    env.recommendedFlags.push('--dangerously-skip-permissions');\n    env.recommendedFlags.push('--non-interactive');\n    env.recommendedFlags.push('--json');\n    env.warnings.push('CI environment detected - running in non-interactive mode');\n  }\n\n  // Docker recommendations\n  if (env.isDocker && !env.isInteractive) {\n    env.recommendedFlags.push('--dangerously-skip-permissions');\n    env.recommendedFlags.push('--non-interactive');\n    env.warnings.push('Docker container without TTY - interactive features disabled');\n  }\n\n  // SSH without TTY\n  if (env.isSSH && !env.isInteractive) {\n    env.recommendedFlags.push('--dangerously-skip-permissions');\n    env.warnings.push('SSH session without TTY - consider using ssh -t');\n  }\n\n  // Git Bash specific\n  if (env.isGitBash) {\n    env.warnings.push('Git Bash detected - some interactive features may not work correctly');\n  }\n\n  // WSL specific recommendations\n  if (env.isWSL) {\n    env.recommendedFlags.push('--no-interactive');\n    env.warnings.push('WSL detected - raw mode may cause hangs, using non-interactive mode');\n    if (!env.supportsRawMode) {\n      env.warnings.push('WSL subprocess context detected - interactive features disabled');\n    }\n  }\n\n  // Windows specific recommendations\n  if (env.isWindows && !env.isWSL) {\n    env.recommendedFlags.push('--compatible-ui');\n    env.warnings.push('Native Windows detected - using compatible UI mode');\n  }\n\n  // Raw mode not supported\n  if (!env.supportsRawMode && env.isInteractive) {\n    env.recommendedFlags.push('--compatible-ui');\n    env.warnings.push('Terminal does not support raw mode - using compatible UI');\n  }\n}\n\n/**\n * Shows environment warnings to the user\n */\nfunction showEnvironmentWarnings(env: ExecutionEnvironment): void {\n  if (env.warnings.length === 0) return;\n\n  console.log(chalk.yellow('\\n\u26A0\uFE0F  Environment Detection:'));\n  env.warnings.forEach((warning) => {\n    console.log(chalk.gray(`   \u2022 ${warning}`));\n  });\n\n  if (env.recommendedFlags.length > 0) {\n    console.log(chalk.cyan('\\n\uD83D\uDCA1 Recommended flags for your environment:'));\n    console.log(chalk.gray(`   ${env.recommendedFlags.join(' ')}`));\n  }\n\n  console.log(); // Empty line for spacing\n}\n\n/**\n * Applies smart defaults based on environment\n */\nexport function applySmartDefaults<T extends Record<string, any>>(\n  options: T,\n  env?: ExecutionEnvironment,\n): T & { appliedDefaults: string[]; skipPermissions?: boolean; dangerouslySkipPermissions?: boolean; nonInteractive?: boolean; json?: boolean; noColor?: boolean; } {\n  const environment = env || detectExecutionEnvironment({ skipWarnings: true });\n  const appliedDefaults: string[] = [];\n  const enhanced = { ...options, appliedDefaults } as T & { appliedDefaults: string[]; skipPermissions?: boolean; dangerouslySkipPermissions?: boolean; nonInteractive?: boolean; json?: boolean; noColor?: boolean; };\n\n  // Apply defaults based on environment\n  if (\n    (environment.isVSCode || environment.isCI || !environment.supportsRawMode) &&\n    !options.hasOwnProperty('skipPermissions')\n  ) {\n    enhanced.skipPermissions = true;\n    enhanced.dangerouslySkipPermissions = true;\n    appliedDefaults.push('--dangerously-skip-permissions');\n  }\n\n  if (\n    (environment.isCI || !environment.isInteractive) &&\n    !options.hasOwnProperty('nonInteractive')\n  ) {\n    enhanced.nonInteractive = true;\n    appliedDefaults.push('--non-interactive');\n  }\n\n  if (environment.isCI && !options.hasOwnProperty('json')) {\n    enhanced.json = true;\n    appliedDefaults.push('--json');\n  }\n\n  if (!environment.supportsColor && !options.hasOwnProperty('noColor')) {\n    enhanced.noColor = true;\n    appliedDefaults.push('--no-color');\n  }\n\n  // Log applied defaults if verbose\n  if (options.verbose && appliedDefaults.length > 0) {\n    console.log(chalk.gray(`\u2139\uFE0F  Auto-applied flags: ${appliedDefaults.join(' ')}`));\n  }\n\n  return enhanced;\n}\n\n/**\n * Gets a human-readable environment description\n */\nexport function getEnvironmentDescription(env?: ExecutionEnvironment): string {\n  const environment = env || detectExecutionEnvironment({ skipWarnings: true });\n  const parts: string[] = [];\n\n  if (environment.isVSCode) parts.push('VS Code');\n  if (environment.isCI) parts.push('CI');\n  if (environment.isDocker) parts.push('Docker');\n  if (environment.isSSH) parts.push('SSH');\n  if (environment.isGitBash) parts.push('Git Bash');\n  if (environment.isWindowsTerminal) parts.push('Windows Terminal');\n  if (environment.isWSL) parts.push('WSL');\n  if (environment.isWindows && !environment.isWSL) parts.push('Windows');\n\n  if (parts.length === 0) {\n    parts.push(environment.terminalType);\n  }\n\n  const features: string[] = [];\n  if (environment.isInteractive) features.push('interactive');\n  if (environment.supportsRawMode) features.push('raw mode');\n  if (environment.supportsColor) features.push('color');\n\n  return `${parts.join('/')} (${features.join(', ')})`;\n}\n\n/**\n * Checks if we should use non-interactive mode\n */\nexport function shouldUseNonInteractiveMode(options?: { force?: boolean }): boolean {\n  if (options?.force) return true;\n\n  const env = detectExecutionEnvironment({ skipWarnings: true });\n  return (\n    !env.isInteractive ||\n    env.isCI ||\n    env.isVSCode ||\n    env.isWSL ||\n    env.isWindows ||\n    !env.supportsRawMode\n  );\n}\n\n// Helper functions (these would normally be imported)\nfunction existsSync(path: string): boolean {\n  try {\n    require('fs').accessSync(path);\n    return true;\n  } catch {\n    return false;\n  }\n}\n\nfunction readFileSync(path: string, encoding: string): string {\n  try {\n    return require('fs').readFileSync(path, encoding);\n  } catch {\n    return '';\n  }\n}\n\nexport default {\n  detectExecutionEnvironment,\n  applySmartDefaults,\n  getEnvironmentDescription,\n  shouldUseNonInteractiveMode,\n};\n"],
  "mappings": "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",
  "names": ["chalk"]
}
