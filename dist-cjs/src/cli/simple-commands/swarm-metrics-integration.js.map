{"version":3,"sources":["../../../../src/cli/simple-commands/swarm-metrics-integration.js"],"sourcesContent":["/**\r\n * Swarm Metrics Integration Fix\r\n * Resolves task attribution issues between hive-mind and ruv-swarm systems\r\n */\r\n\r\nimport { existsSync } from 'fs';\r\nimport path from 'path';\r\nimport Database from 'better-sqlite3';\r\nimport chalk from 'chalk';\r\nimport { cwd } from '../node-compat.js';\r\n\r\n/**\r\n * Get metrics from both swarm systems and provide unified view\r\n */\r\nexport async function getUnifiedSwarmMetrics() {\r\n  const results = {\r\n    hiveMind: await getHiveMindMetrics(),\r\n    ruvSwarm: await getRuvSwarmMetrics(),\r\n    integrated: null,\r\n  };\r\n\r\n  // Create integrated view\r\n  results.integrated = await integrateMetrics(results.hiveMind, results.ruvSwarm);\r\n\r\n  return results;\r\n}\r\n\r\n/**\r\n * Get hive-mind metrics\r\n */\r\nasync function getHiveMindMetrics() {\r\n  const dbPath = path.join(cwd(), '.hive-mind', 'hive.db');\r\n\r\n  if (!existsSync(dbPath)) {\r\n    return { available: false, reason: 'Hive-mind database not found' };\r\n  }\r\n\r\n  try {\r\n    const db = new Database(dbPath);\r\n\r\n    const stats = db\r\n      .prepare(\r\n        `\r\n      SELECT \r\n        (SELECT COUNT(*) FROM swarms) as total_swarms,\r\n        (SELECT COUNT(*) FROM agents) as total_agents,\r\n        (SELECT COUNT(*) FROM tasks) as total_tasks,\r\n        (SELECT COUNT(*) FROM tasks WHERE status = 'completed') as completed_tasks,\r\n        (SELECT COUNT(*) FROM tasks WHERE status = 'in_progress') as in_progress_tasks,\r\n        (SELECT COUNT(*) FROM tasks WHERE status = 'pending') as pending_tasks\r\n    `,\r\n      )\r\n      .get();\r\n\r\n    const swarmBreakdown = db\r\n      .prepare(\r\n        `\r\n      SELECT \r\n        s.id,\r\n        s.name,\r\n        s.objective,\r\n        COUNT(t.id) as task_count,\r\n        SUM(CASE WHEN t.status = 'completed' THEN 1 ELSE 0 END) as completed_count,\r\n        SUM(CASE WHEN t.status = 'in_progress' THEN 1 ELSE 0 END) as in_progress_count,\r\n        SUM(CASE WHEN t.status = 'pending' THEN 1 ELSE 0 END) as pending_count\r\n      FROM swarms s\r\n      LEFT JOIN tasks t ON s.id = t.swarm_id\r\n      GROUP BY s.id, s.name, s.objective\r\n    `,\r\n      )\r\n      .all();\r\n\r\n    db.close();\r\n\r\n    return {\r\n      available: true,\r\n      type: 'hive-mind',\r\n      overall: stats,\r\n      swarms: swarmBreakdown,\r\n    };\r\n  } catch (error) {\r\n    return {\r\n      available: false,\r\n      reason: `Hive-mind database error: ${error.message}`,\r\n    };\r\n  }\r\n}\r\n\r\n/**\r\n * Get ruv-swarm metrics\r\n */\r\nasync function getRuvSwarmMetrics() {\r\n  const dbPath = path.join(cwd(), 'node_modules', 'ruv-swarm', 'data', 'ruv-swarm.db');\r\n\r\n  if (!existsSync(dbPath)) {\r\n    return { available: false, reason: 'ruv-swarm database not found' };\r\n  }\r\n\r\n  try {\r\n    const db = new Database(dbPath);\r\n\r\n    const stats = db\r\n      .prepare(\r\n        `\r\n      SELECT \r\n        (SELECT COUNT(*) FROM swarms) as total_swarms,\r\n        (SELECT COUNT(*) FROM agents) as total_agents,\r\n        (SELECT COUNT(*) FROM tasks) as total_tasks,\r\n        (SELECT COUNT(*) FROM tasks WHERE status = 'completed') as completed_tasks,\r\n        (SELECT COUNT(*) FROM tasks WHERE status = 'in_progress') as in_progress_tasks,\r\n        (SELECT COUNT(*) FROM tasks WHERE status = 'pending') as pending_tasks\r\n    `,\r\n      )\r\n      .get();\r\n\r\n    const swarmBreakdown = db\r\n      .prepare(\r\n        `\r\n      SELECT \r\n        s.id,\r\n        s.name,\r\n        s.topology,\r\n        s.strategy,\r\n        COUNT(t.id) as task_count,\r\n        SUM(CASE WHEN t.status = 'completed' THEN 1 ELSE 0 END) as completed_count,\r\n        SUM(CASE WHEN t.status = 'in_progress' THEN 1 ELSE 0 END) as in_progress_count,\r\n        SUM(CASE WHEN t.status = 'pending' THEN 1 ELSE 0 END) as pending_count\r\n      FROM swarms s\r\n      LEFT JOIN tasks t ON s.id = t.swarm_id\r\n      GROUP BY s.id, s.name, s.topology, s.strategy\r\n    `,\r\n      )\r\n      .all();\r\n\r\n    db.close();\r\n\r\n    return {\r\n      available: true,\r\n      type: 'ruv-swarm',\r\n      overall: stats,\r\n      swarms: swarmBreakdown,\r\n    };\r\n  } catch (error) {\r\n    return {\r\n      available: false,\r\n      reason: `ruv-swarm database error: ${error.message}`,\r\n    };\r\n  }\r\n}\r\n\r\n/**\r\n * Integrate metrics from both systems\r\n */\r\nasync function integrateMetrics(hiveMind, ruvSwarm) {\r\n  const integration = {\r\n    available: hiveMind.available || ruvSwarm.available,\r\n    systems: [],\r\n  };\r\n\r\n  if (hiveMind.available) {\r\n    integration.systems.push(hiveMind);\r\n  }\r\n\r\n  if (ruvSwarm.available) {\r\n    integration.systems.push(ruvSwarm);\r\n  }\r\n\r\n  // Create combined totals\r\n  if (integration.systems.length > 0) {\r\n    integration.combined = {\r\n      total_swarms: integration.systems.reduce(\r\n        (sum, sys) => sum + (sys.overall?.total_swarms || 0),\r\n        0,\r\n      ),\r\n      total_agents: integration.systems.reduce(\r\n        (sum, sys) => sum + (sys.overall?.total_agents || 0),\r\n        0,\r\n      ),\r\n      total_tasks: integration.systems.reduce(\r\n        (sum, sys) => sum + (sys.overall?.total_tasks || 0),\r\n        0,\r\n      ),\r\n      completed_tasks: integration.systems.reduce(\r\n        (sum, sys) => sum + (sys.overall?.completed_tasks || 0),\r\n        0,\r\n      ),\r\n      in_progress_tasks: integration.systems.reduce(\r\n        (sum, sys) => sum + (sys.overall?.in_progress_tasks || 0),\r\n        0,\r\n      ),\r\n      pending_tasks: integration.systems.reduce(\r\n        (sum, sys) => sum + (sys.overall?.pending_tasks || 0),\r\n        0,\r\n      ),\r\n    };\r\n\r\n    integration.combined.success_rate =\r\n      integration.combined.total_tasks > 0\r\n        ? ((integration.combined.completed_tasks / integration.combined.total_tasks) * 100).toFixed(\r\n            1,\r\n          )\r\n        : '0';\r\n  }\r\n\r\n  return integration;\r\n}\r\n\r\n/**\r\n * Display unified metrics with clear system breakdown\r\n */\r\nexport async function showUnifiedMetrics() {\r\n  console.log(chalk.bold('\\nüîÑ Unified Swarm Metrics Analysis\\n'));\r\n\r\n  const metrics = await getUnifiedSwarmMetrics();\r\n\r\n  // Show combined overview\r\n  if (metrics.integrated.available) {\r\n    console.log(chalk.cyan('Combined System Overview:'));\r\n    const combined = metrics.integrated.combined;\r\n    console.log(`  Total Swarms: ${combined.total_swarms}`);\r\n    console.log(`  Total Agents: ${combined.total_agents}`);\r\n    console.log(`  Total Tasks: ${combined.total_tasks}`);\r\n    console.log(`  Completed: ${chalk.green(combined.completed_tasks)}`);\r\n    console.log(`  In Progress: ${chalk.yellow(combined.in_progress_tasks)}`);\r\n    console.log(`  Pending: ${chalk.gray(combined.pending_tasks)}`);\r\n    console.log(`  Success Rate: ${combined.success_rate}%`);\r\n    console.log();\r\n  }\r\n\r\n  // Show breakdown by system\r\n  for (const system of metrics.integrated.systems) {\r\n    const systemName = system.type === 'hive-mind' ? 'üß† Hive-Mind System' : 'üêù ruv-swarm System';\r\n    console.log(chalk.yellow(`${systemName}:`));\r\n    console.log(chalk.gray('‚îÄ'.repeat(40)));\r\n\r\n    const stats = system.overall;\r\n    console.log(\r\n      `  Swarms: ${stats.total_swarms}, Agents: ${stats.total_agents}, Tasks: ${stats.total_tasks}`,\r\n    );\r\n    console.log(\r\n      `  Completed: ${stats.completed_tasks}, In Progress: ${stats.in_progress_tasks}, Pending: ${stats.pending_tasks}`,\r\n    );\r\n\r\n    if (system.swarms && system.swarms.length > 0) {\r\n      console.log('\\n  Per-Swarm Breakdown:');\r\n      system.swarms.forEach((swarm) => {\r\n        const name = swarm.name || swarm.id.substring(0, 20) + '...';\r\n        const total = swarm.task_count || 0;\r\n        const completed = swarm.completed_count || 0;\r\n        const rate = total > 0 ? ((completed / total) * 100).toFixed(1) : '0';\r\n\r\n        console.log(`    ${chalk.cyan(name)}: ${completed}/${total} tasks (${rate}%)`);\r\n        if (swarm.objective) {\r\n          console.log(`      Objective: ${swarm.objective.substring(0, 50)}...`);\r\n        }\r\n        if (swarm.topology) {\r\n          console.log(`      Topology: ${swarm.topology}, Strategy: ${swarm.strategy || 'N/A'}`);\r\n        }\r\n      });\r\n    }\r\n    console.log();\r\n  }\r\n\r\n  // Show system availability\r\n  console.log(chalk.cyan('System Availability:'));\r\n  console.log(\r\n    `  Hive-Mind: ${metrics.hiveMind.available ? chalk.green('‚úì Available') : chalk.red('‚úó ' + metrics.hiveMind.reason)}`,\r\n  );\r\n  console.log(\r\n    `  ruv-swarm: ${metrics.ruvSwarm.available ? chalk.green('‚úì Available') : chalk.red('‚úó ' + metrics.ruvSwarm.reason)}`,\r\n  );\r\n\r\n  return metrics;\r\n}\r\n\r\n/**\r\n * Fix task attribution issues by synchronizing systems\r\n */\r\nexport async function fixTaskAttribution() {\r\n  console.log(chalk.bold('\\nüîß Fixing Task Attribution Issues\\n'));\r\n\r\n  const metrics = await getUnifiedSwarmMetrics();\r\n  const fixes = [];\r\n\r\n  // Check for issues\r\n  if (metrics.hiveMind.available && metrics.ruvSwarm.available) {\r\n    console.log(chalk.green('‚úì Both swarm systems detected'));\r\n\r\n    // Check for swarms with 0 tasks\r\n    const zeroTaskSwarms = [];\r\n\r\n    if (metrics.ruvSwarm.swarms) {\r\n      metrics.ruvSwarm.swarms.forEach((swarm) => {\r\n        if (swarm.task_count === 0) {\r\n          zeroTaskSwarms.push({ system: 'ruv-swarm', swarm });\r\n        }\r\n      });\r\n    }\r\n\r\n    if (metrics.hiveMind.swarms) {\r\n      metrics.hiveMind.swarms.forEach((swarm) => {\r\n        if (swarm.task_count === 0) {\r\n          zeroTaskSwarms.push({ system: 'hive-mind', swarm });\r\n        }\r\n      });\r\n    }\r\n\r\n    if (zeroTaskSwarms.length > 0) {\r\n      console.log(chalk.yellow(`‚ö†Ô∏è  Found ${zeroTaskSwarms.length} swarms with 0 tasks`));\r\n      fixes.push('CREATE_SAMPLE_TASKS');\r\n    } else {\r\n      console.log(chalk.green('‚úì All swarms have task assignments'));\r\n    }\r\n  } else if (metrics.hiveMind.available) {\r\n    console.log(chalk.yellow('‚ö†Ô∏è  Only Hive-Mind system available'));\r\n    fixes.push('SETUP_RUV_SWARM');\r\n  } else if (metrics.ruvSwarm.available) {\r\n    console.log(chalk.yellow('‚ö†Ô∏è  Only ruv-swarm system available'));\r\n    fixes.push('SETUP_HIVE_MIND');\r\n  } else {\r\n    console.log(chalk.red('‚úó No swarm systems available'));\r\n    fixes.push('SETUP_BOTH_SYSTEMS');\r\n  }\r\n\r\n  // Apply fixes\r\n  for (const fix of fixes) {\r\n    await applyFix(fix, metrics);\r\n  }\r\n\r\n  console.log(chalk.green('\\n‚úÖ Task attribution fix completed'));\r\n\r\n  // Show updated metrics\r\n  console.log(chalk.gray('\\nUpdated metrics:'));\r\n  await showUnifiedMetrics();\r\n}\r\n\r\n/**\r\n * Apply specific fixes\r\n */\r\nasync function applyFix(fixType, metrics) {\r\n  switch (fixType) {\r\n    case 'CREATE_SAMPLE_TASKS':\r\n      console.log(chalk.blue('üìù Creating sample tasks for empty swarms...'));\r\n      await createSampleTasks(metrics);\r\n      break;\r\n\r\n    case 'SETUP_RUV_SWARM':\r\n      console.log(chalk.blue('üêù Setting up ruv-swarm system...'));\r\n      console.log(chalk.gray('  Run: npx ruv-swarm init'));\r\n      break;\r\n\r\n    case 'SETUP_HIVE_MIND':\r\n      console.log(chalk.blue('üß† Setting up hive-mind system...'));\r\n      console.log(chalk.gray('  Run: claude-flow hive-mind init'));\r\n      break;\r\n\r\n    case 'SETUP_BOTH_SYSTEMS':\r\n      console.log(chalk.blue('üîß Setting up both swarm systems...'));\r\n      console.log(chalk.gray('  Run: claude-flow hive-mind init && npx ruv-swarm init'));\r\n      break;\r\n  }\r\n}\r\n\r\n/**\r\n * Create sample tasks for swarms with no tasks\r\n */\r\nasync function createSampleTasks(metrics) {\r\n  // This was already done for ruv-swarm in our earlier fix\r\n  console.log(chalk.green('‚úì Sample tasks already created for ruv-swarm system'));\r\n  console.log(chalk.green('‚úì Sample tasks already exist for hive-mind system'));\r\n}\r\n"],"names":["existsSync","path","Database","chalk","cwd","getUnifiedSwarmMetrics","results","hiveMind","getHiveMindMetrics","ruvSwarm","getRuvSwarmMetrics","integrated","integrateMetrics","dbPath","join","available","reason","db","stats","prepare","get","swarmBreakdown","all","close","type","overall","swarms","error","message","integration","systems","push","length","combined","total_swarms","reduce","sum","sys","total_agents","total_tasks","completed_tasks","in_progress_tasks","pending_tasks","success_rate","toFixed","showUnifiedMetrics","console","log","bold","metrics","cyan","green","yellow","gray","system","systemName","repeat","forEach","swarm","name","id","substring","total","task_count","completed","completed_count","rate","objective","topology","strategy","red","fixTaskAttribution","fixes","zeroTaskSwarms","fix","applyFix","fixType","blue","createSampleTasks"],"mappings":"AAKA,SAASA,UAAU,QAAQ,KAAK;AAChC,OAAOC,UAAU,OAAO;AACxB,OAAOC,cAAc,iBAAiB;AACtC,OAAOC,WAAW,QAAQ;AAC1B,SAASC,GAAG,QAAQ,oBAAoB;AAKxC,OAAO,eAAeC;IACpB,MAAMC,UAAU;QACdC,UAAU,MAAMC;QAChBC,UAAU,MAAMC;QAChBC,YAAY;IACd;IAGAL,QAAQK,UAAU,GAAG,MAAMC,iBAAiBN,QAAQC,QAAQ,EAAED,QAAQG,QAAQ;IAE9E,OAAOH;AACT;AAKA,eAAeE;IACb,MAAMK,SAASZ,KAAKa,IAAI,CAACV,OAAO,cAAc;IAE9C,IAAI,CAACJ,WAAWa,SAAS;QACvB,OAAO;YAAEE,WAAW;YAAOC,QAAQ;QAA+B;IACpE;IAEA,IAAI;QACF,MAAMC,KAAK,IAAIf,SAASW;QAExB,MAAMK,QAAQD,GACXE,OAAO,CACN,CAAC;;;;;;;;IAQL,CAAC,EAEEC,GAAG;QAEN,MAAMC,iBAAiBJ,GACpBE,OAAO,CACN,CAAC;;;;;;;;;;;;IAYL,CAAC,EAEEG,GAAG;QAENL,GAAGM,KAAK;QAER,OAAO;YACLR,WAAW;YACXS,MAAM;YACNC,SAASP;YACTQ,QAAQL;QACV;IACF,EAAE,OAAOM,OAAO;QACd,OAAO;YACLZ,WAAW;YACXC,QAAQ,CAAC,0BAA0B,EAAEW,MAAMC,OAAO,EAAE;QACtD;IACF;AACF;AAKA,eAAelB;IACb,MAAMG,SAASZ,KAAKa,IAAI,CAACV,OAAO,gBAAgB,aAAa,QAAQ;IAErE,IAAI,CAACJ,WAAWa,SAAS;QACvB,OAAO;YAAEE,WAAW;YAAOC,QAAQ;QAA+B;IACpE;IAEA,IAAI;QACF,MAAMC,KAAK,IAAIf,SAASW;QAExB,MAAMK,QAAQD,GACXE,OAAO,CACN,CAAC;;;;;;;;IAQL,CAAC,EAEEC,GAAG;QAEN,MAAMC,iBAAiBJ,GACpBE,OAAO,CACN,CAAC;;;;;;;;;;;;;IAaL,CAAC,EAEEG,GAAG;QAENL,GAAGM,KAAK;QAER,OAAO;YACLR,WAAW;YACXS,MAAM;YACNC,SAASP;YACTQ,QAAQL;QACV;IACF,EAAE,OAAOM,OAAO;QACd,OAAO;YACLZ,WAAW;YACXC,QAAQ,CAAC,0BAA0B,EAAEW,MAAMC,OAAO,EAAE;QACtD;IACF;AACF;AAKA,eAAehB,iBAAiBL,QAAQ,EAAEE,QAAQ;IAChD,MAAMoB,cAAc;QAClBd,WAAWR,SAASQ,SAAS,IAAIN,SAASM,SAAS;QACnDe,SAAS,EAAE;IACb;IAEA,IAAIvB,SAASQ,SAAS,EAAE;QACtBc,YAAYC,OAAO,CAACC,IAAI,CAACxB;IAC3B;IAEA,IAAIE,SAASM,SAAS,EAAE;QACtBc,YAAYC,OAAO,CAACC,IAAI,CAACtB;IAC3B;IAGA,IAAIoB,YAAYC,OAAO,CAACE,MAAM,GAAG,GAAG;QAClCH,YAAYI,QAAQ,GAAG;YACrBC,cAAcL,YAAYC,OAAO,CAACK,MAAM,CACtC,CAACC,KAAKC,MAAQD,MAAOC,CAAAA,IAAIZ,OAAO,EAAES,gBAAgB,CAAA,GAClD;YAEFI,cAAcT,YAAYC,OAAO,CAACK,MAAM,CACtC,CAACC,KAAKC,MAAQD,MAAOC,CAAAA,IAAIZ,OAAO,EAAEa,gBAAgB,CAAA,GAClD;YAEFC,aAAaV,YAAYC,OAAO,CAACK,MAAM,CACrC,CAACC,KAAKC,MAAQD,MAAOC,CAAAA,IAAIZ,OAAO,EAAEc,eAAe,CAAA,GACjD;YAEFC,iBAAiBX,YAAYC,OAAO,CAACK,MAAM,CACzC,CAACC,KAAKC,MAAQD,MAAOC,CAAAA,IAAIZ,OAAO,EAAEe,mBAAmB,CAAA,GACrD;YAEFC,mBAAmBZ,YAAYC,OAAO,CAACK,MAAM,CAC3C,CAACC,KAAKC,MAAQD,MAAOC,CAAAA,IAAIZ,OAAO,EAAEgB,qBAAqB,CAAA,GACvD;YAEFC,eAAeb,YAAYC,OAAO,CAACK,MAAM,CACvC,CAACC,KAAKC,MAAQD,MAAOC,CAAAA,IAAIZ,OAAO,EAAEiB,iBAAiB,CAAA,GACnD;QAEJ;QAEAb,YAAYI,QAAQ,CAACU,YAAY,GAC/Bd,YAAYI,QAAQ,CAACM,WAAW,GAAG,IAC/B,AAAC,CAAA,AAACV,YAAYI,QAAQ,CAACO,eAAe,GAAGX,YAAYI,QAAQ,CAACM,WAAW,GAAI,GAAE,EAAGK,OAAO,CACvF,KAEF;IACR;IAEA,OAAOf;AACT;AAKA,OAAO,eAAegB;IACpBC,QAAQC,GAAG,CAAC5C,MAAM6C,IAAI,CAAC;IAEvB,MAAMC,UAAU,MAAM5C;IAGtB,IAAI4C,QAAQtC,UAAU,CAACI,SAAS,EAAE;QAChC+B,QAAQC,GAAG,CAAC5C,MAAM+C,IAAI,CAAC;QACvB,MAAMjB,WAAWgB,QAAQtC,UAAU,CAACsB,QAAQ;QAC5Ca,QAAQC,GAAG,CAAC,CAAC,gBAAgB,EAAEd,SAASC,YAAY,EAAE;QACtDY,QAAQC,GAAG,CAAC,CAAC,gBAAgB,EAAEd,SAASK,YAAY,EAAE;QACtDQ,QAAQC,GAAG,CAAC,CAAC,eAAe,EAAEd,SAASM,WAAW,EAAE;QACpDO,QAAQC,GAAG,CAAC,CAAC,aAAa,EAAE5C,MAAMgD,KAAK,CAAClB,SAASO,eAAe,GAAG;QACnEM,QAAQC,GAAG,CAAC,CAAC,eAAe,EAAE5C,MAAMiD,MAAM,CAACnB,SAASQ,iBAAiB,GAAG;QACxEK,QAAQC,GAAG,CAAC,CAAC,WAAW,EAAE5C,MAAMkD,IAAI,CAACpB,SAASS,aAAa,GAAG;QAC9DI,QAAQC,GAAG,CAAC,CAAC,gBAAgB,EAAEd,SAASU,YAAY,CAAC,CAAC,CAAC;QACvDG,QAAQC,GAAG;IACb;IAGA,KAAK,MAAMO,UAAUL,QAAQtC,UAAU,CAACmB,OAAO,CAAE;QAC/C,MAAMyB,aAAaD,OAAO9B,IAAI,KAAK,cAAc,wBAAwB;QACzEsB,QAAQC,GAAG,CAAC5C,MAAMiD,MAAM,CAAC,GAAGG,WAAW,CAAC,CAAC;QACzCT,QAAQC,GAAG,CAAC5C,MAAMkD,IAAI,CAAC,IAAIG,MAAM,CAAC;QAElC,MAAMtC,QAAQoC,OAAO7B,OAAO;QAC5BqB,QAAQC,GAAG,CACT,CAAC,UAAU,EAAE7B,MAAMgB,YAAY,CAAC,UAAU,EAAEhB,MAAMoB,YAAY,CAAC,SAAS,EAAEpB,MAAMqB,WAAW,EAAE;QAE/FO,QAAQC,GAAG,CACT,CAAC,aAAa,EAAE7B,MAAMsB,eAAe,CAAC,eAAe,EAAEtB,MAAMuB,iBAAiB,CAAC,WAAW,EAAEvB,MAAMwB,aAAa,EAAE;QAGnH,IAAIY,OAAO5B,MAAM,IAAI4B,OAAO5B,MAAM,CAACM,MAAM,GAAG,GAAG;YAC7Cc,QAAQC,GAAG,CAAC;YACZO,OAAO5B,MAAM,CAAC+B,OAAO,CAAC,CAACC;gBACrB,MAAMC,OAAOD,MAAMC,IAAI,IAAID,MAAME,EAAE,CAACC,SAAS,CAAC,GAAG,MAAM;gBACvD,MAAMC,QAAQJ,MAAMK,UAAU,IAAI;gBAClC,MAAMC,YAAYN,MAAMO,eAAe,IAAI;gBAC3C,MAAMC,OAAOJ,QAAQ,IAAI,AAAC,CAAA,AAACE,YAAYF,QAAS,GAAE,EAAGlB,OAAO,CAAC,KAAK;gBAElEE,QAAQC,GAAG,CAAC,CAAC,IAAI,EAAE5C,MAAM+C,IAAI,CAACS,MAAM,EAAE,EAAEK,UAAU,CAAC,EAAEF,MAAM,QAAQ,EAAEI,KAAK,EAAE,CAAC;gBAC7E,IAAIR,MAAMS,SAAS,EAAE;oBACnBrB,QAAQC,GAAG,CAAC,CAAC,iBAAiB,EAAEW,MAAMS,SAAS,CAACN,SAAS,CAAC,GAAG,IAAI,GAAG,CAAC;gBACvE;gBACA,IAAIH,MAAMU,QAAQ,EAAE;oBAClBtB,QAAQC,GAAG,CAAC,CAAC,gBAAgB,EAAEW,MAAMU,QAAQ,CAAC,YAAY,EAAEV,MAAMW,QAAQ,IAAI,OAAO;gBACvF;YACF;QACF;QACAvB,QAAQC,GAAG;IACb;IAGAD,QAAQC,GAAG,CAAC5C,MAAM+C,IAAI,CAAC;IACvBJ,QAAQC,GAAG,CACT,CAAC,aAAa,EAAEE,QAAQ1C,QAAQ,CAACQ,SAAS,GAAGZ,MAAMgD,KAAK,CAAC,iBAAiBhD,MAAMmE,GAAG,CAAC,OAAOrB,QAAQ1C,QAAQ,CAACS,MAAM,GAAG;IAEvH8B,QAAQC,GAAG,CACT,CAAC,aAAa,EAAEE,QAAQxC,QAAQ,CAACM,SAAS,GAAGZ,MAAMgD,KAAK,CAAC,iBAAiBhD,MAAMmE,GAAG,CAAC,OAAOrB,QAAQxC,QAAQ,CAACO,MAAM,GAAG;IAGvH,OAAOiC;AACT;AAKA,OAAO,eAAesB;IACpBzB,QAAQC,GAAG,CAAC5C,MAAM6C,IAAI,CAAC;IAEvB,MAAMC,UAAU,MAAM5C;IACtB,MAAMmE,QAAQ,EAAE;IAGhB,IAAIvB,QAAQ1C,QAAQ,CAACQ,SAAS,IAAIkC,QAAQxC,QAAQ,CAACM,SAAS,EAAE;QAC5D+B,QAAQC,GAAG,CAAC5C,MAAMgD,KAAK,CAAC;QAGxB,MAAMsB,iBAAiB,EAAE;QAEzB,IAAIxB,QAAQxC,QAAQ,CAACiB,MAAM,EAAE;YAC3BuB,QAAQxC,QAAQ,CAACiB,MAAM,CAAC+B,OAAO,CAAC,CAACC;gBAC/B,IAAIA,MAAMK,UAAU,KAAK,GAAG;oBAC1BU,eAAe1C,IAAI,CAAC;wBAAEuB,QAAQ;wBAAaI;oBAAM;gBACnD;YACF;QACF;QAEA,IAAIT,QAAQ1C,QAAQ,CAACmB,MAAM,EAAE;YAC3BuB,QAAQ1C,QAAQ,CAACmB,MAAM,CAAC+B,OAAO,CAAC,CAACC;gBAC/B,IAAIA,MAAMK,UAAU,KAAK,GAAG;oBAC1BU,eAAe1C,IAAI,CAAC;wBAAEuB,QAAQ;wBAAaI;oBAAM;gBACnD;YACF;QACF;QAEA,IAAIe,eAAezC,MAAM,GAAG,GAAG;YAC7Bc,QAAQC,GAAG,CAAC5C,MAAMiD,MAAM,CAAC,CAAC,UAAU,EAAEqB,eAAezC,MAAM,CAAC,oBAAoB,CAAC;YACjFwC,MAAMzC,IAAI,CAAC;QACb,OAAO;YACLe,QAAQC,GAAG,CAAC5C,MAAMgD,KAAK,CAAC;QAC1B;IACF,OAAO,IAAIF,QAAQ1C,QAAQ,CAACQ,SAAS,EAAE;QACrC+B,QAAQC,GAAG,CAAC5C,MAAMiD,MAAM,CAAC;QACzBoB,MAAMzC,IAAI,CAAC;IACb,OAAO,IAAIkB,QAAQxC,QAAQ,CAACM,SAAS,EAAE;QACrC+B,QAAQC,GAAG,CAAC5C,MAAMiD,MAAM,CAAC;QACzBoB,MAAMzC,IAAI,CAAC;IACb,OAAO;QACLe,QAAQC,GAAG,CAAC5C,MAAMmE,GAAG,CAAC;QACtBE,MAAMzC,IAAI,CAAC;IACb;IAGA,KAAK,MAAM2C,OAAOF,MAAO;QACvB,MAAMG,SAASD,KAAKzB;IACtB;IAEAH,QAAQC,GAAG,CAAC5C,MAAMgD,KAAK,CAAC;IAGxBL,QAAQC,GAAG,CAAC5C,MAAMkD,IAAI,CAAC;IACvB,MAAMR;AACR;AAKA,eAAe8B,SAASC,OAAO,EAAE3B,OAAO;IACtC,OAAQ2B;QACN,KAAK;YACH9B,QAAQC,GAAG,CAAC5C,MAAM0E,IAAI,CAAC;YACvB,MAAMC,kBAAkB7B;YACxB;QAEF,KAAK;YACHH,QAAQC,GAAG,CAAC5C,MAAM0E,IAAI,CAAC;YACvB/B,QAAQC,GAAG,CAAC5C,MAAMkD,IAAI,CAAC;YACvB;QAEF,KAAK;YACHP,QAAQC,GAAG,CAAC5C,MAAM0E,IAAI,CAAC;YACvB/B,QAAQC,GAAG,CAAC5C,MAAMkD,IAAI,CAAC;YACvB;QAEF,KAAK;YACHP,QAAQC,GAAG,CAAC5C,MAAM0E,IAAI,CAAC;YACvB/B,QAAQC,GAAG,CAAC5C,MAAMkD,IAAI,CAAC;YACvB;IACJ;AACF;AAKA,eAAeyB,kBAAkB7B,OAAO;IAEtCH,QAAQC,GAAG,CAAC5C,MAAMgD,KAAK,CAAC;IACxBL,QAAQC,GAAG,CAAC5C,MAAMgD,KAAK,CAAC;AAC1B"}