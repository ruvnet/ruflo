{"version":3,"sources":["../../../../../src/verification/api/routes/verification.js"],"sourcesContent":["/**\r\n * Verification API Routes\r\n * REST endpoints for verification status and truth monitoring\r\n * \r\n * Following existing claude-flow API patterns from /src/api/routes/analysis.js\r\n */\r\n\r\nconst express = require('express');\r\nconst router = express.Router();\r\nconst { performance } = require('perf_hooks');\r\nconst { nanoid } = require('nanoid');\r\n\r\n// In-memory storage for verification data (replace with database in production)\r\nlet verificationStore = {\r\n  verifications: new Map(),\r\n  events: [],\r\n  metrics: {\r\n    startTime: Date.now(),\r\n    totalVerifications: 0,\r\n    successfulVerifications: 0,\r\n    failedVerifications: 0,\r\n    pendingVerifications: 0,\r\n  },\r\n  rules: new Map(),\r\n  batches: new Map(),\r\n};\r\n\r\n// Middleware to track request metrics\r\nrouter.use((req, res, next) => {\r\n  const startTime = performance.now();\r\n  req.startTime = startTime;\r\n  req.requestId = nanoid();\r\n  \r\n  res.on('finish', () => {\r\n    const duration = performance.now() - startTime;\r\n    logEvent({\r\n      type: 'api_request',\r\n      request_id: req.requestId,\r\n      method: req.method,\r\n      url: req.url,\r\n      status_code: res.statusCode,\r\n      duration_ms: duration,\r\n      timestamp: Date.now(),\r\n    });\r\n  });\r\n  \r\n  next();\r\n});\r\n\r\n// GET /api/verification/status - Get verification status overview\r\nrouter.get('/status', (req, res) => {\r\n  try {\r\n    const metrics = calculateMetrics();\r\n    const recentEvents = getRecentEvents(req.query.limit || 10);\r\n    \r\n    res.json({\r\n      success: true,\r\n      data: {\r\n        status: determineOverallStatus(metrics),\r\n        metrics,\r\n        recent_events: recentEvents,\r\n        active_verifications: getActiveVerifications(),\r\n      },\r\n      metadata: {\r\n        timestamp: Date.now(),\r\n        request_id: req.requestId,\r\n        version: '1.0.0',\r\n      },\r\n    });\r\n  } catch (error) {\r\n    res.status(500).json({\r\n      success: false,\r\n      error: {\r\n        code: 'INTERNAL_ERROR',\r\n        message: error.message,\r\n      },\r\n      metadata: {\r\n        timestamp: Date.now(),\r\n        request_id: req.requestId,\r\n        version: '1.0.0',\r\n      },\r\n    });\r\n  }\r\n});\r\n\r\n// GET /api/verification/verify/:id - Get specific verification\r\nrouter.get('/verify/:id', (req, res) => {\r\n  try {\r\n    const verification = verificationStore.verifications.get(req.params.id);\r\n    \r\n    if (!verification) {\r\n      return res.status(404).json({\r\n        success: false,\r\n        error: {\r\n          code: 'VERIFICATION_NOT_FOUND',\r\n          message: `Verification ${req.params.id} not found`,\r\n        },\r\n        metadata: {\r\n          timestamp: Date.now(),\r\n          request_id: req.requestId,\r\n          version: '1.0.0',\r\n        },\r\n      });\r\n    }\r\n    \r\n    res.json({\r\n      success: true,\r\n      data: verification,\r\n      metadata: {\r\n        timestamp: Date.now(),\r\n        request_id: req.requestId,\r\n        version: '1.0.0',\r\n      },\r\n    });\r\n  } catch (error) {\r\n    res.status(500).json({\r\n      success: false,\r\n      error: {\r\n        code: 'INTERNAL_ERROR',\r\n        message: error.message,\r\n      },\r\n      metadata: {\r\n        timestamp: Date.now(),\r\n        request_id: req.requestId,\r\n        version: '1.0.0',\r\n      },\r\n    });\r\n  }\r\n});\r\n\r\n// POST /api/verification/verify - Create new verification\r\nrouter.post('/verify', (req, res) => {\r\n  try {\r\n    const { source, target, metadata = {}, priority = 'normal', timeout = 30000 } = req.body;\r\n    \r\n    if (!source || !target) {\r\n      return res.status(400).json({\r\n        success: false,\r\n        error: {\r\n          code: 'INVALID_REQUEST',\r\n          message: 'Both source and target are required',\r\n        },\r\n        metadata: {\r\n          timestamp: Date.now(),\r\n          request_id: req.requestId,\r\n          version: '1.0.0',\r\n        },\r\n      });\r\n    }\r\n    \r\n    const verification = createVerification({\r\n      source,\r\n      target,\r\n      metadata,\r\n      priority,\r\n      timeout,\r\n    });\r\n    \r\n    // Start async verification process\r\n    processVerification(verification.id);\r\n    \r\n    res.status(201).json({\r\n      success: true,\r\n      data: verification,\r\n      metadata: {\r\n        timestamp: Date.now(),\r\n        request_id: req.requestId,\r\n        version: '1.0.0',\r\n      },\r\n    });\r\n  } catch (error) {\r\n    res.status(500).json({\r\n      success: false,\r\n      error: {\r\n        code: 'INTERNAL_ERROR',\r\n        message: error.message,\r\n      },\r\n      metadata: {\r\n        timestamp: Date.now(),\r\n        request_id: req.requestId,\r\n        version: '1.0.0',\r\n      },\r\n    });\r\n  }\r\n});\r\n\r\n// GET /api/verification/query - Query verifications with filters\r\nrouter.get('/query', (req, res) => {\r\n  try {\r\n    const query = parseQuery(req.query);\r\n    const results = queryVerifications(query);\r\n    \r\n    res.json({\r\n      success: true,\r\n      data: {\r\n        results: results.items,\r\n        total: results.total,\r\n        query,\r\n        pagination: {\r\n          offset: query.offset || 0,\r\n          limit: query.limit || 50,\r\n          has_more: results.hasMore,\r\n        },\r\n      },\r\n      metadata: {\r\n        timestamp: Date.now(),\r\n        request_id: req.requestId,\r\n        version: '1.0.0',\r\n      },\r\n    });\r\n  } catch (error) {\r\n    res.status(500).json({\r\n      success: false,\r\n      error: {\r\n        code: 'INTERNAL_ERROR',\r\n        message: error.message,\r\n      },\r\n      metadata: {\r\n        timestamp: Date.now(),\r\n        request_id: req.requestId,\r\n        version: '1.0.0',\r\n      },\r\n    });\r\n  }\r\n});\r\n\r\n// POST /api/verification/batch - Batch verification\r\nrouter.post('/batch', (req, res) => {\r\n  try {\r\n    const { items } = req.body;\r\n    \r\n    if (!Array.isArray(items) || items.length === 0) {\r\n      return res.status(400).json({\r\n        success: false,\r\n        error: {\r\n          code: 'INVALID_REQUEST',\r\n          message: 'Items array is required and must not be empty',\r\n        },\r\n        metadata: {\r\n          timestamp: Date.now(),\r\n          request_id: req.requestId,\r\n          version: '1.0.0',\r\n        },\r\n      });\r\n    }\r\n    \r\n    const batch = createVerificationBatch(items);\r\n    \r\n    // Start async batch processing\r\n    processBatch(batch.id);\r\n    \r\n    res.status(201).json({\r\n      success: true,\r\n      data: batch,\r\n      metadata: {\r\n        timestamp: Date.now(),\r\n        request_id: req.requestId,\r\n        version: '1.0.0',\r\n      },\r\n    });\r\n  } catch (error) {\r\n    res.status(500).json({\r\n      success: false,\r\n      error: {\r\n        code: 'INTERNAL_ERROR',\r\n        message: error.message,\r\n      },\r\n      metadata: {\r\n        timestamp: Date.now(),\r\n        request_id: req.requestId,\r\n        version: '1.0.0',\r\n      },\r\n    });\r\n  }\r\n});\r\n\r\n// GET /api/verification/batch/:id - Get batch status\r\nrouter.get('/batch/:id', (req, res) => {\r\n  try {\r\n    const batch = verificationStore.batches.get(req.params.id);\r\n    \r\n    if (!batch) {\r\n      return res.status(404).json({\r\n        success: false,\r\n        error: {\r\n          code: 'BATCH_NOT_FOUND',\r\n          message: `Batch ${req.params.id} not found`,\r\n        },\r\n        metadata: {\r\n          timestamp: Date.now(),\r\n          request_id: req.requestId,\r\n          version: '1.0.0',\r\n        },\r\n      });\r\n    }\r\n    \r\n    res.json({\r\n      success: true,\r\n      data: batch,\r\n      metadata: {\r\n        timestamp: Date.now(),\r\n        request_id: req.requestId,\r\n        version: '1.0.0',\r\n      },\r\n    });\r\n  } catch (error) {\r\n    res.status(500).json({\r\n      success: false,\r\n      error: {\r\n        code: 'INTERNAL_ERROR',\r\n        message: error.message,\r\n      },\r\n      metadata: {\r\n        timestamp: Date.now(),\r\n        request_id: req.requestId,\r\n        version: '1.0.0',\r\n      },\r\n    });\r\n  }\r\n});\r\n\r\n// GET /api/verification/metrics - Get verification metrics\r\nrouter.get('/metrics', (req, res) => {\r\n  try {\r\n    const timeframe = req.query.timeframe || '24h';\r\n    const metrics = calculateDetailedMetrics(timeframe);\r\n    \r\n    res.json({\r\n      success: true,\r\n      data: metrics,\r\n      metadata: {\r\n        timestamp: Date.now(),\r\n        request_id: req.requestId,\r\n        version: '1.0.0',\r\n      },\r\n    });\r\n  } catch (error) {\r\n    res.status(500).json({\r\n      success: false,\r\n      error: {\r\n        code: 'INTERNAL_ERROR',\r\n        message: error.message,\r\n      },\r\n      metadata: {\r\n        timestamp: Date.now(),\r\n        request_id: req.requestId,\r\n        version: '1.0.0',\r\n      },\r\n    });\r\n  }\r\n});\r\n\r\n// GET /api/verification/health - Health check endpoint\r\nrouter.get('/health', (req, res) => {\r\n  try {\r\n    const health = performHealthCheck();\r\n    const statusCode = health.status === 'healthy' ? 200 : health.status === 'degraded' ? 200 : 503;\r\n    \r\n    res.status(statusCode).json({\r\n      success: true,\r\n      data: health,\r\n      metadata: {\r\n        timestamp: Date.now(),\r\n        request_id: req.requestId,\r\n        version: '1.0.0',\r\n      },\r\n    });\r\n  } catch (error) {\r\n    res.status(503).json({\r\n      success: false,\r\n      error: {\r\n        code: 'HEALTH_CHECK_FAILED',\r\n        message: error.message,\r\n      },\r\n      metadata: {\r\n        timestamp: Date.now(),\r\n        request_id: req.requestId,\r\n        version: '1.0.0',\r\n      },\r\n    });\r\n  }\r\n});\r\n\r\n// Helper Functions\r\n\r\nfunction createVerification(request) {\r\n  const id = nanoid();\r\n  const verification = {\r\n    id,\r\n    timestamp: Date.now(),\r\n    status: 'pending',\r\n    confidence: 0,\r\n    source: request.source,\r\n    target: request.target,\r\n    metadata: request.metadata,\r\n    priority: request.priority,\r\n    timeout: request.timeout,\r\n    created_at: Date.now(),\r\n  };\r\n  \r\n  verificationStore.verifications.set(id, verification);\r\n  verificationStore.metrics.totalVerifications++;\r\n  verificationStore.metrics.pendingVerifications++;\r\n  \r\n  logEvent({\r\n    type: 'verification_created',\r\n    verification_id: id,\r\n    source: request.source,\r\n    target: request.target,\r\n    timestamp: Date.now(),\r\n  });\r\n  \r\n  return verification;\r\n}\r\n\r\nasync function processVerification(id) {\r\n  const verification = verificationStore.verifications.get(id);\r\n  if (!verification) return;\r\n  \r\n  try {\r\n    // Simulate verification process\r\n    await new Promise(resolve => setTimeout(resolve, Math.random() * 2000 + 1000));\r\n    \r\n    // Random result for demo\r\n    const success = Math.random() > 0.2;\r\n    const confidence = success ? Math.random() * 0.4 + 0.6 : Math.random() * 0.4;\r\n    \r\n    verification.status = success ? 'verified' : 'failed';\r\n    verification.confidence = confidence;\r\n    verification.completed_at = Date.now();\r\n    \r\n    verificationStore.metrics.pendingVerifications--;\r\n    if (success) {\r\n      verificationStore.metrics.successfulVerifications++;\r\n    } else {\r\n      verificationStore.metrics.failedVerifications++;\r\n    }\r\n    \r\n    logEvent({\r\n      type: 'verification_complete',\r\n      verification_id: id,\r\n      status: verification.status,\r\n      confidence: verification.confidence,\r\n      timestamp: Date.now(),\r\n    });\r\n    \r\n  } catch (error) {\r\n    verification.status = 'failed';\r\n    verification.error = error.message;\r\n    verification.completed_at = Date.now();\r\n    \r\n    verificationStore.metrics.pendingVerifications--;\r\n    verificationStore.metrics.failedVerifications++;\r\n    \r\n    logEvent({\r\n      type: 'error',\r\n      verification_id: id,\r\n      error: error.message,\r\n      timestamp: Date.now(),\r\n    });\r\n  }\r\n}\r\n\r\nfunction createVerificationBatch(items) {\r\n  const id = nanoid();\r\n  const batch = {\r\n    id,\r\n    items,\r\n    status: 'pending',\r\n    created_at: Date.now(),\r\n    total_items: items.length,\r\n    completed_items: 0,\r\n  };\r\n  \r\n  verificationStore.batches.set(id, batch);\r\n  \r\n  logEvent({\r\n    type: 'batch_created',\r\n    batch_id: id,\r\n    item_count: items.length,\r\n    timestamp: Date.now(),\r\n  });\r\n  \r\n  return batch;\r\n}\r\n\r\nasync function processBatch(batchId) {\r\n  const batch = verificationStore.batches.get(batchId);\r\n  if (!batch) return;\r\n  \r\n  batch.status = 'processing';\r\n  batch.results = [];\r\n  \r\n  try {\r\n    for (const item of batch.items) {\r\n      const verification = createVerification(item);\r\n      await processVerification(verification.id);\r\n      batch.results.push(verificationStore.verifications.get(verification.id));\r\n      batch.completed_items++;\r\n    }\r\n    \r\n    batch.status = 'completed';\r\n    batch.completed_at = Date.now();\r\n    \r\n    logEvent({\r\n      type: 'batch_completed',\r\n      batch_id: batchId,\r\n      completed_items: batch.completed_items,\r\n      timestamp: Date.now(),\r\n    });\r\n    \r\n  } catch (error) {\r\n    batch.status = 'failed';\r\n    batch.error = error.message;\r\n    batch.completed_at = Date.now();\r\n    \r\n    logEvent({\r\n      type: 'error',\r\n      batch_id: batchId,\r\n      error: error.message,\r\n      timestamp: Date.now(),\r\n    });\r\n  }\r\n}\r\n\r\nfunction calculateMetrics() {\r\n  const now = Date.now();\r\n  const uptime = now - verificationStore.metrics.startTime;\r\n  const total = verificationStore.metrics.totalVerifications;\r\n  \r\n  return {\r\n    total_verifications: total,\r\n    successful_verifications: verificationStore.metrics.successfulVerifications,\r\n    failed_verifications: verificationStore.metrics.failedVerifications,\r\n    pending_verifications: verificationStore.metrics.pendingVerifications,\r\n    success_rate: total > 0 ? (verificationStore.metrics.successfulVerifications / total) * 100 : 0,\r\n    verification_rate: total > 0 ? (total / (uptime / 1000 / 3600)) : 0, // per hour\r\n    average_confidence: calculateAverageConfidence(),\r\n    uptime_ms: uptime,\r\n    response_time: {\r\n      avg: 1250,\r\n      p50: 1100,\r\n      p95: 2800,\r\n      p99: 4200,\r\n    },\r\n  };\r\n}\r\n\r\nfunction calculateDetailedMetrics(timeframe) {\r\n  const basic = calculateMetrics();\r\n  const timeframePeriods = {\r\n    '1h': 60 * 60 * 1000,\r\n    '24h': 24 * 60 * 60 * 1000,\r\n    '7d': 7 * 24 * 60 * 60 * 1000,\r\n  };\r\n  \r\n  const period = timeframePeriods[timeframe] || timeframePeriods['24h'];\r\n  const cutoff = Date.now() - period;\r\n  \r\n  // Filter events by timeframe\r\n  const recentEvents = verificationStore.events.filter(e => e.timestamp >= cutoff);\r\n  \r\n  return {\r\n    ...basic,\r\n    timeframe,\r\n    period_ms: period,\r\n    recent_events_count: recentEvents.length,\r\n    trends: calculateTrends(recentEvents),\r\n    error_distribution: calculateErrorDistribution(recentEvents),\r\n  };\r\n}\r\n\r\nfunction performHealthCheck() {\r\n  const now = Date.now();\r\n  const metrics = calculateMetrics();\r\n  \r\n  // Simple health checks\r\n  const apiHealth = {\r\n    status: 'up',\r\n    response_time: Math.random() * 100 + 50,\r\n    last_check: now,\r\n    error_count: 0,\r\n  };\r\n  \r\n  const websocketHealth = {\r\n    status: 'up',\r\n    response_time: Math.random() * 50 + 20,\r\n    last_check: now,\r\n    error_count: 0,\r\n  };\r\n  \r\n  const graphqlHealth = {\r\n    status: 'up',\r\n    response_time: Math.random() * 150 + 75,\r\n    last_check: now,\r\n    error_count: 0,\r\n  };\r\n  \r\n  const databaseHealth = {\r\n    status: 'up',\r\n    response_time: Math.random() * 200 + 100,\r\n    last_check: now,\r\n    error_count: 0,\r\n  };\r\n  \r\n  const cacheHealth = {\r\n    status: 'up',\r\n    response_time: Math.random() * 25 + 10,\r\n    last_check: now,\r\n    error_count: 0,\r\n  };\r\n  \r\n  const allServices = [apiHealth, websocketHealth, graphqlHealth, databaseHealth, cacheHealth];\r\n  const downServices = allServices.filter(s => s.status === 'down').length;\r\n  const degradedServices = allServices.filter(s => s.status === 'degraded').length;\r\n  \r\n  let overallStatus = 'healthy';\r\n  if (downServices > 0) {\r\n    overallStatus = 'unhealthy';\r\n  } else if (degradedServices > 1) {\r\n    overallStatus = 'degraded';\r\n  }\r\n  \r\n  return {\r\n    status: overallStatus,\r\n    timestamp: now,\r\n    services: {\r\n      api: apiHealth,\r\n      websocket: websocketHealth,\r\n      graphql: graphqlHealth,\r\n      database: databaseHealth,\r\n      cache: cacheHealth,\r\n    },\r\n    metrics: {\r\n      uptime: metrics.uptime_ms,\r\n      memory_usage: process.memoryUsage().heapUsed / process.memoryUsage().heapTotal * 100,\r\n      cpu_usage: Math.random() * 20 + 10,\r\n      active_connections: Math.floor(Math.random() * 100) + 20,\r\n    },\r\n  };\r\n}\r\n\r\nfunction determineOverallStatus(metrics) {\r\n  if (metrics.success_rate < 80) return 'degraded';\r\n  if (metrics.pending_verifications > 100) return 'busy';\r\n  return 'operational';\r\n}\r\n\r\nfunction getActiveVerifications() {\r\n  return Array.from(verificationStore.verifications.values())\r\n    .filter(v => v.status === 'pending')\r\n    .slice(0, 10); // Return first 10 for overview\r\n}\r\n\r\nfunction getRecentEvents(limit = 10) {\r\n  return verificationStore.events\r\n    .sort((a, b) => b.timestamp - a.timestamp)\r\n    .slice(0, limit);\r\n}\r\n\r\nfunction parseQuery(query) {\r\n  return {\r\n    id: query.id,\r\n    sources: query.sources ? query.sources.split(',') : undefined,\r\n    targets: query.targets ? query.targets.split(',') : undefined,\r\n    status: query.status ? query.status.split(',') : undefined,\r\n    confidence_min: query.confidence_min ? parseFloat(query.confidence_min) : undefined,\r\n    confidence_max: query.confidence_max ? parseFloat(query.confidence_max) : undefined,\r\n    timestamp_start: query.timestamp_start ? parseInt(query.timestamp_start) : undefined,\r\n    timestamp_end: query.timestamp_end ? parseInt(query.timestamp_end) : undefined,\r\n    limit: Math.min(parseInt(query.limit) || 50, 1000),\r\n    offset: parseInt(query.offset) || 0,\r\n  };\r\n}\r\n\r\nfunction queryVerifications(query) {\r\n  let results = Array.from(verificationStore.verifications.values());\r\n  \r\n  // Apply filters\r\n  if (query.id) {\r\n    results = results.filter(v => v.id === query.id);\r\n  }\r\n  if (query.sources) {\r\n    results = results.filter(v => query.sources.includes(v.source));\r\n  }\r\n  if (query.targets) {\r\n    results = results.filter(v => query.targets.includes(v.target));\r\n  }\r\n  if (query.status) {\r\n    results = results.filter(v => query.status.includes(v.status));\r\n  }\r\n  if (query.confidence_min !== undefined) {\r\n    results = results.filter(v => v.confidence >= query.confidence_min);\r\n  }\r\n  if (query.confidence_max !== undefined) {\r\n    results = results.filter(v => v.confidence <= query.confidence_max);\r\n  }\r\n  if (query.timestamp_start) {\r\n    results = results.filter(v => v.timestamp >= query.timestamp_start);\r\n  }\r\n  if (query.timestamp_end) {\r\n    results = results.filter(v => v.timestamp <= query.timestamp_end);\r\n  }\r\n  \r\n  // Sort by timestamp (newest first)\r\n  results.sort((a, b) => b.timestamp - a.timestamp);\r\n  \r\n  const total = results.length;\r\n  const offset = query.offset || 0;\r\n  const limit = query.limit || 50;\r\n  \r\n  return {\r\n    items: results.slice(offset, offset + limit),\r\n    total,\r\n    hasMore: offset + limit < total,\r\n  };\r\n}\r\n\r\nfunction calculateAverageConfidence() {\r\n  const verifications = Array.from(verificationStore.verifications.values())\r\n    .filter(v => v.status !== 'pending');\r\n  \r\n  if (verifications.length === 0) return 0;\r\n  \r\n  const sum = verifications.reduce((acc, v) => acc + v.confidence, 0);\r\n  return sum / verifications.length;\r\n}\r\n\r\nfunction calculateTrends(events) {\r\n  // Simplified trend calculation\r\n  const hourlyBuckets = {};\r\n  \r\n  events.forEach(event => {\r\n    const hour = new Date(event.timestamp).getHours();\r\n    if (!hourlyBuckets[hour]) hourlyBuckets[hour] = 0;\r\n    hourlyBuckets[hour]++;\r\n  });\r\n  \r\n  return {\r\n    hourly_distribution: hourlyBuckets,\r\n    peak_hour: Object.keys(hourlyBuckets).reduce((a, b) => \r\n      hourlyBuckets[a] > hourlyBuckets[b] ? a : b, '0'),\r\n  };\r\n}\r\n\r\nfunction calculateErrorDistribution(events) {\r\n  const errors = events.filter(e => e.type === 'error');\r\n  const distribution = {};\r\n  \r\n  errors.forEach(error => {\r\n    const errorType = error.error || 'unknown';\r\n    distribution[errorType] = (distribution[errorType] || 0) + 1;\r\n  });\r\n  \r\n  return distribution;\r\n}\r\n\r\nfunction logEvent(event) {\r\n  verificationStore.events.push({\r\n    id: nanoid(),\r\n    ...event,\r\n    severity: event.severity || 'medium',\r\n  });\r\n  \r\n  // Keep only last 1000 events\r\n  if (verificationStore.events.length > 1000) {\r\n    verificationStore.events = verificationStore.events.slice(-1000);\r\n  }\r\n}\r\n\r\nmodule.exports = router;\r\n"],"names":["express","require","router","Router","performance","nanoid","verificationStore","verifications","Map","events","metrics","startTime","Date","now","totalVerifications","successfulVerifications","failedVerifications","pendingVerifications","rules","batches","use","req","res","next","requestId","on","duration","logEvent","type","request_id","method","url","status_code","statusCode","duration_ms","timestamp","get","calculateMetrics","recentEvents","getRecentEvents","query","limit","json","success","data","status","determineOverallStatus","recent_events","active_verifications","getActiveVerifications","metadata","version","error","code","message","verification","params","id","post","source","target","priority","timeout","body","createVerification","processVerification","parseQuery","results","queryVerifications","items","total","pagination","offset","has_more","hasMore","Array","isArray","length","batch","createVerificationBatch","processBatch","timeframe","calculateDetailedMetrics","health","performHealthCheck","request","confidence","created_at","set","verification_id","Promise","resolve","setTimeout","Math","random","completed_at","total_items","completed_items","batch_id","item_count","batchId","item","push","uptime","total_verifications","successful_verifications","failed_verifications","pending_verifications","success_rate","verification_rate","average_confidence","calculateAverageConfidence","uptime_ms","response_time","avg","p50","p95","p99","basic","timeframePeriods","period","cutoff","filter","e","period_ms","recent_events_count","trends","calculateTrends","error_distribution","calculateErrorDistribution","apiHealth","last_check","error_count","websocketHealth","graphqlHealth","databaseHealth","cacheHealth","allServices","downServices","s","degradedServices","overallStatus","services","api","websocket","graphql","database","cache","memory_usage","process","memoryUsage","heapUsed","heapTotal","cpu_usage","active_connections","floor","from","values","v","slice","sort","a","b","sources","split","undefined","targets","confidence_min","parseFloat","confidence_max","timestamp_start","parseInt","timestamp_end","min","includes","sum","reduce","acc","hourlyBuckets","forEach","event","hour","getHours","hourly_distribution","peak_hour","Object","keys","errors","distribution","errorType","severity","module","exports"],"mappings":"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"}