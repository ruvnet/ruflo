{"version":3,"sources":["../../../../../src/verification/tests/e2e/verification-pipeline.test.ts"],"sourcesContent":["/**\r\n * End-to-End Tests for Complete Verification Pipeline\r\n * \r\n * Tests the entire verification system including:\r\n * - Full workflow verification from task assignment to completion\r\n * - Integration with truth scoring and cross-agent verification\r\n * - Real-world scenarios with multiple agents and complex tasks\r\n * - Error handling and recovery mechanisms\r\n */\r\n\r\nimport { jest } from '@jest/globals';\r\nimport { spawn, ChildProcess } from 'child_process';\r\nimport * as fs from 'fs/promises';\r\nimport * as path from 'path';\r\nimport * as os from 'os';\r\nimport { EventEmitter } from 'events';\r\nimport { VerificationPipeline } from '../../pipeline.js';\r\n\r\ninterface PipelineConfig {\r\n  agents: AgentConfig[];\r\n  tasks: TaskConfig[];\r\n  verificationRules: VerificationRule[];\r\n  truthThreshold: number;\r\n  timeoutMs: number;\r\n}\r\n\r\ninterface AgentConfig {\r\n  id: string;\r\n  type: string;\r\n  capabilities: string[];\r\n  reliability: number;\r\n  verificationEnabled: boolean;\r\n}\r\n\r\ninterface TaskConfig {\r\n  id: string;\r\n  description: string;\r\n  requiredCapabilities: string[];\r\n  expectedDuration: number;\r\n  verificationCriteria: VerificationCriteria;\r\n}\r\n\r\ninterface VerificationRule {\r\n  name: string;\r\n  condition: string;\r\n  action: 'warn' | 'reject' | 'escalate';\r\n  threshold: number;\r\n}\r\n\r\ninterface VerificationCriteria {\r\n  requiresTests: boolean;\r\n  requiresCodeReview: boolean;\r\n  requiresBuild: boolean;\r\n  minTruthScore: number;\r\n  crossVerificationRequired: boolean;\r\n}\r\n\r\ninterface PipelineResult {\r\n  taskId: string;\r\n  status: 'completed' | 'failed' | 'timeout' | 'rejected';\r\n  truthScore: number;\r\n  verificationResults: VerificationStepResult[];\r\n  duration: number;\r\n  agentPerformance: Map<string, AgentPerformance>;\r\n  errors: string[];\r\n}\r\n\r\ninterface VerificationStepResult {\r\n  step: string;\r\n  agentId: string;\r\n  passed: boolean;\r\n  truthScore: number;\r\n  evidence: any;\r\n  conflicts: string[];\r\n  timestamp: number;\r\n}\r\n\r\ninterface AgentPerformance {\r\n  tasksCompleted: number;\r\n  averageTruthScore: number;\r\n  conflictRate: number;\r\n  responseTime: number;\r\n}\r\n\r\ndescribe('Verification Pipeline E2E Tests', () => {\r\n  let tempDir: string;\r\n  let pipeline: VerificationPipeline;\r\n  let config: PipelineConfig;\r\n\r\n  beforeEach(async () => {\r\n    tempDir = await fs.mkdtemp(path.join(os.tmpdir(), 'verification-e2e-'));\r\n    \r\n    // Setup pipeline configuration\r\n    config = createTestPipelineConfig();\r\n    pipeline = new VerificationPipeline(config, tempDir);\r\n    \r\n    await pipeline.initialize();\r\n  });\r\n\r\n  afterEach(async () => {\r\n    await pipeline.shutdown();\r\n    await fs.rm(tempDir, { recursive: true, force: true });\r\n  });\r\n\r\n  function createTestPipelineConfig(): PipelineConfig {\r\n    return {\r\n      agents: [\r\n        {\r\n          id: 'coder-alpha',\r\n          type: 'coder',\r\n          capabilities: ['implement', 'test', 'debug'],\r\n          reliability: 0.9,\r\n          verificationEnabled: true\r\n        },\r\n        {\r\n          id: 'reviewer-beta',\r\n          type: 'reviewer',\r\n          capabilities: ['review', 'verify', 'validate'],\r\n          reliability: 0.95,\r\n          verificationEnabled: true\r\n        },\r\n        {\r\n          id: 'tester-gamma',\r\n          type: 'tester',\r\n          capabilities: ['test', 'benchmark', 'validate'],\r\n          reliability: 0.85,\r\n          verificationEnabled: true\r\n        },\r\n        {\r\n          id: 'coordinator-delta',\r\n          type: 'coordinator',\r\n          capabilities: ['orchestrate', 'monitor', 'report'],\r\n          reliability: 0.92,\r\n          verificationEnabled: true\r\n        }\r\n      ],\r\n      tasks: [\r\n        {\r\n          id: 'implement-auth-system',\r\n          description: 'Implement user authentication system with JWT tokens',\r\n          requiredCapabilities: ['implement', 'test'],\r\n          expectedDuration: 300000, // 5 minutes\r\n          verificationCriteria: {\r\n            requiresTests: true,\r\n            requiresCodeReview: true,\r\n            requiresBuild: true,\r\n            minTruthScore: 0.8,\r\n            crossVerificationRequired: true\r\n          }\r\n        },\r\n        {\r\n          id: 'optimize-database-queries',\r\n          description: 'Optimize slow database queries and add indexing',\r\n          requiredCapabilities: ['implement', 'benchmark'],\r\n          expectedDuration: 240000, // 4 minutes\r\n          verificationCriteria: {\r\n            requiresTests: true,\r\n            requiresCodeReview: true,\r\n            requiresBuild: false,\r\n            minTruthScore: 0.75,\r\n            crossVerificationRequired: true\r\n          }\r\n        }\r\n      ],\r\n      verificationRules: [\r\n        {\r\n          name: 'truth-score-threshold',\r\n          condition: 'truthScore < 0.7',\r\n          action: 'reject',\r\n          threshold: 0.7\r\n        },\r\n        {\r\n          name: 'cross-verification-conflict',\r\n          condition: 'conflictCount > 0',\r\n          action: 'escalate',\r\n          threshold: 1\r\n        },\r\n        {\r\n          name: 'agent-reliability-warning',\r\n          condition: 'agentReliability < 0.8',\r\n          action: 'warn',\r\n          threshold: 0.8\r\n        }\r\n      ],\r\n      truthThreshold: 0.8,\r\n      timeoutMs: 600000 // 10 minutes\r\n    };\r\n  }\r\n\r\n  describe('Complete Workflow Verification', () => {\r\n    test('should execute full authentication system implementation workflow', async () => {\r\n      const taskId = 'implement-auth-system';\r\n      const task = config.tasks.find(t => t.id === taskId)!;\r\n\r\n      // Start the pipeline\r\n      const resultPromise = pipeline.executeTask(taskId);\r\n\r\n      // Monitor pipeline execution\r\n      const executionSteps: string[] = [];\r\n      pipeline.on('step:start', (step) => {\r\n        executionSteps.push(step.name);\r\n      });\r\n\r\n      pipeline.on('verification:complete', (result) => {\r\n        console.log(`Verification completed: ${result.step} by ${result.agentId}`);\r\n      });\r\n\r\n      // Wait for completion\r\n      const result = await resultPromise;\r\n\r\n      // Verify workflow completed successfully\r\n      expect(result.status).toBe('completed');\r\n      expect(result.truthScore).toBeGreaterThanOrEqual(task.verificationCriteria.minTruthScore);\r\n      expect(result.verificationResults.length).toBeGreaterThan(0);\r\n\r\n      // Verify all required steps were executed\r\n      expect(executionSteps).toContain('implementation');\r\n      expect(executionSteps).toContain('testing');\r\n      expect(executionSteps).toContain('code-review');\r\n      expect(executionSteps).toContain('build-verification');\r\n      expect(executionSteps).toContain('cross-verification');\r\n\r\n      // Verify no conflicts were detected\r\n      const hasConflicts = result.verificationResults.some(r => r.conflicts.length > 0);\r\n      expect(hasConflicts).toBe(false);\r\n\r\n      // Verify duration is within expected range\r\n      expect(result.duration).toBeLessThan(task.expectedDuration * 1.5);\r\n    }, 30000);\r\n\r\n    test('should handle workflow with verification failures', async () => {\r\n      // Create a task that will fail verification\r\n      const failingTaskId = 'failing-implementation';\r\n      const failingTask: TaskConfig = {\r\n        id: failingTaskId,\r\n        description: 'Intentionally failing implementation for testing',\r\n        requiredCapabilities: ['implement'],\r\n        expectedDuration: 60000,\r\n        verificationCriteria: {\r\n          requiresTests: true,\r\n          requiresCodeReview: true,\r\n          requiresBuild: true,\r\n          minTruthScore: 0.9, // Very high threshold\r\n          crossVerificationRequired: true\r\n        }\r\n      };\r\n\r\n      // Add failing task to config\r\n      config.tasks.push(failingTask);\r\n      await pipeline.updateConfig(config);\r\n\r\n      // Inject failure simulation\r\n      pipeline.setFailureSimulation(failingTaskId, {\r\n        implementation: { success: false, reason: 'Syntax errors in code' },\r\n        tests: { success: false, reason: 'Tests fail to run' },\r\n        build: { success: false, reason: 'Build compilation errors' }\r\n      });\r\n\r\n      const result = await pipeline.executeTask(failingTaskId);\r\n\r\n      // Verify failure handling\r\n      expect(result.status).toBe('rejected');\r\n      expect(result.truthScore).toBeLessThan(failingTask.verificationCriteria.minTruthScore);\r\n      expect(result.errors.length).toBeGreaterThan(0);\r\n\r\n      // Verify verification rules were applied\r\n      const rejectionResult = result.verificationResults.find(r => r.step === 'rule-evaluation');\r\n      expect(rejectionResult).toBeDefined();\r\n      expect(rejectionResult!.passed).toBe(false);\r\n    }, 15000);\r\n\r\n    test('should handle timeout scenarios gracefully', async () => {\r\n      const timeoutTaskId = 'timeout-task';\r\n      const timeoutTask: TaskConfig = {\r\n        id: timeoutTaskId,\r\n        description: 'Task that will timeout',\r\n        requiredCapabilities: ['implement'],\r\n        expectedDuration: 30000, // 30 seconds\r\n        verificationCriteria: {\r\n          requiresTests: false,\r\n          requiresCodeReview: false,\r\n          requiresBuild: false,\r\n          minTruthScore: 0.5,\r\n          crossVerificationRequired: false\r\n        }\r\n      };\r\n\r\n      config.tasks.push(timeoutTask);\r\n      config.timeoutMs = 5000; // 5 second timeout for testing\r\n      await pipeline.updateConfig(config);\r\n\r\n      // Inject delay simulation\r\n      pipeline.setDelaySimulation(timeoutTaskId, 10000); // 10 second delay\r\n\r\n      const startTime = Date.now();\r\n      const result = await pipeline.executeTask(timeoutTaskId);\r\n      const duration = Date.now() - startTime;\r\n\r\n      // Verify timeout handling\r\n      expect(result.status).toBe('timeout');\r\n      expect(duration).toBeLessThan(7000); // Should timeout around 5 seconds\r\n      expect(result.errors).toContain('Task execution timed out');\r\n    }, 10000);\r\n  });\r\n\r\n  describe('Multi-Agent Coordination', () => {\r\n    test('should coordinate multiple agents for complex task', async () => {\r\n      const complexTaskId = 'multi-agent-coordination';\r\n      const complexTask: TaskConfig = {\r\n        id: complexTaskId,\r\n        description: 'Complex task requiring multiple agent types',\r\n        requiredCapabilities: ['implement', 'test', 'review', 'orchestrate'],\r\n        expectedDuration: 420000, // 7 minutes\r\n        verificationCriteria: {\r\n          requiresTests: true,\r\n          requiresCodeReview: true,\r\n          requiresBuild: true,\r\n          minTruthScore: 0.85,\r\n          crossVerificationRequired: true\r\n        }\r\n      };\r\n\r\n      config.tasks.push(complexTask);\r\n      await pipeline.updateConfig(config);\r\n\r\n      const agentAssignments: Map<string, string[]> = new Map();\r\n      pipeline.on('agent:assigned', (assignment) => {\r\n        if (!agentAssignments.has(assignment.agentId)) {\r\n          agentAssignments.set(assignment.agentId, []);\r\n        }\r\n        agentAssignments.get(assignment.agentId)!.push(assignment.taskStep);\r\n      });\r\n\r\n      const result = await pipeline.executeTask(complexTaskId);\r\n\r\n      // Verify all agent types were involved\r\n      expect(agentAssignments.size).toBeGreaterThanOrEqual(3);\r\n      expect(Array.from(agentAssignments.keys())).toContain('coder-alpha');\r\n      expect(Array.from(agentAssignments.keys())).toContain('reviewer-beta');\r\n      expect(Array.from(agentAssignments.keys())).toContain('tester-gamma');\r\n\r\n      // Verify coordination was successful\r\n      expect(result.status).toBe('completed');\r\n      expect(result.truthScore).toBeGreaterThanOrEqual(complexTask.verificationCriteria.minTruthScore);\r\n\r\n      // Verify cross-verification occurred\r\n      const crossVerificationResults = result.verificationResults.filter(r => \r\n        r.step === 'cross-verification'\r\n      );\r\n      expect(crossVerificationResults.length).toBeGreaterThan(0);\r\n    }, 45000);\r\n\r\n    test('should detect and handle agent conflicts', async () => {\r\n      const conflictTaskId = 'conflict-resolution-test';\r\n      const conflictTask: TaskConfig = {\r\n        id: conflictTaskId,\r\n        description: 'Task designed to create agent conflicts',\r\n        requiredCapabilities: ['implement', 'review'],\r\n        expectedDuration: 180000,\r\n        verificationCriteria: {\r\n          requiresTests: true,\r\n          requiresCodeReview: true,\r\n          requiresBuild: false,\r\n          minTruthScore: 0.7,\r\n          crossVerificationRequired: true\r\n        }\r\n      };\r\n\r\n      config.tasks.push(conflictTask);\r\n      await pipeline.updateConfig(config);\r\n\r\n      // Inject conflict scenario\r\n      pipeline.setConflictSimulation(conflictTaskId, {\r\n        'coder-alpha': { claimSuccess: true, actualSuccess: true },\r\n        'reviewer-beta': { claimSuccess: false, actualSuccess: true }, // Conflicting assessment\r\n        'tester-gamma': { claimSuccess: true, actualSuccess: true }\r\n      });\r\n\r\n      const result = await pipeline.executeTask(conflictTaskId);\r\n\r\n      // Verify conflict detection\r\n      const conflictResults = result.verificationResults.filter(r => r.conflicts.length > 0);\r\n      expect(conflictResults.length).toBeGreaterThan(0);\r\n\r\n      // Verify conflict resolution was attempted\r\n      const resolutionResults = result.verificationResults.filter(r => \r\n        r.step === 'conflict-resolution'\r\n      );\r\n      expect(resolutionResults.length).toBeGreaterThan(0);\r\n\r\n      // Final result should still be reasonable despite conflicts\r\n      expect(result.status).toBe('completed');\r\n      expect(result.truthScore).toBeGreaterThan(0.5);\r\n    }, 25000);\r\n  });\r\n\r\n  describe('Real-World Scenario Simulation', () => {\r\n    test('should handle database optimization project end-to-end', async () => {\r\n      const dbTaskId = 'optimize-database-queries';\r\n      const task = config.tasks.find(t => t.id === dbTaskId)!;\r\n\r\n      // Simulate realistic implementation scenario\r\n      pipeline.setRealisticSimulation(dbTaskId, {\r\n        implementation: {\r\n          files_changed: 8,\r\n          lines_added: 250,\r\n          lines_removed: 100,\r\n          complexity_score: 0.7,\r\n          duration: 180000 // 3 minutes\r\n        },\r\n        testing: {\r\n          unit_tests_added: 15,\r\n          integration_tests_added: 5,\r\n          test_coverage: 0.85,\r\n          performance_tests: true,\r\n          duration: 90000 // 1.5 minutes\r\n        },\r\n        review: {\r\n          code_quality_score: 0.9,\r\n          security_issues: 0,\r\n          style_violations: 2,\r\n          approved: true,\r\n          duration: 60000 // 1 minute\r\n        },\r\n        verification: {\r\n          performance_improvement: 0.35, // 35% improvement\r\n          memory_usage_reduction: 0.15,\r\n          query_optimization_verified: true\r\n        }\r\n      });\r\n\r\n      const result = await pipeline.executeTask(dbTaskId);\r\n\r\n      // Verify realistic outcomes\r\n      expect(result.status).toBe('completed');\r\n      expect(result.truthScore).toBeGreaterThanOrEqual(0.8);\r\n      expect(result.duration).toBeGreaterThan(300000); // At least 5 minutes\r\n      expect(result.duration).toBeLessThan(400000); // Less than 7 minutes\r\n\r\n      // Verify performance improvements were verified\r\n      const performanceVerification = result.verificationResults.find(r => \r\n        r.evidence?.performance_improvement > 0\r\n      );\r\n      expect(performanceVerification).toBeDefined();\r\n      expect(performanceVerification!.evidence.performance_improvement).toBeGreaterThan(0.3);\r\n\r\n      // Verify all steps completed successfully\r\n      const allStepsPassed = result.verificationResults.every(r => r.passed);\r\n      expect(allStepsPassed).toBe(true);\r\n    }, 30000);\r\n\r\n    test('should simulate microservices architecture verification', async () => {\r\n      const microservicesTaskId = 'implement-microservices';\r\n      const microservicesTask: TaskConfig = {\r\n        id: microservicesTaskId,\r\n        description: 'Implement microservices architecture with service discovery',\r\n        requiredCapabilities: ['implement', 'test', 'review', 'orchestrate'],\r\n        expectedDuration: 600000, // 10 minutes\r\n        verificationCriteria: {\r\n          requiresTests: true,\r\n          requiresCodeReview: true,\r\n          requiresBuild: true,\r\n          minTruthScore: 0.85,\r\n          crossVerificationRequired: true\r\n        }\r\n      };\r\n\r\n      config.tasks.push(microservicesTask);\r\n      await pipeline.updateConfig(config);\r\n\r\n      // Simulate complex microservices scenario\r\n      pipeline.setMicroservicesSimulation(microservicesTaskId, {\r\n        services_implemented: 4,\r\n        api_endpoints: 24,\r\n        service_discovery_working: true,\r\n        load_balancing_configured: true,\r\n        circuit_breakers_implemented: true,\r\n        monitoring_setup: true,\r\n        distributed_tracing: true,\r\n        containerization: true\r\n      });\r\n\r\n      const result = await pipeline.executeTask(microservicesTaskId);\r\n\r\n      // Verify complex architecture verification\r\n      expect(result.status).toBe('completed');\r\n      expect(result.verificationResults.length).toBeGreaterThan(10);\r\n\r\n      // Verify service integration tests passed\r\n      const integrationTest = result.verificationResults.find(r => \r\n        r.step === 'service-integration-test'\r\n      );\r\n      expect(integrationTest).toBeDefined();\r\n      expect(integrationTest!.passed).toBe(true);\r\n\r\n      // Verify load testing was performed\r\n      const loadTest = result.verificationResults.find(r => \r\n        r.step === 'load-testing'\r\n      );\r\n      expect(loadTest).toBeDefined();\r\n      expect(loadTest!.evidence?.requests_per_second).toBeGreaterThan(100);\r\n\r\n      // Verify security scanning was performed\r\n      const securityScan = result.verificationResults.find(r => \r\n        r.step === 'security-scan'\r\n      );\r\n      expect(securityScan).toBeDefined();\r\n      expect(securityScan!.evidence?.vulnerabilities_found).toBeLessThan(5);\r\n    }, 60000);\r\n  });\r\n\r\n  describe('Error Handling and Recovery', () => {\r\n    test('should recover from agent failures', async () => {\r\n      const recoveryTaskId = 'agent-failure-recovery';\r\n      const recoveryTask: TaskConfig = {\r\n        id: recoveryTaskId,\r\n        description: 'Task to test agent failure recovery',\r\n        requiredCapabilities: ['implement', 'test'],\r\n        expectedDuration: 120000,\r\n        verificationCriteria: {\r\n          requiresTests: true,\r\n          requiresCodeReview: false,\r\n          requiresBuild: false,\r\n          minTruthScore: 0.7,\r\n          crossVerificationRequired: false\r\n        }\r\n      };\r\n\r\n      config.tasks.push(recoveryTask);\r\n      await pipeline.updateConfig(config);\r\n\r\n      // Simulate agent failure and recovery\r\n      pipeline.setAgentFailureSimulation('coder-alpha', {\r\n        failAfter: 30000, // Fail after 30 seconds\r\n        failureDuration: 15000, // Down for 15 seconds\r\n        backupAgent: 'coder-beta' // Not in original config, should be created\r\n      });\r\n\r\n      const result = await pipeline.executeTask(recoveryTaskId);\r\n\r\n      // Verify recovery was successful\r\n      expect(result.status).toBe('completed');\r\n      expect(result.errors.some(e => e.includes('Agent failure detected'))).toBe(true);\r\n      expect(result.errors.some(e => e.includes('Backup agent deployed'))).toBe(true);\r\n\r\n      // Verify task still completed within reasonable time\r\n      expect(result.duration).toBeLessThan(180000); // 3 minutes max\r\n    }, 20000);\r\n\r\n    test('should handle verification system failures', async () => {\r\n      const systemFailureTaskId = 'verification-system-failure';\r\n      const systemFailureTask: TaskConfig = {\r\n        id: systemFailureTaskId,\r\n        description: 'Task to test verification system failure handling',\r\n        requiredCapabilities: ['implement'],\r\n        expectedDuration: 60000,\r\n        verificationCriteria: {\r\n          requiresTests: true,\r\n          requiresCodeReview: true,\r\n          requiresBuild: false,\r\n          minTruthScore: 0.8,\r\n          crossVerificationRequired: false\r\n        }\r\n      };\r\n\r\n      config.tasks.push(systemFailureTask);\r\n      await pipeline.updateConfig(config);\r\n\r\n      // Simulate verification system failure\r\n      pipeline.setVerificationFailureSimulation({\r\n        failureProbability: 0.3, // 30% chance of failure per verification\r\n        recoveryTime: 5000, // 5 second recovery\r\n        fallbackMode: 'basic' // Use basic verification when system fails\r\n      });\r\n\r\n      const result = await pipeline.executeTask(systemFailureTaskId);\r\n\r\n      // Verify task completed despite verification failures\r\n      expect(['completed', 'rejected']).toContain(result.status);\r\n      \r\n      if (result.status === 'completed') {\r\n        // If completed, should have some verification results\r\n        expect(result.verificationResults.length).toBeGreaterThan(0);\r\n      }\r\n\r\n      // Should have recorded system failure recovery\r\n      const hasRecoveryLog = result.verificationResults.some(r => \r\n        r.step === 'system-recovery'\r\n      );\r\n      expect(hasRecoveryLog).toBe(true);\r\n    }, 15000);\r\n  });\r\n\r\n  describe('Performance and Scalability', () => {\r\n    test('should handle concurrent task execution', async () => {\r\n      const concurrentTasks = [\r\n        'concurrent-task-1',\r\n        'concurrent-task-2', \r\n        'concurrent-task-3'\r\n      ].map(id => ({\r\n        id,\r\n        description: `Concurrent task ${id}`,\r\n        requiredCapabilities: ['implement'],\r\n        expectedDuration: 60000,\r\n        verificationCriteria: {\r\n          requiresTests: false,\r\n          requiresCodeReview: false,\r\n          requiresBuild: false,\r\n          minTruthScore: 0.6,\r\n          crossVerificationRequired: false\r\n        }\r\n      }));\r\n\r\n      // Add concurrent tasks to config\r\n      config.tasks.push(...concurrentTasks);\r\n      await pipeline.updateConfig(config);\r\n\r\n      // Execute tasks concurrently\r\n      const startTime = Date.now();\r\n      const resultPromises = concurrentTasks.map(task => \r\n        pipeline.executeTask(task.id)\r\n      );\r\n\r\n      const results = await Promise.all(resultPromises);\r\n      const totalDuration = Date.now() - startTime;\r\n\r\n      // Verify all tasks completed\r\n      expect(results.every(r => r.status === 'completed')).toBe(true);\r\n\r\n      // Verify concurrent execution was efficient (not sequential)\r\n      const sequentialDuration = concurrentTasks.length * 60000;\r\n      expect(totalDuration).toBeLessThan(sequentialDuration * 0.7);\r\n\r\n      // Verify no resource conflicts occurred\r\n      const hasResourceConflicts = results.some(r => \r\n        r.errors.some(e => e.includes('resource conflict'))\r\n      );\r\n      expect(hasResourceConflicts).toBe(false);\r\n    }, 30000);\r\n\r\n    test('should maintain performance under load', async () => {\r\n      // Create many small tasks\r\n      const loadTasks = Array.from({ length: 20 }, (_, i) => ({\r\n        id: `load-task-${i}`,\r\n        description: `Load test task ${i}`,\r\n        requiredCapabilities: ['implement'],\r\n        expectedDuration: 10000, // 10 seconds each\r\n        verificationCriteria: {\r\n          requiresTests: false,\r\n          requiresCodeReview: false,\r\n          requiresBuild: false,\r\n          minTruthScore: 0.5,\r\n          crossVerificationRequired: false\r\n        }\r\n      }));\r\n\r\n      config.tasks.push(...loadTasks);\r\n      await pipeline.updateConfig(config);\r\n\r\n      // Monitor performance metrics during load test\r\n      const performanceMetrics = await pipeline.startPerformanceMonitoring();\r\n\r\n      const startTime = Date.now();\r\n      \r\n      // Execute in batches to simulate realistic load\r\n      const batchSize = 5;\r\n      const batches = [];\r\n      for (let i = 0; i < loadTasks.length; i += batchSize) {\r\n        const batch = loadTasks.slice(i, i + batchSize);\r\n        batches.push(\r\n          Promise.all(batch.map(task => pipeline.executeTask(task.id)))\r\n        );\r\n      }\r\n\r\n      const allResults = await Promise.all(batches);\r\n      const flatResults = allResults.flat();\r\n      const totalDuration = Date.now() - startTime;\r\n\r\n      await pipeline.stopPerformanceMonitoring();\r\n\r\n      // Verify load handling\r\n      expect(flatResults.every(r => r.status === 'completed')).toBe(true);\r\n      expect(totalDuration).toBeLessThan(120000); // Should complete within 2 minutes\r\n\r\n      // Verify performance didn't degrade significantly\r\n      expect(performanceMetrics.averageResponseTime).toBeLessThan(15000);\r\n      expect(performanceMetrics.memoryUsage.peak).toBeLessThan(500 * 1024 * 1024); // 500MB\r\n      expect(performanceMetrics.errorRate).toBeLessThan(0.05); // Less than 5% errors\r\n    }, 60000);\r\n  });\r\n});\r\n\r\n// Mock Verification Pipeline Implementation\r\nclass VerificationPipeline extends EventEmitter {\r\n  private config: PipelineConfig;\r\n  private dataPath: string;\r\n  private agents: Map<string, any> = new Map();\r\n  private activeRequests: Set<string> = new Set();\r\n  private simulationConfig: any = {};\r\n  private performanceMonitor: any = null;\r\n\r\n  constructor(config: PipelineConfig, dataPath: string) {\r\n    super();\r\n    this.config = config;\r\n    this.dataPath = dataPath;\r\n  }\r\n\r\n  async initialize() {\r\n    // Initialize agents\r\n    for (const agentConfig of this.config.agents) {\r\n      const agent = new MockPipelineAgent(agentConfig);\r\n      this.agents.set(agentConfig.id, agent);\r\n    }\r\n\r\n    // Setup verification system\r\n    await fs.mkdir(path.join(this.dataPath, 'verification'), { recursive: true });\r\n    await fs.mkdir(path.join(this.dataPath, 'results'), { recursive: true });\r\n  }\r\n\r\n  async updateConfig(newConfig: PipelineConfig) {\r\n    this.config = newConfig;\r\n    // Re-initialize with new config\r\n    await this.initialize();\r\n  }\r\n\r\n  async executeTask(taskId: string): Promise<PipelineResult> {\r\n    const task = this.config.tasks.find(t => t.id === taskId);\r\n    if (!task) {\r\n      throw new Error(`Task not found: ${taskId}`);\r\n    }\r\n\r\n    this.activeRequests.add(taskId);\r\n    const startTime = Date.now();\r\n\r\n    try {\r\n      const result: PipelineResult = {\r\n        taskId,\r\n        status: 'completed',\r\n        truthScore: 0,\r\n        verificationResults: [],\r\n        duration: 0,\r\n        agentPerformance: new Map(),\r\n        errors: []\r\n      };\r\n\r\n      // Execute task steps based on simulation config\r\n      if (this.simulationConfig[taskId]) {\r\n        await this.executeSimulatedTask(taskId, task, result);\r\n      } else {\r\n        await this.executeStandardTask(taskId, task, result);\r\n      }\r\n\r\n      result.duration = Date.now() - startTime;\r\n      result.truthScore = this.calculateOverallTruthScore(result.verificationResults);\r\n\r\n      // Apply verification rules\r\n      await this.applyVerificationRules(result);\r\n\r\n      return result;\r\n\r\n    } catch (error) {\r\n      return {\r\n        taskId,\r\n        status: 'failed',\r\n        truthScore: 0,\r\n        verificationResults: [],\r\n        duration: Date.now() - startTime,\r\n        agentPerformance: new Map(),\r\n        errors: [error.message]\r\n      };\r\n    } finally {\r\n      this.activeRequests.delete(taskId);\r\n    }\r\n  }\r\n\r\n  private async executeStandardTask(taskId: string, task: TaskConfig, result: PipelineResult) {\r\n    // Implementation step\r\n    this.emit('step:start', { name: 'implementation', taskId });\r\n    const implementationResult = await this.simulateStep('implementation', 'coder-alpha', task);\r\n    result.verificationResults.push(implementationResult);\r\n\r\n    // Testing step\r\n    if (task.verificationCriteria.requiresTests) {\r\n      this.emit('step:start', { name: 'testing', taskId });\r\n      const testingResult = await this.simulateStep('testing', 'tester-gamma', task);\r\n      result.verificationResults.push(testingResult);\r\n    }\r\n\r\n    // Code review step\r\n    if (task.verificationCriteria.requiresCodeReview) {\r\n      this.emit('step:start', { name: 'code-review', taskId });\r\n      const reviewResult = await this.simulateStep('code-review', 'reviewer-beta', task);\r\n      result.verificationResults.push(reviewResult);\r\n    }\r\n\r\n    // Build verification\r\n    if (task.verificationCriteria.requiresBuild) {\r\n      this.emit('step:start', { name: 'build-verification', taskId });\r\n      const buildResult = await this.simulateStep('build-verification', 'coordinator-delta', task);\r\n      result.verificationResults.push(buildResult);\r\n    }\r\n\r\n    // Cross verification\r\n    if (task.verificationCriteria.crossVerificationRequired) {\r\n      this.emit('step:start', { name: 'cross-verification', taskId });\r\n      const crossResult = await this.simulateCrossVerification(task);\r\n      result.verificationResults.push(crossResult);\r\n    }\r\n  }\r\n\r\n  private async executeSimulatedTask(taskId: string, task: TaskConfig, result: PipelineResult) {\r\n    const simulation = this.simulationConfig[taskId];\r\n\r\n    // Handle various simulation types\r\n    if (simulation.delay) {\r\n      await new Promise(resolve => setTimeout(resolve, simulation.delay));\r\n    }\r\n\r\n    if (simulation.failure) {\r\n      Object.keys(simulation.failure).forEach(step => {\r\n        const stepResult = this.createFailureResult(step, simulation.failure[step]);\r\n        result.verificationResults.push(stepResult);\r\n      });\r\n      result.status = 'rejected';\r\n      return;\r\n    }\r\n\r\n    if (simulation.realistic) {\r\n      await this.executeRealisticSimulation(taskId, task, result, simulation.realistic);\r\n    }\r\n\r\n    if (simulation.microservices) {\r\n      await this.executeMicroservicesSimulation(taskId, task, result, simulation.microservices);\r\n    }\r\n  }\r\n\r\n  private async simulateStep(step: string, agentId: string, task: TaskConfig): Promise<VerificationStepResult> {\r\n    // Simulate processing time\r\n    await new Promise(resolve => setTimeout(resolve, Math.random() * 1000 + 500));\r\n\r\n    const agent = this.agents.get(agentId);\r\n    const truthScore = Math.random() * 0.3 + 0.7; // 0.7 to 1.0\r\n\r\n    this.emit('agent:assigned', { agentId, taskStep: step });\r\n\r\n    return {\r\n      step,\r\n      agentId,\r\n      passed: truthScore >= 0.7,\r\n      truthScore,\r\n      evidence: {\r\n        execution_time: Math.random() * 2000 + 1000,\r\n        quality_score: truthScore,\r\n        [step + '_specific_metric']: Math.random() * 100\r\n      },\r\n      conflicts: [],\r\n      timestamp: Date.now()\r\n    };\r\n  }\r\n\r\n  private async simulateCrossVerification(task: TaskConfig): Promise<VerificationStepResult> {\r\n    // Multiple agents verify the same claim\r\n    const verifiers = ['reviewer-beta', 'tester-gamma'];\r\n    const scores = verifiers.map(() => Math.random() * 0.4 + 0.6);\r\n    \r\n    const avgScore = scores.reduce((a, b) => a + b, 0) / scores.length;\r\n    const conflicts = Math.abs(scores[0] - scores[1]) > 0.3 ? ['Verification disagreement detected'] : [];\r\n\r\n    this.emit('verification:complete', { step: 'cross-verification', conflicts });\r\n\r\n    return {\r\n      step: 'cross-verification',\r\n      agentId: 'verification-system',\r\n      passed: conflicts.length === 0,\r\n      truthScore: avgScore,\r\n      evidence: {\r\n        verifier_scores: scores,\r\n        consensus_reached: conflicts.length === 0\r\n      },\r\n      conflicts,\r\n      timestamp: Date.now()\r\n    };\r\n  }\r\n\r\n  private calculateOverallTruthScore(results: VerificationStepResult[]): number {\r\n    if (results.length === 0) return 0;\r\n    return results.reduce((sum, r) => sum + r.truthScore, 0) / results.length;\r\n  }\r\n\r\n  private async applyVerificationRules(result: PipelineResult) {\r\n    for (const rule of this.config.verificationRules) {\r\n      const ruleResult = this.evaluateRule(rule, result);\r\n      \r\n      if (ruleResult.triggered) {\r\n        switch (rule.action) {\r\n          case 'reject':\r\n            result.status = 'rejected';\r\n            result.errors.push(`Rule violation: ${rule.name}`);\r\n            break;\r\n          case 'warn':\r\n            result.errors.push(`Warning: ${rule.name}`);\r\n            break;\r\n          case 'escalate':\r\n            result.errors.push(`Escalated: ${rule.name}`);\r\n            break;\r\n        }\r\n\r\n        result.verificationResults.push({\r\n          step: 'rule-evaluation',\r\n          agentId: 'verification-system',\r\n          passed: rule.action !== 'reject',\r\n          truthScore: rule.action === 'reject' ? 0 : 0.5,\r\n          evidence: { rule: rule.name, action: rule.action },\r\n          conflicts: [],\r\n          timestamp: Date.now()\r\n        });\r\n      }\r\n    }\r\n  }\r\n\r\n  private evaluateRule(rule: VerificationRule, result: PipelineResult): { triggered: boolean } {\r\n    switch (rule.name) {\r\n      case 'truth-score-threshold':\r\n        return { triggered: result.truthScore < rule.threshold };\r\n      case 'cross-verification-conflict':\r\n        const conflictCount = result.verificationResults.reduce((sum, r) => sum + r.conflicts.length, 0);\r\n        return { triggered: conflictCount > rule.threshold };\r\n      case 'agent-reliability-warning':\r\n        // Simplified agent reliability check\r\n        return { triggered: Math.random() < 0.1 }; // 10% chance for testing\r\n      default:\r\n        return { triggered: false };\r\n    }\r\n  }\r\n\r\n  // Simulation configuration methods\r\n  setFailureSimulation(taskId: string, failures: any) {\r\n    this.simulationConfig[taskId] = { failure: failures };\r\n  }\r\n\r\n  setDelaySimulation(taskId: string, delay: number) {\r\n    this.simulationConfig[taskId] = { delay };\r\n  }\r\n\r\n  setConflictSimulation(taskId: string, conflicts: any) {\r\n    this.simulationConfig[taskId] = { conflicts };\r\n  }\r\n\r\n  setRealisticSimulation(taskId: string, config: any) {\r\n    this.simulationConfig[taskId] = { realistic: config };\r\n  }\r\n\r\n  setMicroservicesSimulation(taskId: string, config: any) {\r\n    this.simulationConfig[taskId] = { microservices: config };\r\n  }\r\n\r\n  setAgentFailureSimulation(agentId: string, config: any) {\r\n    // Agent failure simulation logic\r\n  }\r\n\r\n  setVerificationFailureSimulation(config: any) {\r\n    // Verification system failure simulation\r\n  }\r\n\r\n  private async executeRealisticSimulation(taskId: string, task: TaskConfig, result: PipelineResult, config: any) {\r\n    // Simulate realistic implementation scenario\r\n    const implementationResult: VerificationStepResult = {\r\n      step: 'implementation',\r\n      agentId: 'coder-alpha',\r\n      passed: true,\r\n      truthScore: 0.9,\r\n      evidence: config.implementation,\r\n      conflicts: [],\r\n      timestamp: Date.now()\r\n    };\r\n    result.verificationResults.push(implementationResult);\r\n\r\n    await new Promise(resolve => setTimeout(resolve, config.implementation.duration / 10)); // Sped up for testing\r\n\r\n    if (config.testing) {\r\n      const testingResult: VerificationStepResult = {\r\n        step: 'testing',\r\n        agentId: 'tester-gamma',\r\n        passed: config.testing.test_coverage > 0.8,\r\n        truthScore: config.testing.test_coverage,\r\n        evidence: config.testing,\r\n        conflicts: [],\r\n        timestamp: Date.now()\r\n      };\r\n      result.verificationResults.push(testingResult);\r\n    }\r\n\r\n    if (config.verification) {\r\n      const verificationResult: VerificationStepResult = {\r\n        step: 'performance-verification',\r\n        agentId: 'reviewer-beta',\r\n        passed: config.verification.performance_improvement > 0.2,\r\n        truthScore: 0.9,\r\n        evidence: config.verification,\r\n        conflicts: [],\r\n        timestamp: Date.now()\r\n      };\r\n      result.verificationResults.push(verificationResult);\r\n    }\r\n  }\r\n\r\n  private async executeMicroservicesSimulation(taskId: string, task: TaskConfig, result: PipelineResult, config: any) {\r\n    // Service integration test\r\n    const integrationResult: VerificationStepResult = {\r\n      step: 'service-integration-test',\r\n      agentId: 'tester-gamma',\r\n      passed: config.service_discovery_working && config.load_balancing_configured,\r\n      truthScore: 0.9,\r\n      evidence: {\r\n        services_tested: config.services_implemented,\r\n        endpoints_validated: config.api_endpoints\r\n      },\r\n      conflicts: [],\r\n      timestamp: Date.now()\r\n    };\r\n    result.verificationResults.push(integrationResult);\r\n\r\n    // Load testing\r\n    const loadTestResult: VerificationStepResult = {\r\n      step: 'load-testing',\r\n      agentId: 'tester-gamma',\r\n      passed: true,\r\n      truthScore: 0.85,\r\n      evidence: {\r\n        requests_per_second: 250,\r\n        average_response_time: 120,\r\n        error_rate: 0.02\r\n      },\r\n      conflicts: [],\r\n      timestamp: Date.now()\r\n    };\r\n    result.verificationResults.push(loadTestResult);\r\n\r\n    // Security scan\r\n    const securityResult: VerificationStepResult = {\r\n      step: 'security-scan',\r\n      agentId: 'reviewer-beta',\r\n      passed: true,\r\n      truthScore: 0.95,\r\n      evidence: {\r\n        vulnerabilities_found: 2,\r\n        severity_levels: { high: 0, medium: 1, low: 1 }\r\n      },\r\n      conflicts: [],\r\n      timestamp: Date.now()\r\n    };\r\n    result.verificationResults.push(securityResult);\r\n  }\r\n\r\n  private createFailureResult(step: string, failure: any): VerificationStepResult {\r\n    return {\r\n      step,\r\n      agentId: 'failed-agent',\r\n      passed: false,\r\n      truthScore: 0.1,\r\n      evidence: { failure_reason: failure.reason },\r\n      conflicts: ['Execution failed'],\r\n      timestamp: Date.now()\r\n    };\r\n  }\r\n\r\n  async startPerformanceMonitoring() {\r\n    this.performanceMonitor = {\r\n      startTime: Date.now(),\r\n      requestCount: 0,\r\n      responseTimeSum: 0,\r\n      memoryUsage: { initial: process.memoryUsage().heapUsed, peak: 0 },\r\n      errorCount: 0\r\n    };\r\n\r\n    return {\r\n      averageResponseTime: 0,\r\n      memoryUsage: this.performanceMonitor.memoryUsage,\r\n      errorRate: 0\r\n    };\r\n  }\r\n\r\n  async stopPerformanceMonitoring() {\r\n    if (!this.performanceMonitor) return {};\r\n\r\n    const duration = Date.now() - this.performanceMonitor.startTime;\r\n    const currentMemory = process.memoryUsage().heapUsed;\r\n    \r\n    return {\r\n      averageResponseTime: this.performanceMonitor.responseTimeSum / Math.max(1, this.performanceMonitor.requestCount),\r\n      memoryUsage: {\r\n        initial: this.performanceMonitor.memoryUsage.initial,\r\n        peak: Math.max(this.performanceMonitor.memoryUsage.peak, currentMemory),\r\n        final: currentMemory\r\n      },\r\n      errorRate: this.performanceMonitor.errorCount / Math.max(1, this.performanceMonitor.requestCount),\r\n      totalDuration: duration\r\n    };\r\n  }\r\n\r\n  async shutdown() {\r\n    this.removeAllListeners();\r\n    this.agents.clear();\r\n    this.activeRequests.clear();\r\n  }\r\n}\r\n\r\nclass MockPipelineAgent {\r\n  public id: string;\r\n  public type: string;\r\n  public capabilities: string[];\r\n  public reliability: number;\r\n\r\n  constructor(config: AgentConfig) {\r\n    this.id = config.id;\r\n    this.type = config.type;\r\n    this.capabilities = config.capabilities;\r\n    this.reliability = config.reliability;\r\n  }\r\n}"],"names":["fs","path","os","EventEmitter","describe","tempDir","pipeline","config","beforeEach","mkdtemp","join","tmpdir","createTestPipelineConfig","VerificationPipeline","initialize","afterEach","shutdown","rm","recursive","force","agents","id","type","capabilities","reliability","verificationEnabled","tasks","description","requiredCapabilities","expectedDuration","verificationCriteria","requiresTests","requiresCodeReview","requiresBuild","minTruthScore","crossVerificationRequired","verificationRules","name","condition","action","threshold","truthThreshold","timeoutMs","test","taskId","task","find","t","resultPromise","executeTask","executionSteps","on","step","push","result","console","log","agentId","expect","status","toBe","truthScore","toBeGreaterThanOrEqual","verificationResults","length","toBeGreaterThan","toContain","hasConflicts","some","r","conflicts","duration","toBeLessThan","failingTaskId","failingTask","updateConfig","setFailureSimulation","implementation","success","reason","tests","build","errors","rejectionResult","toBeDefined","passed","timeoutTaskId","timeoutTask","setDelaySimulation","startTime","Date","now","complexTaskId","complexTask","agentAssignments","Map","assignment","has","set","get","taskStep","size","Array","from","keys","crossVerificationResults","filter","conflictTaskId","conflictTask","setConflictSimulation","claimSuccess","actualSuccess","conflictResults","resolutionResults","dbTaskId","setRealisticSimulation","files_changed","lines_added","lines_removed","complexity_score","testing","unit_tests_added","integration_tests_added","test_coverage","performance_tests","review","code_quality_score","security_issues","style_violations","approved","verification","performance_improvement","memory_usage_reduction","query_optimization_verified","performanceVerification","evidence","allStepsPassed","every","microservicesTaskId","microservicesTask","setMicroservicesSimulation","services_implemented","api_endpoints","service_discovery_working","load_balancing_configured","circuit_breakers_implemented","monitoring_setup","distributed_tracing","containerization","integrationTest","loadTest","requests_per_second","securityScan","vulnerabilities_found","recoveryTaskId","recoveryTask","setAgentFailureSimulation","failAfter","failureDuration","backupAgent","e","includes","systemFailureTaskId","systemFailureTask","setVerificationFailureSimulation","failureProbability","recoveryTime","fallbackMode","hasRecoveryLog","concurrentTasks","map","resultPromises","results","Promise","all","totalDuration","sequentialDuration","hasResourceConflicts","loadTasks","_","i","performanceMetrics","startPerformanceMonitoring","batchSize","batches","batch","slice","allResults","flatResults","flat","stopPerformanceMonitoring","averageResponseTime","memoryUsage","peak","errorRate","dataPath","activeRequests","Set","simulationConfig","performanceMonitor","agentConfig","agent","MockPipelineAgent","mkdir","newConfig","Error","add","agentPerformance","executeSimulatedTask","executeStandardTask","calculateOverallTruthScore","applyVerificationRules","error","message","delete","emit","implementationResult","simulateStep","testingResult","reviewResult","buildResult","crossResult","simulateCrossVerification","simulation","delay","resolve","setTimeout","failure","Object","forEach","stepResult","createFailureResult","realistic","executeRealisticSimulation","microservices","executeMicroservicesSimulation","Math","random","execution_time","quality_score","timestamp","verifiers","scores","avgScore","reduce","a","b","abs","verifier_scores","consensus_reached","sum","rule","ruleResult","evaluateRule","triggered","conflictCount","failures","verificationResult","integrationResult","services_tested","endpoints_validated","loadTestResult","average_response_time","error_rate","securityResult","severity_levels","high","medium","low","failure_reason","requestCount","responseTimeSum","initial","process","heapUsed","errorCount","currentMemory","max","final","removeAllListeners","clear"],"mappings":"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"}