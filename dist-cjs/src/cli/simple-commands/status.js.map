{"version":3,"sources":["../../../../src/cli/simple-commands/status.js"],"sourcesContent":["// status.js - System status and monitoring commands\r\nimport { printSuccess, printError, printWarning } from '../utils.js';\r\nimport { promises as fs } from 'fs';\r\n// Removed Deno import from '../node-compat.js';\r\nimport { MetricsReader } from '../../utils/metrics-reader.js';\r\n\r\nexport async function statusCommand(subArgs, flags) {\r\n  const verbose = subArgs.includes('--verbose') || subArgs.includes('-v') || flags.verbose;\r\n  const json = subArgs.includes('--json') || flags.json;\r\n\r\n  const status = await getSystemStatus(verbose);\r\n\r\n  if (json) {\r\n    console.log(JSON.stringify(status, null, 2));\r\n  } else {\r\n    displayStatus(status, verbose);\r\n  }\r\n}\r\n\r\nasync function getSystemStatus(verbose = false) {\r\n  const reader = new MetricsReader();\r\n  \r\n  // Get real metrics from files\r\n  const [systemMetrics, perfMetrics, agents, recentTasks, overallHealth, mcpStatus, taskQueue] = await Promise.all([\r\n    reader.getSystemMetrics(),\r\n    reader.getPerformanceMetrics(),\r\n    reader.getActiveAgents(),\r\n    reader.getRecentTasks(5),\r\n    reader.getOverallHealth(),\r\n    reader.getMCPServerStatus(),\r\n    reader.getTaskQueue()\r\n  ]);\r\n  \r\n  // Count active agents\r\n  const activeAgentCount = agents.filter(a => a.status === 'active' || a.status === 'busy').length;\r\n  \r\n  // Build status object with real data\r\n  const status = {\r\n    timestamp: Date.now(),\r\n    version: '2.7.0',\r\n    orchestrator: {\r\n      running: perfMetrics && perfMetrics.totalTasks > 0,\r\n      uptime: systemMetrics ? systemMetrics.uptime : 0,\r\n      status: perfMetrics && perfMetrics.totalTasks > 0 ? 'Running' : 'Not Running',\r\n    },\r\n    agents: {\r\n      active: activeAgentCount,\r\n      total: agents.length,\r\n      types: agents.reduce((acc, agent) => {\r\n        acc[agent.type] = (acc[agent.type] || 0) + 1;\r\n        return acc;\r\n      }, {}),\r\n    },\r\n    tasks: {\r\n      queued: taskQueue.filter(t => t.status === 'queued').length,\r\n      running: taskQueue.filter(t => t.status === 'running').length + agents.filter(a => a.status === 'busy').length,\r\n      completed: perfMetrics ? perfMetrics.successfulTasks : 0,\r\n      failed: perfMetrics ? perfMetrics.failedTasks : 0,\r\n    },\r\n    memory: {\r\n      status: systemMetrics && systemMetrics.memoryUsagePercent < 80 ? 'Ready' : 'Warning',\r\n      entries: await getMemoryStats(),\r\n      size: systemMetrics ? `${(systemMetrics.memoryUsed / (1024 * 1024)).toFixed(2)} MB` : '0 KB',\r\n    },\r\n    terminal: {\r\n      status: 'Ready',\r\n      poolSize: 10,\r\n      active: perfMetrics ? perfMetrics.activeAgents : 0,\r\n    },\r\n    mcp: {\r\n      status: mcpStatus && mcpStatus.running ? 'Running' : 'Stopped',\r\n      port: mcpStatus ? mcpStatus.port : null,\r\n      connections: mcpStatus ? mcpStatus.connections : 0,\r\n    },\r\n    resources: verbose ? await getResourceUsage() : null,\r\n  };\r\n\r\n  return status;\r\n}\r\n\r\nasync function getMemoryStats() {\r\n  try {\r\n    const memoryStore = './memory/memory-store.json';\r\n    const content = await fs.readFile(memoryStore, 'utf8');\r\n    const data = JSON.parse(content);\r\n\r\n    let totalEntries = 0;\r\n    for (const entries of Object.values(data)) {\r\n      totalEntries += entries.length;\r\n    }\r\n\r\n    return totalEntries;\r\n  } catch {\r\n    return 0;\r\n  }\r\n}\r\n\r\nasync function getResourceUsage() {\r\n  // Get system resource information\r\n  try {\r\n    // Dynamic import for cross-platform compatibility\r\n    let os;\r\n    try {\r\n      os = await import('node:os');\r\n    } catch {\r\n      try {\r\n        os = await import('os');\r\n      } catch {\r\n        // Fallback for environments without os module\r\n        return {\r\n          memory: { usage: 'N/A (os module unavailable)' },\r\n          cpu: { cores: 'Unknown', load: 'Unknown' },\r\n          platform: { type: 'Unknown', error: 'os module not available' },\r\n        };\r\n      }\r\n    }\r\n\r\n    // Node.js doesn't have systemMemoryInfo, use os module instead\r\n    const totalMem = os.totalmem();\r\n    const freeMem = os.freemem();\r\n    const memInfo = {\r\n      total: totalMem,\r\n      free: freeMem,\r\n      available: freeMem,\r\n      buffers: 0,\r\n      cached: 0,\r\n      swapTotal: 0,\r\n      swapFree: 0,\r\n    };\r\n\r\n    // Get CPU info\r\n    let cpuCores = os.cpus().length;\r\n    let loadAvg = 'N/A';\r\n\r\n    try {\r\n      const loadAvgData = os.loadavg();\r\n      loadAvg = `${loadAvgData[0].toFixed(2)}, ${loadAvgData[1].toFixed(2)}, ${loadAvgData[2].toFixed(2)}`;\r\n    } catch (e) {\r\n      // Load average not available on all platforms\r\n    }\r\n\r\n    return {\r\n      memory: {\r\n        total: formatBytes(memInfo.total),\r\n        free: formatBytes(memInfo.free),\r\n        available: formatBytes(memInfo.available),\r\n        usage: `${Math.round(((memInfo.total - memInfo.available) / memInfo.total) * 100)}%`,\r\n      },\r\n      cpu: {\r\n        cores: cpuCores,\r\n        load: loadAvg,\r\n        model: os.cpus()[0]?.model || 'Unknown',\r\n      },\r\n      platform: {\r\n        type: os.type(),\r\n        release: os.release(),\r\n        arch: os.arch(),\r\n        uptime: formatUptime(os.uptime() * 1000),\r\n      },\r\n    };\r\n  } catch (error) {\r\n    return {\r\n      memory: { usage: 'Unknown' },\r\n      cpu: { cores: 'Unknown', load: 'Unknown' },\r\n      platform: { type: 'Unknown', error: error.message },\r\n    };\r\n  }\r\n}\r\n\r\nfunction displayStatus(status, verbose) {\r\n  printSuccess('Claude-Flow System Status:');\r\n\r\n  // Overall status\r\n  const overallStatus = status.orchestrator.running ? 'ðŸŸ¢ Running' : 'ðŸŸ¡ Not Running';\r\n  console.log(\r\n    `${overallStatus} (orchestrator ${status.orchestrator.running ? 'active' : 'not started'})`,\r\n  );\r\n\r\n  // Core components\r\n  console.log(`ðŸ¤– Agents: ${status.agents.active} active`);\r\n  console.log(`ðŸ“‹ Tasks: ${status.tasks.queued} in queue`);\r\n  console.log(`ðŸ’¾ Memory: ${status.memory.status} (${status.memory.entries} entries)`);\r\n  console.log(`ðŸ–¥ï¸  Terminal Pool: ${status.terminal.status}`);\r\n  console.log(`ðŸŒ MCP Server: ${status.mcp.status}`);\r\n\r\n  if (verbose) {\r\n    console.log('\\nðŸ“Š Detailed Information:');\r\n\r\n    // Orchestrator details\r\n    console.log('\\nðŸŽ­ Orchestrator:');\r\n    console.log(`   Status: ${status.orchestrator.status}`);\r\n    console.log(`   Uptime: ${formatUptime(status.orchestrator.uptime)}`);\r\n\r\n    // Agent details\r\n    console.log('\\nðŸ¤– Agent Details:');\r\n    console.log(`   Total Registered: ${status.agents.total}`);\r\n    console.log(`   Currently Active: ${status.agents.active}`);\r\n    if (Object.keys(status.agents.types).length > 0) {\r\n      console.log('   Types:');\r\n      for (const [type, count] of Object.entries(status.agents.types)) {\r\n        console.log(`     ${type}: ${count}`);\r\n      }\r\n    } else {\r\n      console.log('   No agents currently registered');\r\n    }\r\n\r\n    // Task details\r\n    console.log('\\nðŸ“‹ Task Queue:');\r\n    console.log(`   Queued: ${status.tasks.queued}`);\r\n    console.log(`   Running: ${status.tasks.running}`);\r\n    console.log(`   Completed: ${status.tasks.completed}`);\r\n    console.log(`   Failed: ${status.tasks.failed}`);\r\n\r\n    // Memory details\r\n    console.log('\\nðŸ’¾ Memory System:');\r\n    console.log(`   Total Entries: ${status.memory.entries}`);\r\n    console.log(`   Database Size: ${status.memory.size}`);\r\n    console.log(`   Status: ${status.memory.status}`);\r\n\r\n    // Terminal details\r\n    console.log('\\nðŸ–¥ï¸  Terminal Pool:');\r\n    console.log(`   Pool Size: ${status.terminal.poolSize}`);\r\n    console.log(`   Active Sessions: ${status.terminal.active}`);\r\n    console.log(`   Status: ${status.terminal.status}`);\r\n\r\n    // MCP details\r\n    console.log('\\nðŸŒ MCP Server:');\r\n    console.log(`   Status: ${status.mcp.status}`);\r\n    console.log(`   Port: ${status.mcp.port || 'Not configured'}`);\r\n    console.log(`   Active Connections: ${status.mcp.connections}`);\r\n\r\n    // Resource usage\r\n    if (status.resources) {\r\n      console.log('\\nðŸ“ˆ Resource Usage:');\r\n      console.log(\r\n        `   Memory: ${status.resources.memory.usage} of ${status.resources.memory.total}`,\r\n      );\r\n      console.log(`   Available: ${status.resources.memory.available}`);\r\n      console.log(`   CPU Cores: ${status.resources.cpu.cores}`);\r\n      console.log(`   CPU Load: ${status.resources.cpu.load}`);\r\n      if (status.resources.cpu.model) {\r\n        console.log(`   CPU Model: ${status.resources.cpu.model}`);\r\n      }\r\n\r\n      if (status.resources.platform) {\r\n        console.log('\\nðŸ’» Platform:');\r\n        console.log(\r\n          `   OS: ${status.resources.platform.type} ${status.resources.platform.release}`,\r\n        );\r\n        console.log(`   Architecture: ${status.resources.platform.arch}`);\r\n        console.log(`   System Uptime: ${status.resources.platform.uptime}`);\r\n      }\r\n    }\r\n\r\n    console.log('\\nðŸ• Status captured at:', new Date(status.timestamp).toLocaleString());\r\n  }\r\n\r\n  // Recommendations\r\n  console.log('\\nðŸ’¡ Quick Actions:');\r\n  if (!status.orchestrator.running) {\r\n    console.log('   Run \"claude-flow start\" to begin orchestration');\r\n  }\r\n  if (status.agents.active === 0) {\r\n    console.log('   Run \"claude-flow agent spawn researcher\" to create an agent');\r\n  }\r\n  if (status.memory.entries === 0) {\r\n    console.log('   Run \"claude-flow memory store key value\" to test memory');\r\n  }\r\n}\r\n\r\nfunction formatBytes(bytes) {\r\n  const units = ['B', 'KB', 'MB', 'GB', 'TB'];\r\n  let size = bytes;\r\n  let unitIndex = 0;\r\n\r\n  while (size >= 1024 && unitIndex < units.length - 1) {\r\n    size /= 1024;\r\n    unitIndex++;\r\n  }\r\n\r\n  return `${size.toFixed(2)} ${units[unitIndex]}`;\r\n}\r\n\r\nfunction formatUptime(milliseconds) {\r\n  if (milliseconds === 0) return '0s';\r\n\r\n  const seconds = Math.floor(milliseconds / 1000);\r\n  const minutes = Math.floor(seconds / 60);\r\n  const hours = Math.floor(minutes / 60);\r\n  const days = Math.floor(hours / 24);\r\n\r\n  if (days > 0) return `${days}d ${hours % 24}h ${minutes % 60}m`;\r\n  if (hours > 0) return `${hours}h ${minutes % 60}m ${seconds % 60}s`;\r\n  if (minutes > 0) return `${minutes}m ${seconds % 60}s`;\r\n  return `${seconds}s`;\r\n}\r\n\r\n// Allow direct execution for testing\r\nif (import.meta.main) {\r\n  const args = [];\r\n  const flags = {};\r\n\r\n  // Parse arguments and flags from Deno.args if available\r\n  if (typeof Deno !== 'undefined' && Deno.args) {\r\n    for (let i = 0; i < Deno.args.length; i++) {\r\n      const arg = Deno.args[i];\r\n      if (arg.startsWith('--')) {\r\n        const flagName = arg.substring(2);\r\n        const nextArg = Deno.args[i + 1];\r\n\r\n        if (nextArg && !nextArg.startsWith('--')) {\r\n          flags[flagName] = nextArg;\r\n          i++; // Skip the next argument\r\n        } else {\r\n          flags[flagName] = true;\r\n        }\r\n      } else {\r\n        args.push(arg);\r\n      }\r\n    }\r\n  }\r\n\r\n  await statusCommand(args, flags);\r\n}\r\n"],"names":["printSuccess","promises","fs","MetricsReader","statusCommand","subArgs","flags","verbose","includes","json","status","getSystemStatus","console","log","JSON","stringify","displayStatus","reader","systemMetrics","perfMetrics","agents","recentTasks","overallHealth","mcpStatus","taskQueue","Promise","all","getSystemMetrics","getPerformanceMetrics","getActiveAgents","getRecentTasks","getOverallHealth","getMCPServerStatus","getTaskQueue","activeAgentCount","filter","a","length","timestamp","Date","now","version","orchestrator","running","totalTasks","uptime","active","total","types","reduce","acc","agent","type","tasks","queued","t","completed","successfulTasks","failed","failedTasks","memory","memoryUsagePercent","entries","getMemoryStats","size","memoryUsed","toFixed","terminal","poolSize","activeAgents","mcp","port","connections","resources","getResourceUsage","memoryStore","content","readFile","data","parse","totalEntries","Object","values","os","usage","cpu","cores","load","platform","error","totalMem","totalmem","freeMem","freemem","memInfo","free","available","buffers","cached","swapTotal","swapFree","cpuCores","cpus","loadAvg","loadAvgData","loadavg","e","formatBytes","Math","round","model","release","arch","formatUptime","message","overallStatus","keys","count","toLocaleString","bytes","units","unitIndex","milliseconds","seconds","floor","minutes","hours","days","main","args","Deno","i","arg","startsWith","flagName","substring","nextArg","push"],"mappings":"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"}