{"version":3,"sources":["../../../../src/cli/utils/safe-interactive.js"],"sourcesContent":["/**\r\n * Safe Interactive Wrapper - Handles interactive commands in non-interactive environments\r\n */\r\n\r\nimport chalk from 'chalk';\r\nimport { isInteractive, isRawModeSupported, getEnvironmentType } from './interactive-detector.js';\r\n\r\n/**\r\n * Wraps an interactive function with safety checks\r\n * @param {Function} interactiveFn - The interactive function to wrap\r\n * @param {Function} fallbackFn - The non-interactive fallback function\r\n * @param {Object} options - Options for the wrapper\r\n * @returns {Function} The wrapped function\r\n */\r\nexport function safeInteractive(interactiveFn, fallbackFn, options = {}) {\r\n  return async function (...args) {\r\n    const flags = args[args.length - 1] || {};\r\n\r\n    // Check if user explicitly requested non-interactive mode\r\n    if (flags.nonInteractive || flags['no-interactive']) {\r\n      if (fallbackFn) {\r\n        return fallbackFn(...args);\r\n      } else {\r\n        console.log(chalk.yellow('‚ö†Ô∏è  Non-interactive mode requested but no fallback available'));\r\n        console.log(chalk.gray('This command requires interactive mode to function properly'));\r\n        process.exit(1);\r\n      }\r\n    }\r\n\r\n    // Auto-detect if we should use non-interactive mode\r\n    if (!isInteractive() || !isRawModeSupported()) {\r\n      const envType = getEnvironmentType();\r\n\r\n      if (!options.silent) {\r\n        console.log(chalk.yellow('\\n‚ö†Ô∏è  Interactive mode not available'));\r\n        console.log(chalk.gray(`Detected environment: ${envType}`));\r\n\r\n        // Provide specific message based on environment\r\n        if (process.env.WSL_DISTRO_NAME || process.env.WSL_INTEROP) {\r\n          console.log(chalk.gray('WSL detected - raw mode may cause process hangs'));\r\n          console.log(chalk.cyan('üí° Tip: Use --no-interactive flag or run in native Linux'));\r\n        } else if (process.platform === 'win32') {\r\n          console.log(chalk.gray('Windows detected - terminal compatibility issues'));\r\n          console.log(chalk.cyan('üí° Tip: Use Windows Terminal or WSL2 for better experience'));\r\n        } else if (process.env.TERM_PROGRAM === 'vscode') {\r\n          console.log(chalk.gray('VS Code terminal detected - limited interactive support'));\r\n          console.log(chalk.cyan('üí° Tip: Use external terminal for full functionality'));\r\n        } else if (!isRawModeSupported()) {\r\n          console.log(chalk.gray('Terminal does not support raw mode'));\r\n        }\r\n\r\n        console.log();\r\n      }\r\n\r\n      if (fallbackFn) {\r\n        return fallbackFn(...args);\r\n      } else {\r\n        console.log(chalk.red('‚ùå This command requires interactive mode'));\r\n        console.log(chalk.gray('Please run in a compatible terminal environment'));\r\n        process.exit(1);\r\n      }\r\n    }\r\n\r\n    // Try to run the interactive function\r\n    try {\r\n      return await interactiveFn(...args);\r\n    } catch (error) {\r\n      // Check if it's a raw mode error\r\n      if (\r\n        error.message &&\r\n        (error.message.includes('setRawMode') ||\r\n          error.message.includes('raw mode') ||\r\n          error.message.includes('stdin') ||\r\n          error.message.includes('TTY'))\r\n      ) {\r\n        console.log(chalk.yellow('\\n‚ö†Ô∏è  Interactive mode failed'));\r\n        console.log(chalk.gray(error.message));\r\n\r\n        if (fallbackFn) {\r\n          console.log(chalk.cyan('Falling back to non-interactive mode...'));\r\n          return fallbackFn(...args);\r\n        } else {\r\n          console.log(chalk.red('‚ùå No non-interactive fallback available'));\r\n          process.exit(1);\r\n        }\r\n      }\r\n\r\n      // Re-throw other errors\r\n      throw error;\r\n    }\r\n  };\r\n}\r\n\r\n/**\r\n * Create a non-interactive version of a prompt\r\n * @param {string} message - The prompt message\r\n * @param {*} defaultValue - The default value to use\r\n * @returns {*} The default value\r\n */\r\nexport function nonInteractivePrompt(message, defaultValue) {\r\n  console.log(chalk.gray(`üìù ${message}`));\r\n  console.log(chalk.cyan(`   Using default: ${defaultValue}`));\r\n  return defaultValue;\r\n}\r\n\r\n/**\r\n * Create a non-interactive version of a selection\r\n * @param {string} message - The selection message\r\n * @param {Array} choices - The available choices\r\n * @param {*} defaultChoice - The default choice\r\n * @returns {*} The default choice\r\n */\r\nexport function nonInteractiveSelect(message, choices, defaultChoice) {\r\n  console.log(chalk.gray(`üìã ${message}`));\r\n  console.log(chalk.gray('   Available choices:'));\r\n  choices.forEach((choice) => {\r\n    const isDefault = choice === defaultChoice || choice.value === defaultChoice;\r\n    console.log(chalk.gray(`   ${isDefault ? '‚ñ∂' : ' '} ${choice.name || choice}`));\r\n  });\r\n  console.log(chalk.cyan(`   Using default: ${defaultChoice}`));\r\n  return defaultChoice;\r\n}\r\n\r\n/**\r\n * Show a non-interactive progress indicator\r\n * @param {string} message - The progress message\r\n * @returns {Object} Progress control object\r\n */\r\nexport function nonInteractiveProgress(message) {\r\n  console.log(chalk.gray(`‚è≥ ${message}...`));\r\n\r\n  return {\r\n    update: (newMessage) => {\r\n      console.log(chalk.gray(`   ${newMessage}`));\r\n    },\r\n    succeed: (finalMessage) => {\r\n      console.log(chalk.green(`‚úÖ ${finalMessage || message}`));\r\n    },\r\n    fail: (errorMessage) => {\r\n      console.log(chalk.red(`‚ùå ${errorMessage || 'Failed'}`));\r\n    },\r\n  };\r\n}\r\n"],"names":["chalk","isInteractive","isRawModeSupported","getEnvironmentType","safeInteractive","interactiveFn","fallbackFn","options","args","flags","length","nonInteractive","console","log","yellow","gray","process","exit","envType","silent","env","WSL_DISTRO_NAME","WSL_INTEROP","cyan","platform","TERM_PROGRAM","red","error","message","includes","nonInteractivePrompt","defaultValue","nonInteractiveSelect","choices","defaultChoice","forEach","choice","isDefault","value","name","nonInteractiveProgress","update","newMessage","succeed","finalMessage","green","fail","errorMessage"],"mappings":"AAIA,OAAOA,WAAW,QAAQ;AAC1B,SAASC,aAAa,EAAEC,kBAAkB,EAAEC,kBAAkB,QAAQ,4BAA4B;AASlG,OAAO,SAASC,gBAAgBC,aAAa,EAAEC,UAAU,EAAEC,UAAU,CAAC,CAAC;IACrE,OAAO,eAAgB,GAAGC,IAAI;QAC5B,MAAMC,QAAQD,IAAI,CAACA,KAAKE,MAAM,GAAG,EAAE,IAAI,CAAC;QAGxC,IAAID,MAAME,cAAc,IAAIF,KAAK,CAAC,iBAAiB,EAAE;YACnD,IAAIH,YAAY;gBACd,OAAOA,cAAcE;YACvB,OAAO;gBACLI,QAAQC,GAAG,CAACb,MAAMc,MAAM,CAAC;gBACzBF,QAAQC,GAAG,CAACb,MAAMe,IAAI,CAAC;gBACvBC,QAAQC,IAAI,CAAC;YACf;QACF;QAGA,IAAI,CAAChB,mBAAmB,CAACC,sBAAsB;YAC7C,MAAMgB,UAAUf;YAEhB,IAAI,CAACI,QAAQY,MAAM,EAAE;gBACnBP,QAAQC,GAAG,CAACb,MAAMc,MAAM,CAAC;gBACzBF,QAAQC,GAAG,CAACb,MAAMe,IAAI,CAAC,CAAC,sBAAsB,EAAEG,SAAS;gBAGzD,IAAIF,QAAQI,GAAG,CAACC,eAAe,IAAIL,QAAQI,GAAG,CAACE,WAAW,EAAE;oBAC1DV,QAAQC,GAAG,CAACb,MAAMe,IAAI,CAAC;oBACvBH,QAAQC,GAAG,CAACb,MAAMuB,IAAI,CAAC;gBACzB,OAAO,IAAIP,QAAQQ,QAAQ,KAAK,SAAS;oBACvCZ,QAAQC,GAAG,CAACb,MAAMe,IAAI,CAAC;oBACvBH,QAAQC,GAAG,CAACb,MAAMuB,IAAI,CAAC;gBACzB,OAAO,IAAIP,QAAQI,GAAG,CAACK,YAAY,KAAK,UAAU;oBAChDb,QAAQC,GAAG,CAACb,MAAMe,IAAI,CAAC;oBACvBH,QAAQC,GAAG,CAACb,MAAMuB,IAAI,CAAC;gBACzB,OAAO,IAAI,CAACrB,sBAAsB;oBAChCU,QAAQC,GAAG,CAACb,MAAMe,IAAI,CAAC;gBACzB;gBAEAH,QAAQC,GAAG;YACb;YAEA,IAAIP,YAAY;gBACd,OAAOA,cAAcE;YACvB,OAAO;gBACLI,QAAQC,GAAG,CAACb,MAAM0B,GAAG,CAAC;gBACtBd,QAAQC,GAAG,CAACb,MAAMe,IAAI,CAAC;gBACvBC,QAAQC,IAAI,CAAC;YACf;QACF;QAGA,IAAI;YACF,OAAO,MAAMZ,iBAAiBG;QAChC,EAAE,OAAOmB,OAAO;YAEd,IACEA,MAAMC,OAAO,IACZD,CAAAA,MAAMC,OAAO,CAACC,QAAQ,CAAC,iBACtBF,MAAMC,OAAO,CAACC,QAAQ,CAAC,eACvBF,MAAMC,OAAO,CAACC,QAAQ,CAAC,YACvBF,MAAMC,OAAO,CAACC,QAAQ,CAAC,MAAK,GAC9B;gBACAjB,QAAQC,GAAG,CAACb,MAAMc,MAAM,CAAC;gBACzBF,QAAQC,GAAG,CAACb,MAAMe,IAAI,CAACY,MAAMC,OAAO;gBAEpC,IAAItB,YAAY;oBACdM,QAAQC,GAAG,CAACb,MAAMuB,IAAI,CAAC;oBACvB,OAAOjB,cAAcE;gBACvB,OAAO;oBACLI,QAAQC,GAAG,CAACb,MAAM0B,GAAG,CAAC;oBACtBV,QAAQC,IAAI,CAAC;gBACf;YACF;YAGA,MAAMU;QACR;IACF;AACF;AAQA,OAAO,SAASG,qBAAqBF,OAAO,EAAEG,YAAY;IACxDnB,QAAQC,GAAG,CAACb,MAAMe,IAAI,CAAC,CAAC,GAAG,EAAEa,SAAS;IACtChB,QAAQC,GAAG,CAACb,MAAMuB,IAAI,CAAC,CAAC,kBAAkB,EAAEQ,cAAc;IAC1D,OAAOA;AACT;AASA,OAAO,SAASC,qBAAqBJ,OAAO,EAAEK,OAAO,EAAEC,aAAa;IAClEtB,QAAQC,GAAG,CAACb,MAAMe,IAAI,CAAC,CAAC,GAAG,EAAEa,SAAS;IACtChB,QAAQC,GAAG,CAACb,MAAMe,IAAI,CAAC;IACvBkB,QAAQE,OAAO,CAAC,CAACC;QACf,MAAMC,YAAYD,WAAWF,iBAAiBE,OAAOE,KAAK,KAAKJ;QAC/DtB,QAAQC,GAAG,CAACb,MAAMe,IAAI,CAAC,CAAC,GAAG,EAAEsB,YAAY,MAAM,IAAI,CAAC,EAAED,OAAOG,IAAI,IAAIH,QAAQ;IAC/E;IACAxB,QAAQC,GAAG,CAACb,MAAMuB,IAAI,CAAC,CAAC,kBAAkB,EAAEW,eAAe;IAC3D,OAAOA;AACT;AAOA,OAAO,SAASM,uBAAuBZ,OAAO;IAC5ChB,QAAQC,GAAG,CAACb,MAAMe,IAAI,CAAC,CAAC,EAAE,EAAEa,QAAQ,GAAG,CAAC;IAExC,OAAO;QACLa,QAAQ,CAACC;YACP9B,QAAQC,GAAG,CAACb,MAAMe,IAAI,CAAC,CAAC,GAAG,EAAE2B,YAAY;QAC3C;QACAC,SAAS,CAACC;YACRhC,QAAQC,GAAG,CAACb,MAAM6C,KAAK,CAAC,CAAC,EAAE,EAAED,gBAAgBhB,SAAS;QACxD;QACAkB,MAAM,CAACC;YACLnC,QAAQC,GAAG,CAACb,MAAM0B,GAAG,CAAC,CAAC,EAAE,EAAEqB,gBAAgB,UAAU;QACvD;IACF;AACF"}