{"version":3,"sources":["../../../src/enterprise/project-manager.ts"],"sourcesContent":["import { EventEmitter } from 'events';\r\nimport { writeFile, readFile, mkdir, readdir, stat } from 'fs/promises';\r\nimport { join } from 'path';\r\nimport { Logger } from '../core/logger.js';\r\nimport { ConfigManager } from '../core/config.js';\r\n\r\nexport interface ProjectPhase {\r\n  id: string;\r\n  name: string;\r\n  description: string;\r\n  status: 'planned' | 'in-progress' | 'completed' | 'blocked' | 'cancelled';\r\n  startDate?: Date;\r\n  endDate?: Date;\r\n  estimatedDuration: number; // in hours\r\n  actualDuration?: number;\r\n  dependencies: string[];\r\n  assignedTeam: string[];\r\n  deliverables: string[];\r\n  risks: ProjectRisk[];\r\n  milestones: ProjectMilestone[];\r\n  budget: {\r\n    estimated: number;\r\n    actual: number;\r\n    currency: string;\r\n  };\r\n  resources: ProjectResource[];\r\n  completionPercentage: number;\r\n  qualityMetrics: {\r\n    testCoverage: number;\r\n    codeQuality: number;\r\n    documentation: number;\r\n    securityScore: number;\r\n  };\r\n}\r\n\r\nexport interface ProjectRisk {\r\n  id: string;\r\n  description: string;\r\n  probability: 'low' | 'medium' | 'high';\r\n  impact: 'low' | 'medium' | 'high';\r\n  mitigation: string;\r\n  status: 'open' | 'mitigated' | 'closed';\r\n  assignedTo: string;\r\n  createdAt: Date;\r\n  updatedAt: Date;\r\n}\r\n\r\nexport interface ProjectMilestone {\r\n  id: string;\r\n  name: string;\r\n  description: string;\r\n  targetDate: Date;\r\n  actualDate?: Date;\r\n  status: 'pending' | 'achieved' | 'missed' | 'at-risk';\r\n  dependencies: string[];\r\n  deliverables: string[];\r\n  successCriteria: string[];\r\n}\r\n\r\nexport interface ProjectResource {\r\n  id: string;\r\n  name: string;\r\n  type: 'human' | 'infrastructure' | 'software' | 'hardware';\r\n  availability: number; // percentage\r\n  cost: {\r\n    amount: number;\r\n    currency: string;\r\n    period: 'hour' | 'day' | 'week' | 'month';\r\n  };\r\n  skills: string[];\r\n  allocation: {\r\n    phaseId: string;\r\n    percentage: number;\r\n    startDate: Date;\r\n    endDate: Date;\r\n  }[];\r\n}\r\n\r\nexport interface Project {\r\n  id: string;\r\n  name: string;\r\n  description: string;\r\n  type: 'web-app' | 'api' | 'microservice' | 'infrastructure' | 'research' | 'migration' | 'custom';\r\n  status: 'planning' | 'active' | 'on-hold' | 'completed' | 'cancelled';\r\n  priority: 'low' | 'medium' | 'high' | 'critical';\r\n  owner: string;\r\n  stakeholders: string[];\r\n  phases: ProjectPhase[];\r\n  budget: {\r\n    total: number;\r\n    spent: number;\r\n    remaining: number;\r\n    currency: string;\r\n  };\r\n  timeline: {\r\n    plannedStart: Date;\r\n    plannedEnd: Date;\r\n    actualStart?: Date;\r\n    actualEnd?: Date;\r\n  };\r\n  tags: string[];\r\n  metadata: Record<string, any>;\r\n  createdAt: Date;\r\n  updatedAt: Date;\r\n  auditLog: ProjectAuditEntry[];\r\n  collaboration: {\r\n    teamMembers: TeamMember[];\r\n    communication: CommunicationChannel[];\r\n    sharedResources: string[];\r\n  };\r\n  qualityGates: QualityGate[];\r\n  complianceRequirements: ComplianceRequirement[];\r\n}\r\n\r\nexport interface TeamMember {\r\n  id: string;\r\n  name: string;\r\n  email: string;\r\n  role: string;\r\n  skills: string[];\r\n  availability: number;\r\n  permissions: string[];\r\n  joinDate: Date;\r\n  status: 'active' | 'inactive' | 'on-leave';\r\n}\r\n\r\nexport interface CommunicationChannel {\r\n  id: string;\r\n  name: string;\r\n  type: 'slack' | 'teams' | 'email' | 'webhook' | 'custom';\r\n  configuration: Record<string, any>;\r\n  isActive: boolean;\r\n}\r\n\r\nexport interface QualityGate {\r\n  id: string;\r\n  name: string;\r\n  phase: string;\r\n  criteria: {\r\n    metric: string;\r\n    threshold: number;\r\n    operator: '>' | '<' | '>=' | '<=' | '==' | '!=';\r\n  }[];\r\n  status: 'pending' | 'passed' | 'failed' | 'skipped';\r\n  executedAt?: Date;\r\n  results: Record<string, number>;\r\n}\r\n\r\nexport interface ComplianceRequirement {\r\n  id: string;\r\n  name: string;\r\n  framework: string; // e.g., 'SOC2', 'GDPR', 'HIPAA', 'PCI-DSS'\r\n  description: string;\r\n  status: 'not-started' | 'in-progress' | 'compliant' | 'non-compliant';\r\n  evidence: string[];\r\n  reviewer: string;\r\n  reviewDate?: Date;\r\n  dueDate: Date;\r\n}\r\n\r\nexport interface ProjectAuditEntry {\r\n  id: string;\r\n  timestamp: Date;\r\n  userId: string;\r\n  action: string;\r\n  target: string;\r\n  details: Record<string, any>;\r\n  ipAddress?: string;\r\n  userAgent?: string;\r\n}\r\n\r\nexport interface ProjectMetrics {\r\n  totalProjects: number;\r\n  activeProjects: number;\r\n  completedProjects: number;\r\n  averageProjectDuration: number;\r\n  budgetVariance: number;\r\n  resourceUtilization: number;\r\n  qualityScore: number;\r\n  riskScore: number;\r\n  teamProductivity: number;\r\n  customerSatisfaction: number;\r\n}\r\n\r\nexport interface ProjectReport {\r\n  id: string;\r\n  projectId: string;\r\n  type: 'status' | 'financial' | 'quality' | 'risk' | 'resource' | 'compliance';\r\n  title: string;\r\n  summary: string;\r\n  details: Record<string, any>;\r\n  recommendations: string[];\r\n  generatedAt: Date;\r\n  generatedBy: string;\r\n  format: 'json' | 'pdf' | 'html' | 'csv';\r\n  recipients: string[];\r\n}\r\n\r\nexport class ProjectManager extends EventEmitter {\r\n  private projects: Map<string, Project> = new Map();\r\n  private projectsPath: string;\r\n  private logger: Logger;\r\n  private config: ConfigManager;\r\n\r\n  constructor(projectsPath: string = './projects', logger?: Logger, config?: ConfigManager) {\r\n    super();\r\n    this.projectsPath = projectsPath;\r\n    this.logger = logger || new Logger({ level: 'info', format: 'text', destination: 'console' });\r\n    this.config = config || ConfigManager.getInstance();\r\n  }\r\n\r\n  async initialize(): Promise<void> {\r\n    try {\r\n      await mkdir(this.projectsPath, { recursive: true });\r\n      await this.loadProjects();\r\n      this.logger.info('Project Manager initialized successfully');\r\n    } catch (error) {\r\n      this.logger.error('Failed to initialize Project Manager', { error });\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  async createProject(projectData: Partial<Project>): Promise<Project> {\r\n    const project: Project = {\r\n      id: projectData.id || `project-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`,\r\n      name: projectData.name || 'Unnamed Project',\r\n      description: projectData.description || '',\r\n      type: projectData.type || 'custom',\r\n      status: 'planning',\r\n      priority: projectData.priority || 'medium',\r\n      owner: projectData.owner || 'system',\r\n      stakeholders: projectData.stakeholders || [],\r\n      phases: projectData.phases || [],\r\n      budget: projectData.budget || {\r\n        total: 0,\r\n        spent: 0,\r\n        remaining: 0,\r\n        currency: 'USD',\r\n      },\r\n      timeline: {\r\n        plannedStart: projectData.timeline?.plannedStart || new Date(),\r\n        plannedEnd:\r\n          projectData.timeline?.plannedEnd || new Date(Date.now() + 30 * 24 * 60 * 60 * 1000), // 30 days\r\n        actualStart: projectData.timeline?.actualStart,\r\n        actualEnd: projectData.timeline?.actualEnd,\r\n      },\r\n      tags: projectData.tags || [],\r\n      metadata: projectData.metadata || {},\r\n      createdAt: new Date(),\r\n      updatedAt: new Date(),\r\n      auditLog: [],\r\n      collaboration: {\r\n        teamMembers: [],\r\n        communication: [],\r\n        sharedResources: [],\r\n      },\r\n      qualityGates: [],\r\n      complianceRequirements: [],\r\n    };\r\n\r\n    // Add initial audit entry\r\n    this.addAuditEntry(project, 'system', 'project_created', 'project', {\r\n      projectId: project.id,\r\n      projectName: project.name,\r\n    });\r\n\r\n    this.projects.set(project.id, project);\r\n    await this.saveProject(project);\r\n\r\n    this.emit('project:created', project);\r\n    this.logger.info(`Project created: ${project.name} (${project.id})`);\r\n\r\n    return project;\r\n  }\r\n\r\n  async updateProject(projectId: string, updates: Partial<Project>): Promise<Project> {\r\n    const project = this.projects.get(projectId);\r\n    if (!project) {\r\n      throw new Error(`Project not found: ${projectId}`);\r\n    }\r\n\r\n    const updatedProject = { ...project, ...updates, updatedAt: new Date() };\r\n\r\n    // Add audit entry\r\n    this.addAuditEntry(updatedProject, 'system', 'project_updated', 'project', {\r\n      projectId,\r\n      changes: Object.keys(updates),\r\n    });\r\n\r\n    this.projects.set(projectId, updatedProject);\r\n    await this.saveProject(updatedProject);\r\n\r\n    this.emit('project:updated', updatedProject);\r\n    this.logger.info(`Project updated: ${project.name} (${projectId})`);\r\n\r\n    return updatedProject;\r\n  }\r\n\r\n  async deleteProject(projectId: string, userId: string = 'system'): Promise<void> {\r\n    const project = this.projects.get(projectId);\r\n    if (!project) {\r\n      throw new Error(`Project not found: ${projectId}`);\r\n    }\r\n\r\n    // Add audit entry before deletion\r\n    this.addAuditEntry(project, userId, 'project_deleted', 'project', {\r\n      projectId,\r\n      projectName: project.name,\r\n    });\r\n\r\n    this.projects.delete(projectId);\r\n\r\n    // Archive project instead of deleting\r\n    const archivePath = join(this.projectsPath, 'archived');\r\n    await mkdir(archivePath, { recursive: true });\r\n    await writeFile(join(archivePath, `${projectId}.json`), JSON.stringify(project, null, 2));\r\n\r\n    this.emit('project:deleted', { projectId, project });\r\n    this.logger.info(`Project archived: ${project.name} (${projectId})`);\r\n  }\r\n\r\n  async getProject(projectId: string): Promise<Project | null> {\r\n    return this.projects.get(projectId) || null;\r\n  }\r\n\r\n  async listProjects(filters?: {\r\n    status?: Project['status'];\r\n    type?: Project['type'];\r\n    priority?: Project['priority'];\r\n    owner?: string;\r\n    tags?: string[];\r\n  }): Promise<Project[]> {\r\n    let projects = Array.from(this.projects.values());\r\n\r\n    if (filters) {\r\n      if (filters.status) {\r\n        projects = projects.filter((p) => p.status === filters.status);\r\n      }\r\n      if (filters.type) {\r\n        projects = projects.filter((p) => p.type === filters.type);\r\n      }\r\n      if (filters.priority) {\r\n        projects = projects.filter((p) => p.priority === filters.priority);\r\n      }\r\n      if (filters.owner) {\r\n        projects = projects.filter((p) => p.owner === filters.owner);\r\n      }\r\n      if (filters.tags && filters.tags.length > 0) {\r\n        projects = projects.filter((p) => filters.tags!.some((tag) => p.tags.includes(tag)));\r\n      }\r\n    }\r\n\r\n    return projects.sort(\r\n      (a, b) => new Date(b.updatedAt).getTime() - new Date(a.updatedAt).getTime(),\r\n    );\r\n  }\r\n\r\n  async addPhase(projectId: string, phase: Omit<ProjectPhase, 'id'>): Promise<ProjectPhase> {\r\n    const project = this.projects.get(projectId);\r\n    if (!project) {\r\n      throw new Error(`Project not found: ${projectId}`);\r\n    }\r\n\r\n    const newPhase: ProjectPhase = {\r\n      id: `phase-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`,\r\n      ...phase,\r\n    };\r\n\r\n    project.phases.push(newPhase);\r\n    project.updatedAt = new Date();\r\n\r\n    this.addAuditEntry(project, 'system', 'phase_added', 'phase', {\r\n      projectId,\r\n      phaseId: newPhase.id,\r\n      phaseName: newPhase.name,\r\n    });\r\n\r\n    await this.saveProject(project);\r\n    this.emit('phase:added', { project, phase: newPhase });\r\n\r\n    return newPhase;\r\n  }\r\n\r\n  async updatePhase(\r\n    projectId: string,\r\n    phaseId: string,\r\n    updates: Partial<ProjectPhase>,\r\n  ): Promise<ProjectPhase> {\r\n    const project = this.projects.get(projectId);\r\n    if (!project) {\r\n      throw new Error(`Project not found: ${projectId}`);\r\n    }\r\n\r\n    const phaseIndex = project.phases.findIndex((p) => p.id === phaseId);\r\n    if (phaseIndex === -1) {\r\n      throw new Error(`Phase not found: ${phaseId}`);\r\n    }\r\n\r\n    const updatedPhase = { ...project.phases[phaseIndex], ...updates };\r\n    project.phases[phaseIndex] = updatedPhase;\r\n    project.updatedAt = new Date();\r\n\r\n    this.addAuditEntry(project, 'system', 'phase_updated', 'phase', {\r\n      projectId,\r\n      phaseId,\r\n      changes: Object.keys(updates),\r\n    });\r\n\r\n    await this.saveProject(project);\r\n    this.emit('phase:updated', { project, phase: updatedPhase });\r\n\r\n    return updatedPhase;\r\n  }\r\n\r\n  async addTeamMember(projectId: string, member: TeamMember): Promise<void> {\r\n    const project = this.projects.get(projectId);\r\n    if (!project) {\r\n      throw new Error(`Project not found: ${projectId}`);\r\n    }\r\n\r\n    project.collaboration.teamMembers.push(member);\r\n    project.updatedAt = new Date();\r\n\r\n    this.addAuditEntry(project, 'system', 'team_member_added', 'team', {\r\n      projectId,\r\n      memberId: member.id,\r\n      memberName: member.name,\r\n    });\r\n\r\n    await this.saveProject(project);\r\n    this.emit('team:member_added', { project, member });\r\n  }\r\n\r\n  async removeTeamMember(projectId: string, memberId: string): Promise<void> {\r\n    const project = this.projects.get(projectId);\r\n    if (!project) {\r\n      throw new Error(`Project not found: ${projectId}`);\r\n    }\r\n\r\n    const memberIndex = project.collaboration.teamMembers.findIndex((m) => m.id === memberId);\r\n    if (memberIndex === -1) {\r\n      throw new Error(`Team member not found: ${memberId}`);\r\n    }\r\n\r\n    const member = project.collaboration.teamMembers[memberIndex];\r\n    project.collaboration.teamMembers.splice(memberIndex, 1);\r\n    project.updatedAt = new Date();\r\n\r\n    this.addAuditEntry(project, 'system', 'team_member_removed', 'team', {\r\n      projectId,\r\n      memberId,\r\n      memberName: member.name,\r\n    });\r\n\r\n    await this.saveProject(project);\r\n    this.emit('team:member_removed', { project, memberId });\r\n  }\r\n\r\n  async getProjectMetrics(projectId?: string): Promise<ProjectMetrics> {\r\n    const projects = projectId\r\n      ? ([this.projects.get(projectId)].filter(Boolean) as Project[])\r\n      : Array.from(this.projects.values());\r\n\r\n    const totalProjects = projects.length;\r\n    const activeProjects = projects.filter((p) => p.status === 'active').length;\r\n    const completedProjects = projects.filter((p) => p.status === 'completed').length;\r\n\r\n    const completedProjectsWithDuration = projects.filter(\r\n      (p) => p.status === 'completed' && p.timeline.actualStart && p.timeline.actualEnd,\r\n    );\r\n\r\n    const averageProjectDuration =\r\n      completedProjectsWithDuration.length > 0\r\n        ? completedProjectsWithDuration.reduce((sum, p) => {\r\n            const duration = p.timeline.actualEnd!.getTime() - p.timeline.actualStart!.getTime();\r\n            return sum + duration / (1000 * 60 * 60 * 24); // Convert to days\r\n          }, 0) / completedProjectsWithDuration.length\r\n        : 0;\r\n\r\n    const budgetVariance =\r\n      projects.reduce((sum, p) => {\r\n        if (p.budget.total > 0) {\r\n          return sum + (p.budget.spent - p.budget.total) / p.budget.total;\r\n        }\r\n        return sum;\r\n      }, 0) / Math.max(projects.length, 1);\r\n\r\n    const resourceUtilization =\r\n      projects.reduce((sum, p) => {\r\n        const totalResources = p.phases.reduce(\r\n          (phaseSum, phase) => phaseSum + phase.resources.length,\r\n          0,\r\n        );\r\n        const utilizedResources = p.phases.reduce(\r\n          (phaseSum, phase) => phaseSum + phase.resources.filter((r) => r.availability > 0).length,\r\n          0,\r\n        );\r\n        return sum + (totalResources > 0 ? utilizedResources / totalResources : 0);\r\n      }, 0) / Math.max(projects.length, 1);\r\n\r\n    const qualityScore =\r\n      projects.reduce((sum, p) => {\r\n        const phaseQuality =\r\n          p.phases.reduce((phaseSum, phase) => {\r\n            const metrics = phase.qualityMetrics;\r\n            return (\r\n              phaseSum +\r\n              (metrics.testCoverage +\r\n                metrics.codeQuality +\r\n                metrics.documentation +\r\n                metrics.securityScore) /\r\n                4\r\n            );\r\n          }, 0) / Math.max(p.phases.length, 1);\r\n        return sum + phaseQuality;\r\n      }, 0) / Math.max(projects.length, 1);\r\n\r\n    return {\r\n      totalProjects,\r\n      activeProjects,\r\n      completedProjects,\r\n      averageProjectDuration,\r\n      budgetVariance,\r\n      resourceUtilization,\r\n      qualityScore,\r\n      riskScore: 0, // Calculate based on risk assessment\r\n      teamProductivity: 0, // Calculate based on velocity metrics\r\n      customerSatisfaction: 0, // Calculate based on feedback\r\n    };\r\n  }\r\n\r\n  async generateReport(\r\n    projectId: string,\r\n    type: ProjectReport['type'],\r\n    userId: string = 'system',\r\n  ): Promise<ProjectReport> {\r\n    const project = this.projects.get(projectId);\r\n    if (!project) {\r\n      throw new Error(`Project not found: ${projectId}`);\r\n    }\r\n\r\n    const report: ProjectReport = {\r\n      id: `report-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`,\r\n      projectId,\r\n      type,\r\n      title: `${type.toUpperCase()} Report - ${project.name}`,\r\n      summary: '',\r\n      details: {},\r\n      recommendations: [],\r\n      generatedAt: new Date(),\r\n      generatedBy: userId,\r\n      format: 'json',\r\n      recipients: [],\r\n    };\r\n\r\n    switch (type) {\r\n      case 'status':\r\n        report.summary = `Project ${project.name} is currently ${project.status}`;\r\n        report.details = {\r\n          status: project.status,\r\n          progress: this.calculateProjectProgress(project),\r\n          phases: project.phases.map((p) => ({\r\n            name: p.name,\r\n            status: p.status,\r\n            completion: p.completionPercentage,\r\n          })),\r\n          timeline: project.timeline,\r\n          nextMilestones: this.getUpcomingMilestones(project),\r\n        };\r\n        break;\r\n\r\n      case 'financial':\r\n        report.summary = `Budget utilization: ${((project.budget.spent / project.budget.total) * 100).toFixed(1)}%`;\r\n        report.details = {\r\n          budget: project.budget,\r\n          costBreakdown: this.calculateCostBreakdown(project),\r\n          variance: project.budget.spent - project.budget.total,\r\n          projectedCost: this.projectFinalCost(project),\r\n        };\r\n        break;\r\n\r\n      case 'quality':\r\n        const qualityMetrics = this.calculateQualityMetrics(project);\r\n        report.summary = `Overall quality score: ${qualityMetrics.overall.toFixed(1)}%`;\r\n        report.details = {\r\n          qualityMetrics,\r\n          qualityGates: project.qualityGates,\r\n          recommendations: this.generateQualityRecommendations(project),\r\n        };\r\n        break;\r\n\r\n      case 'risk':\r\n        const risks = this.getAllRisks(project);\r\n        report.summary = `${risks.filter((r) => r.status === 'open').length} open risks identified`;\r\n        report.details = {\r\n          risks,\r\n          riskMatrix: this.generateRiskMatrix(risks),\r\n          mitigation: this.generateRiskMitigation(risks),\r\n        };\r\n        break;\r\n\r\n      case 'resource':\r\n        report.summary = `${project.collaboration.teamMembers.length} team members, ${this.getTotalResources(project)} resources allocated`;\r\n        report.details = {\r\n          teamMembers: project.collaboration.teamMembers,\r\n          resourceAllocation: this.calculateResourceAllocation(project),\r\n          utilization: this.calculateResourceUtilization(project),\r\n          capacity: this.calculateCapacity(project),\r\n        };\r\n        break;\r\n\r\n      case 'compliance':\r\n        const compliance = this.calculateComplianceStatus(project);\r\n        report.summary = `${compliance.compliant} of ${compliance.total} requirements met`;\r\n        report.details = {\r\n          requirements: project.complianceRequirements,\r\n          status: compliance,\r\n          gaps: this.identifyComplianceGaps(project),\r\n          recommendations: this.generateComplianceRecommendations(project),\r\n        };\r\n        break;\r\n    }\r\n\r\n    this.addAuditEntry(project, userId, 'report_generated', 'report', {\r\n      projectId,\r\n      reportId: report.id,\r\n      reportType: type,\r\n    });\r\n\r\n    this.emit('report:generated', { project, report });\r\n    return report;\r\n  }\r\n\r\n  private async loadProjects(): Promise<void> {\r\n    try {\r\n      const files = await readdir(this.projectsPath);\r\n      const projectFiles = files.filter((f) => f.endsWith('.json') && !f.startsWith('.'));\r\n\r\n      for (const file of projectFiles) {\r\n        try {\r\n          const content = await readFile(join(this.projectsPath, file), 'utf-8');\r\n          const project: Project = JSON.parse(content);\r\n          this.projects.set(project.id, project);\r\n        } catch (error) {\r\n          this.logger.error(`Failed to load project file: ${file}`, { error });\r\n        }\r\n      }\r\n\r\n      this.logger.info(`Loaded ${this.projects.size} projects`);\r\n    } catch (error) {\r\n      this.logger.error('Failed to load projects', { error });\r\n    }\r\n  }\r\n\r\n  private async saveProject(project: Project): Promise<void> {\r\n    const filePath = join(this.projectsPath, `${project.id}.json`);\r\n    await writeFile(filePath, JSON.stringify(project, null, 2));\r\n  }\r\n\r\n  private addAuditEntry(\r\n    project: Project,\r\n    userId: string,\r\n    action: string,\r\n    target: string,\r\n    details: Record<string, any>,\r\n  ): void {\r\n    const entry: ProjectAuditEntry = {\r\n      id: `audit-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`,\r\n      timestamp: new Date(),\r\n      userId,\r\n      action,\r\n      target,\r\n      details,\r\n    };\r\n\r\n    project.auditLog.push(entry);\r\n  }\r\n\r\n  private calculateProjectProgress(project: Project): number {\r\n    if (project.phases.length === 0) return 0;\r\n\r\n    const totalProgress = project.phases.reduce(\r\n      (sum, phase) => sum + phase.completionPercentage,\r\n      0,\r\n    );\r\n\r\n    return totalProgress / project.phases.length;\r\n  }\r\n\r\n  private getUpcomingMilestones(project: Project): ProjectMilestone[] {\r\n    const allMilestones = project.phases.flatMap((p) => p.milestones);\r\n    const now = new Date();\r\n\r\n    return allMilestones\r\n      .filter((m) => m.status === 'pending' && m.targetDate > now)\r\n      .sort((a, b) => a.targetDate.getTime() - b.targetDate.getTime())\r\n      .slice(0, 5);\r\n  }\r\n\r\n  private calculateCostBreakdown(project: Project): Record<string, number> {\r\n    const breakdown: Record<string, number> = {};\r\n\r\n    for (const phase of project.phases) {\r\n      for (const resource of phase.resources) {\r\n        const category = resource.type;\r\n        const cost = resource.cost.amount;\r\n        breakdown[category] = (breakdown[category] || 0) + cost;\r\n      }\r\n    }\r\n\r\n    return breakdown;\r\n  }\r\n\r\n  private projectFinalCost(project: Project): number {\r\n    const progress = this.calculateProjectProgress(project);\r\n    if (progress === 0) return project.budget.total;\r\n\r\n    return (project.budget.spent / progress) * 100;\r\n  }\r\n\r\n  private calculateQualityMetrics(project: Project): any {\r\n    const allMetrics = project.phases.map((p) => p.qualityMetrics);\r\n    if (allMetrics.length === 0) {\r\n      return { overall: 0, testCoverage: 0, codeQuality: 0, documentation: 0, securityScore: 0 };\r\n    }\r\n\r\n    const averages = {\r\n      testCoverage: allMetrics.reduce((sum, m) => sum + m.testCoverage, 0) / allMetrics.length,\r\n      codeQuality: allMetrics.reduce((sum, m) => sum + m.codeQuality, 0) / allMetrics.length,\r\n      documentation: allMetrics.reduce((sum, m) => sum + m.documentation, 0) / allMetrics.length,\r\n      securityScore: allMetrics.reduce((sum, m) => sum + m.securityScore, 0) / allMetrics.length,\r\n    };\r\n\r\n    const overall =\r\n      (averages.testCoverage +\r\n        averages.codeQuality +\r\n        averages.documentation +\r\n        averages.securityScore) /\r\n      4;\r\n\r\n    return { overall, ...averages };\r\n  }\r\n\r\n  private generateQualityRecommendations(project: Project): string[] {\r\n    const recommendations: string[] = [];\r\n    const metrics = this.calculateQualityMetrics(project);\r\n\r\n    if (metrics.testCoverage < 80) {\r\n      recommendations.push('Increase test coverage to at least 80%');\r\n    }\r\n    if (metrics.codeQuality < 70) {\r\n      recommendations.push('Improve code quality through refactoring and code reviews');\r\n    }\r\n    if (metrics.documentation < 60) {\r\n      recommendations.push('Enhance documentation coverage for better maintainability');\r\n    }\r\n    if (metrics.securityScore < 85) {\r\n      recommendations.push(\r\n        'Address security vulnerabilities and implement security best practices',\r\n      );\r\n    }\r\n\r\n    return recommendations;\r\n  }\r\n\r\n  private getAllRisks(project: Project): ProjectRisk[] {\r\n    return project.phases.flatMap((p) => p.risks);\r\n  }\r\n\r\n  private generateRiskMatrix(risks: ProjectRisk[]): any {\r\n    const matrix = {\r\n      low: { low: 0, medium: 0, high: 0 },\r\n      medium: { low: 0, medium: 0, high: 0 },\r\n      high: { low: 0, medium: 0, high: 0 },\r\n    };\r\n\r\n    for (const risk of risks) {\r\n      if (risk.status === 'open') {\r\n        matrix[risk.probability][risk.impact]++;\r\n      }\r\n    }\r\n\r\n    return matrix;\r\n  }\r\n\r\n  private generateRiskMitigation(risks: ProjectRisk[]): any {\r\n    const openRisks = risks.filter((r) => r.status === 'open');\r\n    const highPriorityRisks = openRisks.filter(\r\n      (r) =>\r\n        (r.probability === 'high' && r.impact === 'high') ||\r\n        (r.probability === 'high' && r.impact === 'medium') ||\r\n        (r.probability === 'medium' && r.impact === 'high'),\r\n    );\r\n\r\n    return {\r\n      totalRisks: risks.length,\r\n      openRisks: openRisks.length,\r\n      highPriorityRisks: highPriorityRisks.length,\r\n      mitigationActions: highPriorityRisks.map((r) => ({\r\n        risk: r.description,\r\n        mitigation: r.mitigation,\r\n        assignedTo: r.assignedTo,\r\n      })),\r\n    };\r\n  }\r\n\r\n  private getTotalResources(project: Project): number {\r\n    return project.phases.reduce((sum, phase) => sum + phase.resources.length, 0);\r\n  }\r\n\r\n  private calculateResourceAllocation(project: Project): any {\r\n    const allocation: Record<string, number> = {};\r\n\r\n    for (const phase of project.phases) {\r\n      for (const resource of phase.resources) {\r\n        allocation[resource.type] = (allocation[resource.type] || 0) + 1;\r\n      }\r\n    }\r\n\r\n    return allocation;\r\n  }\r\n\r\n  private calculateResourceUtilization(project: Project): any {\r\n    const utilization: Record<string, number> = {};\r\n\r\n    for (const phase of project.phases) {\r\n      for (const resource of phase.resources) {\r\n        utilization[resource.type] = (utilization[resource.type] || 0) + resource.availability;\r\n      }\r\n    }\r\n\r\n    return utilization;\r\n  }\r\n\r\n  private calculateCapacity(project: Project): any {\r\n    const teamSize = project.collaboration.teamMembers.length;\r\n    const totalAvailability = project.collaboration.teamMembers.reduce(\r\n      (sum, member) => sum + member.availability,\r\n      0,\r\n    );\r\n\r\n    return {\r\n      teamSize,\r\n      totalAvailability,\r\n      averageAvailability: teamSize > 0 ? totalAvailability / teamSize : 0,\r\n    };\r\n  }\r\n\r\n  private calculateComplianceStatus(project: Project): any {\r\n    const requirements = project.complianceRequirements;\r\n    const total = requirements.length;\r\n    const compliant = requirements.filter((r) => r.status === 'compliant').length;\r\n    const inProgress = requirements.filter((r) => r.status === 'in-progress').length;\r\n    const nonCompliant = requirements.filter((r) => r.status === 'non-compliant').length;\r\n\r\n    return {\r\n      total,\r\n      compliant,\r\n      inProgress,\r\n      nonCompliant,\r\n      compliancePercentage: total > 0 ? (compliant / total) * 100 : 0,\r\n    };\r\n  }\r\n\r\n  private identifyComplianceGaps(project: Project): ComplianceRequirement[] {\r\n    return project.complianceRequirements.filter(\r\n      (r) => r.status === 'not-started' || r.status === 'non-compliant',\r\n    );\r\n  }\r\n\r\n  private generateComplianceRecommendations(project: Project): string[] {\r\n    const gaps = this.identifyComplianceGaps(project);\r\n    const recommendations: string[] = [];\r\n\r\n    for (const gap of gaps) {\r\n      recommendations.push(\r\n        `Address ${gap.framework} requirement: ${gap.name} (Due: ${gap.dueDate.toLocaleDateString()})`,\r\n      );\r\n    }\r\n\r\n    return recommendations;\r\n  }\r\n}\r\n"],"names":["EventEmitter","writeFile","readFile","mkdir","readdir","join","Logger","ConfigManager","ProjectManager","projects","Map","projectsPath","logger","config","level","format","destination","getInstance","initialize","recursive","loadProjects","info","error","createProject","projectData","project","id","Date","now","Math","random","toString","substr","name","description","type","status","priority","owner","stakeholders","phases","budget","total","spent","remaining","currency","timeline","plannedStart","plannedEnd","actualStart","actualEnd","tags","metadata","createdAt","updatedAt","auditLog","collaboration","teamMembers","communication","sharedResources","qualityGates","complianceRequirements","addAuditEntry","projectId","projectName","set","saveProject","emit","updateProject","updates","get","Error","updatedProject","changes","Object","keys","deleteProject","userId","delete","archivePath","JSON","stringify","getProject","listProjects","filters","Array","from","values","filter","p","length","some","tag","includes","sort","a","b","getTime","addPhase","phase","newPhase","push","phaseId","phaseName","updatePhase","phaseIndex","findIndex","updatedPhase","addTeamMember","member","memberId","memberName","removeTeamMember","memberIndex","m","splice","getProjectMetrics","Boolean","totalProjects","activeProjects","completedProjects","completedProjectsWithDuration","averageProjectDuration","reduce","sum","duration","budgetVariance","max","resourceUtilization","totalResources","phaseSum","resources","utilizedResources","r","availability","qualityScore","phaseQuality","metrics","qualityMetrics","testCoverage","codeQuality","documentation","securityScore","riskScore","teamProductivity","customerSatisfaction","generateReport","report","title","toUpperCase","summary","details","recommendations","generatedAt","generatedBy","recipients","progress","calculateProjectProgress","map","completion","completionPercentage","nextMilestones","getUpcomingMilestones","toFixed","costBreakdown","calculateCostBreakdown","variance","projectedCost","projectFinalCost","calculateQualityMetrics","overall","generateQualityRecommendations","risks","getAllRisks","riskMatrix","generateRiskMatrix","mitigation","generateRiskMitigation","getTotalResources","resourceAllocation","calculateResourceAllocation","utilization","calculateResourceUtilization","capacity","calculateCapacity","compliance","calculateComplianceStatus","compliant","requirements","gaps","identifyComplianceGaps","generateComplianceRecommendations","reportId","reportType","files","projectFiles","f","endsWith","startsWith","file","content","parse","size","filePath","action","target","entry","timestamp","totalProgress","allMilestones","flatMap","milestones","targetDate","slice","breakdown","resource","category","cost","amount","allMetrics","averages","matrix","low","medium","high","risk","probability","impact","openRisks","highPriorityRisks","totalRisks","mitigationActions","assignedTo","allocation","teamSize","totalAvailability","averageAvailability","inProgress","nonCompliant","compliancePercentage","gap","framework","dueDate","toLocaleDateString"],"mappings":"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"}