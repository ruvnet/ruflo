{
  "version": 3,
  "sources": ["../../src/swarm/prompt-utils.ts"],
  "sourcesContent": ["import * as fs from 'fs/promises';\nimport * as path from 'path';\nimport { logger } from '../core/logger.js';\n\nexport interface PromptConfig {\n  sourceDirectories: string[];\n  destinationDirectory: string;\n  defaultOptions: {\n    backup: boolean;\n    verify: boolean;\n    parallel: boolean;\n    maxWorkers: number;\n    conflictResolution: 'skip' | 'overwrite' | 'backup' | 'merge';\n    includePatterns: string[];\n    excludePatterns: string[];\n  };\n  profiles: Record<string, Partial<PromptConfig['defaultOptions']>>;\n}\n\nexport const DEFAULT_CONFIG: PromptConfig = {\n  sourceDirectories: ['.roo', '.claude/commands', 'src/templates', 'templates'],\n  destinationDirectory: './project-prompts',\n  defaultOptions: {\n    backup: true,\n    verify: true,\n    parallel: true,\n    maxWorkers: 4,\n    conflictResolution: 'backup',\n    includePatterns: ['*.md', '*.txt', '*.prompt', '*.prompts', '*.json'],\n    excludePatterns: ['**/node_modules/**', '**/.git/**', '**/dist/**', '**/build/**'],\n  },\n  profiles: {\n    sparc: {\n      includePatterns: ['*.md', 'rules.md', 'sparc-*.md'],\n      excludePatterns: ['**/README.md', '**/CHANGELOG.md'],\n    },\n    templates: {\n      includePatterns: ['*.template', '*.tmpl', '*.hbs', '*.mustache'],\n      conflictResolution: 'merge',\n    },\n    safe: {\n      backup: true,\n      verify: true,\n      conflictResolution: 'skip',\n      parallel: false,\n    },\n    fast: {\n      backup: false,\n      verify: false,\n      parallel: true,\n      maxWorkers: 8,\n      conflictResolution: 'overwrite',\n    },\n  },\n};\n\nexport class PromptConfigManager {\n  private configPath: string;\n  private config: PromptConfig;\n\n  constructor(configPath?: string) {\n    this.configPath = configPath || path.join(process.cwd(), '.prompt-config.json');\n    this.config = { ...DEFAULT_CONFIG };\n  }\n\n  async loadConfig(): Promise<PromptConfig> {\n    try {\n      const configData = await fs.readFile(this.configPath, 'utf-8');\n      const userConfig = JSON.parse(configData) as Partial<PromptConfig>;\n\n      // Merge with defaults\n      this.config = this.mergeConfig(DEFAULT_CONFIG, userConfig);\n      logger.info(`Loaded config from ${this.configPath}`);\n    } catch (error) {\n      logger.info('Using default configuration');\n    }\n\n    return this.config;\n  }\n\n  async saveConfig(config?: Partial<PromptConfig>): Promise<void> {\n    if (config) {\n      this.config = this.mergeConfig(this.config, config);\n    }\n\n    await fs.writeFile(this.configPath, JSON.stringify(this.config, null, 2));\n    logger.info(`Saved config to ${this.configPath}`);\n  }\n\n  getConfig(): PromptConfig {\n    return this.config;\n  }\n\n  getProfile(profileName: string): PromptConfig['defaultOptions'] {\n    const profile = this.config.profiles[profileName];\n    if (!profile) {\n      throw new Error(`Profile '${profileName}' not found`);\n    }\n\n    return { ...this.config.defaultOptions, ...profile };\n  }\n\n  listProfiles(): string[] {\n    return Object.keys(this.config.profiles);\n  }\n\n  private mergeConfig(base: PromptConfig, override: Partial<PromptConfig>): PromptConfig {\n    return {\n      ...base,\n      ...override,\n      defaultOptions: {\n        ...base.defaultOptions,\n        ...override.defaultOptions,\n      },\n      profiles: {\n        ...base.profiles,\n        ...override.profiles,\n      },\n    };\n  }\n}\n\nexport class PromptPathResolver {\n  private basePath: string;\n\n  constructor(basePath: string = process.cwd()) {\n    this.basePath = basePath;\n  }\n\n  resolvePaths(\n    sourceDirectories: string[],\n    destinationDirectory: string,\n  ): {\n    sources: string[];\n    destination: string;\n  } {\n    const sources = sourceDirectories\n      .map((dir) => path.resolve(this.basePath, dir))\n      .filter((dir) => this.directoryExists(dir));\n\n    const destination = path.resolve(this.basePath, destinationDirectory);\n\n    return { sources, destination };\n  }\n\n  private directoryExists(dirPath: string): boolean {\n    try {\n      const fs = require('fs');\n      const stats = fs.statSync(dirPath);\n      return stats.isDirectory();\n    } catch {\n      return false;\n    }\n  }\n\n  // Discover prompt directories automatically\n  async discoverPromptDirectories(): Promise<string[]> {\n    const candidates = [\n      '.roo',\n      '.claude',\n      'prompts',\n      'templates',\n      'src/prompts',\n      'src/templates',\n      'docs/prompts',\n      'scripts/prompts',\n    ];\n\n    const discovered: string[] = [];\n\n    for (const candidate of candidates) {\n      const fullPath = path.resolve(this.basePath, candidate);\n      if (await this.containsPromptFiles(fullPath)) {\n        discovered.push(fullPath);\n      }\n    }\n\n    return discovered;\n  }\n\n  private async containsPromptFiles(dirPath: string): Promise<boolean> {\n    try {\n      const entries = await fs.readdir(dirPath, { withFileTypes: true });\n\n      for (const entry of entries) {\n        if (entry.isFile()) {\n          const fileName = entry.name.toLowerCase();\n          if (\n            fileName.endsWith('.md') ||\n            fileName.endsWith('.txt') ||\n            fileName.endsWith('.prompt') ||\n            fileName.includes('prompt') ||\n            fileName.includes('template')\n          ) {\n            return true;\n          }\n        } else if (entry.isDirectory()) {\n          const subPath = path.join(dirPath, entry.name);\n          if (await this.containsPromptFiles(subPath)) {\n            return true;\n          }\n        }\n      }\n\n      return false;\n    } catch {\n      return false;\n    }\n  }\n}\n\nexport class PromptValidator {\n  static async validatePromptFile(filePath: string): Promise<{\n    valid: boolean;\n    issues: string[];\n    metadata?: any;\n  }> {\n    const issues: string[] = [];\n    let metadata: any = {};\n\n    try {\n      const content = await fs.readFile(filePath, 'utf-8');\n\n      // Check for empty files\n      if (content.trim().length === 0) {\n        issues.push('File is empty');\n      }\n\n      // Check for common prompt markers\n      const hasPromptMarkers = [\n        '# ',\n        '## ',\n        '### ', // Markdown headers\n        'You are',\n        'Your task',\n        'Please', // Common prompt starters\n        '```',\n        '`', // Code blocks\n        '{{',\n        '}}', // Template variables\n      ].some((marker) => content.includes(marker));\n\n      if (!hasPromptMarkers) {\n        issues.push('File may not contain valid prompt content');\n      }\n\n      // Extract metadata from front matter\n      const frontMatterMatch = content.match(/^---\\n([\\s\\S]*?\\n)---/);\n      if (frontMatterMatch) {\n        try {\n          metadata = this.parseFrontMatter(frontMatterMatch[1]);\n        } catch (error) {\n          issues.push('Invalid front matter format');\n        }\n      }\n\n      // Check file size (warn if too large)\n      const stats = await fs.stat(filePath);\n      if (stats.size > 100 * 1024) {\n        // 100KB\n        issues.push('File is unusually large for a prompt');\n      }\n\n      return {\n        valid: issues.length === 0,\n        issues,\n        metadata,\n      };\n    } catch (error) {\n      return {\n        valid: false,\n        issues: [`Failed to read file: ${error instanceof Error ? error.message : String(error)}`],\n      };\n    }\n  }\n\n  private static parseFrontMatter(frontMatter: string): any {\n    // Simple YAML-like parser for basic key-value pairs\n    const metadata: any = {};\n    const lines = frontMatter.split('\\n');\n\n    for (const line of lines) {\n      const match = line.match(/^(\\w+):\\s*(.+)$/);\n      if (match) {\n        const [, key, value] = match;\n        metadata[key] = value.trim();\n      }\n    }\n\n    return metadata;\n  }\n}\n\nexport function createProgressBar(total: number): {\n  update: (current: number) => void;\n  complete: () => void;\n} {\n  const barLength = 40;\n\n  return {\n    update: (current: number) => {\n      const percentage = Math.round((current / total) * 100);\n      const filledLength = Math.round((current / total) * barLength);\n      const bar = '\u2588'.repeat(filledLength) + '\u2591'.repeat(barLength - filledLength);\n\n      process.stdout.write(`\\r[${bar}] ${percentage}% (${current}/${total})`);\n    },\n\n    complete: () => {\n      process.stdout.write('\\n');\n    },\n  };\n}\n\n// Utility function to format file sizes\nexport function formatFileSize(bytes: number): string {\n  const units = ['B', 'KB', 'MB', 'GB'];\n  let size = bytes;\n  let unitIndex = 0;\n\n  while (size >= 1024 && unitIndex < units.length - 1) {\n    size /= 1024;\n    unitIndex++;\n  }\n\n  return `${size.toFixed(1)} ${units[unitIndex]}`;\n}\n\n// Utility function to format duration\nexport function formatDuration(ms: number): string {\n  if (ms < 1000) return `${ms}ms`;\n  if (ms < 60000) return `${(ms / 1000).toFixed(1)}s`;\n  return `${Math.floor(ms / 60000)}m ${Math.floor((ms % 60000) / 1000)}s`;\n}\n"],
  "mappings": "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",
  "names": ["fs"]
}
