{"version":3,"sources":["../../../../../src/cli/simple-commands/init/gitignore-updater.js"],"sourcesContent":["/**\r\n * GitIgnore updater for Claude Flow initialization\r\n * Ensures Claude Flow generated files are properly ignored\r\n */\r\n\r\nimport { existsSync, readTextFile, writeTextFile } from '../../node-compat.js';\r\n\r\n/**\r\n * Default gitignore entries for Claude Flow\r\n */\r\nconst CLAUDE_FLOW_GITIGNORE_ENTRIES = `\r\n# Claude Flow generated files\r\n.claude/settings.local.json\r\n.mcp.json\r\nclaude-flow.config.json\r\n.swarm/\r\n.hive-mind/\r\n.claude-flow/\r\nmemory/\r\ncoordination/\r\nmemory/claude-flow-data.json\r\nmemory/sessions/*\r\n!memory/sessions/README.md\r\nmemory/agents/*\r\n!memory/agents/README.md\r\ncoordination/memory_bank/*\r\ncoordination/subtasks/*\r\ncoordination/orchestration/*\r\n*.db\r\n*.db-journal\r\n*.db-wal\r\n*.sqlite\r\n*.sqlite-journal\r\n*.sqlite-wal\r\nclaude-flow\r\n# Removed Windows wrapper files per user request\r\nhive-mind-prompt-*.txt\r\n`;\r\n\r\n/**\r\n * Update or create .gitignore with Claude Flow entries\r\n * @param {string} workingDir - The working directory\r\n * @param {boolean} force - Whether to force update even if entries exist\r\n * @param {boolean} dryRun - Whether to run in dry-run mode\r\n * @returns {Promise<{success: boolean, message: string}>}\r\n */\r\nexport async function updateGitignore(workingDir, force = false, dryRun = false) {\r\n  const gitignorePath = `${workingDir}/.gitignore`;\r\n\r\n  try {\r\n    let gitignoreContent = '';\r\n    let fileExists = false;\r\n\r\n    // Check if .gitignore exists\r\n    if (existsSync(gitignorePath)) {\r\n      fileExists = true;\r\n      gitignoreContent = await readTextFile(gitignorePath);\r\n    }\r\n\r\n    // Check if Claude Flow section already exists\r\n    const claudeFlowMarker = '# Claude Flow generated files';\r\n    if (gitignoreContent.includes(claudeFlowMarker) && !force) {\r\n      return {\r\n        success: true,\r\n        message: '.gitignore already contains Claude Flow entries',\r\n      };\r\n    }\r\n\r\n    // Prepare the new content\r\n    let newContent = gitignoreContent;\r\n\r\n    // Remove existing Claude Flow section if force updating\r\n    if (force && gitignoreContent.includes(claudeFlowMarker)) {\r\n      const startIndex = gitignoreContent.indexOf(claudeFlowMarker);\r\n      const endIndex = gitignoreContent.indexOf('\\n# ', startIndex + 1);\r\n      if (endIndex !== -1) {\r\n        newContent =\r\n          gitignoreContent.substring(0, startIndex) + gitignoreContent.substring(endIndex);\r\n      } else {\r\n        // Claude Flow section is at the end\r\n        newContent = gitignoreContent.substring(0, startIndex);\r\n      }\r\n    }\r\n\r\n    // Add Claude Flow entries\r\n    if (!newContent.endsWith('\\n') && newContent.length > 0) {\r\n      newContent += '\\n';\r\n    }\r\n    newContent += CLAUDE_FLOW_GITIGNORE_ENTRIES;\r\n\r\n    // Write the file\r\n    if (!dryRun) {\r\n      await writeTextFile(gitignorePath, newContent);\r\n    }\r\n\r\n    return {\r\n      success: true,\r\n      message: fileExists\r\n        ? (dryRun ? '[DRY RUN] Would update' : 'Updated') +\r\n          ' existing .gitignore with Claude Flow entries'\r\n        : (dryRun ? '[DRY RUN] Would create' : 'Created') + ' .gitignore with Claude Flow entries',\r\n    };\r\n  } catch (error) {\r\n    return {\r\n      success: false,\r\n      message: `Failed to update .gitignore: ${error.message}`,\r\n    };\r\n  }\r\n}\r\n\r\n/**\r\n * Check if gitignore needs updating\r\n * @param {string} workingDir - The working directory\r\n * @returns {Promise<boolean>}\r\n */\r\nexport async function needsGitignoreUpdate(workingDir) {\r\n  const gitignorePath = `${workingDir}/.gitignore`;\r\n\r\n  if (!existsSync(gitignorePath)) {\r\n    return true;\r\n  }\r\n\r\n  try {\r\n    const content = await readTextFile(gitignorePath);\r\n    return !content.includes('# Claude Flow generated files');\r\n  } catch {\r\n    return true;\r\n  }\r\n}\r\n\r\n/**\r\n * Get list of files that should be gitignored\r\n * @returns {string[]}\r\n */\r\nexport function getGitignorePatterns() {\r\n  return CLAUDE_FLOW_GITIGNORE_ENTRIES.split('\\n')\r\n    .filter((line) => line.trim() && !line.startsWith('#') && !line.startsWith('!'))\r\n    .map((line) => line.trim());\r\n}\r\n"],"names":["existsSync","readTextFile","writeTextFile","CLAUDE_FLOW_GITIGNORE_ENTRIES","updateGitignore","workingDir","force","dryRun","gitignorePath","gitignoreContent","fileExists","claudeFlowMarker","includes","success","message","newContent","startIndex","indexOf","endIndex","substring","endsWith","length","error","needsGitignoreUpdate","content","getGitignorePatterns","split","filter","line","trim","startsWith","map"],"mappings":"AAKA,SAASA,UAAU,EAAEC,YAAY,EAAEC,aAAa,QAAQ,uBAAuB;AAK/E,MAAMC,gCAAgC,CAAC;;;;;;;;;;;;;;;;;;;;;;;;;;;AA2BvC,CAAC;AASD,OAAO,eAAeC,gBAAgBC,UAAU,EAAEC,QAAQ,KAAK,EAAEC,SAAS,KAAK;IAC7E,MAAMC,gBAAgB,GAAGH,WAAW,WAAW,CAAC;IAEhD,IAAI;QACF,IAAII,mBAAmB;QACvB,IAAIC,aAAa;QAGjB,IAAIV,WAAWQ,gBAAgB;YAC7BE,aAAa;YACbD,mBAAmB,MAAMR,aAAaO;QACxC;QAGA,MAAMG,mBAAmB;QACzB,IAAIF,iBAAiBG,QAAQ,CAACD,qBAAqB,CAACL,OAAO;YACzD,OAAO;gBACLO,SAAS;gBACTC,SAAS;YACX;QACF;QAGA,IAAIC,aAAaN;QAGjB,IAAIH,SAASG,iBAAiBG,QAAQ,CAACD,mBAAmB;YACxD,MAAMK,aAAaP,iBAAiBQ,OAAO,CAACN;YAC5C,MAAMO,WAAWT,iBAAiBQ,OAAO,CAAC,QAAQD,aAAa;YAC/D,IAAIE,aAAa,CAAC,GAAG;gBACnBH,aACEN,iBAAiBU,SAAS,CAAC,GAAGH,cAAcP,iBAAiBU,SAAS,CAACD;YAC3E,OAAO;gBAELH,aAAaN,iBAAiBU,SAAS,CAAC,GAAGH;YAC7C;QACF;QAGA,IAAI,CAACD,WAAWK,QAAQ,CAAC,SAASL,WAAWM,MAAM,GAAG,GAAG;YACvDN,cAAc;QAChB;QACAA,cAAcZ;QAGd,IAAI,CAACI,QAAQ;YACX,MAAML,cAAcM,eAAeO;QACrC;QAEA,OAAO;YACLF,SAAS;YACTC,SAASJ,aACL,AAACH,CAAAA,SAAS,2BAA2B,SAAQ,IAC7C,kDACA,AAACA,CAAAA,SAAS,2BAA2B,SAAQ,IAAK;QACxD;IACF,EAAE,OAAOe,OAAO;QACd,OAAO;YACLT,SAAS;YACTC,SAAS,CAAC,6BAA6B,EAAEQ,MAAMR,OAAO,EAAE;QAC1D;IACF;AACF;AAOA,OAAO,eAAeS,qBAAqBlB,UAAU;IACnD,MAAMG,gBAAgB,GAAGH,WAAW,WAAW,CAAC;IAEhD,IAAI,CAACL,WAAWQ,gBAAgB;QAC9B,OAAO;IACT;IAEA,IAAI;QACF,MAAMgB,UAAU,MAAMvB,aAAaO;QACnC,OAAO,CAACgB,QAAQZ,QAAQ,CAAC;IAC3B,EAAE,OAAM;QACN,OAAO;IACT;AACF;AAMA,OAAO,SAASa;IACd,OAAOtB,8BAA8BuB,KAAK,CAAC,MACxCC,MAAM,CAAC,CAACC,OAASA,KAAKC,IAAI,MAAM,CAACD,KAAKE,UAAU,CAAC,QAAQ,CAACF,KAAKE,UAAU,CAAC,MAC1EC,GAAG,CAAC,CAACH,OAASA,KAAKC,IAAI;AAC5B"}