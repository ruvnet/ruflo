{
  "version": 3,
  "sources": ["../../../src/cli/commands/hook.ts"],
  "sourcesContent": ["import { spawn } from 'child_process';\nimport { Logger } from '../../core/logger.js';\nimport type {\n  PreTaskOptions,\n  PostTaskOptions,\n  PreEditOptions,\n  PostEditOptions,\n  PreCommandOptions,\n  PostCommandOptions,\n  SessionStartOptions,\n  SessionEndOptions,\n  SessionRestoreOptions,\n  PreSearchOptions,\n  NotificationOptions,\n  HookCommandOptions,\n  PerformanceOptions,\n  MemorySyncOptions,\n  TelemetryOptions,\n} from './hook-types.js';\n\nconst logger = new Logger(\n  {\n    level: 'info',\n    format: 'text',\n    destination: 'console',\n  },\n  { prefix: 'Hook' },\n);\n\n// Helper function to build command arguments\nfunction buildArgs(hookType: string, options: Record<string, any>): string[] {\n  const args = [hookType];\n\n  Object.entries(options).forEach(([key, value]) => {\n    if (value !== undefined && value !== null) {\n      const flagName = key.replace(/([A-Z])/g, '-$1').toLowerCase();\n\n      if (typeof value === 'boolean') {\n        if (value) {\n          args.push(`--${flagName}`);\n        } else {\n          args.push(`--no-${flagName}`);\n        }\n      } else {\n        args.push(`--${flagName}`, String(value));\n      }\n    }\n  });\n\n  return args;\n}\n\n// Hook subcommand handlers\nconst hookHandlers: Record<string, (args: string[]) => Promise<void>> = {\n  'pre-task': async (args: string[]) => {\n    const options = parseArgs<PreTaskOptions>(args);\n    await executeHook('pre-task', options);\n  },\n\n  'post-task': async (args: string[]) => {\n    const options = parseArgs<PostTaskOptions>(args);\n    if (!options.taskId) {\n      throw new Error('--task-id is required for post-task hook');\n    }\n    await executeHook('post-task', options);\n  },\n\n  'pre-edit': async (args: string[]) => {\n    const options = parseArgs<PreEditOptions>(args);\n    if (!options.file) {\n      throw new Error('--file is required for pre-edit hook');\n    }\n    await executeHook('pre-edit', options);\n  },\n\n  'post-edit': async (args: string[]) => {\n    const options = parseArgs<PostEditOptions>(args);\n    if (!options.file) {\n      throw new Error('--file is required for post-edit hook');\n    }\n    await executeHook('post-edit', options);\n  },\n\n  'pre-command': async (args: string[]) => {\n    const options = parseArgs<PreCommandOptions>(args);\n    if (!options.command) {\n      throw new Error('--command is required for pre-command hook');\n    }\n    await executeHook('pre-command', options);\n  },\n\n  'post-command': async (args: string[]) => {\n    const options = parseArgs<PostCommandOptions>(args);\n    if (!options.command) {\n      throw new Error('--command is required for post-command hook');\n    }\n    await executeHook('post-command', options);\n  },\n\n  'session-start': async (args: string[]) => {\n    const options = parseArgs<SessionStartOptions>(args);\n    await executeHook('session-start', options);\n  },\n\n  'session-end': async (args: string[]) => {\n    const options = parseArgs<SessionEndOptions>(args);\n    await executeHook('session-end', options);\n  },\n\n  'session-restore': async (args: string[]) => {\n    const options = parseArgs<SessionRestoreOptions>(args);\n    if (!options.sessionId) {\n      throw new Error('--session-id is required for session-restore hook');\n    }\n    await executeHook('session-restore', options);\n  },\n\n  'pre-search': async (args: string[]) => {\n    const options = parseArgs<PreSearchOptions>(args);\n    if (!options.query) {\n      throw new Error('--query is required for pre-search hook');\n    }\n    await executeHook('pre-search', options);\n  },\n\n  notification: async (args: string[]) => {\n    const options = parseArgs<NotificationOptions>(args);\n    if (!options.message) {\n      throw new Error('--message is required for notification hook');\n    }\n    await executeHook('notification', options);\n  },\n\n  performance: async (args: string[]) => {\n    const options = parseArgs<PerformanceOptions>(args);\n    await executeHook('performance', options);\n  },\n\n  'memory-sync': async (args: string[]) => {\n    const options = parseArgs<MemorySyncOptions>(args);\n    await executeHook('memory-sync', options);\n  },\n\n  telemetry: async (args: string[]) => {\n    const options = parseArgs<TelemetryOptions>(args);\n    if (!options.event) {\n      throw new Error('--event is required for telemetry hook');\n    }\n    await executeHook('telemetry', options);\n  },\n};\n\n// Parse command line arguments\nfunction parseArgs<T extends Record<string, any>>(args: string[]): T {\n  const options: Record<string, any> = {};\n\n  for (let i = 0; i < args.length; i++) {\n    const arg = args[i];\n\n    if (arg.startsWith('--')) {\n      const key = arg.slice(2).replace(/-([a-z])/g, (_, letter) => letter.toUpperCase());\n      const nextArg = args[i + 1];\n\n      if (!nextArg || nextArg.startsWith('--')) {\n        // Boolean flag\n        options[key] = !arg.startsWith('--no-');\n      } else {\n        // Value flag\n        options[key] = nextArg;\n        i++; // Skip next arg\n      }\n    }\n  }\n\n  return options as T;\n}\n\n// Execute hook with ruv-swarm\nasync function executeHook(hookType: string, options: Record<string, any>): Promise<void> {\n  const args = buildArgs(hookType, options);\n\n  logger.debug(`Executing hook: ruv-swarm hook ${args.join(' ')}`);\n\n  const child = spawn('npx', ['ruv-swarm', 'hook', ...args], {\n    stdio: 'inherit',\n    shell: true,\n  });\n\n  await new Promise<void>((resolve, reject) => {\n    child.on('exit', (code) => {\n      if (code === 0) {\n        resolve();\n      } else {\n        reject(new Error(`Hook ${hookType} failed with exit code ${code}`));\n      }\n    });\n\n    child.on('error', (error) => {\n      logger.error(`Failed to execute hook ${hookType}:`, error);\n      reject(error);\n    });\n  });\n}\n\n// Main hook command handler\nexport const hookCommand = {\n  name: 'hook',\n  description: 'Execute ruv-swarm hooks for agent coordination',\n  action: async ({ args }: HookCommandOptions): Promise<void> => {\n    try {\n      if (args.length === 0) {\n        showHookHelp();\n        return;\n      }\n\n      const subcommand = args[0];\n      const handler = hookHandlers[subcommand];\n\n      if (!handler) {\n        logger.error(`Unknown hook subcommand: ${subcommand}`);\n        showHookHelp();\n        throw new Error(`Unknown hook subcommand: ${subcommand}`);\n      }\n\n      await handler(args.slice(1));\n    } catch (error) {\n      logger.error('Hook command error:', error);\n      throw error;\n    }\n  },\n};\n\n// Show help for hook commands\nfunction showHookHelp(): void {\n  console.log(`\nClaude Flow Hook Commands\n========================\n\nAvailable hooks:\n\n  pre-task      - Run before starting a task\n    --description <desc>      Task description\n    --auto-spawn-agents       Auto-spawn agents (default: true)\n    --complexity <level>      Task complexity: low|medium|high\n    --estimated-minutes <n>   Estimated duration\n    --requires-research       Task requires research\n    --requires-testing        Task requires testing\n\n  post-task     - Run after completing a task\n    --task-id <id>           Task ID (required)\n    --analyze-performance    Analyze performance metrics\n    --generate-report        Generate completion report\n\n  pre-edit      - Run before editing a file\n    --file <path>            File path (required)\n    --operation <op>         Operation type: read|write|edit|delete\n    --validate               Validate file before edit\n\n  post-edit     - Run after editing a file\n    --file <path>            File path (required)\n    --memory-key <key>       Store in memory with key\n    --format                 Auto-format code\n    --analyze                Analyze changes\n\n  pre-command   - Run before executing a command\n    --command <cmd>          Command to execute (required)\n    --validate               Validate command safety\n    --sandbox                Run in sandbox mode\n\n  post-command  - Run after executing a command\n    --command <cmd>          Command executed (required)\n    --exit-code <code>       Command exit code\n    --duration <ms>          Execution duration\n\n  session-start - Run at session start\n    --session-id <id>        Session identifier\n    --load-previous          Load previous session data\n    --auto-restore           Auto-restore context\n\n  session-end   - Run at session end\n    --session-id <id>        Session identifier\n    --export-metrics         Export performance metrics\n    --generate-summary       Generate session summary\n    --save-to <path>         Save session data to path\n\n  session-restore - Restore a previous session\n    --session-id <id>        Session ID to restore (required)\n    --load-memory            Load memory state\n    --load-agents            Load agent configuration\n    --load-tasks             Load task list\n\n  pre-search    - Run before searching\n    --query <text>           Search query (required)\n    --cache-results          Cache search results\n    --max-results <n>        Maximum results to return\n\n  notification  - Send a notification\n    --message <text>         Notification message (required)\n    --level <level>          Message level: info|warning|error\n    --telemetry              Include in telemetry\n    --persist                Persist notification\n\n  performance   - Track performance metrics\n    --operation <name>       Operation name\n    --duration <ms>          Operation duration\n    --metrics <json>         Performance metrics as JSON\n\n  memory-sync   - Synchronize memory state\n    --namespace <name>       Memory namespace\n    --direction <dir>        Sync direction: push|pull|sync\n    --target <location>      Target location for sync\n\n  telemetry     - Send telemetry data\n    --event <name>           Event name (required)\n    --data <json>            Event data as JSON\n    --tags <list>            Comma-separated tags\n\nCommon options:\n  --verbose                  Show detailed output\n  --metadata <json>          Additional metadata as JSON\n\nExamples:\n  claude hook pre-task --description \"Build REST API\" --complexity high\n  claude hook post-edit --file src/index.js --memory-key \"api/implementation\"\n  claude hook session-end --export-metrics --generate-summary\n  claude hook performance --operation \"api-build\" --duration 1234\n  claude hook memory-sync --namespace \"project\" --direction push\n  claude hook telemetry --event \"task-completed\" --data '{\"taskId\":\"123\"}'\n`);\n}\n\n// Export hook subcommands for better CLI integration\nexport const hookSubcommands = [\n  'pre-task',\n  'post-task',\n  'pre-edit',\n  'post-edit',\n  'pre-command',\n  'post-command',\n  'session-start',\n  'session-end',\n  'session-restore',\n  'pre-search',\n  'notification',\n  'performance',\n  'memory-sync',\n  'telemetry',\n];\n"],
  "mappings": "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",
  "names": []
}
