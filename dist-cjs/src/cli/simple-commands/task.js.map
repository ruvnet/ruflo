{"version":3,"sources":["../../../../src/cli/simple-commands/task.js"],"sourcesContent":["// task.js - Task management commands with improved argument parsing\r\nimport { printSuccess, printError, printWarning } from '../utils.js';\r\nimport { Command } from 'commander';\r\n\r\nexport async function taskCommand(subArgs, flags) {\r\n  const taskCmd = subArgs[0];\r\n\r\n  switch (taskCmd) {\r\n    case 'create':\r\n      await createTask(subArgs, flags);\r\n      break;\r\n\r\n    case 'list':\r\n      await listTasks(subArgs, flags);\r\n      break;\r\n\r\n    case 'status':\r\n      await showTaskStatus(subArgs, flags);\r\n      break;\r\n\r\n    case 'cancel':\r\n      await cancelTask(subArgs, flags);\r\n      break;\r\n\r\n    case 'workflow':\r\n      await executeWorkflow(subArgs, flags);\r\n      break;\r\n\r\n    case 'coordination':\r\n      await manageCoordination(subArgs, flags);\r\n      break;\r\n\r\n    default:\r\n      showTaskHelp();\r\n  }\r\n}\r\n\r\nasync function createTask(subArgs, flags) {\r\n  // Use commander for robust argument parsing\r\n  const program = new Command()\r\n    .exitOverride()\r\n    .allowUnknownOption()\r\n    .option('--priority <value>', 'Set task priority (1-10)', '5');\r\n\r\n  try {\r\n    // Parse the arguments starting from the create command\r\n    program.parse(subArgs, { from: 'user' });\r\n  } catch (err) {\r\n    // Continue even if commander throws\r\n  }\r\n\r\n  const opts = program.opts();\r\n  const args = program.args;\r\n\r\n  // Extract task type and description with proper quote handling\r\n  const taskType = args[1]; // First arg after 'create'\r\n\r\n  // Join remaining args for description, handling quoted strings properly\r\n  let description = '';\r\n  if (args.length > 2) {\r\n    // If the description starts with a quote, find the matching end quote\r\n    const descriptionArgs = args.slice(2);\r\n    description = parseQuotedDescription(descriptionArgs);\r\n  }\r\n\r\n  if (!taskType || !description) {\r\n    printError('Usage: task create <type> \"<description>\"');\r\n    console.log('Types: research, code, analysis, coordination, general');\r\n    return;\r\n  }\r\n\r\n  const taskId = `task_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;\r\n  const priority = parseInt(opts.priority || '5', 10);\r\n\r\n  // Create the task object\r\n  const task = {\r\n    id: taskId,\r\n    type: taskType,\r\n    description: description,\r\n    priority: priority,\r\n    status: 'queued',\r\n    createdAt: Date.now(),\r\n    assignedTo: null,\r\n    progress: 0\r\n  };\r\n\r\n  // Store task in tasks directory\r\n  const { promises: fs } = await import('fs');\r\n  const path = await import('path');\r\n  \r\n  // Ensure tasks directory exists\r\n  const tasksDir = '.claude-flow/tasks';\r\n  await fs.mkdir(tasksDir, { recursive: true });\r\n  \r\n  // Save task data\r\n  const taskFile = path.join(tasksDir, `${taskId}.json`);\r\n  await fs.writeFile(taskFile, JSON.stringify(task, null, 2));\r\n  \r\n  // Update task queue file\r\n  const queueFile = '.claude-flow/tasks/queue.json';\r\n  let queue = [];\r\n  try {\r\n    const queueData = await fs.readFile(queueFile, 'utf8');\r\n    queue = JSON.parse(queueData);\r\n  } catch (e) {\r\n    // Queue file doesn't exist yet\r\n  }\r\n  \r\n  // Add task to queue (sorted by priority)\r\n  queue.push(task);\r\n  queue.sort((a, b) => b.priority - a.priority);\r\n  await fs.writeFile(queueFile, JSON.stringify(queue, null, 2));\r\n\r\n  printSuccess(`‚úÖ Created ${taskType} task: ${taskId}`);\r\n  console.log(`üìã Description: ${description}`);\r\n  console.log(`‚ö° Priority: ${priority}/10`);\r\n  console.log(`üè∑Ô∏è  Type: ${taskType}`);\r\n  console.log(`üìÖ Status: Queued`);\r\n  console.log(`üìÅ Location: ${taskFile}`);\r\n  console.log(`\\n‚úÖ Task successfully added to queue (${queue.length} total tasks)`);\r\n}\r\n\r\nfunction parseQuotedDescription(args) {\r\n  const fullString = args.join(' ');\r\n\r\n  // Check if it starts with a quote\r\n  if (fullString.startsWith('\"') || fullString.startsWith(\"'\")) {\r\n    const quoteChar = fullString[0];\r\n    const endIndex = fullString.lastIndexOf(quoteChar);\r\n\r\n    if (endIndex > 0) {\r\n      // Extract the quoted content\r\n      return fullString.substring(1, endIndex);\r\n    }\r\n  }\r\n\r\n  // If not quoted or improperly quoted, return the full string\r\n  return fullString;\r\n}\r\n\r\nasync function listTasks(subArgs, flags) {\r\n  const program = new Command()\r\n    .exitOverride()\r\n    .allowUnknownOption()\r\n    .option('--filter <status>', 'Filter by task status')\r\n    .option('--verbose', 'Show detailed output')\r\n    .option('-v', 'Show detailed output');\r\n\r\n  try {\r\n    program.parse(subArgs, { from: 'user' });\r\n  } catch (err) {\r\n    // Continue\r\n  }\r\n\r\n  const opts = program.opts();\r\n  const filter = opts.filter;\r\n  const verbose = opts.verbose || opts.v;\r\n\r\n  const { promises: fs } = await import('fs');\r\n  \r\n  let queue = [];\r\n  try {\r\n    const queueFile = '.claude-flow/tasks/queue.json';\r\n    const queueData = await fs.readFile(queueFile, 'utf8');\r\n    queue = JSON.parse(queueData);\r\n  } catch (e) {\r\n    // Queue file doesn't exist yet\r\n  }\r\n\r\n  // Apply filter if specified\r\n  if (filter) {\r\n    queue = queue.filter(task => task.status === filter);\r\n    console.log(`üìä Filtered by status: ${filter}`);\r\n  }\r\n  \r\n  if (queue.length > 0) {\r\n    printSuccess(`Task queue (${queue.length} tasks):`);\r\n    queue.forEach((task, index) => {\r\n      const statusEmoji = task.status === 'queued' ? '‚è≥' : \r\n                          task.status === 'running' ? 'üîÑ' : \r\n                          task.status === 'completed' ? '‚úÖ' : '‚ùå';\r\n      console.log(`${index + 1}. ${statusEmoji} [${task.type}] ${task.description}`);\r\n      console.log(`   Priority: ${task.priority}/10 | Status: ${task.status}`);\r\n      if (verbose) {\r\n        console.log(`   ID: ${task.id}`);\r\n        console.log(`   Created: ${new Date(task.createdAt).toLocaleString()}`);\r\n      }\r\n      console.log('');\r\n    });\r\n  } else {\r\n    console.log('üìã No tasks in queue' + (filter ? ` with status: ${filter}` : ''));\r\n    console.log('\\nTo create tasks:');\r\n    console.log('  claude-flow task create research \"Market analysis\"');\r\n    console.log('  claude-flow task create code \"Implement API\"');\r\n    console.log('  claude-flow task create analysis \"Data processing\"');\r\n  }\r\n}\r\n\r\nasync function showTaskStatus(subArgs, flags) {\r\n  const taskId = subArgs[1];\r\n\r\n  if (!taskId) {\r\n    printError('Usage: task status <task-id>');\r\n    return;\r\n  }\r\n\r\n  printSuccess(`Task status: ${taskId}`);\r\n  console.log('üìä Task details would include:');\r\n  console.log('   Status, progress, assigned agent, execution time, results');\r\n}\r\n\r\nasync function cancelTask(subArgs, flags) {\r\n  const taskId = subArgs[1];\r\n\r\n  if (!taskId) {\r\n    printError('Usage: task cancel <task-id>');\r\n    return;\r\n  }\r\n\r\n  printSuccess(`Cancelling task: ${taskId}`);\r\n  console.log('üõë Task would be gracefully cancelled');\r\n}\r\n\r\nasync function executeWorkflow(subArgs, flags) {\r\n  const workflowFile = subArgs[1];\r\n\r\n  if (!workflowFile) {\r\n    printError('Usage: task workflow <workflow-file>');\r\n    return;\r\n  }\r\n\r\n  printSuccess(`Executing workflow: ${workflowFile}`);\r\n  console.log('üîÑ Workflow execution would include:');\r\n  console.log('   - Parsing workflow definition');\r\n  console.log('   - Creating dependent tasks');\r\n  console.log('   - Orchestrating execution');\r\n  console.log('   - Progress tracking');\r\n}\r\n\r\nasync function manageCoordination(subArgs, flags) {\r\n  const coordCmd = subArgs[1];\r\n\r\n  switch (coordCmd) {\r\n    case 'status':\r\n      printSuccess('Task coordination status:');\r\n      console.log('üéØ Coordination engine: Not running');\r\n      console.log('   Active coordinators: 0');\r\n      console.log('   Pending tasks: 0');\r\n      console.log('   Resource utilization: 0%');\r\n      break;\r\n\r\n    case 'optimize':\r\n      printSuccess('Optimizing task coordination...');\r\n      console.log('‚ö° Optimization would include:');\r\n      console.log('   - Task dependency analysis');\r\n      console.log('   - Resource allocation optimization');\r\n      console.log('   - Parallel execution planning');\r\n      break;\r\n\r\n    default:\r\n      console.log('Coordination commands: status, optimize');\r\n  }\r\n}\r\n\r\nfunction showTaskHelp() {\r\n  console.log('Task commands:');\r\n  console.log('  create <type> \"<description>\"    Create new task');\r\n  console.log('  list [--filter <status>]        List tasks');\r\n  console.log('  status <id>                      Show task details');\r\n  console.log('  cancel <id>                      Cancel running task');\r\n  console.log('  workflow <file>                  Execute workflow file');\r\n  console.log('  coordination <status|optimize>   Manage coordination');\r\n  console.log();\r\n  console.log('Task Types:');\r\n  console.log('  research      Information gathering and analysis');\r\n  console.log('  code          Software development tasks');\r\n  console.log('  analysis      Data processing and insights');\r\n  console.log('  coordination  Task orchestration and management');\r\n  console.log('  general       General purpose tasks');\r\n  console.log();\r\n  console.log('Options:');\r\n  console.log('  --priority <1-10>                Set task priority');\r\n  console.log('  --filter <status>                Filter by status');\r\n  console.log('  --verbose, -v                    Show detailed output');\r\n  console.log();\r\n  console.log('Examples:');\r\n  console.log('  claude-flow task create research \"Market analysis\" --priority 8');\r\n  console.log('  claude-flow task list --filter running');\r\n  console.log('  claude-flow task workflow examples/development-workflow.json');\r\n  console.log('  claude-flow task coordination status');\r\n}\r\n"],"names":["printSuccess","printError","Command","taskCommand","subArgs","flags","taskCmd","createTask","listTasks","showTaskStatus","cancelTask","executeWorkflow","manageCoordination","showTaskHelp","program","exitOverride","allowUnknownOption","option","parse","from","err","opts","args","taskType","description","length","descriptionArgs","slice","parseQuotedDescription","console","log","taskId","Date","now","Math","random","toString","substr","priority","parseInt","task","id","type","status","createdAt","assignedTo","progress","promises","fs","path","tasksDir","mkdir","recursive","taskFile","join","writeFile","JSON","stringify","queueFile","queue","queueData","readFile","e","push","sort","a","b","fullString","startsWith","quoteChar","endIndex","lastIndexOf","substring","filter","verbose","v","forEach","index","statusEmoji","toLocaleString","workflowFile","coordCmd"],"mappings":"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"}