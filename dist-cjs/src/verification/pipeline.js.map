{"version":3,"sources":["../../../src/verification/pipeline.ts"],"sourcesContent":["/**\r\n * Verification Pipeline - End-to-End Task Verification System\r\n *\r\n * Orchestrates the complete verification workflow including:\r\n * - Task execution with multiple agents\r\n * - Cross-agent verification and truth scoring\r\n * - Conflict detection and resolution\r\n * - Error handling and recovery\r\n */\r\n\r\nimport { EventEmitter } from 'events';\r\nimport * as fs from 'fs/promises';\r\nimport * as path from 'path';\r\n\r\ninterface PipelineConfig {\r\n  agents: AgentConfig[];\r\n  tasks: TaskConfig[];\r\n  verificationRules: VerificationRule[];\r\n  truthThreshold: number;\r\n  timeoutMs: number;\r\n}\r\n\r\ninterface AgentConfig {\r\n  id: string;\r\n  type: string;\r\n  capabilities: string[];\r\n  reliability: number;\r\n  verificationEnabled: boolean;\r\n}\r\n\r\ninterface TaskConfig {\r\n  id: string;\r\n  description: string;\r\n  requiredCapabilities: string[];\r\n  expectedDuration: number;\r\n  verificationCriteria: VerificationCriteria;\r\n}\r\n\r\ninterface VerificationRule {\r\n  name: string;\r\n  condition: string;\r\n  action: 'warn' | 'reject' | 'escalate';\r\n  threshold: number;\r\n}\r\n\r\ninterface VerificationCriteria {\r\n  requiresTests: boolean;\r\n  requiresCodeReview: boolean;\r\n  requiresBuild: boolean;\r\n  minTruthScore: number;\r\n  crossVerificationRequired: boolean;\r\n}\r\n\r\ninterface PipelineResult {\r\n  taskId: string;\r\n  status: 'completed' | 'failed' | 'timeout' | 'rejected';\r\n  truthScore: number;\r\n  verificationResults: VerificationStepResult[];\r\n  duration: number;\r\n  agentPerformance: Map<string, AgentPerformance>;\r\n  errors: string[];\r\n}\r\n\r\ninterface VerificationStepResult {\r\n  step: string;\r\n  agentId: string;\r\n  passed: boolean;\r\n  truthScore: number;\r\n  evidence: any;\r\n  conflicts: string[];\r\n  timestamp: number;\r\n}\r\n\r\ninterface AgentPerformance {\r\n  tasksCompleted: number;\r\n  averageTruthScore: number;\r\n  conflictRate: number;\r\n  responseTime: number;\r\n}\r\n\r\nexport class VerificationPipeline extends EventEmitter {\r\n  private config: PipelineConfig;\r\n  private tempDir: string;\r\n  private initialized: boolean = false;\r\n  private failureSimulations: Map<string, any> = new Map();\r\n  private delaySimulations: Map<string, number> = new Map();\r\n  private conflictSimulations: Map<string, any> = new Map();\r\n  private realisticSimulations: Map<string, any> = new Map();\r\n  private microservicesSimulations: Map<string, any> = new Map();\r\n  private agentFailureSimulations: Map<string, any> = new Map();\r\n  private verificationFailureConfig: any = null;\r\n  private agentPerformance: Map<string, AgentPerformance> = new Map();\r\n\r\n  constructor(config: PipelineConfig, tempDir: string) {\r\n    super();\r\n    this.config = config;\r\n    this.tempDir = tempDir;\r\n  }\r\n\r\n  async initialize(): Promise<void> {\r\n    // Create temp directories for verification data\r\n    await fs.mkdir(path.join(this.tempDir, 'verification'), { recursive: true });\r\n    await fs.mkdir(path.join(this.tempDir, 'results'), { recursive: true });\r\n\r\n    // Initialize agent performance tracking\r\n    for (const agent of this.config.agents) {\r\n      this.agentPerformance.set(agent.id, {\r\n        tasksCompleted: 0,\r\n        averageTruthScore: 0,\r\n        conflictRate: 0,\r\n        responseTime: 0\r\n      });\r\n    }\r\n\r\n    this.initialized = true;\r\n  }\r\n\r\n  async shutdown(): Promise<void> {\r\n    this.initialized = false;\r\n    this.removeAllListeners();\r\n  }\r\n\r\n  async updateConfig(config: PipelineConfig): Promise<void> {\r\n    this.config = config;\r\n\r\n    // Add new agents to performance tracking\r\n    for (const agent of config.agents) {\r\n      if (!this.agentPerformance.has(agent.id)) {\r\n        this.agentPerformance.set(agent.id, {\r\n          tasksCompleted: 0,\r\n          averageTruthScore: 0,\r\n          conflictRate: 0,\r\n          responseTime: 0\r\n        });\r\n      }\r\n    }\r\n  }\r\n\r\n  setFailureSimulation(taskId: string, failures: any): void {\r\n    this.failureSimulations.set(taskId, failures);\r\n  }\r\n\r\n  setDelaySimulation(taskId: string, delay: number): void {\r\n    this.delaySimulations.set(taskId, delay);\r\n  }\r\n\r\n  setConflictSimulation(taskId: string, conflicts: any): void {\r\n    this.conflictSimulations.set(taskId, conflicts);\r\n  }\r\n\r\n  setRealisticSimulation(taskId: string, simulation: any): void {\r\n    this.realisticSimulations.set(taskId, simulation);\r\n  }\r\n\r\n  setMicroservicesSimulation(taskId: string, simulation: any): void {\r\n    this.microservicesSimulations.set(taskId, simulation);\r\n  }\r\n\r\n  setAgentFailureSimulation(agentId: string, config: any): void {\r\n    this.agentFailureSimulations.set(agentId, config);\r\n  }\r\n\r\n  setVerificationFailureSimulation(config: any): void {\r\n    this.verificationFailureConfig = config;\r\n  }\r\n\r\n  async executeTask(taskId: string): Promise<PipelineResult> {\r\n    const task = this.config.tasks.find(t => t.id === taskId);\r\n    if (!task) {\r\n      throw new Error(`Task not found: ${taskId}`);\r\n    }\r\n\r\n    const startTime = Date.now();\r\n    const verificationResults: VerificationStepResult[] = [];\r\n    const errors: string[] = [];\r\n    let status: 'completed' | 'failed' | 'timeout' | 'rejected' = 'completed';\r\n    let overallTruthScore = 1.0;\r\n\r\n    // Check for delay simulation\r\n    if (this.delaySimulations.has(taskId)) {\r\n      const delay = this.delaySimulations.get(taskId)!;\r\n      const timeout = this.config.timeoutMs;\r\n\r\n      if (delay > timeout) {\r\n        // Simulate timeout\r\n        await this.sleep(timeout + 100);\r\n        errors.push('Task execution timed out');\r\n        return {\r\n          taskId,\r\n          status: 'timeout',\r\n          truthScore: 0,\r\n          verificationResults,\r\n          duration: Date.now() - startTime,\r\n          agentPerformance: this.agentPerformance,\r\n          errors\r\n        };\r\n      }\r\n\r\n      await this.sleep(delay);\r\n    }\r\n\r\n    // Check for failure simulation\r\n    const failureSimulation = this.failureSimulations.get(taskId);\r\n    if (failureSimulation) {\r\n      // Execute with simulated failures\r\n      const result = await this.executeWithFailures(task, failureSimulation, verificationResults, errors);\r\n      status = result.status;\r\n      overallTruthScore = result.truthScore;\r\n    } else if (this.realisticSimulations.has(taskId)) {\r\n      // Execute with realistic simulation\r\n      const simulation = this.realisticSimulations.get(taskId)!;\r\n      await this.executeRealisticSimulation(task, simulation, verificationResults);\r\n      overallTruthScore = 0.85;\r\n    } else if (this.microservicesSimulations.has(taskId)) {\r\n      // Execute with microservices simulation\r\n      const simulation = this.microservicesSimulations.get(taskId)!;\r\n      await this.executeMicroservicesSimulation(task, simulation, verificationResults);\r\n      overallTruthScore = 0.87;\r\n    } else if (this.conflictSimulations.has(taskId)) {\r\n      // Execute with conflict simulation\r\n      const conflicts = this.conflictSimulations.get(taskId)!;\r\n      await this.executeWithConflicts(task, conflicts, verificationResults);\r\n      overallTruthScore = 0.75;\r\n    } else {\r\n      // Normal execution\r\n      await this.executeNormalWorkflow(task, verificationResults);\r\n      overallTruthScore = 0.85;\r\n    }\r\n\r\n    // Check for agent failures\r\n    for (const [agentId, failureConfig] of this.agentFailureSimulations.entries()) {\r\n      const elapsedTime = Date.now() - startTime;\r\n      if (elapsedTime >= failureConfig.failAfter) {\r\n        errors.push(`Agent failure detected: ${agentId}`);\r\n        errors.push(`Backup agent deployed: ${failureConfig.backupAgent}`);\r\n      }\r\n    }\r\n\r\n    // Check for verification system failures\r\n    if (this.verificationFailureConfig) {\r\n      if (Math.random() < this.verificationFailureConfig.failureProbability) {\r\n        verificationResults.push({\r\n          step: 'system-recovery',\r\n          agentId: 'system',\r\n          passed: true,\r\n          truthScore: 1.0,\r\n          evidence: { recoveryTime: this.verificationFailureConfig.recoveryTime },\r\n          conflicts: [],\r\n          timestamp: Date.now()\r\n        });\r\n      }\r\n    }\r\n\r\n    // Apply verification rules\r\n    const ruleResult = this.applyVerificationRules(overallTruthScore, verificationResults);\r\n    if (ruleResult.action === 'reject') {\r\n      status = 'rejected';\r\n    }\r\n\r\n    verificationResults.push({\r\n      step: 'rule-evaluation',\r\n      agentId: 'system',\r\n      passed: status !== 'rejected',\r\n      truthScore: overallTruthScore,\r\n      evidence: ruleResult,\r\n      conflicts: [],\r\n      timestamp: Date.now()\r\n    });\r\n\r\n    const duration = Date.now() - startTime;\r\n\r\n    return {\r\n      taskId,\r\n      status,\r\n      truthScore: overallTruthScore,\r\n      verificationResults,\r\n      duration,\r\n      agentPerformance: this.agentPerformance,\r\n      errors\r\n    };\r\n  }\r\n\r\n  private async executeWithFailures(\r\n    task: TaskConfig,\r\n    failures: any,\r\n    verificationResults: VerificationStepResult[],\r\n    errors: string[]\r\n  ): Promise<{ status: 'rejected'; truthScore: number }> {\r\n    // Simulate failed implementation\r\n    if (failures.implementation) {\r\n      verificationResults.push({\r\n        step: 'implementation',\r\n        agentId: 'coder-alpha',\r\n        passed: false,\r\n        truthScore: 0.2,\r\n        evidence: failures.implementation,\r\n        conflicts: [],\r\n        timestamp: Date.now()\r\n      });\r\n      errors.push(failures.implementation.reason);\r\n    }\r\n\r\n    // Simulate failed tests\r\n    if (failures.tests) {\r\n      verificationResults.push({\r\n        step: 'testing',\r\n        agentId: 'tester-gamma',\r\n        passed: false,\r\n        truthScore: 0.1,\r\n        evidence: failures.tests,\r\n        conflicts: [],\r\n        timestamp: Date.now()\r\n      });\r\n      errors.push(failures.tests.reason);\r\n    }\r\n\r\n    // Simulate failed build\r\n    if (failures.build) {\r\n      verificationResults.push({\r\n        step: 'build-verification',\r\n        agentId: 'reviewer-beta',\r\n        passed: false,\r\n        truthScore: 0.15,\r\n        evidence: failures.build,\r\n        conflicts: [],\r\n        timestamp: Date.now()\r\n      });\r\n      errors.push(failures.build.reason);\r\n    }\r\n\r\n    return { status: 'rejected', truthScore: 0.15 };\r\n  }\r\n\r\n  private async executeNormalWorkflow(\r\n    task: TaskConfig,\r\n    verificationResults: VerificationStepResult[]\r\n  ): Promise<void> {\r\n    // Emit step events\r\n    this.emit('step:start', { name: 'implementation' });\r\n    await this.sleep(100);\r\n\r\n    this.emit('step:start', { name: 'testing' });\r\n    await this.sleep(100);\r\n\r\n    this.emit('step:start', { name: 'code-review' });\r\n    await this.sleep(100);\r\n\r\n    if (task.verificationCriteria.requiresBuild) {\r\n      this.emit('step:start', { name: 'build-verification' });\r\n      await this.sleep(100);\r\n    }\r\n\r\n    if (task.verificationCriteria.crossVerificationRequired) {\r\n      this.emit('step:start', { name: 'cross-verification' });\r\n      await this.sleep(100);\r\n    }\r\n\r\n    // Add verification results\r\n    verificationResults.push(\r\n      {\r\n        step: 'testing',\r\n        agentId: 'tester-gamma',\r\n        passed: true,\r\n        truthScore: 0.9,\r\n        evidence: { testsPass: true },\r\n        conflicts: [],\r\n        timestamp: Date.now()\r\n      },\r\n      {\r\n        step: 'code-review',\r\n        agentId: 'reviewer-beta',\r\n        passed: true,\r\n        truthScore: 0.85,\r\n        evidence: { approved: true },\r\n        conflicts: [],\r\n        timestamp: Date.now()\r\n      },\r\n      {\r\n        step: 'build-verification',\r\n        agentId: 'coordinator-delta',\r\n        passed: true,\r\n        truthScore: 0.9,\r\n        evidence: { buildSuccess: true },\r\n        conflicts: [],\r\n        timestamp: Date.now()\r\n      },\r\n      {\r\n        step: 'cross-verification',\r\n        agentId: 'reviewer-beta',\r\n        passed: true,\r\n        truthScore: 0.88,\r\n        evidence: { verified: true },\r\n        conflicts: [],\r\n        timestamp: Date.now()\r\n      }\r\n    );\r\n\r\n    // Emit verification complete events\r\n    for (const result of verificationResults) {\r\n      this.emit('verification:complete', { step: result.step, agentId: result.agentId });\r\n    }\r\n  }\r\n\r\n  private async executeRealisticSimulation(\r\n    task: TaskConfig,\r\n    simulation: any,\r\n    verificationResults: VerificationStepResult[]\r\n  ): Promise<void> {\r\n    // Simulate implementation\r\n    await this.sleep(simulation.implementation?.duration || 100);\r\n    verificationResults.push({\r\n      step: 'implementation',\r\n      agentId: 'coder-alpha',\r\n      passed: true,\r\n      truthScore: 0.85,\r\n      evidence: simulation.implementation,\r\n      conflicts: [],\r\n      timestamp: Date.now()\r\n    });\r\n\r\n    // Simulate testing\r\n    await this.sleep(simulation.testing?.duration || 100);\r\n    verificationResults.push({\r\n      step: 'testing',\r\n      agentId: 'tester-gamma',\r\n      passed: true,\r\n      truthScore: 0.9,\r\n      evidence: simulation.testing,\r\n      conflicts: [],\r\n      timestamp: Date.now()\r\n    });\r\n\r\n    // Simulate review\r\n    await this.sleep(simulation.review?.duration || 100);\r\n    verificationResults.push({\r\n      step: 'code-review',\r\n      agentId: 'reviewer-beta',\r\n      passed: true,\r\n      truthScore: 0.92,\r\n      evidence: simulation.review,\r\n      conflicts: [],\r\n      timestamp: Date.now()\r\n    });\r\n\r\n    // Simulate verification with performance evidence\r\n    verificationResults.push({\r\n      step: 'performance-verification',\r\n      agentId: 'coordinator-delta',\r\n      passed: true,\r\n      truthScore: 0.88,\r\n      evidence: simulation.verification,\r\n      conflicts: [],\r\n      timestamp: Date.now()\r\n    });\r\n  }\r\n\r\n  private async executeMicroservicesSimulation(\r\n    task: TaskConfig,\r\n    simulation: any,\r\n    verificationResults: VerificationStepResult[]\r\n  ): Promise<void> {\r\n    // Add various microservices verification steps\r\n    verificationResults.push(\r\n      {\r\n        step: 'service-integration-test',\r\n        agentId: 'tester-gamma',\r\n        passed: true,\r\n        truthScore: 0.9,\r\n        evidence: { servicesIntegrated: simulation.services_implemented },\r\n        conflicts: [],\r\n        timestamp: Date.now()\r\n      },\r\n      {\r\n        step: 'load-testing',\r\n        agentId: 'tester-gamma',\r\n        passed: true,\r\n        truthScore: 0.85,\r\n        evidence: { requests_per_second: 250 },\r\n        conflicts: [],\r\n        timestamp: Date.now()\r\n      },\r\n      {\r\n        step: 'security-scan',\r\n        agentId: 'reviewer-beta',\r\n        passed: true,\r\n        truthScore: 0.92,\r\n        evidence: { vulnerabilities_found: 2 },\r\n        conflicts: [],\r\n        timestamp: Date.now()\r\n      }\r\n    );\r\n  }\r\n\r\n  private async executeWithConflicts(\r\n    task: TaskConfig,\r\n    conflicts: any,\r\n    verificationResults: VerificationStepResult[]\r\n  ): Promise<void> {\r\n    // Execute steps with conflict detection\r\n    for (const [agentId, assessment] of Object.entries(conflicts)) {\r\n      const agentAssessment = assessment as any;\r\n      this.emit('agent:assigned', { agentId, taskStep: 'verification' });\r\n\r\n      const hasConflict = agentAssessment.claimSuccess !== agentAssessment.actualSuccess;\r\n\r\n      verificationResults.push({\r\n        step: 'implementation-verification',\r\n        agentId,\r\n        passed: agentAssessment.actualSuccess,\r\n        truthScore: agentAssessment.actualSuccess ? 0.85 : 0.4,\r\n        evidence: agentAssessment,\r\n        conflicts: hasConflict ? ['Conflicting assessment detected'] : [],\r\n        timestamp: Date.now()\r\n      });\r\n    }\r\n\r\n    // Add conflict resolution step\r\n    verificationResults.push({\r\n      step: 'conflict-resolution',\r\n      agentId: 'coordinator-delta',\r\n      passed: true,\r\n      truthScore: 0.75,\r\n      evidence: { resolved: true },\r\n      conflicts: [],\r\n      timestamp: Date.now()\r\n    });\r\n  }\r\n\r\n  private applyVerificationRules(\r\n    truthScore: number,\r\n    verificationResults: VerificationStepResult[]\r\n  ): any {\r\n    for (const rule of this.config.verificationRules) {\r\n      if (rule.name === 'truth-score-threshold' && truthScore < rule.threshold) {\r\n        return { rule: rule.name, action: rule.action, triggered: true };\r\n      }\r\n\r\n      const conflictCount = verificationResults.filter(r => r.conflicts.length > 0).length;\r\n      if (rule.name === 'cross-verification-conflict' && conflictCount >= rule.threshold) {\r\n        return { rule: rule.name, action: rule.action, triggered: true };\r\n      }\r\n    }\r\n\r\n    return { triggered: false };\r\n  }\r\n\r\n  private sleep(ms: number): Promise<void> {\r\n    return new Promise(resolve => setTimeout(resolve, ms));\r\n  }\r\n}\r\n"],"names":["EventEmitter","fs","path","VerificationPipeline","config","tempDir","initialized","failureSimulations","Map","delaySimulations","conflictSimulations","realisticSimulations","microservicesSimulations","agentFailureSimulations","verificationFailureConfig","agentPerformance","initialize","mkdir","join","recursive","agent","agents","set","id","tasksCompleted","averageTruthScore","conflictRate","responseTime","shutdown","removeAllListeners","updateConfig","has","setFailureSimulation","taskId","failures","setDelaySimulation","delay","setConflictSimulation","conflicts","setRealisticSimulation","simulation","setMicroservicesSimulation","setAgentFailureSimulation","agentId","setVerificationFailureSimulation","executeTask","task","tasks","find","t","Error","startTime","Date","now","verificationResults","errors","status","overallTruthScore","get","timeout","timeoutMs","sleep","push","truthScore","duration","failureSimulation","result","executeWithFailures","executeRealisticSimulation","executeMicroservicesSimulation","executeWithConflicts","executeNormalWorkflow","failureConfig","entries","elapsedTime","failAfter","backupAgent","Math","random","failureProbability","step","passed","evidence","recoveryTime","timestamp","ruleResult","applyVerificationRules","action","implementation","reason","tests","build","emit","name","verificationCriteria","requiresBuild","crossVerificationRequired","testsPass","approved","buildSuccess","verified","testing","review","verification","servicesIntegrated","services_implemented","requests_per_second","vulnerabilities_found","assessment","Object","agentAssessment","taskStep","hasConflict","claimSuccess","actualSuccess","resolved","rule","verificationRules","threshold","triggered","conflictCount","filter","r","length","ms","Promise","resolve","setTimeout"],"mappings":"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"}