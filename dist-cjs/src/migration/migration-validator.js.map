{"version":3,"sources":["../../../src/migration/migration-validator.ts"],"sourcesContent":["/**\r\n * Migration Validator - Validates successful migration\r\n */\r\n\r\nimport * as fs from 'fs-extra';\r\nimport * as path from 'path';\r\nimport type { ValidationResult, ValidationCheck } from './types.js';\r\nimport { logger } from './logger.js';\r\nimport * as chalk from 'chalk';\r\nimport { glob } from 'glob';\r\n\r\nexport class MigrationValidator {\r\n  private requiredFiles = [\r\n    '.claude/commands/sparc.md',\r\n    '.claude/commands/claude-flow-help.md',\r\n    '.claude/commands/claude-flow-memory.md',\r\n    '.claude/BATCHTOOLS_GUIDE.md',\r\n    '.claude/BATCHTOOLS_BEST_PRACTICES.md',\r\n  ];\r\n\r\n  private requiredCommands = [\r\n    'sparc',\r\n    'sparc-architect',\r\n    'sparc-code',\r\n    'sparc-tdd',\r\n    'claude-flow-help',\r\n    'claude-flow-memory',\r\n    'claude-flow-swarm',\r\n  ];\r\n\r\n  async validate(projectPath: string): Promise<ValidationResult> {\r\n    const result: ValidationResult = {\r\n      valid: true,\r\n      checks: [],\r\n      errors: [],\r\n      warnings: [],\r\n    };\r\n\r\n    // Check file structure\r\n    await this.validateFileStructure(projectPath, result);\r\n\r\n    // Check command files\r\n    await this.validateCommandFiles(projectPath, result);\r\n\r\n    // Check configuration files\r\n    await this.validateConfiguration(projectPath, result);\r\n\r\n    // Check file integrity\r\n    await this.validateFileIntegrity(projectPath, result);\r\n\r\n    // Check functionality\r\n    await this.validateFunctionality(projectPath, result);\r\n\r\n    // Overall validation\r\n    result.valid = result.errors.length === 0;\r\n\r\n    return result;\r\n  }\r\n\r\n  private async validateFileStructure(\r\n    projectPath: string,\r\n    result: ValidationResult,\r\n  ): Promise<void> {\r\n    const check: ValidationCheck = {\r\n      name: 'File Structure',\r\n      passed: true,\r\n    };\r\n\r\n    // Check .claude directory exists\r\n    const claudePath = path.join(projectPath, '.claude');\r\n    if (!(await fs.pathExists(claudePath))) {\r\n      check.passed = false;\r\n      result.errors.push('.claude directory not found');\r\n    }\r\n\r\n    // Check commands directory\r\n    const commandsPath = path.join(claudePath, 'commands');\r\n    if (!(await fs.pathExists(commandsPath))) {\r\n      check.passed = false;\r\n      result.errors.push('.claude/commands directory not found');\r\n    }\r\n\r\n    // Check required files\r\n    for (const file of this.requiredFiles) {\r\n      const filePath = path.join(projectPath, file);\r\n      if (!(await fs.pathExists(filePath))) {\r\n        check.passed = false;\r\n        result.errors.push(`Required file missing: ${file}`);\r\n      }\r\n    }\r\n\r\n    result.checks.push(check);\r\n  }\r\n\r\n  private async validateCommandFiles(projectPath: string, result: ValidationResult): Promise<void> {\r\n    const check: ValidationCheck = {\r\n      name: 'Command Files',\r\n      passed: true,\r\n    };\r\n\r\n    const commandsPath = path.join(projectPath, '.claude/commands');\r\n\r\n    if (await fs.pathExists(commandsPath)) {\r\n      for (const command of this.requiredCommands) {\r\n        const commandFile = path.join(commandsPath, `${command}.md`);\r\n        const sparcCommandFile = path.join(\r\n          commandsPath,\r\n          'sparc',\r\n          `${command.replace('sparc-', '')}.md`,\r\n        );\r\n\r\n        const hasMainFile = await fs.pathExists(commandFile);\r\n        const hasSparcFile = await fs.pathExists(sparcCommandFile);\r\n\r\n        if (!hasMainFile && !hasSparcFile) {\r\n          check.passed = false;\r\n          result.errors.push(`Command file missing: ${command}.md`);\r\n        } else {\r\n          // Validate file content\r\n          const filePath = hasMainFile ? commandFile : sparcCommandFile;\r\n          await this.validateCommandFileContent(filePath, command, result);\r\n        }\r\n      }\r\n    } else {\r\n      check.passed = false;\r\n      result.errors.push('Commands directory not found');\r\n    }\r\n\r\n    result.checks.push(check);\r\n  }\r\n\r\n  private async validateCommandFileContent(\r\n    filePath: string,\r\n    command: string,\r\n    result: ValidationResult,\r\n  ): Promise<void> {\r\n    try {\r\n      const content = await fs.readFile(filePath, 'utf-8');\r\n\r\n      // Check for minimum content requirements\r\n      const hasDescription = content.includes('description') || content.includes('Description');\r\n      const hasInstructions = content.length > 100; // Minimum content length\r\n\r\n      if (!hasDescription) {\r\n        result.warnings.push(`Command ${command} may be missing description`);\r\n      }\r\n\r\n      if (!hasInstructions) {\r\n        result.warnings.push(`Command ${command} may have insufficient content`);\r\n      }\r\n\r\n      // Check for optimization indicators\r\n      const hasOptimizedContent =\r\n        content.includes('optimization') ||\r\n        content.includes('performance') ||\r\n        content.includes('efficient');\r\n\r\n      if (!hasOptimizedContent && command.includes('sparc')) {\r\n        result.warnings.push(`SPARC command ${command} may not be optimized`);\r\n      }\r\n    } catch (error) {\r\n      result.errors.push(\r\n        `Failed to validate ${command}: ${error instanceof Error ? error.message : String(error)}`,\r\n      );\r\n    }\r\n  }\r\n\r\n  private async validateConfiguration(\r\n    projectPath: string,\r\n    result: ValidationResult,\r\n  ): Promise<void> {\r\n    const check: ValidationCheck = {\r\n      name: 'Configuration Files',\r\n      passed: true,\r\n    };\r\n\r\n    // Check CLAUDE.md\r\n    const claudeMdPath = path.join(projectPath, 'CLAUDE.md');\r\n    if (await fs.pathExists(claudeMdPath)) {\r\n      const content = await fs.readFile(claudeMdPath, 'utf-8');\r\n\r\n      // Check for SPARC configuration\r\n      if (!content.includes('SPARC')) {\r\n        result.warnings.push('CLAUDE.md may not include SPARC configuration');\r\n      }\r\n\r\n      // Check for key sections\r\n      const requiredSections = ['Project Overview', 'SPARC Development', 'Memory Integration'];\r\n\r\n      for (const section of requiredSections) {\r\n        if (!content.includes(section)) {\r\n          result.warnings.push(`CLAUDE.md missing section: ${section}`);\r\n        }\r\n      }\r\n    } else {\r\n      result.warnings.push('CLAUDE.md not found');\r\n    }\r\n\r\n    // Check .roomodes\r\n    const roomodesPath = path.join(projectPath, '.roomodes');\r\n    if (await fs.pathExists(roomodesPath)) {\r\n      try {\r\n        const roomodes = await fs.readJson(roomodesPath);\r\n        const requiredModes = ['architect', 'code', 'tdd', 'debug'];\r\n\r\n        for (const mode of requiredModes) {\r\n          if (!roomodes[mode]) {\r\n            result.warnings.push(`Missing SPARC mode: ${mode}`);\r\n          }\r\n        }\r\n      } catch (error) {\r\n        result.errors.push(\r\n          `Invalid .roomodes file: ${error instanceof Error ? error.message : String(error)}`,\r\n        );\r\n        check.passed = false;\r\n      }\r\n    }\r\n\r\n    result.checks.push(check);\r\n  }\r\n\r\n  private async validateFileIntegrity(\r\n    projectPath: string,\r\n    result: ValidationResult,\r\n  ): Promise<void> {\r\n    const check: ValidationCheck = {\r\n      name: 'File Integrity',\r\n      passed: true,\r\n    };\r\n\r\n    // Check for corrupted files\r\n    const claudePath = path.join(projectPath, '.claude');\r\n    if (await fs.pathExists(claudePath)) {\r\n      const files = await glob('**/*.md', { cwd: claudePath });\r\n\r\n      for (const file of files) {\r\n        try {\r\n          const content = await fs.readFile(path.join(claudePath, file), 'utf-8');\r\n\r\n          // Basic integrity checks\r\n          if (content.length === 0) {\r\n            result.errors.push(`Empty file: ${file}`);\r\n            check.passed = false;\r\n          }\r\n\r\n          // Check for binary data in text files\r\n          if (content.includes('\\0')) {\r\n            result.errors.push(`Corrupted text file: ${file}`);\r\n            check.passed = false;\r\n          }\r\n        } catch (error) {\r\n          result.errors.push(\r\n            `Cannot read file ${file}: ${error instanceof Error ? error.message : String(error)}`,\r\n          );\r\n          check.passed = false;\r\n        }\r\n      }\r\n    }\r\n\r\n    result.checks.push(check);\r\n  }\r\n\r\n  private async validateFunctionality(\r\n    projectPath: string,\r\n    result: ValidationResult,\r\n  ): Promise<void> {\r\n    const check: ValidationCheck = {\r\n      name: 'Functionality',\r\n      passed: true,\r\n    };\r\n\r\n    // Check directory permissions\r\n    const claudePath = path.join(projectPath, '.claude');\r\n    if (await fs.pathExists(claudePath)) {\r\n      try {\r\n        // Test write permissions\r\n        const testFile = path.join(claudePath, '.test-write');\r\n        await fs.writeFile(testFile, 'test');\r\n        await fs.remove(testFile);\r\n      } catch (error) {\r\n        result.warnings.push('.claude directory may not be writable');\r\n      }\r\n    }\r\n\r\n    // Check for potential conflicts\r\n    const packageJsonPath = path.join(projectPath, 'package.json');\r\n    if (await fs.pathExists(packageJsonPath)) {\r\n      try {\r\n        const packageJson = await fs.readJson(packageJsonPath);\r\n\r\n        // Check for script conflicts\r\n        const scripts = packageJson.scripts || {};\r\n        const conflictingScripts = Object.keys(scripts).filter(\r\n          (script) => script.startsWith('claude-flow') || script.startsWith('sparc'),\r\n        );\r\n\r\n        if (conflictingScripts.length > 0) {\r\n          result.warnings.push(`Potential script conflicts: ${conflictingScripts.join(', ')}`);\r\n        }\r\n      } catch (error) {\r\n        result.warnings.push('Could not validate package.json');\r\n      }\r\n    }\r\n\r\n    result.checks.push(check);\r\n  }\r\n\r\n  printValidation(validation: ValidationResult): void {\r\n    console.log(chalk.bold('\\n‚úÖ Migration Validation Report'));\r\n    console.log(chalk.gray('‚îÄ'.repeat(50)));\r\n\r\n    console.log(\r\n      `\\n${chalk.bold('Overall Status:')} ${validation.valid ? chalk.green('‚úì Valid') : chalk.red('‚úó Invalid')}`,\r\n    );\r\n\r\n    // Show checks\r\n    console.log(chalk.bold('\\nüìã Validation Checks:'));\r\n    validation.checks.forEach((check) => {\r\n      const status = check.passed ? chalk.green('‚úì') : chalk.red('‚úó');\r\n      console.log(`  ${status} ${check.name}`);\r\n      if (check.message) {\r\n        console.log(`     ${chalk.gray(check.message)}`);\r\n      }\r\n    });\r\n\r\n    // Show errors\r\n    if (validation.errors.length > 0) {\r\n      console.log(chalk.bold('\\n‚ùå Errors:'));\r\n      validation.errors.forEach((error) => {\r\n        console.log(`  ‚Ä¢ ${chalk.red(error)}`);\r\n      });\r\n    }\r\n\r\n    // Show warnings\r\n    if (validation.warnings.length > 0) {\r\n      console.log(chalk.bold('\\n‚ö†Ô∏è  Warnings:'));\r\n      validation.warnings.forEach((warning) => {\r\n        console.log(`  ‚Ä¢ ${chalk.yellow(warning)}`);\r\n      });\r\n    }\r\n\r\n    console.log(chalk.gray('\\n' + '‚îÄ'.repeat(50)));\r\n\r\n    if (validation.valid) {\r\n      console.log(\r\n        chalk.green(\r\n          '\\nüéâ Migration validation passed! Your project is ready to use optimized prompts.',\r\n        ),\r\n      );\r\n    } else {\r\n      console.log(chalk.red('\\n‚ö†Ô∏è  Migration validation failed. Please address the errors above.'));\r\n    }\r\n  }\r\n}\r\n"],"names":["fs","path","chalk","glob","MigrationValidator","requiredFiles","requiredCommands","validate","projectPath","result","valid","checks","errors","warnings","validateFileStructure","validateCommandFiles","validateConfiguration","validateFileIntegrity","validateFunctionality","length","check","name","passed","claudePath","join","pathExists","push","commandsPath","file","filePath","command","commandFile","sparcCommandFile","replace","hasMainFile","hasSparcFile","validateCommandFileContent","content","readFile","hasDescription","includes","hasInstructions","hasOptimizedContent","error","Error","message","String","claudeMdPath","requiredSections","section","roomodesPath","roomodes","readJson","requiredModes","mode","files","cwd","testFile","writeFile","remove","packageJsonPath","packageJson","scripts","conflictingScripts","Object","keys","filter","script","startsWith","printValidation","validation","console","log","bold","gray","repeat","green","red","forEach","status","warning","yellow"],"mappings":"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"}