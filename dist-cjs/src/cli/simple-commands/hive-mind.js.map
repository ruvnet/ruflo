{"version":3,"sources":["../../../../src/cli/simple-commands/hive-mind.js"],"sourcesContent":["/**\r\n * Hive Mind command for Claude-Flow v2.0.0\r\n * Advanced swarm intelligence with collective decision-making\r\n */\r\n\r\nimport { spawn } from 'child_process';\r\nimport { existsSync, mkdirSync } from 'fs';\r\nimport { writeFile, readFile } from 'fs/promises';\r\nimport path from 'path';\r\nimport readline from 'readline';\r\nimport inquirer from 'inquirer';\r\nimport chalk from 'chalk';\r\nimport ora from 'ora';\r\nimport { args, cwd, exit, writeTextFile, readTextFile, mkdirAsync } from '../node-compat.js';\r\nimport {\r\n  isInteractive,\r\n  isRawModeSupported,\r\n  warnNonInteractive,\r\n  checkNonInteractiveAuth,\r\n} from '../utils/interactive-detector.js';\r\nimport {\r\n  safeInteractive,\r\n  nonInteractiveProgress,\r\n  nonInteractiveSelect,\r\n} from '../utils/safe-interactive.js';\r\n\r\n// Import SQLite for persistence\r\nimport Database from 'better-sqlite3';\r\n\r\n// Import help formatter\r\nimport { HelpFormatter } from '../help-formatter.js';\r\n\r\n// Import MCP tool wrappers\r\nimport { MCPToolWrapper } from './hive-mind/mcp-wrapper.js';\r\nimport { HiveMindCore } from './hive-mind/core.js';\r\nimport { QueenCoordinator } from './hive-mind/queen.js';\r\nimport { CollectiveMemory } from './hive-mind/memory.js';\r\nimport { SwarmCommunication } from './hive-mind/communication.js';\r\nimport { HiveMindSessionManager } from './hive-mind/session-manager.js';\r\nimport { createAutoSaveMiddleware } from './hive-mind/auto-save-middleware.js';\r\nimport { HiveMindMetricsReader } from './hive-mind/metrics-reader.js';\r\n\r\nfunction showHiveMindHelp() {\r\n  console.log(`\r\n${chalk.yellow('üß† Claude Flow Hive Mind System')}\r\n\r\n${chalk.bold('USAGE:')}\r\n  claude-flow hive-mind [subcommand] [options]\r\n\r\n${chalk.bold('SUBCOMMANDS:')}\r\n  ${chalk.green('init')}         Initialize hive mind system\r\n  ${chalk.green('spawn')}        Spawn hive mind swarm for a task\r\n  ${chalk.green('status')}       Show hive mind status\r\n  ${chalk.green('resume')}       Resume a paused hive mind session\r\n  ${chalk.green('stop')}         Stop a running hive mind session\r\n  ${chalk.green('sessions')}     List all hive mind sessions\r\n  ${chalk.green('consensus')}    View consensus decisions\r\n  ${chalk.green('memory')}       Manage collective memory\r\n  ${chalk.green('metrics')}      View performance metrics\r\n  ${chalk.green('wizard')}       Interactive hive mind wizard with Claude Code spawning\r\n\r\n${chalk.bold('EXAMPLES:')}\r\n  ${chalk.gray('# Initialize hive mind')}\r\n  claude-flow hive-mind init\r\n\r\n  ${chalk.gray('# Spawn swarm with interactive wizard')}\r\n  claude-flow hive-mind spawn\r\n\r\n  ${chalk.gray('# Quick spawn with objective')}\r\n  claude-flow hive-mind spawn \"Build microservices architecture\"\r\n\r\n  ${chalk.gray('# View current status')}\r\n  claude-flow hive-mind status\r\n\r\n  ${chalk.gray('# Interactive wizard with Claude Code spawning')}\r\n  claude-flow hive-mind wizard\r\n\r\n  ${chalk.gray('# Spawn with Claude Code coordination')}\r\n  claude-flow hive-mind spawn \"Build REST API\" --claude\r\n\r\n  ${chalk.gray('# Auto-spawn coordinated Claude Code instances')}\r\n  claude-flow hive-mind spawn \"Research AI trends\" --auto-spawn --verbose\r\n\r\n  ${chalk.gray('# List all sessions')}\r\n  claude-flow hive-mind sessions\r\n\r\n  ${chalk.gray('# Resume a paused session')}\r\n  claude-flow hive-mind resume session-1234567890-abc123\r\n\r\n${chalk.bold('KEY FEATURES:')}\r\n  ${chalk.cyan('üêù')} Queen-led coordination with worker specialization\r\n  ${chalk.cyan('üß†')} Collective memory and knowledge sharing\r\n  ${chalk.cyan('ü§ù')} Consensus building for critical decisions\r\n  ${chalk.cyan('‚ö°')} Parallel task execution with auto-scaling\r\n  ${chalk.cyan('üîÑ')} Work stealing and load balancing\r\n  ${chalk.cyan('üìä')} Real-time metrics and performance tracking\r\n  ${chalk.cyan('üõ°Ô∏è')} Fault tolerance and self-healing\r\n  ${chalk.cyan('üîí')} Secure communication between agents\r\n\r\n${chalk.bold('OPTIONS:')}\r\n  --queen-type <type>    Queen coordinator type (strategic, tactical, adaptive)\r\n  --max-workers <n>      Maximum worker agents (default: 8)\r\n  --consensus <type>     Consensus algorithm (majority, weighted, byzantine)\r\n  --memory-size <mb>     Collective memory size in MB (default: 100)\r\n  --auto-scale           Enable auto-scaling based on workload\r\n  --encryption           Enable encrypted communication\r\n  --monitor              Real-time monitoring dashboard\r\n  --verbose              Detailed logging\r\n  --claude               Generate Claude Code spawn commands with coordination\r\n  --spawn                Alias for --claude\r\n  --auto-spawn           Automatically spawn Claude Code instances\r\n  --execute              Execute Claude Code spawn commands immediately\r\n\r\n${chalk.bold('For more information:')}\r\n${chalk.blue('https://github.com/ruvnet/claude-flow/tree/main/docs/hive-mind')}\r\n`);\r\n}\r\n\r\n/**\r\n * Initialize hive mind system\r\n */\r\nasync function initHiveMind(flags) {\r\n  const spinner = ora('Initializing Hive Mind system...').start();\r\n\r\n  try {\r\n    // Create hive mind directory structure\r\n    const hiveMindDir = path.join(cwd(), '.hive-mind');\r\n    if (!existsSync(hiveMindDir)) {\r\n      mkdirSync(hiveMindDir, { recursive: true });\r\n    }\r\n\r\n    // Initialize SQLite database\r\n    const dbPath = path.join(hiveMindDir, 'hive.db');\r\n    const db = new Database(dbPath);\r\n\r\n    // Create tables\r\n    db.exec(`\r\n      CREATE TABLE IF NOT EXISTS swarms (\r\n        id TEXT PRIMARY KEY,\r\n        name TEXT NOT NULL,\r\n        objective TEXT,\r\n        status TEXT DEFAULT 'active',\r\n        queen_type TEXT DEFAULT 'strategic',\r\n        created_at DATETIME DEFAULT CURRENT_TIMESTAMP,\r\n        updated_at DATETIME DEFAULT CURRENT_TIMESTAMP\r\n      );\r\n      \r\n      CREATE TABLE IF NOT EXISTS agents (\r\n        id TEXT PRIMARY KEY,\r\n        swarm_id TEXT,\r\n        name TEXT NOT NULL,\r\n        type TEXT NOT NULL,\r\n        role TEXT,\r\n        status TEXT DEFAULT 'idle',\r\n        capabilities TEXT,\r\n        created_at DATETIME DEFAULT CURRENT_TIMESTAMP,\r\n        FOREIGN KEY (swarm_id) REFERENCES swarms(id)\r\n      );\r\n      \r\n      CREATE TABLE IF NOT EXISTS tasks (\r\n        id TEXT PRIMARY KEY,\r\n        swarm_id TEXT,\r\n        agent_id TEXT,\r\n        description TEXT,\r\n        status TEXT DEFAULT 'pending',\r\n        priority INTEGER DEFAULT 5,\r\n        result TEXT,\r\n        created_at DATETIME DEFAULT CURRENT_TIMESTAMP,\r\n        completed_at DATETIME,\r\n        FOREIGN KEY (swarm_id) REFERENCES swarms(id),\r\n        FOREIGN KEY (agent_id) REFERENCES agents(id)\r\n      );\r\n      \r\n      CREATE TABLE IF NOT EXISTS collective_memory (\r\n        id TEXT PRIMARY KEY,\r\n        swarm_id TEXT,\r\n        key TEXT NOT NULL,\r\n        value TEXT,\r\n        type TEXT DEFAULT 'knowledge',\r\n        confidence REAL DEFAULT 1.0,\r\n        created_by TEXT,\r\n        created_at DATETIME DEFAULT CURRENT_TIMESTAMP,\r\n        accessed_at DATETIME,\r\n        access_count INTEGER DEFAULT 0,\r\n        compressed INTEGER DEFAULT 0,\r\n        size INTEGER DEFAULT 0,\r\n        FOREIGN KEY (swarm_id) REFERENCES swarms(id)\r\n      );\r\n      \r\n      CREATE TABLE IF NOT EXISTS consensus_decisions (\r\n        id TEXT PRIMARY KEY,\r\n        swarm_id TEXT,\r\n        topic TEXT NOT NULL,\r\n        decision TEXT,\r\n        votes TEXT,\r\n        algorithm TEXT DEFAULT 'majority',\r\n        confidence REAL,\r\n        created_at DATETIME DEFAULT CURRENT_TIMESTAMP,\r\n        FOREIGN KEY (swarm_id) REFERENCES swarms(id)\r\n      );\r\n    `);\r\n\r\n    db.close();\r\n\r\n    // Create configuration file\r\n    const config = {\r\n      version: '2.0.0',\r\n      initialized: new Date().toISOString(),\r\n      defaults: {\r\n        queenType: 'strategic',\r\n        maxWorkers: 8,\r\n        consensusAlgorithm: 'majority',\r\n        memorySize: 100,\r\n        autoScale: true,\r\n        encryption: false,\r\n      },\r\n      mcpTools: {\r\n        enabled: true,\r\n        parallel: true,\r\n        timeout: 60000,\r\n      },\r\n    };\r\n\r\n    await writeFile(path.join(hiveMindDir, 'config.json'), JSON.stringify(config, null, 2));\r\n\r\n    spinner.succeed('Hive Mind system initialized successfully!');\r\n\r\n    console.log('\\n' + chalk.green('‚úì') + ' Created .hive-mind directory');\r\n    console.log(chalk.green('‚úì') + ' Initialized SQLite database');\r\n    console.log(chalk.green('‚úì') + ' Created configuration file');\r\n    console.log('\\n' + chalk.yellow('Next steps:'));\r\n    console.log(\r\n      '  1. Run ' + chalk.cyan('claude-flow hive-mind spawn') + ' to create your first swarm',\r\n    );\r\n    console.log(\r\n      '  2. Use ' + chalk.cyan('claude-flow hive-mind wizard') + ' for interactive setup',\r\n    );\r\n  } catch (error) {\r\n    spinner.fail('Failed to initialize Hive Mind system');\r\n    console.error(chalk.red('Error:'), error.message);\r\n    exit(1);\r\n  }\r\n}\r\n\r\n/**\r\n * Interactive wizard for hive mind operations\r\n */\r\n// Wrapped wizard function that handles non-interactive environments\r\nconst hiveMindWizard = safeInteractive(\r\n  // Interactive version\r\n  async function (flags = {}) {\r\n    console.log(chalk.yellow('\\nüßô Hive Mind Interactive Wizard\\n'));\r\n\r\n    const { action } = await inquirer.prompt([\r\n      {\r\n        type: 'list',\r\n        name: 'action',\r\n        message: 'What would you like to do?',\r\n        choices: [\r\n          { name: 'üêù Create new swarm', value: 'spawn' },\r\n          { name: 'üìä View swarm status', value: 'status' },\r\n          { name: 'üß† Manage collective memory', value: 'memory' },\r\n          { name: 'ü§ù View consensus decisions', value: 'consensus' },\r\n          { name: 'üìà Performance metrics', value: 'metrics' },\r\n          { name: 'üîß Configure hive mind', value: 'config' },\r\n          { name: '‚ùå Exit', value: 'exit' },\r\n        ],\r\n      },\r\n    ]);\r\n\r\n    switch (action) {\r\n      case 'spawn':\r\n        await spawnSwarmWizard();\r\n        break;\r\n      case 'status':\r\n        await showStatus({});\r\n        break;\r\n      case 'memory':\r\n        await manageMemoryWizard();\r\n        break;\r\n      case 'consensus':\r\n        await showConsensus({});\r\n        break;\r\n      case 'metrics':\r\n        await showMetrics({});\r\n        break;\r\n      case 'config':\r\n        await configureWizard();\r\n        break;\r\n      case 'exit':\r\n        console.log(chalk.gray('Exiting wizard...'));\r\n        break;\r\n    }\r\n  },\r\n  // Non-interactive fallback\r\n  async function (flags = {}) {\r\n    console.log(chalk.yellow('\\nüßô Hive Mind - Non-Interactive Mode\\n'));\r\n\r\n    // Default to creating a swarm with sensible defaults\r\n    console.log(chalk.cyan('Creating new swarm with default settings...'));\r\n    console.log(chalk.gray('Use command-line flags to customize:'));\r\n    console.log(chalk.gray('  --objective \"Your task\"    Set swarm objective'));\r\n    console.log(chalk.gray('  --queen-type strategic     Set queen type'));\r\n    console.log(chalk.gray('  --max-workers 8            Set worker count'));\r\n    console.log();\r\n\r\n    const objective = flags.objective || 'General task coordination';\r\n    const config = {\r\n      name: flags.name || `swarm-${Date.now()}`,\r\n      queenType: flags.queenType || flags['queen-type'] || 'strategic',\r\n      maxWorkers: parseInt(flags.maxWorkers || flags['max-workers'] || '8'),\r\n      consensusAlgorithm: flags.consensus || flags.consensusAlgorithm || 'majority',\r\n      autoScale: flags.autoScale || flags['auto-scale'] || false,\r\n      namespace: flags.namespace || 'default',\r\n      verbose: flags.verbose || false,\r\n      encryption: flags.encryption || false,\r\n    };\r\n\r\n    await spawnSwarm([objective], {\r\n      ...flags,\r\n      name: config.name,\r\n      queenType: config.queenType,\r\n      maxWorkers: config.maxWorkers,\r\n      consensusAlgorithm: config.consensusAlgorithm,\r\n      autoScale: config.autoScale,\r\n      encryption: config.encryption,\r\n      nonInteractive: true,\r\n    });\r\n  },\r\n);\r\n\r\n/**\r\n * Spawn swarm wizard\r\n */\r\nasync function spawnSwarmWizard() {\r\n  const answers = await inquirer.prompt([\r\n    {\r\n      type: 'input',\r\n      name: 'objective',\r\n      message: 'What is the swarm objective?',\r\n      validate: (input) => input.trim().length > 0 || 'Please enter an objective',\r\n    },\r\n    {\r\n      type: 'input',\r\n      name: 'name',\r\n      message: 'Swarm name (optional):',\r\n      default: (answers) => `swarm-${Date.now()}`,\r\n    },\r\n    {\r\n      type: 'list',\r\n      name: 'queenType',\r\n      message: 'Select queen coordinator type:',\r\n      choices: [\r\n        { name: 'Strategic - High-level planning and coordination', value: 'strategic' },\r\n        { name: 'Tactical - Detailed task management', value: 'tactical' },\r\n        { name: 'Adaptive - Learns and adapts strategies', value: 'adaptive' },\r\n      ],\r\n      default: 'strategic',\r\n    },\r\n    {\r\n      type: 'number',\r\n      name: 'maxWorkers',\r\n      message: 'Maximum number of worker agents:',\r\n      default: 8,\r\n      validate: (input) => (input > 0 && input <= 20) || 'Please enter a number between 1 and 20',\r\n    },\r\n    {\r\n      type: 'checkbox',\r\n      name: 'workerTypes',\r\n      message: 'Select worker agent types:',\r\n      choices: [\r\n        { name: 'Researcher', value: 'researcher', checked: true },\r\n        { name: 'Coder', value: 'coder', checked: true },\r\n        { name: 'Analyst', value: 'analyst', checked: true },\r\n        { name: 'Tester', value: 'tester', checked: true },\r\n        { name: 'Architect', value: 'architect' },\r\n        { name: 'Reviewer', value: 'reviewer' },\r\n        { name: 'Optimizer', value: 'optimizer' },\r\n        { name: 'Documenter', value: 'documenter' },\r\n      ],\r\n    },\r\n    {\r\n      type: 'list',\r\n      name: 'consensusAlgorithm',\r\n      message: 'Consensus algorithm for decisions:',\r\n      choices: [\r\n        { name: 'Majority - Simple majority voting', value: 'majority' },\r\n        { name: 'Weighted - Expertise-weighted voting', value: 'weighted' },\r\n        { name: 'Byzantine - Fault-tolerant consensus', value: 'byzantine' },\r\n      ],\r\n      default: 'majority',\r\n    },\r\n    {\r\n      type: 'confirm',\r\n      name: 'autoScale',\r\n      message: 'Enable auto-scaling?',\r\n      default: true,\r\n    },\r\n    {\r\n      type: 'confirm',\r\n      name: 'monitor',\r\n      message: 'Launch monitoring dashboard?',\r\n      default: true,\r\n    },\r\n    {\r\n      type: 'confirm',\r\n      name: 'spawnClaude',\r\n      message: 'Spawn Claude Code instance with hive-mind coordination?',\r\n      default: true,\r\n    },\r\n  ]);\r\n\r\n  // Spawn the swarm with collected parameters\r\n  const swarmResult = await spawnSwarm([answers.objective], {\r\n    name: answers.name,\r\n    queenType: answers.queenType,\r\n    'queen-type': answers.queenType,\r\n    maxWorkers: answers.maxWorkers,\r\n    'max-workers': answers.maxWorkers,\r\n    workerTypes: answers.workerTypes.join(','),\r\n    consensus: answers.consensusAlgorithm,\r\n    autoScale: answers.autoScale,\r\n    'auto-scale': answers.autoScale,\r\n    monitor: answers.monitor,\r\n    namespace: answers.namespace || 'default',\r\n    verbose: answers.verbose || false,\r\n    spawnClaude: answers.spawnClaude, // Pass the Claude spawning preference\r\n  });\r\n\r\n  // If Claude Code spawning was requested, launch it using the same function as --claude flag\r\n  if (answers.spawnClaude && swarmResult && swarmResult.swarmId) {\r\n    // Create workers array in the same format expected by spawnClaudeCodeInstances\r\n    const workers = answers.workerTypes.map((type, index) => ({\r\n      id: `worker-${index + 1}`,\r\n      type,\r\n      role: 'worker',\r\n      status: 'active',\r\n      capabilities: getAgentCapabilities(type)\r\n    }));\r\n    \r\n    // Create flags object with the wizard settings\r\n    const claudeFlags = {\r\n      queenType: answers.queenType,\r\n      consensus: answers.consensusAlgorithm,\r\n      autoScale: answers.autoScale,\r\n      monitor: answers.monitor,\r\n      namespace: answers.namespace || 'default',\r\n      verbose: answers.verbose || false\r\n    };\r\n    \r\n    // Use the same Claude spawning function as the --claude flag\r\n    console.log(chalk.cyan(`\\nüéØ Objective from wizard: \"${answers.objective}\"`));\r\n    await spawnClaudeCodeInstances(\r\n      swarmResult.swarmId,\r\n      answers.name,\r\n      answers.objective,\r\n      workers,\r\n      claudeFlags\r\n    );\r\n  }\r\n  \r\n  return swarmResult;\r\n}\r\n\r\n/**\r\n * Spawn a hive mind swarm\r\n */\r\nasync function spawnSwarm(args, flags) {\r\n  const objective = args.join(' ').trim();\r\n\r\n  // Check for non-interactive mode FIRST\r\n  const isNonInteractive = flags['non-interactive'] || flags.nonInteractive;\r\n  \r\n  if (!objective && !flags.wizard) {\r\n    if (isNonInteractive) {\r\n      console.error(chalk.red('Error: Objective required in non-interactive mode'));\r\n      console.log('Usage: claude-flow hive-mind spawn \"Your objective\" --non-interactive');\r\n    } else {\r\n      console.error(chalk.red('Error: Please provide an objective or use --wizard flag'));\r\n      console.log('Example: claude-flow hive-mind spawn \"Build REST API\"');\r\n    }\r\n    return;\r\n  }\r\n  \r\n  // Log non-interactive mode status\r\n  if (isNonInteractive && flags.verbose) {\r\n    console.log(chalk.cyan('ü§ñ Running in non-interactive mode'));\r\n  }\r\n\r\n  // Validate parameters\r\n  if (flags.verbose) {\r\n    console.log(chalk.gray('üîç Debug: Parsed flags:'));\r\n    console.log(chalk.gray(JSON.stringify(flags, null, 2)));\r\n  }\r\n\r\n  // Validate queen type\r\n  const validQueenTypes = ['strategic', 'tactical', 'adaptive'];\r\n  const queenType = flags.queenType || flags['queen-type'] || 'strategic';\r\n  if (!validQueenTypes.includes(queenType)) {\r\n    console.error(chalk.red(`Error: Invalid queen type '${queenType}'. Must be one of: ${validQueenTypes.join(', ')}`));\r\n    return;\r\n  }\r\n\r\n  // Validate max workers\r\n  const maxWorkers = parseInt(flags.maxWorkers || flags['max-workers'] || '8');\r\n  if (isNaN(maxWorkers) || maxWorkers < 1 || maxWorkers > 20) {\r\n    console.error(chalk.red('Error: max-workers must be a number between 1 and 20'));\r\n    return;\r\n  }\r\n\r\n  // Validate consensus algorithm\r\n  const validConsensusTypes = ['majority', 'weighted', 'byzantine'];\r\n  const consensusAlgorithm = flags.consensus || flags.consensusAlgorithm || 'majority';\r\n  if (!validConsensusTypes.includes(consensusAlgorithm)) {\r\n    console.error(chalk.red(`Error: Invalid consensus algorithm '${consensusAlgorithm}'. Must be one of: ${validConsensusTypes.join(', ')}`));\r\n    return;\r\n  }\r\n\r\n  const spinner = ora('Spawning Hive Mind swarm...').start();\r\n\r\n  try {\r\n    // Initialize hive mind core with error handling\r\n    let hiveMind;\r\n    try {\r\n      spinner.text = 'Initializing Hive Mind Core...';\r\n      hiveMind = new HiveMindCore({\r\n        objective,\r\n        name: flags.name || `hive-${Date.now()}`,\r\n        queenType: flags.queenType || flags['queen-type'] || 'strategic',\r\n        maxWorkers: parseInt(flags.maxWorkers || flags['max-workers'] || '8'),\r\n        consensusAlgorithm: flags.consensus || flags.consensusAlgorithm || 'majority',\r\n        autoScale: flags.autoScale !== undefined ? flags.autoScale : (flags['auto-scale'] !== undefined ? flags['auto-scale'] : true),\r\n        namespace: flags.namespace || 'default',\r\n        encryption: flags.encryption || false,\r\n      });\r\n    } catch (error) {\r\n      console.error('HiveMindCore initialization failed:', error);\r\n      throw new Error(`Failed to initialize HiveMindCore: ${error.message}`);\r\n    }\r\n\r\n    spinner.text = 'Setting up database connection...';\r\n    // Initialize database connection\r\n    const dbDir = path.join(cwd(), '.hive-mind');\r\n    const dbPath = path.join(dbDir, 'hive.db');\r\n\r\n    // Ensure .hive-mind directory exists\r\n    if (!existsSync(dbDir)) {\r\n      mkdirSync(dbDir, { recursive: true });\r\n    }\r\n\r\n    // Check if database file exists and try to create a clean one if needed\r\n    let db;\r\n    try {\r\n      spinner.text = 'Creating database connection...';\r\n      db = new Database(dbPath);\r\n      // Test the database with a simple query\r\n      db.prepare('SELECT 1').get();\r\n      spinner.text = 'Database connection established';\r\n    } catch (error) {\r\n      console.warn('Database issue detected, recreating...', error.message);\r\n      spinner.text = 'Recreating database...';\r\n      // Remove corrupted database\r\n      if (existsSync(dbPath)) {\r\n        try {\r\n          const fs = await import('fs');\r\n          fs.unlinkSync(dbPath);\r\n        } catch (e) {\r\n          console.warn('Could not remove corrupted database:', e.message);\r\n        }\r\n      }\r\n      // Create new database\r\n      db = new Database(dbPath);\r\n    }\r\n\r\n    // Initialize database schema if not exists\r\n    spinner.text = 'Creating database schema...';\r\n    try {\r\n      db.exec(`\r\n      CREATE TABLE IF NOT EXISTS swarms (\r\n        id TEXT PRIMARY KEY,\r\n        name TEXT NOT NULL,\r\n        objective TEXT,\r\n        queen_type TEXT,\r\n        status TEXT DEFAULT 'active',\r\n        created_at DATETIME DEFAULT CURRENT_TIMESTAMP,\r\n        updated_at DATETIME\r\n      );\r\n      \r\n      CREATE TABLE IF NOT EXISTS agents (\r\n        id TEXT PRIMARY KEY,\r\n        swarm_id TEXT NOT NULL,\r\n        name TEXT NOT NULL,\r\n        type TEXT NOT NULL,\r\n        role TEXT NOT NULL,\r\n        status TEXT DEFAULT 'idle',\r\n        capabilities TEXT,\r\n        created_at DATETIME DEFAULT CURRENT_TIMESTAMP,\r\n        FOREIGN KEY (swarm_id) REFERENCES swarms(id)\r\n      );\r\n      \r\n      CREATE TABLE IF NOT EXISTS tasks (\r\n        id TEXT PRIMARY KEY,\r\n        swarm_id TEXT NOT NULL,\r\n        agent_id TEXT,\r\n        description TEXT,\r\n        status TEXT DEFAULT 'pending',\r\n        priority INTEGER DEFAULT 5,\r\n        result TEXT,\r\n        created_at DATETIME DEFAULT CURRENT_TIMESTAMP,\r\n        completed_at DATETIME,\r\n        FOREIGN KEY (swarm_id) REFERENCES swarms(id),\r\n        FOREIGN KEY (agent_id) REFERENCES agents(id)\r\n      );\r\n      \r\n      CREATE TABLE IF NOT EXISTS collective_memory (\r\n        id TEXT PRIMARY KEY,\r\n        swarm_id TEXT,\r\n        key TEXT NOT NULL,\r\n        value TEXT,\r\n        type TEXT DEFAULT 'knowledge',\r\n        confidence REAL DEFAULT 1.0,\r\n        created_by TEXT,\r\n        created_at DATETIME DEFAULT CURRENT_TIMESTAMP,\r\n        accessed_at DATETIME,\r\n        access_count INTEGER DEFAULT 0,\r\n        compressed INTEGER DEFAULT 0,\r\n        size INTEGER DEFAULT 0,\r\n        FOREIGN KEY (swarm_id) REFERENCES swarms(id)\r\n      );\r\n      \r\n      CREATE TABLE IF NOT EXISTS consensus_decisions (\r\n        id TEXT PRIMARY KEY,\r\n        swarm_id TEXT,\r\n        topic TEXT NOT NULL,\r\n        decision TEXT,\r\n        votes TEXT,\r\n        algorithm TEXT DEFAULT 'majority',\r\n        confidence REAL,\r\n        created_at DATETIME DEFAULT CURRENT_TIMESTAMP,\r\n        FOREIGN KEY (swarm_id) REFERENCES swarms(id)\r\n      );\r\n      \r\n      CREATE TABLE IF NOT EXISTS sessions (\r\n        id TEXT PRIMARY KEY,\r\n        swarm_id TEXT NOT NULL,\r\n        swarm_name TEXT NOT NULL,\r\n        objective TEXT,\r\n        status TEXT DEFAULT 'active',\r\n        created_at DATETIME DEFAULT CURRENT_TIMESTAMP,\r\n        updated_at DATETIME DEFAULT CURRENT_TIMESTAMP,\r\n        paused_at DATETIME,\r\n        resumed_at DATETIME,\r\n        completion_percentage REAL DEFAULT 0,\r\n        checkpoint_data TEXT,\r\n        metadata TEXT,\r\n        parent_pid INTEGER,\r\n        child_pids TEXT,\r\n        FOREIGN KEY (swarm_id) REFERENCES swarms(id)\r\n      );\r\n      \r\n      CREATE TABLE IF NOT EXISTS session_checkpoints (\r\n        id TEXT PRIMARY KEY,\r\n        session_id TEXT NOT NULL,\r\n        checkpoint_name TEXT NOT NULL,\r\n        checkpoint_data TEXT,\r\n        created_at DATETIME DEFAULT CURRENT_TIMESTAMP,\r\n        FOREIGN KEY (session_id) REFERENCES sessions(id)\r\n      );\r\n      \r\n      CREATE TABLE IF NOT EXISTS session_logs (\r\n        id INTEGER PRIMARY KEY AUTOINCREMENT,\r\n        session_id TEXT NOT NULL,\r\n        timestamp DATETIME DEFAULT CURRENT_TIMESTAMP,\r\n        log_level TEXT DEFAULT 'info',\r\n        message TEXT,\r\n        agent_id TEXT,\r\n        data TEXT,\r\n        FOREIGN KEY (session_id) REFERENCES sessions(id)\r\n      );\r\n    `);\r\n      spinner.text = 'Database schema created successfully';\r\n    } catch (error) {\r\n      console.error('Database schema creation failed:', error);\r\n      throw new Error(`Failed to create database schema: ${error.message}`);\r\n    }\r\n\r\n    // Create swarm record with safe ID generation\r\n    spinner.text = 'Creating swarm record...';\r\n    const timestamp = Date.now();\r\n    const randomPart = Math.random().toString(36).substring(2, 11); // Use substring instead of substr\r\n    const swarmId = `swarm-${timestamp}-${randomPart}`;\r\n    try {\r\n      db.prepare(\r\n        `\r\n        INSERT INTO swarms (id, name, objective, queen_type)\r\n        VALUES (?, ?, ?, ?)\r\n      `,\r\n      ).run(swarmId, hiveMind.config.name, objective, hiveMind.config.queenType);\r\n    } catch (error) {\r\n      console.error('Failed to create swarm record:', error);\r\n      throw new Error(`Failed to create swarm record: ${error.message}`);\r\n    }\r\n\r\n    // Create session for this swarm\r\n    spinner.text = 'Creating session tracking...';\r\n    const sessionManager = new HiveMindSessionManager();\r\n    const sessionId = await sessionManager.createSession(swarmId, hiveMind.config.name, objective, {\r\n      queenType: hiveMind.config.queenType,\r\n      maxWorkers: hiveMind.config.maxWorkers,\r\n      consensusAlgorithm: hiveMind.config.consensusAlgorithm,\r\n      autoScale: hiveMind.config.autoScale,\r\n      encryption: hiveMind.config.encryption,\r\n      workerTypes: flags.workerTypes,\r\n    });\r\n\r\n    spinner.text = 'Session tracking established...';\r\n\r\n    // Initialize auto-save middleware (use the same session manager)\r\n    const autoSave = createAutoSaveMiddleware(sessionId, sessionManager, {\r\n      saveInterval: 30000, // Save every 30 seconds\r\n      autoStart: true,\r\n    });\r\n\r\n    // Close session manager after auto-save is set up\r\n    // sessionManager.close(); // Don't close yet as auto-save needs it\r\n\r\n    // Track initial swarm creation\r\n    autoSave.trackChange('swarm_created', {\r\n      swarmId,\r\n      swarmName: hiveMind.config.name,\r\n      objective,\r\n      workerCount: hiveMind.config.maxWorkers,\r\n    });\r\n\r\n    spinner.text = 'Initializing Queen coordinator...';\r\n\r\n    // Initialize Queen\r\n    const queen = new QueenCoordinator({\r\n      swarmId,\r\n      type: hiveMind.config.queenType,\r\n      objective,\r\n    });\r\n\r\n    // Spawn Queen agent\r\n    const queenAgent = {\r\n      id: `queen-${swarmId}`,\r\n      swarmId,\r\n      name: 'Queen Coordinator',\r\n      type: 'coordinator',\r\n      role: 'queen',\r\n      status: 'active',\r\n      capabilities: JSON.stringify(['coordination', 'planning', 'decision-making']),\r\n    };\r\n\r\n    db.prepare(\r\n      `\r\n      INSERT INTO agents (id, swarm_id, name, type, role, status, capabilities)\r\n      VALUES (?, ?, ?, ?, ?, ?, ?)\r\n    `,\r\n    ).run(...Object.values(queenAgent));\r\n\r\n    spinner.text = 'Spawning worker agents...';\r\n\r\n    // Determine worker types\r\n    const workerTypes = flags.workerTypes\r\n      ? flags.workerTypes.split(',')\r\n      : ['researcher', 'coder', 'analyst', 'tester'];\r\n\r\n    // Spawn worker agents\r\n    const workers = [];\r\n    for (let i = 0; i < Math.min(workerTypes.length, hiveMind.config.maxWorkers); i++) {\r\n      const workerType = workerTypes[i % workerTypes.length];\r\n      const workerId = `worker-${swarmId}-${i}`;\r\n\r\n      const worker = {\r\n        id: workerId,\r\n        swarmId,\r\n        name: `${workerType.charAt(0).toUpperCase() + workerType.slice(1)} Worker ${i + 1}`,\r\n        type: workerType,\r\n        role: 'worker',\r\n        status: 'idle',\r\n        capabilities: JSON.stringify(getAgentCapabilities(workerType)),\r\n      };\r\n\r\n      workers.push(worker);\r\n\r\n      db.prepare(\r\n        `\r\n        INSERT INTO agents (id, swarm_id, name, type, role, status, capabilities)\r\n        VALUES (?, ?, ?, ?, ?, ?, ?)\r\n      `,\r\n      ).run(...Object.values(worker));\r\n\r\n      // Track agent spawning for auto-save\r\n      autoSave.trackAgentActivity(workerId, 'spawned', {\r\n        type: workerType,\r\n        name: worker.name,\r\n      });\r\n    }\r\n\r\n    spinner.text = 'Initializing collective memory...';\r\n\r\n    // Initialize collective memory\r\n    const memory = new CollectiveMemory({\r\n      swarmId,\r\n      maxSize: flags.memorySize || 100,\r\n    });\r\n\r\n    // Store initial context\r\n    memory.store('objective', objective, 'context');\r\n    memory.store('queen_type', hiveMind.config.queenType, 'config');\r\n    memory.store('worker_count', workers.length, 'metrics');\r\n    memory.store('session_id', sessionId, 'system');\r\n\r\n    spinner.text = 'Establishing communication channels...';\r\n\r\n    // Initialize communication system\r\n    const communication = new SwarmCommunication({\r\n      swarmId,\r\n      encryption: hiveMind.config.encryption,\r\n    });\r\n\r\n    db.close();\r\n\r\n    spinner.succeed('Hive Mind swarm spawned successfully!');\r\n\r\n    // Display swarm summary\r\n    console.log('\\n' + chalk.bold('üêù Swarm Summary:'));\r\n    console.log(chalk.gray('‚îÄ'.repeat(50)));\r\n    console.log(chalk.cyan('Swarm ID:'), swarmId);\r\n    console.log(chalk.cyan('Session ID:'), sessionId);\r\n    console.log(chalk.cyan('Name:'), hiveMind.config.name);\r\n    console.log(chalk.cyan('Objective:'), objective);\r\n    console.log(chalk.cyan('Queen Type:'), hiveMind.config.queenType);\r\n    console.log(chalk.cyan('Workers:'), workers.length);\r\n    console.log(chalk.cyan('Worker Types:'), workerTypes.join(', '));\r\n    console.log(chalk.cyan('Consensus:'), hiveMind.config.consensusAlgorithm);\r\n    console.log(chalk.cyan('Auto-scaling:'), hiveMind.config.autoScale ? 'Enabled' : 'Disabled');\r\n    console.log(chalk.gray('‚îÄ'.repeat(50)));\r\n\r\n    // Launch monitoring if requested\r\n    if (flags.monitor) {\r\n      console.log('\\n' + chalk.yellow('Launching monitoring dashboard...'));\r\n      // TODO: Implement monitoring dashboard\r\n    }\r\n\r\n    // Enhanced coordination instructions with MCP tools\r\n    console.log('\\n' + chalk.green('‚úì') + ' Swarm is ready for coordination');\r\n    console.log(chalk.gray('Use \"claude-flow hive-mind status\" to view swarm activity'));\r\n    console.log(chalk.gray('Session auto-save enabled - progress saved every 30 seconds'));\r\n    console.log(chalk.blue('üí° To pause:') + ' Press Ctrl+C to safely pause and resume later');\r\n    console.log(chalk.blue('üí° To resume:') + ' claude-flow hive-mind resume ' + sessionId);\r\n\r\n    // Set up SIGINT handler for automatic session pausing\r\n    let isExiting = false;\r\n    const sigintHandler = async () => {\r\n      if (isExiting) return;\r\n      isExiting = true;\r\n\r\n      console.log('\\n\\n' + chalk.yellow('‚è∏Ô∏è  Pausing session...'));\r\n      \r\n      try {\r\n        // Save current checkpoint using the existing session manager\r\n        // const sessionManager = new HiveMindSessionManager(); // Use existing one\r\n        \r\n        // Create checkpoint data\r\n        const checkpointData = {\r\n          timestamp: new Date().toISOString(),\r\n          swarmId,\r\n          objective,\r\n          workerCount: workers.length,\r\n          workerTypes,\r\n          status: 'paused_by_user',\r\n          reason: 'User pressed Ctrl+C',\r\n        };\r\n        \r\n        // Save checkpoint\r\n        await sessionManager.saveCheckpoint(sessionId, 'auto-pause', checkpointData);\r\n        \r\n        // Pause the session\r\n        await sessionManager.pauseSession(sessionId);\r\n        \r\n        // Close session manager\r\n        sessionManager.close();\r\n        \r\n        console.log(chalk.green('‚úì') + ' Session paused successfully');\r\n        console.log(chalk.cyan('\\nTo resume this session, run:'));\r\n        console.log(chalk.bold(`  claude-flow hive-mind resume ${sessionId}`));\r\n        console.log();\r\n        \r\n        // Clean up auto-save if active\r\n        if (global.autoSaveInterval) {\r\n          clearInterval(global.autoSaveInterval);\r\n        }\r\n        \r\n        process.exit(0);\r\n      } catch (error) {\r\n        console.error(chalk.red('Error pausing session:'), error.message);\r\n        process.exit(1);\r\n      }\r\n    };\r\n\r\n    // Register SIGINT handler\r\n    process.on('SIGINT', sigintHandler);\r\n    process.on('SIGTERM', sigintHandler);\r\n\r\n    // Offer to spawn Claude Code instances with coordination instructions\r\n    // Spawn Claude if --claude or --spawn flag is set\r\n    if (flags.claude || flags.spawn) {\r\n      await spawnClaudeCodeInstances(swarmId, hiveMind.config.name, objective, workers, flags);\r\n    } else {\r\n      console.log(\r\n        '\\n' +\r\n          chalk.blue('üí° Pro Tip:') +\r\n          ' Add --claude to spawn coordinated Claude Code instances',\r\n      );\r\n      console.log(chalk.gray('   claude-flow hive-mind spawn \"objective\" --claude'));\r\n    }\r\n\r\n    // Return swarm info for wizard use\r\n    return { swarmId, hiveMind };\r\n  } catch (error) {\r\n    spinner.fail('Failed to spawn Hive Mind swarm');\r\n    console.error(chalk.red('Error:'), error.message);\r\n\r\n    // If error contains \"sha3\", provide specific guidance\r\n    if (error.message.includes('sha3') || error.message.includes('SHA3')) {\r\n      console.error('\\nüîç SHA3 Function Error Detected');\r\n      console.error('This appears to be a SQLite extension or better-sqlite3 configuration issue.');\r\n      console.error('\\nPossible solutions:');\r\n      console.error('1. Try removing the corrupted database: rm -rf .hive-mind/');\r\n      console.error('2. Reinstall better-sqlite3: npm reinstall better-sqlite3');\r\n      console.error('3. Check if any SQLite extensions are conflicting');\r\n      console.error('\\nüö® Detailed error:');\r\n      console.error(error.stack || error.message);\r\n    }\r\n\r\n    exit(1);\r\n  }\r\n}\r\n\r\n/**\r\n * Get agent capabilities based on type\r\n */\r\nfunction getAgentCapabilities(type) {\r\n  const capabilities = {\r\n    researcher: ['web-search', 'data-gathering', 'analysis', 'synthesis'],\r\n    coder: ['code-generation', 'implementation', 'refactoring', 'debugging'],\r\n    analyst: ['data-analysis', 'pattern-recognition', 'reporting', 'visualization'],\r\n    tester: ['test-generation', 'quality-assurance', 'bug-detection', 'validation'],\r\n    architect: ['system-design', 'architecture', 'planning', 'documentation'],\r\n    reviewer: ['code-review', 'quality-check', 'feedback', 'improvement'],\r\n    optimizer: ['performance-tuning', 'optimization', 'profiling', 'enhancement'],\r\n    documenter: ['documentation', 'explanation', 'tutorial-creation', 'knowledge-base'],\r\n  };\r\n\r\n  return capabilities[type] || ['general'];\r\n}\r\n\r\n/**\r\n * Show hive mind status\r\n */\r\nasync function showStatus(flags) {\r\n  try {\r\n    const dbPath = path.join(cwd(), '.hive-mind', 'hive.db');\r\n\r\n    if (!existsSync(dbPath)) {\r\n      console.error(chalk.red('Error: Hive Mind not initialized'));\r\n      console.log('Run \"claude-flow hive-mind init\" first');\r\n      return;\r\n    }\r\n\r\n    // Use the metrics reader for real data\r\n    const metricsReader = new HiveMindMetricsReader(dbPath);\r\n    const swarms = metricsReader.getActiveSwarms();\r\n\r\n    if (swarms.length === 0) {\r\n      console.log(chalk.gray('No active swarms found'));\r\n      metricsReader.close();\r\n      return;\r\n    }\r\n\r\n    console.log(chalk.bold('\\nüêù Active Hive Mind Swarms\\n'));\r\n\r\n    for (const swarm of swarms) {\r\n      console.log(chalk.yellow('‚ïê'.repeat(60)));\r\n      console.log(chalk.cyan('Swarm:'), swarm.name);\r\n      console.log(chalk.cyan('ID:'), swarm.id);\r\n      console.log(chalk.cyan('Objective:'), swarm.objective);\r\n      console.log(chalk.cyan('Queen Type:'), swarm.queen_type);\r\n      console.log(chalk.cyan('Status:'), chalk.green(swarm.status));\r\n      console.log(chalk.cyan('Created:'), new Date(swarm.created_at).toLocaleString());\r\n      \r\n      // Show real agent count\r\n      console.log(chalk.cyan('Total Agents:'), swarm.agent_count || 0);\r\n\r\n      console.log('\\n' + chalk.bold('Agents:'));\r\n\r\n      // Group by role using real agent data\r\n      const agents = swarm.agents || [];\r\n      const queen = agents.find((a) => a.role === 'queen');\r\n      const workers = agents.filter((a) => a.role === 'worker');\r\n\r\n      if (queen) {\r\n        console.log('  ' + chalk.magenta('üëë Queen:'), queen.name, chalk.gray(`(${queen.status})`));\r\n      } else {\r\n        console.log('  ' + chalk.gray('No queen assigned yet'));\r\n      }\r\n\r\n      console.log('  ' + chalk.blue('üêù Workers:'));\r\n      if (workers.length > 0) {\r\n        workers.forEach((worker) => {\r\n          const statusColor =\r\n            worker.status === 'active' ? 'green' : worker.status === 'busy' ? 'yellow' : 'gray';\r\n          console.log(`    - ${worker.name} (${worker.type}) ${chalk[statusColor](worker.status)}`);\r\n        });\r\n      } else {\r\n        console.log('    ' + chalk.gray('No workers spawned yet'));\r\n      }\r\n\r\n      // Get real task statistics\r\n      const taskStats = swarm.task_metrics || {\r\n        total: 0,\r\n        completed: 0,\r\n        in_progress: 0,\r\n        pending: 0,\r\n        failed: 0\r\n      };\r\n\r\n      console.log('\\n' + chalk.bold('Tasks:'));\r\n      console.log(`  Total: ${taskStats.total}`);\r\n      console.log(`  Completed: ${chalk.green(taskStats.completed || 0)}`);\r\n      console.log(`  In Progress: ${chalk.yellow(taskStats.in_progress || 0)}`);\r\n      console.log(`  Pending: ${chalk.gray(taskStats.pending || 0)}`);\r\n      console.log(`  ${chalk.bold('Completion:')} ${swarm.completion_percentage || 0}%`);\r\n\r\n      // Show real memory count\r\n      console.log('\\n' + chalk.bold('Collective Memory:'));\r\n      console.log(`  Entries: ${swarm.memory_count || 0}`);\r\n\r\n      // Show real consensus count\r\n      console.log('\\n' + chalk.bold('Consensus Decisions:'));\r\n      console.log(`  Total: ${swarm.consensus_count || 0}`);\r\n    }\r\n\r\n    console.log(chalk.yellow('‚ïê'.repeat(60)) + '\\n');\r\n\r\n    metricsReader.close();\r\n  } catch (error) {\r\n    console.error(chalk.red('Error:'), error.message);\r\n    exit(1);\r\n  }\r\n}\r\n\r\n/**\r\n * Show consensus decisions\r\n */\r\nasync function showConsensus(flags) {\r\n  try {\r\n    const dbPath = path.join(cwd(), '.hive-mind', 'hive.db');\r\n    const db = new Database(dbPath);\r\n\r\n    const decisions = db\r\n      .prepare(\r\n        `\r\n      SELECT cd.*, s.name as swarm_name\r\n      FROM consensus_decisions cd\r\n      JOIN swarms s ON cd.swarm_id = s.id\r\n      ORDER BY cd.created_at DESC\r\n      LIMIT 20\r\n    `,\r\n      )\r\n      .all();\r\n\r\n    if (decisions.length === 0) {\r\n      console.log(chalk.gray('No consensus decisions found'));\r\n      db.close();\r\n      return;\r\n    }\r\n\r\n    console.log(chalk.bold('\\nü§ù Recent Consensus Decisions\\n'));\r\n\r\n    decisions.forEach((decision) => {\r\n      console.log(chalk.yellow('‚îÄ'.repeat(50)));\r\n      console.log(chalk.cyan('Swarm:'), decision.swarm_name);\r\n      console.log(chalk.cyan('Topic:'), decision.topic);\r\n      console.log(chalk.cyan('Decision:'), decision.decision);\r\n      console.log(chalk.cyan('Algorithm:'), decision.algorithm);\r\n      console.log(chalk.cyan('Confidence:'), `${(decision.confidence * 100).toFixed(1)}%`);\r\n      console.log(chalk.cyan('Time:'), new Date(decision.created_at).toLocaleString());\r\n\r\n      if (decision.votes) {\r\n        const votes = JSON.parse(decision.votes);\r\n        console.log(chalk.cyan('Votes:'));\r\n\r\n        // Handle vote summary format (for/against/abstain/details)\r\n        if (votes.for !== undefined || votes.against !== undefined || votes.abstain !== undefined) {\r\n          console.log(`  - for: ${votes.for || 0}`);\r\n          console.log(`  - against: ${votes.against || 0}`);\r\n          console.log(`  - abstain: ${votes.abstain || 0}`);\r\n\r\n          // Display vote details properly if they exist\r\n          if (votes.details && Array.isArray(votes.details)) {\r\n            console.log('  - details:');\r\n            votes.details.forEach((detail, index) => {\r\n              if (typeof detail === 'object') {\r\n                // Extract available fields\r\n                const agent =\r\n                  detail.agentId ||\r\n                  detail.agent ||\r\n                  detail.id ||\r\n                  detail.name ||\r\n                  `agent-${index + 1}`;\r\n                const vote = detail.vote || detail.choice || detail.decision || 'unknown';\r\n                const reason = detail.reason || detail.justification || detail.rationale;\r\n\r\n                // Build display string\r\n                let displayString = `    ${index + 1}. Agent: ${agent}, Vote: ${vote}`;\r\n\r\n                // Add reason if available\r\n                if (reason && reason !== 'N/A' && reason !== '') {\r\n                  displayString += `, Reason: ${reason}`;\r\n                }\r\n\r\n                console.log(displayString);\r\n              } else {\r\n                console.log(`    ${index + 1}. ${detail}`);\r\n              }\r\n            });\r\n          }\r\n        } else {\r\n          // Handle individual agent votes format\r\n          Object.entries(votes).forEach(([agent, vote]) => {\r\n            console.log(`  - ${agent}: ${vote}`);\r\n          });\r\n        }\r\n      }\r\n    });\r\n\r\n    console.log(chalk.yellow('‚îÄ'.repeat(50)) + '\\n');\r\n\r\n    db.close();\r\n  } catch (error) {\r\n    console.error(chalk.red('Error:'), error.message);\r\n    exit(1);\r\n  }\r\n}\r\n\r\n/**\r\n * Show performance metrics\r\n */\r\nasync function showMetrics(flags) {\r\n  try {\r\n    const dbPath = path.join(cwd(), '.hive-mind', 'hive.db');\r\n    const db = new Database(dbPath);\r\n\r\n    // Get overall metrics\r\n    const overallStats = db\r\n      .prepare(\r\n        `\r\n      SELECT \r\n        (SELECT COUNT(*) FROM swarms) as total_swarms,\r\n        (SELECT COUNT(*) FROM agents) as total_agents,\r\n        (SELECT COUNT(*) FROM tasks) as total_tasks,\r\n        (SELECT COUNT(*) FROM tasks WHERE status = 'completed') as completed_tasks\r\n    `,\r\n      )\r\n      .get();\r\n\r\n    console.log(chalk.bold('\\nüìä Hive Mind Performance Metrics\\n'));\r\n\r\n    // Get task status breakdown\r\n    const taskBreakdown = db\r\n      .prepare(\r\n        `\r\n      SELECT \r\n        status,\r\n        COUNT(*) as count\r\n      FROM tasks\r\n      GROUP BY status\r\n      ORDER BY count DESC\r\n    `,\r\n      )\r\n      .all();\r\n\r\n    console.log(chalk.cyan('Overall Statistics:'));\r\n    console.log(`  Total Swarms: ${overallStats.total_swarms}`);\r\n    console.log(`  Total Agents: ${overallStats.total_agents}`);\r\n    console.log(`  Total Tasks: ${overallStats.total_tasks}`);\r\n    console.log(`  Completed Tasks: ${overallStats.completed_tasks}`);\r\n    console.log(\r\n      `  Success Rate: ${\r\n        overallStats.total_tasks > 0\r\n          ? ((overallStats.completed_tasks / overallStats.total_tasks) * 100).toFixed(1) + '%'\r\n          : 'N/A'\r\n      }`,\r\n    );\r\n\r\n    if (taskBreakdown.length > 0) {\r\n      console.log('\\n' + chalk.cyan('Task Status Breakdown:'));\r\n      taskBreakdown.forEach((status) => {\r\n        const percentage =\r\n          overallStats.total_tasks > 0\r\n            ? ((status.count / overallStats.total_tasks) * 100).toFixed(1)\r\n            : '0';\r\n        const statusColor =\r\n          status.status === 'completed'\r\n            ? 'green'\r\n            : status.status === 'in_progress'\r\n              ? 'yellow'\r\n              : status.status === 'failed'\r\n                ? 'red'\r\n                : 'gray';\r\n        console.log(\r\n          `  ${chalk[statusColor](status.status.charAt(0).toUpperCase() + status.status.slice(1))}: ${status.count} (${percentage}%)`,\r\n        );\r\n      });\r\n    }\r\n\r\n    // Get agent performance (check for completed_at column)\r\n    let agentPerf = [];\r\n    try {\r\n      // Check if completed_at exists\r\n      const hasCompletedAt = db\r\n        .prepare(\r\n          `\r\n        SELECT COUNT(*) as count FROM pragma_table_info('tasks') \r\n        WHERE name = 'completed_at'\r\n      `,\r\n        )\r\n        .get();\r\n\r\n      if (hasCompletedAt && hasCompletedAt.count > 0) {\r\n        agentPerf = db\r\n          .prepare(\r\n            `\r\n          SELECT \r\n            a.name,\r\n            a.type,\r\n            COUNT(t.id) as tasks_assigned,\r\n            SUM(CASE WHEN t.status = 'completed' THEN 1 ELSE 0 END) as tasks_completed,\r\n            AVG(CASE WHEN t.completed_at IS NOT NULL \r\n              THEN (julianday(t.completed_at) - julianday(t.created_at)) * 24 * 60 \r\n              ELSE NULL END) as avg_completion_minutes\r\n          FROM agents a\r\n          LEFT JOIN tasks t ON a.id = t.agent_id\r\n          GROUP BY a.id\r\n          HAVING tasks_assigned > 0\r\n          ORDER BY tasks_completed DESC\r\n          LIMIT 10\r\n        `,\r\n          )\r\n          .all();\r\n      } else {\r\n        // Simpler query without completed_at\r\n        agentPerf = db\r\n          .prepare(\r\n            `\r\n          SELECT \r\n            a.name,\r\n            a.type,\r\n            COUNT(t.id) as tasks_assigned,\r\n            SUM(CASE WHEN t.status = 'completed' THEN 1 ELSE 0 END) as tasks_completed,\r\n            NULL as avg_completion_minutes\r\n          FROM agents a\r\n          LEFT JOIN tasks t ON a.id = t.agent_id\r\n          GROUP BY a.id\r\n          HAVING tasks_assigned > 0\r\n          ORDER BY tasks_completed DESC\r\n          LIMIT 10\r\n        `,\r\n          )\r\n          .all();\r\n      }\r\n    } catch (error) {\r\n      console.warn('Could not get agent performance:', error.message);\r\n    }\r\n\r\n    if (agentPerf.length > 0) {\r\n      console.log('\\n' + chalk.cyan('Top Performing Agents:'));\r\n      agentPerf.forEach((agent, index) => {\r\n        const successRate =\r\n          agent.tasks_assigned > 0\r\n            ? ((agent.tasks_completed / agent.tasks_assigned) * 100).toFixed(1)\r\n            : '0';\r\n        console.log(`  ${index + 1}. ${agent.name} (${agent.type})`);\r\n        console.log(\r\n          `     Tasks: ${agent.tasks_completed}/${agent.tasks_assigned} (${successRate}%)`,\r\n        );\r\n        if (agent.avg_completion_minutes) {\r\n          console.log(`     Avg Time: ${agent.avg_completion_minutes.toFixed(1)} minutes`);\r\n        }\r\n      });\r\n    }\r\n\r\n    // Get swarm performance\r\n    const swarmPerf = db\r\n      .prepare(\r\n        `\r\n      SELECT \r\n        s.name,\r\n        s.objective,\r\n        (SELECT COUNT(*) FROM agents a WHERE a.swarm_id = s.id) as agent_count,\r\n        (SELECT COUNT(*) FROM tasks t WHERE t.swarm_id = s.id) as task_count,\r\n        (SELECT COUNT(*) FROM tasks t WHERE t.swarm_id = s.id AND t.status = 'completed') as completed_count,\r\n        (SELECT COUNT(*) FROM collective_memory cm WHERE cm.swarm_id = s.id) as memory_entries,\r\n        (SELECT COUNT(*) FROM consensus_decisions cd WHERE cd.swarm_id = s.id) as consensus_count\r\n      FROM swarms s\r\n      WHERE s.status = 'active'\r\n      ORDER BY s.created_at DESC\r\n      LIMIT 5\r\n    `,\r\n      )\r\n      .all();\r\n\r\n    if (swarmPerf.length > 0) {\r\n      console.log('\\n' + chalk.cyan('Active Swarm Performance:'));\r\n      swarmPerf.forEach((swarm) => {\r\n        const successRate =\r\n          swarm.task_count > 0\r\n            ? ((swarm.completed_count / swarm.task_count) * 100).toFixed(1)\r\n            : '0';\r\n        console.log(`\\n  ${chalk.yellow(swarm.name)}`);\r\n        console.log(`  Objective: ${swarm.objective.substring(0, 50)}...`);\r\n        console.log(\r\n          `  Agents: ${swarm.agent_count}, Tasks: ${swarm.completed_count}/${swarm.task_count} (${successRate}%)`,\r\n        );\r\n        console.log(\r\n          `  Memory: ${swarm.memory_entries} entries, Consensus: ${swarm.consensus_count} decisions`,\r\n        );\r\n      });\r\n    }\r\n\r\n    // Get performance insights\r\n    let avgTaskTime = { avg_minutes: null };\r\n    try {\r\n      // Check if completed_at exists\r\n      const hasCompletedAt = db\r\n        .prepare(\r\n          `\r\n        SELECT COUNT(*) as count FROM pragma_table_info('tasks') \r\n        WHERE name = 'completed_at'\r\n      `,\r\n        )\r\n        .get();\r\n\r\n      if (hasCompletedAt && hasCompletedAt.count > 0) {\r\n        avgTaskTime = db\r\n          .prepare(\r\n            `\r\n          SELECT \r\n            AVG(CASE WHEN completed_at IS NOT NULL \r\n              THEN (julianday(completed_at) - julianday(created_at)) * 24 * 60 \r\n              ELSE NULL END) as avg_minutes\r\n          FROM tasks\r\n          WHERE status = 'completed'\r\n        `,\r\n          )\r\n          .get();\r\n      }\r\n    } catch (error) {\r\n      console.warn('Could not calculate average task time:', error.message);\r\n    }\r\n\r\n    // Get agent type performance\r\n    let agentTypePerf = [];\r\n    try {\r\n      // Check if completed_at exists\r\n      const hasCompletedAt = db\r\n        .prepare(\r\n          `\r\n        SELECT COUNT(*) as count FROM pragma_table_info('tasks') \r\n        WHERE name = 'completed_at'\r\n      `,\r\n        )\r\n        .get();\r\n\r\n      if (hasCompletedAt && hasCompletedAt.count > 0) {\r\n        agentTypePerf = db\r\n          .prepare(\r\n            `\r\n          SELECT \r\n            a.type,\r\n            COUNT(t.id) as total_tasks,\r\n            SUM(CASE WHEN t.status = 'completed' THEN 1 ELSE 0 END) as completed_tasks,\r\n            AVG(CASE WHEN t.completed_at IS NOT NULL \r\n              THEN (julianday(t.completed_at) - julianday(t.created_at)) * 24 * 60 \r\n              ELSE NULL END) as avg_completion_minutes\r\n          FROM agents a\r\n          LEFT JOIN tasks t ON a.id = t.agent_id\r\n          GROUP BY a.type\r\n          HAVING total_tasks > 0\r\n          ORDER BY completed_tasks DESC\r\n        `,\r\n          )\r\n          .all();\r\n      } else {\r\n        // Simpler query without completed_at\r\n        agentTypePerf = db\r\n          .prepare(\r\n            `\r\n          SELECT \r\n            a.type,\r\n            COUNT(t.id) as total_tasks,\r\n            SUM(CASE WHEN t.status = 'completed' THEN 1 ELSE 0 END) as completed_tasks,\r\n            NULL as avg_completion_minutes\r\n          FROM agents a\r\n          LEFT JOIN tasks t ON a.id = t.agent_id\r\n          GROUP BY a.type\r\n          HAVING total_tasks > 0\r\n          ORDER BY completed_tasks DESC\r\n        `,\r\n          )\r\n          .all();\r\n      }\r\n    } catch (error) {\r\n      console.warn('Could not get agent type performance:', error.message);\r\n    }\r\n\r\n    if (avgTaskTime.avg_minutes) {\r\n      console.log('\\n' + chalk.cyan('Performance Insights:'));\r\n      console.log(`  Average Task Completion Time: ${avgTaskTime.avg_minutes.toFixed(1)} minutes`);\r\n\r\n      if (agentTypePerf.length > 0) {\r\n        console.log('\\n' + chalk.cyan('Agent Type Performance:'));\r\n        agentTypePerf.forEach((type) => {\r\n          const successRate =\r\n            type.total_tasks > 0\r\n              ? ((type.completed_tasks / type.total_tasks) * 100).toFixed(1)\r\n              : '0';\r\n          console.log(\r\n            `  ${type.type.charAt(0).toUpperCase() + type.type.slice(1)}: ${type.completed_tasks}/${type.total_tasks} (${successRate}%)`,\r\n          );\r\n          if (type.avg_completion_minutes) {\r\n            console.log(`    Average time: ${type.avg_completion_minutes.toFixed(1)} minutes`);\r\n          }\r\n        });\r\n      }\r\n    }\r\n\r\n    console.log('\\n');\r\n    db.close();\r\n  } catch (error) {\r\n    console.error(chalk.red('Error:'), error.message);\r\n    exit(1);\r\n  }\r\n}\r\n\r\n/**\r\n * Manage collective memory wizard\r\n */\r\nasync function manageMemoryWizard() {\r\n  console.log(chalk.blue('\\nüß† Collective Memory Management\\n'));\r\n\r\n  const { action } = await inquirer.prompt([\r\n    {\r\n      type: 'list',\r\n      name: 'action',\r\n      message: 'What would you like to do with collective memory?',\r\n      choices: [\r\n        { name: 'üìã View all memories', value: 'list' },\r\n        { name: 'üîç Search memories', value: 'search' },\r\n        { name: 'üíæ Store new memory', value: 'store' },\r\n        { name: 'üìä Memory statistics', value: 'stats' },\r\n        { name: 'üóëÔ∏è Clean old memories', value: 'clean' },\r\n        { name: 'üì§ Export memory backup', value: 'export' },\r\n        { name: '‚¨ÖÔ∏è Back to main menu', value: 'back' },\r\n      ],\r\n    },\r\n  ]);\r\n\r\n  switch (action) {\r\n    case 'list':\r\n      await listMemories();\r\n      break;\r\n    case 'search':\r\n      await searchMemories();\r\n      break;\r\n    case 'store':\r\n      await storeMemoryWizard();\r\n      break;\r\n    case 'stats':\r\n      await showMemoryStats();\r\n      break;\r\n    case 'clean':\r\n      await cleanMemories();\r\n      break;\r\n    case 'export':\r\n      await exportMemoryBackup();\r\n      break;\r\n    case 'back':\r\n      await hiveMindWizard();\r\n      return;\r\n  }\r\n\r\n  // Ask if user wants to continue\r\n  const { continue: continueAction } = await inquirer.prompt([\r\n    {\r\n      type: 'confirm',\r\n      name: 'continue',\r\n      message: 'Would you like to perform another memory operation?',\r\n      default: true,\r\n    },\r\n  ]);\r\n\r\n  if (continueAction) {\r\n    await manageMemoryWizard();\r\n  }\r\n}\r\n\r\n/**\r\n * Configure hive mind wizard\r\n */\r\nasync function configureWizard() {\r\n  // TODO: Implement configuration wizard\r\n  console.log(chalk.yellow('Configuration wizard coming soon...'));\r\n}\r\n\r\n/**\r\n * Main hive mind command handler\r\n */\r\nexport async function hiveMindCommand(args, flags) {\r\n  const subcommand = args[0];\r\n  const subArgs = args.slice(1);\r\n\r\n  // Handle help flags\r\n  if (\r\n    !subcommand ||\r\n    subcommand === '--help' ||\r\n    subcommand === '-h' ||\r\n    subcommand === 'help' ||\r\n    flags.help\r\n  ) {\r\n    showHiveMindHelp();\r\n    return;\r\n  }\r\n\r\n  // Warn about non-interactive environments for certain commands\r\n  if ((subcommand === 'spawn' && (flags.claude || flags.spawn)) || subcommand === 'wizard') {\r\n    warnNonInteractive('hive-mind ' + subcommand);\r\n  }\r\n\r\n  switch (subcommand) {\r\n    case 'init':\r\n      await initHiveMind(flags);\r\n      break;\r\n\r\n    case 'spawn':\r\n      // Check for non-interactive mode FIRST (like alpha.83)\r\n      if (flags['non-interactive'] || flags.nonInteractive) {\r\n        // In non-interactive mode, skip wizard and use defaults\r\n        if (subArgs.length === 0) {\r\n          console.error(chalk.red('Error: Objective required in non-interactive mode'));\r\n          console.log('Usage: claude-flow hive-mind spawn \"Your objective\" --non-interactive');\r\n          return;\r\n        }\r\n        await spawnSwarm(subArgs, flags);\r\n      } else if (flags.wizard || subArgs.length === 0) {\r\n        await spawnSwarmWizard();\r\n      } else {\r\n        await spawnSwarm(subArgs, flags);\r\n      }\r\n      break;\r\n\r\n    case 'status':\r\n      await showStatus(flags);\r\n      break;\r\n\r\n    case 'sessions':\r\n      await showSessions(flags);\r\n      break;\r\n\r\n    case 'resume':\r\n      await resumeSession(subArgs, flags);\r\n      break;\r\n\r\n    case 'stop':\r\n      await stopSession(subArgs, flags);\r\n      break;\r\n\r\n    case 'consensus':\r\n      await showConsensus(flags);\r\n      break;\r\n\r\n    case 'memory':\r\n      await manageMemoryWizard();\r\n      break;\r\n\r\n    case 'metrics':\r\n      await showMetrics(flags);\r\n      break;\r\n\r\n    case 'wizard':\r\n      await hiveMindWizard(flags);\r\n      break;\r\n\r\n    case 'help':\r\n    case '--help':\r\n    case '-h':\r\n      showHiveMindHelp();\r\n      break;\r\n\r\n    default:\r\n      console.error(chalk.red(`Unknown subcommand: ${subcommand}`));\r\n      console.log('Run \"claude-flow hive-mind help\" for usage information');\r\n      exit(1);\r\n  }\r\n}\r\n\r\n/**\r\n * List all memories in the collective memory store\r\n */\r\nasync function listMemories() {\r\n  try {\r\n    console.log(chalk.blue('\\nüìã Collective Memory Store\\n'));\r\n\r\n    // Read directly from hive.db collective_memory table\r\n    const dbPath = path.join(cwd(), '.hive-mind', 'hive.db');\r\n    const db = new Database(dbPath);\r\n\r\n    const memories = db\r\n      .prepare(\r\n        `\r\n        SELECT cm.*, s.name as swarm_name\r\n        FROM collective_memory cm\r\n        LEFT JOIN swarms s ON cm.swarm_id = s.id\r\n        ORDER BY cm.created_at DESC\r\n        LIMIT 50\r\n      `,\r\n      )\r\n      .all();\r\n\r\n    db.close();\r\n\r\n    if (!memories || memories.length === 0) {\r\n      console.log(chalk.yellow('No memories found in the collective store.'));\r\n      console.log(\r\n        chalk.gray('Try storing some memories first using the \"üíæ Store new memory\" option.'),\r\n      );\r\n      return;\r\n    }\r\n\r\n    console.log(chalk.gray(`Found ${memories.length} memories in the collective store:\\n`));\r\n\r\n    memories.forEach((memory, index) => {\r\n      console.log(chalk.cyan(`${index + 1}. ${memory.key}`));\r\n      console.log(`   Swarm: ${memory.swarm_name || memory.swarm_id}`);\r\n      console.log(`   Type: ${memory.type || 'knowledge'}`);\r\n      console.log(`   Created: ${new Date(memory.created_at).toLocaleString()}`);\r\n      console.log(`   Created by: ${memory.created_by || 'system'}`);\r\n      \r\n      // Parse and display value\r\n      let displayValue = memory.value;\r\n      try {\r\n        const parsed = JSON.parse(memory.value);\r\n        displayValue = JSON.stringify(parsed);\r\n      } catch {\r\n        // Keep as string\r\n      }\r\n      \r\n      if (displayValue.length > 100) {\r\n        console.log(`   Value: ${displayValue.substring(0, 100)}...`);\r\n      } else {\r\n        console.log(`   Value: ${displayValue}`);\r\n      }\r\n      \r\n      if (memory.confidence !== null && memory.confidence !== 1) {\r\n        console.log(`   Confidence: ${(memory.confidence * 100).toFixed(1)}%`);\r\n      }\r\n      \r\n      console.log('');\r\n    });\r\n  } catch (error) {\r\n    console.error(chalk.red('Error listing memories:'), error.message);\r\n    console.log(chalk.gray('This might be because no memories have been stored yet.'));\r\n  }\r\n}\r\n\r\n/**\r\n * Search memories by keyword\r\n */\r\nasync function searchMemories() {\r\n  try {\r\n    const { searchTerm } = await inquirer.prompt([\r\n      {\r\n        type: 'input',\r\n        name: 'searchTerm',\r\n        message: 'Enter search term:',\r\n        validate: (input) => input.length > 0,\r\n      },\r\n    ]);\r\n\r\n    console.log(chalk.blue(`\\nüîç Searching for: \"${searchTerm}\"\\n`));\r\n\r\n    // Search directly in hive.db collective_memory table\r\n    const dbPath = path.join(cwd(), '.hive-mind', 'hive.db');\r\n    const db = new Database(dbPath);\r\n\r\n    const searchPattern = `%${searchTerm}%`;\r\n    const memories = db\r\n      .prepare(\r\n        `\r\n        SELECT cm.*, s.name as swarm_name\r\n        FROM collective_memory cm\r\n        LEFT JOIN swarms s ON cm.swarm_id = s.id\r\n        WHERE cm.key LIKE ? OR cm.value LIKE ? OR cm.type LIKE ?\r\n        ORDER BY cm.created_at DESC\r\n        LIMIT 50\r\n      `,\r\n      )\r\n      .all(searchPattern, searchPattern, searchPattern);\r\n\r\n    db.close();\r\n\r\n    if (!memories || memories.length === 0) {\r\n      console.log(chalk.yellow('No memories found matching your search.'));\r\n      return;\r\n    }\r\n\r\n    console.log(chalk.gray(`Found ${memories.length} memories matching \"${searchTerm}\":\\n`));\r\n\r\n    memories.forEach((memory, index) => {\r\n      console.log(chalk.green(`${index + 1}. ${memory.key}`));\r\n      console.log(`   Swarm: ${memory.swarm_name || memory.swarm_id}`);\r\n      console.log(`   Type: ${memory.type || 'knowledge'}`);\r\n      console.log(`   Created: ${new Date(memory.created_at).toLocaleString()}`);\r\n      \r\n      // Parse and display value with highlighting\r\n      let displayValue = memory.value;\r\n      try {\r\n        const parsed = JSON.parse(memory.value);\r\n        displayValue = JSON.stringify(parsed, null, 2);\r\n      } catch {\r\n        // Keep as string\r\n      }\r\n      \r\n      console.log(`   Value: ${displayValue}`);\r\n      console.log('');\r\n    });\r\n  } catch (error) {\r\n    console.error(chalk.red('Error searching memories:'), error.message);\r\n  }\r\n}\r\n\r\n/**\r\n * Store new memory wizard\r\n */\r\nasync function storeMemoryWizard() {\r\n  try {\r\n    const answers = await inquirer.prompt([\r\n      {\r\n        type: 'input',\r\n        name: 'key',\r\n        message: 'Memory key (identifier):',\r\n        validate: (input) => input.length > 0,\r\n      },\r\n      {\r\n        type: 'list',\r\n        name: 'category',\r\n        message: 'Memory category:',\r\n        choices: [\r\n          'consensus',\r\n          'decision',\r\n          'pattern',\r\n          'learning',\r\n          'coordination',\r\n          'performance',\r\n          'configuration',\r\n          'general',\r\n        ],\r\n      },\r\n      {\r\n        type: 'editor',\r\n        name: 'value',\r\n        message: 'Memory content (JSON or text):',\r\n      },\r\n    ]);\r\n\r\n    const mcpWrapper = await getMcpWrapper();\r\n    let memoryValue;\r\n\r\n    // Try to parse as JSON, fall back to string\r\n    try {\r\n      memoryValue = JSON.parse(answers.value);\r\n    } catch {\r\n      memoryValue = answers.value;\r\n    }\r\n\r\n    await mcpWrapper.storeMemory('hive-mind', answers.key, memoryValue, answers.category);\r\n\r\n    console.log(chalk.green(`\\n‚úÖ Memory stored successfully!`));\r\n    console.log(`Key: ${answers.key}`);\r\n    console.log(`Category: ${answers.category}`);\r\n  } catch (error) {\r\n    console.error(chalk.red('Error storing memory:'), error.message);\r\n  }\r\n}\r\n\r\n/**\r\n * Show memory statistics\r\n */\r\nasync function showMemoryStats() {\r\n  try {\r\n    console.log(chalk.blue('\\nüìä Memory Statistics\\n'));\r\n\r\n    const mcpWrapper = await getMcpWrapper();\r\n\r\n    // Search for all memories with an empty pattern to get everything\r\n    const searchResult = await mcpWrapper.searchMemory('hive-mind', '');\r\n\r\n    // Handle different possible response structures\r\n    let memories = [];\r\n    if (searchResult && Array.isArray(searchResult.results)) {\r\n      memories = searchResult.results;\r\n    } else if (searchResult && Array.isArray(searchResult)) {\r\n      memories = searchResult;\r\n    } else if (searchResult && searchResult.data && Array.isArray(searchResult.data)) {\r\n      memories = searchResult.data;\r\n    }\r\n\r\n    if (!memories || memories.length === 0) {\r\n      console.log(chalk.yellow('No memories found.'));\r\n      console.log(chalk.gray('Use \"Store new memory\" to create your first memory.'));\r\n      return;\r\n    }\r\n\r\n    // Calculate statistics\r\n    const stats = {\r\n      total: memories.length,\r\n      categories: {},\r\n      oldestDate: null,\r\n      newestDate: null,\r\n      totalSize: 0,\r\n    };\r\n\r\n    memories.forEach((memory) => {\r\n      // Count by category\r\n      const category = memory.category || memory.type || 'general';\r\n      stats.categories[category] = (stats.categories[category] || 0) + 1;\r\n\r\n      // Track dates\r\n      const date = new Date(memory.timestamp || Date.now());\r\n      if (!stats.oldestDate || date < stats.oldestDate) {\r\n        stats.oldestDate = date;\r\n      }\r\n      if (!stats.newestDate || date > stats.newestDate) {\r\n        stats.newestDate = date;\r\n      }\r\n\r\n      // Estimate size\r\n      stats.totalSize += JSON.stringify(memory).length;\r\n    });\r\n\r\n    console.log(chalk.cyan('Total memories:'), stats.total);\r\n    console.log(chalk.cyan('Estimated size:'), `${(stats.totalSize / 1024).toFixed(2)} KB`);\r\n    console.log(\r\n      chalk.cyan('Date range:'),\r\n      `${stats.oldestDate?.toLocaleDateString()} - ${stats.newestDate?.toLocaleDateString()}`,\r\n    );\r\n\r\n    console.log(chalk.cyan('\\nBy category:'));\r\n    Object.entries(stats.categories).forEach(([category, count]) => {\r\n      console.log(`  ${category}: ${count}`);\r\n    });\r\n  } catch (error) {\r\n    console.error(chalk.red('Error getting memory stats:'), error.message);\r\n  }\r\n}\r\n\r\n/**\r\n * Clean old memories\r\n */\r\nasync function cleanMemories() {\r\n  try {\r\n    const { days } = await inquirer.prompt([\r\n      {\r\n        type: 'number',\r\n        name: 'days',\r\n        message: 'Remove memories older than how many days?',\r\n        default: 30,\r\n        validate: (input) => input > 0,\r\n      },\r\n    ]);\r\n\r\n    const { confirm } = await inquirer.prompt([\r\n      {\r\n        type: 'confirm',\r\n        name: 'confirm',\r\n        message: `Are you sure you want to delete memories older than ${days} days?`,\r\n        default: false,\r\n      },\r\n    ]);\r\n\r\n    if (!confirm) {\r\n      console.log(chalk.yellow('Operation cancelled.'));\r\n      return;\r\n    }\r\n\r\n    const mcpWrapper = await getMcpWrapper();\r\n\r\n    // Get all memories first\r\n    const searchResult = await mcpWrapper.searchMemory('hive-mind', '');\r\n\r\n    // Handle different possible response structures\r\n    let memories = [];\r\n    if (searchResult && Array.isArray(searchResult.results)) {\r\n      memories = searchResult.results;\r\n    } else if (searchResult && Array.isArray(searchResult)) {\r\n      memories = searchResult;\r\n    } else if (searchResult && searchResult.data && Array.isArray(searchResult.data)) {\r\n      memories = searchResult.data;\r\n    }\r\n\r\n    const cutoffDate = new Date();\r\n    cutoffDate.setDate(cutoffDate.getDate() - days);\r\n\r\n    // Filter memories older than cutoff date\r\n    const oldMemories = memories.filter((memory) => {\r\n      const memoryDate = new Date(memory.timestamp || 0);\r\n      return memoryDate < cutoffDate;\r\n    });\r\n\r\n    if (oldMemories.length === 0) {\r\n      console.log(chalk.yellow('\\nüéâ No old memories found to clean.'));\r\n      return;\r\n    }\r\n\r\n    console.log(chalk.green(`\\n‚úÖ Found ${oldMemories.length} old memories to clean.`));\r\n    console.log(chalk.gray('Note: Individual memory deletion not yet implemented in MCPWrapper.'));\r\n    console.log(chalk.gray('Consider implementing batch deletion or memory lifecycle management.'));\r\n  } catch (error) {\r\n    console.error(chalk.red('Error cleaning memories:'), error.message);\r\n  }\r\n}\r\n\r\n/**\r\n * Export memory backup\r\n */\r\nasync function exportMemoryBackup() {\r\n  try {\r\n    const { filename } = await inquirer.prompt([\r\n      {\r\n        type: 'input',\r\n        name: 'filename',\r\n        message: 'Export filename:',\r\n        default: `hive-mind-memory-backup-${new Date().toISOString().split('T')[0]}.json`,\r\n      },\r\n    ]);\r\n\r\n    const mcpWrapper = await getMcpWrapper();\r\n\r\n    // Get all memories using search\r\n    const searchResult = await mcpWrapper.searchMemory('hive-mind', '');\r\n\r\n    // Handle different possible response structures\r\n    let memories = [];\r\n    if (searchResult && Array.isArray(searchResult.results)) {\r\n      memories = searchResult.results;\r\n    } else if (searchResult && Array.isArray(searchResult)) {\r\n      memories = searchResult;\r\n    } else if (searchResult && searchResult.data && Array.isArray(searchResult.data)) {\r\n      memories = searchResult.data;\r\n    }\r\n\r\n    const backup = {\r\n      exportDate: new Date().toISOString(),\r\n      version: '1.0',\r\n      totalMemories: memories.length,\r\n      namespace: 'hive-mind',\r\n      memories: memories,\r\n    };\r\n\r\n    const fs = await import('fs');\r\n    fs.writeFileSync(filename, JSON.stringify(backup, null, 2));\r\n\r\n    console.log(chalk.green(`\\n‚úÖ Memory backup exported to: ${filename}`));\r\n    console.log(chalk.cyan(`Exported ${memories.length} memories`));\r\n  } catch (error) {\r\n    console.error(chalk.red('Error exporting memory backup:'), error.message);\r\n  }\r\n}\r\n\r\n/**\r\n * Get active session ID for a swarm\r\n */\r\nasync function getActiveSessionId(swarmId) {\r\n  const sessionManager = new HiveMindSessionManager();\r\n  try {\r\n    const sessions = await sessionManager.getActiveSessions();\r\n    const activeSession = sessions.find(s => s.swarm_id === swarmId && s.status === 'active');\r\n    return activeSession ? activeSession.id : null;\r\n  } finally {\r\n    sessionManager.close();\r\n  }\r\n}\r\n\r\n/**\r\n * Spawn Claude Code with Hive Mind coordination instructions\r\n */\r\nasync function spawnClaudeCodeInstances(swarmId, swarmName, objective, workers, flags) {\r\n  console.log('\\n' + chalk.bold('üöÄ Launching Claude Code with Hive Mind Coordination'));\r\n  console.log(chalk.gray('‚îÄ'.repeat(60)));\r\n\r\n  const spinner = ora('Preparing Hive Mind coordination prompt...').start();\r\n\r\n  try {\r\n    // Generate comprehensive Hive Mind prompt\r\n    const workerGroups = groupWorkersByType(workers);\r\n    const hiveMindPrompt = generateHiveMindPrompt(\r\n      swarmId,\r\n      swarmName,\r\n      objective,\r\n      workers,\r\n      workerGroups,\r\n      flags,\r\n    );\r\n\r\n    spinner.succeed('Hive Mind coordination prompt ready!');\r\n\r\n    // Display coordination summary\r\n    console.log('\\n' + chalk.bold('üß† Hive Mind Configuration'));\r\n    console.log(chalk.gray('‚îÄ'.repeat(60)));\r\n    console.log(chalk.cyan('Swarm ID:'), swarmId);\r\n    console.log(chalk.cyan('Objective:'), objective);\r\n    console.log(chalk.cyan('Queen Type:'), flags.queenType || 'strategic');\r\n    console.log(chalk.cyan('Worker Count:'), workers.length);\r\n    console.log(chalk.cyan('Worker Types:'), Object.keys(workerGroups).join(', '));\r\n    console.log(chalk.cyan('Consensus Algorithm:'), flags.consensus || 'majority');\r\n    console.log(chalk.cyan('MCP Tools:'), 'Full Claude-Flow integration enabled');\r\n\r\n    try {\r\n      // ALWAYS save the prompt file first (fix for issue #330)\r\n      // Ensure sessions directory exists\r\n      const sessionsDir = path.join('.hive-mind', 'sessions');\r\n      await mkdirAsync(sessionsDir, { recursive: true });\r\n\r\n      const promptFile = path.join(sessionsDir, `hive-mind-prompt-${swarmId}.txt`);\r\n      await writeFile(promptFile, hiveMindPrompt, 'utf8');\r\n      console.log(chalk.green(`\\n‚úì Hive Mind prompt saved to: ${promptFile}`));\r\n\r\n      // Check if claude command exists\r\n      const { spawn: childSpawn, execSync } = await import('child_process');\r\n      let claudeAvailable = false;\r\n\r\n      try {\r\n        execSync('which claude', { stdio: 'ignore' });\r\n        claudeAvailable = true;\r\n      } catch {\r\n        console.log(chalk.yellow('\\n‚ö†Ô∏è  Claude Code CLI not found in PATH'));\r\n        console.log(chalk.gray('Install it with: npm install -g @anthropic-ai/claude-code'));\r\n        console.log(chalk.gray('\\nFalling back to displaying instructions...'));\r\n      }\r\n\r\n      if (claudeAvailable && !flags.dryRun) {\r\n        // Inject memory coordination protocol into CLAUDE.md\r\n        try {\r\n          const { injectMemoryProtocol, enhanceHiveMindPrompt } = await import('./inject-memory-protocol.js');\r\n          await injectMemoryProtocol();\r\n          \r\n          // Enhance the prompt with memory coordination instructions\r\n          hiveMindPrompt = enhanceHiveMindPrompt(hiveMindPrompt, workers);\r\n          console.log(chalk.green('üìù Memory coordination protocol injected into CLAUDE.md'));\r\n        } catch (err) {\r\n          // If injection module not available, continue with original prompt\r\n          console.log(chalk.yellow('‚ö†Ô∏è  Memory protocol injection not available, using standard prompt'));\r\n        }\r\n        \r\n        // Check if we should run in non-interactive mode\r\n        // Respect --non-interactive flag regardless of --claude\r\n        const isNonInteractive = flags['non-interactive'] || flags.nonInteractive;\r\n        \r\n        // Build arguments in correct order: flags first, then prompt\r\n        const claudeArgs = [];\r\n        \r\n        // Add non-interactive flags FIRST if needed\r\n        if (isNonInteractive) {\r\n          claudeArgs.push('-p'); // Print mode\r\n          claudeArgs.push('--output-format', 'stream-json'); // JSON streaming  \r\n          claudeArgs.push('--verbose'); // Verbose output\r\n          console.log(chalk.cyan('ü§ñ Running in non-interactive mode'));\r\n        }\r\n\r\n        // Add auto-permission flag BEFORE the prompt\r\n        if (flags['dangerously-skip-permissions'] !== false && !flags['no-auto-permissions']) {\r\n          claudeArgs.push('--dangerously-skip-permissions');\r\n          if (!isNonInteractive) {\r\n            console.log(\r\n              chalk.yellow(\r\n                'üîì Using --dangerously-skip-permissions by default for seamless hive-mind execution',\r\n              ),\r\n            );\r\n          }\r\n        }\r\n        \r\n        // Add the prompt as the LAST argument\r\n        claudeArgs.push(hiveMindPrompt);\r\n\r\n        // Spawn claude with properly ordered arguments\r\n        const claudeProcess = childSpawn('claude', claudeArgs, {\r\n          stdio: 'inherit',\r\n          shell: false,\r\n        });\r\n\r\n        // Track child process PID in session\r\n        const sessionManager = new HiveMindSessionManager();\r\n        const sessionId = await getActiveSessionId(swarmId);\r\n        if (sessionId && claudeProcess.pid) {\r\n          sessionManager.addChildPid(sessionId, claudeProcess.pid);\r\n        }\r\n\r\n        // Set up SIGINT handler for automatic session pausing\r\n        let isExiting = false;\r\n        const sigintHandler = async () => {\r\n          if (isExiting) return;\r\n          isExiting = true;\r\n\r\n          console.log('\\n\\n' + chalk.yellow('‚è∏Ô∏è  Pausing session and terminating Claude Code...'));\r\n          \r\n          try {\r\n            // Terminate Claude Code process\r\n            if (claudeProcess && !claudeProcess.killed) {\r\n              claudeProcess.kill('SIGTERM');\r\n            }\r\n\r\n            // Save checkpoint and pause session\r\n            if (sessionId) {\r\n              const checkpointData = {\r\n                timestamp: new Date().toISOString(),\r\n                swarmId,\r\n                objective,\r\n                status: 'paused_by_user',\r\n                reason: 'User pressed Ctrl+C during Claude Code execution',\r\n                claudePid: claudeProcess.pid,\r\n              };\r\n              \r\n              await sessionManager.saveCheckpoint(sessionId, 'auto-pause-claude', checkpointData);\r\n              await sessionManager.pauseSession(sessionId);\r\n              \r\n              console.log(chalk.green('‚úì') + ' Session paused successfully');\r\n              console.log(chalk.cyan('\\nTo resume this session, run:'));\r\n              console.log(chalk.bold(`  claude-flow hive-mind resume ${sessionId}`));\r\n            }\r\n            \r\n            sessionManager.close();\r\n            process.exit(0);\r\n          } catch (error) {\r\n            console.error(chalk.red('Error pausing session:'), error.message);\r\n            sessionManager.close();\r\n            process.exit(1);\r\n          }\r\n        };\r\n\r\n        // Register SIGINT handler\r\n        process.on('SIGINT', sigintHandler);\r\n        process.on('SIGTERM', sigintHandler);\r\n\r\n        // Handle stdout\r\n        if (claudeProcess.stdout) {\r\n          claudeProcess.stdout.on('data', (data) => {\r\n            console.log(data.toString());\r\n          });\r\n        }\r\n\r\n        // Handle stderr\r\n        if (claudeProcess.stderr) {\r\n          claudeProcess.stderr.on('data', (data) => {\r\n            console.error(chalk.red(data.toString()));\r\n          });\r\n        }\r\n\r\n        // Handle process exit\r\n        claudeProcess.on('exit', (code) => {\r\n          // Remove child PID from session\r\n          if (sessionId && claudeProcess.pid) {\r\n            sessionManager.removeChildPid(sessionId, claudeProcess.pid);\r\n            sessionManager.close();\r\n          }\r\n\r\n          if (code === 0) {\r\n            console.log(chalk.green('\\n‚úì Claude Code completed successfully'));\r\n          } else if (code !== null) {\r\n            console.log(chalk.red(`\\n‚úó Claude Code exited with code ${code}`));\r\n          }\r\n        });\r\n\r\n        console.log(chalk.green('\\n‚úì Claude Code launched with Hive Mind coordination'));\r\n        console.log(chalk.blue('  The Queen coordinator will orchestrate all worker agents'));\r\n        console.log(\r\n          chalk.blue('  Use MCP tools for collective intelligence and task distribution'),\r\n        );\r\n        console.log(chalk.gray(`  Prompt file saved at: ${promptFile}`));\r\n      } else if (flags.dryRun) {\r\n        console.log(chalk.blue('\\nDry run - would execute Claude Code with prompt:'));\r\n        console.log(chalk.gray('Prompt length:'), hiveMindPrompt.length, 'characters');\r\n        console.log(chalk.gray('\\nFirst 500 characters of prompt:'));\r\n        console.log(chalk.yellow(hiveMindPrompt.substring(0, 500) + '...'));\r\n        console.log(chalk.gray(`\\nFull prompt saved to: ${promptFile}`));\r\n      } else {\r\n        // Claude not available - show instructions with already saved prompt\r\n        console.log(chalk.yellow('\\nüìã Manual Execution Instructions:'));\r\n        console.log(chalk.gray('‚îÄ'.repeat(50)));\r\n        console.log(chalk.gray('1. Install Claude Code:'));\r\n        console.log(chalk.green('   npm install -g @anthropic-ai/claude-code'));\r\n        console.log(chalk.gray('\\n2. Run with the saved prompt:'));\r\n        console.log(chalk.green(`   claude < ${promptFile}`));\r\n        console.log(chalk.gray('\\n3. Or copy the prompt manually:'));\r\n        console.log(chalk.green(`   cat ${promptFile} | claude`));\r\n        console.log(chalk.gray('\\n4. With auto-permissions:'));\r\n        console.log(chalk.green(`   claude --dangerously-skip-permissions < ${promptFile}`));\r\n      }\r\n    } catch (error) {\r\n      console.error(chalk.red('\\nFailed to launch Claude Code:'), error.message);\r\n\r\n      // Save prompt as fallback\r\n      const promptFile = `hive-mind-prompt-${swarmId}-fallback.txt`;\r\n      await writeFile(promptFile, hiveMindPrompt, 'utf8');\r\n      console.log(chalk.green(`\\n‚úì Prompt saved to: ${promptFile}`));\r\n      console.log(chalk.yellow('\\nYou can run Claude Code manually with the saved prompt'));\r\n    }\r\n\r\n    console.log('\\n' + chalk.bold('üí° Pro Tips:'));\r\n    console.log(chalk.gray('‚îÄ'.repeat(30)));\r\n    console.log('‚Ä¢ Use --auto-spawn to launch instances automatically');\r\n    console.log('‚Ä¢ Add --verbose for detailed coordination context');\r\n    console.log('‚Ä¢ Monitor with: claude-flow hive-mind status');\r\n    console.log('‚Ä¢ Share memories: mcp__ruv-swarm__memory_usage');\r\n  } catch (error) {\r\n    spinner.fail('Failed to prepare Claude Code coordination');\r\n    console.error(chalk.red('Error:'), error.message);\r\n  }\r\n}\r\n\r\n/**\r\n * Generate comprehensive Hive Mind prompt for Claude Code\r\n */\r\nfunction generateHiveMindPrompt(swarmId, swarmName, objective, workers, workerGroups, flags) {\r\n  console.log(chalk.cyan(`\\nüîç generateHiveMindPrompt received objective: \"${objective}\"`));\r\n  const currentTime = new Date().toISOString();\r\n  const workerTypes = Object.keys(workerGroups);\r\n  const queenType = flags.queenType || 'strategic';\r\n  const consensusAlgorithm = flags.consensus || 'majority';\r\n\r\n  return `üß† HIVE MIND COLLECTIVE INTELLIGENCE SYSTEM\r\n‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\r\n\r\nYou are the Queen coordinator of a Hive Mind swarm with collective intelligence capabilities.\r\n\r\nHIVE MIND CONFIGURATION:\r\nüìå Swarm ID: ${swarmId}\r\nüìå Swarm Name: ${swarmName}\r\nüéØ Objective: ${objective}\r\nüëë Queen Type: ${queenType}\r\nüêù Worker Count: ${workers.length}\r\nü§ù Consensus Algorithm: ${consensusAlgorithm}\r\n‚è∞ Initialized: ${currentTime}\r\n\r\nWORKER DISTRIBUTION:\r\n${workerTypes.map((type) => `‚Ä¢ ${type}: ${workerGroups[type].length} agents`).join('\\n')}\r\n\r\nüîß AVAILABLE MCP TOOLS FOR HIVE MIND COORDINATION:\r\n\r\n1Ô∏è‚É£ **COLLECTIVE INTELLIGENCE**\r\n   mcp__claude-flow__consensus_vote    - Democratic decision making\r\n   mcp__claude-flow__memory_share      - Share knowledge across the hive\r\n   mcp__claude-flow__neural_sync       - Synchronize neural patterns\r\n   mcp__claude-flow__swarm_think       - Collective problem solving\r\n\r\n2Ô∏è‚É£ **QUEEN COORDINATION**\r\n   mcp__claude-flow__queen_command     - Issue directives to workers\r\n   mcp__claude-flow__queen_monitor     - Monitor swarm health\r\n   mcp__claude-flow__queen_delegate    - Delegate complex tasks\r\n   mcp__claude-flow__queen_aggregate   - Aggregate worker results\r\n\r\n3Ô∏è‚É£ **WORKER MANAGEMENT**\r\n   mcp__claude-flow__agent_spawn       - Create specialized workers\r\n   mcp__claude-flow__agent_assign      - Assign tasks to workers\r\n   mcp__claude-flow__agent_communicate - Inter-agent communication\r\n   mcp__claude-flow__agent_metrics     - Track worker performance\r\n\r\n4Ô∏è‚É£ **TASK ORCHESTRATION**\r\n   mcp__claude-flow__task_create       - Create hierarchical tasks\r\n   mcp__claude-flow__task_distribute   - Distribute work efficiently\r\n   mcp__claude-flow__task_monitor      - Track task progress\r\n   mcp__claude-flow__task_aggregate    - Combine task results\r\n\r\n5Ô∏è‚É£ **MEMORY & LEARNING**\r\n   mcp__claude-flow__memory_store      - Store collective knowledge\r\n   mcp__claude-flow__memory_retrieve   - Access shared memory\r\n   mcp__claude-flow__neural_train      - Learn from experiences\r\n   mcp__claude-flow__pattern_recognize - Identify patterns\r\n\r\nüìã HIVE MIND EXECUTION PROTOCOL:\r\n\r\nAs the Queen coordinator, you must:\r\n\r\n1. **INITIALIZE THE HIVE** (CRITICAL: Use Claude Code's Task Tool for Agents):\r\n   \r\n   Step 1: Optional MCP Coordination Setup (Single Message):\r\n   [MCP Tools - Coordination Only]:\r\n   ${workerTypes.map((type) => `   mcp__claude-flow__agent_spawn { \"type\": \"${type}\", \"count\": ${workerGroups[type].length} }`).join('\\n')}\r\n   mcp__claude-flow__memory_store { \"key\": \"hive/objective\", \"value\": \"${objective}\" }\r\n   mcp__claude-flow__memory_store { \"key\": \"hive/queen\", \"value\": \"${queenType}\" }\r\n   mcp__claude-flow__swarm_think { \"topic\": \"initial_strategy\" }\r\n   \r\n   Step 2: REQUIRED - Spawn ACTUAL Agents with Claude Code's Task Tool (Single Message):\r\n   [Claude Code Task Tool - CONCURRENT Agent Execution]:\r\n   ${workerTypes.map((type) => `   Task(\"${type.charAt(0).toUpperCase() + type.slice(1)} Agent\", \"You are a ${type} in the hive. Coordinate via hooks. ${getWorkerTypeInstructions(type).split('\\n')[0]}\", \"${type}\")`).join('\\n')}\r\n   \r\n   Step 3: Batch ALL Todos Together (Single TodoWrite Call):\r\n   TodoWrite { \"todos\": [\r\n     { \"id\": \"1\", \"content\": \"Initialize hive mind collective\", \"status\": \"in_progress\", \"priority\": \"high\" },\r\n     { \"id\": \"2\", \"content\": \"Establish consensus protocols\", \"status\": \"pending\", \"priority\": \"high\" },\r\n     { \"id\": \"3\", \"content\": \"Distribute initial tasks to workers\", \"status\": \"pending\", \"priority\": \"high\" },\r\n     { \"id\": \"4\", \"content\": \"Set up collective memory\", \"status\": \"pending\", \"priority\": \"high\" },\r\n     { \"id\": \"5\", \"content\": \"Monitor worker health\", \"status\": \"pending\", \"priority\": \"medium\" },\r\n     { \"id\": \"6\", \"content\": \"Aggregate worker outputs\", \"status\": \"pending\", \"priority\": \"medium\" },\r\n     { \"id\": \"7\", \"content\": \"Learn from patterns\", \"status\": \"pending\", \"priority\": \"low\" },\r\n     { \"id\": \"8\", \"content\": \"Optimize performance\", \"status\": \"pending\", \"priority\": \"low\" }\r\n   ] }\r\n\r\n2. **ESTABLISH COLLECTIVE INTELLIGENCE**:\r\n   - Use consensus_vote for major decisions\r\n   - Share all discoveries via memory_share\r\n   - Synchronize learning with neural_sync\r\n   - Coordinate strategy with swarm_think\r\n\r\n3. **QUEEN LEADERSHIP PATTERNS**:\r\n   ${\r\n     queenType === 'strategic'\r\n       ? `\r\n   - Focus on high-level planning and coordination\r\n   - Delegate implementation details to workers\r\n   - Monitor overall progress and adjust strategy\r\n   - Make executive decisions when consensus fails`\r\n       : ''\r\n   }\r\n   ${\r\n     queenType === 'tactical'\r\n       ? `\r\n   - Manage detailed task breakdowns and assignments\r\n   - Closely monitor worker progress and efficiency\r\n   - Optimize resource allocation and load balancing\r\n   - Intervene directly when workers need guidance`\r\n       : ''\r\n   }\r\n   ${\r\n     queenType === 'adaptive'\r\n       ? `\r\n   - Learn from swarm performance and adapt strategies\r\n   - Experiment with different coordination patterns\r\n   - Use neural training to improve over time\r\n   - Balance between strategic and tactical approaches`\r\n       : ''\r\n   }\r\n\r\n4. **WORKER COORDINATION**:\r\n   - Spawn workers based on task requirements\r\n   - Assign tasks according to worker specializations\r\n   - Enable peer-to-peer communication for collaboration\r\n   - Monitor and rebalance workloads as needed\r\n\r\n5. **CONSENSUS MECHANISMS**:\r\n   ${consensusAlgorithm === 'majority' ? '- Decisions require >50% worker agreement' : ''}\r\n   ${consensusAlgorithm === 'unanimous' ? '- All workers must agree for major decisions' : ''}\r\n   ${consensusAlgorithm === 'weighted' ? '- Worker votes weighted by expertise and performance' : ''}\r\n   ${consensusAlgorithm === 'quorum' ? '- Decisions require 2/3 worker participation' : ''}\r\n\r\n6. **COLLECTIVE MEMORY**:\r\n   - Store all important decisions in shared memory\r\n   - Tag memories with worker IDs and timestamps\r\n   - Use memory namespaces: hive/, queen/, workers/, tasks/\r\n   - Implement memory consensus for critical data\r\n\r\n7. **PERFORMANCE OPTIMIZATION**:\r\n   - Monitor swarm metrics continuously\r\n   - Identify and resolve bottlenecks\r\n   - Train neural networks on successful patterns\r\n   - Scale worker count based on workload\r\n\r\nüí° HIVE MIND BEST PRACTICES:\r\n\r\n‚úÖ ALWAYS use BatchTool for parallel operations\r\n‚úÖ Store decisions in collective memory immediately\r\n‚úÖ Use consensus for critical path decisions\r\n‚úÖ Monitor worker health and reassign if needed\r\n‚úÖ Learn from failures and adapt strategies\r\n‚úÖ Maintain constant inter-agent communication\r\n‚úÖ Aggregate results before final delivery\r\n\r\n‚ùå NEVER make unilateral decisions without consensus\r\n‚ùå NEVER let workers operate in isolation\r\n‚ùå NEVER ignore performance metrics\r\n‚ùå NEVER skip memory synchronization\r\n‚ùå NEVER abandon failing workers\r\n\r\nüéØ OBJECTIVE EXECUTION STRATEGY:\r\n\r\nFor the objective: \"${objective}\"\r\n\r\n1. Break down into major phases using swarm_think\r\n2. Create specialized worker teams for each phase\r\n3. Establish success criteria and checkpoints\r\n4. Implement feedback loops and adaptation\r\n5. Aggregate and synthesize all worker outputs\r\n6. Deliver comprehensive solution with consensus\r\n\r\n‚ö° CRITICAL: CONCURRENT EXECUTION WITH CLAUDE CODE'S TASK TOOL:\r\n\r\nThe Hive Mind MUST use Claude Code's Task tool for actual agent execution:\r\n\r\n‚úÖ CORRECT Pattern:\r\n[Single Message - All Agents Spawned Concurrently]:\r\n  Task(\"Researcher\", \"Research patterns and best practices...\", \"researcher\")\r\n  Task(\"Coder\", \"Implement core features...\", \"coder\")\r\n  Task(\"Tester\", \"Create comprehensive tests...\", \"tester\")\r\n  Task(\"Analyst\", \"Analyze performance metrics...\", \"analyst\")\r\n  TodoWrite { todos: [8-10 todos ALL in ONE call] }\r\n\r\n‚ùå WRONG Pattern:\r\nMessage 1: Task(\"agent1\", ...)\r\nMessage 2: Task(\"agent2\", ...)\r\nMessage 3: TodoWrite { single todo }\r\n// This breaks parallel coordination!\r\n\r\nRemember:\r\n- Use Claude Code's Task tool to spawn ALL agents in ONE message\r\n- MCP tools are ONLY for coordination setup, not agent execution\r\n- Batch ALL TodoWrite operations (5-10+ todos minimum)\r\n- Execute ALL file operations concurrently\r\n- Store multiple memories simultaneously\r\n\r\nüöÄ BEGIN HIVE MIND EXECUTION:\r\n\r\nInitialize the swarm now with the configuration above. Use your collective intelligence to solve the objective efficiently. The Queen must coordinate, workers must collaborate, and the hive must think as one.\r\n\r\nRemember: You are not just coordinating agents - you are orchestrating a collective intelligence that is greater than the sum of its parts.`;\r\n}\r\n\r\n/**\r\n * Generate comprehensive coordination instructions for Claude Code instances\r\n */\r\nfunction generateCoordinationInstructions(swarmId, swarmName, objective, workers) {\r\n  return {\r\n    swarmId,\r\n    swarmName,\r\n    objective,\r\n    hiveMindEndpoint: 'ws://localhost:3000/hive-mind',\r\n    mcpTools: [\r\n      'mcp__ruv-swarm__memory_usage',\r\n      'mcp__ruv-swarm__swarm_monitor',\r\n      'mcp__ruv-swarm__task_orchestrate',\r\n      'mcp__ruv-swarm__neural_train',\r\n      'mcp__ruv-swarm__consensus_vote',\r\n      'mcp__ruv-swarm__agent_spawn',\r\n      'mcp__ruv-swarm__swarm_status',\r\n    ],\r\n    coordinationProtocol: {\r\n      memoryNamespace: `hive-mind-${swarmId}`,\r\n      consensusThreshold: 0.7,\r\n      taskUpdateInterval: 30000,\r\n      healthCheckInterval: 60000,\r\n    },\r\n    workerCapabilities: workers.map((w) => ({\r\n      id: w.id,\r\n      type: w.type,\r\n      capabilities: JSON.parse(w.capabilities),\r\n    })),\r\n  };\r\n}\r\n\r\n/**\r\n * Group workers by type for specialized spawning\r\n */\r\nfunction groupWorkersByType(workers) {\r\n  return workers.reduce((groups, worker) => {\r\n    if (!groups[worker.type]) {\r\n      groups[worker.type] = [];\r\n    }\r\n    groups[worker.type].push(worker);\r\n    return groups;\r\n  }, {});\r\n}\r\n\r\n/**\r\n * Create Claude Code spawn command with coordination context\r\n */\r\nfunction createClaudeCodeSpawnCommand(\r\n  swarmId,\r\n  swarmName,\r\n  objective,\r\n  workerType,\r\n  typeWorkers,\r\n  instructions,\r\n) {\r\n  const context = `You are a ${workerType} agent in the \"${swarmName}\" Hive Mind swarm.\r\n\r\nüéØ MISSION: ${objective}\r\n\r\nüêù SWARM COORDINATION:\r\n- Swarm ID: ${swarmId}\r\n- Your Role: ${workerType.toUpperCase()} specialist\r\n- Team Size: ${typeWorkers.length} ${workerType}(s)\r\n- Coordination: Hive Mind collective intelligence\r\n\r\nüß† MANDATORY COORDINATION PROTOCOL:\r\n1. BEFORE starting work:\r\n   mcp__ruv-swarm__memory_usage {\"action\": \"retrieve\", \"key\": \"hive-mind-${swarmId}/status\"}\r\n   mcp__ruv-swarm__swarm_status {\"swarmId\": \"${swarmId}\"}\r\n\r\n2. DURING work (after each major step):\r\n   mcp__ruv-swarm__memory_usage {\"action\": \"store\", \"key\": \"hive-mind-${swarmId}/${workerType}/progress\", \"value\": {\"step\": \"X\", \"status\": \"Y\", \"findings\": \"Z\"}}\r\n   mcp__ruv-swarm__task_orchestrate {\"swarmId\": \"${swarmId}\", \"update\": {\"agentId\": \"your-id\", \"progress\": \"details\"}}\r\n\r\n3. FOR decisions requiring consensus:\r\n   mcp__ruv-swarm__consensus_vote {\"swarmId\": \"${swarmId}\", \"topic\": \"decision topic\", \"vote\": \"your choice\", \"rationale\": \"reasoning\"}\r\n\r\n4. WHEN sharing insights:\r\n   mcp__ruv-swarm__memory_usage {\"action\": \"store\", \"key\": \"hive-mind-${swarmId}/insights/${workerType}\", \"value\": {\"insight\": \"your discovery\", \"impact\": \"significance\"}}\r\n\r\n5. BEFORE completing work:\r\n   mcp__ruv-swarm__neural_train {\"swarmId\": \"${swarmId}\", \"experience\": {\"what\": \"learned\", \"outcome\": \"result\"}}\r\n\r\nüîß SPECIALIZED CAPABILITIES:\r\n${getWorkerTypeInstructions(workerType)}\r\n\r\nü§ù COORDINATION RULES:\r\n- Share ALL discoveries via memory_usage\r\n- Vote on critical decisions using consensus_vote\r\n- Update progress every 15 minutes via task_orchestrate\r\n- Monitor other agents via swarm_status\r\n- Learn from patterns via neural_train\r\n\r\nRemember: You are part of a COLLECTIVE INTELLIGENCE. Your individual success depends on swarm coordination!`;\r\n\r\n  const command = `claude code --context \"${context.replace(/\"/g, '\\\\\"')}\"`;\r\n\r\n  return {\r\n    title: `${workerType.toUpperCase()} Agent (${typeWorkers.length} instance${typeWorkers.length > 1 ? 's' : ''})`,\r\n    command,\r\n    context,\r\n    workerType,\r\n    count: typeWorkers.length,\r\n  };\r\n}\r\n\r\n/**\r\n * Get specialized instructions for each worker type\r\n */\r\nfunction getWorkerTypeInstructions(workerType) {\r\n  const instructions = {\r\n    researcher: `- Conduct thorough research using WebSearch and WebFetch\r\n- Document findings in structured formats\r\n- Validate source credibility and relevance\r\n- Synthesize insights from multiple sources\r\n- Share research methodology and results`,\r\n\r\n    coder: `- Write clean, maintainable, well-documented code\r\n- Follow project conventions and best practices\r\n- Test implementations thoroughly\r\n- Document code changes and decisions\r\n- Review and optimize existing code`,\r\n\r\n    analyst: `- Analyze data patterns and trends\r\n- Create comprehensive reports and visualizations\r\n- Identify key insights and recommendations\r\n- Validate analytical methodologies\r\n- Correlate findings across data sources`,\r\n\r\n    tester: `- Design comprehensive test strategies\r\n- Execute functional, integration, and performance tests\r\n- Document test results and issues\r\n- Verify bug fixes and improvements\r\n- Ensure quality standards and coverage`,\r\n\r\n    coordinator: `- Monitor overall progress and coordination\r\n- Facilitate communication between agents\r\n- Resolve conflicts and blockers\r\n- Optimize resource allocation\r\n- Ensure alignment with objectives`,\r\n\r\n    architect: `- Design system architecture and components\r\n- Define technical standards and patterns\r\n- Create implementation guidelines\r\n- Review and approve design decisions\r\n- Ensure scalability and maintainability`,\r\n  };\r\n\r\n  return (\r\n    instructions[workerType] ||\r\n    `- Execute tasks according to ${workerType} best practices\r\n- Collaborate effectively with team members\r\n- Document work and share insights\r\n- Maintain quality standards\r\n- Contribute to collective objectives`\r\n  );\r\n}\r\n\r\n/**\r\n * Show all hive mind sessions\r\n */\r\nasync function showSessions(flags) {\r\n  try {\r\n    // Use metrics reader for real session data\r\n    const dbPath = path.join(cwd(), '.hive-mind', 'hive.db');\r\n    \r\n    if (!existsSync(dbPath)) {\r\n      console.log(chalk.gray('No hive mind database found'));\r\n      return;\r\n    }\r\n    \r\n    const metricsReader = new HiveMindMetricsReader(dbPath);\r\n    const sessions = metricsReader.getActiveSessions();\r\n\r\n    if (sessions.length === 0) {\r\n      console.log(chalk.gray('No active or paused sessions found'));\r\n      metricsReader.close();\r\n      return;\r\n    }\r\n\r\n    console.log(chalk.bold('\\nüóÇÔ∏è  Hive Mind Sessions\\n'));\r\n\r\n    sessions.forEach((session, index) => {\r\n      const statusColor =\r\n        session.status === 'active' ? 'green' : session.status === 'paused' ? 'yellow' : 'gray';\r\n      const statusIcon =\r\n        session.status === 'active' ? 'üü¢' : session.status === 'paused' ? 'üü°' : '‚ö´';\r\n\r\n      console.log(chalk.yellow('‚ïê'.repeat(60)));\r\n      console.log(`${statusIcon} ${chalk.bold(session.swarm_name || session.id)}`);\r\n      console.log(chalk.cyan('Session ID:'), session.id);\r\n      console.log(chalk.cyan('Status:'), chalk[statusColor](session.status));\r\n      console.log(chalk.cyan('Objective:'), session.objective || 'Not set');\r\n      console.log(chalk.cyan('Progress:'), `${session.completion_percentage || 0}%`);\r\n      console.log(chalk.cyan('Created:'), new Date(session.created_at).toLocaleString());\r\n      console.log(chalk.cyan('Last Updated:'), new Date(session.updated_at).toLocaleString());\r\n\r\n      if (session.paused_at) {\r\n        console.log(chalk.cyan('Paused At:'), new Date(session.paused_at).toLocaleString());\r\n      }\r\n\r\n      console.log('\\n' + chalk.bold('Real Progress:'));\r\n      console.log(`  Agents: ${session.agent_count || 0}`);\r\n      console.log(`  Tasks: ${session.completed_tasks || 0}/${session.task_count || 0}`);\r\n      console.log(`  In Progress: ${session.in_progress_tasks || 0}`);\r\n      console.log(`  Pending: ${session.pending_tasks || 0}`);\r\n\r\n      if (session.checkpoint_data) {\r\n        console.log('\\n' + chalk.bold('Last Checkpoint:'));\r\n        const checkpointStr = typeof session.checkpoint_data === 'string' \r\n          ? session.checkpoint_data \r\n          : JSON.stringify(session.checkpoint_data, null, 2);\r\n        console.log(\r\n          chalk.gray(checkpointStr.substring(0, 200) + (checkpointStr.length > 200 ? '...' : '')),\r\n        );\r\n      }\r\n    });\r\n\r\n    console.log(chalk.yellow('‚ïê'.repeat(60)) + '\\n');\r\n\r\n    console.log(chalk.blue('üí° Tips:'));\r\n    console.log('  ‚Ä¢ Resume a session: claude-flow hive-mind resume <session-id>');\r\n    console.log('  ‚Ä¢ View session details: claude-flow hive-mind status');\r\n\r\n    metricsReader.close();\r\n  } catch (error) {\r\n    console.error(chalk.red('Error:'), error.message);\r\n    exit(1);\r\n  }\r\n}\r\n\r\n/**\r\n * Resume a paused hive mind session\r\n */\r\nasync function resumeSession(args, flags) {\r\n  const sessionId = args[0];\r\n\r\n  if (!sessionId) {\r\n    console.error(chalk.red('Error: Please provide a session ID'));\r\n    console.log('Usage: claude-flow hive-mind resume <session-id>');\r\n    console.log('Run \"claude-flow hive-mind sessions\" to see available sessions');\r\n    return;\r\n  }\r\n\r\n  const spinner = ora('Resuming Hive Mind session...').start();\r\n\r\n  try {\r\n    const sessionManager = new HiveMindSessionManager();\r\n\r\n    // Get session details\r\n    const session = await sessionManager.getSession(sessionId);\r\n\r\n    if (!session) {\r\n      spinner.fail(`Session ${sessionId} not found`);\r\n      console.log('\\nRun \"claude-flow hive-mind sessions\" to see available sessions');\r\n      sessionManager.close();\r\n      return;\r\n    }\r\n\r\n    // Allow resuming any session regardless of status\r\n    spinner.text = `Resuming session from status: ${session.status}...`;\r\n\r\n    if (session.status === 'stopped') {\r\n      spinner.text = 'Restarting stopped session with original configuration...';\r\n    }\r\n\r\n    // Resume the session\r\n    const resumedSession = await sessionManager.resumeSession(sessionId);\r\n\r\n    spinner.succeed('Session resumed successfully!');\r\n\r\n    // Display session summary\r\n    console.log('\\n' + chalk.bold('üìã Resumed Session Summary:'));\r\n    console.log(chalk.gray('‚îÄ'.repeat(50)));\r\n    console.log(chalk.cyan('Session ID:'), sessionId);\r\n    console.log(chalk.cyan('Swarm Name:'), resumedSession.swarm_name);\r\n    console.log(chalk.cyan('Objective:'), resumedSession.objective);\r\n    console.log(chalk.cyan('Progress:'), `${resumedSession.statistics.completionPercentage}%`);\r\n    console.log(\r\n      chalk.cyan('Active Agents:'),\r\n      `${resumedSession.statistics.activeAgents}/${resumedSession.statistics.totalAgents}`,\r\n    );\r\n    console.log(\r\n      chalk.cyan('Tasks:'),\r\n      `${resumedSession.statistics.completedTasks}/${resumedSession.statistics.totalTasks} completed`,\r\n    );\r\n    console.log(chalk.gray('‚îÄ'.repeat(50)));\r\n\r\n    // Show task breakdown\r\n    console.log('\\n' + chalk.bold('üìä Task Status:'));\r\n    console.log(`  ‚úÖ Completed: ${resumedSession.statistics.completedTasks}`);\r\n    console.log(`  üîÑ In Progress: ${resumedSession.statistics.inProgressTasks}`);\r\n    console.log(`  ‚è≥ Pending: ${resumedSession.statistics.pendingTasks}`);\r\n\r\n    // Show recent activity\r\n    if (resumedSession.recentLogs && resumedSession.recentLogs.length > 0) {\r\n      console.log('\\n' + chalk.bold('üìú Recent Activity:'));\r\n      resumedSession.recentLogs.slice(0, 5).forEach((log) => {\r\n        const timestamp = new Date(log.timestamp).toLocaleTimeString();\r\n        console.log(`  [${timestamp}] ${log.message}`);\r\n      });\r\n    }\r\n\r\n    // Restore checkpoint if available\r\n    if (resumedSession.checkpoint_data) {\r\n      console.log('\\n' + chalk.bold('‚ôªÔ∏è  Restoring from checkpoint...'));\r\n      console.log(chalk.gray('Checkpoint data available for restoration'));\r\n    }\r\n\r\n    sessionManager.close();\r\n\r\n    // Offer to spawn Claude Code with restored context\r\n    if (flags.claude || flags.spawn) {\r\n      console.log('\\n' + chalk.yellow('üöÄ Launching Claude Code with restored context...'));\r\n\r\n      // Generate prompt with session context\r\n      const restoredPrompt = generateRestoredSessionPrompt(resumedSession);\r\n\r\n      // Launch Claude Code with restored context\r\n      await launchClaudeWithContext(restoredPrompt, flags, sessionId);\r\n    } else {\r\n      console.log(\r\n        '\\n' +\r\n          chalk.blue('üí° Pro Tip:') +\r\n          ' Add --claude to spawn Claude Code with restored context',\r\n      );\r\n      console.log(chalk.gray('   claude-flow hive-mind resume ' + sessionId + ' --claude'));\r\n    }\r\n  } catch (error) {\r\n    spinner.fail('Failed to resume session');\r\n    console.error(chalk.red('Error:'), error.message);\r\n    exit(1);\r\n  }\r\n}\r\n\r\n/**\r\n * Stop a hive mind session\r\n */\r\nasync function stopSession(args, flags) {\r\n  const sessionId = args[0];\r\n\r\n  if (!sessionId) {\r\n    console.error(chalk.red('Error: Please provide a session ID'));\r\n    console.log('Usage: claude-flow hive-mind stop <session-id>');\r\n    console.log('Run \"claude-flow hive-mind sessions\" to see available sessions');\r\n    return;\r\n  }\r\n\r\n  const spinner = ora('Stopping Hive Mind session...').start();\r\n\r\n  try {\r\n    const sessionManager = new HiveMindSessionManager();\r\n\r\n    // Get session details\r\n    const session = await sessionManager.getSession(sessionId);\r\n\r\n    if (!session) {\r\n      spinner.fail(`Session ${sessionId} not found`);\r\n      console.log('\\nRun \"claude-flow hive-mind sessions\" to see available sessions');\r\n      sessionManager.close();\r\n      return;\r\n    }\r\n\r\n    // Stop the session\r\n    await sessionManager.stopSession(sessionId);\r\n\r\n    spinner.succeed('Session stopped successfully!');\r\n\r\n    // Display session summary\r\n    console.log('\\n' + chalk.bold('üõë Stopped Session Summary:'));\r\n    console.log(chalk.gray('‚îÄ'.repeat(50)));\r\n    console.log(chalk.cyan('Session ID:'), sessionId);\r\n    console.log(chalk.cyan('Swarm Name:'), session.swarm_name || 'Unknown');\r\n    console.log(chalk.cyan('Final Status:'), 'Stopped');\r\n    console.log(\r\n      chalk.cyan('Active Agents:'),\r\n      session.statistics ? session.statistics.activeAgents : 0,\r\n    );\r\n    console.log(chalk.gray('‚îÄ'.repeat(50)));\r\n\r\n    console.log('\\n' + chalk.yellow('üí° Session has been stopped and all processes cleaned up.'));\r\n    console.log(\r\n      chalk.gray('To resume this session later, use: claude-flow hive-mind resume ' + sessionId),\r\n    );\r\n\r\n    sessionManager.close();\r\n  } catch (error) {\r\n    spinner.fail('Failed to stop session');\r\n    console.error(chalk.red('Error:'), error.message);\r\n    exit(1);\r\n  }\r\n}\r\n\r\n/**\r\n * Generate prompt for restored session\r\n */\r\nfunction generateRestoredSessionPrompt(session) {\r\n  // Get all agents, not just active ones\r\n  const allAgents = session.agents || [];\r\n  const activeAgents = allAgents.filter((a) => a.status === 'active' || a.status === 'busy');\r\n  const idleAgents = allAgents.filter((a) => a.status === 'idle');\r\n  \r\n  // Get all tasks categorized by status\r\n  const allTasks = session.tasks || [];\r\n  const completedTasks = allTasks.filter((t) => t.status === 'completed');\r\n  const inProgressTasks = allTasks.filter((t) => t.status === 'in_progress');\r\n  const pendingTasks = allTasks.filter((t) => t.status === 'pending');\r\n  \r\n  // Calculate session duration\r\n  const sessionStart = new Date(session.created_at);\r\n  const sessionPaused = session.paused_at ? new Date(session.paused_at) : new Date();\r\n  const duration = Math.round((sessionPaused - sessionStart) / 1000 / 60); // minutes\r\n  \r\n  // Get more checkpoint history\r\n  const checkpointHistory = session.checkpoints || [];\r\n  \r\n  // Get more activity logs\r\n  const activityLogs = session.recentLogs || [];\r\n  \r\n  // Format agent details with their current tasks\r\n  const formatAgentDetails = (agents) => {\r\n    if (!agents.length) return 'No agents found';\r\n    return agents.map(agent => {\r\n      const agentTasks = allTasks.filter(t => t.agent_id === agent.id);\r\n      const currentTask = agentTasks.find(t => t.status === 'in_progress');\r\n      return `‚Ä¢ ${agent.name} (${agent.type}) - ${agent.status}${currentTask ? `\\n  ‚îî‚îÄ Working on: ${currentTask.description}` : ''}`;\r\n    }).join('\\n');\r\n  };\r\n  \r\n  // Format task details with more information\r\n  const formatTaskDetails = (tasks, limit = 15) => {\r\n    if (!tasks.length) return 'No tasks found';\r\n    const displayTasks = tasks.slice(0, limit);\r\n    return displayTasks.map(task => {\r\n      const agent = allAgents.find(a => a.id === task.agent_id);\r\n      return `‚Ä¢ [${task.priority?.toUpperCase() || 'NORMAL'}] ${task.description}${agent ? ` (Assigned to: ${agent.name})` : ''}${task.created_at ? ` - Created: ${new Date(task.created_at).toLocaleTimeString()}` : ''}`;\r\n    }).join('\\n') + (tasks.length > limit ? `\\n... and ${tasks.length - limit} more tasks` : '');\r\n  };\r\n  \r\n  // Format checkpoint details\r\n  const formatCheckpoints = (checkpoints, limit = 5) => {\r\n    if (!checkpoints.length) return 'No checkpoints found';\r\n    const displayCheckpoints = checkpoints.slice(0, limit);\r\n    return displayCheckpoints.map(cp => \r\n      `‚Ä¢ ${cp.checkpoint_name} - ${new Date(cp.created_at).toLocaleString()}`\r\n    ).join('\\n');\r\n  };\r\n  \r\n  // Format activity logs with more detail\r\n  const formatActivityLogs = (logs, limit = 20) => {\r\n    if (!logs.length) return 'No activity logs found';\r\n    const displayLogs = logs.slice(0, limit);\r\n    return displayLogs.map(log => {\r\n      const timestamp = new Date(log.timestamp).toLocaleTimeString();\r\n      const agent = log.agent_id ? allAgents.find(a => a.id === log.agent_id) : null;\r\n      return `[${timestamp}] ${log.message}${agent ? ` (by ${agent.name})` : ''}${log.data ? ` - ${JSON.stringify(log.data)}` : ''}`;\r\n    }).join('\\n');\r\n  };\r\n  \r\n  // Extract metadata if available\r\n  const metadata = session.metadata || {};\r\n  const metadataStr = Object.keys(metadata).length > 0 ? \r\n    Object.entries(metadata).map(([k, v]) => `‚Ä¢ ${k}: ${typeof v === 'object' ? JSON.stringify(v) : v}`).join('\\n') : \r\n    'No metadata available';\r\n\r\n  return `üîÑ RESUMING HIVE MIND SESSION\r\n‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\r\n\r\nYou are resuming a Hive Mind session with comprehensive context:\r\n\r\nüìã SESSION DETAILS:\r\n‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\r\nüìå Session ID: ${session.id}\r\nüìå Swarm ID: ${session.swarm_id}\r\nüìå Swarm Name: ${session.swarm_name}\r\nüéØ Objective: ${session.objective}\r\nüìä Overall Progress: ${session.statistics.completionPercentage}% complete\r\n‚è±Ô∏è Session Duration: ${duration} minutes\r\nüìÖ Created: ${new Date(session.created_at).toLocaleString()}\r\n‚è∏Ô∏è Paused: ${session.paused_at ? new Date(session.paused_at).toLocaleString() : 'N/A'}\r\n‚ñ∂Ô∏è Resumed: ${new Date().toLocaleString()}\r\nüîÑ Status: ${session.status}\r\n\r\nüìä TASK STATISTICS:\r\n‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\r\n‚Ä¢ Total Tasks: ${session.statistics.totalTasks}\r\n‚Ä¢ Completed: ${completedTasks.length} (${session.statistics.totalTasks > 0 ? Math.round((completedTasks.length / session.statistics.totalTasks) * 100) : 0}%)\r\n‚Ä¢ In Progress: ${inProgressTasks.length}\r\n‚Ä¢ Pending: ${pendingTasks.length}\r\n\r\nüë• SWARM COMPOSITION (${allAgents.length} agents):\r\n‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\r\nActive Agents (${activeAgents.length}):\r\n${formatAgentDetails(activeAgents)}\r\n\r\nIdle Agents (${idleAgents.length}):\r\n${formatAgentDetails(idleAgents)}\r\n\r\nüìù COMPLETED TASKS (${completedTasks.length}):\r\n‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\r\n${formatTaskDetails(completedTasks, 10)}\r\n\r\nüîÑ IN-PROGRESS TASKS (${inProgressTasks.length}):\r\n‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\r\n${formatTaskDetails(inProgressTasks)}\r\n\r\n‚è≥ PENDING TASKS (${pendingTasks.length}):\r\n‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\r\n${formatTaskDetails(pendingTasks)}\r\n\r\nüíæ CHECKPOINT HISTORY (${checkpointHistory.length} total):\r\n‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\r\n${formatCheckpoints(checkpointHistory)}\r\n\r\nüìä SESSION METADATA:\r\n‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\r\n${metadataStr}\r\n\r\nüíæ LAST CHECKPOINT DATA:\r\n‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\r\n${session.checkpoint_data ? JSON.stringify(session.checkpoint_data, null, 2) : 'No checkpoint data available'}\r\n\r\nüìú ACTIVITY LOG (Last ${Math.min(20, activityLogs.length)} entries):\r\n‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\r\n${formatActivityLogs(activityLogs, 20)}\r\n\r\nüéØ RESUMPTION PROTOCOL:\r\n‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\r\n1. **RESTORE CONTEXT**:\r\n   - Review all checkpoint data and activity history above\r\n   - Use mcp__claude-flow__memory_usage to retrieve collective memory\r\n   - Check agent statuses and reassign tasks if needed\r\n   - Verify all in-progress tasks are still valid\r\n\r\n2. **CONTINUE EXECUTION**:\r\n   - Resume in-progress tasks with their assigned agents\r\n   - Process pending tasks based on priority (CRITICAL > HIGH > NORMAL > LOW)\r\n   - Maintain agent coordination through memory sharing\r\n   - Update progress tracking after each task completion\r\n\r\n3. **COORDINATION REQUIREMENTS**:\r\n   - Use mcp__claude-flow__memory_usage for all cross-agent communication\r\n   - Apply consensus mechanisms for important decisions\r\n   - Maintain swarm topology: ${session.swarm?.topology || 'unknown'}\r\n   - Keep session checkpoint data updated regularly\r\n\r\n4. **MEMORY CONTEXT**:\r\n   - Session memory namespace: session-${session.id}\r\n   - Swarm memory namespace: swarm-${session.swarm_id}\r\n   - Use these namespaces to access historical decisions and context\r\n\r\nResume the hive mind operation with full context awareness and continue working towards the objective.`;\r\n}\r\n\r\n/**\r\n * Launch Claude Code with context\r\n */\r\nasync function launchClaudeWithContext(prompt, flags, sessionId) {\r\n  try {\r\n    // ALWAYS save the prompt file first (fix for issue #330)\r\n    // Ensure sessions directory exists\r\n    const sessionsDir = path.join('.hive-mind', 'sessions');\r\n    await mkdirAsync(sessionsDir, { recursive: true });\r\n    const promptFile = path.join(sessionsDir, `hive-mind-resume-${sessionId}-${Date.now()}.txt`);\r\n    await writeFile(promptFile, prompt);\r\n    console.log(chalk.green(`\\n‚úì Session context saved to: ${promptFile}`));\r\n\r\n    const { spawn: childSpawn, execSync } = await import('child_process');\r\n    let claudeAvailable = false;\r\n\r\n    try {\r\n      execSync('which claude', { stdio: 'ignore' });\r\n      claudeAvailable = true;\r\n    } catch {\r\n      console.log(chalk.yellow('\\n‚ö†Ô∏è  Claude Code CLI not found'));\r\n      console.log(chalk.gray('Install Claude Code: npm install -g @anthropic-ai/claude-code'));\r\n      console.log(chalk.gray(`Run with: claude < ${promptFile}`));\r\n      return;\r\n    }\r\n\r\n    if (claudeAvailable && !flags.dryRun) {\r\n      // Debug logging to track spawn calls\r\n      console.log(chalk.blue('\\nüîç Debug: About to spawn Claude Code process...'));\r\n      console.log(chalk.gray(`  Session ID: ${sessionId}`));\r\n      console.log(chalk.gray(`  Process ID: ${process.pid}`));\r\n      \r\n      // Remove --print to allow interactive session (same as initial spawn)\r\n      const claudeArgs = [prompt];\r\n\r\n      // Add --dangerously-skip-permissions by default for hive-mind operations\r\n      // unless explicitly disabled with --no-auto-permissions\r\n      if (!flags['no-auto-permissions']) {\r\n        claudeArgs.push('--dangerously-skip-permissions');\r\n        console.log(\r\n          chalk.yellow(\r\n            'üîì Using --dangerously-skip-permissions by default for seamless hive-mind execution',\r\n          ),\r\n        );\r\n      }\r\n\r\n      console.log(chalk.blue('üîç Debug: Spawning with args:'), claudeArgs.slice(0, 1).map(a => a.substring(0, 50) + '...'));\r\n      \r\n      // Use 'inherit' for interactive session (same as initial spawn)\r\n      const claudeProcess = childSpawn('claude', claudeArgs, {\r\n        stdio: 'inherit',\r\n        shell: false,\r\n      });\r\n      \r\n      console.log(chalk.blue('üîç Debug: Claude process spawned with PID:'), claudeProcess.pid);\r\n\r\n      // Track child process PID in session (same as initial spawn)\r\n      const sessionManager = new HiveMindSessionManager();\r\n      if (claudeProcess.pid) {\r\n        const sessions = await sessionManager.getActiveSessions();\r\n        const currentSession = sessions.find(s => s.id === sessionId);\r\n        if (currentSession) {\r\n          await sessionManager.addChildPid(currentSession.id, claudeProcess.pid);\r\n        }\r\n      }\r\n\r\n      // Set up SIGINT handler for automatic session pausing (same as initial spawn)\r\n      let isExiting = false;\r\n      const sigintHandler = async () => {\r\n        if (isExiting) return;\r\n        isExiting = true;\r\n\r\n        console.log('\\n\\n' + chalk.yellow('‚è∏Ô∏è  Pausing session and terminating Claude Code...'));\r\n        \r\n        try {\r\n          // Terminate Claude Code process if still running\r\n          if (claudeProcess && !claudeProcess.killed) {\r\n            claudeProcess.kill('SIGTERM');\r\n          }\r\n          \r\n          // Clean up and close session manager\r\n          sessionManager.close();\r\n          \r\n          console.log(chalk.green('‚úì') + ' Session paused successfully');\r\n          console.log(chalk.cyan('\\nTo resume this session, run:'));\r\n          console.log(chalk.bold(`  claude-flow hive-mind resume ${sessionId}`));\r\n          console.log();\r\n          \r\n          process.exit(0);\r\n        } catch (error) {\r\n          console.error(chalk.red('Error during shutdown:'), error.message);\r\n          process.exit(1);\r\n        }\r\n      };\r\n\r\n      process.on('SIGINT', sigintHandler);\r\n      process.on('SIGTERM', sigintHandler);\r\n\r\n      // Handle process exit (same as initial spawn)\r\n      claudeProcess.on('exit', async (code, signal) => {\r\n        if (!isExiting) {\r\n          console.log('\\n' + chalk.yellow('Claude Code has exited'));\r\n          \r\n          // Clean up signal handlers\r\n          process.removeListener('SIGINT', sigintHandler);\r\n          process.removeListener('SIGTERM', sigintHandler);\r\n          \r\n          // Close session manager\r\n          sessionManager.close();\r\n          \r\n          process.exit(code || 0);\r\n        }\r\n      });\r\n\r\n      console.log(chalk.green('\\n‚úì Claude Code launched with restored session context'));\r\n      console.log(chalk.gray(`  Prompt file saved at: ${promptFile}`));\r\n    }\r\n  } catch (error) {\r\n    console.error(chalk.red('Failed to launch Claude Code:'), error.message);\r\n  }\r\n}\r\n\r\n/**\r\n * Get MCP wrapper instance\r\n */\r\nasync function getMcpWrapper() {\r\n  const { MCPToolWrapper } = await import('./hive-mind/mcp-wrapper.js');\r\n  return new MCPToolWrapper();\r\n}\r\n\r\n// Export for testing\r\nexport { showHiveMindHelp, initHiveMind, spawnSwarm, showStatus };\r\n"],"names":["existsSync","mkdirSync","writeFile","path","inquirer","chalk","ora","cwd","exit","mkdirAsync","warnNonInteractive","safeInteractive","Database","HiveMindCore","QueenCoordinator","CollectiveMemory","SwarmCommunication","HiveMindSessionManager","createAutoSaveMiddleware","HiveMindMetricsReader","showHiveMindHelp","console","log","yellow","bold","green","gray","cyan","blue","initHiveMind","flags","spinner","start","hiveMindDir","join","recursive","dbPath","db","exec","close","config","version","initialized","Date","toISOString","defaults","queenType","maxWorkers","consensusAlgorithm","memorySize","autoScale","encryption","mcpTools","enabled","parallel","timeout","JSON","stringify","succeed","error","fail","red","message","hiveMindWizard","action","prompt","type","name","choices","value","spawnSwarmWizard","showStatus","manageMemoryWizard","showConsensus","showMetrics","configureWizard","objective","now","parseInt","consensus","namespace","verbose","spawnSwarm","nonInteractive","answers","validate","input","trim","length","default","checked","swarmResult","workerTypes","monitor","spawnClaude","swarmId","workers","map","index","id","role","status","capabilities","getAgentCapabilities","claudeFlags","spawnClaudeCodeInstances","args","isNonInteractive","wizard","validQueenTypes","includes","isNaN","validConsensusTypes","hiveMind","text","undefined","Error","dbDir","prepare","get","warn","fs","unlinkSync","e","timestamp","randomPart","Math","random","toString","substring","run","sessionManager","sessionId","createSession","autoSave","saveInterval","autoStart","trackChange","swarmName","workerCount","queen","queenAgent","Object","values","split","i","min","workerType","workerId","worker","charAt","toUpperCase","slice","push","trackAgentActivity","memory","maxSize","store","communication","repeat","isExiting","sigintHandler","checkpointData","reason","saveCheckpoint","pauseSession","global","autoSaveInterval","clearInterval","process","on","claude","spawn","stack","researcher","coder","analyst","tester","architect","reviewer","optimizer","documenter","metricsReader","swarms","getActiveSwarms","swarm","queen_type","created_at","toLocaleString","agent_count","agents","find","a","filter","magenta","forEach","statusColor","taskStats","task_metrics","total","completed","in_progress","pending","failed","completion_percentage","memory_count","consensus_count","decisions","all","decision","swarm_name","topic","algorithm","confidence","toFixed","votes","parse","for","against","abstain","details","Array","isArray","detail","agent","agentId","vote","choice","justification","rationale","displayString","entries","overallStats","taskBreakdown","total_swarms","total_agents","total_tasks","completed_tasks","percentage","count","agentPerf","hasCompletedAt","successRate","tasks_assigned","tasks_completed","avg_completion_minutes","swarmPerf","task_count","completed_count","memory_entries","avgTaskTime","avg_minutes","agentTypePerf","listMemories","searchMemories","storeMemoryWizard","showMemoryStats","cleanMemories","exportMemoryBackup","continue","continueAction","hiveMindCommand","subcommand","subArgs","help","showSessions","resumeSession","stopSession","memories","key","swarm_id","created_by","displayValue","parsed","searchTerm","searchPattern","mcpWrapper","getMcpWrapper","memoryValue","storeMemory","category","searchResult","searchMemory","results","data","stats","categories","oldestDate","newestDate","totalSize","date","toLocaleDateString","days","confirm","cutoffDate","setDate","getDate","oldMemories","memoryDate","filename","backup","exportDate","totalMemories","writeFileSync","getActiveSessionId","sessions","getActiveSessions","activeSession","s","workerGroups","groupWorkersByType","hiveMindPrompt","generateHiveMindPrompt","keys","sessionsDir","promptFile","childSpawn","execSync","claudeAvailable","stdio","dryRun","injectMemoryProtocol","enhanceHiveMindPrompt","err","claudeArgs","claudeProcess","shell","pid","addChildPid","killed","kill","claudePid","stdout","stderr","code","removeChildPid","currentTime","getWorkerTypeInstructions","generateCoordinationInstructions","hiveMindEndpoint","coordinationProtocol","memoryNamespace","consensusThreshold","taskUpdateInterval","healthCheckInterval","workerCapabilities","w","reduce","groups","createClaudeCodeSpawnCommand","typeWorkers","instructions","context","command","replace","title","coordinator","session","statusIcon","updated_at","paused_at","in_progress_tasks","pending_tasks","checkpoint_data","checkpointStr","getSession","resumedSession","statistics","completionPercentage","activeAgents","totalAgents","completedTasks","totalTasks","inProgressTasks","pendingTasks","recentLogs","toLocaleTimeString","restoredPrompt","generateRestoredSessionPrompt","launchClaudeWithContext","allAgents","idleAgents","allTasks","tasks","t","sessionStart","sessionPaused","duration","round","checkpointHistory","checkpoints","activityLogs","formatAgentDetails","agentTasks","agent_id","currentTask","description","formatTaskDetails","limit","displayTasks","task","priority","formatCheckpoints","displayCheckpoints","cp","checkpoint_name","formatActivityLogs","logs","displayLogs","metadata","metadataStr","k","v","topology","currentSession","signal","removeListener","MCPToolWrapper"],"mappings":"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"}