{
  "version": 3,
  "sources": ["../../../src/cli/commands/claude.ts"],
  "sourcesContent": ["/**\n * Claude instance management commands\n */\nimport { promises as fs } from 'node:fs';\n\nimport { Command } from 'commander';\nimport chalk from 'chalk';\nimport { spawn } from 'node:child_process';\nimport { generateId } from '../../utils/helpers.js';\n\nexport const claudeCommand = new Command()\n  .name('claude')\n  .description('Manage Claude instances')\n  .action(() => {\n    claudeCommand.help();\n  });\n\n// Spawn command\nclaudeCommand\n  .command('spawn')\n  .description('Spawn a new Claude instance with specific configuration')\n  .arguments('<task>')\n  .option(\n    '-t, --tools <tools>',\n    'Allowed tools (comma-separated)',\n    'View,Edit,Replace,GlobTool,GrepTool,LS,Bash',\n  )\n  .option('--no-permissions', 'Use --dangerously-skip-permissions flag')\n  .option('-c, --config <config>', 'MCP config file path')\n  .option(\n    '-m, --mode <mode>',\n    'Development mode (full, backend-only, frontend-only, api-only)',\n    'full',\n  )\n  .option('--parallel', 'Enable parallel execution with BatchTool')\n  .option('--research', 'Enable web research with WebFetchTool')\n  .option('--coverage <coverage>', 'Test coverage target', '80')\n  .option('--commit <frequency>', 'Commit frequency (phase, feature, manual)', 'phase')\n  .option('-v, --verbose', 'Enable verbose output')\n  .option('--dry-run', 'Show what would be executed without running')\n  .action(async (task: string, options: any) => {\n    try {\n      const instanceId = generateId('claude');\n\n      // Build allowed tools list\n      let tools = options.tools;\n      if (options.parallel && !tools.includes('BatchTool')) {\n        tools += ',BatchTool,dispatch_agent';\n      }\n      if (options.research && !tools.includes('WebFetchTool')) {\n        tools += ',WebFetchTool';\n      }\n\n      // Build Claude command\n      const claudeArgs = [task];\n      claudeArgs.push('--allowedTools', tools);\n\n      if (options.noPermissions) {\n        claudeArgs.push('--dangerously-skip-permissions');\n      }\n\n      if (options.config) {\n        claudeArgs.push('--mcp-config', options.config);\n      }\n\n      if (options.verbose) {\n        claudeArgs.push('--verbose');\n      }\n\n      if (options.dryRun) {\n        console.log(chalk.yellow('DRY RUN - Would execute:'));\n        console.log(chalk.gray(`claude ${claudeArgs.join(' ')}`));\n        console.log('\\nConfiguration:');\n        console.log(`  Instance ID: ${instanceId}`);\n        console.log(`  Task: ${task}`);\n        console.log(`  Tools: ${tools}`);\n        console.log(`  Mode: ${options.mode}`);\n        console.log(`  Coverage: ${parseInt(options.coverage)}%`);\n        console.log(`  Commit: ${options.commit}`);\n        return;\n      }\n\n      console.log(chalk.green(`Spawning Claude instance: ${instanceId}`));\n      console.log(chalk.gray(`Task: ${task}`));\n      console.log(chalk.gray(`Tools: ${tools}`));\n\n      // Spawn Claude process\n      const claude = spawn('claude', claudeArgs, {\n        stdio: 'inherit',\n        env: {\n          ...process.env,\n          CLAUDE_INSTANCE_ID: instanceId,\n          CLAUDE_FLOW_MODE: options.mode,\n          CLAUDE_FLOW_COVERAGE: parseInt(options.coverage).toString(),\n          CLAUDE_FLOW_COMMIT: options.commit,\n        },\n      });\n\n      claude.on('error', (err) => {\n        console.error(chalk.red('Failed to spawn Claude:'), err.message);\n      });\n\n      claude.on('exit', (code) => {\n        if (code === 0) {\n          console.log(chalk.green(`Claude instance ${instanceId} completed successfully`));\n        } else {\n          console.log(chalk.red(`Claude instance ${instanceId} exited with code ${code}`));\n        }\n      });\n    } catch (error) {\n      console.error(chalk.red('Failed to spawn Claude:'), (error as Error).message);\n    }\n  });\n\n// Batch command\nclaudeCommand\n  .command('batch')\n  .description('Spawn multiple Claude instances from workflow')\n  .arguments('<workflow-file>')\n  .option('--dry-run', 'Show what would be executed without running')\n  .action(async (workflowFile: string, options: any) => {\n    try {\n      const content = await fs.readFile(workflowFile, 'utf-8');\n      const workflow = JSON.parse(content);\n\n      console.log(chalk.green('Loading workflow:'), workflow.name || 'Unnamed');\n      console.log(chalk.gray(`Tasks: ${workflow.tasks?.length || 0}`));\n\n      if (!workflow.tasks || workflow.tasks.length === 0) {\n        console.log(chalk.yellow('No tasks found in workflow'));\n        return;\n      }\n\n      for (const task of workflow.tasks) {\n        const claudeArgs = [task.description || task.name];\n\n        // Add tools\n        if (task.tools) {\n          claudeArgs.push(\n            '--allowedTools',\n            Array.isArray(task.tools) ? task.tools.join(',') : task.tools,\n          );\n        }\n\n        // Add flags\n        if (task.skipPermissions) {\n          claudeArgs.push('--dangerously-skip-permissions');\n        }\n\n        if (task.config) {\n          claudeArgs.push('--mcp-config', task.config);\n        }\n\n        if (options.dryRun) {\n          console.log(chalk.yellow(`\\nDRY RUN - Task: ${task.name || task.id}`));\n          console.log(chalk.gray(`claude ${claudeArgs.join(' ')}`));\n        } else {\n          console.log(chalk.blue(`\\nSpawning Claude for task: ${task.name || task.id}`));\n\n          const claude = spawn('claude', claudeArgs, {\n            stdio: 'inherit',\n            env: {\n              ...process.env,\n              CLAUDE_TASK_ID: task.id || generateId('task'),\n              CLAUDE_TASK_TYPE: task.type || 'general',\n            },\n          });\n\n          // Wait for completion if sequential\n          if (!workflow.parallel) {\n            await new Promise((resolve) => {\n              claude.on('exit', resolve);\n            });\n          }\n        }\n      }\n\n      if (!options.dryRun && workflow.parallel) {\n        console.log(chalk.green('\\nAll Claude instances spawned in parallel mode'));\n      }\n    } catch (error) {\n      console.error(chalk.red('Failed to process workflow:'), (error as Error).message);\n    }\n  });\n"],
  "mappings": "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",
  "names": ["chalk", "fs"]
}
