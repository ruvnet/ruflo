{"version":3,"sources":["../../../../src/cli/ui/fallback-handler.ts"],"sourcesContent":["import { getErrorMessage } from '../../utils/type-guards.js';\r\n/**\r\n * Fallback UI Handler - Handles raw mode errors gracefully\r\n * Provides alternative UI when Ink/raw mode isn't supported\r\n */\r\n\r\nimport chalk from 'chalk';\r\nimport { createCompatibleUI } from './compatible-ui.js';\r\n\r\nexport interface FallbackOptions {\r\n  enableUI?: boolean;\r\n  fallbackMessage?: string;\r\n  showHelp?: boolean;\r\n}\r\n\r\n/**\r\n * Handles raw mode errors and provides fallback UI\r\n */\r\nexport async function handleRawModeError(\r\n  error: Error,\r\n  options: FallbackOptions = {},\r\n): Promise<void> {\r\n  const isRawModeError =\r\n    (error instanceof Error ? error.message : String(error)).includes(\r\n      'Raw mode is not supported',\r\n    ) ||\r\n    (error instanceof Error ? error.message : String(error)).includes('stdin') ||\r\n    (error instanceof Error ? error.message : String(error)).includes('Ink');\r\n\r\n  if (!isRawModeError) {\r\n    throw error; // Re-throw if it's not a raw mode error\r\n  }\r\n\r\n  console.clear();\r\n  console.log(chalk.yellow.bold('‚ö†Ô∏è  Interactive Mode Not Supported'));\r\n  console.log(chalk.gray('‚îÄ'.repeat(50)));\r\n  console.log(chalk.white('The current terminal environment does not support'));\r\n  console.log(chalk.white('interactive UI features (raw mode).'));\r\n  console.log();\r\n  console.log(chalk.cyan('Common causes:'));\r\n  console.log(chalk.gray('‚Ä¢ VS Code integrated terminal'));\r\n  console.log(chalk.gray('‚Ä¢ WSL (Windows Subsystem for Linux)'));\r\n  console.log(chalk.gray('‚Ä¢ Native Windows terminals'));\r\n  console.log(chalk.gray('‚Ä¢ CI/CD environments'));\r\n  console.log(chalk.gray('‚Ä¢ Docker containers'));\r\n  console.log(chalk.gray('‚Ä¢ SSH sessions without TTY'));\r\n  console.log();\r\n\r\n  if (options.fallbackMessage) {\r\n    console.log(chalk.blue('‚ÑπÔ∏è  '), options.fallbackMessage);\r\n    console.log();\r\n  }\r\n\r\n  if (options.enableUI) {\r\n    console.log(chalk.green('‚úÖ Launching compatible UI mode...'));\r\n    console.log();\r\n\r\n    try {\r\n      const ui = createCompatibleUI();\r\n      await ui.start();\r\n    } catch (fallbackError) {\r\n      console.log(chalk.red('‚ùå Fallback UI also failed:'), getErrorMessage(fallbackError));\r\n      await showBasicInterface(options);\r\n    }\r\n  } else {\r\n    await showBasicInterface(options);\r\n  }\r\n}\r\n\r\n/**\r\n * Shows a basic text-based interface when UI isn't available\r\n */\r\nasync function showBasicInterface(options: FallbackOptions): Promise<void> {\r\n  console.log(chalk.green('üìã Available alternatives:'));\r\n  console.log();\r\n  console.log(chalk.white('1. Use CLI commands directly:'));\r\n  console.log(chalk.gray('   ./claude-flow status'));\r\n  console.log(chalk.gray('   ./claude-flow memory list'));\r\n  console.log(chalk.gray('   ./claude-flow sparc modes'));\r\n  console.log();\r\n  console.log(chalk.white('2. Use non-interactive modes:'));\r\n  console.log(chalk.gray('   ./claude-flow start (without --ui)'));\r\n  console.log(chalk.gray('   ./claude-flow swarm \"task\" --monitor'));\r\n  console.log();\r\n  console.log(chalk.white('3. Use external terminal:'));\r\n  console.log(chalk.gray('   Run in a standalone terminal application'));\r\n  console.log();\r\n\r\n  if (options.showHelp) {\r\n    console.log(chalk.cyan('üí° For help with any command, use:'));\r\n    console.log(chalk.gray('   ./claude-flow help <command>'));\r\n    console.log(chalk.gray('   ./claude-flow <command> --help'));\r\n    console.log();\r\n  }\r\n\r\n  console.log(chalk.gray('Press Ctrl+C to exit'));\r\n\r\n  // Wait for user to exit\r\n  await new Promise(() => {\r\n    process.on('SIGINT', () => {\r\n      console.log(chalk.green('\\nüëã Goodbye!'));\r\n      process.exit(0);\r\n    });\r\n  });\r\n}\r\n\r\n/**\r\n * Wraps a function to catch and handle raw mode errors\r\n */\r\nexport function withRawModeFallback<T extends any[], R>(\r\n  fn: (...args: T) => Promise<R>,\r\n  fallbackOptions: FallbackOptions = {},\r\n) {\r\n  return async (...args: T): Promise<R | void> => {\r\n    try {\r\n      return await fn(...args);\r\n    } catch (error) {\r\n      if (error instanceof Error) {\r\n        await handleRawModeError(error, fallbackOptions);\r\n      } else {\r\n        throw error;\r\n      }\r\n    }\r\n  };\r\n}\r\n\r\n/**\r\n * Checks if the current environment supports interactive UI\r\n */\r\nexport function checkUISupport(): {\r\n  supported: boolean;\r\n  reason?: string;\r\n  recommendation?: string;\r\n} {\r\n  // Check if we're in a TTY\r\n  if (!process.stdin.isTTY) {\r\n    return {\r\n      supported: false,\r\n      reason: 'Not running in a TTY environment',\r\n      recommendation: 'Use a proper terminal application',\r\n    };\r\n  }\r\n\r\n  // Check if raw mode is available\r\n  if (typeof process.stdin.setRawMode !== 'function') {\r\n    return {\r\n      supported: false,\r\n      reason: 'Raw mode not available',\r\n      recommendation: 'Use --no-ui flag or run in external terminal',\r\n    };\r\n  }\r\n\r\n  // Check for VS Code terminal\r\n  if (process.env.TERM_PROGRAM === 'vscode') {\r\n    return {\r\n      supported: false,\r\n      reason: 'Running in VS Code integrated terminal',\r\n      recommendation: 'Use VS Code external terminal or standalone terminal',\r\n    };\r\n  }\r\n\r\n  // Check for other problematic environments\r\n  if (process.env.CI || process.env.GITHUB_ACTIONS) {\r\n    return {\r\n      supported: false,\r\n      reason: 'Running in CI/CD environment',\r\n      recommendation: 'Use non-interactive mode',\r\n    };\r\n  }\r\n\r\n  return { supported: true };\r\n}\r\n\r\n/**\r\n * Shows UI support information\r\n */\r\nexport function showUISupport(): void {\r\n  const support = checkUISupport();\r\n\r\n  console.log(chalk.cyan.bold('üñ•Ô∏è  UI Support Information'));\r\n  console.log(chalk.gray('‚îÄ'.repeat(40)));\r\n\r\n  if (support.supported) {\r\n    console.log(chalk.green('‚úÖ Interactive UI supported'));\r\n    console.log(chalk.gray('Your terminal supports all UI features'));\r\n  } else {\r\n    console.log(chalk.yellow('‚ö†Ô∏è  Limited UI support'));\r\n    console.log(chalk.gray(`Reason: ${support.reason}`));\r\n    if (support.recommendation) {\r\n      console.log(chalk.blue(`Recommendation: ${support.recommendation}`));\r\n    }\r\n  }\r\n\r\n  console.log();\r\n  console.log(chalk.white('Environment details:'));\r\n  console.log(chalk.gray(`‚Ä¢ Terminal: ${process.env.TERM || 'unknown'}`));\r\n  console.log(chalk.gray(`‚Ä¢ TTY: ${process.stdin.isTTY ? 'yes' : 'no'}`));\r\n  console.log(chalk.gray(`‚Ä¢ Program: ${process.env.TERM_PROGRAM || 'unknown'}`));\r\n  console.log(chalk.gray(`‚Ä¢ Platform: ${process.platform}`));\r\n}\r\n"],"names":["getErrorMessage","chalk","createCompatibleUI","handleRawModeError","error","options","isRawModeError","Error","message","String","includes","console","clear","log","yellow","bold","gray","repeat","white","cyan","fallbackMessage","blue","enableUI","green","ui","start","fallbackError","red","showBasicInterface","showHelp","Promise","process","on","exit","withRawModeFallback","fn","fallbackOptions","args","checkUISupport","stdin","isTTY","supported","reason","recommendation","setRawMode","env","TERM_PROGRAM","CI","GITHUB_ACTIONS","showUISupport","support","TERM","platform"],"mappings":"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"}