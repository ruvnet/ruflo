{"version":3,"sources":["../../../../src/terminal/adapters/vscode.ts"],"sourcesContent":["/**\r\n * VSCode terminal adapter implementation\r\n */\r\n\r\nimport { platform } from 'os';\r\nimport type { ITerminalAdapter, Terminal } from './base.js';\r\nimport type { ILogger } from '../../core/logger.js';\r\nimport { TerminalError } from '../../utils/errors.js';\r\nimport { generateId, delay, timeout, createDeferred } from '../../utils/helpers.js';\r\n\r\n/**\r\n * VSCode API interface (injected via extension)\r\n */\r\ninterface VSCodeAPI {\r\n  window: {\r\n    createTerminal(options: {\r\n      name: string;\r\n      shellPath?: string;\r\n      shellArgs?: string[];\r\n      env?: Record<string, string>;\r\n    }): VSCodeTerminal;\r\n    onDidCloseTerminal(listener: (terminal: VSCodeTerminal) => void): { dispose(): void };\r\n  };\r\n}\r\n\r\ninterface VSCodeTerminal {\r\n  name: string;\r\n  processId: Promise<number | undefined>;\r\n  sendText(text: string, addNewLine?: boolean): void;\r\n  show(preserveFocus?: boolean): void;\r\n  hide(): void;\r\n  dispose(): void;\r\n}\r\n\r\n/**\r\n * VSCode terminal implementation\r\n */\r\nclass VSCodeTerminalWrapper implements Terminal {\r\n  id: string;\r\n  pid?: number;\r\n  private vscodeTerminal?: VSCodeTerminal;\r\n  private outputBuffer = '';\r\n  private commandMarker: string;\r\n  private outputDeferred = createDeferred<string>();\r\n  private isDisposed = false;\r\n\r\n  constructor(\r\n    private vscodeApi: VSCodeAPI,\r\n    private shellType: string,\r\n    private logger: ILogger,\r\n  ) {\r\n    this.id = generateId('vscode-term');\r\n    this.commandMarker = `__CLAUDE_FLOW_${this.id}__`;\r\n  }\r\n\r\n  async initialize(): Promise<void> {\r\n    try {\r\n      // Create VSCode terminal\r\n      const shellPath = this.getShellPath();\r\n      const terminalOptions: any = {\r\n        name: `Claude-Flow Terminal ${this.id}`,\r\n        shellArgs: this.getShellArgs(),\r\n        env: {\r\n          CLAUDE_FLOW_TERMINAL: 'true',\r\n          CLAUDE_FLOW_TERMINAL_ID: this.id,\r\n          PS1: '$ ', // Simple prompt\r\n        },\r\n      };\r\n      if (shellPath !== undefined) {\r\n        terminalOptions.shellPath = shellPath;\r\n      }\r\n      this.vscodeTerminal = this.vscodeApi.window.createTerminal(terminalOptions);\r\n\r\n      // Get process ID\r\n      const processId = await this.vscodeTerminal.processId;\r\n      if (processId !== undefined) {\r\n        this.pid = processId;\r\n      }\r\n\r\n      // Show terminal (but don't steal focus)\r\n      this.vscodeTerminal.show(true);\r\n\r\n      // Wait for terminal to be ready\r\n      await this.waitForReady();\r\n\r\n      this.logger.debug('VSCode terminal initialized', { id: this.id, pid: this.pid });\r\n    } catch (error) {\r\n      throw new TerminalError('Failed to create VSCode terminal', { error });\r\n    }\r\n  }\r\n\r\n  async executeCommand(command: string): Promise<string> {\r\n    if (!this.vscodeTerminal || !this.isAlive()) {\r\n      throw new TerminalError('Terminal is not alive');\r\n    }\r\n\r\n    try {\r\n      // Clear output buffer\r\n      this.outputBuffer = '';\r\n      this.outputDeferred = createDeferred<string>();\r\n\r\n      // Send command with marker\r\n      const markedCommand = `${command} && echo \"${this.commandMarker}\"`;\r\n      this.vscodeTerminal.sendText(markedCommand, true);\r\n\r\n      // Wait for command to complete\r\n      const output = await timeout(this.outputDeferred.promise, 30000, 'Command execution timeout');\r\n\r\n      return output;\r\n    } catch (error) {\r\n      throw new TerminalError('Failed to execute command', { command, error });\r\n    }\r\n  }\r\n\r\n  async write(data: string): Promise<void> {\r\n    if (!this.vscodeTerminal || !this.isAlive()) {\r\n      throw new TerminalError('Terminal is not alive');\r\n    }\r\n\r\n    this.vscodeTerminal.sendText(data, false);\r\n  }\r\n\r\n  async read(): Promise<string> {\r\n    if (!this.vscodeTerminal || !this.isAlive()) {\r\n      throw new TerminalError('Terminal is not alive');\r\n    }\r\n\r\n    // Return buffered output\r\n    const output = this.outputBuffer;\r\n    this.outputBuffer = '';\r\n    return output;\r\n  }\r\n\r\n  isAlive(): boolean {\r\n    return !this.isDisposed && this.vscodeTerminal !== undefined;\r\n  }\r\n\r\n  async kill(): Promise<void> {\r\n    if (this.vscodeTerminal && !this.isDisposed) {\r\n      try {\r\n        // Try graceful shutdown first\r\n        this.vscodeTerminal.sendText('exit', true);\r\n        await delay(500);\r\n\r\n        // Dispose terminal\r\n        this.vscodeTerminal.dispose();\r\n        this.isDisposed = true;\r\n      } catch (error) {\r\n        this.logger.warn('Error killing VSCode terminal', { id: this.id, error });\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Process terminal output (called by extension)\r\n   */\r\n  processOutput(data: string): void {\r\n    this.outputBuffer += data;\r\n\r\n    // Check for command completion marker\r\n    const markerIndex = this.outputBuffer.indexOf(this.commandMarker);\r\n    if (markerIndex !== -1) {\r\n      // Extract output before marker\r\n      const output = this.outputBuffer.substring(0, markerIndex).trim();\r\n\r\n      // Clear buffer up to after marker\r\n      this.outputBuffer = this.outputBuffer\r\n        .substring(markerIndex + this.commandMarker.length)\r\n        .trim();\r\n\r\n      // Resolve pending command\r\n      this.outputDeferred.resolve(output);\r\n    }\r\n  }\r\n\r\n  private getShellPath(): string | undefined {\r\n    switch (this.shellType) {\r\n      case 'bash':\r\n        return '/bin/bash';\r\n      case 'zsh':\r\n        return '/bin/zsh';\r\n      case 'powershell':\r\n        return platform() === 'win32' ? 'powershell.exe' : 'pwsh';\r\n      case 'cmd':\r\n        return platform() === 'win32' ? 'cmd.exe' : undefined;\r\n      default:\r\n        return undefined;\r\n    }\r\n  }\r\n\r\n  private getShellArgs(): string[] {\r\n    switch (this.shellType) {\r\n      case 'bash':\r\n        return ['--norc', '--noprofile'];\r\n      case 'zsh':\r\n        return ['--no-rcs'];\r\n      case 'powershell':\r\n        return ['-NoProfile', '-NonInteractive'];\r\n      case 'cmd':\r\n        return ['/Q'];\r\n      default:\r\n        return [];\r\n    }\r\n  }\r\n\r\n  private async waitForReady(): Promise<void> {\r\n    // Send a test command to ensure terminal is ready\r\n    this.vscodeTerminal!.sendText('echo \"READY\"', true);\r\n\r\n    const startTime = Date.now();\r\n    while (Date.now() - startTime < 5000) {\r\n      if (this.outputBuffer.includes('READY')) {\r\n        this.outputBuffer = '';\r\n        return;\r\n      }\r\n      await delay(100);\r\n    }\r\n\r\n    throw new TerminalError('Terminal failed to become ready');\r\n  }\r\n}\r\n\r\n/**\r\n * VSCode terminal adapter\r\n */\r\nexport class VSCodeAdapter implements ITerminalAdapter {\r\n  private terminals = new Map<string, VSCodeTerminalWrapper>();\r\n  private vscodeApi?: VSCodeAPI;\r\n  private shellType: string;\r\n  private terminalCloseListener?: { dispose(): void };\r\n\r\n  constructor(private logger: ILogger) {\r\n    this.shellType = this.detectShell();\r\n  }\r\n\r\n  async initialize(): Promise<void> {\r\n    this.logger.info('Initializing VSCode terminal adapter');\r\n\r\n    // Check if running in VSCode extension context\r\n    if (!this.isVSCodeExtensionContext()) {\r\n      throw new TerminalError('Not running in VSCode extension context');\r\n    }\r\n\r\n    // Get VSCode API from global\r\n    this.vscodeApi = (globalThis as any).vscode;\r\n    if (!this.vscodeApi) {\r\n      throw new TerminalError('VSCode API not available');\r\n    }\r\n\r\n    // Register terminal close listener\r\n    this.terminalCloseListener = this.vscodeApi.window.onDidCloseTerminal((terminal) => {\r\n      // Find and clean up closed terminal\r\n      for (const [id, wrapper] of this.terminals.entries()) {\r\n        if ((wrapper as any).vscodeTerminal === terminal) {\r\n          this.logger.info('VSCode terminal closed', { id });\r\n          this.terminals.delete(id);\r\n          break;\r\n        }\r\n      }\r\n    });\r\n\r\n    this.logger.info('VSCode terminal adapter initialized');\r\n  }\r\n\r\n  async shutdown(): Promise<void> {\r\n    this.logger.info('Shutting down VSCode terminal adapter');\r\n\r\n    // Dispose listener\r\n    if (this.terminalCloseListener) {\r\n      this.terminalCloseListener.dispose();\r\n    }\r\n\r\n    // Kill all terminals\r\n    const terminals = Array.from(this.terminals.values());\r\n    await Promise.all(terminals.map((term) => term.kill()));\r\n\r\n    this.terminals.clear();\r\n  }\r\n\r\n  async createTerminal(): Promise<Terminal> {\r\n    if (!this.vscodeApi) {\r\n      throw new TerminalError('VSCode API not initialized');\r\n    }\r\n\r\n    const terminal = new VSCodeTerminalWrapper(this.vscodeApi, this.shellType, this.logger);\r\n\r\n    await terminal.initialize();\r\n    this.terminals.set(terminal.id, terminal);\r\n\r\n    // Register output processor if extension provides it\r\n    const outputProcessor = (globalThis as any).registerTerminalOutputProcessor;\r\n    if (outputProcessor) {\r\n      outputProcessor(terminal.id, (data: string) => terminal.processOutput(data));\r\n    }\r\n\r\n    return terminal;\r\n  }\r\n\r\n  async destroyTerminal(terminal: Terminal): Promise<void> {\r\n    await terminal.kill();\r\n    this.terminals.delete(terminal.id);\r\n  }\r\n\r\n  private isVSCodeExtensionContext(): boolean {\r\n    // Check for VSCode extension environment\r\n    return (\r\n      typeof (globalThis as any).vscode !== 'undefined' &&\r\n      typeof (globalThis as any).vscode.window !== 'undefined'\r\n    );\r\n  }\r\n\r\n  private detectShell(): string {\r\n    // Get default shell from VSCode settings or environment\r\n    const osplatform = platform();\r\n\r\n    if (osplatform === 'win32') {\r\n      // Windows defaults\r\n      const comspec = process.env.COMSPEC;\r\n      if (comspec?.toLowerCase().includes('powershell')) {\r\n        return 'powershell';\r\n      }\r\n      return 'cmd';\r\n    } else {\r\n      // Unix-like defaults\r\n      const shell = process.env.SHELL;\r\n      if (shell) {\r\n        const shellName = shell.split('/').pop();\r\n        if (shellName && ['bash', 'zsh', 'fish', 'sh'].includes(shellName)) {\r\n          return shellName;\r\n        }\r\n      }\r\n      return 'bash';\r\n    }\r\n  }\r\n}\r\n"],"names":["platform","TerminalError","generateId","delay","timeout","createDeferred","VSCodeTerminalWrapper","id","pid","vscodeTerminal","outputBuffer","commandMarker","outputDeferred","isDisposed","vscodeApi","shellType","logger","initialize","shellPath","getShellPath","terminalOptions","name","shellArgs","getShellArgs","env","CLAUDE_FLOW_TERMINAL","CLAUDE_FLOW_TERMINAL_ID","PS1","undefined","window","createTerminal","processId","show","waitForReady","debug","error","executeCommand","command","isAlive","markedCommand","sendText","output","promise","write","data","read","kill","dispose","warn","processOutput","markerIndex","indexOf","substring","trim","length","resolve","startTime","Date","now","includes","VSCodeAdapter","terminals","Map","terminalCloseListener","detectShell","info","isVSCodeExtensionContext","globalThis","vscode","onDidCloseTerminal","terminal","wrapper","entries","delete","shutdown","Array","from","values","Promise","all","map","term","clear","set","outputProcessor","registerTerminalOutputProcessor","destroyTerminal","osplatform","comspec","process","COMSPEC","toLowerCase","shell","SHELL","shellName","split","pop"],"mappings":"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"}