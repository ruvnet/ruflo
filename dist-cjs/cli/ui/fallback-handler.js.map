{
  "version": 3,
  "sources": ["../../../src/cli/ui/fallback-handler.ts"],
  "sourcesContent": ["import { getErrorMessage } from '../../utils/type-guards.js';\n/**\n * Fallback UI Handler - Handles raw mode errors gracefully\n * Provides alternative UI when Ink/raw mode isn't supported\n */\n\nimport chalk from 'chalk';\nimport { createCompatibleUI } from './compatible-ui.js';\n\nexport interface FallbackOptions {\n  enableUI?: boolean;\n  fallbackMessage?: string;\n  showHelp?: boolean;\n}\n\n/**\n * Handles raw mode errors and provides fallback UI\n */\nexport async function handleRawModeError(\n  error: Error,\n  options: FallbackOptions = {},\n): Promise<void> {\n  const isRawModeError =\n    (error instanceof Error ? error.message : String(error)).includes(\n      'Raw mode is not supported',\n    ) ||\n    (error instanceof Error ? error.message : String(error)).includes('stdin') ||\n    (error instanceof Error ? error.message : String(error)).includes('Ink');\n\n  if (!isRawModeError) {\n    throw error; // Re-throw if it's not a raw mode error\n  }\n\n  console.clear();\n  console.log(chalk.yellow.bold('\u26A0\uFE0F  Interactive Mode Not Supported'));\n  console.log(chalk.gray('\u2500'.repeat(50)));\n  console.log(chalk.white('The current terminal environment does not support'));\n  console.log(chalk.white('interactive UI features (raw mode).'));\n  console.log();\n  console.log(chalk.cyan('Common causes:'));\n  console.log(chalk.gray('\u2022 VS Code integrated terminal'));\n  console.log(chalk.gray('\u2022 WSL (Windows Subsystem for Linux)'));\n  console.log(chalk.gray('\u2022 Native Windows terminals'));\n  console.log(chalk.gray('\u2022 CI/CD environments'));\n  console.log(chalk.gray('\u2022 Docker containers'));\n  console.log(chalk.gray('\u2022 SSH sessions without TTY'));\n  console.log();\n\n  if (options.fallbackMessage) {\n    console.log(chalk.blue('\u2139\uFE0F  '), options.fallbackMessage);\n    console.log();\n  }\n\n  if (options.enableUI) {\n    console.log(chalk.green('\u2705 Launching compatible UI mode...'));\n    console.log();\n\n    try {\n      const ui = createCompatibleUI();\n      await ui.start();\n    } catch (fallbackError) {\n      console.log(chalk.red('\u274C Fallback UI also failed:'), getErrorMessage(fallbackError));\n      await showBasicInterface(options);\n    }\n  } else {\n    await showBasicInterface(options);\n  }\n}\n\n/**\n * Shows a basic text-based interface when UI isn't available\n */\nasync function showBasicInterface(options: FallbackOptions): Promise<void> {\n  console.log(chalk.green('\uD83D\uDCCB Available alternatives:'));\n  console.log();\n  console.log(chalk.white('1. Use CLI commands directly:'));\n  console.log(chalk.gray('   ./claude-flow status'));\n  console.log(chalk.gray('   ./claude-flow memory list'));\n  console.log(chalk.gray('   ./claude-flow sparc modes'));\n  console.log();\n  console.log(chalk.white('2. Use non-interactive modes:'));\n  console.log(chalk.gray('   ./claude-flow start (without --ui)'));\n  console.log(chalk.gray('   ./claude-flow swarm \"task\" --monitor'));\n  console.log();\n  console.log(chalk.white('3. Use external terminal:'));\n  console.log(chalk.gray('   Run in a standalone terminal application'));\n  console.log();\n\n  if (options.showHelp) {\n    console.log(chalk.cyan('\uD83D\uDCA1 For help with any command, use:'));\n    console.log(chalk.gray('   ./claude-flow help <command>'));\n    console.log(chalk.gray('   ./claude-flow <command> --help'));\n    console.log();\n  }\n\n  console.log(chalk.gray('Press Ctrl+C to exit'));\n\n  // Wait for user to exit\n  await new Promise(() => {\n    process.on('SIGINT', () => {\n      console.log(chalk.green('\\n\uD83D\uDC4B Goodbye!'));\n      process.exit(0);\n    });\n  });\n}\n\n/**\n * Wraps a function to catch and handle raw mode errors\n */\nexport function withRawModeFallback<T extends any[], R>(\n  fn: (...args: T) => Promise<R>,\n  fallbackOptions: FallbackOptions = {},\n) {\n  return async (...args: T): Promise<R | void> => {\n    try {\n      return await fn(...args);\n    } catch (error) {\n      if (error instanceof Error) {\n        await handleRawModeError(error, fallbackOptions);\n      } else {\n        throw error;\n      }\n    }\n  };\n}\n\n/**\n * Checks if the current environment supports interactive UI\n */\nexport function checkUISupport(): {\n  supported: boolean;\n  reason?: string;\n  recommendation?: string;\n} {\n  // Check if we're in a TTY\n  if (!process.stdin.isTTY) {\n    return {\n      supported: false,\n      reason: 'Not running in a TTY environment',\n      recommendation: 'Use a proper terminal application',\n    };\n  }\n\n  // Check if raw mode is available\n  if (typeof process.stdin.setRawMode !== 'function') {\n    return {\n      supported: false,\n      reason: 'Raw mode not available',\n      recommendation: 'Use --no-ui flag or run in external terminal',\n    };\n  }\n\n  // Check for VS Code terminal\n  if (process.env.TERM_PROGRAM === 'vscode') {\n    return {\n      supported: false,\n      reason: 'Running in VS Code integrated terminal',\n      recommendation: 'Use VS Code external terminal or standalone terminal',\n    };\n  }\n\n  // Check for other problematic environments\n  if (process.env.CI || process.env.GITHUB_ACTIONS) {\n    return {\n      supported: false,\n      reason: 'Running in CI/CD environment',\n      recommendation: 'Use non-interactive mode',\n    };\n  }\n\n  return { supported: true };\n}\n\n/**\n * Shows UI support information\n */\nexport function showUISupport(): void {\n  const support = checkUISupport();\n\n  console.log(chalk.cyan.bold('\uD83D\uDDA5\uFE0F  UI Support Information'));\n  console.log(chalk.gray('\u2500'.repeat(40)));\n\n  if (support.supported) {\n    console.log(chalk.green('\u2705 Interactive UI supported'));\n    console.log(chalk.gray('Your terminal supports all UI features'));\n  } else {\n    console.log(chalk.yellow('\u26A0\uFE0F  Limited UI support'));\n    console.log(chalk.gray(`Reason: ${support.reason}`));\n    if (support.recommendation) {\n      console.log(chalk.blue(`Recommendation: ${support.recommendation}`));\n    }\n  }\n\n  console.log();\n  console.log(chalk.white('Environment details:'));\n  console.log(chalk.gray(`\u2022 Terminal: ${process.env.TERM || 'unknown'}`));\n  console.log(chalk.gray(`\u2022 TTY: ${process.stdin.isTTY ? 'yes' : 'no'}`));\n  console.log(chalk.gray(`\u2022 Program: ${process.env.TERM_PROGRAM || 'unknown'}`));\n  console.log(chalk.gray(`\u2022 Platform: ${process.platform}`));\n}\n"],
  "mappings": "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",
  "names": ["chalk"]
}
