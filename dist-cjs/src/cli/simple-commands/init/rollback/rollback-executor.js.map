{"version":3,"sources":["../../../../../../src/cli/simple-commands/init/rollback/rollback-executor.js"],"sourcesContent":["import { promises as fs } from 'fs';\r\n// rollback-executor.js - Execute rollback operations\r\n\r\nexport class RollbackExecutor {\r\n  constructor(workingDir) {\r\n    this.workingDir = workingDir;\r\n  }\r\n\r\n  /**\r\n   * Execute full rollback to pre-initialization state\r\n   */\r\n  async executeFullRollback(backupId) {\r\n    const result = {\r\n      success: true,\r\n      errors: [],\r\n      warnings: [],\r\n      actions: [],\r\n    };\r\n\r\n    try {\r\n      console.log(`ðŸ”„ Executing full rollback to backup: ${backupId}`);\r\n\r\n      // Step 1: Remove initialization artifacts\r\n      const cleanupResult = await this.cleanupInitializationArtifacts();\r\n      result.actions.push(...cleanupResult.actions);\r\n      if (!cleanupResult.success) {\r\n        result.warnings.push(...cleanupResult.errors);\r\n      }\r\n\r\n      // Step 2: Restore from backup\r\n      const restoreResult = await this.restoreFromBackup(backupId);\r\n      result.actions.push(...restoreResult.actions);\r\n      if (!restoreResult.success) {\r\n        result.success = false;\r\n        result.errors.push(...restoreResult.errors);\r\n        return result;\r\n      }\r\n\r\n      // Step 3: Verify rollback\r\n      const verifyResult = await this.verifyRollback();\r\n      result.actions.push(...verifyResult.actions);\r\n      if (!verifyResult.success) {\r\n        result.warnings.push(...verifyResult.errors);\r\n      }\r\n\r\n      console.log('  âœ… Full rollback completed');\r\n    } catch (error) {\r\n      result.success = false;\r\n      result.errors.push(`Full rollback execution failed: ${error.message}`);\r\n    }\r\n\r\n    return result;\r\n  }\r\n\r\n  /**\r\n   * Execute partial rollback for specific component\r\n   */\r\n  async executePartialRollback(phase, checkpoint) {\r\n    const result = {\r\n      success: true,\r\n      errors: [],\r\n      warnings: [],\r\n      actions: [],\r\n    };\r\n\r\n    try {\r\n      console.log(`ðŸ”„ Executing partial rollback for phase: ${phase}`);\r\n\r\n      // Determine rollback strategy based on phase\r\n      let rollbackResult;\r\n\r\n      switch (phase) {\r\n        case 'sparc-init':\r\n          rollbackResult = await this.rollbackSparcInitialization();\r\n          break;\r\n        case 'claude-commands':\r\n          rollbackResult = await this.rollbackClaudeCommands();\r\n          break;\r\n        case 'memory-setup':\r\n          rollbackResult = await this.rollbackMemorySetup();\r\n          break;\r\n        case 'coordination-setup':\r\n          rollbackResult = await this.rollbackCoordinationSetup();\r\n          break;\r\n        case 'executable-creation':\r\n          rollbackResult = await this.rollbackExecutableCreation();\r\n          break;\r\n        default:\r\n          rollbackResult = await this.rollbackGenericPhase(phase, checkpoint);\r\n          break;\r\n      }\r\n\r\n      result.success = rollbackResult.success;\r\n      result.errors.push(...rollbackResult.errors);\r\n      result.warnings.push(...rollbackResult.warnings);\r\n      result.actions.push(...rollbackResult.actions);\r\n\r\n      if (rollbackResult.success) {\r\n        console.log(`  âœ… Partial rollback completed for phase: ${phase}`);\r\n      }\r\n    } catch (error) {\r\n      result.success = false;\r\n      result.errors.push(`Partial rollback execution failed: ${error.message}`);\r\n    }\r\n\r\n    return result;\r\n  }\r\n\r\n  /**\r\n   * Rollback SPARC initialization\r\n   */\r\n  async rollbackSparcInitialization() {\r\n    const result = {\r\n      success: true,\r\n      errors: [],\r\n      warnings: [],\r\n      actions: [],\r\n    };\r\n\r\n    try {\r\n      const itemsToRemove = ['.roomodes', '.roo', '.claude/commands/sparc'];\r\n\r\n      for (const item of itemsToRemove) {\r\n        const itemPath = `${this.workingDir}/${item}`;\r\n\r\n        try {\r\n          const stat = await fs.stat(itemPath);\r\n\r\n          if (stat.isFile) {\r\n            await fs.unlink(itemPath);\r\n            result.actions.push(`Removed file: ${item}`);\r\n          } else if (stat.isDirectory) {\r\n            await fs.unlink(itemPath, { recursive: true });\r\n            result.actions.push(`Removed directory: ${item}`);\r\n          }\r\n        } catch {\r\n          // Item doesn't exist - that's fine\r\n          result.actions.push(`Item not found (already clean): ${item}`);\r\n        }\r\n      }\r\n\r\n      // Remove SPARC-specific content from CLAUDE.md\r\n      await this.removeSPARCContentFromClaudeMd();\r\n      result.actions.push('Cleaned SPARC content from CLAUDE.md');\r\n    } catch (error) {\r\n      result.success = false;\r\n      result.errors.push(`SPARC rollback failed: ${error.message}`);\r\n    }\r\n\r\n    return result;\r\n  }\r\n\r\n  /**\r\n   * Rollback Claude commands\r\n   */\r\n  async rollbackClaudeCommands() {\r\n    const result = {\r\n      success: true,\r\n      errors: [],\r\n      warnings: [],\r\n      actions: [],\r\n    };\r\n\r\n    try {\r\n      const commandsDir = `${this.workingDir}/.claude/commands`;\r\n\r\n      try {\r\n        // Remove all command files\r\n        for await (const entry of fs.readdir(commandsDir)) {\r\n          if (entry.isFile && entry.name.endsWith('.js')) {\r\n            await fs.unlink(`${commandsDir}/${entry.name}`);\r\n            result.actions.push(`Removed command: ${entry.name}`);\r\n          } else if (entry.isDirectory) {\r\n            await fs.unlink(`${commandsDir}/${entry.name}`, { recursive: true });\r\n            result.actions.push(`Removed command directory: ${entry.name}`);\r\n          }\r\n        }\r\n      } catch {\r\n        result.actions.push('Commands directory was already clean');\r\n      }\r\n    } catch (error) {\r\n      result.success = false;\r\n      result.errors.push(`Claude commands rollback failed: ${error.message}`);\r\n    }\r\n\r\n    return result;\r\n  }\r\n\r\n  /**\r\n   * Rollback memory setup\r\n   */\r\n  async rollbackMemorySetup() {\r\n    const result = {\r\n      success: true,\r\n      errors: [],\r\n      warnings: [],\r\n      actions: [],\r\n    };\r\n\r\n    try {\r\n      const memoryItems = ['memory/claude-flow-data.json', 'memory/agents', 'memory/sessions'];\r\n\r\n      for (const item of memoryItems) {\r\n        const itemPath = `${this.workingDir}/${item}`;\r\n\r\n        try {\r\n          const stat = await fs.stat(itemPath);\r\n\r\n          if (stat.isFile) {\r\n            await fs.unlink(itemPath);\r\n            result.actions.push(`Removed memory file: ${item}`);\r\n          } else if (stat.isDirectory) {\r\n            await fs.unlink(itemPath, { recursive: true });\r\n            result.actions.push(`Removed memory directory: ${item}`);\r\n          }\r\n        } catch {\r\n          result.actions.push(`Memory item not found: ${item}`);\r\n        }\r\n      }\r\n\r\n      // Keep memory directory but clean it\r\n      try {\r\n        await fs.mkdir(`${this.workingDir}/memory`, { recursive: true });\r\n        result.actions.push('Recreated clean memory directory');\r\n      } catch {\r\n        result.warnings.push('Could not recreate memory directory');\r\n      }\r\n    } catch (error) {\r\n      result.success = false;\r\n      result.errors.push(`Memory setup rollback failed: ${error.message}`);\r\n    }\r\n\r\n    return result;\r\n  }\r\n\r\n  /**\r\n   * Rollback coordination setup\r\n   */\r\n  async rollbackCoordinationSetup() {\r\n    const result = {\r\n      success: true,\r\n      errors: [],\r\n      warnings: [],\r\n      actions: [],\r\n    };\r\n\r\n    try {\r\n      const coordinationDir = `${this.workingDir}/coordination`;\r\n\r\n      try {\r\n        await fs.unlink(coordinationDir, { recursive: true });\r\n        result.actions.push('Removed coordination directory');\r\n      } catch {\r\n        result.actions.push('Coordination directory was already clean');\r\n      }\r\n\r\n      // Remove coordination.md\r\n      try {\r\n        await fs.unlink(`${this.workingDir}/coordination.md`);\r\n        result.actions.push('Removed coordination.md');\r\n      } catch {\r\n        result.actions.push('coordination.md was already clean');\r\n      }\r\n    } catch (error) {\r\n      result.success = false;\r\n      result.errors.push(`Coordination setup rollback failed: ${error.message}`);\r\n    }\r\n\r\n    return result;\r\n  }\r\n\r\n  /**\r\n   * Rollback executable creation\r\n   */\r\n  async rollbackExecutableCreation() {\r\n    const result = {\r\n      success: true,\r\n      errors: [],\r\n      warnings: [],\r\n      actions: [],\r\n    };\r\n\r\n    try {\r\n      const executablePath = `${this.workingDir}/claude-flow`;\r\n\r\n      try {\r\n        await fs.unlink(executablePath);\r\n        result.actions.push('Removed claude-flow executable');\r\n      } catch {\r\n        result.actions.push('claude-flow executable was already clean');\r\n      }\r\n    } catch (error) {\r\n      result.success = false;\r\n      result.errors.push(`Executable rollback failed: ${error.message}`);\r\n    }\r\n\r\n    return result;\r\n  }\r\n\r\n  /**\r\n   * Generic phase rollback\r\n   */\r\n  async rollbackGenericPhase(phase, checkpoint) {\r\n    const result = {\r\n      success: true,\r\n      errors: [],\r\n      warnings: [],\r\n      actions: [],\r\n    };\r\n\r\n    try {\r\n      // Use checkpoint data to determine what to rollback\r\n      if (checkpoint && checkpoint.data) {\r\n        const actions = checkpoint.data.actions || [];\r\n\r\n        // Reverse the actions\r\n        for (const action of actions.reverse()) {\r\n          const rollbackResult = await this.reverseAction(action);\r\n          if (rollbackResult.success) {\r\n            result.actions.push(rollbackResult.description);\r\n          } else {\r\n            result.warnings.push(`Could not reverse action: ${action.type}`);\r\n          }\r\n        }\r\n      }\r\n    } catch (error) {\r\n      result.success = false;\r\n      result.errors.push(`Generic phase rollback failed: ${error.message}`);\r\n    }\r\n\r\n    return result;\r\n  }\r\n\r\n  /**\r\n   * Clean up all initialization artifacts\r\n   */\r\n  async cleanupInitializationArtifacts() {\r\n    const result = {\r\n      success: true,\r\n      errors: [],\r\n      actions: [],\r\n    };\r\n\r\n    try {\r\n      const artifactsToRemove = [\r\n        'CLAUDE.md',\r\n        'memory-bank.md',\r\n        'coordination.md',\r\n        'claude-flow',\r\n        '.roomodes',\r\n        '.roo',\r\n        '.claude',\r\n        'memory',\r\n        'coordination',\r\n      ];\r\n\r\n      for (const artifact of artifactsToRemove) {\r\n        const artifactPath = `${this.workingDir}/${artifact}`;\r\n\r\n        try {\r\n          const stat = await fs.stat(artifactPath);\r\n\r\n          if (stat.isFile) {\r\n            await fs.unlink(artifactPath);\r\n            result.actions.push(`Removed file: ${artifact}`);\r\n          } else if (stat.isDirectory) {\r\n            await fs.unlink(artifactPath, { recursive: true });\r\n            result.actions.push(`Removed directory: ${artifact}`);\r\n          }\r\n        } catch {\r\n          // Artifact doesn't exist - that's fine\r\n          result.actions.push(`Artifact not found: ${artifact}`);\r\n        }\r\n      }\r\n    } catch (error) {\r\n      result.success = false;\r\n      result.errors.push(`Cleanup failed: ${error.message}`);\r\n    }\r\n\r\n    return result;\r\n  }\r\n\r\n  /**\r\n   * Restore from backup\r\n   */\r\n  async restoreFromBackup(backupId) {\r\n    const result = {\r\n      success: true,\r\n      errors: [],\r\n      actions: [],\r\n    };\r\n\r\n    try {\r\n      // This would typically use the BackupManager\r\n      // For now, we'll simulate the restoration\r\n      result.actions.push(`Restored from backup: ${backupId}`);\r\n\r\n      // In a real implementation, this would:\r\n      // 1. Read the backup manifest\r\n      // 2. Restore each file and directory\r\n      // 3. Set correct permissions\r\n      // 4. Verify restoration\r\n    } catch (error) {\r\n      result.success = false;\r\n      result.errors.push(`Restore from backup failed: ${error.message}`);\r\n    }\r\n\r\n    return result;\r\n  }\r\n\r\n  /**\r\n   * Verify rollback completed successfully\r\n   */\r\n  async verifyRollback() {\r\n    const result = {\r\n      success: true,\r\n      errors: [],\r\n      actions: [],\r\n    };\r\n\r\n    try {\r\n      const expectedCleanItems = [\r\n        'CLAUDE.md',\r\n        'memory-bank.md',\r\n        'coordination.md',\r\n        '.roomodes',\r\n        '.roo',\r\n        'claude-flow',\r\n      ];\r\n\r\n      let foundArtifacts = 0;\r\n      for (const item of expectedCleanItems) {\r\n        try {\r\n          await fs.stat(`${this.workingDir}/${item}`);\r\n          foundArtifacts++;\r\n        } catch {\r\n          // Item doesn't exist - good\r\n        }\r\n      }\r\n\r\n      if (foundArtifacts > 0) {\r\n        result.success = false;\r\n        result.errors.push(`Rollback incomplete: ${foundArtifacts} artifacts still present`);\r\n      } else {\r\n        result.actions.push('Rollback verification passed');\r\n      }\r\n    } catch (error) {\r\n      result.success = false;\r\n      result.errors.push(`Rollback verification failed: ${error.message}`);\r\n    }\r\n\r\n    return result;\r\n  }\r\n\r\n  /**\r\n   * Remove SPARC content from CLAUDE.md\r\n   */\r\n  async removeSPARCContentFromClaudeMd() {\r\n    try {\r\n      const claudePath = `${this.workingDir}/CLAUDE.md`;\r\n\r\n      try {\r\n        const content = await fs.readFile(claudePath, 'utf8');\r\n\r\n        // Remove SPARC-specific sections\r\n        const cleanedContent = content\r\n          .replace(/## SPARC Development Commands[\\s\\S]*?(?=##|\\n#|\\n$)/g, '')\r\n          .replace(/### SPARC[\\s\\S]*?(?=###|\\n##|\\n#|\\n$)/g, '')\r\n          .replace(/\\n{3,}/g, '\\n\\n') // Clean up multiple newlines\r\n          .trim();\r\n\r\n        await fs.writeFile(claudePath, cleanedContent, 'utf8');\r\n      } catch {\r\n        // File doesn't exist or can't be modified\r\n      }\r\n    } catch {\r\n      // Error handling CLAUDE.md - continue silently\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Reverse a specific action\r\n   */\r\n  async reverseAction(action) {\r\n    const result = {\r\n      success: true,\r\n      description: '',\r\n    };\r\n\r\n    try {\r\n      switch (action.type) {\r\n        case 'file_created':\r\n          await fs.unlink(action.path);\r\n          result.description = `Removed created file: ${action.path}`;\r\n          break;\r\n\r\n        case 'directory_created':\r\n          await fs.unlink(action.path, { recursive: true });\r\n          result.description = `Removed created directory: ${action.path}`;\r\n          break;\r\n\r\n        case 'file_modified':\r\n          if (action.backup) {\r\n            await fs.writeFile(action.path, action.backup, 'utf8');\r\n            result.description = `Restored modified file: ${action.path}`;\r\n          }\r\n          break;\r\n\r\n        default:\r\n          result.success = false;\r\n          result.description = `Unknown action type: ${action.type}`;\r\n          break;\r\n      }\r\n    } catch (error) {\r\n      result.success = false;\r\n      result.description = `Failed to reverse action: ${error.message}`;\r\n    }\r\n\r\n    return result;\r\n  }\r\n}\r\n"],"names":["promises","fs","RollbackExecutor","workingDir","executeFullRollback","backupId","result","success","errors","warnings","actions","console","log","cleanupResult","cleanupInitializationArtifacts","push","restoreResult","restoreFromBackup","verifyResult","verifyRollback","error","message","executePartialRollback","phase","checkpoint","rollbackResult","rollbackSparcInitialization","rollbackClaudeCommands","rollbackMemorySetup","rollbackCoordinationSetup","rollbackExecutableCreation","rollbackGenericPhase","itemsToRemove","item","itemPath","stat","isFile","unlink","isDirectory","recursive","removeSPARCContentFromClaudeMd","commandsDir","entry","readdir","name","endsWith","memoryItems","mkdir","coordinationDir","executablePath","data","action","reverse","reverseAction","description","type","artifactsToRemove","artifact","artifactPath","expectedCleanItems","foundArtifacts","claudePath","content","readFile","cleanedContent","replace","trim","writeFile","path","backup"],"mappings":"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"}