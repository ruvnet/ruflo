{"version":3,"sources":["../../../../../src/cli/commands/start/process-manager.ts"],"sourcesContent":["/**\r\n * Process Manager - Handles lifecycle of system processes\r\n */\r\n\r\nimport { EventEmitter } from './event-emitter.js';\r\nimport chalk from 'chalk';\r\nimport { ProcessInfo, ProcessType, ProcessStatus, ProcessMetrics, SystemStats } from './types.js';\r\nimport { Orchestrator } from '../../../core/orchestrator.js';\r\nimport { TerminalManager } from '../../../terminal/manager.js';\r\nimport { MemoryManager } from '../../../memory/manager.js';\r\nimport { CoordinationManager } from '../../../coordination/manager.js';\r\nimport { MCPServer } from '../../../mcp/server.js';\r\nimport { eventBus } from '../../../core/event-bus.js';\r\nimport { logger } from '../../../core/logger.js';\r\nimport { configManager } from '../../../core/config.js';\r\n\r\nexport class ProcessManager extends EventEmitter {\r\n  private processes: Map<string, ProcessInfo> = new Map();\r\n  private orchestrator: Orchestrator | undefined;\r\n  private terminalManager: TerminalManager | undefined;\r\n  private memoryManager: MemoryManager | undefined;\r\n  private coordinationManager: CoordinationManager | undefined;\r\n  private mcpServer: MCPServer | undefined;\r\n  private config: any;\r\n\r\n  constructor() {\r\n    super();\r\n    this.initializeProcesses();\r\n  }\r\n\r\n  private initializeProcesses(): void {\r\n    // Define all manageable processes\r\n    const processDefinitions: ProcessInfo[] = [\r\n      {\r\n        id: 'event-bus',\r\n        name: 'Event Bus',\r\n        type: ProcessType.EVENT_BUS,\r\n        status: ProcessStatus.STOPPED,\r\n      },\r\n      {\r\n        id: 'orchestrator',\r\n        name: 'Orchestrator Engine',\r\n        type: ProcessType.ORCHESTRATOR,\r\n        status: ProcessStatus.STOPPED,\r\n      },\r\n      {\r\n        id: 'memory-manager',\r\n        name: 'Memory Manager',\r\n        type: ProcessType.MEMORY_MANAGER,\r\n        status: ProcessStatus.STOPPED,\r\n      },\r\n      {\r\n        id: 'terminal-pool',\r\n        name: 'Terminal Pool',\r\n        type: ProcessType.TERMINAL_POOL,\r\n        status: ProcessStatus.STOPPED,\r\n      },\r\n      {\r\n        id: 'mcp-server',\r\n        name: 'MCP Server',\r\n        type: ProcessType.MCP_SERVER,\r\n        status: ProcessStatus.STOPPED,\r\n      },\r\n      {\r\n        id: 'coordinator',\r\n        name: 'Coordination Manager',\r\n        type: ProcessType.COORDINATOR,\r\n        status: ProcessStatus.STOPPED,\r\n      },\r\n    ];\r\n\r\n    for (const process of processDefinitions) {\r\n      this.processes.set(process.id, process);\r\n    }\r\n  }\r\n\r\n  async initialize(configPath?: string): Promise<void> {\r\n    try {\r\n      this.config = await configManager.load(configPath);\r\n      this.emit('initialized', { config: this.config });\r\n    } catch (error) {\r\n      this.emit('error', { component: 'ProcessManager', error });\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  async startProcess(processId: string): Promise<void> {\r\n    const process = this.processes.get(processId);\r\n    if (!process) {\r\n      throw new Error(`Unknown process: ${processId}`);\r\n    }\r\n\r\n    if (process.status === ProcessStatus.RUNNING) {\r\n      throw new Error(`Process ${processId} is already running`);\r\n    }\r\n\r\n    this.updateProcessStatus(processId, ProcessStatus.STARTING);\r\n\r\n    try {\r\n      switch (process.type) {\r\n        case ProcessType.EVENT_BUS:\r\n          // Event bus is already initialized globally\r\n          process.pid = Deno.pid;\r\n          break;\r\n\r\n        case ProcessType.MEMORY_MANAGER:\r\n          this.memoryManager = new MemoryManager(this.config.memory, eventBus, logger);\r\n          await this.memoryManager.initialize();\r\n          break;\r\n\r\n        case ProcessType.TERMINAL_POOL:\r\n          this.terminalManager = new TerminalManager(this.config.terminal, eventBus, logger);\r\n          await this.terminalManager.initialize();\r\n          break;\r\n\r\n        case ProcessType.COORDINATOR:\r\n          this.coordinationManager = new CoordinationManager(\r\n            this.config.coordination,\r\n            eventBus,\r\n            logger,\r\n          );\r\n          await this.coordinationManager.initialize();\r\n          break;\r\n\r\n        case ProcessType.MCP_SERVER:\r\n          this.mcpServer = new MCPServer(this.config.mcp, eventBus, logger);\r\n          await this.mcpServer.start();\r\n          break;\r\n\r\n        case ProcessType.ORCHESTRATOR:\r\n          if (\r\n            !this.terminalManager ||\r\n            !this.memoryManager ||\r\n            !this.coordinationManager ||\r\n            !this.mcpServer\r\n          ) {\r\n            throw new Error('Required components not initialized');\r\n          }\r\n\r\n          this.orchestrator = new Orchestrator(\r\n            this.config,\r\n            this.terminalManager,\r\n            this.memoryManager,\r\n            this.coordinationManager,\r\n            this.mcpServer,\r\n            eventBus,\r\n            logger,\r\n          );\r\n          await this.orchestrator.initialize();\r\n          break;\r\n      }\r\n\r\n      process.startTime = Date.now();\r\n      this.updateProcessStatus(processId, ProcessStatus.RUNNING);\r\n      this.emit('processStarted', { processId, process });\r\n    } catch (error) {\r\n      this.updateProcessStatus(processId, ProcessStatus.ERROR);\r\n      process.metrics = {\r\n        ...process.metrics,\r\n        lastError: (error as Error).message,\r\n      };\r\n      this.emit('processError', { processId, error });\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  async stopProcess(processId: string): Promise<void> {\r\n    const process = this.processes.get(processId);\r\n    if (!process || process.status !== ProcessStatus.RUNNING) {\r\n      throw new Error(`Process ${processId} is not running`);\r\n    }\r\n\r\n    this.updateProcessStatus(processId, ProcessStatus.STOPPING);\r\n\r\n    try {\r\n      switch (process.type) {\r\n        case ProcessType.ORCHESTRATOR:\r\n          if (this.orchestrator) {\r\n            await this.orchestrator.shutdown();\r\n            this.orchestrator = undefined;\r\n          }\r\n          break;\r\n\r\n        case ProcessType.MCP_SERVER:\r\n          if (this.mcpServer) {\r\n            await this.mcpServer.stop();\r\n            this.mcpServer = undefined;\r\n          }\r\n          break;\r\n\r\n        case ProcessType.MEMORY_MANAGER:\r\n          if (this.memoryManager) {\r\n            await this.memoryManager.shutdown();\r\n            this.memoryManager = undefined;\r\n          }\r\n          break;\r\n\r\n        case ProcessType.TERMINAL_POOL:\r\n          if (this.terminalManager) {\r\n            await this.terminalManager.shutdown();\r\n            this.terminalManager = undefined;\r\n          }\r\n          break;\r\n\r\n        case ProcessType.COORDINATOR:\r\n          if (this.coordinationManager) {\r\n            await this.coordinationManager.shutdown();\r\n            this.coordinationManager = undefined;\r\n          }\r\n          break;\r\n      }\r\n\r\n      this.updateProcessStatus(processId, ProcessStatus.STOPPED);\r\n      this.emit('processStopped', { processId });\r\n    } catch (error) {\r\n      this.updateProcessStatus(processId, ProcessStatus.ERROR);\r\n      this.emit('processError', { processId, error });\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  async restartProcess(processId: string): Promise<void> {\r\n    await this.stopProcess(processId);\r\n    await new Promise((resolve) => setTimeout(resolve, 1000)); // Brief delay\r\n    await this.startProcess(processId);\r\n  }\r\n\r\n  async startAll(): Promise<void> {\r\n    // Start in dependency order\r\n    const startOrder = [\r\n      'event-bus',\r\n      'memory-manager',\r\n      'terminal-pool',\r\n      'coordinator',\r\n      'mcp-server',\r\n      'orchestrator',\r\n    ];\r\n\r\n    for (const processId of startOrder) {\r\n      try {\r\n        await this.startProcess(processId);\r\n      } catch (error) {\r\n        console.error(chalk.red(`Failed to start ${processId}:`), (error as Error).message);\r\n        // Continue with other processes\r\n      }\r\n    }\r\n  }\r\n\r\n  async stopAll(): Promise<void> {\r\n    // Stop in reverse dependency order\r\n    const stopOrder = [\r\n      'orchestrator',\r\n      'mcp-server',\r\n      'coordinator',\r\n      'terminal-pool',\r\n      'memory-manager',\r\n      'event-bus',\r\n    ];\r\n\r\n    for (const processId of stopOrder) {\r\n      const process = this.processes.get(processId);\r\n      if (process && process.status === ProcessStatus.RUNNING) {\r\n        try {\r\n          await this.stopProcess(processId);\r\n        } catch (error) {\r\n          console.error(chalk.red(`Failed to stop ${processId}:`), (error as Error).message);\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  getProcess(processId: string): ProcessInfo | undefined {\r\n    return this.processes.get(processId);\r\n  }\r\n\r\n  getAllProcesses(): ProcessInfo[] {\r\n    return Array.from(this.processes.values());\r\n  }\r\n\r\n  getSystemStats(): SystemStats {\r\n    const processes = this.getAllProcesses();\r\n    const runningProcesses = processes.filter((p) => p.status === ProcessStatus.RUNNING);\r\n    const stoppedProcesses = processes.filter((p) => p.status === ProcessStatus.STOPPED);\r\n    const errorProcesses = processes.filter((p) => p.status === ProcessStatus.ERROR);\r\n\r\n    return {\r\n      totalProcesses: processes.length,\r\n      runningProcesses: runningProcesses.length,\r\n      stoppedProcesses: stoppedProcesses.length,\r\n      errorProcesses: errorProcesses.length,\r\n      systemUptime: this.getSystemUptime(),\r\n      totalMemory: this.getTotalMemoryUsage(),\r\n      totalCpu: this.getTotalCpuUsage(),\r\n    };\r\n  }\r\n\r\n  private updateProcessStatus(processId: string, status: ProcessStatus): void {\r\n    const process = this.processes.get(processId);\r\n    if (process) {\r\n      process.status = status;\r\n      this.emit('statusChanged', { processId, status });\r\n    }\r\n  }\r\n\r\n  private getSystemUptime(): number {\r\n    const orchestrator = this.processes.get('orchestrator');\r\n    if (orchestrator && orchestrator.startTime) {\r\n      return Date.now() - orchestrator.startTime;\r\n    }\r\n    return 0;\r\n  }\r\n\r\n  private getTotalMemoryUsage(): number {\r\n    // Placeholder - would integrate with actual memory monitoring\r\n    return 0;\r\n  }\r\n\r\n  private getTotalCpuUsage(): number {\r\n    // Placeholder - would integrate with actual CPU monitoring\r\n    return 0;\r\n  }\r\n\r\n  async getProcessLogs(processId: string, lines: number = 50): Promise<string[]> {\r\n    // Placeholder - would integrate with actual logging system\r\n    return [\r\n      `[${new Date().toISOString()}] Process ${processId} started`,\r\n      `[${new Date().toISOString()}] Process ${processId} is running normally`,\r\n    ];\r\n  }\r\n}\r\n"],"names":["EventEmitter","chalk","ProcessType","ProcessStatus","Orchestrator","TerminalManager","MemoryManager","CoordinationManager","MCPServer","eventBus","logger","configManager","ProcessManager","processes","Map","orchestrator","terminalManager","memoryManager","coordinationManager","mcpServer","config","initializeProcesses","processDefinitions","id","name","type","EVENT_BUS","status","STOPPED","ORCHESTRATOR","MEMORY_MANAGER","TERMINAL_POOL","MCP_SERVER","COORDINATOR","process","set","initialize","configPath","load","emit","error","component","startProcess","processId","get","Error","RUNNING","updateProcessStatus","STARTING","pid","Deno","memory","terminal","coordination","mcp","start","startTime","Date","now","ERROR","metrics","lastError","message","stopProcess","STOPPING","shutdown","undefined","stop","restartProcess","Promise","resolve","setTimeout","startAll","startOrder","console","red","stopAll","stopOrder","getProcess","getAllProcesses","Array","from","values","getSystemStats","runningProcesses","filter","p","stoppedProcesses","errorProcesses","totalProcesses","length","systemUptime","getSystemUptime","totalMemory","getTotalMemoryUsage","totalCpu","getTotalCpuUsage","getProcessLogs","lines","toISOString"],"mappings":"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"}