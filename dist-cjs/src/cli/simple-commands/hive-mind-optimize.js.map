{"version":3,"sources":["../../../../src/cli/simple-commands/hive-mind-optimize.js"],"sourcesContent":["/**\r\n * Hive Mind Database Optimization Command\r\n *\r\n * Safe optimization of existing hive mind databases without breaking compatibility\r\n */\r\n\r\nimport { cwd, exit } from '../node-compat.js';\r\nimport path from 'path';\r\nimport { existsSync } from 'fs';\r\nimport chalk from 'chalk';\r\nimport inquirer from 'inquirer';\r\nimport {\r\n  optimizeHiveMindDatabase,\r\n  performMaintenance,\r\n  generateOptimizationReport,\r\n} from './hive-mind/db-optimizer.js';\r\n\r\n/**\r\n * Show help for hive-mind-optimize command\r\n */\r\nfunction showOptimizeHelp() {\r\n  console.log(`\r\n${chalk.yellow('ðŸ”§ Hive Mind Database Optimization')}\r\n\r\n${chalk.bold('USAGE:')}\r\n  claude-flow hive-mind-optimize [options]\r\n\r\n${chalk.bold('OPTIONS:')}\r\n  --auto              Run optimization without prompts\r\n  --vacuum            Vacuum database (requires exclusive access)\r\n  --clean-memory      Clean old memory entries\r\n  --archive-tasks     Archive completed tasks\r\n  --check-integrity   Run integrity check\r\n  --report            Generate optimization report only\r\n  --memory-days <n>   Memory retention days (default: 30)\r\n  --task-days <n>     Task retention days (default: 7)\r\n  --verbose           Show detailed output\r\n\r\n${chalk.bold('EXAMPLES:')}\r\n  ${chalk.gray('# Interactive optimization')}\r\n  claude-flow hive-mind-optimize\r\n\r\n  ${chalk.gray('# Auto-optimize with all features')}\r\n  claude-flow hive-mind-optimize --auto --vacuum --clean-memory --archive-tasks\r\n\r\n  ${chalk.gray('# Generate report only')}\r\n  claude-flow hive-mind-optimize --report\r\n\r\n  ${chalk.gray('# Custom retention periods')}\r\n  claude-flow hive-mind-optimize --clean-memory --memory-days 60 --task-days 14\r\n\r\n${chalk.bold('FEATURES:')}\r\n  ${chalk.cyan('ðŸš€')} Performance indexes for faster queries\r\n  ${chalk.cyan('ðŸ“Š')} Query optimization and statistics\r\n  ${chalk.cyan('ðŸ§¹')} Memory cleanup and archiving\r\n  ${chalk.cyan('ðŸ“ˆ')} Performance tracking tables\r\n  ${chalk.cyan('ðŸ”')} Behavioral pattern analysis\r\n  ${chalk.cyan('ðŸ’¾')} Backward-compatible upgrades\r\n\r\n${chalk.bold('SAFETY:')}\r\n  â€¢ All changes are backward-compatible\r\n  â€¢ Existing data is preserved\r\n  â€¢ Automatic backups before major operations\r\n  â€¢ Rollback capability on errors\r\n`);\r\n}\r\n\r\n/**\r\n * Main optimization command handler\r\n */\r\nexport async function hiveMindOptimizeCommand(args, flags) {\r\n  // Show help if requested\r\n  if (flags.help || flags.h) {\r\n    showOptimizeHelp();\r\n    return;\r\n  }\r\n\r\n  // Check if hive mind is initialized\r\n  const hiveMindDir = path.join(cwd(), '.hive-mind');\r\n  const dbPath = path.join(hiveMindDir, 'hive.db');\r\n\r\n  if (!existsSync(dbPath)) {\r\n    console.error(chalk.red('Error: Hive Mind database not found'));\r\n    console.log('Run \"claude-flow hive-mind init\" first');\r\n    exit(1);\r\n  }\r\n\r\n  // Generate report only\r\n  if (flags.report) {\r\n    await generateReport(dbPath);\r\n    return;\r\n  }\r\n\r\n  // Auto mode or interactive\r\n  if (flags.auto) {\r\n    await runOptimization(dbPath, {\r\n      vacuum: flags.vacuum || false,\r\n      cleanMemory: flags['clean-memory'] || false,\r\n      archiveTasks: flags['archive-tasks'] || false,\r\n      checkIntegrity: flags['check-integrity'] || false,\r\n      memoryRetentionDays: flags['memory-days'] || 30,\r\n      taskRetentionDays: flags['task-days'] || 7,\r\n      verbose: flags.verbose || false,\r\n    });\r\n  } else {\r\n    await interactiveOptimization(dbPath, flags);\r\n  }\r\n}\r\n\r\n/**\r\n * Interactive optimization wizard\r\n */\r\nasync function interactiveOptimization(dbPath, flags) {\r\n  console.log(chalk.yellow('\\nðŸ”§ Hive Mind Database Optimization Wizard\\n'));\r\n\r\n  // Generate current report\r\n  const report = await generateOptimizationReport(dbPath);\r\n\r\n  if (report) {\r\n    console.log(chalk.cyan('Current Database Status:'));\r\n    console.log(`  Schema Version: ${report.schemaVersion}`);\r\n    console.log(`  Tables: ${Object.keys(report.tables).length}`);\r\n    console.log(`  Indexes: ${report.indexes.length}`);\r\n\r\n    let totalSize = 0;\r\n    let totalRows = 0;\r\n    Object.entries(report.tables).forEach(([name, stats]) => {\r\n      totalSize += stats.sizeBytes;\r\n      totalRows += stats.rowCount;\r\n    });\r\n\r\n    console.log(`  Total Size: ${(totalSize / 1024 / 1024).toFixed(2)} MB`);\r\n    console.log(`  Total Rows: ${totalRows.toLocaleString()}`);\r\n    console.log('');\r\n  }\r\n\r\n  // Check what optimizations are needed\r\n  const schemaVersion = report?.schemaVersion || 1.0;\r\n  const needsOptimization = schemaVersion < 1.5;\r\n\r\n  if (!needsOptimization) {\r\n    console.log(chalk.green('âœ“ Database is already fully optimized!\\n'));\r\n\r\n    const { maintenance } = await inquirer.prompt([\r\n      {\r\n        type: 'confirm',\r\n        name: 'maintenance',\r\n        message: 'Would you like to perform maintenance tasks?',\r\n        default: true,\r\n      },\r\n    ]);\r\n\r\n    if (!maintenance) {\r\n      console.log(chalk.gray('No changes made.'));\r\n      return;\r\n    }\r\n  } else {\r\n    console.log(\r\n      chalk.yellow(`âš  Database can be optimized from version ${schemaVersion} to 1.5\\n`),\r\n    );\r\n  }\r\n\r\n  // Ask for optimization options\r\n  const answers = await inquirer.prompt([\r\n    {\r\n      type: 'checkbox',\r\n      name: 'operations',\r\n      message: 'Select operations to perform:',\r\n      choices: [\r\n        {\r\n          name: 'Apply performance optimizations',\r\n          value: 'optimize',\r\n          checked: needsOptimization,\r\n          disabled: !needsOptimization,\r\n        },\r\n        {\r\n          name: 'Clean old memory entries',\r\n          value: 'cleanMemory',\r\n          checked: true,\r\n        },\r\n        {\r\n          name: 'Archive completed tasks',\r\n          value: 'archiveTasks',\r\n          checked: true,\r\n        },\r\n        {\r\n          name: 'Vacuum database (requires exclusive access)',\r\n          value: 'vacuum',\r\n          checked: false,\r\n        },\r\n        {\r\n          name: 'Check database integrity',\r\n          value: 'checkIntegrity',\r\n          checked: true,\r\n        },\r\n      ],\r\n    },\r\n    {\r\n      type: 'number',\r\n      name: 'memoryDays',\r\n      message: 'Memory retention days:',\r\n      default: 30,\r\n      when: (answers) => answers.operations.includes('cleanMemory'),\r\n    },\r\n    {\r\n      type: 'number',\r\n      name: 'taskDays',\r\n      message: 'Task retention days:',\r\n      default: 7,\r\n      when: (answers) => answers.operations.includes('archiveTasks'),\r\n    },\r\n    {\r\n      type: 'confirm',\r\n      name: 'confirm',\r\n      message: 'Proceed with optimization?',\r\n      default: true,\r\n    },\r\n  ]);\r\n\r\n  if (!answers.confirm) {\r\n    console.log(chalk.gray('Optimization cancelled.'));\r\n    return;\r\n  }\r\n\r\n  // Create backup if doing major operations\r\n  if (answers.operations.includes('optimize') || answers.operations.includes('vacuum')) {\r\n    console.log(chalk.blue('\\nðŸ“¦ Creating backup...'));\r\n    await createBackup(dbPath);\r\n  }\r\n\r\n  // Run optimization\r\n  const options = {\r\n    vacuum: answers.operations.includes('vacuum'),\r\n    cleanMemory: answers.operations.includes('cleanMemory'),\r\n    archiveTasks: answers.operations.includes('archiveTasks'),\r\n    checkIntegrity: answers.operations.includes('checkIntegrity'),\r\n    memoryRetentionDays: answers.memoryDays || 30,\r\n    taskRetentionDays: answers.taskDays || 7,\r\n    verbose: flags.verbose || false,\r\n  };\r\n\r\n  await runOptimization(dbPath, options);\r\n}\r\n\r\n/**\r\n * Run database optimization\r\n */\r\nasync function runOptimization(dbPath, options) {\r\n  console.log(chalk.blue('\\nðŸš€ Starting optimization...\\n'));\r\n\r\n  // Run schema optimization\r\n  const result = await optimizeHiveMindDatabase(dbPath, options);\r\n\r\n  if (!result.success) {\r\n    console.error(chalk.red('\\nâŒ Optimization failed:', result.error));\r\n    exit(1);\r\n  }\r\n\r\n  // Run maintenance tasks\r\n  if (options.cleanMemory || options.archiveTasks || options.checkIntegrity) {\r\n    console.log(chalk.blue('\\nðŸ§¹ Running maintenance tasks...\\n'));\r\n    await performMaintenance(dbPath, options);\r\n  }\r\n\r\n  // Generate final report\r\n  console.log(chalk.blue('\\nðŸ“Š Generating optimization report...\\n'));\r\n  await generateReport(dbPath);\r\n\r\n  console.log(chalk.green('\\nâœ… Optimization complete!\\n'));\r\n\r\n  // Show tips\r\n  console.log(chalk.bold('ðŸ’¡ Tips:'));\r\n  console.log('  â€¢ Monitor performance with: claude-flow hive-mind metrics');\r\n  console.log('  â€¢ Schedule regular maintenance: claude-flow hive-mind-optimize --auto');\r\n  console.log('  â€¢ Check swarm status: claude-flow hive-mind status');\r\n}\r\n\r\n/**\r\n * Generate and display optimization report\r\n */\r\nasync function generateReport(dbPath) {\r\n  const report = await generateOptimizationReport(dbPath);\r\n\r\n  if (!report) {\r\n    console.error(chalk.red('Failed to generate report'));\r\n    return;\r\n  }\r\n\r\n  console.log(chalk.bold('\\nðŸ“Š Database Optimization Report\\n'));\r\n  console.log(chalk.cyan('Schema Version:'), report.schemaVersion);\r\n  console.log(chalk.cyan('Indexes:'), report.indexes.length);\r\n\r\n  console.log(chalk.cyan('\\nTable Statistics:'));\r\n  Object.entries(report.tables).forEach(([name, stats]) => {\r\n    const sizeMB = (stats.sizeBytes / 1024 / 1024).toFixed(2);\r\n    console.log(`  ${name}: ${stats.rowCount.toLocaleString()} rows (${sizeMB} MB)`);\r\n  });\r\n\r\n  if (report.performance.avgTaskCompletionMinutes > 0) {\r\n    console.log(chalk.cyan('\\nPerformance Metrics:'));\r\n    console.log(\r\n      `  Avg Task Completion: ${report.performance.avgTaskCompletionMinutes.toFixed(1)} minutes`,\r\n    );\r\n  }\r\n\r\n  // Optimization suggestions\r\n  console.log(chalk.cyan('\\nOptimization Status:'));\r\n  if (report.schemaVersion >= 1.5) {\r\n    console.log(chalk.green('  âœ“ Database is fully optimized'));\r\n  } else {\r\n    console.log(chalk.yellow(`  âš  Can be upgraded from v${report.schemaVersion} to v1.5`));\r\n    console.log(chalk.gray('    Run: claude-flow hive-mind-optimize'));\r\n  }\r\n\r\n  // Check for large tables\r\n  const largeMemoryTable = report.tables.collective_memory?.rowCount > 10000;\r\n  const largeTaskTable = report.tables.tasks?.rowCount > 50000;\r\n\r\n  if (largeMemoryTable || largeTaskTable) {\r\n    console.log(chalk.cyan('\\nMaintenance Recommendations:'));\r\n    if (largeMemoryTable) {\r\n      console.log(chalk.yellow('  â€¢ Consider cleaning old memory entries'));\r\n    }\r\n    if (largeTaskTable) {\r\n      console.log(chalk.yellow('  â€¢ Consider archiving completed tasks'));\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * Create database backup\r\n */\r\nasync function createBackup(dbPath) {\r\n  try {\r\n    const { execSync } = await import('child_process');\r\n    const timestamp = new Date().toISOString().replace(/[:.]/g, '-');\r\n    const backupPath = dbPath.replace('.db', `-backup-${timestamp}.db`);\r\n\r\n    execSync(`cp \"${dbPath}\" \"${backupPath}\"`);\r\n    console.log(chalk.green(`âœ“ Backup created: ${path.basename(backupPath)}`));\r\n\r\n    return backupPath;\r\n  } catch (error) {\r\n    console.error(chalk.yellow('âš  Backup failed:', error.message));\r\n    const { proceed } = await inquirer.prompt([\r\n      {\r\n        type: 'confirm',\r\n        name: 'proceed',\r\n        message: 'Continue without backup?',\r\n        default: false,\r\n      },\r\n    ]);\r\n\r\n    if (!proceed) {\r\n      exit(1);\r\n    }\r\n  }\r\n}\r\n\r\n// Export for CLI\r\nexport default hiveMindOptimizeCommand;\r\n"],"names":["cwd","exit","path","existsSync","chalk","inquirer","optimizeHiveMindDatabase","performMaintenance","generateOptimizationReport","showOptimizeHelp","console","log","yellow","bold","gray","cyan","hiveMindOptimizeCommand","args","flags","help","h","hiveMindDir","join","dbPath","error","red","report","generateReport","auto","runOptimization","vacuum","cleanMemory","archiveTasks","checkIntegrity","memoryRetentionDays","taskRetentionDays","verbose","interactiveOptimization","schemaVersion","Object","keys","tables","length","indexes","totalSize","totalRows","entries","forEach","name","stats","sizeBytes","rowCount","toFixed","toLocaleString","needsOptimization","green","maintenance","prompt","type","message","default","answers","choices","value","checked","disabled","when","operations","includes","confirm","blue","createBackup","options","memoryDays","taskDays","result","success","sizeMB","performance","avgTaskCompletionMinutes","largeMemoryTable","collective_memory","largeTaskTable","tasks","execSync","timestamp","Date","toISOString","replace","backupPath","basename","proceed"],"mappings":"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"}