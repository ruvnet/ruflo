{"version":3,"sources":["../../../src/cli/node-repl.ts"],"sourcesContent":["/**\r\n * Node.js Interactive REPL for Claude-Flow\r\n * Compatible implementation using Node.js readline and inquirer\r\n */\r\n\r\nimport readline from 'readline';\r\nimport fs from 'fs/promises';\r\nimport path from 'path';\r\nimport { spawn } from 'child_process';\r\nimport chalk from 'chalk';\r\nimport colors from 'chalk';\r\nimport Table from 'cli-table3';\r\nimport inquirer from 'inquirer';\r\n\r\ninterface REPLCommand {\r\n  name: string;\r\n  aliases?: string[];\r\n  description: string;\r\n  usage?: string;\r\n  examples?: string[];\r\n  handler: (args: string[], context: REPLContext) => Promise<void>;\r\n}\r\n\r\ninterface REPLContext {\r\n  options: any;\r\n  history: string[];\r\n  workingDirectory: string;\r\n  currentSession?: string;\r\n  connectionStatus: 'connected' | 'disconnected' | 'connecting';\r\n  lastActivity: Date;\r\n  rl: readline.Interface;\r\n}\r\n\r\nclass CommandHistory {\r\n  private history: string[] = [];\r\n  private maxSize = 1000;\r\n  private historyFile: string;\r\n\r\n  constructor(historyFile?: string) {\r\n    this.historyFile = historyFile || path.join(process.cwd(), '.claude-flow-history');\r\n    this.loadHistory();\r\n  }\r\n\r\n  add(command: string): void {\r\n    if (command.trim() && command !== this.history[this.history.length - 1]) {\r\n      this.history.push(command);\r\n      if (this.history.length > this.maxSize) {\r\n        this.history = this.history.slice(-this.maxSize);\r\n      }\r\n      this.saveHistory();\r\n    }\r\n  }\r\n\r\n  get(): string[] {\r\n    return [...this.history];\r\n  }\r\n\r\n  search(query: string): string[] {\r\n    return this.history.filter((cmd) => cmd.includes(query));\r\n  }\r\n\r\n  private async loadHistory(): Promise<void> {\r\n    try {\r\n      const content = await fs.readFile(this.historyFile, 'utf-8');\r\n      this.history = content.split('\\n').filter((line) => line.trim());\r\n    } catch {\r\n      // History file doesn't exist yet\r\n    }\r\n  }\r\n\r\n  private async saveHistory(): Promise<void> {\r\n    try {\r\n      await fs.writeFile(this.historyFile, this.history.join('\\n'));\r\n    } catch {\r\n      // Ignore save errors\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * Start the Node.js interactive REPL\r\n */\r\nexport async function startNodeREPL(options: any = {}): Promise<void> {\r\n  const rl = readline.createInterface({\r\n    input: process.stdin,\r\n    output: process.stdout,\r\n    prompt: '',\r\n  });\r\n\r\n  const context: REPLContext = {\r\n    options,\r\n    history: [],\r\n    workingDirectory: process.cwd(),\r\n    connectionStatus: 'disconnected',\r\n    lastActivity: new Date(),\r\n    rl,\r\n  };\r\n\r\n  const history = new CommandHistory(options.historyFile);\r\n\r\n  const commands: REPLCommand[] = [\r\n    {\r\n      name: 'help',\r\n      aliases: ['h', '?'],\r\n      description: 'Show available commands or help for a specific command',\r\n      usage: 'help [command]',\r\n      examples: ['help', 'help agent', 'help task create'],\r\n      handler: async (args) => {\r\n        if (args.length === 0) {\r\n          showHelp(commands);\r\n        } else {\r\n          showCommandHelp(commands, args[0]);\r\n        }\r\n      },\r\n    },\r\n    {\r\n      name: 'status',\r\n      aliases: ['st'],\r\n      description: 'Show system status and connection info',\r\n      usage: 'status [component]',\r\n      examples: ['status', 'status orchestrator'],\r\n      handler: async (args, ctx) => {\r\n        await showSystemStatus(ctx, args[0]);\r\n      },\r\n    },\r\n    {\r\n      name: 'connect',\r\n      aliases: ['conn'],\r\n      description: 'Connect to Claude-Flow orchestrator',\r\n      usage: 'connect [host:port]',\r\n      examples: ['connect', 'connect localhost:3000'],\r\n      handler: async (args, ctx) => {\r\n        await connectToOrchestrator(ctx, args[0]);\r\n      },\r\n    },\r\n    {\r\n      name: 'agent',\r\n      description: 'Agent management (spawn, list, terminate, info)',\r\n      usage: 'agent <subcommand> [options]',\r\n      examples: [\r\n        'agent list',\r\n        'agent spawn researcher --name \"Research Agent\"',\r\n        'agent info agent-001',\r\n        'agent terminate agent-001',\r\n      ],\r\n      handler: async (args, ctx) => {\r\n        await handleAgentCommand(args, ctx);\r\n      },\r\n    },\r\n    {\r\n      name: 'task',\r\n      description: 'Task management (create, list, status, cancel)',\r\n      usage: 'task <subcommand> [options]',\r\n      examples: [\r\n        'task list',\r\n        'task create research \"Find quantum computing papers\"',\r\n        'task status task-001',\r\n        'task cancel task-001',\r\n      ],\r\n      handler: async (args, ctx) => {\r\n        await handleTaskCommand(args, ctx);\r\n      },\r\n    },\r\n    {\r\n      name: 'memory',\r\n      description: 'Memory operations (query, stats, export)',\r\n      usage: 'memory <subcommand> [options]',\r\n      examples: ['memory stats', 'memory query --agent agent-001', 'memory export memory.json'],\r\n      handler: async (args, ctx) => {\r\n        await handleMemoryCommand(args, ctx);\r\n      },\r\n    },\r\n    {\r\n      name: 'session',\r\n      description: 'Session management (save, restore, list)',\r\n      usage: 'session <subcommand> [options]',\r\n      examples: [\r\n        'session list',\r\n        'session save \"Development Session\"',\r\n        'session restore session-001',\r\n      ],\r\n      handler: async (args, ctx) => {\r\n        await handleSessionCommand(args, ctx);\r\n      },\r\n    },\r\n    {\r\n      name: 'workflow',\r\n      description: 'Workflow operations (run, list, status)',\r\n      usage: 'workflow <subcommand> [options]',\r\n      examples: ['workflow list', 'workflow run workflow.json', 'workflow status workflow-001'],\r\n      handler: async (args, ctx) => {\r\n        await handleWorkflowCommand(args, ctx);\r\n      },\r\n    },\r\n    {\r\n      name: 'monitor',\r\n      aliases: ['mon'],\r\n      description: 'Start monitoring mode',\r\n      usage: 'monitor [--interval seconds]',\r\n      examples: ['monitor', 'monitor --interval 5'],\r\n      handler: async (args) => {\r\n        console.log(chalk.cyan('Starting monitor mode...'));\r\n        console.log(chalk.gray('(This would start the live dashboard)'));\r\n      },\r\n    },\r\n    {\r\n      name: 'history',\r\n      aliases: ['hist'],\r\n      description: 'Show command history',\r\n      usage: 'history [--search query]',\r\n      examples: ['history', 'history --search agent'],\r\n      handler: async (args) => {\r\n        const searchQuery =\r\n          args.indexOf('--search') >= 0 ? args[args.indexOf('--search') + 1] : null;\r\n        const historyItems = searchQuery ? history.search(searchQuery) : history.get();\r\n\r\n        console.log(\r\n          chalk.cyan.bold(`Command History${searchQuery ? ` (search: ${searchQuery})` : ''}`),\r\n        );\r\n        console.log('‚îÄ'.repeat(50));\r\n\r\n        if (historyItems.length === 0) {\r\n          console.log(chalk.gray('No commands in history'));\r\n          return;\r\n        }\r\n\r\n        const recent = historyItems.slice(-20); // Show last 20\r\n        recent.forEach((cmd, i) => {\r\n          const lineNumber = historyItems.length - recent.length + i + 1;\r\n          console.log(`${chalk.gray(lineNumber.toString().padStart(3))} ${cmd}`);\r\n        });\r\n      },\r\n    },\r\n    {\r\n      name: 'clear',\r\n      aliases: ['cls'],\r\n      description: 'Clear the screen',\r\n      handler: async () => {\r\n        console.clear();\r\n      },\r\n    },\r\n    {\r\n      name: 'cd',\r\n      description: 'Change working directory',\r\n      usage: 'cd <directory>',\r\n      examples: ['cd /path/to/project', 'cd ..'],\r\n      handler: async (args, ctx) => {\r\n        if (args.length === 0) {\r\n          console.log(ctx.workingDirectory);\r\n          return;\r\n        }\r\n\r\n        try {\r\n          const newDir = args[0] === '~' ? process.env.HOME || '/' : args[0];\r\n          process.chdir(newDir);\r\n          ctx.workingDirectory = process.cwd();\r\n          console.log(chalk.gray(`Changed to: ${ctx.workingDirectory}`));\r\n        } catch (error) {\r\n          console.error(\r\n            chalk.red('Error:'),\r\n            error instanceof Error ? error.message : String(error),\r\n          );\r\n        }\r\n      },\r\n    },\r\n    {\r\n      name: 'pwd',\r\n      description: 'Print working directory',\r\n      handler: async (_, ctx) => {\r\n        console.log(ctx.workingDirectory);\r\n      },\r\n    },\r\n    {\r\n      name: 'echo',\r\n      description: 'Echo arguments',\r\n      usage: 'echo <text>',\r\n      examples: ['echo \"Hello, world!\"'],\r\n      handler: async (args) => {\r\n        console.log(args.join(' '));\r\n      },\r\n    },\r\n    {\r\n      name: 'exit',\r\n      aliases: ['quit', 'q'],\r\n      description: 'Exit the REPL',\r\n      handler: async (_, ctx) => {\r\n        console.log(chalk.gray('Goodbye!'));\r\n        ctx.rl.close();\r\n        process.exit(0);\r\n      },\r\n    },\r\n  ];\r\n\r\n  // Show initial status\r\n  if (options.banner !== false) {\r\n    displayBanner();\r\n  }\r\n\r\n  await showSystemStatus(context);\r\n  console.log(chalk.gray('Type \"help\" for available commands or \"exit\" to quit.\\n'));\r\n\r\n  // Main REPL loop\r\n  const processCommand = async (input: string) => {\r\n    if (!input.trim()) {\r\n      return;\r\n    }\r\n\r\n    // Add to history\r\n    history.add(input);\r\n    context.history.push(input);\r\n    context.lastActivity = new Date();\r\n\r\n    // Parse command\r\n    const args = parseCommand(input);\r\n    const [commandName, ...commandArgs] = args;\r\n\r\n    // Find and execute command\r\n    const command = commands.find(\r\n      (c) => c.name === commandName || (c.aliases && c.aliases.includes(commandName)),\r\n    );\r\n\r\n    if (command) {\r\n      try {\r\n        await command.handler(commandArgs, context);\r\n      } catch (error) {\r\n        console.error(\r\n          chalk.red('Command failed:'),\r\n          error instanceof Error ? error.message : String(error),\r\n        );\r\n      }\r\n    } else {\r\n      console.log(chalk.red(`Unknown command: ${commandName}`));\r\n      console.log(chalk.gray('Type \"help\" for available commands'));\r\n\r\n      // Suggest similar commands\r\n      const suggestions = findSimilarCommands(commandName, commands);\r\n      if (suggestions.length > 0) {\r\n        console.log(chalk.gray('Did you mean:'), suggestions.map((s) => chalk.cyan(s)).join(', '));\r\n      }\r\n    }\r\n  };\r\n\r\n  // Set up readline prompt\r\n  const showPrompt = () => {\r\n    const prompt = createPrompt(context);\r\n    rl.setPrompt(prompt);\r\n    rl.prompt();\r\n  };\r\n\r\n  rl.on('line', async (input) => {\r\n    try {\r\n      await processCommand(input);\r\n    } catch (error) {\r\n      console.error(\r\n        chalk.red('REPL Error:'),\r\n        error instanceof Error ? error.message : String(error),\r\n      );\r\n    }\r\n    showPrompt();\r\n  });\r\n\r\n  rl.on('close', () => {\r\n    console.log('\\n' + chalk.gray('Goodbye!'));\r\n    process.exit(0);\r\n  });\r\n\r\n  rl.on('SIGINT', () => {\r\n    console.log('\\n' + chalk.gray('Use \"exit\" to quit or Ctrl+D'));\r\n    showPrompt();\r\n  });\r\n\r\n  // Start the REPL\r\n  showPrompt();\r\n}\r\n\r\nfunction displayBanner(): void {\r\n  const banner = `\r\n${chalk.cyan.bold('‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó')}\r\n${chalk.cyan.bold('‚ïë')}             ${chalk.white.bold('üß† Claude-Flow REPL')}                        ${chalk.cyan.bold('‚ïë')}\r\n${chalk.cyan.bold('‚ïë')}          ${chalk.gray('Interactive AI Agent Orchestration')}             ${chalk.cyan.bold('‚ïë')}\r\n${chalk.cyan.bold('‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù')}\r\n`;\r\n  console.log(banner);\r\n}\r\n\r\nfunction createPrompt(context: REPLContext): string {\r\n  const statusIcon = getConnectionStatusIcon(context.connectionStatus);\r\n  const dir = path.basename(context.workingDirectory) || '/';\r\n\r\n  return `${statusIcon} ${chalk.cyan('claude-flow')}:${chalk.yellow(dir)}${chalk.white('> ')}`;\r\n}\r\n\r\nfunction getConnectionStatusIcon(status: string): string {\r\n  switch (status) {\r\n    case 'connected':\r\n      return chalk.green('‚óè');\r\n    case 'connecting':\r\n      return chalk.yellow('‚óê');\r\n    case 'disconnected':\r\n      return chalk.red('‚óã');\r\n    default:\r\n      return chalk.gray('?');\r\n  }\r\n}\r\n\r\nfunction parseCommand(input: string): string[] {\r\n  // Simple command parsing - handle quoted strings\r\n  const args: string[] = [];\r\n  let current = '';\r\n  let inQuotes = false;\r\n  let quoteChar = '';\r\n\r\n  for (let i = 0; i < input.length; i++) {\r\n    const char = input[i];\r\n\r\n    if (inQuotes) {\r\n      if (char === quoteChar) {\r\n        inQuotes = false;\r\n        quoteChar = '';\r\n      } else {\r\n        current += char;\r\n      }\r\n    } else {\r\n      if (char === '\"' || char === \"'\") {\r\n        inQuotes = true;\r\n        quoteChar = char;\r\n      } else if (char === ' ' || char === '\\t') {\r\n        if (current.trim()) {\r\n          args.push(current.trim());\r\n          current = '';\r\n        }\r\n      } else {\r\n        current += char;\r\n      }\r\n    }\r\n  }\r\n\r\n  if (current.trim()) {\r\n    args.push(current.trim());\r\n  }\r\n\r\n  return args;\r\n}\r\n\r\nfunction showHelp(commands: REPLCommand[]): void {\r\n  console.log(chalk.cyan.bold('Claude-Flow Interactive REPL'));\r\n  console.log('‚îÄ'.repeat(50));\r\n  console.log();\r\n\r\n  console.log(chalk.white.bold('Available Commands:'));\r\n  console.log();\r\n\r\n  const table = new Table({\r\n    head: ['Command', 'Aliases', 'Description'],\r\n    style: { head: ['cyan'] },\r\n  });\r\n\r\n  for (const cmd of commands) {\r\n    table.push([\r\n      chalk.cyan(cmd.name),\r\n      cmd.aliases ? chalk.gray(cmd.aliases.join(', ')) : '',\r\n      cmd.description,\r\n    ]);\r\n  }\r\n\r\n  console.log(table.toString());\r\n  console.log();\r\n\r\n  console.log(chalk.gray('Tips:'));\r\n  console.log(chalk.gray('‚Ä¢ Use TAB for command completion'));\r\n  console.log(chalk.gray('‚Ä¢ Use \"help <command>\" for detailed help'));\r\n  console.log(chalk.gray('‚Ä¢ Use UP/DOWN arrows for command history'));\r\n  console.log(chalk.gray('‚Ä¢ Use Ctrl+C or \"exit\" to quit'));\r\n}\r\n\r\nfunction showCommandHelp(commands: REPLCommand[], commandName: string): void {\r\n  const command = commands.find(\r\n    (c) => c.name === commandName || (c.aliases && c.aliases.includes(commandName)),\r\n  );\r\n\r\n  if (!command) {\r\n    console.log(chalk.red(`Unknown command: ${commandName}`));\r\n    return;\r\n  }\r\n\r\n  console.log(chalk.cyan.bold(`Command: ${command.name}`));\r\n  console.log('‚îÄ'.repeat(30));\r\n  console.log(`${chalk.white('Description:')} ${command.description}`);\r\n\r\n  if (command.aliases) {\r\n    console.log(`${chalk.white('Aliases:')} ${command.aliases.join(', ')}`);\r\n  }\r\n\r\n  if (command.usage) {\r\n    console.log(`${chalk.white('Usage:')} ${command.usage}`);\r\n  }\r\n\r\n  if (command.examples) {\r\n    console.log();\r\n    console.log(chalk.white.bold('Examples:'));\r\n    for (const example of command.examples) {\r\n      console.log(`  ${chalk.gray('$')} ${chalk.cyan(example)}`);\r\n    }\r\n  }\r\n}\r\n\r\nasync function showSystemStatus(context: REPLContext, component?: string): Promise<void> {\r\n  console.log(chalk.cyan.bold('System Status'));\r\n  console.log('‚îÄ'.repeat(30));\r\n\r\n  const statusIcon = context.connectionStatus === 'connected' ? chalk.green('‚úì') : chalk.red('‚úó');\r\n  console.log(`${statusIcon} Connection: ${context.connectionStatus}`);\r\n  console.log(`${chalk.white('Working Directory:')} ${context.workingDirectory}`);\r\n  console.log(`${chalk.white('Last Activity:')} ${context.lastActivity.toLocaleTimeString()}`);\r\n\r\n  if (context.currentSession) {\r\n    console.log(`${chalk.white('Current Session:')} ${context.currentSession}`);\r\n  }\r\n\r\n  console.log(`${chalk.white('Commands in History:')} ${context.history.length}`);\r\n\r\n  if (context.connectionStatus === 'disconnected') {\r\n    console.log();\r\n    console.log(chalk.yellow('‚ö† Not connected to orchestrator'));\r\n    console.log(chalk.gray('Use \"connect\" command to establish connection'));\r\n  }\r\n}\r\n\r\nasync function connectToOrchestrator(context: REPLContext, target?: string): Promise<void> {\r\n  const host = target || 'localhost:3000';\r\n\r\n  console.log(chalk.yellow(`Connecting to ${host}...`));\r\n  context.connectionStatus = 'connecting';\r\n\r\n  // Mock connection attempt\r\n  await new Promise((resolve) => setTimeout(resolve, 1000));\r\n\r\n  // Check if orchestrator is actually running by trying to execute status command\r\n  try {\r\n    const result = await executeCliCommand(['status']);\r\n    if (result.success) {\r\n      context.connectionStatus = 'connected';\r\n      console.log(chalk.green('‚úì Connected successfully'));\r\n    } else {\r\n      context.connectionStatus = 'disconnected';\r\n      console.log(chalk.red('‚úó Connection failed'));\r\n      console.log(chalk.gray('Make sure Claude-Flow is running with: npx claude-flow start'));\r\n    }\r\n  } catch (error) {\r\n    context.connectionStatus = 'disconnected';\r\n    console.log(chalk.red('‚úó Connection failed'));\r\n    console.log(chalk.gray('Make sure Claude-Flow is running with: npx claude-flow start'));\r\n  }\r\n}\r\n\r\nasync function executeCliCommand(args: string[]): Promise<{ success: boolean; output: string }> {\r\n  return new Promise((resolve) => {\r\n    const child = spawn('npx', ['tsx', 'src/cli/simple-cli.ts', ...args], {\r\n      stdio: 'pipe',\r\n      cwd: process.cwd(),\r\n    });\r\n\r\n    let output = '';\r\n    let error = '';\r\n\r\n    child.stdout?.on('data', (data) => {\r\n      output += data.toString();\r\n    });\r\n\r\n    child.stderr?.on('data', (data) => {\r\n      error += data.toString();\r\n    });\r\n\r\n    child.on('close', (code) => {\r\n      resolve({\r\n        success: code === 0,\r\n        output: output || error,\r\n      });\r\n    });\r\n\r\n    child.on('error', (err) => {\r\n      resolve({\r\n        success: false,\r\n        output: err.message,\r\n      });\r\n    });\r\n  });\r\n}\r\n\r\nasync function handleAgentCommand(args: string[], context: REPLContext): Promise<void> {\r\n  if (context.connectionStatus !== 'connected') {\r\n    console.log(chalk.yellow('‚ö† Not connected to orchestrator'));\r\n    console.log(chalk.gray('Use \"connect\" to establish connection first'));\r\n    return;\r\n  }\r\n\r\n  if (args.length === 0) {\r\n    console.log(chalk.gray('Usage: agent <spawn|list|terminate|info> [options]'));\r\n    return;\r\n  }\r\n\r\n  const subcommand = args[0];\r\n  const cliArgs = ['agent', ...args];\r\n\r\n  try {\r\n    const result = await executeCliCommand(cliArgs);\r\n    console.log(result.output);\r\n  } catch (error) {\r\n    console.error(\r\n      chalk.red('Error executing agent command:'),\r\n      error instanceof Error ? error.message : String(error),\r\n    );\r\n  }\r\n}\r\n\r\nasync function handleTaskCommand(args: string[], context: REPLContext): Promise<void> {\r\n  if (context.connectionStatus !== 'connected') {\r\n    console.log(chalk.yellow('‚ö† Not connected to orchestrator'));\r\n    return;\r\n  }\r\n\r\n  if (args.length === 0) {\r\n    console.log(chalk.gray('Usage: task <create|list|status|cancel> [options]'));\r\n    return;\r\n  }\r\n\r\n  const cliArgs = ['task', ...args];\r\n\r\n  try {\r\n    const result = await executeCliCommand(cliArgs);\r\n    console.log(result.output);\r\n  } catch (error) {\r\n    console.error(\r\n      chalk.red('Error executing task command:'),\r\n      error instanceof Error ? error.message : String(error),\r\n    );\r\n  }\r\n}\r\n\r\nasync function handleMemoryCommand(args: string[], context: REPLContext): Promise<void> {\r\n  if (args.length === 0) {\r\n    console.log(chalk.gray('Usage: memory <query|stats|export> [options]'));\r\n    return;\r\n  }\r\n\r\n  const cliArgs = ['memory', ...args];\r\n\r\n  try {\r\n    const result = await executeCliCommand(cliArgs);\r\n    console.log(result.output);\r\n  } catch (error) {\r\n    console.error(\r\n      chalk.red('Error executing memory command:'),\r\n      error instanceof Error ? error.message : String(error),\r\n    );\r\n  }\r\n}\r\n\r\nasync function handleSessionCommand(args: string[], context: REPLContext): Promise<void> {\r\n  if (args.length === 0) {\r\n    console.log(chalk.gray('Usage: session <list|save|restore> [options]'));\r\n    return;\r\n  }\r\n\r\n  const cliArgs = ['session', ...args];\r\n\r\n  try {\r\n    const result = await executeCliCommand(cliArgs);\r\n    console.log(result.output);\r\n  } catch (error) {\r\n    console.error(\r\n      chalk.red('Error executing session command:'),\r\n      error instanceof Error ? error.message : String(error),\r\n    );\r\n  }\r\n}\r\n\r\nasync function handleWorkflowCommand(args: string[], context: REPLContext): Promise<void> {\r\n  if (context.connectionStatus !== 'connected') {\r\n    console.log(chalk.yellow('‚ö† Not connected to orchestrator'));\r\n    return;\r\n  }\r\n\r\n  if (args.length === 0) {\r\n    console.log(chalk.gray('Usage: workflow <list|run|status> [options]'));\r\n    return;\r\n  }\r\n\r\n  const cliArgs = ['workflow', ...args];\r\n\r\n  try {\r\n    const result = await executeCliCommand(cliArgs);\r\n    console.log(result.output);\r\n  } catch (error) {\r\n    console.error(\r\n      chalk.red('Error executing workflow command:'),\r\n      error instanceof Error ? error.message : String(error),\r\n    );\r\n  }\r\n}\r\n\r\nfunction findSimilarCommands(input: string, commands: REPLCommand[]): string[] {\r\n  const allNames = commands.flatMap((c) => [c.name, ...(c.aliases || [])]);\r\n\r\n  return allNames\r\n    .filter((name) => {\r\n      // Simple similarity check - could use Levenshtein distance\r\n      const commonChars = input.split('').filter((char) => name.includes(char)).length;\r\n      return commonChars >= Math.min(2, input.length / 2);\r\n    })\r\n    .slice(0, 3); // Top 3 suggestions\r\n}\r\n"],"names":["readline","fs","path","spawn","chalk","Table","CommandHistory","history","maxSize","historyFile","join","process","cwd","loadHistory","add","command","trim","length","push","slice","saveHistory","get","search","query","filter","cmd","includes","content","readFile","split","line","writeFile","startNodeREPL","options","rl","createInterface","input","stdin","output","stdout","prompt","context","workingDirectory","connectionStatus","lastActivity","Date","commands","name","aliases","description","usage","examples","handler","args","showHelp","showCommandHelp","ctx","showSystemStatus","connectToOrchestrator","handleAgentCommand","handleTaskCommand","handleMemoryCommand","handleSessionCommand","handleWorkflowCommand","console","log","cyan","gray","searchQuery","indexOf","historyItems","bold","repeat","recent","forEach","i","lineNumber","toString","padStart","clear","newDir","env","HOME","chdir","error","red","Error","message","String","_","close","exit","banner","displayBanner","processCommand","parseCommand","commandName","commandArgs","find","c","suggestions","findSimilarCommands","map","s","showPrompt","createPrompt","setPrompt","on","white","statusIcon","getConnectionStatusIcon","dir","basename","yellow","status","green","current","inQuotes","quoteChar","char","table","head","style","example","component","toLocaleTimeString","currentSession","target","host","Promise","resolve","setTimeout","result","executeCliCommand","success","child","stdio","data","stderr","code","err","subcommand","cliArgs","allNames","flatMap","commonChars","Math","min"],"mappings":"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"}