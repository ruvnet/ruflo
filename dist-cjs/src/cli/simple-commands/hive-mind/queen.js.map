{"version":3,"sources":["../../../../../src/cli/simple-commands/hive-mind/queen.js"],"sourcesContent":["/**\r\n * Queen Coordinator for Hive Mind System\r\n * Strategic decision-making and swarm coordination\r\n */\r\n\r\nimport EventEmitter from 'events';\r\n\r\n/**\r\n * Queen types and their characteristics\r\n */\r\nconst QUEEN_TYPES = {\r\n  strategic: {\r\n    name: 'Strategic Queen',\r\n    traits: ['long-term planning', 'resource optimization', 'goal alignment'],\r\n    decisionWeight: 3,\r\n    consensusThreshold: 0.6,\r\n  },\r\n  tactical: {\r\n    name: 'Tactical Queen',\r\n    traits: ['task prioritization', 'workflow optimization', 'rapid response'],\r\n    decisionWeight: 2,\r\n    consensusThreshold: 0.5,\r\n  },\r\n  adaptive: {\r\n    name: 'Adaptive Queen',\r\n    traits: ['learning', 'pattern recognition', 'strategy evolution'],\r\n    decisionWeight: 2.5,\r\n    consensusThreshold: 0.55,\r\n  },\r\n};\r\n\r\n/**\r\n * QueenCoordinator class\r\n */\r\nexport class QueenCoordinator extends EventEmitter {\r\n  constructor(config = {}) {\r\n    super();\r\n\r\n    this.config = {\r\n      swarmId: config.swarmId,\r\n      type: config.type || 'strategic',\r\n      objective: config.objective || '',\r\n      ...QUEEN_TYPES[config.type || 'strategic'],\r\n    };\r\n\r\n    this.state = {\r\n      status: 'initializing',\r\n      decisionsCount: 0,\r\n      strategiesExecuted: 0,\r\n      learningData: new Map(),\r\n      currentStrategy: null,\r\n      taskQueue: [],\r\n      workerAssignments: new Map(),\r\n    };\r\n\r\n    this.strategies = {\r\n      divide_and_conquer: this._divideAndConquerStrategy.bind(this),\r\n      parallel_execution: this._parallelExecutionStrategy.bind(this),\r\n      sequential_refinement: this._sequentialRefinementStrategy.bind(this),\r\n      consensus_driven: this._consensusDrivenStrategy.bind(this),\r\n      adaptive_learning: this._adaptiveLearningStrategy.bind(this),\r\n    };\r\n\r\n    this._initialize();\r\n  }\r\n\r\n  /**\r\n   * Initialize queen coordinator\r\n   */\r\n  _initialize() {\r\n    this.state.status = 'active';\r\n    this.emit('queen:initialized', {\r\n      type: this.config.type,\r\n      traits: this.config.traits,\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Analyze objective and create strategic plan\r\n   */\r\n  async analyzeObjective(objective) {\r\n    const analysis = {\r\n      objective,\r\n      complexity: this._assessComplexity(objective),\r\n      requiredCapabilities: this._identifyRequiredCapabilities(objective),\r\n      estimatedTasks: this._estimateTaskCount(objective),\r\n      recommendedStrategy: this._selectStrategy(objective),\r\n      resourceRequirements: this._estimateResources(objective),\r\n    };\r\n\r\n    // Store analysis for learning\r\n    this.state.learningData.set('objective_analysis', analysis);\r\n\r\n    this.emit('objective:analyzed', analysis);\r\n    return analysis;\r\n  }\r\n\r\n  /**\r\n   * Assess complexity of objective\r\n   */\r\n  _assessComplexity(objective) {\r\n    const complexityFactors = {\r\n      length: objective.length > 100 ? 2 : 1,\r\n      keywords: this._countComplexityKeywords(objective),\r\n      components: this._identifyComponents(objective).length,\r\n    };\r\n\r\n    const score = Object.values(complexityFactors).reduce((a, b) => a + b, 0);\r\n\r\n    if (score <= 3) return 'low';\r\n    if (score <= 6) return 'medium';\r\n    if (score <= 9) return 'high';\r\n    return 'very_high';\r\n  }\r\n\r\n  /**\r\n   * Count complexity keywords\r\n   */\r\n  _countComplexityKeywords(text) {\r\n    const complexKeywords = [\r\n      'complex',\r\n      'advanced',\r\n      'enterprise',\r\n      'distributed',\r\n      'scalable',\r\n      'microservices',\r\n      'architecture',\r\n      'integration',\r\n      'optimization',\r\n      'security',\r\n      'performance',\r\n      'concurrent',\r\n      'real-time',\r\n    ];\r\n\r\n    const lowerText = text.toLowerCase();\r\n    return complexKeywords.filter((keyword) => lowerText.includes(keyword)).length;\r\n  }\r\n\r\n  /**\r\n   * Identify components in objective\r\n   */\r\n  _identifyComponents(objective) {\r\n    const components = [];\r\n    const componentKeywords = {\r\n      backend: ['api', 'server', 'backend', 'database', 'service'],\r\n      frontend: ['ui', 'frontend', 'interface', 'client', 'web'],\r\n      data: ['database', 'data', 'storage', 'cache', 'persistence'],\r\n      auth: ['auth', 'security', 'login', 'permission', 'access'],\r\n      testing: ['test', 'quality', 'validation', 'verify'],\r\n      deployment: ['deploy', 'ci/cd', 'docker', 'kubernetes'],\r\n      monitoring: ['monitor', 'logging', 'metrics', 'observability'],\r\n    };\r\n\r\n    const lowerObjective = objective.toLowerCase();\r\n\r\n    Object.entries(componentKeywords).forEach(([component, keywords]) => {\r\n      if (keywords.some((keyword) => lowerObjective.includes(keyword))) {\r\n        components.push(component);\r\n      }\r\n    });\r\n\r\n    return components;\r\n  }\r\n\r\n  /**\r\n   * Identify required capabilities\r\n   */\r\n  _identifyRequiredCapabilities(objective) {\r\n    const capabilities = new Set();\r\n    const components = this._identifyComponents(objective);\r\n\r\n    // Map components to capabilities\r\n    const capabilityMap = {\r\n      backend: ['coder', 'architect', 'tester'],\r\n      frontend: ['coder', 'tester', 'reviewer'],\r\n      data: ['architect', 'analyst', 'optimizer'],\r\n      auth: ['architect', 'coder', 'tester'],\r\n      testing: ['tester', 'reviewer'],\r\n      deployment: ['architect', 'optimizer'],\r\n      monitoring: ['analyst', 'optimizer'],\r\n    };\r\n\r\n    components.forEach((component) => {\r\n      const caps = capabilityMap[component] || [];\r\n      caps.forEach((cap) => capabilities.add(cap));\r\n    });\r\n\r\n    // Always include researcher for initial analysis\r\n    capabilities.add('researcher');\r\n\r\n    return Array.from(capabilities);\r\n  }\r\n\r\n  /**\r\n   * Estimate number of tasks\r\n   */\r\n  _estimateTaskCount(objective) {\r\n    const complexity = this._assessComplexity(objective);\r\n    const components = this._identifyComponents(objective).length;\r\n\r\n    const baseTaskCount = {\r\n      low: 5,\r\n      medium: 10,\r\n      high: 20,\r\n      very_high: 30,\r\n    };\r\n\r\n    return baseTaskCount[complexity] + components * 3;\r\n  }\r\n\r\n  /**\r\n   * Select optimal strategy\r\n   */\r\n  _selectStrategy(objective) {\r\n    const complexity = this._assessComplexity(objective);\r\n    const components = this._identifyComponents(objective);\r\n\r\n    // Strategy selection heuristics\r\n    if (components.length > 3 && complexity !== 'low') {\r\n      return 'divide_and_conquer';\r\n    }\r\n\r\n    if (objective.toLowerCase().includes('parallel') || components.length > 5) {\r\n      return 'parallel_execution';\r\n    }\r\n\r\n    if (\r\n      objective.toLowerCase().includes('iterative') ||\r\n      objective.toLowerCase().includes('refine')\r\n    ) {\r\n      return 'sequential_refinement';\r\n    }\r\n\r\n    if (this.config.type === 'adaptive') {\r\n      return 'adaptive_learning';\r\n    }\r\n\r\n    return 'consensus_driven'; // Default\r\n  }\r\n\r\n  /**\r\n   * Estimate resource requirements\r\n   */\r\n  _estimateResources(objective) {\r\n    const complexity = this._assessComplexity(objective);\r\n    const taskCount = this._estimateTaskCount(objective);\r\n\r\n    return {\r\n      minWorkers: Math.min(3, Math.ceil(taskCount / 10)),\r\n      optimalWorkers: Math.min(8, Math.ceil(taskCount / 5)),\r\n      estimatedTime: taskCount * 5, // minutes\r\n      memoryRequirement: complexity === 'very_high' ? 'high' : 'medium',\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Create execution plan\r\n   */\r\n  async createExecutionPlan(analysis, workers) {\r\n    const strategy = this.strategies[analysis.recommendedStrategy];\r\n    if (!strategy) {\r\n      throw new Error(`Unknown strategy: ${analysis.recommendedStrategy}`);\r\n    }\r\n\r\n    const plan = await strategy(analysis, workers);\r\n\r\n    this.state.currentStrategy = analysis.recommendedStrategy;\r\n    this.state.strategiesExecuted++;\r\n\r\n    this.emit('plan:created', plan);\r\n    return plan;\r\n  }\r\n\r\n  /**\r\n   * Divide and conquer strategy\r\n   */\r\n  async _divideAndConquerStrategy(analysis, workers) {\r\n    const components = this._identifyComponents(analysis.objective);\r\n    const phases = [];\r\n\r\n    // Phase 1: Research and planning\r\n    phases.push({\r\n      name: 'Research and Planning',\r\n      tasks: [\r\n        'Research best practices and patterns',\r\n        'Analyze requirements and constraints',\r\n        'Create high-level architecture design',\r\n      ],\r\n      workers: workers.filter((w) => ['researcher', 'architect'].includes(w.type)),\r\n      parallel: true,\r\n    });\r\n\r\n    // Phase 2: Component development\r\n    components.forEach((component) => {\r\n      phases.push({\r\n        name: `Develop ${component}`,\r\n        tasks: this._generateComponentTasks(component),\r\n        workers: workers.filter((w) => ['coder', 'architect'].includes(w.type)),\r\n        parallel: true,\r\n      });\r\n    });\r\n\r\n    // Phase 3: Integration and testing\r\n    phases.push({\r\n      name: 'Integration and Testing',\r\n      tasks: [\r\n        'Integrate components',\r\n        'Write integration tests',\r\n        'Perform end-to-end testing',\r\n        'Fix integration issues',\r\n      ],\r\n      workers: workers.filter((w) => ['coder', 'tester'].includes(w.type)),\r\n      parallel: false,\r\n    });\r\n\r\n    // Phase 4: Optimization and documentation\r\n    phases.push({\r\n      name: 'Optimization and Documentation',\r\n      tasks: [\r\n        'Optimize performance',\r\n        'Document architecture',\r\n        'Create user documentation',\r\n        'Prepare deployment guide',\r\n      ],\r\n      workers: workers.filter((w) => ['optimizer', 'documenter'].includes(w.type)),\r\n      parallel: true,\r\n    });\r\n\r\n    return {\r\n      strategy: 'divide_and_conquer',\r\n      phases,\r\n      estimatedDuration: phases.length * 15, // minutes\r\n      parallelism: 'high',\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Parallel execution strategy\r\n   */\r\n  async _parallelExecutionStrategy(analysis, workers) {\r\n    const tasks = this._generateAllTasks(analysis);\r\n    const workerGroups = this._groupWorkersByType(workers);\r\n\r\n    return {\r\n      strategy: 'parallel_execution',\r\n      phases: [\r\n        {\r\n          name: 'Parallel Execution',\r\n          tasks: tasks,\r\n          workers: workers,\r\n          parallel: true,\r\n          workerAssignment: this._optimizeWorkerAssignment(tasks, workerGroups),\r\n        },\r\n      ],\r\n      estimatedDuration: Math.ceil(tasks.length / workers.length) * 10,\r\n      parallelism: 'maximum',\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Sequential refinement strategy\r\n   */\r\n  async _sequentialRefinementStrategy(analysis, workers) {\r\n    const iterations = 3;\r\n    const phases = [];\r\n\r\n    for (let i = 0; i < iterations; i++) {\r\n      phases.push({\r\n        name: `Iteration ${i + 1}`,\r\n        tasks: [\r\n          `Design iteration ${i + 1}`,\r\n          `Implement features for iteration ${i + 1}`,\r\n          `Test iteration ${i + 1}`,\r\n          `Review and refine iteration ${i + 1}`,\r\n        ],\r\n        workers: workers,\r\n        parallel: false,\r\n        requiresConsensus: true,\r\n      });\r\n    }\r\n\r\n    return {\r\n      strategy: 'sequential_refinement',\r\n      phases,\r\n      estimatedDuration: phases.length * 20,\r\n      parallelism: 'low',\r\n      iterative: true,\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Consensus-driven strategy\r\n   */\r\n  async _consensusDrivenStrategy(analysis, workers) {\r\n    const decisionPoints = this._identifyDecisionPoints(analysis);\r\n    const phases = [];\r\n\r\n    decisionPoints.forEach((decision, index) => {\r\n      phases.push({\r\n        name: `Decision Phase ${index + 1}: ${decision}`,\r\n        tasks: [\r\n          `Research options for ${decision}`,\r\n          `Analyze trade-offs`,\r\n          `Build consensus on approach`,\r\n          `Implement chosen solution`,\r\n        ],\r\n        workers: workers,\r\n        parallel: index === 0, // Only first phase in parallel\r\n        requiresConsensus: true,\r\n        consensusThreshold: this.config.consensusThreshold,\r\n      });\r\n    });\r\n\r\n    return {\r\n      strategy: 'consensus_driven',\r\n      phases,\r\n      estimatedDuration: phases.length * 25,\r\n      parallelism: 'medium',\r\n      consensusRequired: true,\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Adaptive learning strategy\r\n   */\r\n  async _adaptiveLearningStrategy(analysis, workers) {\r\n    const learningPhases = [\r\n      {\r\n        name: 'Exploration Phase',\r\n        tasks: [\r\n          'Explore multiple approaches',\r\n          'Experiment with different solutions',\r\n          'Collect performance metrics',\r\n        ],\r\n        workers: workers,\r\n        parallel: true,\r\n        learning: true,\r\n      },\r\n      {\r\n        name: 'Analysis Phase',\r\n        tasks: ['Analyze results', 'Identify patterns', 'Select best approaches'],\r\n        workers: workers.filter((w) => ['analyst', 'researcher'].includes(w.type)),\r\n        parallel: false,\r\n        learning: true,\r\n      },\r\n      {\r\n        name: 'Implementation Phase',\r\n        tasks: ['Implement optimized solution', 'Apply learned patterns', 'Validate improvements'],\r\n        workers: workers,\r\n        parallel: true,\r\n        applyLearning: true,\r\n      },\r\n    ];\r\n\r\n    return {\r\n      strategy: 'adaptive_learning',\r\n      phases: learningPhases,\r\n      estimatedDuration: 45,\r\n      parallelism: 'adaptive',\r\n      learningEnabled: true,\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Generate component-specific tasks\r\n   */\r\n  _generateComponentTasks(component) {\r\n    const taskTemplates = {\r\n      backend: [\r\n        'Design API endpoints',\r\n        'Implement business logic',\r\n        'Set up database models',\r\n        'Create API tests',\r\n      ],\r\n      frontend: [\r\n        'Design UI components',\r\n        'Implement user interface',\r\n        'Add interactivity',\r\n        'Create UI tests',\r\n      ],\r\n      data: [\r\n        'Design data schema',\r\n        'Implement data access layer',\r\n        'Set up caching',\r\n        'Optimize queries',\r\n      ],\r\n      auth: [\r\n        'Design authentication flow',\r\n        'Implement auth middleware',\r\n        'Add authorization checks',\r\n        'Test security',\r\n      ],\r\n    };\r\n\r\n    return (\r\n      taskTemplates[component] || [\r\n        `Design ${component}`,\r\n        `Implement ${component}`,\r\n        `Test ${component}`,\r\n      ]\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Generate all tasks based on analysis\r\n   */\r\n  _generateAllTasks(analysis) {\r\n    const tasks = [];\r\n    const components = this._identifyComponents(analysis.objective);\r\n\r\n    // Add general tasks\r\n    tasks.push('Analyze requirements', 'Design architecture', 'Set up project structure');\r\n\r\n    // Add component tasks\r\n    components.forEach((component) => {\r\n      tasks.push(...this._generateComponentTasks(component));\r\n    });\r\n\r\n    // Add integration tasks\r\n    tasks.push('Integrate components', 'Write tests', 'Document solution');\r\n\r\n    return tasks;\r\n  }\r\n\r\n  /**\r\n   * Group workers by type\r\n   */\r\n  _groupWorkersByType(workers) {\r\n    const groups = {};\r\n\r\n    workers.forEach((worker) => {\r\n      if (!groups[worker.type]) {\r\n        groups[worker.type] = [];\r\n      }\r\n      groups[worker.type].push(worker);\r\n    });\r\n\r\n    return groups;\r\n  }\r\n\r\n  /**\r\n   * Optimize worker assignment for tasks\r\n   */\r\n  _optimizeWorkerAssignment(tasks, workerGroups) {\r\n    const assignments = {};\r\n\r\n    tasks.forEach((task) => {\r\n      const bestWorkerType = this._findBestWorkerType(task);\r\n      const availableWorkers = workerGroups[bestWorkerType] || [];\r\n\r\n      if (availableWorkers.length > 0) {\r\n        // Round-robin assignment within type\r\n        const workerIndex =\r\n          Object.keys(assignments).filter((t) => assignments[t].type === bestWorkerType).length %\r\n          availableWorkers.length;\r\n\r\n        assignments[task] = availableWorkers[workerIndex];\r\n      }\r\n    });\r\n\r\n    return assignments;\r\n  }\r\n\r\n  /**\r\n   * Find best worker type for task\r\n   */\r\n  _findBestWorkerType(task) {\r\n    const taskLower = task.toLowerCase();\r\n\r\n    if (taskLower.includes('research') || taskLower.includes('analyze')) {\r\n      return 'researcher';\r\n    }\r\n    if (taskLower.includes('design') || taskLower.includes('architect')) {\r\n      return 'architect';\r\n    }\r\n    if (taskLower.includes('implement') || taskLower.includes('code')) {\r\n      return 'coder';\r\n    }\r\n    if (taskLower.includes('test') || taskLower.includes('validate')) {\r\n      return 'tester';\r\n    }\r\n    if (taskLower.includes('optimize') || taskLower.includes('performance')) {\r\n      return 'optimizer';\r\n    }\r\n    if (taskLower.includes('document') || taskLower.includes('write')) {\r\n      return 'documenter';\r\n    }\r\n\r\n    return 'coder'; // Default\r\n  }\r\n\r\n  /**\r\n   * Identify decision points in objective\r\n   */\r\n  _identifyDecisionPoints(analysis) {\r\n    const decisionKeywords = [\r\n      'choose',\r\n      'select',\r\n      'decide',\r\n      'option',\r\n      'approach',\r\n      'strategy',\r\n      'method',\r\n      'solution',\r\n      'alternative',\r\n    ];\r\n\r\n    const decisions = [];\r\n    const components = this._identifyComponents(analysis.objective);\r\n\r\n    // Architecture decisions\r\n    if (components.length > 2) {\r\n      decisions.push('Architecture pattern selection');\r\n    }\r\n\r\n    // Technology decisions\r\n    components.forEach((component) => {\r\n      decisions.push(`Technology stack for ${component}`);\r\n    });\r\n\r\n    // Implementation decisions\r\n    if (analysis.complexity !== 'low') {\r\n      decisions.push('Implementation approach');\r\n    }\r\n\r\n    return decisions;\r\n  }\r\n\r\n  /**\r\n   * Make strategic decision\r\n   */\r\n  async makeDecision(topic, options, workerVotes = {}) {\r\n    const decision = {\r\n      topic,\r\n      options,\r\n      workerVotes,\r\n      queenVote: this._calculateQueenVote(topic, options, workerVotes),\r\n      timestamp: Date.now(),\r\n    };\r\n\r\n    // Calculate final decision with queen's weighted vote\r\n    const finalDecision = this._calculateFinalDecision(decision);\r\n\r\n    decision.result = finalDecision;\r\n    this.state.decisionsCount++;\r\n\r\n    // Learn from decision\r\n    if (this.config.type === 'adaptive') {\r\n      this._learnFromDecision(decision);\r\n    }\r\n\r\n    this.emit('decision:made', decision);\r\n    return decision;\r\n  }\r\n\r\n  /**\r\n   * Calculate queen's vote\r\n   */\r\n  _calculateQueenVote(topic, options, workerVotes) {\r\n    // Strategic queen focuses on long-term impact\r\n    if (this.config.type === 'strategic') {\r\n      return this._strategicVote(topic, options);\r\n    }\r\n\r\n    // Tactical queen focuses on immediate efficiency\r\n    if (this.config.type === 'tactical') {\r\n      return this._tacticalVote(topic, options, workerVotes);\r\n    }\r\n\r\n    // Adaptive queen learns from past decisions\r\n    if (this.config.type === 'adaptive') {\r\n      return this._adaptiveVote(topic, options, workerVotes);\r\n    }\r\n\r\n    return options[0]; // Default\r\n  }\r\n\r\n  /**\r\n   * Strategic voting logic\r\n   */\r\n  _strategicVote(topic, options) {\r\n    // Prefer options that mention long-term benefits\r\n    const strategicKeywords = ['scalable', 'maintainable', 'extensible', 'future'];\r\n\r\n    for (const option of options) {\r\n      const optionLower = option.toLowerCase();\r\n      if (strategicKeywords.some((keyword) => optionLower.includes(keyword))) {\r\n        return option;\r\n      }\r\n    }\r\n\r\n    return options[0];\r\n  }\r\n\r\n  /**\r\n   * Tactical voting logic\r\n   */\r\n  _tacticalVote(topic, options, workerVotes) {\r\n    // Follow majority if consensus is strong\r\n    const voteCounts = {};\r\n    Object.values(workerVotes).forEach((vote) => {\r\n      voteCounts[vote] = (voteCounts[vote] || 0) + 1;\r\n    });\r\n\r\n    const sorted = Object.entries(voteCounts).sort((a, b) => b[1] - a[1]);\r\n    if (sorted.length > 0 && sorted[0][1] > Object.keys(workerVotes).length * 0.6) {\r\n      return sorted[0][0];\r\n    }\r\n\r\n    // Otherwise, prefer quick implementation\r\n    const tacticalKeywords = ['simple', 'quick', 'fast', 'efficient'];\r\n\r\n    for (const option of options) {\r\n      const optionLower = option.toLowerCase();\r\n      if (tacticalKeywords.some((keyword) => optionLower.includes(keyword))) {\r\n        return option;\r\n      }\r\n    }\r\n\r\n    return options[0];\r\n  }\r\n\r\n  /**\r\n   * Adaptive voting logic\r\n   */\r\n  _adaptiveVote(topic, options, workerVotes) {\r\n    // Check if we've seen similar decisions before\r\n    const similarDecisions = Array.from(this.state.learningData.entries()).filter(\r\n      ([key, value]) => key.includes('decision') && value.topic.includes(topic),\r\n    );\r\n\r\n    if (similarDecisions.length > 0) {\r\n      // Use learned preferences\r\n      const successfulOptions = similarDecisions\r\n        .filter(([_, decision]) => decision.success)\r\n        .map(([_, decision]) => decision.result);\r\n\r\n      for (const option of options) {\r\n        if (successfulOptions.includes(option)) {\r\n          return option;\r\n        }\r\n      }\r\n    }\r\n\r\n    // Otherwise, explore new option\r\n    return options[Math.floor(Math.random() * options.length)];\r\n  }\r\n\r\n  /**\r\n   * Calculate final decision with weighted votes\r\n   */\r\n  _calculateFinalDecision(decision) {\r\n    const voteCounts = {};\r\n\r\n    // Count worker votes\r\n    Object.values(decision.workerVotes).forEach((vote) => {\r\n      voteCounts[vote] = (voteCounts[vote] || 0) + 1;\r\n    });\r\n\r\n    // Add queen's weighted vote\r\n    voteCounts[decision.queenVote] =\r\n      (voteCounts[decision.queenVote] || 0) + this.config.decisionWeight;\r\n\r\n    // Find winner\r\n    const sorted = Object.entries(voteCounts).sort((a, b) => b[1] - a[1]);\r\n    return sorted[0][0];\r\n  }\r\n\r\n  /**\r\n   * Learn from decision outcomes\r\n   */\r\n  _learnFromDecision(decision) {\r\n    const key = `decision-${this.state.decisionsCount}`;\r\n    this.state.learningData.set(key, {\r\n      ...decision,\r\n      success: true, // Will be updated based on outcome\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Update decision outcome\r\n   */\r\n  updateDecisionOutcome(decisionId, success, metrics = {}) {\r\n    const key = `decision-${decisionId}`;\r\n    const decision = this.state.learningData.get(key);\r\n\r\n    if (decision) {\r\n      decision.success = success;\r\n      decision.metrics = metrics;\r\n      this.emit('learning:updated', { decisionId, success, metrics });\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get queen status\r\n   */\r\n  getStatus() {\r\n    return {\r\n      type: this.config.type,\r\n      name: this.config.name,\r\n      status: this.state.status,\r\n      decisionsCount: this.state.decisionsCount,\r\n      strategiesExecuted: this.state.strategiesExecuted,\r\n      currentStrategy: this.state.currentStrategy,\r\n      learningDataSize: this.state.learningData.size,\r\n    };\r\n  }\r\n}\r\n"],"names":["EventEmitter","QUEEN_TYPES","strategic","name","traits","decisionWeight","consensusThreshold","tactical","adaptive","QueenCoordinator","config","swarmId","type","objective","state","status","decisionsCount","strategiesExecuted","learningData","Map","currentStrategy","taskQueue","workerAssignments","strategies","divide_and_conquer","_divideAndConquerStrategy","bind","parallel_execution","_parallelExecutionStrategy","sequential_refinement","_sequentialRefinementStrategy","consensus_driven","_consensusDrivenStrategy","adaptive_learning","_adaptiveLearningStrategy","_initialize","emit","analyzeObjective","analysis","complexity","_assessComplexity","requiredCapabilities","_identifyRequiredCapabilities","estimatedTasks","_estimateTaskCount","recommendedStrategy","_selectStrategy","resourceRequirements","_estimateResources","set","complexityFactors","length","keywords","_countComplexityKeywords","components","_identifyComponents","score","Object","values","reduce","a","b","text","complexKeywords","lowerText","toLowerCase","filter","keyword","includes","componentKeywords","backend","frontend","data","auth","testing","deployment","monitoring","lowerObjective","entries","forEach","component","some","push","capabilities","Set","capabilityMap","caps","cap","add","Array","from","baseTaskCount","low","medium","high","very_high","taskCount","minWorkers","Math","min","ceil","optimalWorkers","estimatedTime","memoryRequirement","createExecutionPlan","workers","strategy","Error","plan","phases","tasks","w","parallel","_generateComponentTasks","estimatedDuration","parallelism","_generateAllTasks","workerGroups","_groupWorkersByType","workerAssignment","_optimizeWorkerAssignment","iterations","i","requiresConsensus","iterative","decisionPoints","_identifyDecisionPoints","decision","index","consensusRequired","learningPhases","learning","applyLearning","learningEnabled","taskTemplates","groups","worker","assignments","task","bestWorkerType","_findBestWorkerType","availableWorkers","workerIndex","keys","t","taskLower","decisionKeywords","decisions","makeDecision","topic","options","workerVotes","queenVote","_calculateQueenVote","timestamp","Date","now","finalDecision","_calculateFinalDecision","result","_learnFromDecision","_strategicVote","_tacticalVote","_adaptiveVote","strategicKeywords","option","optionLower","voteCounts","vote","sorted","sort","tacticalKeywords","similarDecisions","key","value","successfulOptions","_","success","map","floor","random","updateDecisionOutcome","decisionId","metrics","get","getStatus","learningDataSize","size"],"mappings":"AAKA,OAAOA,kBAAkB,SAAS;AAKlC,MAAMC,cAAc;IAClBC,WAAW;QACTC,MAAM;QACNC,QAAQ;YAAC;YAAsB;YAAyB;SAAiB;QACzEC,gBAAgB;QAChBC,oBAAoB;IACtB;IACAC,UAAU;QACRJ,MAAM;QACNC,QAAQ;YAAC;YAAuB;YAAyB;SAAiB;QAC1EC,gBAAgB;QAChBC,oBAAoB;IACtB;IACAE,UAAU;QACRL,MAAM;QACNC,QAAQ;YAAC;YAAY;YAAuB;SAAqB;QACjEC,gBAAgB;QAChBC,oBAAoB;IACtB;AACF;AAKA,OAAO,MAAMG,yBAAyBT;IACpC,YAAYU,SAAS,CAAC,CAAC,CAAE;QACvB,KAAK;QAEL,IAAI,CAACA,MAAM,GAAG;YACZC,SAASD,OAAOC,OAAO;YACvBC,MAAMF,OAAOE,IAAI,IAAI;YACrBC,WAAWH,OAAOG,SAAS,IAAI;YAC/B,GAAGZ,WAAW,CAACS,OAAOE,IAAI,IAAI,YAAY;QAC5C;QAEA,IAAI,CAACE,KAAK,GAAG;YACXC,QAAQ;YACRC,gBAAgB;YAChBC,oBAAoB;YACpBC,cAAc,IAAIC;YAClBC,iBAAiB;YACjBC,WAAW,EAAE;YACbC,mBAAmB,IAAIH;QACzB;QAEA,IAAI,CAACI,UAAU,GAAG;YAChBC,oBAAoB,IAAI,CAACC,yBAAyB,CAACC,IAAI,CAAC,IAAI;YAC5DC,oBAAoB,IAAI,CAACC,0BAA0B,CAACF,IAAI,CAAC,IAAI;YAC7DG,uBAAuB,IAAI,CAACC,6BAA6B,CAACJ,IAAI,CAAC,IAAI;YACnEK,kBAAkB,IAAI,CAACC,wBAAwB,CAACN,IAAI,CAAC,IAAI;YACzDO,mBAAmB,IAAI,CAACC,yBAAyB,CAACR,IAAI,CAAC,IAAI;QAC7D;QAEA,IAAI,CAACS,WAAW;IAClB;IAKAA,cAAc;QACZ,IAAI,CAACrB,KAAK,CAACC,MAAM,GAAG;QACpB,IAAI,CAACqB,IAAI,CAAC,qBAAqB;YAC7BxB,MAAM,IAAI,CAACF,MAAM,CAACE,IAAI;YACtBR,QAAQ,IAAI,CAACM,MAAM,CAACN,MAAM;QAC5B;IACF;IAKA,MAAMiC,iBAAiBxB,SAAS,EAAE;QAChC,MAAMyB,WAAW;YACfzB;YACA0B,YAAY,IAAI,CAACC,iBAAiB,CAAC3B;YACnC4B,sBAAsB,IAAI,CAACC,6BAA6B,CAAC7B;YACzD8B,gBAAgB,IAAI,CAACC,kBAAkB,CAAC/B;YACxCgC,qBAAqB,IAAI,CAACC,eAAe,CAACjC;YAC1CkC,sBAAsB,IAAI,CAACC,kBAAkB,CAACnC;QAChD;QAGA,IAAI,CAACC,KAAK,CAACI,YAAY,CAAC+B,GAAG,CAAC,sBAAsBX;QAElD,IAAI,CAACF,IAAI,CAAC,sBAAsBE;QAChC,OAAOA;IACT;IAKAE,kBAAkB3B,SAAS,EAAE;QAC3B,MAAMqC,oBAAoB;YACxBC,QAAQtC,UAAUsC,MAAM,GAAG,MAAM,IAAI;YACrCC,UAAU,IAAI,CAACC,wBAAwB,CAACxC;YACxCyC,YAAY,IAAI,CAACC,mBAAmB,CAAC1C,WAAWsC,MAAM;QACxD;QAEA,MAAMK,QAAQC,OAAOC,MAAM,CAACR,mBAAmBS,MAAM,CAAC,CAACC,GAAGC,IAAMD,IAAIC,GAAG;QAEvE,IAAIL,SAAS,GAAG,OAAO;QACvB,IAAIA,SAAS,GAAG,OAAO;QACvB,IAAIA,SAAS,GAAG,OAAO;QACvB,OAAO;IACT;IAKAH,yBAAyBS,IAAI,EAAE;QAC7B,MAAMC,kBAAkB;YACtB;YACA;YACA;YACA;YACA;YACA;YACA;YACA;YACA;YACA;YACA;YACA;YACA;SACD;QAED,MAAMC,YAAYF,KAAKG,WAAW;QAClC,OAAOF,gBAAgBG,MAAM,CAAC,CAACC,UAAYH,UAAUI,QAAQ,CAACD,UAAUhB,MAAM;IAChF;IAKAI,oBAAoB1C,SAAS,EAAE;QAC7B,MAAMyC,aAAa,EAAE;QACrB,MAAMe,oBAAoB;YACxBC,SAAS;gBAAC;gBAAO;gBAAU;gBAAW;gBAAY;aAAU;YAC5DC,UAAU;gBAAC;gBAAM;gBAAY;gBAAa;gBAAU;aAAM;YAC1DC,MAAM;gBAAC;gBAAY;gBAAQ;gBAAW;gBAAS;aAAc;YAC7DC,MAAM;gBAAC;gBAAQ;gBAAY;gBAAS;gBAAc;aAAS;YAC3DC,SAAS;gBAAC;gBAAQ;gBAAW;gBAAc;aAAS;YACpDC,YAAY;gBAAC;gBAAU;gBAAS;gBAAU;aAAa;YACvDC,YAAY;gBAAC;gBAAW;gBAAW;gBAAW;aAAgB;QAChE;QAEA,MAAMC,iBAAiBhE,UAAUoD,WAAW;QAE5CR,OAAOqB,OAAO,CAACT,mBAAmBU,OAAO,CAAC,CAAC,CAACC,WAAW5B,SAAS;YAC9D,IAAIA,SAAS6B,IAAI,CAAC,CAACd,UAAYU,eAAeT,QAAQ,CAACD,WAAW;gBAChEb,WAAW4B,IAAI,CAACF;YAClB;QACF;QAEA,OAAO1B;IACT;IAKAZ,8BAA8B7B,SAAS,EAAE;QACvC,MAAMsE,eAAe,IAAIC;QACzB,MAAM9B,aAAa,IAAI,CAACC,mBAAmB,CAAC1C;QAG5C,MAAMwE,gBAAgB;YACpBf,SAAS;gBAAC;gBAAS;gBAAa;aAAS;YACzCC,UAAU;gBAAC;gBAAS;gBAAU;aAAW;YACzCC,MAAM;gBAAC;gBAAa;gBAAW;aAAY;YAC3CC,MAAM;gBAAC;gBAAa;gBAAS;aAAS;YACtCC,SAAS;gBAAC;gBAAU;aAAW;YAC/BC,YAAY;gBAAC;gBAAa;aAAY;YACtCC,YAAY;gBAAC;gBAAW;aAAY;QACtC;QAEAtB,WAAWyB,OAAO,CAAC,CAACC;YAClB,MAAMM,OAAOD,aAAa,CAACL,UAAU,IAAI,EAAE;YAC3CM,KAAKP,OAAO,CAAC,CAACQ,MAAQJ,aAAaK,GAAG,CAACD;QACzC;QAGAJ,aAAaK,GAAG,CAAC;QAEjB,OAAOC,MAAMC,IAAI,CAACP;IACpB;IAKAvC,mBAAmB/B,SAAS,EAAE;QAC5B,MAAM0B,aAAa,IAAI,CAACC,iBAAiB,CAAC3B;QAC1C,MAAMyC,aAAa,IAAI,CAACC,mBAAmB,CAAC1C,WAAWsC,MAAM;QAE7D,MAAMwC,gBAAgB;YACpBC,KAAK;YACLC,QAAQ;YACRC,MAAM;YACNC,WAAW;QACb;QAEA,OAAOJ,aAAa,CAACpD,WAAW,GAAGe,aAAa;IAClD;IAKAR,gBAAgBjC,SAAS,EAAE;QACzB,MAAM0B,aAAa,IAAI,CAACC,iBAAiB,CAAC3B;QAC1C,MAAMyC,aAAa,IAAI,CAACC,mBAAmB,CAAC1C;QAG5C,IAAIyC,WAAWH,MAAM,GAAG,KAAKZ,eAAe,OAAO;YACjD,OAAO;QACT;QAEA,IAAI1B,UAAUoD,WAAW,GAAGG,QAAQ,CAAC,eAAed,WAAWH,MAAM,GAAG,GAAG;YACzE,OAAO;QACT;QAEA,IACEtC,UAAUoD,WAAW,GAAGG,QAAQ,CAAC,gBACjCvD,UAAUoD,WAAW,GAAGG,QAAQ,CAAC,WACjC;YACA,OAAO;QACT;QAEA,IAAI,IAAI,CAAC1D,MAAM,CAACE,IAAI,KAAK,YAAY;YACnC,OAAO;QACT;QAEA,OAAO;IACT;IAKAoC,mBAAmBnC,SAAS,EAAE;QAC5B,MAAM0B,aAAa,IAAI,CAACC,iBAAiB,CAAC3B;QAC1C,MAAMmF,YAAY,IAAI,CAACpD,kBAAkB,CAAC/B;QAE1C,OAAO;YACLoF,YAAYC,KAAKC,GAAG,CAAC,GAAGD,KAAKE,IAAI,CAACJ,YAAY;YAC9CK,gBAAgBH,KAAKC,GAAG,CAAC,GAAGD,KAAKE,IAAI,CAACJ,YAAY;YAClDM,eAAeN,YAAY;YAC3BO,mBAAmBhE,eAAe,cAAc,SAAS;QAC3D;IACF;IAKA,MAAMiE,oBAAoBlE,QAAQ,EAAEmE,OAAO,EAAE;QAC3C,MAAMC,WAAW,IAAI,CAACnF,UAAU,CAACe,SAASO,mBAAmB,CAAC;QAC9D,IAAI,CAAC6D,UAAU;YACb,MAAM,IAAIC,MAAM,CAAC,kBAAkB,EAAErE,SAASO,mBAAmB,EAAE;QACrE;QAEA,MAAM+D,OAAO,MAAMF,SAASpE,UAAUmE;QAEtC,IAAI,CAAC3F,KAAK,CAACM,eAAe,GAAGkB,SAASO,mBAAmB;QACzD,IAAI,CAAC/B,KAAK,CAACG,kBAAkB;QAE7B,IAAI,CAACmB,IAAI,CAAC,gBAAgBwE;QAC1B,OAAOA;IACT;IAKA,MAAMnF,0BAA0Ba,QAAQ,EAAEmE,OAAO,EAAE;QACjD,MAAMnD,aAAa,IAAI,CAACC,mBAAmB,CAACjB,SAASzB,SAAS;QAC9D,MAAMgG,SAAS,EAAE;QAGjBA,OAAO3B,IAAI,CAAC;YACV/E,MAAM;YACN2G,OAAO;gBACL;gBACA;gBACA;aACD;YACDL,SAASA,QAAQvC,MAAM,CAAC,CAAC6C,IAAM;oBAAC;oBAAc;iBAAY,CAAC3C,QAAQ,CAAC2C,EAAEnG,IAAI;YAC1EoG,UAAU;QACZ;QAGA1D,WAAWyB,OAAO,CAAC,CAACC;YAClB6B,OAAO3B,IAAI,CAAC;gBACV/E,MAAM,CAAC,QAAQ,EAAE6E,WAAW;gBAC5B8B,OAAO,IAAI,CAACG,uBAAuB,CAACjC;gBACpCyB,SAASA,QAAQvC,MAAM,CAAC,CAAC6C,IAAM;wBAAC;wBAAS;qBAAY,CAAC3C,QAAQ,CAAC2C,EAAEnG,IAAI;gBACrEoG,UAAU;YACZ;QACF;QAGAH,OAAO3B,IAAI,CAAC;YACV/E,MAAM;YACN2G,OAAO;gBACL;gBACA;gBACA;gBACA;aACD;YACDL,SAASA,QAAQvC,MAAM,CAAC,CAAC6C,IAAM;oBAAC;oBAAS;iBAAS,CAAC3C,QAAQ,CAAC2C,EAAEnG,IAAI;YAClEoG,UAAU;QACZ;QAGAH,OAAO3B,IAAI,CAAC;YACV/E,MAAM;YACN2G,OAAO;gBACL;gBACA;gBACA;gBACA;aACD;YACDL,SAASA,QAAQvC,MAAM,CAAC,CAAC6C,IAAM;oBAAC;oBAAa;iBAAa,CAAC3C,QAAQ,CAAC2C,EAAEnG,IAAI;YAC1EoG,UAAU;QACZ;QAEA,OAAO;YACLN,UAAU;YACVG;YACAK,mBAAmBL,OAAO1D,MAAM,GAAG;YACnCgE,aAAa;QACf;IACF;IAKA,MAAMvF,2BAA2BU,QAAQ,EAAEmE,OAAO,EAAE;QAClD,MAAMK,QAAQ,IAAI,CAACM,iBAAiB,CAAC9E;QACrC,MAAM+E,eAAe,IAAI,CAACC,mBAAmB,CAACb;QAE9C,OAAO;YACLC,UAAU;YACVG,QAAQ;gBACN;oBACE1G,MAAM;oBACN2G,OAAOA;oBACPL,SAASA;oBACTO,UAAU;oBACVO,kBAAkB,IAAI,CAACC,yBAAyB,CAACV,OAAOO;gBAC1D;aACD;YACDH,mBAAmBhB,KAAKE,IAAI,CAACU,MAAM3D,MAAM,GAAGsD,QAAQtD,MAAM,IAAI;YAC9DgE,aAAa;QACf;IACF;IAKA,MAAMrF,8BAA8BQ,QAAQ,EAAEmE,OAAO,EAAE;QACrD,MAAMgB,aAAa;QACnB,MAAMZ,SAAS,EAAE;QAEjB,IAAK,IAAIa,IAAI,GAAGA,IAAID,YAAYC,IAAK;YACnCb,OAAO3B,IAAI,CAAC;gBACV/E,MAAM,CAAC,UAAU,EAAEuH,IAAI,GAAG;gBAC1BZ,OAAO;oBACL,CAAC,iBAAiB,EAAEY,IAAI,GAAG;oBAC3B,CAAC,iCAAiC,EAAEA,IAAI,GAAG;oBAC3C,CAAC,eAAe,EAAEA,IAAI,GAAG;oBACzB,CAAC,4BAA4B,EAAEA,IAAI,GAAG;iBACvC;gBACDjB,SAASA;gBACTO,UAAU;gBACVW,mBAAmB;YACrB;QACF;QAEA,OAAO;YACLjB,UAAU;YACVG;YACAK,mBAAmBL,OAAO1D,MAAM,GAAG;YACnCgE,aAAa;YACbS,WAAW;QACb;IACF;IAKA,MAAM5F,yBAAyBM,QAAQ,EAAEmE,OAAO,EAAE;QAChD,MAAMoB,iBAAiB,IAAI,CAACC,uBAAuB,CAACxF;QACpD,MAAMuE,SAAS,EAAE;QAEjBgB,eAAe9C,OAAO,CAAC,CAACgD,UAAUC;YAChCnB,OAAO3B,IAAI,CAAC;gBACV/E,MAAM,CAAC,eAAe,EAAE6H,QAAQ,EAAE,EAAE,EAAED,UAAU;gBAChDjB,OAAO;oBACL,CAAC,qBAAqB,EAAEiB,UAAU;oBAClC,CAAC,kBAAkB,CAAC;oBACpB,CAAC,2BAA2B,CAAC;oBAC7B,CAAC,yBAAyB,CAAC;iBAC5B;gBACDtB,SAASA;gBACTO,UAAUgB,UAAU;gBACpBL,mBAAmB;gBACnBrH,oBAAoB,IAAI,CAACI,MAAM,CAACJ,kBAAkB;YACpD;QACF;QAEA,OAAO;YACLoG,UAAU;YACVG;YACAK,mBAAmBL,OAAO1D,MAAM,GAAG;YACnCgE,aAAa;YACbc,mBAAmB;QACrB;IACF;IAKA,MAAM/F,0BAA0BI,QAAQ,EAAEmE,OAAO,EAAE;QACjD,MAAMyB,iBAAiB;YACrB;gBACE/H,MAAM;gBACN2G,OAAO;oBACL;oBACA;oBACA;iBACD;gBACDL,SAASA;gBACTO,UAAU;gBACVmB,UAAU;YACZ;YACA;gBACEhI,MAAM;gBACN2G,OAAO;oBAAC;oBAAmB;oBAAqB;iBAAyB;gBACzEL,SAASA,QAAQvC,MAAM,CAAC,CAAC6C,IAAM;wBAAC;wBAAW;qBAAa,CAAC3C,QAAQ,CAAC2C,EAAEnG,IAAI;gBACxEoG,UAAU;gBACVmB,UAAU;YACZ;YACA;gBACEhI,MAAM;gBACN2G,OAAO;oBAAC;oBAAgC;oBAA0B;iBAAwB;gBAC1FL,SAASA;gBACTO,UAAU;gBACVoB,eAAe;YACjB;SACD;QAED,OAAO;YACL1B,UAAU;YACVG,QAAQqB;YACRhB,mBAAmB;YACnBC,aAAa;YACbkB,iBAAiB;QACnB;IACF;IAKApB,wBAAwBjC,SAAS,EAAE;QACjC,MAAMsD,gBAAgB;YACpBhE,SAAS;gBACP;gBACA;gBACA;gBACA;aACD;YACDC,UAAU;gBACR;gBACA;gBACA;gBACA;aACD;YACDC,MAAM;gBACJ;gBACA;gBACA;gBACA;aACD;YACDC,MAAM;gBACJ;gBACA;gBACA;gBACA;aACD;QACH;QAEA,OACE6D,aAAa,CAACtD,UAAU,IAAI;YAC1B,CAAC,OAAO,EAAEA,WAAW;YACrB,CAAC,UAAU,EAAEA,WAAW;YACxB,CAAC,KAAK,EAAEA,WAAW;SACpB;IAEL;IAKAoC,kBAAkB9E,QAAQ,EAAE;QAC1B,MAAMwE,QAAQ,EAAE;QAChB,MAAMxD,aAAa,IAAI,CAACC,mBAAmB,CAACjB,SAASzB,SAAS;QAG9DiG,MAAM5B,IAAI,CAAC,wBAAwB,uBAAuB;QAG1D5B,WAAWyB,OAAO,CAAC,CAACC;YAClB8B,MAAM5B,IAAI,IAAI,IAAI,CAAC+B,uBAAuB,CAACjC;QAC7C;QAGA8B,MAAM5B,IAAI,CAAC,wBAAwB,eAAe;QAElD,OAAO4B;IACT;IAKAQ,oBAAoBb,OAAO,EAAE;QAC3B,MAAM8B,SAAS,CAAC;QAEhB9B,QAAQ1B,OAAO,CAAC,CAACyD;YACf,IAAI,CAACD,MAAM,CAACC,OAAO5H,IAAI,CAAC,EAAE;gBACxB2H,MAAM,CAACC,OAAO5H,IAAI,CAAC,GAAG,EAAE;YAC1B;YACA2H,MAAM,CAACC,OAAO5H,IAAI,CAAC,CAACsE,IAAI,CAACsD;QAC3B;QAEA,OAAOD;IACT;IAKAf,0BAA0BV,KAAK,EAAEO,YAAY,EAAE;QAC7C,MAAMoB,cAAc,CAAC;QAErB3B,MAAM/B,OAAO,CAAC,CAAC2D;YACb,MAAMC,iBAAiB,IAAI,CAACC,mBAAmB,CAACF;YAChD,MAAMG,mBAAmBxB,YAAY,CAACsB,eAAe,IAAI,EAAE;YAE3D,IAAIE,iBAAiB1F,MAAM,GAAG,GAAG;gBAE/B,MAAM2F,cACJrF,OAAOsF,IAAI,CAACN,aAAavE,MAAM,CAAC,CAAC8E,IAAMP,WAAW,CAACO,EAAE,CAACpI,IAAI,KAAK+H,gBAAgBxF,MAAM,GACrF0F,iBAAiB1F,MAAM;gBAEzBsF,WAAW,CAACC,KAAK,GAAGG,gBAAgB,CAACC,YAAY;YACnD;QACF;QAEA,OAAOL;IACT;IAKAG,oBAAoBF,IAAI,EAAE;QACxB,MAAMO,YAAYP,KAAKzE,WAAW;QAElC,IAAIgF,UAAU7E,QAAQ,CAAC,eAAe6E,UAAU7E,QAAQ,CAAC,YAAY;YACnE,OAAO;QACT;QACA,IAAI6E,UAAU7E,QAAQ,CAAC,aAAa6E,UAAU7E,QAAQ,CAAC,cAAc;YACnE,OAAO;QACT;QACA,IAAI6E,UAAU7E,QAAQ,CAAC,gBAAgB6E,UAAU7E,QAAQ,CAAC,SAAS;YACjE,OAAO;QACT;QACA,IAAI6E,UAAU7E,QAAQ,CAAC,WAAW6E,UAAU7E,QAAQ,CAAC,aAAa;YAChE,OAAO;QACT;QACA,IAAI6E,UAAU7E,QAAQ,CAAC,eAAe6E,UAAU7E,QAAQ,CAAC,gBAAgB;YACvE,OAAO;QACT;QACA,IAAI6E,UAAU7E,QAAQ,CAAC,eAAe6E,UAAU7E,QAAQ,CAAC,UAAU;YACjE,OAAO;QACT;QAEA,OAAO;IACT;IAKA0D,wBAAwBxF,QAAQ,EAAE;QAChC,MAAM4G,mBAAmB;YACvB;YACA;YACA;YACA;YACA;YACA;YACA;YACA;YACA;SACD;QAED,MAAMC,YAAY,EAAE;QACpB,MAAM7F,aAAa,IAAI,CAACC,mBAAmB,CAACjB,SAASzB,SAAS;QAG9D,IAAIyC,WAAWH,MAAM,GAAG,GAAG;YACzBgG,UAAUjE,IAAI,CAAC;QACjB;QAGA5B,WAAWyB,OAAO,CAAC,CAACC;YAClBmE,UAAUjE,IAAI,CAAC,CAAC,qBAAqB,EAAEF,WAAW;QACpD;QAGA,IAAI1C,SAASC,UAAU,KAAK,OAAO;YACjC4G,UAAUjE,IAAI,CAAC;QACjB;QAEA,OAAOiE;IACT;IAKA,MAAMC,aAAaC,KAAK,EAAEC,OAAO,EAAEC,cAAc,CAAC,CAAC,EAAE;QACnD,MAAMxB,WAAW;YACfsB;YACAC;YACAC;YACAC,WAAW,IAAI,CAACC,mBAAmB,CAACJ,OAAOC,SAASC;YACpDG,WAAWC,KAAKC,GAAG;QACrB;QAGA,MAAMC,gBAAgB,IAAI,CAACC,uBAAuB,CAAC/B;QAEnDA,SAASgC,MAAM,GAAGF;QAClB,IAAI,CAAC/I,KAAK,CAACE,cAAc;QAGzB,IAAI,IAAI,CAACN,MAAM,CAACE,IAAI,KAAK,YAAY;YACnC,IAAI,CAACoJ,kBAAkB,CAACjC;QAC1B;QAEA,IAAI,CAAC3F,IAAI,CAAC,iBAAiB2F;QAC3B,OAAOA;IACT;IAKA0B,oBAAoBJ,KAAK,EAAEC,OAAO,EAAEC,WAAW,EAAE;QAE/C,IAAI,IAAI,CAAC7I,MAAM,CAACE,IAAI,KAAK,aAAa;YACpC,OAAO,IAAI,CAACqJ,cAAc,CAACZ,OAAOC;QACpC;QAGA,IAAI,IAAI,CAAC5I,MAAM,CAACE,IAAI,KAAK,YAAY;YACnC,OAAO,IAAI,CAACsJ,aAAa,CAACb,OAAOC,SAASC;QAC5C;QAGA,IAAI,IAAI,CAAC7I,MAAM,CAACE,IAAI,KAAK,YAAY;YACnC,OAAO,IAAI,CAACuJ,aAAa,CAACd,OAAOC,SAASC;QAC5C;QAEA,OAAOD,OAAO,CAAC,EAAE;IACnB;IAKAW,eAAeZ,KAAK,EAAEC,OAAO,EAAE;QAE7B,MAAMc,oBAAoB;YAAC;YAAY;YAAgB;YAAc;SAAS;QAE9E,KAAK,MAAMC,UAAUf,QAAS;YAC5B,MAAMgB,cAAcD,OAAOpG,WAAW;YACtC,IAAImG,kBAAkBnF,IAAI,CAAC,CAACd,UAAYmG,YAAYlG,QAAQ,CAACD,WAAW;gBACtE,OAAOkG;YACT;QACF;QAEA,OAAOf,OAAO,CAAC,EAAE;IACnB;IAKAY,cAAcb,KAAK,EAAEC,OAAO,EAAEC,WAAW,EAAE;QAEzC,MAAMgB,aAAa,CAAC;QACpB9G,OAAOC,MAAM,CAAC6F,aAAaxE,OAAO,CAAC,CAACyF;YAClCD,UAAU,CAACC,KAAK,GAAG,AAACD,CAAAA,UAAU,CAACC,KAAK,IAAI,CAAA,IAAK;QAC/C;QAEA,MAAMC,SAAShH,OAAOqB,OAAO,CAACyF,YAAYG,IAAI,CAAC,CAAC9G,GAAGC,IAAMA,CAAC,CAAC,EAAE,GAAGD,CAAC,CAAC,EAAE;QACpE,IAAI6G,OAAOtH,MAAM,GAAG,KAAKsH,MAAM,CAAC,EAAE,CAAC,EAAE,GAAGhH,OAAOsF,IAAI,CAACQ,aAAapG,MAAM,GAAG,KAAK;YAC7E,OAAOsH,MAAM,CAAC,EAAE,CAAC,EAAE;QACrB;QAGA,MAAME,mBAAmB;YAAC;YAAU;YAAS;YAAQ;SAAY;QAEjE,KAAK,MAAMN,UAAUf,QAAS;YAC5B,MAAMgB,cAAcD,OAAOpG,WAAW;YACtC,IAAI0G,iBAAiB1F,IAAI,CAAC,CAACd,UAAYmG,YAAYlG,QAAQ,CAACD,WAAW;gBACrE,OAAOkG;YACT;QACF;QAEA,OAAOf,OAAO,CAAC,EAAE;IACnB;IAKAa,cAAcd,KAAK,EAAEC,OAAO,EAAEC,WAAW,EAAE;QAEzC,MAAMqB,mBAAmBnF,MAAMC,IAAI,CAAC,IAAI,CAAC5E,KAAK,CAACI,YAAY,CAAC4D,OAAO,IAAIZ,MAAM,CAC3E,CAAC,CAAC2G,KAAKC,MAAM,GAAKD,IAAIzG,QAAQ,CAAC,eAAe0G,MAAMzB,KAAK,CAACjF,QAAQ,CAACiF;QAGrE,IAAIuB,iBAAiBzH,MAAM,GAAG,GAAG;YAE/B,MAAM4H,oBAAoBH,iBACvB1G,MAAM,CAAC,CAAC,CAAC8G,GAAGjD,SAAS,GAAKA,SAASkD,OAAO,EAC1CC,GAAG,CAAC,CAAC,CAACF,GAAGjD,SAAS,GAAKA,SAASgC,MAAM;YAEzC,KAAK,MAAMM,UAAUf,QAAS;gBAC5B,IAAIyB,kBAAkB3G,QAAQ,CAACiG,SAAS;oBACtC,OAAOA;gBACT;YACF;QACF;QAGA,OAAOf,OAAO,CAACpD,KAAKiF,KAAK,CAACjF,KAAKkF,MAAM,KAAK9B,QAAQnG,MAAM,EAAE;IAC5D;IAKA2G,wBAAwB/B,QAAQ,EAAE;QAChC,MAAMwC,aAAa,CAAC;QAGpB9G,OAAOC,MAAM,CAACqE,SAASwB,WAAW,EAAExE,OAAO,CAAC,CAACyF;YAC3CD,UAAU,CAACC,KAAK,GAAG,AAACD,CAAAA,UAAU,CAACC,KAAK,IAAI,CAAA,IAAK;QAC/C;QAGAD,UAAU,CAACxC,SAASyB,SAAS,CAAC,GAC5B,AAACe,CAAAA,UAAU,CAACxC,SAASyB,SAAS,CAAC,IAAI,CAAA,IAAK,IAAI,CAAC9I,MAAM,CAACL,cAAc;QAGpE,MAAMoK,SAAShH,OAAOqB,OAAO,CAACyF,YAAYG,IAAI,CAAC,CAAC9G,GAAGC,IAAMA,CAAC,CAAC,EAAE,GAAGD,CAAC,CAAC,EAAE;QACpE,OAAO6G,MAAM,CAAC,EAAE,CAAC,EAAE;IACrB;IAKAT,mBAAmBjC,QAAQ,EAAE;QAC3B,MAAM8C,MAAM,CAAC,SAAS,EAAE,IAAI,CAAC/J,KAAK,CAACE,cAAc,EAAE;QACnD,IAAI,CAACF,KAAK,CAACI,YAAY,CAAC+B,GAAG,CAAC4H,KAAK;YAC/B,GAAG9C,QAAQ;YACXkD,SAAS;QACX;IACF;IAKAI,sBAAsBC,UAAU,EAAEL,OAAO,EAAEM,UAAU,CAAC,CAAC,EAAE;QACvD,MAAMV,MAAM,CAAC,SAAS,EAAES,YAAY;QACpC,MAAMvD,WAAW,IAAI,CAACjH,KAAK,CAACI,YAAY,CAACsK,GAAG,CAACX;QAE7C,IAAI9C,UAAU;YACZA,SAASkD,OAAO,GAAGA;YACnBlD,SAASwD,OAAO,GAAGA;YACnB,IAAI,CAACnJ,IAAI,CAAC,oBAAoB;gBAAEkJ;gBAAYL;gBAASM;YAAQ;QAC/D;IACF;IAKAE,YAAY;QACV,OAAO;YACL7K,MAAM,IAAI,CAACF,MAAM,CAACE,IAAI;YACtBT,MAAM,IAAI,CAACO,MAAM,CAACP,IAAI;YACtBY,QAAQ,IAAI,CAACD,KAAK,CAACC,MAAM;YACzBC,gBAAgB,IAAI,CAACF,KAAK,CAACE,cAAc;YACzCC,oBAAoB,IAAI,CAACH,KAAK,CAACG,kBAAkB;YACjDG,iBAAiB,IAAI,CAACN,KAAK,CAACM,eAAe;YAC3CsK,kBAAkB,IAAI,CAAC5K,KAAK,CAACI,YAAY,CAACyK,IAAI;QAChD;IACF;AACF"}