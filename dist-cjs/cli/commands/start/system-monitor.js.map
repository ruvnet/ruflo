{
  "version": 3,
  "sources": ["../../../../src/cli/commands/start/system-monitor.ts"],
  "sourcesContent": ["/**\n * System Monitor - Real-time monitoring of system processes\n */\n\nimport chalk from 'chalk';\nimport type { ProcessManager } from './process-manager.js';\nimport { SystemEvents } from '../../../utils/types.js';\nimport { eventBus } from '../../../core/event-bus.js';\n\nexport class SystemMonitor {\n  private processManager: ProcessManager;\n  private events: any[] = [];\n  private maxEvents = 100;\n  private metricsInterval?: NodeJS.Timeout;\n\n  constructor(processManager: ProcessManager) {\n    this.processManager = processManager;\n    this.setupEventListeners();\n  }\n\n  private setupEventListeners(): void {\n    // System events\n    eventBus.on(SystemEvents.AGENT_SPAWNED, (data: any) => {\n      this.addEvent({\n        type: 'agent_spawned',\n        timestamp: Date.now(),\n        data,\n        level: 'info',\n      });\n    });\n\n    eventBus.on(SystemEvents.AGENT_TERMINATED, (data: any) => {\n      this.addEvent({\n        type: 'agent_terminated',\n        timestamp: Date.now(),\n        data,\n        level: 'warning',\n      });\n    });\n\n    eventBus.on(SystemEvents.TASK_ASSIGNED, (data: any) => {\n      this.addEvent({\n        type: 'task_assigned',\n        timestamp: Date.now(),\n        data,\n        level: 'info',\n      });\n    });\n\n    eventBus.on(SystemEvents.TASK_COMPLETED, (data: any) => {\n      this.addEvent({\n        type: 'task_completed',\n        timestamp: Date.now(),\n        data,\n        level: 'success',\n      });\n    });\n\n    eventBus.on(SystemEvents.TASK_FAILED, (data: any) => {\n      this.addEvent({\n        type: 'task_failed',\n        timestamp: Date.now(),\n        data,\n        level: 'error',\n      });\n    });\n\n    eventBus.on(SystemEvents.SYSTEM_ERROR, (data: any) => {\n      this.addEvent({\n        type: 'system_error',\n        timestamp: Date.now(),\n        data,\n        level: 'error',\n      });\n    });\n\n    // Process manager events\n    this.processManager.on('processStarted', ({ processId, process }) => {\n      this.addEvent({\n        type: 'process_started',\n        timestamp: Date.now(),\n        data: { processId, processName: process.name },\n        level: 'success',\n      });\n    });\n\n    this.processManager.on('processStopped', ({ processId }) => {\n      this.addEvent({\n        type: 'process_stopped',\n        timestamp: Date.now(),\n        data: { processId },\n        level: 'warning',\n      });\n    });\n\n    this.processManager.on('processError', ({ processId, error }) => {\n      this.addEvent({\n        type: 'process_error',\n        timestamp: Date.now(),\n        data: { processId, error: error instanceof Error ? error.message : String(error) },\n        level: 'error',\n      });\n    });\n  }\n\n  private addEvent(event: any): void {\n    this.events.unshift(event);\n    if (this.events.length > this.maxEvents) {\n      this.events.pop();\n    }\n  }\n\n  start(): void {\n    // Start collecting metrics\n    this.metricsInterval = setInterval(() => {\n      this.collectMetrics();\n    }, 5000);\n  }\n\n  stop(): void {\n    if (this.metricsInterval) {\n      clearInterval(this.metricsInterval);\n    }\n  }\n\n  private collectMetrics(): void {\n    // Collect system metrics\n    const processes = this.processManager.getAllProcesses();\n\n    for (const process of processes) {\n      if (process.status === 'running') {\n        // Simulate metrics collection (would integrate with actual monitoring)\n        process.metrics = {\n          ...process.metrics,\n          cpu: Math.random() * 50,\n          memory: Math.random() * 200,\n          uptime: process.startTime ? Date.now() - process.startTime : 0,\n        };\n      }\n    }\n  }\n\n  getRecentEvents(count: number = 10): any[] {\n    return this.events.slice(0, count);\n  }\n\n  printEventLog(count: number = 20): void {\n    console.log(chalk.cyan.bold('\uD83D\uDCCA Recent System Events'));\n    console.log(chalk.gray('\u2500'.repeat(80)));\n\n    const events = this.getRecentEvents(count);\n\n    for (const event of events) {\n      const timestamp = new Date(event.timestamp).toLocaleTimeString();\n      const icon = this.getEventIcon(event.type);\n      const color = this.getEventColor(event.level);\n\n      console.log(chalk.gray(timestamp), icon, color(this.formatEventMessage(event)));\n    }\n  }\n\n  private getEventIcon(type: string): string {\n    const icons: Record<string, string> = {\n      agent_spawned: '\uD83E\uDD16',\n      agent_terminated: '\uD83D\uDD1A',\n      task_assigned: '\uD83D\uDCCC',\n      task_completed: '\u2705',\n      task_failed: '\u274C',\n      system_error: '\u26A0\uFE0F',\n      process_started: '\u25B6\uFE0F',\n      process_stopped: '\u23F9\uFE0F',\n      process_error: '\uD83D\uDEA8',\n    };\n\n    return icons[type] || '\u2022';\n  }\n\n  private getEventColor(level: string): (text: string) => string {\n    switch (level) {\n      case 'success':\n        return chalk.green;\n      case 'info':\n        return chalk.blue;\n      case 'warning':\n        return chalk.yellow;\n      case 'error':\n        return chalk.red;\n      default:\n        return chalk.white;\n    }\n  }\n\n  private formatEventMessage(event: any): string {\n    switch (event.type) {\n      case 'agent_spawned':\n        return `Agent spawned: ${event.data.agentId} (${event.data.profile?.type || 'unknown'})`;\n      case 'agent_terminated':\n        return `Agent terminated: ${event.data.agentId} - ${event.data.reason}`;\n      case 'task_assigned':\n        return `Task ${event.data.taskId} assigned to ${event.data.agentId}`;\n      case 'task_completed':\n        return `Task completed: ${event.data.taskId}`;\n      case 'task_failed':\n        return `Task failed: ${event.data.taskId} - ${event.data.error?.message}`;\n      case 'system_error':\n        return `System error in ${event.data.component}: ${event.data.error?.message}`;\n      case 'process_started':\n        return `Process started: ${event.data.processName}`;\n      case 'process_stopped':\n        return `Process stopped: ${event.data.processId}`;\n      case 'process_error':\n        return `Process error: ${event.data.processId} - ${event.data.error}`;\n      default:\n        return JSON.stringify(event.data);\n    }\n  }\n\n  printSystemHealth(): void {\n    const stats = this.processManager.getSystemStats();\n    const processes = this.processManager.getAllProcesses();\n\n    console.log(chalk.cyan.bold('\uD83C\uDFE5 System Health'));\n    console.log(chalk.gray('\u2500'.repeat(60)));\n\n    // Overall status\n    const healthStatus =\n      stats.errorProcesses === 0\n        ? chalk.green('\u25CF Healthy')\n        : chalk.red(`\u25CF Unhealthy (${stats.errorProcesses} errors)`);\n\n    console.log('Status:', healthStatus);\n    console.log('Uptime:', this.formatUptime(stats.systemUptime));\n    console.log();\n\n    // Process status\n    console.log(chalk.white.bold('Process Status:'));\n    for (const process of processes) {\n      const status = this.getProcessStatusIcon(process.status);\n      const metrics = process.metrics;\n\n      let line = `  ${status} ${process.name.padEnd(20)}`;\n\n      if (metrics && process.status === 'running') {\n        line += chalk.gray(` CPU: ${metrics.cpu?.toFixed(1)}% `);\n        line += chalk.gray(` MEM: ${metrics.memory?.toFixed(0)}MB`);\n      }\n\n      console.log(line);\n    }\n\n    console.log();\n\n    // System metrics\n    console.log(chalk.white.bold('System Metrics:'));\n    console.log(`  Active Processes: ${stats.runningProcesses}/${stats.totalProcesses}`);\n    console.log(`  Recent Events: ${this.events.length}`);\n\n    // Recent errors\n    const recentErrors = this.events.filter((e) => e.level === 'error').slice(0, 3);\n\n    if (recentErrors.length > 0) {\n      console.log();\n      console.log(chalk.red.bold('Recent Errors:'));\n      for (const error of recentErrors) {\n        const time = new Date(error.timestamp).toLocaleTimeString();\n        console.log(chalk.red(`  ${time} - ${this.formatEventMessage(error)}`));\n      }\n    }\n  }\n\n  private getProcessStatusIcon(status: string): string {\n    switch (status) {\n      case 'running':\n        return chalk.green('\u25CF');\n      case 'stopped':\n        return chalk.gray('\u25CB');\n      case 'starting':\n        return chalk.yellow('\u25D0');\n      case 'stopping':\n        return chalk.yellow('\u25D1');\n      case 'error':\n        return chalk.red('\u2717');\n      default:\n        return chalk.gray('?');\n    }\n  }\n\n  private formatUptime(ms: number): string {\n    const seconds = Math.floor(ms / 1000);\n    const minutes = Math.floor(seconds / 60);\n    const hours = Math.floor(minutes / 60);\n    const days = Math.floor(hours / 24);\n\n    if (days > 0) {\n      return `${days}d ${hours % 24}h ${minutes % 60}m`;\n    } else if (hours > 0) {\n      return `${hours}h ${minutes % 60}m ${seconds % 60}s`;\n    } else if (minutes > 0) {\n      return `${minutes}m ${seconds % 60}s`;\n    } else {\n      return `${seconds}s`;\n    }\n  }\n}\n"],
  "mappings": "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",
  "names": ["chalk"]
}
