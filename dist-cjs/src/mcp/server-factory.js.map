{"version":3,"sources":["../../../src/mcp/server-factory.ts"],"sourcesContent":["/**\r\n * MCP Server Factory\r\n *\r\n * Creates appropriate MCP server instance based on configuration.\r\n * Provides seamless transition from legacy MCP to MCP 2025-11 with feature flags.\r\n */\r\n\r\nimport type { IEventBus } from '../interfaces/event-bus.js';\r\nimport type { ILogger } from '../interfaces/logger.js';\r\nimport type { MCPConfig } from '../utils/types.js';\r\nimport { MCPServer, type IMCPServer } from './server.js';\r\nimport { MCP2025Server, type MCP2025ServerConfig } from './server-mcp-2025.js';\r\nimport { ProgressiveToolRegistry } from './tool-registry-progressive.js';\r\n\r\n/**\r\n * MCP server feature flags for gradual rollout\r\n */\r\nexport interface MCPFeatureFlags {\r\n  // Enable MCP 2025-11 features\r\n  enableMCP2025?: boolean;\r\n\r\n  // Individual feature flags\r\n  enableVersionNegotiation?: boolean;\r\n  enableAsyncJobs?: boolean;\r\n  enableRegistryIntegration?: boolean;\r\n  enableSchemaValidation?: boolean;\r\n\r\n  // Backward compatibility\r\n  supportLegacyClients?: boolean;\r\n\r\n  // Progressive disclosure (already implemented in Phase 1)\r\n  enableProgressiveDisclosure?: boolean;\r\n}\r\n\r\n/**\r\n * Extended MCP configuration with 2025-11 support\r\n */\r\nexport interface ExtendedMCPConfig extends MCPConfig {\r\n  // Feature flags\r\n  features?: MCPFeatureFlags;\r\n\r\n  // MCP 2025-11 specific config\r\n  mcp2025?: {\r\n    serverId?: string;\r\n\r\n    // Async job configuration\r\n    async?: {\r\n      enabled?: boolean;\r\n      maxJobs?: number;\r\n      jobTTL?: number;\r\n      persistence?: 'memory' | 'redis' | 'sqlite';\r\n    };\r\n\r\n    // Registry configuration\r\n    registry?: {\r\n      enabled?: boolean;\r\n      url?: string;\r\n      apiKey?: string;\r\n      updateInterval?: number;\r\n      retryAttempts?: number;\r\n    };\r\n\r\n    // Validation configuration\r\n    validation?: {\r\n      enabled?: boolean;\r\n      strictMode?: boolean;\r\n    };\r\n\r\n    // Tool discovery\r\n    toolsDirectory?: string;\r\n  };\r\n}\r\n\r\n/**\r\n * MCP Server Factory\r\n *\r\n * Creates appropriate server instance based on configuration:\r\n * - MCP2025Server if MCP 2025-11 features enabled\r\n * - Legacy MCPServer for backward compatibility\r\n */\r\nexport class MCPServerFactory {\r\n  /**\r\n   * Create MCP server instance based on configuration\r\n   */\r\n  static async createServer(\r\n    config: ExtendedMCPConfig,\r\n    eventBus: IEventBus,\r\n    logger: ILogger,\r\n    orchestrator?: any,\r\n    swarmCoordinator?: any,\r\n    agentManager?: any,\r\n    resourceManager?: any,\r\n    messagebus?: any,\r\n    monitor?: any\r\n  ): Promise<IMCPServer | MCP2025Server> {\r\n    const features = config.features || {};\r\n\r\n    // Determine if MCP 2025-11 should be enabled\r\n    const useMCP2025 = features.enableMCP2025 === true;\r\n\r\n    if (useMCP2025) {\r\n      logger.info('Creating MCP 2025-11 server with enhanced features');\r\n      return await this.createMCP2025Server(\r\n        config,\r\n        eventBus,\r\n        logger,\r\n        orchestrator\r\n      );\r\n    } else {\r\n      logger.info('Creating legacy MCP server (backward compatibility mode)');\r\n      return this.createLegacyServer(\r\n        config,\r\n        eventBus,\r\n        logger,\r\n        orchestrator,\r\n        swarmCoordinator,\r\n        agentManager,\r\n        resourceManager,\r\n        messagebus,\r\n        monitor\r\n      );\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Create MCP 2025-11 server with enhanced features\r\n   */\r\n  private static async createMCP2025Server(\r\n    config: ExtendedMCPConfig,\r\n    eventBus: IEventBus,\r\n    logger: ILogger,\r\n    orchestrator?: any\r\n  ): Promise<MCP2025Server> {\r\n    const features = config.features || {};\r\n    const mcp2025Config = config.mcp2025 || {};\r\n\r\n    // Build MCP 2025-11 server configuration\r\n    const serverConfig: MCP2025ServerConfig = {\r\n      serverId: mcp2025Config.serverId || `claude-flow-${Date.now()}`,\r\n      transport: config.transport || 'stdio',\r\n\r\n      // Feature flags\r\n      enableMCP2025: true,\r\n      supportLegacyClients: features.supportLegacyClients !== false, // Default true\r\n\r\n      // Async jobs\r\n      async: {\r\n        enabled: features.enableAsyncJobs !== false, // Default true\r\n        maxJobs: mcp2025Config.async?.maxJobs || 100,\r\n        jobTTL: mcp2025Config.async?.jobTTL || 3600000, // 1 hour\r\n        persistence: mcp2025Config.async?.persistence || 'memory',\r\n      },\r\n\r\n      // Registry integration\r\n      registry: {\r\n        enabled: features.enableRegistryIntegration === true,\r\n        url: mcp2025Config.registry?.url || 'https://registry.mcp.run',\r\n        apiKey: mcp2025Config.registry?.apiKey,\r\n        updateInterval: mcp2025Config.registry?.updateInterval || 60000,\r\n        retryAttempts: mcp2025Config.registry?.retryAttempts || 3,\r\n      },\r\n\r\n      // Schema validation\r\n      validation: {\r\n        enabled: features.enableSchemaValidation !== false, // Default true\r\n        strictMode: mcp2025Config.validation?.strictMode || false,\r\n      },\r\n\r\n      // Tool registry (progressive disclosure)\r\n      toolsDirectory: mcp2025Config.toolsDirectory,\r\n      orchestratorContext: orchestrator,\r\n    };\r\n\r\n    // Create and initialize server\r\n    const server = new MCP2025Server(serverConfig, eventBus, logger);\r\n    await server.initialize();\r\n\r\n    logger.info('MCP 2025-11 server created successfully', {\r\n      serverId: serverConfig.serverId,\r\n      features: {\r\n        versionNegotiation: true,\r\n        asyncJobs: serverConfig.async.enabled,\r\n        registry: serverConfig.registry.enabled,\r\n        validation: serverConfig.validation.enabled,\r\n        progressiveDisclosure: true,\r\n      },\r\n    });\r\n\r\n    return server;\r\n  }\r\n\r\n  /**\r\n   * Create legacy MCP server for backward compatibility\r\n   */\r\n  private static createLegacyServer(\r\n    config: ExtendedMCPConfig,\r\n    eventBus: IEventBus,\r\n    logger: ILogger,\r\n    orchestrator?: any,\r\n    swarmCoordinator?: any,\r\n    agentManager?: any,\r\n    resourceManager?: any,\r\n    messagebus?: any,\r\n    monitor?: any\r\n  ): MCPServer {\r\n    // Remove extended properties for legacy server\r\n    const legacyConfig: MCPConfig = {\r\n      transport: config.transport,\r\n      host: config.host,\r\n      port: config.port,\r\n      tlsEnabled: config.tlsEnabled,\r\n      enableMetrics: config.enableMetrics,\r\n      auth: config.auth,\r\n      loadBalancer: config.loadBalancer,\r\n      sessionTimeout: config.sessionTimeout,\r\n      maxSessions: config.maxSessions,\r\n    };\r\n\r\n    const server = new MCPServer(\r\n      legacyConfig,\r\n      eventBus,\r\n      logger,\r\n      orchestrator,\r\n      swarmCoordinator,\r\n      agentManager,\r\n      resourceManager,\r\n      messagebus,\r\n      monitor\r\n    );\r\n\r\n    logger.info('Legacy MCP server created successfully', {\r\n      transport: config.transport,\r\n      mode: 'backward-compatibility',\r\n    });\r\n\r\n    return server;\r\n  }\r\n\r\n  /**\r\n   * Detect optimal server configuration based on environment\r\n   */\r\n  static detectOptimalConfig(currentConfig: MCPConfig): ExtendedMCPConfig {\r\n    const extended: ExtendedMCPConfig = {\r\n      ...currentConfig,\r\n      features: {\r\n        // Enable MCP 2025-11 by default in development, opt-in for production\r\n        enableMCP2025: process.env.NODE_ENV !== 'production',\r\n\r\n        // Individual features (can be overridden)\r\n        enableVersionNegotiation: true,\r\n        enableAsyncJobs: true,\r\n        enableRegistryIntegration: false, // Opt-in\r\n        enableSchemaValidation: true,\r\n        supportLegacyClients: true, // Always support legacy\r\n        enableProgressiveDisclosure: true, // Phase 1 feature\r\n      },\r\n      mcp2025: {\r\n        async: {\r\n          enabled: true,\r\n          maxJobs: 100,\r\n          jobTTL: 3600000,\r\n          persistence: 'memory',\r\n        },\r\n        registry: {\r\n          enabled: false,\r\n          url: process.env.MCP_REGISTRY_URL || 'https://registry.mcp.run',\r\n          apiKey: process.env.MCP_REGISTRY_API_KEY,\r\n        },\r\n        validation: {\r\n          enabled: true,\r\n          strictMode: false,\r\n        },\r\n      },\r\n    };\r\n\r\n    return extended;\r\n  }\r\n\r\n  /**\r\n   * Validate server configuration\r\n   */\r\n  static validateConfig(config: ExtendedMCPConfig): {\r\n    valid: boolean;\r\n    errors: string[];\r\n    warnings: string[];\r\n  } {\r\n    const errors: string[] = [];\r\n    const warnings: string[] = [];\r\n\r\n    // Basic validation\r\n    if (!config.transport) {\r\n      errors.push('Transport type is required');\r\n    }\r\n\r\n    // MCP 2025-11 specific validation\r\n    if (config.features?.enableMCP2025) {\r\n      if (config.features.enableRegistryIntegration && !config.mcp2025?.registry?.apiKey) {\r\n        warnings.push('Registry integration enabled but no API key provided');\r\n      }\r\n\r\n      if (config.mcp2025?.async?.persistence === 'redis') {\r\n        warnings.push('Redis persistence not yet implemented, falling back to memory');\r\n      }\r\n\r\n      if (config.mcp2025?.async?.persistence === 'sqlite') {\r\n        warnings.push('SQLite persistence not yet implemented, falling back to memory');\r\n      }\r\n    }\r\n\r\n    // Transport validation\r\n    if (config.transport === 'http') {\r\n      if (!config.host) {\r\n        warnings.push('HTTP transport enabled but no host specified, using default');\r\n      }\r\n      if (!config.port) {\r\n        warnings.push('HTTP transport enabled but no port specified, using default');\r\n      }\r\n    }\r\n\r\n    return {\r\n      valid: errors.length === 0,\r\n      errors,\r\n      warnings,\r\n    };\r\n  }\r\n}\r\n\r\n/**\r\n * Convenience function for creating MCP server\r\n */\r\nexport async function createMCPServer(\r\n  config: MCPConfig | ExtendedMCPConfig,\r\n  eventBus: IEventBus,\r\n  logger: ILogger,\r\n  options?: {\r\n    orchestrator?: any;\r\n    swarmCoordinator?: any;\r\n    agentManager?: any;\r\n    resourceManager?: any;\r\n    messagebus?: any;\r\n    monitor?: any;\r\n    autoDetectFeatures?: boolean;\r\n  }\r\n): Promise<IMCPServer | MCP2025Server> {\r\n  // Auto-detect optimal configuration if requested\r\n  const extendedConfig = options?.autoDetectFeatures\r\n    ? MCPServerFactory.detectOptimalConfig(config)\r\n    : (config as ExtendedMCPConfig);\r\n\r\n  // Validate configuration\r\n  const validation = MCPServerFactory.validateConfig(extendedConfig);\r\n\r\n  if (!validation.valid) {\r\n    throw new Error(`Invalid MCP configuration: ${validation.errors.join(', ')}`);\r\n  }\r\n\r\n  // Log warnings\r\n  for (const warning of validation.warnings) {\r\n    logger.warn('MCP configuration warning', { warning });\r\n  }\r\n\r\n  // Create server\r\n  return await MCPServerFactory.createServer(\r\n    extendedConfig,\r\n    eventBus,\r\n    logger,\r\n    options?.orchestrator,\r\n    options?.swarmCoordinator,\r\n    options?.agentManager,\r\n    options?.resourceManager,\r\n    options?.messagebus,\r\n    options?.monitor\r\n  );\r\n}\r\n\r\n/**\r\n * Check if MCP 2025-11 features are available\r\n */\r\nexport function isMCP2025Available(): boolean {\r\n  try {\r\n    // Check if required dependencies are available\r\n    require.resolve('uuid');\r\n    require.resolve('ajv');\r\n    require.resolve('ajv-formats');\r\n    return true;\r\n  } catch {\r\n    return false;\r\n  }\r\n}\r\n\r\n/**\r\n * Get MCP server capabilities based on configuration\r\n */\r\nexport function getServerCapabilities(config: ExtendedMCPConfig): string[] {\r\n  const capabilities: string[] = [];\r\n\r\n  if (config.features?.enableMCP2025) {\r\n    capabilities.push('mcp-2025-11');\r\n\r\n    if (config.features.enableVersionNegotiation) {\r\n      capabilities.push('version-negotiation');\r\n    }\r\n\r\n    if (config.features.enableAsyncJobs) {\r\n      capabilities.push('async-jobs');\r\n    }\r\n\r\n    if (config.features.enableRegistryIntegration) {\r\n      capabilities.push('registry');\r\n    }\r\n\r\n    if (config.features.enableSchemaValidation) {\r\n      capabilities.push('schema-validation');\r\n    }\r\n\r\n    if (config.features.enableProgressiveDisclosure) {\r\n      capabilities.push('progressive-disclosure');\r\n    }\r\n  }\r\n\r\n  if (config.features?.supportLegacyClients !== false) {\r\n    capabilities.push('backward-compatible');\r\n  }\r\n\r\n  return capabilities;\r\n}\r\n"],"names":["MCPServer","MCP2025Server","MCPServerFactory","createServer","config","eventBus","logger","orchestrator","swarmCoordinator","agentManager","resourceManager","messagebus","monitor","features","useMCP2025","enableMCP2025","info","createMCP2025Server","createLegacyServer","mcp2025Config","mcp2025","serverConfig","serverId","Date","now","transport","supportLegacyClients","async","enabled","enableAsyncJobs","maxJobs","jobTTL","persistence","registry","enableRegistryIntegration","url","apiKey","updateInterval","retryAttempts","validation","enableSchemaValidation","strictMode","toolsDirectory","orchestratorContext","server","initialize","versionNegotiation","asyncJobs","progressiveDisclosure","legacyConfig","host","port","tlsEnabled","enableMetrics","auth","loadBalancer","sessionTimeout","maxSessions","mode","detectOptimalConfig","currentConfig","extended","process","env","NODE_ENV","enableVersionNegotiation","enableProgressiveDisclosure","MCP_REGISTRY_URL","MCP_REGISTRY_API_KEY","validateConfig","errors","warnings","push","valid","length","createMCPServer","options","extendedConfig","autoDetectFeatures","Error","join","warning","warn","isMCP2025Available","require","resolve","getServerCapabilities","capabilities"],"mappings":"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"}