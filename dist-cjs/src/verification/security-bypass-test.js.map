{"version":3,"sources":["../../../src/verification/security-bypass-test.ts"],"sourcesContent":["/**\r\n * Security Bypass Prevention Test\r\n * \r\n * Comprehensive test to verify that NO agent can bypass the verification system\r\n * Tests all possible attack vectors and bypass attempts\r\n */\r\n\r\nimport { SecurityEnforcementSystem, createHighSecuritySystem } from './index';\r\nimport { PenetrationTestingSuite, SecurityValidationSuite } from './tests';\r\nimport { SecurityMiddlewareManager, ThreatIntelligenceMiddleware } from './middleware';\r\nimport { VerificationRequest } from './security';\r\n\r\nexport class SecurityBypassPreventionTest {\r\n  private security: SecurityEnforcementSystem;\r\n  private penetrationTester: PenetrationTestingSuite;\r\n  private validator: SecurityValidationSuite;\r\n  private middleware: SecurityMiddlewareManager;\r\n\r\n  constructor() {\r\n    this.security = createHighSecuritySystem();\r\n    this.penetrationTester = new PenetrationTestingSuite(this.security);\r\n    this.validator = new SecurityValidationSuite(this.security);\r\n    this.middleware = new SecurityMiddlewareManager();\r\n    \r\n    this.setupAdvancedSecurity();\r\n  }\r\n\r\n  private setupAdvancedSecurity(): void {\r\n    // Add threat intelligence middleware\r\n    const threatIntel = new ThreatIntelligenceMiddleware();\r\n    this.middleware.registerMiddleware(threatIntel);\r\n    \r\n    // Enhance security system with middleware\r\n    this.integrateMiddleware();\r\n  }\r\n\r\n  private integrateMiddleware(): void {\r\n    const originalProcess = this.security.processVerificationRequest.bind(this.security);\r\n    \r\n    this.security.processVerificationRequest = async (request: VerificationRequest) => {\r\n      await this.middleware.executeBeforeVerification(request);\r\n      \r\n      try {\r\n        const result = await originalProcess(request);\r\n        await this.middleware.executeAfterVerification(result);\r\n        return result;\r\n      } catch (error) {\r\n        await this.middleware.executeErrorHandling(error);\r\n        throw error;\r\n      }\r\n    };\r\n  }\r\n\r\n  // Run comprehensive bypass prevention test\r\n  async runBypassPreventionTest(): Promise<{\r\n    testsPassed: number;\r\n    testsFailed: number;\r\n    bypassAttempts: number;\r\n    successfulBypasses: number;\r\n    securityScore: number;\r\n    vulnerabilities: string[];\r\n    securityAssessment: 'SECURE' | 'VULNERABLE' | 'CRITICAL';\r\n  }> {\r\n    console.log('üîí STARTING COMPREHENSIVE BYPASS PREVENTION TEST');\r\n    console.log('================================================');\r\n\r\n    await this.security.initialize([\r\n      'test-node-1', 'test-node-2', 'test-node-3', \r\n      'test-node-4', 'test-node-5', 'test-node-6', \r\n      'test-node-7', 'test-node-8', 'test-node-9'\r\n    ]);\r\n\r\n    let testsPassed = 0;\r\n    let testsFailed = 0;\r\n    let bypassAttempts = 0;\r\n    let successfulBypasses = 0;\r\n    const vulnerabilities: string[] = [];\r\n\r\n    // Test 1: Authentication Bypass Attempts\r\n    console.log('\\nüîç Testing Authentication Bypass Prevention...');\r\n    const authBypassResult = await this.testAuthenticationBypassPrevention();\r\n    if (authBypassResult.prevented) {\r\n      testsPassed++;\r\n      console.log('‚úÖ Authentication bypass prevention: PASSED');\r\n    } else {\r\n      testsFailed++;\r\n      successfulBypasses++;\r\n      vulnerabilities.push('Authentication can be bypassed');\r\n      console.log('‚ùå Authentication bypass prevention: FAILED');\r\n    }\r\n    bypassAttempts += authBypassResult.attempts;\r\n\r\n    // Test 2: Rate Limiting Bypass Attempts\r\n    console.log('\\n‚è±Ô∏è  Testing Rate Limiting Bypass Prevention...');\r\n    const rateLimitBypassResult = await this.testRateLimitingBypassPrevention();\r\n    if (rateLimitBypassResult.prevented) {\r\n      testsPassed++;\r\n      console.log('‚úÖ Rate limiting bypass prevention: PASSED');\r\n    } else {\r\n      testsFailed++;\r\n      successfulBypasses++;\r\n      vulnerabilities.push('Rate limiting can be bypassed');\r\n      console.log('‚ùå Rate limiting bypass prevention: FAILED');\r\n    }\r\n    bypassAttempts += rateLimitBypassResult.attempts;\r\n\r\n    // Test 3: Cryptographic Bypass Attempts\r\n    console.log('\\nüîê Testing Cryptographic Bypass Prevention...');\r\n    const cryptoBypassResult = await this.testCryptographicBypassPrevention();\r\n    if (cryptoBypassResult.prevented) {\r\n      testsPassed++;\r\n      console.log('‚úÖ Cryptographic bypass prevention: PASSED');\r\n    } else {\r\n      testsFailed++;\r\n      successfulBypasses++;\r\n      vulnerabilities.push('Cryptographic verification can be bypassed');\r\n      console.log('‚ùå Cryptographic bypass prevention: FAILED');\r\n    }\r\n    bypassAttempts += cryptoBypassResult.attempts;\r\n\r\n    // Test 4: Byzantine Attack Bypass Attempts\r\n    console.log('\\nüõ°Ô∏è  Testing Byzantine Attack Prevention...');\r\n    const byzantineBypassResult = await this.testByzantineBypassPrevention();\r\n    if (byzantineBypassResult.prevented) {\r\n      testsPassed++;\r\n      console.log('‚úÖ Byzantine attack prevention: PASSED');\r\n    } else {\r\n      testsFailed++;\r\n      successfulBypasses++;\r\n      vulnerabilities.push('Byzantine attacks are not properly detected');\r\n      console.log('‚ùå Byzantine attack prevention: FAILED');\r\n    }\r\n    bypassAttempts += byzantineBypassResult.attempts;\r\n\r\n    // Test 5: Audit Trail Bypass Attempts\r\n    console.log('\\nüìã Testing Audit Trail Bypass Prevention...');\r\n    const auditBypassResult = await this.testAuditTrailBypassPrevention();\r\n    if (auditBypassResult.prevented) {\r\n      testsPassed++;\r\n      console.log('‚úÖ Audit trail bypass prevention: PASSED');\r\n    } else {\r\n      testsFailed++;\r\n      successfulBypasses++;\r\n      vulnerabilities.push('Audit trail can be bypassed or tampered');\r\n      console.log('‚ùå Audit trail bypass prevention: FAILED');\r\n    }\r\n    bypassAttempts += auditBypassResult.attempts;\r\n\r\n    // Test 6: Privilege Escalation Prevention\r\n    console.log('\\n‚¨ÜÔ∏è  Testing Privilege Escalation Prevention...');\r\n    const privilegeBypassResult = await this.testPrivilegeEscalationPrevention();\r\n    if (privilegeBypassResult.prevented) {\r\n      testsPassed++;\r\n      console.log('‚úÖ Privilege escalation prevention: PASSED');\r\n    } else {\r\n      testsFailed++;\r\n      successfulBypasses++;\r\n      vulnerabilities.push('Privilege escalation is possible');\r\n      console.log('‚ùå Privilege escalation prevention: FAILED');\r\n    }\r\n    bypassAttempts += privilegeBypassResult.attempts;\r\n\r\n    // Test 7: Complete System Bypass Attempts\r\n    console.log('\\nüö´ Testing Complete System Bypass Prevention...');\r\n    const systemBypassResult = await this.testCompleteSystemBypassPrevention();\r\n    if (systemBypassResult.prevented) {\r\n      testsPassed++;\r\n      console.log('‚úÖ Complete system bypass prevention: PASSED');\r\n    } else {\r\n      testsFailed++;\r\n      successfulBypasses++;\r\n      vulnerabilities.push('CRITICAL: Complete system bypass is possible');\r\n      console.log('‚ùå Complete system bypass prevention: FAILED');\r\n    }\r\n    bypassAttempts += systemBypassResult.attempts;\r\n\r\n    // Calculate security score\r\n    const securityScore = Math.round((testsPassed / (testsPassed + testsFailed)) * 100);\r\n    \r\n    // Determine security assessment\r\n    let securityAssessment: 'SECURE' | 'VULNERABLE' | 'CRITICAL';\r\n    if (successfulBypasses === 0) {\r\n      securityAssessment = 'SECURE';\r\n    } else if (successfulBypasses <= 2) {\r\n      securityAssessment = 'VULNERABLE';\r\n    } else {\r\n      securityAssessment = 'CRITICAL';\r\n    }\r\n\r\n    // Print final results\r\n    console.log('\\n================================================');\r\n    console.log('üîí BYPASS PREVENTION TEST RESULTS');\r\n    console.log('================================================');\r\n    console.log(`‚úÖ Tests Passed: ${testsPassed}`);\r\n    console.log(`‚ùå Tests Failed: ${testsFailed}`);\r\n    console.log(`üéØ Bypass Attempts: ${bypassAttempts}`);\r\n    console.log(`üö® Successful Bypasses: ${successfulBypasses}`);\r\n    console.log(`üìä Security Score: ${securityScore}%`);\r\n    console.log(`üîç Security Assessment: ${securityAssessment}`);\r\n    \r\n    if (vulnerabilities.length > 0) {\r\n      console.log('\\n‚ö†Ô∏è  VULNERABILITIES DETECTED:');\r\n      vulnerabilities.forEach((vuln, index) => {\r\n        console.log(`   ${index + 1}. ${vuln}`);\r\n      });\r\n    } else {\r\n      console.log('\\nüéâ NO VULNERABILITIES DETECTED - SYSTEM IS SECURE!');\r\n    }\r\n\r\n    return {\r\n      testsPassed,\r\n      testsFailed,\r\n      bypassAttempts,\r\n      successfulBypasses,\r\n      securityScore,\r\n      vulnerabilities,\r\n      securityAssessment\r\n    };\r\n  }\r\n\r\n  // Test authentication bypass prevention\r\n  private async testAuthenticationBypassPrevention(): Promise<{ prevented: boolean; attempts: number }> {\r\n    const attempts = [\r\n      // Attempt 1: No agent registration\r\n      () => this.attemptVerificationWithoutRegistration(),\r\n      \r\n      // Attempt 2: Invalid signature\r\n      () => this.attemptVerificationWithInvalidSignature(),\r\n      \r\n      // Attempt 3: Expired credentials\r\n      () => this.attemptVerificationWithExpiredCredentials(),\r\n      \r\n      // Attempt 4: Impersonation attack\r\n      () => this.attemptAgentImpersonation(),\r\n      \r\n      // Attempt 5: Credential stuffing\r\n      () => this.attemptCredentialStuffing()\r\n    ];\r\n\r\n    let preventedCount = 0;\r\n    for (const attempt of attempts) {\r\n      try {\r\n        await attempt();\r\n        // If no error is thrown, bypass was successful\r\n      } catch (error) {\r\n        // Error means the bypass was prevented\r\n        preventedCount++;\r\n      }\r\n    }\r\n\r\n    return {\r\n      prevented: preventedCount === attempts.length,\r\n      attempts: attempts.length\r\n    };\r\n  }\r\n\r\n  // Test rate limiting bypass prevention\r\n  private async testRateLimitingBypassPrevention(): Promise<{ prevented: boolean; attempts: number }> {\r\n    try {\r\n      // Register test agent\r\n      await this.security.registerAgent('rate-limit-test', ['verify'], 'MEDIUM');\r\n    } catch (error) {\r\n      // Agent might already exist\r\n    }\r\n\r\n    // Attempt rapid requests to trigger rate limiting\r\n    const rapidRequests = Array.from({ length: 100 }, (_, i) => ({\r\n      requestId: `rate-test-${i}`,\r\n      agentId: 'rate-limit-test',\r\n      truthClaim: { statement: `Test claim ${i}` },\r\n      timestamp: new Date(),\r\n      nonce: `nonce-${i}`,\r\n      signature: 'test-signature'\r\n    }));\r\n\r\n    let rateLimitTriggered = false;\r\n    let requestCount = 0;\r\n\r\n    for (const request of rapidRequests) {\r\n      try {\r\n        await this.security.processVerificationRequest(request);\r\n        requestCount++;\r\n      } catch (error) {\r\n        if (error.message.includes('rate limit') || error.message.includes('Rate limit')) {\r\n          rateLimitTriggered = true;\r\n          break;\r\n        }\r\n      }\r\n    }\r\n\r\n    return {\r\n      prevented: rateLimitTriggered,\r\n      attempts: 1\r\n    };\r\n  }\r\n\r\n  // Test cryptographic bypass prevention\r\n  private async testCryptographicBypassPrevention(): Promise<{ prevented: boolean; attempts: number }> {\r\n    try {\r\n      await this.security.registerAgent('crypto-test', ['verify'], 'HIGH');\r\n    } catch (error) {\r\n      // Agent might already exist\r\n    }\r\n\r\n    const attempts = [\r\n      // Attempt 1: Tampered signature\r\n      () => this.attemptVerificationWithTamperedSignature(),\r\n      \r\n      // Attempt 2: Replay attack\r\n      () => this.attemptReplayAttack(),\r\n      \r\n      // Attempt 3: Signature substitution\r\n      () => this.attemptSignatureSubstitution()\r\n    ];\r\n\r\n    let preventedCount = 0;\r\n    for (const attempt of attempts) {\r\n      try {\r\n        await attempt();\r\n      } catch (error) {\r\n        preventedCount++;\r\n      }\r\n    }\r\n\r\n    return {\r\n      prevented: preventedCount === attempts.length,\r\n      attempts: attempts.length\r\n    };\r\n  }\r\n\r\n  // Test Byzantine attack prevention\r\n  private async testByzantineBypassPrevention(): Promise<{ prevented: boolean; attempts: number }> {\r\n    try {\r\n      await this.security.registerAgent('byzantine-test', ['verify'], 'MEDIUM');\r\n    } catch (error) {\r\n      // Agent might already exist\r\n    }\r\n\r\n    const attempts = [\r\n      // Attempt 1: Contradictory messages\r\n      () => this.attemptContradictoryMessages(),\r\n      \r\n      // Attempt 2: Coordinated attack\r\n      () => this.attemptCoordinatedAttack(),\r\n      \r\n      // Attempt 3: Timing attack\r\n      () => this.attemptTimingAttack()\r\n    ];\r\n\r\n    let preventedCount = 0;\r\n    for (const attempt of attempts) {\r\n      try {\r\n        await attempt();\r\n      } catch (error) {\r\n        if (error.message.includes('Byzantine') || error.message.includes('byzantine')) {\r\n          preventedCount++;\r\n        }\r\n      }\r\n    }\r\n\r\n    return {\r\n      prevented: preventedCount >= 1, // At least one Byzantine attack should be detected\r\n      attempts: attempts.length\r\n    };\r\n  }\r\n\r\n  // Test audit trail bypass prevention\r\n  private async testAuditTrailBypassPrevention(): Promise<{ prevented: boolean; attempts: number }> {\r\n    const initialStatus = this.security.getSecurityStatus();\r\n    const initialAuditEntries = initialStatus.auditSummary.totalEntries;\r\n\r\n    // Perform some operations that should create audit entries\r\n    try {\r\n      await this.security.registerAgent('audit-test', ['verify'], 'LOW');\r\n    } catch (error) {\r\n      // Agent might already exist\r\n    }\r\n\r\n    const finalStatus = this.security.getSecurityStatus();\r\n    const finalAuditEntries = finalStatus.auditSummary.totalEntries;\r\n    \r\n    // Check if audit trail is being maintained\r\n    const auditTrailWorking = finalAuditEntries >= initialAuditEntries && \r\n                             finalStatus.auditSummary.integrityValid;\r\n\r\n    return {\r\n      prevented: auditTrailWorking,\r\n      attempts: 1\r\n    };\r\n  }\r\n\r\n  // Test privilege escalation prevention\r\n  private async testPrivilegeEscalationPrevention(): Promise<{ prevented: boolean; attempts: number }> {\r\n    try {\r\n      await this.security.registerAgent('low-priv-test', ['verify'], 'LOW');\r\n    } catch (error) {\r\n      // Agent might already exist\r\n    }\r\n\r\n    const attempts = [\r\n      // Attempt 1: Try to perform high-privilege operation\r\n      () => this.attemptHighPrivilegeOperation(),\r\n      \r\n      // Attempt 2: Try to escalate capabilities\r\n      () => this.attemptCapabilityEscalation()\r\n    ];\r\n\r\n    let preventedCount = 0;\r\n    for (const attempt of attempts) {\r\n      try {\r\n        await attempt();\r\n      } catch (error) {\r\n        preventedCount++;\r\n      }\r\n    }\r\n\r\n    return {\r\n      prevented: preventedCount === attempts.length,\r\n      attempts: attempts.length\r\n    };\r\n  }\r\n\r\n  // Test complete system bypass prevention\r\n  private async testCompleteSystemBypassPrevention(): Promise<{ prevented: boolean; attempts: number }> {\r\n    const attempts = [\r\n      // Attempt 1: Direct access without security\r\n      () => this.attemptDirectSystemAccess(),\r\n      \r\n      // Attempt 2: Try to disable security system\r\n      () => this.attemptSecurityDisabling(),\r\n      \r\n      // Attempt 3: Try to corrupt security state\r\n      () => this.attemptSecurityStateCorruption()\r\n    ];\r\n\r\n    let preventedCount = 0;\r\n    for (const attempt of attempts) {\r\n      try {\r\n        await attempt();\r\n      } catch (error) {\r\n        preventedCount++;\r\n      }\r\n    }\r\n\r\n    return {\r\n      prevented: preventedCount === attempts.length,\r\n      attempts: attempts.length\r\n    };\r\n  }\r\n\r\n  // Individual bypass attempt methods\r\n  private async attemptVerificationWithoutRegistration(): Promise<void> {\r\n    const request: VerificationRequest = {\r\n      requestId: 'unregistered-test',\r\n      agentId: 'non-existent-agent',\r\n      truthClaim: { statement: 'Test claim' },\r\n      timestamp: new Date(),\r\n      nonce: 'test-nonce',\r\n      signature: 'test-signature'\r\n    };\r\n\r\n    await this.security.processVerificationRequest(request);\r\n  }\r\n\r\n  private async attemptVerificationWithInvalidSignature(): Promise<void> {\r\n    await this.security.registerAgent('invalid-sig-test', ['verify'], 'MEDIUM');\r\n    \r\n    const request: VerificationRequest = {\r\n      requestId: 'invalid-sig-test',\r\n      agentId: 'invalid-sig-test',\r\n      truthClaim: { statement: 'Test claim' },\r\n      timestamp: new Date(),\r\n      nonce: 'test-nonce',\r\n      signature: 'completely-invalid-signature'\r\n    };\r\n\r\n    await this.security.processVerificationRequest(request);\r\n  }\r\n\r\n  private async attemptVerificationWithExpiredCredentials(): Promise<void> {\r\n    const request: VerificationRequest = {\r\n      requestId: 'expired-test',\r\n      agentId: 'expired-agent',\r\n      truthClaim: { statement: 'Test claim' },\r\n      timestamp: new Date(Date.now() - 10 * 60 * 1000), // 10 minutes ago\r\n      nonce: 'test-nonce',\r\n      signature: 'test-signature'\r\n    };\r\n\r\n    await this.security.processVerificationRequest(request);\r\n  }\r\n\r\n  private async attemptAgentImpersonation(): Promise<void> {\r\n    // Try to impersonate another agent\r\n    const request: VerificationRequest = {\r\n      requestId: 'impersonation-test',\r\n      agentId: 'system-admin', // Try to impersonate system admin\r\n      truthClaim: { statement: 'Admin override' },\r\n      timestamp: new Date(),\r\n      nonce: 'test-nonce',\r\n      signature: 'fake-admin-signature'\r\n    };\r\n\r\n    await this.security.processVerificationRequest(request);\r\n  }\r\n\r\n  private async attemptCredentialStuffing(): Promise<void> {\r\n    // Try multiple credential combinations rapidly\r\n    const credentials = ['admin', 'root', 'system', 'verifier', 'operator'];\r\n    \r\n    for (const cred of credentials) {\r\n      const request: VerificationRequest = {\r\n        requestId: `cred-stuff-${cred}`,\r\n        agentId: cred,\r\n        truthClaim: { statement: 'Credential stuffing attempt' },\r\n        timestamp: new Date(),\r\n        nonce: 'test-nonce',\r\n        signature: `fake-${cred}-signature`\r\n      };\r\n\r\n      await this.security.processVerificationRequest(request);\r\n    }\r\n  }\r\n\r\n  private async attemptVerificationWithTamperedSignature(): Promise<void> {\r\n    const request: VerificationRequest = {\r\n      requestId: 'tampered-sig-test',\r\n      agentId: 'crypto-test',\r\n      truthClaim: { statement: 'Original claim' },\r\n      timestamp: new Date(),\r\n      nonce: 'test-nonce',\r\n      signature: 'tampered-signature'\r\n    };\r\n\r\n    // Tamper with the truth claim after signing\r\n    request.truthClaim = { statement: 'Tampered claim' };\r\n\r\n    await this.security.processVerificationRequest(request);\r\n  }\r\n\r\n  private async attemptReplayAttack(): Promise<void> {\r\n    const originalRequest: VerificationRequest = {\r\n      requestId: 'replay-test',\r\n      agentId: 'crypto-test',\r\n      truthClaim: { statement: 'Original request' },\r\n      timestamp: new Date(),\r\n      nonce: 'original-nonce',\r\n      signature: 'original-signature'\r\n    };\r\n\r\n    // Try to replay the same request multiple times\r\n    await this.security.processVerificationRequest(originalRequest);\r\n    await this.security.processVerificationRequest(originalRequest); // This should fail\r\n  }\r\n\r\n  private async attemptSignatureSubstitution(): Promise<void> {\r\n    const request: VerificationRequest = {\r\n      requestId: 'sig-sub-test',\r\n      agentId: 'crypto-test',\r\n      truthClaim: { statement: 'Test claim' },\r\n      timestamp: new Date(),\r\n      nonce: 'test-nonce',\r\n      signature: 'substituted-signature-from-different-request'\r\n    };\r\n\r\n    await this.security.processVerificationRequest(request);\r\n  }\r\n\r\n  private async attemptContradictoryMessages(): Promise<void> {\r\n    const request1: VerificationRequest = {\r\n      requestId: 'contradiction-1',\r\n      agentId: 'byzantine-test',\r\n      truthClaim: { statement: 'The sky is blue', confidence: 1.0 },\r\n      timestamp: new Date(),\r\n      nonce: 'nonce-1',\r\n      signature: 'signature-1'\r\n    };\r\n\r\n    const request2: VerificationRequest = {\r\n      requestId: 'contradiction-2',\r\n      agentId: 'byzantine-test',\r\n      truthClaim: { statement: 'The sky is red', confidence: 1.0 },\r\n      timestamp: new Date(Date.now() + 1000),\r\n      nonce: 'nonce-2',\r\n      signature: 'signature-2'\r\n    };\r\n\r\n    await this.security.processVerificationRequest(request1);\r\n    await this.security.processVerificationRequest(request2);\r\n  }\r\n\r\n  private async attemptCoordinatedAttack(): Promise<void> {\r\n    // Simulate coordinated attack from multiple agents\r\n    const agents = ['coord-1', 'coord-2', 'coord-3'];\r\n    \r\n    for (const agent of agents) {\r\n      try {\r\n        await this.security.registerAgent(agent, ['verify'], 'MEDIUM');\r\n      } catch (error) {\r\n        // Agent might already exist\r\n      }\r\n    }\r\n\r\n    // Send identical malicious requests from all agents\r\n    const maliciousRequests = agents.map((agent, index) => ({\r\n      requestId: `coord-attack-${index}`,\r\n      agentId: agent,\r\n      truthClaim: { statement: 'Coordinated malicious claim', type: 'attack' },\r\n      timestamp: new Date(),\r\n      nonce: `coord-nonce-${index}`,\r\n      signature: `coord-signature-${index}`\r\n    }));\r\n\r\n    for (const request of maliciousRequests) {\r\n      await this.security.processVerificationRequest(request);\r\n    }\r\n  }\r\n\r\n  private async attemptTimingAttack(): Promise<void> {\r\n    // Send requests at very regular intervals (suspicious timing pattern)\r\n    const requests = Array.from({ length: 10 }, (_, i) => ({\r\n      requestId: `timing-${i}`,\r\n      agentId: 'byzantine-test',\r\n      truthClaim: { statement: `Timing attack ${i}` },\r\n      timestamp: new Date(Date.now() + i * 100), // Exactly 100ms apart\r\n      nonce: `timing-nonce-${i}`,\r\n      signature: `timing-signature-${i}`\r\n    }));\r\n\r\n    for (const request of requests) {\r\n      await this.security.processVerificationRequest(request);\r\n      await new Promise(resolve => setTimeout(resolve, 100)); // Maintain timing\r\n    }\r\n  }\r\n\r\n  private async attemptHighPrivilegeOperation(): Promise<void> {\r\n    // Try to perform operation requiring high privileges with low-privilege agent\r\n    const request: VerificationRequest = {\r\n      requestId: 'high-priv-test',\r\n      agentId: 'low-priv-test',\r\n      truthClaim: { \r\n        statement: 'System configuration change',\r\n        type: 'admin-operation',\r\n        privilegeLevel: 'CRITICAL'\r\n      },\r\n      timestamp: new Date(),\r\n      nonce: 'high-priv-nonce',\r\n      signature: 'high-priv-signature'\r\n    };\r\n\r\n    await this.security.processVerificationRequest(request);\r\n  }\r\n\r\n  private async attemptCapabilityEscalation(): Promise<void> {\r\n    // Try to use capabilities not granted to the agent\r\n    const request: VerificationRequest = {\r\n      requestId: 'capability-escalation',\r\n      agentId: 'low-priv-test',\r\n      truthClaim: { \r\n        statement: 'Attempting admin capabilities',\r\n        requestedCapabilities: ['admin', 'system', 'root']\r\n      },\r\n      timestamp: new Date(),\r\n      nonce: 'escalation-nonce',\r\n      signature: 'escalation-signature'\r\n    };\r\n\r\n    await this.security.processVerificationRequest(request);\r\n  }\r\n\r\n  private async attemptDirectSystemAccess(): Promise<void> {\r\n    // Try to access system directly without going through security\r\n    try {\r\n      // This simulates trying to access internal methods directly\r\n      (this.security as any)._directAccess = true;\r\n      \r\n      const request: VerificationRequest = {\r\n        requestId: 'direct-access',\r\n        agentId: 'direct-agent',\r\n        truthClaim: { statement: 'Direct system access' },\r\n        timestamp: new Date(),\r\n        nonce: 'direct-nonce',\r\n        signature: 'direct-signature'\r\n      };\r\n\r\n      // Try to call internal methods directly\r\n      if (typeof (this.security as any).performTruthVerification === 'function') {\r\n        await (this.security as any).performTruthVerification(request);\r\n      }\r\n    } catch (error) {\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  private async attemptSecurityDisabling(): Promise<void> {\r\n    // Try to disable the security system\r\n    try {\r\n      (this.security as any).isInitialized = false;\r\n      (this.security as any).disabled = true;\r\n      \r\n      const request: VerificationRequest = {\r\n        requestId: 'disable-security',\r\n        agentId: 'hacker-agent',\r\n        truthClaim: { statement: 'Security disabled' },\r\n        timestamp: new Date(),\r\n        nonce: 'disable-nonce',\r\n        signature: 'disable-signature'\r\n      };\r\n\r\n      await this.security.processVerificationRequest(request);\r\n    } catch (error) {\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  private async attemptSecurityStateCorruption(): Promise<void> {\r\n    // Try to corrupt internal security state\r\n    try {\r\n      if ((this.security as any).auth) {\r\n        (this.security as any).auth.agentRegistry = new Map();\r\n      }\r\n      \r\n      if ((this.security as any).byzantine) {\r\n        (this.security as any).byzantine.nodeStates = new Map();\r\n      }\r\n\r\n      const request: VerificationRequest = {\r\n        requestId: 'corrupt-state',\r\n        agentId: 'corruption-agent',\r\n        truthClaim: { statement: 'State corrupted' },\r\n        timestamp: new Date(),\r\n        nonce: 'corrupt-nonce',\r\n        signature: 'corrupt-signature'\r\n      };\r\n\r\n      await this.security.processVerificationRequest(request);\r\n    } catch (error) {\r\n      throw error;\r\n    }\r\n  }\r\n}\r\n\r\n// Export for testing\r\nexport default SecurityBypassPreventionTest;"],"names":["createHighSecuritySystem","PenetrationTestingSuite","SecurityValidationSuite","SecurityMiddlewareManager","ThreatIntelligenceMiddleware","SecurityBypassPreventionTest","security","penetrationTester","validator","middleware","setupAdvancedSecurity","threatIntel","registerMiddleware","integrateMiddleware","originalProcess","processVerificationRequest","bind","request","executeBeforeVerification","result","executeAfterVerification","error","executeErrorHandling","runBypassPreventionTest","console","log","initialize","testsPassed","testsFailed","bypassAttempts","successfulBypasses","vulnerabilities","authBypassResult","testAuthenticationBypassPrevention","prevented","push","attempts","rateLimitBypassResult","testRateLimitingBypassPrevention","cryptoBypassResult","testCryptographicBypassPrevention","byzantineBypassResult","testByzantineBypassPrevention","auditBypassResult","testAuditTrailBypassPrevention","privilegeBypassResult","testPrivilegeEscalationPrevention","systemBypassResult","testCompleteSystemBypassPrevention","securityScore","Math","round","securityAssessment","length","forEach","vuln","index","attemptVerificationWithoutRegistration","attemptVerificationWithInvalidSignature","attemptVerificationWithExpiredCredentials","attemptAgentImpersonation","attemptCredentialStuffing","preventedCount","attempt","registerAgent","rapidRequests","Array","from","_","i","requestId","agentId","truthClaim","statement","timestamp","Date","nonce","signature","rateLimitTriggered","requestCount","message","includes","attemptVerificationWithTamperedSignature","attemptReplayAttack","attemptSignatureSubstitution","attemptContradictoryMessages","attemptCoordinatedAttack","attemptTimingAttack","initialStatus","getSecurityStatus","initialAuditEntries","auditSummary","totalEntries","finalStatus","finalAuditEntries","auditTrailWorking","integrityValid","attemptHighPrivilegeOperation","attemptCapabilityEscalation","attemptDirectSystemAccess","attemptSecurityDisabling","attemptSecurityStateCorruption","now","credentials","cred","originalRequest","request1","confidence","request2","agents","agent","maliciousRequests","map","type","requests","Promise","resolve","setTimeout","privilegeLevel","requestedCapabilities","_directAccess","performTruthVerification","isInitialized","disabled","auth","agentRegistry","Map","byzantine","nodeStates"],"mappings":"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"}