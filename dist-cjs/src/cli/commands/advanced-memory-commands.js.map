{"version":3,"sources":["../../../../src/cli/commands/advanced-memory-commands.ts"],"sourcesContent":["import { getErrorMessage } from '../../utils/error-handler.js';\r\n/**\r\n * Advanced Memory Management Commands\r\n * Implements comprehensive memory operations with advanced capabilities\r\n * Converted from @cliffy to simple CLI pattern\r\n */\r\n\r\nimport { promises as fs } from 'node:fs';\r\nimport { join, extname, basename } from 'node:path';\r\nimport {\r\n  AdvancedMemoryManager,\r\n  type QueryOptions,\r\n  type ExportOptions,\r\n  type ImportOptions,\r\n  type CleanupOptions,\r\n} from '../../memory/advanced-memory-manager.js';\r\nimport { Logger } from '../../core/logger.js';\r\n\r\n// Initialize logger\r\nconst logger = Logger.getInstance();\r\n\r\n// Global memory manager instance\r\nlet memoryManager: AdvancedMemoryManager | null = null;\r\n\r\n// Helper functions\r\nfunction printSuccess(message: string): void {\r\n  console.log(`‚úÖ ${message}`);\r\n}\r\n\r\nfunction printError(message: string): void {\r\n  console.error(`‚ùå ${message}`);\r\n}\r\n\r\nfunction printWarning(message: string): void {\r\n  console.warn(`‚ö†Ô∏è  ${message}`);\r\n}\r\n\r\nfunction printInfo(message: string): void {\r\n  console.log(`‚ÑπÔ∏è  ${message}`);\r\n}\r\n\r\nfunction formatBytes(bytes: number): string {\r\n  if (bytes === 0) return '0 B';\r\n  const k = 1024;\r\n  const sizes = ['B', 'KB', 'MB', 'GB'];\r\n  const i = Math.floor(Math.log(bytes) / Math.log(k));\r\n  return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];\r\n}\r\n\r\nfunction formatDuration(ms: number): string {\r\n  if (ms < 1000) return `${ms}ms`;\r\n  if (ms < 60000) return `${(ms / 1000).toFixed(1)}s`;\r\n  return `${(ms / 60000).toFixed(1)}m`;\r\n}\r\n\r\nasync function ensureMemoryManager(): Promise<AdvancedMemoryManager> {\r\n  if (!memoryManager) {\r\n    memoryManager = new AdvancedMemoryManager(\r\n      {\r\n        maxMemorySize: 1024 * 1024 * 1024, // 1GB\r\n        autoCompress: true,\r\n        autoCleanup: true,\r\n        indexingEnabled: true,\r\n        persistenceEnabled: true,\r\n      },\r\n      logger,\r\n    );\r\n\r\n    await memoryManager.initialize();\r\n  }\r\n  return memoryManager;\r\n}\r\n\r\n// === MAIN MEMORY COMMAND ===\r\n\r\nexport async function advancedMemoryCommand(\r\n  subArgs: string[],\r\n  flags: Record<string, any>,\r\n): Promise<void> {\r\n  const subcommand = subArgs[0];\r\n\r\n  if (!subcommand) {\r\n    showAdvancedMemoryHelp();\r\n    return;\r\n  }\r\n\r\n  try {\r\n    switch (subcommand) {\r\n      case 'query':\r\n        await queryCommand(subArgs.slice(1), flags);\r\n        break;\r\n      case 'export':\r\n        await exportCommand(subArgs.slice(1), flags);\r\n        break;\r\n      case 'import':\r\n        await importCommand(subArgs.slice(1), flags);\r\n        break;\r\n      case 'stats':\r\n        await statsCommand(subArgs.slice(1), flags);\r\n        break;\r\n      case 'cleanup':\r\n        await cleanupCommand(subArgs.slice(1), flags);\r\n        break;\r\n      case 'store':\r\n        await storeCommand(subArgs.slice(1), flags);\r\n        break;\r\n      case 'get':\r\n        await getCommand(subArgs.slice(1), flags);\r\n        break;\r\n      case 'delete':\r\n        await deleteCommand(subArgs.slice(1), flags);\r\n        break;\r\n      case 'list':\r\n        await listCommand(subArgs.slice(1), flags);\r\n        break;\r\n      case 'namespaces':\r\n        await namespacesCommand(subArgs.slice(1), flags);\r\n        break;\r\n      case 'types':\r\n        await typesCommand(subArgs.slice(1), flags);\r\n        break;\r\n      case 'tags':\r\n        await tagsCommand(subArgs.slice(1), flags);\r\n        break;\r\n      case 'config':\r\n        await configCommand(subArgs.slice(1), flags);\r\n        break;\r\n      default:\r\n        printError(`Unknown command: ${subcommand}`);\r\n        showAdvancedMemoryHelp();\r\n    }\r\n  } catch (error) {\r\n    const message = getErrorMessage(error);\r\n    printError(`Command failed: ${message}`);\r\n    logger.error('Advanced memory command error', { error: message, subcommand, subArgs, flags });\r\n  }\r\n}\r\n\r\nfunction showAdvancedMemoryHelp(): void {\r\n  console.log('üß† Advanced Memory Management System\\n');\r\n  console.log('Available commands:');\r\n  console.log(\r\n    '  memory query <search> [options]     - Flexible searching with filters and aggregation',\r\n  );\r\n  console.log('  memory export <file> [options]      - Export memory data in multiple formats');\r\n  console.log(\r\n    '  memory import <file> [options]      - Import data with validation and transformation',\r\n  );\r\n  console.log(\r\n    '  memory stats [options]              - Comprehensive statistics and optimization suggestions',\r\n  );\r\n  console.log(\r\n    '  memory cleanup [options]            - Intelligent cleanup with archiving and retention',\r\n  );\r\n  console.log('  memory store <key> <value> [opts]   - Store data with advanced options');\r\n  console.log('  memory get <key> [options]          - Retrieve data with caching');\r\n  console.log('  memory delete <key> [options]       - Delete specific entries');\r\n  console.log('  memory list [options]               - List entries with filtering');\r\n  console.log('  memory namespaces                   - List all namespaces');\r\n  console.log('  memory types                        - List all data types');\r\n  console.log('  memory tags                         - List all tags');\r\n  console.log('  memory config [options]             - View/update configuration');\r\n  console.log('\\nFeatures:');\r\n  console.log('  ‚Ä¢ Advanced querying with indexing and full-text search');\r\n  console.log('  ‚Ä¢ Multiple export/import formats (JSON, CSV, XML, YAML)');\r\n  console.log('  ‚Ä¢ Intelligent cleanup with retention policies');\r\n  console.log('  ‚Ä¢ Compression and encryption support');\r\n  console.log('  ‚Ä¢ Cross-agent sharing and synchronization');\r\n  console.log('  ‚Ä¢ Performance analytics and optimization suggestions');\r\n}\r\n\r\n// === INDIVIDUAL COMMAND FUNCTIONS ===\r\n\r\nasync function queryCommand(args: string[], flags: Record<string, any>): Promise<void> {\r\n  const search = args[0];\r\n\r\n  if (!search) {\r\n    printError('Usage: memory query <search> [options]');\r\n    console.log('Options:');\r\n    console.log('  --namespace <ns>        Filter by namespace');\r\n    console.log('  --type <type>           Filter by data type');\r\n    console.log('  --tags <tags>           Filter by tags (comma-separated)');\r\n    console.log('  --owner <owner>         Filter by owner');\r\n    console.log('  --access-level <level>  Filter by access level (private|shared|public)');\r\n    console.log('  --key-pattern <pattern> Key pattern (regex)');\r\n    console.log('  --value-search <text>   Search in values');\r\n    console.log('  --full-text <text>      Full-text search');\r\n    console.log('  --created-after <date>  Created after date (ISO format)');\r\n    console.log('  --created-before <date> Created before date (ISO format)');\r\n    console.log('  --updated-after <date>  Updated after date (ISO format)');\r\n    console.log('  --updated-before <date> Updated before date (ISO format)');\r\n    console.log('  --size-gt <bytes>       Size greater than (bytes)');\r\n    console.log('  --size-lt <bytes>       Size less than (bytes)');\r\n    console.log('  --include-expired       Include expired entries');\r\n    console.log('  --limit <num>           Limit results');\r\n    console.log('  --offset <num>          Offset for pagination');\r\n    console.log(\r\n      '  --sort-by <field>       Sort by field (key|createdAt|updatedAt|lastAccessedAt|size|type)',\r\n    );\r\n    console.log('  --sort-order <order>    Sort order (asc|desc)');\r\n    console.log('  --aggregate-by <field>  Generate aggregations (namespace|type|owner|tags)');\r\n    console.log('  --include-metadata      Include full metadata in results');\r\n    console.log('  --format <format>       Output format (table|json|csv)');\r\n    return;\r\n  }\r\n\r\n  try {\r\n    const manager = await ensureMemoryManager();\r\n    const startTime = Date.now();\r\n\r\n    // Build query options from flags\r\n    const queryOptions: QueryOptions = {\r\n      fullTextSearch: search,\r\n      namespace: flags.namespace,\r\n      type: flags.type,\r\n      tags: flags.tags ? flags.tags.split(',').map((t: string) => t.trim()) : undefined,\r\n      owner: flags.owner,\r\n      accessLevel: flags['access-level'],\r\n      keyPattern: flags['key-pattern'],\r\n      valueSearch: flags['value-search'],\r\n      createdAfter: flags['created-after'] ? new Date(flags['created-after']) : undefined,\r\n      createdBefore: flags['created-before'] ? new Date(flags['created-before']) : undefined,\r\n      updatedAfter: flags['updated-after'] ? new Date(flags['updated-after']) : undefined,\r\n      updatedBefore: flags['updated-before'] ? new Date(flags['updated-before']) : undefined,\r\n      sizeGreaterThan: flags['size-gt'] ? parseInt(flags['size-gt']) : undefined,\r\n      sizeLessThan: flags['size-lt'] ? parseInt(flags['size-lt']) : undefined,\r\n      includeExpired: flags['include-expired'],\r\n      limit: flags.limit ? parseInt(flags.limit) : undefined,\r\n      offset: flags.offset ? parseInt(flags.offset) : undefined,\r\n      sortBy: flags['sort-by'],\r\n      sortOrder: flags['sort-order'] || 'asc',\r\n      aggregateBy: flags['aggregate-by'],\r\n      includeMetadata: flags['include-metadata'],\r\n    };\r\n\r\n    const result = await manager.query(queryOptions);\r\n    const duration = Date.now() - startTime;\r\n\r\n    printSuccess(`Found ${result.total} entries in ${formatDuration(duration)}`);\r\n\r\n    if (result.entries.length === 0) {\r\n      printInfo('No entries match your query criteria.');\r\n      return;\r\n    }\r\n\r\n    // Display results based on format\r\n    const format = flags.format || 'table';\r\n    switch (format) {\r\n      case 'json':\r\n        console.log(\r\n          JSON.stringify(\r\n            {\r\n              query: queryOptions,\r\n              results: result,\r\n              executionTime: duration,\r\n            },\r\n            null,\r\n            2,\r\n          ),\r\n        );\r\n        break;\r\n\r\n      case 'csv':\r\n        console.log('key,value,type,namespace,tags,size,created,updated');\r\n        for (const entry of result.entries) {\r\n          console.log(\r\n            [\r\n              entry.key,\r\n              JSON.stringify(entry.value).replace(/\"/g, '\"\"'),\r\n              entry.type,\r\n              entry.namespace,\r\n              entry.tags.join(';'),\r\n              entry.size,\r\n              entry.createdAt.toISOString(),\r\n              entry.updatedAt.toISOString(),\r\n            ].join(','),\r\n          );\r\n        }\r\n        break;\r\n\r\n      default: // table\r\n        console.log('\\nüìã Query Results:\\n');\r\n        result.entries.forEach((entry, i) => {\r\n          const value =\r\n            typeof entry.value === 'string' && entry.value.length > 100\r\n              ? entry.value.substring(0, 100) + '...'\r\n              : JSON.stringify(entry.value);\r\n\r\n          console.log(`${i + 1}. ${entry.key}`);\r\n          console.log(\r\n            `   Type: ${entry.type} | Namespace: ${entry.namespace} | Size: ${formatBytes(entry.size)}`,\r\n          );\r\n          console.log(`   Tags: [${entry.tags.join(', ')}]`);\r\n          console.log(`   Value: ${value}`);\r\n          console.log(\r\n            `   Created: ${entry.createdAt.toLocaleString()} | Updated: ${entry.updatedAt.toLocaleString()}`,\r\n          );\r\n          console.log(`   Last Accessed: ${entry.lastAccessedAt.toLocaleString()}`);\r\n\r\n          if (flags['include-metadata'] && Object.keys(entry.metadata).length > 0) {\r\n            console.log(`   Metadata: ${JSON.stringify(entry.metadata)}`);\r\n          }\r\n          console.log();\r\n        });\r\n    }\r\n\r\n    // Show aggregations if requested\r\n    if (result.aggregations) {\r\n      console.log('\\nüìä Aggregations:\\n');\r\n      for (const [key, value] of Object.entries(result.aggregations)) {\r\n        console.log(`${key}:`);\r\n        for (const [subKey, stats] of Object.entries(value as Record<string, any>)) {\r\n          console.log(`  ${subKey}: ${stats.count} entries, ${formatBytes(stats.totalSize)}`);\r\n        }\r\n        console.log();\r\n      }\r\n    }\r\n\r\n    // Show pagination info\r\n    if (result.total > result.entries.length) {\r\n      const showing = (flags.offset ? parseInt(flags.offset) : 0) + result.entries.length;\r\n      console.log(`Showing ${showing} of ${result.total} entries`);\r\n    }\r\n  } catch (error) {\r\n    const message = error instanceof Error ? error.message : String(error);\r\n    printError(`Query failed: ${message}`);\r\n    if (flags.debug) {\r\n      console.error(error);\r\n    }\r\n  }\r\n}\r\n\r\nasync function exportCommand(args: string[], flags: Record<string, any>): Promise<void> {\r\n  const file = args[0];\r\n\r\n  if (!file) {\r\n    printError('Usage: memory export <file> [options]');\r\n    console.log('Options:');\r\n    console.log('  --format <format>       Export format (json|csv|xml|yaml)');\r\n    console.log('  --namespace <namespace> Export specific namespace');\r\n    console.log('  --type <type>           Export specific type');\r\n    console.log('  --include-metadata      Include full metadata');\r\n    console.log('  --compression           Enable compression');\r\n    console.log('  --encrypt               Enable encryption');\r\n    console.log('  --encrypt-key <key>     Encryption key');\r\n    console.log('  --filter-query <json>   Advanced filtering (JSON query options)');\r\n    return;\r\n  }\r\n\r\n  try {\r\n    const manager = await ensureMemoryManager();\r\n\r\n    // Determine format from file extension if not specified\r\n    let format = flags.format;\r\n    if (!format) {\r\n      const ext = extname(file).toLowerCase();\r\n      switch (ext) {\r\n        case '.json':\r\n          format = 'json';\r\n          break;\r\n        case '.csv':\r\n          format = 'csv';\r\n          break;\r\n        case '.xml':\r\n          format = 'xml';\r\n          break;\r\n        case '.yaml':\r\n        case '.yml':\r\n          format = 'yaml';\r\n          break;\r\n        default:\r\n          format = 'json';\r\n      }\r\n    }\r\n\r\n    // Parse filter query if provided\r\n    let filtering: QueryOptions | undefined;\r\n    if (flags['filter-query']) {\r\n      try {\r\n        filtering = JSON.parse(flags['filter-query']);\r\n      } catch (error) {\r\n        printError('Invalid filter query JSON format');\r\n        return;\r\n      }\r\n    }\r\n\r\n    // Build export options\r\n    const exportOptions: ExportOptions = {\r\n      format: format as ExportOptions['format'],\r\n      namespace: flags.namespace,\r\n      type: flags.type,\r\n      includeMetadata: flags['include-metadata'],\r\n      compression: flags.compression,\r\n      encryption: flags.encrypt\r\n        ? {\r\n            enabled: true,\r\n            key: flags['encrypt-key'],\r\n          }\r\n        : undefined,\r\n      filtering,\r\n    };\r\n\r\n    printInfo(`Starting export to ${file} (format: ${format})`);\r\n    const startTime = Date.now();\r\n\r\n    const result = await manager.export(file, exportOptions);\r\n    const duration = Date.now() - startTime;\r\n\r\n    printSuccess(`Export completed in ${formatDuration(duration)}`);\r\n    console.log(`üìä Exported: ${result.entriesExported} entries`);\r\n    console.log(`üìÅ File size: ${formatBytes(result.fileSize)}`);\r\n    console.log(`üîí Checksum: ${result.checksum}`);\r\n\r\n    if (flags.compression) {\r\n      printInfo('Data was compressed during export');\r\n    }\r\n    if (flags.encrypt) {\r\n      printInfo('Data was encrypted during export');\r\n    }\r\n  } catch (error) {\r\n    printError(`Export failed: ${error instanceof Error ? error.message : String(error)}`);\r\n    if (flags.debug) {\r\n      console.error(error);\r\n    }\r\n  }\r\n}\r\n\r\nasync function importCommand(args: string[], flags: Record<string, any>): Promise<void> {\r\n  const file = args[0];\r\n\r\n  if (!file) {\r\n    printError('Usage: memory import <file> [options]');\r\n    console.log('Options:');\r\n    console.log('  --format <format>           Import format (json|csv|xml|yaml)');\r\n    console.log('  --namespace <namespace>     Target namespace for imported data');\r\n    console.log(\r\n      '  --conflict-resolution <strategy> Conflict resolution (overwrite|skip|merge|rename)',\r\n    );\r\n    console.log('  --validation                Enable data validation');\r\n    console.log('  --dry-run                   Show what would be imported without making changes');\r\n    return;\r\n  }\r\n\r\n  try {\r\n    // Check if file exists\r\n    try {\r\n      await fs.access(file);\r\n    } catch {\r\n      printError(`File not found: ${file}`);\r\n      return;\r\n    }\r\n\r\n    const manager = await ensureMemoryManager();\r\n\r\n    // Determine format from file extension if not specified\r\n    let format = flags.format;\r\n    if (!format) {\r\n      const ext = extname(file).toLowerCase();\r\n      switch (ext) {\r\n        case '.json':\r\n          format = 'json';\r\n          break;\r\n        case '.csv':\r\n          format = 'csv';\r\n          break;\r\n        case '.xml':\r\n          format = 'xml';\r\n          break;\r\n        case '.yaml':\r\n        case '.yml':\r\n          format = 'yaml';\r\n          break;\r\n        default:\r\n          printError('Cannot determine format from file extension. Please specify --format');\r\n          return;\r\n      }\r\n    }\r\n\r\n    // Build import options\r\n    const importOptions: ImportOptions = {\r\n      format: format as ImportOptions['format'],\r\n      namespace: flags.namespace,\r\n      conflictResolution: flags['conflict-resolution'] || 'skip',\r\n      validation: flags.validation,\r\n      dryRun: flags['dry-run'],\r\n    };\r\n\r\n    if (flags['dry-run']) {\r\n      printWarning('DRY RUN MODE - No changes will be made');\r\n    }\r\n\r\n    printInfo(`Starting import from ${file} (format: ${format})`);\r\n    const startTime = Date.now();\r\n\r\n    const result = await manager.import(file, importOptions);\r\n    const duration = Date.now() - startTime;\r\n\r\n    printSuccess(`Import completed in ${formatDuration(duration)}`);\r\n\r\n    if (result.entriesImported > 0) {\r\n      console.log(`üì• Imported: ${result.entriesImported} entries`);\r\n    }\r\n    if (result.entriesUpdated > 0) {\r\n      console.log(`üîÑ Updated: ${result.entriesUpdated} entries`);\r\n    }\r\n    if (result.entriesSkipped > 0) {\r\n      console.log(`‚è≠Ô∏è  Skipped: ${result.entriesSkipped} entries`);\r\n    }\r\n    if (result.conflicts.length > 0) {\r\n      console.log(`‚ö†Ô∏è  Conflicts: ${result.conflicts.length}`);\r\n      if (result.conflicts.length <= 10) {\r\n        result.conflicts.forEach((conflict) => {\r\n          console.log(`   ‚Ä¢ ${conflict}`);\r\n        });\r\n      } else {\r\n        result.conflicts.slice(0, 10).forEach((conflict) => {\r\n          console.log(`   ‚Ä¢ ${conflict}`);\r\n        });\r\n        console.log(`   ... and ${result.conflicts.length - 10} more`);\r\n      }\r\n    }\r\n  } catch (error) {\r\n    printError(`Import failed: ${error instanceof Error ? error.message : String(error)}`);\r\n    if (flags.debug) {\r\n      console.error(error);\r\n    }\r\n  }\r\n}\r\n\r\nasync function statsCommand(args: string[], flags: Record<string, any>): Promise<void> {\r\n  try {\r\n    const manager = await ensureMemoryManager();\r\n    const startTime = Date.now();\r\n\r\n    const stats = await manager.getStatistics();\r\n    const duration = Date.now() - startTime;\r\n\r\n    if (flags.format === 'json') {\r\n      const output = {\r\n        statistics: stats,\r\n        generatedAt: new Date().toISOString(),\r\n        generationTime: duration,\r\n      };\r\n\r\n      if (flags.export) {\r\n        await fs.writeFile(flags.export, JSON.stringify(output, null, 2));\r\n        printSuccess(`Statistics exported to ${flags.export}`);\r\n      } else {\r\n        console.log(JSON.stringify(output, null, 2));\r\n      }\r\n      return;\r\n    }\r\n\r\n    // Table format display\r\n    console.log('üß† Memory System Statistics\\n');\r\n\r\n    // Overview\r\n    console.log('üìä Overview:');\r\n    console.log(`   Total Entries: ${stats.overview.totalEntries.toLocaleString()}`);\r\n    console.log(`   Total Size: ${formatBytes(stats.overview.totalSize)}`);\r\n    console.log(\r\n      `   Compressed Entries: ${stats.overview.compressedEntries.toLocaleString()} (${(stats.overview.compressionRatio * 100).toFixed(1)}% compression)`,\r\n    );\r\n    console.log(`   Index Size: ${formatBytes(stats.overview.indexSize)}`);\r\n    console.log(`   Memory Usage: ${formatBytes(stats.overview.memoryUsage)}`);\r\n    console.log(`   Disk Usage: ${formatBytes(stats.overview.diskUsage)}`);\r\n    console.log();\r\n\r\n    // Distribution\r\n    console.log('üìà Distribution:');\r\n\r\n    if (Object.keys(stats.distribution.byNamespace).length > 0) {\r\n      console.log('   By Namespace:');\r\n      for (const [namespace, data] of Object.entries(stats.distribution.byNamespace)) {\r\n        console.log(`     ${namespace}: ${data.count} entries, ${formatBytes(data.size)}`);\r\n      }\r\n    }\r\n\r\n    if (Object.keys(stats.distribution.byType).length > 0) {\r\n      console.log('   By Type:');\r\n      for (const [type, data] of Object.entries(stats.distribution.byType)) {\r\n        console.log(`     ${type}: ${data.count} entries, ${formatBytes(data.size)}`);\r\n      }\r\n    }\r\n    console.log();\r\n\r\n    // Performance\r\n    console.log('‚ö° Performance:');\r\n    console.log(`   Average Query Time: ${formatDuration(stats.performance.averageQueryTime)}`);\r\n    console.log(`   Average Write Time: ${formatDuration(stats.performance.averageWriteTime)}`);\r\n    console.log(`   Cache Hit Ratio: ${(stats.performance.cacheHitRatio * 100).toFixed(1)}%`);\r\n    console.log(`   Index Efficiency: ${(stats.performance.indexEfficiency * 100).toFixed(1)}%`);\r\n    console.log();\r\n\r\n    // Health\r\n    console.log('üè• Health:');\r\n    const healthStatus = stats.health.recommendedCleanup ? 'Needs Attention' : 'Healthy';\r\n    console.log(`   Status: ${healthStatus}`);\r\n    console.log(`   Expired Entries: ${stats.health.expiredEntries}`);\r\n    console.log(`   Orphaned References: ${stats.health.orphanedReferences}`);\r\n    console.log(`   Duplicate Keys: ${stats.health.duplicateKeys}`);\r\n    console.log(`   Corrupted Entries: ${stats.health.corruptedEntries}`);\r\n    console.log();\r\n\r\n    // Optimization suggestions\r\n    if (stats.optimization.suggestions.length > 0) {\r\n      console.log('üí° Optimization Suggestions:');\r\n      stats.optimization.suggestions.forEach((suggestion) => {\r\n        console.log(`   ‚Ä¢ ${suggestion}`);\r\n      });\r\n      console.log();\r\n\r\n      console.log('üí∞ Potential Savings:');\r\n      console.log(\r\n        `   Compression: ${formatBytes(stats.optimization.potentialSavings.compression)}`,\r\n      );\r\n      console.log(`   Cleanup: ${formatBytes(stats.optimization.potentialSavings.cleanup)}`);\r\n      console.log(\r\n        `   Deduplication: ${formatBytes(stats.optimization.potentialSavings.deduplication)}`,\r\n      );\r\n      console.log();\r\n    }\r\n\r\n    console.log(`Statistics generated in ${formatDuration(duration)}`);\r\n\r\n    // Export if requested\r\n    if (flags.export) {\r\n      const output = {\r\n        statistics: stats,\r\n        generatedAt: new Date().toISOString(),\r\n        generationTime: duration,\r\n      };\r\n      await fs.writeFile(flags.export, JSON.stringify(output, null, 2));\r\n      printSuccess(`Statistics exported to ${flags.export}`);\r\n    }\r\n  } catch (error) {\r\n    printError(`Stats failed: ${error instanceof Error ? error.message : String(error)}`);\r\n    if (flags.debug) {\r\n      console.error(error);\r\n    }\r\n  }\r\n}\r\n\r\nasync function cleanupCommand(args: string[], flags: Record<string, any>): Promise<void> {\r\n  try {\r\n    const manager = await ensureMemoryManager();\r\n\r\n    if (flags['dry-run']) {\r\n      printWarning('DRY RUN MODE - No changes will be made');\r\n    }\r\n\r\n    // Build cleanup options\r\n    const cleanupOptions: CleanupOptions = {\r\n      dryRun: flags['dry-run'],\r\n      removeExpired: flags['remove-expired'] !== false,\r\n      removeOlderThan: flags['remove-older-than']\r\n        ? parseInt(flags['remove-older-than'])\r\n        : undefined,\r\n      removeUnaccessed: flags['remove-unaccessed']\r\n        ? parseInt(flags['remove-unaccessed'])\r\n        : undefined,\r\n      removeOrphaned: flags['remove-orphaned'] !== false,\r\n      removeDuplicates: flags['remove-duplicates'],\r\n      compressEligible: flags['compress-eligible'] !== false,\r\n      archiveOld: flags['archive-old']\r\n        ? {\r\n            enabled: true,\r\n            olderThan: flags['archive-older-than'] ? parseInt(flags['archive-older-than']) : 365,\r\n            archivePath: flags['archive-path'] || './memory/archive',\r\n          }\r\n        : undefined,\r\n    };\r\n\r\n    printInfo('Starting memory cleanup...');\r\n    const startTime = Date.now();\r\n\r\n    const result = await manager.cleanup(cleanupOptions);\r\n    const duration = Date.now() - startTime;\r\n\r\n    printSuccess(`Cleanup completed in ${formatDuration(duration)}`);\r\n\r\n    if (result.entriesRemoved > 0) {\r\n      console.log(`üóëÔ∏è  Removed: ${result.entriesRemoved} entries`);\r\n    }\r\n    if (result.entriesArchived > 0) {\r\n      console.log(`üì¶ Archived: ${result.entriesArchived} entries`);\r\n    }\r\n    if (result.entriesCompressed > 0) {\r\n      console.log(`üóúÔ∏è  Compressed: ${result.entriesCompressed} entries`);\r\n    }\r\n    if (result.spaceSaved > 0) {\r\n      console.log(`üíæ Space Saved: ${formatBytes(result.spaceSaved)}`);\r\n    }\r\n\r\n    if (result.actions.length > 0) {\r\n      console.log('\\nüìã Actions Performed:');\r\n      result.actions.forEach((action) => {\r\n        console.log(`   ‚Ä¢ ${action}`);\r\n      });\r\n    }\r\n\r\n    if (flags['dry-run'] && (result.entriesRemoved > 0 || result.entriesArchived > 0)) {\r\n      printInfo('Run without --dry-run to perform these actions');\r\n    }\r\n  } catch (error) {\r\n    printError(`Cleanup failed: ${error instanceof Error ? error.message : String(error)}`);\r\n    if (flags.debug) {\r\n      console.error(error);\r\n    }\r\n  }\r\n}\r\n\r\nasync function storeCommand(args: string[], flags: Record<string, any>): Promise<void> {\r\n  const key = args[0];\r\n  const value = args.slice(1).join(' ');\r\n\r\n  if (!key || !value) {\r\n    printError('Usage: memory store <key> <value> [options]');\r\n    console.log('Options:');\r\n    console.log('  --namespace <namespace> Target namespace (default: default)');\r\n    console.log('  --type <type>           Data type');\r\n    console.log('  --tags <tags>           Tags (comma-separated)');\r\n    console.log('  --owner <owner>         Entry owner (default: system)');\r\n    console.log('  --access-level <level>  Access level (private|shared|public, default: shared)');\r\n    console.log('  --ttl <ms>              Time-to-live in milliseconds');\r\n    console.log('  --compress              Force compression');\r\n    return;\r\n  }\r\n\r\n  try {\r\n    const manager = await ensureMemoryManager();\r\n\r\n    // Parse value as JSON if possible\r\n    let parsedValue;\r\n    try {\r\n      parsedValue = JSON.parse(value);\r\n    } catch {\r\n      parsedValue = value;\r\n    }\r\n\r\n    const entryId = await manager.store(key, parsedValue, {\r\n      namespace: flags.namespace || 'default',\r\n      type: flags.type,\r\n      tags: flags.tags ? flags.tags.split(',').map((t: string) => t.trim()) : undefined,\r\n      owner: flags.owner || 'system',\r\n      accessLevel: flags['access-level'] || 'shared',\r\n      ttl: flags.ttl ? parseInt(flags.ttl) : undefined,\r\n      compress: flags.compress,\r\n    });\r\n\r\n    printSuccess('Entry stored successfully');\r\n    console.log(`üìù Entry ID: ${entryId}`);\r\n    console.log(`üîë Key: ${key}`);\r\n    console.log(`üì¶ Namespace: ${flags.namespace || 'default'}`);\r\n    console.log(`üè∑Ô∏è  Type: ${flags.type || 'auto-detected'}`);\r\n\r\n    if (flags.tags) {\r\n      console.log(`üè∑Ô∏è  Tags: [${flags.tags}]`);\r\n    }\r\n    if (flags.ttl) {\r\n      const expiresAt = new Date(Date.now() + parseInt(flags.ttl));\r\n      console.log(`‚è∞ Expires: ${expiresAt.toLocaleString()}`);\r\n    }\r\n  } catch (error) {\r\n    printError(`Store failed: ${error instanceof Error ? error.message : String(error)}`);\r\n  }\r\n}\r\n\r\nasync function getCommand(args: string[], flags: Record<string, any>): Promise<void> {\r\n  const key = args[0];\r\n\r\n  if (!key) {\r\n    printError('Usage: memory get <key> [options]');\r\n    console.log('Options:');\r\n    console.log('  --namespace <namespace> Target namespace');\r\n    console.log('  --format <format>       Output format (json|pretty, default: pretty)');\r\n    return;\r\n  }\r\n\r\n  try {\r\n    const manager = await ensureMemoryManager();\r\n\r\n    const entry = await manager.retrieve(key, {\r\n      namespace: flags.namespace,\r\n      updateLastAccessed: true,\r\n    });\r\n\r\n    if (!entry) {\r\n      printWarning(`Entry not found: ${key}`);\r\n      return;\r\n    }\r\n\r\n    if (flags.format === 'json') {\r\n      console.log(JSON.stringify(entry, null, 2));\r\n    } else {\r\n      printSuccess(`Entry found: ${key}`);\r\n      console.log(`üìù Entry ID: ${entry.id}`);\r\n      console.log(`üîë Key: ${entry.key}`);\r\n      console.log(`üì¶ Namespace: ${entry.namespace}`);\r\n      console.log(`üè∑Ô∏è  Type: ${entry.type}`);\r\n      console.log(`üíæ Size: ${formatBytes(entry.size)}`);\r\n      console.log(`üìä Version: ${entry.version}`);\r\n      console.log(`üë§ Owner: ${entry.owner}`);\r\n      console.log(`üîí Access: ${entry.accessLevel}`);\r\n\r\n      if (entry.tags.length > 0) {\r\n        console.log(`üè∑Ô∏è  Tags: [${entry.tags.join(', ')}]`);\r\n      }\r\n\r\n      console.log(`üìÖ Created: ${entry.createdAt.toLocaleString()}`);\r\n      console.log(`üìÖ Updated: ${entry.updatedAt.toLocaleString()}`);\r\n      console.log(`üìÖ Last Accessed: ${entry.lastAccessedAt.toLocaleString()}`);\r\n\r\n      if (entry.expiresAt) {\r\n        console.log(`‚è∞ Expires: ${entry.expiresAt.toLocaleString()}`);\r\n      }\r\n\r\n      if (entry.compressed) {\r\n        console.log(`üóúÔ∏è  Compressed: Yes`);\r\n      }\r\n\r\n      console.log(`üíæ Value:`);\r\n      if (typeof entry.value === 'string' && entry.value.length > 500) {\r\n        console.log(entry.value.substring(0, 500) + '...');\r\n        console.log(`(showing first 500 characters of ${entry.value.length} total)`);\r\n      } else {\r\n        console.log(JSON.stringify(entry.value, null, 2));\r\n      }\r\n    }\r\n  } catch (error) {\r\n    printError(`Retrieve failed: ${error instanceof Error ? error.message : String(error)}`);\r\n  }\r\n}\r\n\r\nasync function deleteCommand(args: string[], flags: Record<string, any>): Promise<void> {\r\n  const key = args[0];\r\n\r\n  if (!key) {\r\n    printError('Usage: memory delete <key> [options]');\r\n    console.log('Options:');\r\n    console.log('  --namespace <namespace> Target namespace');\r\n    console.log('  --confirm               Skip confirmation prompt');\r\n    return;\r\n  }\r\n\r\n  try {\r\n    const manager = await ensureMemoryManager();\r\n\r\n    const entry = await manager.retrieve(key, { namespace: flags.namespace });\r\n    if (!entry) {\r\n      printWarning(`Entry not found: ${key}`);\r\n      return;\r\n    }\r\n\r\n    if (!flags.confirm) {\r\n      console.log(`About to delete entry: ${key} (namespace: ${entry.namespace})`);\r\n      console.log('Add --confirm to proceed without this prompt');\r\n      return;\r\n    }\r\n\r\n    const success = await manager.deleteEntry(entry.id);\r\n\r\n    if (success) {\r\n      printSuccess(`Entry deleted: ${key}`);\r\n    } else {\r\n      printError(`Failed to delete entry: ${key}`);\r\n    }\r\n  } catch (error) {\r\n    printError(`Delete failed: ${error instanceof Error ? error.message : String(error)}`);\r\n  }\r\n}\r\n\r\nasync function listCommand(args: string[], flags: Record<string, any>): Promise<void> {\r\n  try {\r\n    const manager = await ensureMemoryManager();\r\n\r\n    const result = await manager.query({\r\n      namespace: flags.namespace,\r\n      type: flags.type,\r\n      limit: flags.limit ? parseInt(flags.limit) : 20,\r\n      offset: flags.offset ? parseInt(flags.offset) : 0,\r\n      sortBy: flags['sort-by'] || 'updatedAt',\r\n      sortOrder: flags['sort-order'] || 'desc',\r\n    });\r\n\r\n    if (result.entries.length === 0) {\r\n      printInfo('No entries found');\r\n      return;\r\n    }\r\n\r\n    console.log(`\\nüìã Memory Entries (${result.total} total):\\n`);\r\n\r\n    result.entries.forEach((entry, i) => {\r\n      const num = (flags.offset ? parseInt(flags.offset) : 0) + i + 1;\r\n      console.log(`${num}. ${entry.key}`);\r\n      console.log(\r\n        `   Namespace: ${entry.namespace} | Type: ${entry.type} | Size: ${formatBytes(entry.size)}`,\r\n      );\r\n      console.log(`   Updated: ${entry.updatedAt.toLocaleString()}`);\r\n\r\n      if (entry.tags.length > 0) {\r\n        console.log(`   Tags: [${entry.tags.join(', ')}]`);\r\n      }\r\n      console.log();\r\n    });\r\n\r\n    if (result.total > result.entries.length) {\r\n      const showing = (flags.offset ? parseInt(flags.offset) : 0) + result.entries.length;\r\n      console.log(`Showing ${showing} of ${result.total} entries`);\r\n    }\r\n  } catch (error) {\r\n    printError(`List failed: ${error instanceof Error ? error.message : String(error)}`);\r\n  }\r\n}\r\n\r\nasync function namespacesCommand(args: string[], flags: Record<string, any>): Promise<void> {\r\n  try {\r\n    const manager = await ensureMemoryManager();\r\n    const namespaces = await manager.listNamespaces();\r\n\r\n    if (namespaces.length === 0) {\r\n      printInfo('No namespaces found');\r\n      return;\r\n    }\r\n\r\n    console.log('\\nüìÅ Namespaces:\\n');\r\n    namespaces.forEach((namespace, i) => {\r\n      console.log(`${i + 1}. ${namespace}`);\r\n    });\r\n  } catch (error) {\r\n    printError(\r\n      `Failed to list namespaces: ${error instanceof Error ? error.message : String(error)}`,\r\n    );\r\n  }\r\n}\r\n\r\nasync function typesCommand(args: string[], flags: Record<string, any>): Promise<void> {\r\n  try {\r\n    const manager = await ensureMemoryManager();\r\n    const types = await manager.listTypes();\r\n\r\n    if (types.length === 0) {\r\n      printInfo('No types found');\r\n      return;\r\n    }\r\n\r\n    console.log('\\nüè∑Ô∏è  Data Types:\\n');\r\n    types.forEach((type, i) => {\r\n      console.log(`${i + 1}. ${type}`);\r\n    });\r\n  } catch (error) {\r\n    printError(`Failed to list types: ${error instanceof Error ? error.message : String(error)}`);\r\n  }\r\n}\r\n\r\nasync function tagsCommand(args: string[], flags: Record<string, any>): Promise<void> {\r\n  try {\r\n    const manager = await ensureMemoryManager();\r\n    const tags = await manager.listTags();\r\n\r\n    if (tags.length === 0) {\r\n      printInfo('No tags found');\r\n      return;\r\n    }\r\n\r\n    console.log('\\nüè∑Ô∏è  Tags:\\n');\r\n    tags.forEach((tag, i) => {\r\n      console.log(`${i + 1}. ${tag}`);\r\n    });\r\n  } catch (error) {\r\n    printError(`Failed to list tags: ${error instanceof Error ? error.message : String(error)}`);\r\n  }\r\n}\r\n\r\nasync function configCommand(args: string[], flags: Record<string, any>): Promise<void> {\r\n  try {\r\n    const manager = await ensureMemoryManager();\r\n\r\n    if (flags.set) {\r\n      try {\r\n        const updates = JSON.parse(flags.set);\r\n        await manager.updateConfiguration(updates);\r\n        printSuccess('Configuration updated');\r\n      } catch (error) {\r\n        printError('Invalid configuration JSON format');\r\n        return;\r\n      }\r\n    }\r\n\r\n    if (flags.show || !flags.set) {\r\n      const config = manager.getConfiguration();\r\n      console.log('\\n‚öôÔ∏è  Memory System Configuration:\\n');\r\n      console.log(JSON.stringify(config, null, 2));\r\n    }\r\n  } catch (error) {\r\n    printError(\r\n      `Configuration operation failed: ${error instanceof Error ? error.message : String(error)}`,\r\n    );\r\n  }\r\n}\r\n"],"names":["getErrorMessage","promises","fs","extname","AdvancedMemoryManager","Logger","logger","getInstance","memoryManager","printSuccess","message","console","log","printError","error","printWarning","warn","printInfo","formatBytes","bytes","k","sizes","i","Math","floor","parseFloat","pow","toFixed","formatDuration","ms","ensureMemoryManager","maxMemorySize","autoCompress","autoCleanup","indexingEnabled","persistenceEnabled","initialize","advancedMemoryCommand","subArgs","flags","subcommand","showAdvancedMemoryHelp","queryCommand","slice","exportCommand","importCommand","statsCommand","cleanupCommand","storeCommand","getCommand","deleteCommand","listCommand","namespacesCommand","typesCommand","tagsCommand","configCommand","args","search","manager","startTime","Date","now","queryOptions","fullTextSearch","namespace","type","tags","split","map","t","trim","undefined","owner","accessLevel","keyPattern","valueSearch","createdAfter","createdBefore","updatedAfter","updatedBefore","sizeGreaterThan","parseInt","sizeLessThan","includeExpired","limit","offset","sortBy","sortOrder","aggregateBy","includeMetadata","result","query","duration","total","entries","length","format","JSON","stringify","results","executionTime","entry","key","value","replace","join","size","createdAt","toISOString","updatedAt","forEach","substring","toLocaleString","lastAccessedAt","Object","keys","metadata","aggregations","subKey","stats","count","totalSize","showing","Error","String","debug","file","ext","toLowerCase","filtering","parse","exportOptions","compression","encryption","encrypt","enabled","export","entriesExported","fileSize","checksum","access","importOptions","conflictResolution","validation","dryRun","import","entriesImported","entriesUpdated","entriesSkipped","conflicts","conflict","getStatistics","output","statistics","generatedAt","generationTime","writeFile","overview","totalEntries","compressedEntries","compressionRatio","indexSize","memoryUsage","diskUsage","distribution","byNamespace","data","byType","performance","averageQueryTime","averageWriteTime","cacheHitRatio","indexEfficiency","healthStatus","health","recommendedCleanup","expiredEntries","orphanedReferences","duplicateKeys","corruptedEntries","optimization","suggestions","suggestion","potentialSavings","cleanup","deduplication","cleanupOptions","removeExpired","removeOlderThan","removeUnaccessed","removeOrphaned","removeDuplicates","compressEligible","archiveOld","olderThan","archivePath","entriesRemoved","entriesArchived","entriesCompressed","spaceSaved","actions","action","parsedValue","entryId","store","ttl","compress","expiresAt","retrieve","updateLastAccessed","id","version","compressed","confirm","success","deleteEntry","num","namespaces","listNamespaces","types","listTypes","listTags","tag","set","updates","updateConfiguration","show","config","getConfiguration"],"mappings":"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"}