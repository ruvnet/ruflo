{"version":3,"sources":["../../../../../../src/cli/simple-commands/init/validation/health-checker.js"],"sourcesContent":["import { promises as fs } from 'fs';\r\n// health-checker.js - System health checks for SPARC initialization\r\n\r\nexport class HealthChecker {\r\n  constructor(workingDir) {\r\n    this.workingDir = workingDir;\r\n  }\r\n\r\n  /**\r\n   * Check SPARC mode availability\r\n   */\r\n  async checkModeAvailability() {\r\n    const result = {\r\n      success: true,\r\n      errors: [],\r\n      warnings: [],\r\n      modes: {\r\n        total: 0,\r\n        available: 0,\r\n        unavailable: [],\r\n      },\r\n    };\r\n\r\n    try {\r\n      // Get expected modes\r\n      const expectedModes = [\r\n        'architect',\r\n        'code',\r\n        'tdd',\r\n        'spec-pseudocode',\r\n        'integration',\r\n        'debug',\r\n        'security-review',\r\n        'refinement-optimization-mode',\r\n        'docs-writer',\r\n        'devops',\r\n        'mcp',\r\n        'swarm',\r\n      ];\r\n\r\n      result.modes.total = expectedModes.length;\r\n\r\n      // Check each mode\r\n      for (const mode of expectedModes) {\r\n        const isAvailable = await this.checkSingleModeAvailability(mode);\r\n        if (isAvailable) {\r\n          result.modes.available++;\r\n        } else {\r\n          result.modes.unavailable.push(mode);\r\n        }\r\n      }\r\n\r\n      // Determine overall success\r\n      if (result.modes.available === 0) {\r\n        result.success = false;\r\n        result.errors.push('No SPARC modes are available');\r\n      } else if (result.modes.unavailable.length > 0) {\r\n        result.warnings.push(\r\n          `${result.modes.unavailable.length} modes unavailable: ${result.modes.unavailable.join(', ')}`,\r\n        );\r\n      }\r\n    } catch (error) {\r\n      result.success = false;\r\n      result.errors.push(`Mode availability check failed: ${error.message}`);\r\n    }\r\n\r\n    return result;\r\n  }\r\n\r\n  /**\r\n   * Check template integrity\r\n   */\r\n  async checkTemplateIntegrity() {\r\n    const result = {\r\n      success: true,\r\n      errors: [],\r\n      warnings: [],\r\n      templates: {\r\n        found: [],\r\n        missing: [],\r\n        corrupted: [],\r\n      },\r\n    };\r\n\r\n    try {\r\n      // Check for template directories\r\n      const templateDirs = ['.roo/templates', '.claude/commands'];\r\n\r\n      for (const dir of templateDirs) {\r\n        const dirPath = `${this.workingDir}/${dir}`;\r\n\r\n        try {\r\n          const stat = await Deno.stat(dirPath);\r\n          if (stat.isDirectory) {\r\n            const templateCheck = await this.checkTemplateDirectory(dirPath);\r\n            result.templates.found.push(...templateCheck.found);\r\n            result.templates.missing.push(...templateCheck.missing);\r\n            result.templates.corrupted.push(...templateCheck.corrupted);\r\n          }\r\n        } catch {\r\n          result.templates.missing.push(dir);\r\n        }\r\n      }\r\n\r\n      // Check core template files\r\n      const coreTemplates = ['CLAUDE.md', 'memory-bank.md', 'coordination.md'];\r\n\r\n      for (const template of coreTemplates) {\r\n        const templatePath = `${this.workingDir}/${template}`;\r\n\r\n        try {\r\n          const content = await fs.readFile(templatePath, 'utf8');\r\n          if (content.length < 50) {\r\n            result.templates.corrupted.push(template);\r\n          } else {\r\n            result.templates.found.push(template);\r\n          }\r\n        } catch {\r\n          result.templates.missing.push(template);\r\n        }\r\n      }\r\n\r\n      // Assess results\r\n      if (result.templates.corrupted.length > 0) {\r\n        result.success = false;\r\n        result.errors.push(`Corrupted templates: ${result.templates.corrupted.join(', ')}`);\r\n      }\r\n\r\n      if (result.templates.missing.length > 0) {\r\n        result.warnings.push(`Missing templates: ${result.templates.missing.join(', ')}`);\r\n      }\r\n    } catch (error) {\r\n      result.success = false;\r\n      result.errors.push(`Template integrity check failed: ${error.message}`);\r\n    }\r\n\r\n    return result;\r\n  }\r\n\r\n  /**\r\n   * Check configuration consistency\r\n   */\r\n  async checkConfigConsistency() {\r\n    const result = {\r\n      success: true,\r\n      errors: [],\r\n      warnings: [],\r\n      consistency: {},\r\n    };\r\n\r\n    try {\r\n      // Check consistency between .roomodes and available commands\r\n      const roomodesCheck = await this.checkRoomodesConsistency();\r\n      result.consistency.roomodes = roomodesCheck;\r\n      if (!roomodesCheck.consistent) {\r\n        result.warnings.push('Inconsistency between .roomodes and available commands');\r\n      }\r\n\r\n      // Check consistency between CLAUDE.md and actual setup\r\n      const claudeCheck = await this.checkClaudeConfigConsistency();\r\n      result.consistency.claude = claudeCheck;\r\n      if (!claudeCheck.consistent) {\r\n        result.warnings.push('Inconsistency between CLAUDE.md and actual setup');\r\n      }\r\n\r\n      // Check memory configuration consistency\r\n      const memoryCheck = await this.checkMemoryConsistency();\r\n      result.consistency.memory = memoryCheck;\r\n      if (!memoryCheck.consistent) {\r\n        result.warnings.push('Memory configuration inconsistency detected');\r\n      }\r\n    } catch (error) {\r\n      result.success = false;\r\n      result.errors.push(`Configuration consistency check failed: ${error.message}`);\r\n    }\r\n\r\n    return result;\r\n  }\r\n\r\n  /**\r\n   * Check system resources\r\n   */\r\n  async checkSystemResources() {\r\n    const result = {\r\n      success: true,\r\n      errors: [],\r\n      warnings: [],\r\n      resources: {},\r\n    };\r\n\r\n    try {\r\n      // Check disk space\r\n      const diskCheck = await this.checkDiskSpace();\r\n      result.resources.disk = diskCheck;\r\n      if (!diskCheck.adequate) {\r\n        result.warnings.push('Low disk space detected');\r\n      }\r\n\r\n      // Check memory usage\r\n      const memoryCheck = await this.checkMemoryUsage();\r\n      result.resources.memory = memoryCheck;\r\n      if (!memoryCheck.adequate) {\r\n        result.warnings.push('High memory usage detected');\r\n      }\r\n\r\n      // Check file descriptors\r\n      const fdCheck = await this.checkFileDescriptors();\r\n      result.resources.fileDescriptors = fdCheck;\r\n      if (!fdCheck.adequate) {\r\n        result.warnings.push('Many open file descriptors');\r\n      }\r\n\r\n      // Check process limits\r\n      const processCheck = await this.checkProcessLimits();\r\n      result.resources.processes = processCheck;\r\n      if (!processCheck.adequate) {\r\n        result.warnings.push('Process limits may affect operation');\r\n      }\r\n    } catch (error) {\r\n      result.warnings.push(`System resource check failed: ${error.message}`);\r\n    }\r\n\r\n    return result;\r\n  }\r\n\r\n  /**\r\n   * Run comprehensive health diagnostics\r\n   */\r\n  async runDiagnostics() {\r\n    const result = {\r\n      success: true,\r\n      errors: [],\r\n      warnings: [],\r\n      diagnostics: {},\r\n      timestamp: new Date().toISOString(),\r\n    };\r\n\r\n    try {\r\n      // File system health\r\n      const fsHealth = await this.checkFileSystemHealth();\r\n      result.diagnostics.filesystem = fsHealth;\r\n      if (!fsHealth.healthy) {\r\n        result.success = false;\r\n        result.errors.push(...fsHealth.errors);\r\n      }\r\n\r\n      // Process health\r\n      const processHealth = await this.checkProcessHealth();\r\n      result.diagnostics.processes = processHealth;\r\n      if (!processHealth.healthy) {\r\n        result.warnings.push(...processHealth.warnings);\r\n      }\r\n\r\n      // Network health (for external dependencies)\r\n      const networkHealth = await this.checkNetworkHealth();\r\n      result.diagnostics.network = networkHealth;\r\n      if (!networkHealth.healthy) {\r\n        result.warnings.push(...networkHealth.warnings);\r\n      }\r\n\r\n      // Integration health\r\n      const integrationHealth = await this.checkIntegrationHealth();\r\n      result.diagnostics.integration = integrationHealth;\r\n      if (!integrationHealth.healthy) {\r\n        result.warnings.push(...integrationHealth.warnings);\r\n      }\r\n    } catch (error) {\r\n      result.success = false;\r\n      result.errors.push(`Health diagnostics failed: ${error.message}`);\r\n    }\r\n\r\n    return result;\r\n  }\r\n\r\n  // Helper methods\r\n\r\n  async checkSingleModeAvailability(mode) {\r\n    try {\r\n      // Check if mode exists in .roomodes\r\n      const roomodesPath = `${this.workingDir}/.roomodes`;\r\n      const content = await fs.readFile(roomodesPath, 'utf8');\r\n      const config = JSON.parse(content);\r\n\r\n      return !!(config.modes && config.modes[mode]);\r\n    } catch {\r\n      return false;\r\n    }\r\n  }\r\n\r\n  async checkTemplateDirectory(dirPath) {\r\n    const result = {\r\n      found: [],\r\n      missing: [],\r\n      corrupted: [],\r\n    };\r\n\r\n    try {\r\n      for await (const entry of Deno.readDir(dirPath)) {\r\n        if (entry.isFile) {\r\n          const filePath = `${dirPath}/${entry.name}`;\r\n\r\n          try {\r\n            const stat = await Deno.stat(filePath);\r\n            if (stat.size === 0) {\r\n              result.corrupted.push(entry.name);\r\n            } else {\r\n              result.found.push(entry.name);\r\n            }\r\n          } catch {\r\n            result.corrupted.push(entry.name);\r\n          }\r\n        }\r\n      }\r\n    } catch {\r\n      // Directory not accessible\r\n    }\r\n\r\n    return result;\r\n  }\r\n\r\n  async checkRoomodesConsistency() {\r\n    const result = {\r\n      consistent: true,\r\n      issues: [],\r\n    };\r\n\r\n    try {\r\n      // Compare .roomodes with slash commands\r\n      const roomodesPath = `${this.workingDir}/.roomodes`;\r\n      const content = await fs.readFile(roomodesPath, 'utf8');\r\n      const config = JSON.parse(content);\r\n\r\n      if (config.modes) {\r\n        const commandsDir = `${this.workingDir}/.claude/commands`;\r\n\r\n        try {\r\n          const commandFiles = [];\r\n          for await (const entry of Deno.readDir(commandsDir)) {\r\n            if (entry.isFile && entry.name.endsWith('.js')) {\r\n              commandFiles.push(entry.name.replace('.js', ''));\r\n            }\r\n          }\r\n\r\n          const modeNames = Object.keys(config.modes);\r\n          for (const mode of modeNames) {\r\n            if (!commandFiles.some((cmd) => cmd.includes(mode))) {\r\n              result.consistent = false;\r\n              result.issues.push(`Mode ${mode} has no corresponding command`);\r\n            }\r\n          }\r\n        } catch {\r\n          result.consistent = false;\r\n          result.issues.push('Cannot access commands directory');\r\n        }\r\n      }\r\n    } catch {\r\n      result.consistent = false;\r\n      result.issues.push('Cannot read .roomodes file');\r\n    }\r\n\r\n    return result;\r\n  }\r\n\r\n  async checkClaudeConfigConsistency() {\r\n    const result = {\r\n      consistent: true,\r\n      issues: [],\r\n    };\r\n\r\n    try {\r\n      const claudePath = `${this.workingDir}/CLAUDE.md`;\r\n      const content = await fs.readFile(claudePath, 'utf8');\r\n\r\n      // Check if mentioned commands exist\r\n      const mentionedCommands = ['claude-flow sparc', 'npm run build', 'npm run test'];\r\n\r\n      for (const command of mentionedCommands) {\r\n        if (content.includes(command)) {\r\n          // Check if the command is actually available\r\n          const parts = command.split(' ');\r\n          if (parts[0] === 'claude-flow') {\r\n            const executablePath = `${this.workingDir}/claude-flow`;\r\n            try {\r\n              await Deno.stat(executablePath);\r\n            } catch {\r\n              result.consistent = false;\r\n              result.issues.push(`Command ${command} mentioned but executable not found`);\r\n            }\r\n          }\r\n        }\r\n      }\r\n    } catch {\r\n      result.consistent = false;\r\n      result.issues.push('Cannot read CLAUDE.md');\r\n    }\r\n\r\n    return result;\r\n  }\r\n\r\n  async checkMemoryConsistency() {\r\n    const result = {\r\n      consistent: true,\r\n      issues: [],\r\n    };\r\n\r\n    try {\r\n      // Check if memory structure matches documentation\r\n      const memoryDataPath = `${this.workingDir}/memory/claude-flow-data.json`;\r\n      const data = JSON.parse(await fs.readFile(memoryDataPath, 'utf8'));\r\n\r\n      // Basic structure validation\r\n      if (!data.agents || !data.tasks) {\r\n        result.consistent = false;\r\n        result.issues.push('Memory data structure incomplete');\r\n      }\r\n\r\n      // Check directory structure\r\n      const expectedDirs = ['agents', 'sessions'];\r\n      for (const dir of expectedDirs) {\r\n        try {\r\n          await Deno.stat(`${this.workingDir}/memory/${dir}`);\r\n        } catch {\r\n          result.consistent = false;\r\n          result.issues.push(`Memory directory missing: ${dir}`);\r\n        }\r\n      }\r\n    } catch {\r\n      result.consistent = false;\r\n      result.issues.push('Cannot validate memory structure');\r\n    }\r\n\r\n    return result;\r\n  }\r\n\r\n  async checkDiskSpace() {\r\n    const result = {\r\n      adequate: true,\r\n      available: 0,\r\n      used: 0,\r\n    };\r\n\r\n    try {\r\n      const command = new Deno.Command('df', {\r\n        args: ['-k', this.workingDir],\r\n        stdout: 'piped',\r\n      });\r\n\r\n      const { stdout, success } = await command.output();\r\n\r\n      if (success) {\r\n        const output = new TextDecoder().decode(stdout);\r\n        const lines = output.trim().split('\\n');\r\n\r\n        if (lines.length >= 2) {\r\n          const parts = lines[1].split(/\\s+/);\r\n          if (parts.length >= 4) {\r\n            result.available = parseInt(parts[3]) / 1024; // MB\r\n            result.used = parseInt(parts[2]) / 1024; // MB\r\n            result.adequate = result.available > 100; // At least 100MB\r\n          }\r\n        }\r\n      }\r\n    } catch {\r\n      // Can't check - assume adequate\r\n      result.adequate = true;\r\n    }\r\n\r\n    return result;\r\n  }\r\n\r\n  async checkMemoryUsage() {\r\n    const result = {\r\n      adequate: true,\r\n      available: 0,\r\n      used: 0,\r\n    };\r\n\r\n    try {\r\n      // This is a simplified check - could be enhanced\r\n      const command = new Deno.Command('free', {\r\n        args: ['-m'],\r\n        stdout: 'piped',\r\n      });\r\n\r\n      const { stdout, success } = await command.output();\r\n\r\n      if (success) {\r\n        const output = new TextDecoder().decode(stdout);\r\n        const lines = output.trim().split('\\n');\r\n\r\n        for (const line of lines) {\r\n          if (line.startsWith('Mem:')) {\r\n            const parts = line.split(/\\s+/);\r\n            if (parts.length >= 3) {\r\n              result.available = parseInt(parts[6] || parts[3]); // Available\r\n              result.used = parseInt(parts[2]); // Used\r\n              result.adequate = result.available > 100; // At least 100MB\r\n            }\r\n            break;\r\n          }\r\n        }\r\n      }\r\n    } catch {\r\n      // Can't check - assume adequate\r\n      result.adequate = true;\r\n    }\r\n\r\n    return result;\r\n  }\r\n\r\n  async checkFileDescriptors() {\r\n    const result = {\r\n      adequate: true,\r\n      open: 0,\r\n      limit: 0,\r\n    };\r\n\r\n    try {\r\n      // Check current process file descriptors\r\n      const command = new Deno.Command('sh', {\r\n        args: ['-c', 'lsof -p $$ | wc -l'],\r\n        stdout: 'piped',\r\n      });\r\n\r\n      const { stdout, success } = await command.output();\r\n\r\n      if (success) {\r\n        const count = parseInt(new TextDecoder().decode(stdout).trim());\r\n        result.open = count;\r\n        result.adequate = count < 100; // Arbitrary threshold\r\n      }\r\n    } catch {\r\n      // Can't check - assume adequate\r\n      result.adequate = true;\r\n    }\r\n\r\n    return result;\r\n  }\r\n\r\n  async checkProcessLimits() {\r\n    const result = {\r\n      adequate: true,\r\n      limits: {},\r\n    };\r\n\r\n    try {\r\n      const command = new Deno.Command('ulimit', {\r\n        args: ['-a'],\r\n        stdout: 'piped',\r\n      });\r\n\r\n      const { stdout, success } = await command.output();\r\n\r\n      if (success) {\r\n        const output = new TextDecoder().decode(stdout);\r\n        // Parse ulimit output for important limits\r\n        result.adequate = !output.includes('0'); // Very basic check\r\n      }\r\n    } catch {\r\n      // Can't check - assume adequate\r\n      result.adequate = true;\r\n    }\r\n\r\n    return result;\r\n  }\r\n\r\n  async checkFileSystemHealth() {\r\n    return {\r\n      healthy: true,\r\n      errors: [],\r\n      readWrite: true,\r\n      permissions: true,\r\n    };\r\n  }\r\n\r\n  async checkProcessHealth() {\r\n    return {\r\n      healthy: true,\r\n      warnings: [],\r\n      processes: [],\r\n    };\r\n  }\r\n\r\n  async checkNetworkHealth() {\r\n    return {\r\n      healthy: true,\r\n      warnings: [],\r\n      connectivity: true,\r\n    };\r\n  }\r\n\r\n  async checkIntegrationHealth() {\r\n    return {\r\n      healthy: true,\r\n      warnings: [],\r\n      integrations: {},\r\n    };\r\n  }\r\n}\r\n"],"names":["promises","fs","HealthChecker","workingDir","checkModeAvailability","result","success","errors","warnings","modes","total","available","unavailable","expectedModes","length","mode","isAvailable","checkSingleModeAvailability","push","join","error","message","checkTemplateIntegrity","templates","found","missing","corrupted","templateDirs","dir","dirPath","stat","Deno","isDirectory","templateCheck","checkTemplateDirectory","coreTemplates","template","templatePath","content","readFile","checkConfigConsistency","consistency","roomodesCheck","checkRoomodesConsistency","roomodes","consistent","claudeCheck","checkClaudeConfigConsistency","claude","memoryCheck","checkMemoryConsistency","memory","checkSystemResources","resources","diskCheck","checkDiskSpace","disk","adequate","checkMemoryUsage","fdCheck","checkFileDescriptors","fileDescriptors","processCheck","checkProcessLimits","processes","runDiagnostics","diagnostics","timestamp","Date","toISOString","fsHealth","checkFileSystemHealth","filesystem","healthy","processHealth","checkProcessHealth","networkHealth","checkNetworkHealth","network","integrationHealth","checkIntegrationHealth","integration","roomodesPath","config","JSON","parse","entry","readDir","isFile","filePath","name","size","issues","commandsDir","commandFiles","endsWith","replace","modeNames","Object","keys","some","cmd","includes","claudePath","mentionedCommands","command","parts","split","executablePath","memoryDataPath","data","agents","tasks","expectedDirs","used","Command","args","stdout","output","TextDecoder","decode","lines","trim","parseInt","line","startsWith","open","limit","count","limits","readWrite","permissions","connectivity","integrations"],"mappings":"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"}