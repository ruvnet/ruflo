{"version":3,"sources":["../../../src/migration/index.ts"],"sourcesContent":["#!/usr/bin/env node\r\n/**\r\n * Claude-Flow Migration Tool\r\n * Helps existing projects migrate to optimized prompts and configurations\r\n */\r\n\r\nimport { Command } from '@cliffy/command';\r\nimport { MigrationRunner } from './migration-runner.js';\r\nimport { MigrationAnalyzer } from './migration-analyzer.js';\r\nimport type { MigrationStrategy } from './types.js';\r\nimport { logger } from './logger.js';\r\nimport * as chalk from 'chalk';\r\nimport * as path from 'path';\r\n\r\nconst program = new Command();\r\n\r\nprogram\r\n  .name('claude-flow-migrate')\r\n  .description('Migrate existing claude-flow projects to optimized prompts')\r\n  .version('1.0.0');\r\n\r\nprogram\r\n  .command('analyze [path]')\r\n  .description('Analyze existing project for migration readiness')\r\n  .option('-d, --detailed', 'Show detailed analysis')\r\n  .option('-o, --output <file>', 'Output analysis to file')\r\n  .action(async (projectPath = '.', options) => {\r\n    try {\r\n      const analyzer = new MigrationAnalyzer();\r\n      const analysis = await analyzer.analyze(path.resolve(projectPath));\r\n\r\n      if (options.output) {\r\n        await analyzer.saveAnalysis(analysis, options.output);\r\n        logger.success(`Analysis saved to ${options.output}`);\r\n      }\r\n\r\n      analyzer.printAnalysis(analysis, options.detailed);\r\n    } catch (error) {\r\n      logger.error('Analysis failed:', error);\r\n      process.exit(1);\r\n    }\r\n  });\r\n\r\nprogram\r\n  .command('migrate [path]')\r\n  .description('Migrate project to optimized prompts')\r\n  .option('-s, --strategy <type>', 'Migration strategy: full, selective, merge', 'selective')\r\n  .option('-b, --backup <dir>', 'Backup directory', '.claude-backup')\r\n  .option('-f, --force', 'Force migration without prompts')\r\n  .option('--dry-run', 'Simulate migration without making changes')\r\n  .option('--preserve-custom', 'Preserve custom commands and configurations')\r\n  .option('--skip-validation', 'Skip post-migration validation')\r\n  .action(async (projectPath = '.', options) => {\r\n    try {\r\n      const runner = new MigrationRunner({\r\n        projectPath: path.resolve(projectPath),\r\n        strategy: options.strategy as MigrationStrategy,\r\n        backupDir: options.backup,\r\n        force: options.force,\r\n        dryRun: options.dryRun,\r\n        preserveCustom: options.preserveCustom,\r\n        skipValidation: options.skipValidation,\r\n      });\r\n\r\n      await runner.run();\r\n    } catch (error) {\r\n      logger.error('Migration failed:', error);\r\n      process.exit(1);\r\n    }\r\n  });\r\n\r\nprogram\r\n  .command('rollback [path]')\r\n  .description('Rollback to previous configuration')\r\n  .option('-b, --backup <dir>', 'Backup directory to restore from', '.claude-backup')\r\n  .option('-t, --timestamp <time>', 'Restore from specific timestamp')\r\n  .option('-f, --force', 'Force rollback without prompts')\r\n  .action(async (projectPath = '.', options) => {\r\n    try {\r\n      const runner = new MigrationRunner({\r\n        projectPath: path.resolve(projectPath),\r\n        strategy: 'full',\r\n        backupDir: options.backup,\r\n        force: options.force,\r\n      });\r\n\r\n      await runner.rollback(options.timestamp);\r\n    } catch (error) {\r\n      logger.error('Rollback failed:', error);\r\n      process.exit(1);\r\n    }\r\n  });\r\n\r\nprogram\r\n  .command('validate [path]')\r\n  .description('Validate migration was successful')\r\n  .option('-v, --verbose', 'Show detailed validation results')\r\n  .action(async (projectPath = '.', options) => {\r\n    try {\r\n      const runner = new MigrationRunner({\r\n        projectPath: path.resolve(projectPath),\r\n        strategy: 'full',\r\n      });\r\n\r\n      const isValid = await runner.validate(options.verbose);\r\n\r\n      if (isValid) {\r\n        logger.success('Migration validated successfully!');\r\n      } else {\r\n        logger.error('Migration validation failed');\r\n        process.exit(1);\r\n      }\r\n    } catch (error) {\r\n      logger.error('Validation failed:', error);\r\n      process.exit(1);\r\n    }\r\n  });\r\n\r\nprogram\r\n  .command('list-backups [path]')\r\n  .description('List available backups')\r\n  .option('-b, --backup <dir>', 'Backup directory', '.claude-backup')\r\n  .action(async (projectPath = '.', options) => {\r\n    try {\r\n      const runner = new MigrationRunner({\r\n        projectPath: path.resolve(projectPath),\r\n        strategy: 'full',\r\n        backupDir: options.backup,\r\n      });\r\n\r\n      await runner.listBackups();\r\n    } catch (error) {\r\n      logger.error('Failed to list backups:', error);\r\n      process.exit(1);\r\n    }\r\n  });\r\n\r\n// Show help if no command provided\r\nif (!process.argv.slice(2).length) {\r\n  program.outputHelp();\r\n}\r\n\r\nprogram.parse(process.argv);\r\n"],"names":["Command","MigrationRunner","MigrationAnalyzer","logger","path","program","name","description","version","command","option","action","projectPath","options","analyzer","analysis","analyze","resolve","output","saveAnalysis","success","printAnalysis","detailed","error","process","exit","runner","strategy","backupDir","backup","force","dryRun","preserveCustom","skipValidation","run","rollback","timestamp","isValid","validate","verbose","listBackups","argv","slice","length","outputHelp","parse"],"mappings":"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"}