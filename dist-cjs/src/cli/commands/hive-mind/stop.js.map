{"version":3,"sources":["../../../../../src/cli/commands/hive-mind/stop.ts"],"sourcesContent":["#!/usr/bin/env node\r\n/**\r\n * Hive Mind Stop Command\r\n *\r\n * Stop active swarm sessions and terminate child processes\r\n */\r\n\r\nimport { Command } from '../commander-fix.js';\r\nimport chalk from 'chalk';\r\nimport { HiveMindSessionManager } from '../../simple-commands/hive-mind/session-manager.js';\r\nimport inquirer from 'inquirer';\r\n\r\nexport const stopCommand = new Command('stop')\r\n  .description('Stop active hive mind sessions')\r\n  .option('-s, --session <id>', 'Stop specific session by ID')\r\n  .option('-a, --all', 'Stop all active sessions')\r\n  .option('-f, --force', 'Force stop without confirmation')\r\n  .action(async (options) => {\r\n    const sessionManager = new HiveMindSessionManager();\r\n\r\n    try {\r\n      if (options.all) {\r\n        // Stop all active sessions\r\n        const sessions = await sessionManager.getActiveSessionsWithProcessInfo();\r\n\r\n        if (sessions.length === 0) {\r\n          console.log(chalk.yellow('No active sessions found'));\r\n          return;\r\n        }\r\n\r\n        if (!options.force) {\r\n          const { confirm } = await inquirer.prompt([\r\n            {\r\n              type: 'confirm',\r\n              name: 'confirm',\r\n              message: `Stop all ${sessions.length} active session(s)?`,\r\n              default: false,\r\n            },\r\n          ]);\r\n\r\n          if (!confirm) {\r\n            console.log(chalk.gray('Operation cancelled'));\r\n            return;\r\n          }\r\n        }\r\n\r\n        for (const session of sessions) {\r\n          console.log(chalk.cyan(`Stopping session ${session.id}...`));\r\n          await sessionManager.stopSession(session.id);\r\n          console.log(chalk.green(`✓ Session ${session.id} stopped`));\r\n        }\r\n\r\n        console.log(chalk.green(`\\n✅ All sessions stopped successfully`));\r\n      } else if (options.session) {\r\n        // Stop specific session\r\n        const sessionId = options.session;\r\n        const session = await sessionManager.getSession(sessionId);\r\n\r\n        if (!session) {\r\n          console.log(chalk.red(`Session ${sessionId} not found`));\r\n          return;\r\n        }\r\n\r\n        if ((session as any).status === 'stopped') {\r\n          console.log(chalk.yellow(`Session ${sessionId} is already stopped`));\r\n          return;\r\n        }\r\n\r\n        if (!options.force) {\r\n          const { confirm } = await inquirer.prompt([\r\n            {\r\n              type: 'confirm',\r\n              name: 'confirm',\r\n              message: `Stop session ${sessionId} (${(session as any).swarm_name || 'Unknown'})?`,\r\n              default: false,\r\n            },\r\n          ]);\r\n\r\n          if (!confirm) {\r\n            console.log(chalk.gray('Operation cancelled'));\r\n            return;\r\n          }\r\n        }\r\n\r\n        console.log(chalk.cyan(`Stopping session ${sessionId}...`));\r\n        await sessionManager.stopSession(sessionId);\r\n        console.log(chalk.green(`✓ Session ${sessionId} stopped successfully`));\r\n      } else {\r\n        // Interactive selection\r\n        const sessions = await sessionManager.getActiveSessionsWithProcessInfo();\r\n\r\n        if (sessions.length === 0) {\r\n          console.log(chalk.yellow('No active sessions found'));\r\n          return;\r\n        }\r\n\r\n        const { sessionId } = await inquirer.prompt([\r\n          {\r\n            type: 'list',\r\n            name: 'sessionId',\r\n            message: 'Select session to stop:',\r\n            choices: sessions.map((s: any) => ({\r\n              name: `${s.swarm_name} (${s.id}) - ${s.total_processes} process(es)`,\r\n              value: s.id,\r\n            })),\r\n          },\r\n        ]);\r\n\r\n        const { confirm } = await inquirer.prompt([\r\n          {\r\n            type: 'confirm',\r\n            name: 'confirm',\r\n            message: 'Stop this session?',\r\n            default: false,\r\n          },\r\n        ]);\r\n\r\n        if (!confirm) {\r\n          console.log(chalk.gray('Operation cancelled'));\r\n          return;\r\n        }\r\n\r\n        console.log(chalk.cyan(`Stopping session ${sessionId}...`));\r\n        await sessionManager.stopSession(sessionId);\r\n        console.log(chalk.green(`✓ Session stopped successfully`));\r\n      }\r\n\r\n      // Clean up orphaned processes\r\n      const cleanedCount = sessionManager.cleanupOrphanedProcesses();\r\n      if (cleanedCount > 0) {\r\n        console.log(chalk.blue(`\\nCleaned up ${cleanedCount} orphaned session(s)`));\r\n      }\r\n    } catch (error) {\r\n      console.error(chalk.red('Error stopping session:'), (error as Error).message);\r\n      process.exit(1);\r\n    } finally {\r\n      sessionManager.close();\r\n    }\r\n  });\r\n"],"names":["Command","chalk","HiveMindSessionManager","inquirer","stopCommand","description","option","action","options","sessionManager","all","sessions","getActiveSessionsWithProcessInfo","length","console","log","yellow","force","confirm","prompt","type","name","message","default","gray","session","cyan","id","stopSession","green","sessionId","getSession","red","status","swarm_name","choices","map","s","total_processes","value","cleanedCount","cleanupOrphanedProcesses","blue","error","process","exit","close"],"mappings":"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"}