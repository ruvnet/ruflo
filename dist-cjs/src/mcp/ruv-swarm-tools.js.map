{"version":3,"sources":["../../../src/mcp/ruv-swarm-tools.ts"],"sourcesContent":["/**\r\n * ruv-swarm MCP tools wrapper for Claude Code integration\r\n *\r\n * This module provides MCP tools that integrate with the external ruv-swarm\r\n * package to enable advanced swarm coordination and neural capabilities.\r\n */\r\n\r\nimport type { MCPTool, MCPContext } from '../utils/types.js';\r\nimport type { ILogger } from '../core/logger.js';\r\nimport { execAsync } from '../utils/helpers.js';\r\nimport { existsSync } from 'fs';\r\nimport { join } from 'path';\r\n\r\n// Import error fixes for agent_metrics, swarm_monitor, neural_train\r\nlet errorFixes: any;\r\ntry {\r\n  errorFixes = require('./fixes/mcp-error-fixes.js');\r\n} catch (e) {\r\n  // Fallback if module not found\r\n  errorFixes = {\r\n    fixAgentMetrics: (d: any) => d,\r\n    fixSwarmMonitor: (d: any) => d,\r\n    fixNeuralTrain: (d: any) => d,\r\n    wrapRuvSwarmResponse: (n: string, d: any) => d,\r\n  };\r\n}\r\n\r\nexport interface RuvSwarmToolContext extends MCPContext {\r\n  workingDirectory?: string;\r\n  swarmId?: string;\r\n  sessionId?: string;\r\n}\r\n\r\n/**\r\n * Interface for ruv-swarm command responses\r\n */\r\ninterface RuvSwarmResponse {\r\n  success: boolean;\r\n  data?: any;\r\n  error?: string;\r\n  metadata?: {\r\n    timestamp: number;\r\n    swarmId?: string;\r\n    sessionId?: string;\r\n    performance?: any;\r\n  };\r\n}\r\n\r\n/**\r\n * Execute ruv-swarm command with proper error handling\r\n */\r\nasync function executeRuvSwarmCommand(\r\n  command: string,\r\n  args: string[] = [],\r\n  context?: RuvSwarmToolContext,\r\n  logger?: ILogger,\r\n): Promise<RuvSwarmResponse> {\r\n  try {\r\n    const workDir = context?.workingDirectory || process.cwd();\r\n    const fullCommand = `npx ruv-swarm ${command} ${args.join(' ')}`;\r\n\r\n    logger?.debug('Executing ruv-swarm command', { command: fullCommand, workDir });\r\n\r\n    const result = await execAsync(fullCommand, { cwd: workDir });\r\n\r\n    // Parse JSON response if possible\r\n    let data;\r\n    try {\r\n      data = JSON.parse(result.stdout);\r\n    } catch {\r\n      data = { output: result.stdout, stderr: result.stderr };\r\n    }\r\n\r\n    logger?.debug('ruv-swarm command completed', { command, success: true });\r\n\r\n    return {\r\n      success: true,\r\n      data,\r\n      metadata: {\r\n        timestamp: Date.now(),\r\n        swarmId: context?.swarmId,\r\n        sessionId: context?.sessionId,\r\n      },\r\n    };\r\n  } catch (error) {\r\n    logger?.error('ruv-swarm command failed', {\r\n      command,\r\n      error: error instanceof Error ? error.message : String(error),\r\n    });\r\n\r\n    return {\r\n      success: false,\r\n      error: error instanceof Error ? error.message : String(error),\r\n      metadata: {\r\n        timestamp: Date.now(),\r\n        swarmId: context?.swarmId,\r\n        sessionId: context?.sessionId,\r\n      },\r\n    };\r\n  }\r\n}\r\n\r\n/**\r\n * Create ruv-swarm MCP tools for Claude Code integration\r\n *\r\n * These tools provide access to the full ruv-swarm functionality including:\r\n * - Swarm initialization and management\r\n * - Neural agent coordination\r\n * - Memory and persistence\r\n * - Performance monitoring\r\n * - Task orchestration\r\n */\r\nexport function createRuvSwarmTools(logger: ILogger): MCPTool[] {\r\n  return [\r\n    // === SWARM LIFECYCLE TOOLS ===\r\n    {\r\n      name: 'mcp__ruv-swarm__swarm_init',\r\n      description: 'Initialize a new ruv-swarm with specified topology and configuration',\r\n      inputSchema: {\r\n        type: 'object',\r\n        properties: {\r\n          topology: {\r\n            type: 'string',\r\n            enum: ['mesh', 'hierarchical', 'ring', 'star'],\r\n            description: 'Swarm topology type',\r\n          },\r\n          maxAgents: {\r\n            type: 'number',\r\n            minimum: 1,\r\n            maximum: 100,\r\n            default: 5,\r\n            description: 'Maximum number of agents',\r\n          },\r\n          strategy: {\r\n            type: 'string',\r\n            enum: ['balanced', 'specialized', 'adaptive'],\r\n            default: 'balanced',\r\n            description: 'Distribution strategy',\r\n          },\r\n        },\r\n        required: ['topology'],\r\n      },\r\n      handler: async (input: any, context?: RuvSwarmToolContext) => {\r\n        const args = [\r\n          '--topology',\r\n          input.topology,\r\n          '--max-agents',\r\n          String(input.maxAgents || 5),\r\n          '--strategy',\r\n          input.strategy || 'balanced',\r\n        ];\r\n\r\n        return await executeRuvSwarmCommand('swarm init', args, context, logger);\r\n      },\r\n    },\r\n\r\n    {\r\n      name: 'mcp__ruv-swarm__swarm_status',\r\n      description: 'Get current swarm status and agent information',\r\n      inputSchema: {\r\n        type: 'object',\r\n        properties: {\r\n          verbose: {\r\n            type: 'boolean',\r\n            default: false,\r\n            description: 'Include detailed agent information',\r\n          },\r\n        },\r\n      },\r\n      handler: async (input: any, context?: RuvSwarmToolContext) => {\r\n        const args = input.verbose ? ['--verbose'] : [];\r\n        return await executeRuvSwarmCommand('swarm status', args, context, logger);\r\n      },\r\n    },\r\n\r\n    {\r\n      name: 'mcp__ruv-swarm__swarm_monitor',\r\n      description: 'Monitor swarm activity in real-time',\r\n      inputSchema: {\r\n        type: 'object',\r\n        properties: {\r\n          duration: {\r\n            type: 'number',\r\n            default: 10,\r\n            description: 'Monitoring duration in seconds',\r\n          },\r\n          interval: {\r\n            type: 'number',\r\n            default: 1,\r\n            description: 'Update interval in seconds',\r\n          },\r\n        },\r\n      },\r\n      handler: async (input: any, context?: RuvSwarmToolContext) => {\r\n        const args = [\r\n          '--duration',\r\n          String(input.duration || 10),\r\n          '--interval',\r\n          String(input.interval || 1),\r\n        ];\r\n\r\n        const result = await executeRuvSwarmCommand('swarm monitor', args, context, logger);\r\n        // Apply fix to ensure recentEvents is an array\r\n        return errorFixes.fixSwarmMonitor(result);\r\n      },\r\n    },\r\n\r\n    // === AGENT MANAGEMENT TOOLS ===\r\n    {\r\n      name: 'mcp__ruv-swarm__agent_spawn',\r\n      description: 'Spawn a new agent in the swarm',\r\n      inputSchema: {\r\n        type: 'object',\r\n        properties: {\r\n          type: {\r\n            type: 'string',\r\n            enum: [\r\n              'coordinator',\r\n              'researcher',\r\n              'coder',\r\n              'analyst',\r\n              'architect',\r\n              'tester',\r\n              'reviewer',\r\n              'optimizer',\r\n              'documenter',\r\n              'monitor',\r\n              'specialist',\r\n            ],\r\n            description: 'Agent type',\r\n          },\r\n          name: {\r\n            type: 'string',\r\n            description: 'Custom agent name',\r\n          },\r\n          capabilities: {\r\n            type: 'array',\r\n            items: { type: 'string' },\r\n            description: 'Agent capabilities',\r\n          },\r\n        },\r\n        required: ['type'],\r\n      },\r\n      handler: async (input: any, context?: RuvSwarmToolContext) => {\r\n        const args = ['--type', input.type];\r\n\r\n        if (input.name) {\r\n          args.push('--name', input.name);\r\n        }\r\n\r\n        if (input.capabilities && input.capabilities.length > 0) {\r\n          args.push('--capabilities', input.capabilities.join(','));\r\n        }\r\n\r\n        return await executeRuvSwarmCommand('agent spawn', args, context, logger);\r\n      },\r\n    },\r\n\r\n    {\r\n      name: 'mcp__ruv-swarm__agent_list',\r\n      description: 'List all active agents in the swarm',\r\n      inputSchema: {\r\n        type: 'object',\r\n        properties: {\r\n          filter: {\r\n            type: 'string',\r\n            enum: ['all', 'active', 'idle', 'busy'],\r\n            default: 'all',\r\n            description: 'Filter agents by status',\r\n          },\r\n        },\r\n      },\r\n      handler: async (input: any, context?: RuvSwarmToolContext) => {\r\n        const args = ['--filter', input.filter || 'all'];\r\n        return await executeRuvSwarmCommand('agent list', args, context, logger);\r\n      },\r\n    },\r\n\r\n    {\r\n      name: 'mcp__ruv-swarm__agent_metrics',\r\n      description: 'Get performance metrics for agents',\r\n      inputSchema: {\r\n        type: 'object',\r\n        properties: {\r\n          agentId: {\r\n            type: 'string',\r\n            description: 'Specific agent ID (optional)',\r\n          },\r\n          metric: {\r\n            type: 'string',\r\n            enum: ['all', 'cpu', 'memory', 'tasks', 'performance'],\r\n            default: 'all',\r\n          },\r\n        },\r\n      },\r\n      handler: async (input: any, context?: RuvSwarmToolContext) => {\r\n        const args = ['--metric', input.metric || 'all'];\r\n\r\n        if (input.agentId) {\r\n          args.push('--agent-id', input.agentId);\r\n        }\r\n\r\n        const result = await executeRuvSwarmCommand('agent metrics', args, context, logger);\r\n        // Apply fix to ensure neuralNetworks is an array\r\n        return errorFixes.fixAgentMetrics(result);\r\n      },\r\n    },\r\n\r\n    // === TASK ORCHESTRATION TOOLS ===\r\n    {\r\n      name: 'mcp__ruv-swarm__task_orchestrate',\r\n      description: 'Orchestrate a task across the swarm',\r\n      inputSchema: {\r\n        type: 'object',\r\n        properties: {\r\n          task: {\r\n            type: 'string',\r\n            description: 'Task description or instructions',\r\n          },\r\n          strategy: {\r\n            type: 'string',\r\n            enum: ['parallel', 'sequential', 'adaptive'],\r\n            default: 'adaptive',\r\n            description: 'Execution strategy',\r\n          },\r\n          priority: {\r\n            type: 'string',\r\n            enum: ['low', 'medium', 'high', 'critical'],\r\n            default: 'medium',\r\n            description: 'Task priority',\r\n          },\r\n          maxAgents: {\r\n            type: 'number',\r\n            minimum: 1,\r\n            maximum: 10,\r\n            description: 'Maximum agents to use',\r\n          },\r\n        },\r\n        required: ['task'],\r\n      },\r\n      handler: async (input: any, context?: RuvSwarmToolContext) => {\r\n        const args = [\r\n          '--task',\r\n          JSON.stringify(input.task),\r\n          '--strategy',\r\n          input.strategy || 'adaptive',\r\n          '--priority',\r\n          input.priority || 'medium',\r\n        ];\r\n\r\n        if (input.maxAgents) {\r\n          args.push('--max-agents', String(input.maxAgents));\r\n        }\r\n\r\n        return await executeRuvSwarmCommand('task orchestrate', args, context, logger);\r\n      },\r\n    },\r\n\r\n    {\r\n      name: 'mcp__ruv-swarm__task_status',\r\n      description: 'Check progress of running tasks',\r\n      inputSchema: {\r\n        type: 'object',\r\n        properties: {\r\n          taskId: {\r\n            type: 'string',\r\n            description: 'Specific task ID (optional)',\r\n          },\r\n          detailed: {\r\n            type: 'boolean',\r\n            default: false,\r\n            description: 'Include detailed progress',\r\n          },\r\n        },\r\n      },\r\n      handler: async (input: any, context?: RuvSwarmToolContext) => {\r\n        const args = [];\r\n\r\n        if (input.taskId) {\r\n          args.push('--task-id', input.taskId);\r\n        }\r\n\r\n        if (input.detailed) {\r\n          args.push('--detailed');\r\n        }\r\n\r\n        return await executeRuvSwarmCommand('task status', args, context, logger);\r\n      },\r\n    },\r\n\r\n    {\r\n      name: 'mcp__ruv-swarm__task_results',\r\n      description: 'Retrieve results from completed tasks',\r\n      inputSchema: {\r\n        type: 'object',\r\n        properties: {\r\n          taskId: {\r\n            type: 'string',\r\n            description: 'Task ID to retrieve results for',\r\n          },\r\n          format: {\r\n            type: 'string',\r\n            enum: ['summary', 'detailed', 'raw'],\r\n            default: 'summary',\r\n            description: 'Result format',\r\n          },\r\n        },\r\n        required: ['taskId'],\r\n      },\r\n      handler: async (input: any, context?: RuvSwarmToolContext) => {\r\n        const args = ['--task-id', input.taskId, '--format', input.format || 'summary'];\r\n\r\n        return await executeRuvSwarmCommand('task results', args, context, logger);\r\n      },\r\n    },\r\n\r\n    // === MEMORY AND PERSISTENCE TOOLS ===\r\n    {\r\n      name: 'mcp__ruv-swarm__memory_usage',\r\n      description: 'Get current memory usage statistics',\r\n      inputSchema: {\r\n        type: 'object',\r\n        properties: {\r\n          detail: {\r\n            type: 'string',\r\n            enum: ['summary', 'detailed', 'by-agent'],\r\n            default: 'summary',\r\n            description: 'Detail level',\r\n          },\r\n        },\r\n      },\r\n      handler: async (input: any, context?: RuvSwarmToolContext) => {\r\n        const args = ['--detail', input.detail || 'summary'];\r\n        return await executeRuvSwarmCommand('memory usage', args, context, logger);\r\n      },\r\n    },\r\n\r\n    // === NEURAL CAPABILITIES TOOLS ===\r\n    {\r\n      name: 'mcp__ruv-swarm__neural_status',\r\n      description: 'Get neural agent status and performance metrics',\r\n      inputSchema: {\r\n        type: 'object',\r\n        properties: {\r\n          agentId: {\r\n            type: 'string',\r\n            description: 'Specific agent ID (optional)',\r\n          },\r\n        },\r\n      },\r\n      handler: async (input: any, context?: RuvSwarmToolContext) => {\r\n        const args = [];\r\n\r\n        if (input.agentId) {\r\n          args.push('--agent-id', input.agentId);\r\n        }\r\n\r\n        return await executeRuvSwarmCommand('neural status', args, context, logger);\r\n      },\r\n    },\r\n\r\n    {\r\n      name: 'mcp__ruv-swarm__neural_train',\r\n      description: 'Train neural agents with sample tasks',\r\n      inputSchema: {\r\n        type: 'object',\r\n        properties: {\r\n          agentId: {\r\n            type: 'string',\r\n            description: 'Specific agent ID to train (optional)',\r\n          },\r\n          iterations: {\r\n            type: 'number',\r\n            minimum: 1,\r\n            maximum: 100,\r\n            default: 10,\r\n            description: 'Number of training iterations',\r\n          },\r\n        },\r\n      },\r\n      handler: async (input: any, context?: RuvSwarmToolContext) => {\r\n        // Apply fix to ensure agentId is valid\r\n        const fixedInput = errorFixes.fixNeuralTrain(input);\r\n        const args = ['--iterations', String(fixedInput.iterations || 10)];\r\n\r\n        if (fixedInput.agentId) {\r\n          args.push('--agent-id', fixedInput.agentId);\r\n        }\r\n\r\n        return await executeRuvSwarmCommand('neural train', args, context, logger);\r\n      },\r\n    },\r\n\r\n    {\r\n      name: 'mcp__ruv-swarm__neural_patterns',\r\n      description: 'Get cognitive pattern information',\r\n      inputSchema: {\r\n        type: 'object',\r\n        properties: {\r\n          pattern: {\r\n            type: 'string',\r\n            enum: ['all', 'convergent', 'divergent', 'lateral', 'systems', 'critical', 'abstract'],\r\n            default: 'all',\r\n            description: 'Cognitive pattern type',\r\n          },\r\n        },\r\n      },\r\n      handler: async (input: any, context?: RuvSwarmToolContext) => {\r\n        const args = ['--pattern', input.pattern || 'all'];\r\n        return await executeRuvSwarmCommand('neural patterns', args, context, logger);\r\n      },\r\n    },\r\n\r\n    // === PERFORMANCE AND BENCHMARKING TOOLS ===\r\n    {\r\n      name: 'mcp__ruv-swarm__benchmark_run',\r\n      description: 'Execute performance benchmarks',\r\n      inputSchema: {\r\n        type: 'object',\r\n        properties: {\r\n          type: {\r\n            type: 'string',\r\n            enum: ['all', 'wasm', 'swarm', 'agent', 'task'],\r\n            default: 'all',\r\n            description: 'Benchmark type',\r\n          },\r\n          iterations: {\r\n            type: 'number',\r\n            minimum: 1,\r\n            maximum: 100,\r\n            default: 10,\r\n            description: 'Number of iterations',\r\n          },\r\n        },\r\n      },\r\n      handler: async (input: any, context?: RuvSwarmToolContext) => {\r\n        const args = [\r\n          '--type',\r\n          input.type || 'all',\r\n          '--iterations',\r\n          String(input.iterations || 10),\r\n        ];\r\n\r\n        return await executeRuvSwarmCommand('benchmark run', args, context, logger);\r\n      },\r\n    },\r\n\r\n    {\r\n      name: 'mcp__ruv-swarm__features_detect',\r\n      description: 'Detect runtime features and capabilities',\r\n      inputSchema: {\r\n        type: 'object',\r\n        properties: {\r\n          category: {\r\n            type: 'string',\r\n            enum: ['all', 'wasm', 'simd', 'memory', 'platform'],\r\n            default: 'all',\r\n            description: 'Feature category',\r\n          },\r\n        },\r\n      },\r\n      handler: async (input: any, context?: RuvSwarmToolContext) => {\r\n        const args = ['--category', input.category || 'all'];\r\n        return await executeRuvSwarmCommand('features detect', args, context, logger);\r\n      },\r\n    },\r\n  ];\r\n}\r\n\r\n/**\r\n * Check if ruv-swarm is available in the current environment\r\n */\r\nexport async function isRuvSwarmAvailable(logger?: ILogger): Promise<boolean> {\r\n  try {\r\n    const result = await executeRuvSwarmCommand('--version', [], undefined, logger);\r\n    return result.success;\r\n  } catch (error) {\r\n    logger?.warn('ruv-swarm not available', {\r\n      error:\r\n        error instanceof Error ? (error instanceof Error ? error.message : String(error)) : error,\r\n    });\r\n    return false;\r\n  }\r\n}\r\n\r\n/**\r\n * Get ruv-swarm configuration and capabilities\r\n */\r\nexport async function getRuvSwarmCapabilities(logger?: ILogger): Promise<any> {\r\n  try {\r\n    const result = await executeRuvSwarmCommand(\r\n      'features detect',\r\n      ['--category', 'all'],\r\n      undefined,\r\n      logger,\r\n    );\r\n    return result.data;\r\n  } catch (error) {\r\n    logger?.error('Failed to get ruv-swarm capabilities', error);\r\n    return null;\r\n  }\r\n}\r\n\r\n/**\r\n * Initialize ruv-swarm with claude-code-flow integration\r\n */\r\nexport async function initializeRuvSwarmIntegration(\r\n  workingDirectory: string,\r\n  logger?: ILogger,\r\n): Promise<RuvSwarmResponse> {\r\n  const context: RuvSwarmToolContext = {\r\n    workingDirectory,\r\n    sessionId: `claude-flow-${Date.now()}`,\r\n  };\r\n\r\n  logger?.info('Initializing ruv-swarm integration', { workingDirectory });\r\n\r\n  // Check if ruv-swarm is available\r\n  const available = await isRuvSwarmAvailable(logger);\r\n  if (!available) {\r\n    return {\r\n      success: false,\r\n      error: 'ruv-swarm is not available. Please install it with: npm install -g ruv-swarm',\r\n    };\r\n  }\r\n\r\n  // Get capabilities\r\n  const capabilities = await getRuvSwarmCapabilities(logger);\r\n\r\n  logger?.info('ruv-swarm integration initialized', { capabilities });\r\n\r\n  return {\r\n    success: true,\r\n    data: {\r\n      available: true,\r\n      capabilities,\r\n      integration: 'claude-code-flow',\r\n      sessionId: context.sessionId,\r\n    },\r\n    metadata: {\r\n      timestamp: Date.now(),\r\n      sessionId: context.sessionId,\r\n    },\r\n  };\r\n}\r\n\r\nexport default {\r\n  createRuvSwarmTools,\r\n  isRuvSwarmAvailable,\r\n  getRuvSwarmCapabilities,\r\n  initializeRuvSwarmIntegration,\r\n};\r\n"],"names":["execAsync","errorFixes","require","e","fixAgentMetrics","d","fixSwarmMonitor","fixNeuralTrain","wrapRuvSwarmResponse","n","executeRuvSwarmCommand","command","args","context","logger","workDir","workingDirectory","process","cwd","fullCommand","join","debug","result","data","JSON","parse","stdout","output","stderr","success","metadata","timestamp","Date","now","swarmId","sessionId","error","Error","message","String","createRuvSwarmTools","name","description","inputSchema","type","properties","topology","enum","maxAgents","minimum","maximum","default","strategy","required","handler","input","verbose","duration","interval","capabilities","items","push","length","filter","agentId","metric","task","priority","stringify","taskId","detailed","format","detail","iterations","fixedInput","pattern","category","isRuvSwarmAvailable","undefined","warn","getRuvSwarmCapabilities","initializeRuvSwarmIntegration","info","available","integration"],"mappings":"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"}