{"version":3,"sources":["../../../../../src/cli/commands/hive-mind/task.ts"],"sourcesContent":["#!/usr/bin/env node\r\n/**\r\n * Hive Mind Task Command\r\n *\r\n * Submit tasks to the Hive Mind for collective processing\r\n * with automatic agent assignment and consensus coordination.\r\n */\r\n\r\nimport { Command } from '../commander-fix.js';\r\nimport chalk from 'chalk';\r\nimport ora from 'ora';\r\nimport inquirer from 'inquirer';\r\nimport { HiveMind } from '../../../hive-mind/core/HiveMind.js';\r\nimport { TaskPriority, TaskStrategy } from '../../../hive-mind/types.js';\r\nimport { formatSuccess, formatError, formatInfo, formatWarning } from '../../formatter.js';\r\nimport { DatabaseManager } from '../../../hive-mind/core/DatabaseManager.js';\r\n\r\nexport const taskCommand = new Command('task')\r\n  .description('Submit and manage tasks in the Hive Mind')\r\n  .argument('[description]', 'Task description')\r\n  .option('-s, --swarm-id <id>', 'Target swarm ID')\r\n  .option('-p, --priority <level>', 'Task priority (low, medium, high, critical)', 'medium')\r\n  .option(\r\n    '-t, --strategy <type>',\r\n    'Execution strategy (parallel, sequential, adaptive, consensus)',\r\n    'adaptive',\r\n  )\r\n  .option('-d, --dependencies <ids>', 'Comma-separated list of dependent task IDs')\r\n  .option('-a, --assign-to <agent>', 'Assign to specific agent')\r\n  .option('-r, --require-consensus', 'Require consensus for this task', false)\r\n  .option('-m, --max-agents <number>', 'Maximum agents to assign', '3')\r\n  .option('-i, --interactive', 'Interactive task creation', false)\r\n  .option('-w, --watch', 'Watch task progress', false)\r\n  .option('-l, --list', 'List all tasks', false)\r\n  .option('--cancel <id>', 'Cancel a specific task')\r\n  .option('--retry <id>', 'Retry a failed task')\r\n  .action(async (description, options) => {\r\n    try {\r\n      // Get swarm ID\r\n      const swarmId = options.swarmId || (await getActiveSwarmId());\r\n      if (!swarmId) {\r\n        throw new Error('No active swarm found. Initialize a Hive Mind first.');\r\n      }\r\n\r\n      // Load Hive Mind\r\n      const hiveMind = await HiveMind.load(swarmId);\r\n\r\n      // Handle special operations\r\n      if (options.list) {\r\n        await listTasks(hiveMind);\r\n        return;\r\n      }\r\n\r\n      if (options.cancel) {\r\n        await cancelTask(hiveMind, options.cancel);\r\n        return;\r\n      }\r\n\r\n      if (options.retry) {\r\n        await retryTask(hiveMind, options.retry);\r\n        return;\r\n      }\r\n\r\n      // Interactive mode\r\n      if (options.interactive || !description) {\r\n        const answers = await inquirer.prompt([\r\n          {\r\n            type: 'input',\r\n            name: 'description',\r\n            message: 'Enter task description:',\r\n            when: !description,\r\n            validate: (input) => input.length > 0 || 'Task description is required',\r\n          },\r\n          {\r\n            type: 'list',\r\n            name: 'priority',\r\n            message: 'Select task priority:',\r\n            choices: ['low', 'medium', 'high', 'critical'],\r\n            default: options.priority,\r\n          },\r\n          {\r\n            type: 'list',\r\n            name: 'strategy',\r\n            message: 'Select execution strategy:',\r\n            choices: [\r\n              { name: 'Adaptive (AI-optimized)', value: 'adaptive' },\r\n              { name: 'Parallel (Fast, multiple agents)', value: 'parallel' },\r\n              { name: 'Sequential (Step-by-step)', value: 'sequential' },\r\n              { name: 'Consensus (Requires agreement)', value: 'consensus' },\r\n            ],\r\n            default: options.strategy,\r\n          },\r\n          {\r\n            type: 'confirm',\r\n            name: 'requireConsensus',\r\n            message: 'Require consensus for critical decisions?',\r\n            default: options.requireConsensus,\r\n            when: (answers) => answers.strategy !== 'consensus',\r\n          },\r\n          {\r\n            type: 'number',\r\n            name: 'maxAgents',\r\n            message: 'Maximum agents to assign:',\r\n            default: parseInt(options.maxAgents, 10),\r\n            validate: (input) => (input > 0 && input <= 10) || 'Must be between 1 and 10',\r\n          },\r\n          {\r\n            type: 'checkbox',\r\n            name: 'capabilities',\r\n            message: 'Required agent capabilities:',\r\n            choices: [\r\n              'code_generation',\r\n              'research',\r\n              'analysis',\r\n              'testing',\r\n              'optimization',\r\n              'documentation',\r\n              'architecture',\r\n              'review',\r\n            ],\r\n          },\r\n        ]);\r\n\r\n        description = description || answers.description;\r\n        options.priority = answers.priority || options.priority;\r\n        options.strategy = answers.strategy || options.strategy;\r\n        options.requireConsensus = answers.requireConsensus || options.requireConsensus;\r\n        options.maxAgents = answers.maxAgents || options.maxAgents;\r\n        options.requiredCapabilities = answers.capabilities;\r\n      }\r\n\r\n      const spinner = ora('Submitting task to Hive Mind...').start();\r\n\r\n      // Parse dependencies\r\n      const dependencies = options.dependencies\r\n        ? options.dependencies.split(',').map((id: string) => id.trim())\r\n        : [];\r\n\r\n      // Submit task\r\n      const task = await hiveMind.submitTask({\r\n        description,\r\n        priority: options.priority as TaskPriority,\r\n        strategy: options.strategy as TaskStrategy,\r\n        dependencies,\r\n        assignTo: options.assignTo,\r\n        requireConsensus: options.requireConsensus,\r\n        maxAgents: parseInt(options.maxAgents, 10),\r\n        requiredCapabilities: options.requiredCapabilities || [],\r\n        metadata: {\r\n          submittedBy: 'cli',\r\n          submittedAt: new Date(),\r\n        },\r\n      });\r\n\r\n      spinner.succeed(formatSuccess('Task submitted successfully!'));\r\n\r\n      // Display task details\r\n      console.log('\\n' + chalk.bold('ðŸ“‹ Task Details:'));\r\n      console.log(formatInfo(`Task ID: ${task.id}`));\r\n      console.log(formatInfo(`Description: ${task.description}`));\r\n      console.log(formatInfo(`Priority: ${getPriorityBadge(task.priority)} ${task.priority}`));\r\n      console.log(formatInfo(`Strategy: ${task.strategy}`));\r\n      console.log(formatInfo(`Status: ${task.status}`));\r\n\r\n      if (task.assignedAgents.length > 0) {\r\n        console.log(formatInfo(`Assigned to: ${task.assignedAgents.join(', ')}`));\r\n      }\r\n\r\n      // Watch mode\r\n      if (options.watch) {\r\n        console.log('\\n' + chalk.bold('ðŸ‘€ Watching task progress...'));\r\n        await watchTaskProgress(hiveMind, task.id);\r\n      } else {\r\n        console.log(\r\n          '\\n' + chalk.gray(`Track progress: ruv-swarm hive-mind task --watch ${task.id}`),\r\n        );\r\n      }\r\n    } catch (error) {\r\n      console.error(formatError('Failed to submit task'));\r\n      console.error(formatError((error as Error).message));\r\n      process.exit(1);\r\n    }\r\n  });\r\n\r\nasync function getActiveSwarmId(): Promise<string | null> {\r\n  const db = await DatabaseManager.getInstance();\r\n  return db.getActiveSwarmId();\r\n}\r\n\r\nasync function listTasks(hiveMind: HiveMind) {\r\n  const tasks = await hiveMind.getTasks();\r\n\r\n  if (tasks.length === 0) {\r\n    console.log(formatInfo('No tasks found.'));\r\n    return;\r\n  }\r\n\r\n  console.log('\\n' + chalk.bold('ðŸ“‹ Task List:'));\r\n  const Table = require('cli-table3');\r\n  const table = new Table({\r\n    head: ['ID', 'Description', 'Priority', 'Status', 'Progress', 'Agents'],\r\n    style: { head: ['cyan'] },\r\n  });\r\n\r\n  tasks.forEach((task) => {\r\n    table.push([\r\n      task.id.substring(0, 8),\r\n      task.description.substring(0, 40) + (task.description.length > 40 ? '...' : ''),\r\n      getPriorityBadge(task.priority),\r\n      getTaskStatusBadge(task.status),\r\n      `${task.progress}%`,\r\n      task.assignedAgents.length,\r\n    ]);\r\n  });\r\n\r\n  console.log(table.toString());\r\n}\r\n\r\nasync function cancelTask(hiveMind: HiveMind, taskId: string) {\r\n  const spinner = ora('Cancelling task...').start();\r\n\r\n  try {\r\n    await hiveMind.cancelTask(taskId);\r\n    spinner.succeed(formatSuccess('Task cancelled successfully!'));\r\n  } catch (error) {\r\n    spinner.fail(formatError('Failed to cancel task'));\r\n    throw error;\r\n  }\r\n}\r\n\r\nasync function retryTask(hiveMind: HiveMind, taskId: string) {\r\n  const spinner = ora('Retrying task...').start();\r\n\r\n  try {\r\n    const newTask = await hiveMind.retryTask(taskId);\r\n    spinner.succeed(formatSuccess('Task retry submitted!'));\r\n    console.log(formatInfo(`New Task ID: ${newTask.id}`));\r\n  } catch (error) {\r\n    spinner.fail(formatError('Failed to retry task'));\r\n    throw error;\r\n  }\r\n}\r\n\r\nasync function watchTaskProgress(hiveMind: HiveMind, taskId: string) {\r\n  let lastProgress = -1;\r\n  let completed = false;\r\n\r\n  const progressBar = require('cli-progress');\r\n  const bar = new progressBar.SingleBar({\r\n    format: 'Progress |' + chalk.cyan('{bar}') + '| {percentage}% | {status}',\r\n    barCompleteChar: '\\u2588',\r\n    barIncompleteChar: '\\u2591',\r\n    hideCursor: true,\r\n  });\r\n\r\n  bar.start(100, 0, { status: 'Initializing...' });\r\n\r\n  const interval = setInterval(async () => {\r\n    try {\r\n      const task = await hiveMind.getTask(taskId);\r\n\r\n      if (task.progress !== lastProgress) {\r\n        lastProgress = task.progress;\r\n        bar.update(task.progress, { status: task.status });\r\n      }\r\n\r\n      if (task.status === 'completed' || task.status === 'failed') {\r\n        completed = true;\r\n        bar.stop();\r\n        clearInterval(interval);\r\n\r\n        console.log('\\n' + chalk.bold('ðŸ“Š Task Result:'));\r\n        console.log(formatInfo(`Status: ${task.status}`));\r\n        console.log(formatInfo(`Duration: ${formatDuration(task.completedAt - task.createdAt)}`));\r\n\r\n        if (task.result) {\r\n          console.log(formatInfo('Result:'));\r\n          console.log(chalk.gray(JSON.stringify(task.result, null, 2)));\r\n        }\r\n\r\n        if (task.error) {\r\n          console.log(formatError(`Error: ${task.error}`));\r\n        }\r\n      }\r\n    } catch (error) {\r\n      clearInterval(interval);\r\n      bar.stop();\r\n      console.error(formatError('Error watching task: ' + (error as Error).message));\r\n    }\r\n  }, 1000);\r\n\r\n  // Handle Ctrl+C\r\n  process.on('SIGINT', () => {\r\n    if (!completed) {\r\n      clearInterval(interval);\r\n      bar.stop();\r\n      console.log('\\n' + formatWarning('Task watch cancelled. Task continues in background.'));\r\n      process.exit(0);\r\n    }\r\n  });\r\n}\r\n\r\nfunction getPriorityBadge(priority: string): string {\r\n  const badges: Record<string, string> = {\r\n    low: 'ðŸŸ¢',\r\n    medium: 'ðŸŸ¡',\r\n    high: 'ðŸŸ ',\r\n    critical: 'ðŸ”´',\r\n  };\r\n  return badges[priority] || 'âšª';\r\n}\r\n\r\nfunction getTaskStatusBadge(status: string): string {\r\n  const badges: Record<string, string> = {\r\n    pending: chalk.gray('â³'),\r\n    assigned: chalk.yellow('ðŸ”„'),\r\n    in_progress: chalk.blue('â–¶ï¸'),\r\n    completed: chalk.green('âœ…'),\r\n    failed: chalk.red('âŒ'),\r\n  };\r\n  return badges[status] || chalk.gray('â“');\r\n}\r\n\r\nfunction formatDuration(ms: number): string {\r\n  const seconds = Math.floor(ms / 1000);\r\n  const minutes = Math.floor(seconds / 60);\r\n  const hours = Math.floor(minutes / 60);\r\n\r\n  if (hours > 0) return `${hours}h ${minutes % 60}m`;\r\n  if (minutes > 0) return `${minutes}m ${seconds % 60}s`;\r\n  return `${seconds}s`;\r\n}\r\n"],"names":["Command","chalk","ora","inquirer","HiveMind","formatSuccess","formatError","formatInfo","formatWarning","DatabaseManager","taskCommand","description","argument","option","action","options","swarmId","getActiveSwarmId","Error","hiveMind","load","list","listTasks","cancel","cancelTask","retry","retryTask","interactive","answers","prompt","type","name","message","when","validate","input","length","choices","default","priority","value","strategy","requireConsensus","parseInt","maxAgents","requiredCapabilities","capabilities","spinner","start","dependencies","split","map","id","trim","task","submitTask","assignTo","metadata","submittedBy","submittedAt","Date","succeed","console","log","bold","getPriorityBadge","status","assignedAgents","join","watch","watchTaskProgress","gray","error","process","exit","db","getInstance","tasks","getTasks","Table","require","table","head","style","forEach","push","substring","getTaskStatusBadge","progress","toString","taskId","fail","newTask","lastProgress","completed","progressBar","bar","SingleBar","format","cyan","barCompleteChar","barIncompleteChar","hideCursor","interval","setInterval","getTask","update","stop","clearInterval","formatDuration","completedAt","createdAt","result","JSON","stringify","on","badges","low","medium","high","critical","pending","assigned","yellow","in_progress","blue","green","failed","red","ms","seconds","Math","floor","minutes","hours"],"mappings":";AAQA,SAASA,OAAO,QAAQ,sBAAsB;AAC9C,OAAOC,WAAW,QAAQ;AAC1B,OAAOC,SAAS,MAAM;AACtB,OAAOC,cAAc,WAAW;AAChC,SAASC,QAAQ,QAAQ,sCAAsC;AAE/D,SAASC,aAAa,EAAEC,WAAW,EAAEC,UAAU,EAAEC,aAAa,QAAQ,qBAAqB;AAC3F,SAASC,eAAe,QAAQ,6CAA6C;AAE7E,OAAO,MAAMC,cAAc,IAAIV,QAAQ,QACpCW,WAAW,CAAC,4CACZC,QAAQ,CAAC,iBAAiB,oBAC1BC,MAAM,CAAC,uBAAuB,mBAC9BA,MAAM,CAAC,0BAA0B,+CAA+C,UAChFA,MAAM,CACL,yBACA,kEACA,YAEDA,MAAM,CAAC,4BAA4B,8CACnCA,MAAM,CAAC,2BAA2B,4BAClCA,MAAM,CAAC,2BAA2B,mCAAmC,OACrEA,MAAM,CAAC,6BAA6B,4BAA4B,KAChEA,MAAM,CAAC,qBAAqB,6BAA6B,OACzDA,MAAM,CAAC,eAAe,uBAAuB,OAC7CA,MAAM,CAAC,cAAc,kBAAkB,OACvCA,MAAM,CAAC,iBAAiB,0BACxBA,MAAM,CAAC,gBAAgB,uBACvBC,MAAM,CAAC,OAAOH,aAAaI;IAC1B,IAAI;QAEF,MAAMC,UAAUD,QAAQC,OAAO,IAAK,MAAMC;QAC1C,IAAI,CAACD,SAAS;YACZ,MAAM,IAAIE,MAAM;QAClB;QAGA,MAAMC,WAAW,MAAMf,SAASgB,IAAI,CAACJ;QAGrC,IAAID,QAAQM,IAAI,EAAE;YAChB,MAAMC,UAAUH;YAChB;QACF;QAEA,IAAIJ,QAAQQ,MAAM,EAAE;YAClB,MAAMC,WAAWL,UAAUJ,QAAQQ,MAAM;YACzC;QACF;QAEA,IAAIR,QAAQU,KAAK,EAAE;YACjB,MAAMC,UAAUP,UAAUJ,QAAQU,KAAK;YACvC;QACF;QAGA,IAAIV,QAAQY,WAAW,IAAI,CAAChB,aAAa;YACvC,MAAMiB,UAAU,MAAMzB,SAAS0B,MAAM,CAAC;gBACpC;oBACEC,MAAM;oBACNC,MAAM;oBACNC,SAAS;oBACTC,MAAM,CAACtB;oBACPuB,UAAU,CAACC,QAAUA,MAAMC,MAAM,GAAG,KAAK;gBAC3C;gBACA;oBACEN,MAAM;oBACNC,MAAM;oBACNC,SAAS;oBACTK,SAAS;wBAAC;wBAAO;wBAAU;wBAAQ;qBAAW;oBAC9CC,SAASvB,QAAQwB,QAAQ;gBAC3B;gBACA;oBACET,MAAM;oBACNC,MAAM;oBACNC,SAAS;oBACTK,SAAS;wBACP;4BAAEN,MAAM;4BAA2BS,OAAO;wBAAW;wBACrD;4BAAET,MAAM;4BAAoCS,OAAO;wBAAW;wBAC9D;4BAAET,MAAM;4BAA6BS,OAAO;wBAAa;wBACzD;4BAAET,MAAM;4BAAkCS,OAAO;wBAAY;qBAC9D;oBACDF,SAASvB,QAAQ0B,QAAQ;gBAC3B;gBACA;oBACEX,MAAM;oBACNC,MAAM;oBACNC,SAAS;oBACTM,SAASvB,QAAQ2B,gBAAgB;oBACjCT,MAAM,CAACL,UAAYA,QAAQa,QAAQ,KAAK;gBAC1C;gBACA;oBACEX,MAAM;oBACNC,MAAM;oBACNC,SAAS;oBACTM,SAASK,SAAS5B,QAAQ6B,SAAS,EAAE;oBACrCV,UAAU,CAACC,QAAU,AAACA,QAAQ,KAAKA,SAAS,MAAO;gBACrD;gBACA;oBACEL,MAAM;oBACNC,MAAM;oBACNC,SAAS;oBACTK,SAAS;wBACP;wBACA;wBACA;wBACA;wBACA;wBACA;wBACA;wBACA;qBACD;gBACH;aACD;YAED1B,cAAcA,eAAeiB,QAAQjB,WAAW;YAChDI,QAAQwB,QAAQ,GAAGX,QAAQW,QAAQ,IAAIxB,QAAQwB,QAAQ;YACvDxB,QAAQ0B,QAAQ,GAAGb,QAAQa,QAAQ,IAAI1B,QAAQ0B,QAAQ;YACvD1B,QAAQ2B,gBAAgB,GAAGd,QAAQc,gBAAgB,IAAI3B,QAAQ2B,gBAAgB;YAC/E3B,QAAQ6B,SAAS,GAAGhB,QAAQgB,SAAS,IAAI7B,QAAQ6B,SAAS;YAC1D7B,QAAQ8B,oBAAoB,GAAGjB,QAAQkB,YAAY;QACrD;QAEA,MAAMC,UAAU7C,IAAI,mCAAmC8C,KAAK;QAG5D,MAAMC,eAAelC,QAAQkC,YAAY,GACrClC,QAAQkC,YAAY,CAACC,KAAK,CAAC,KAAKC,GAAG,CAAC,CAACC,KAAeA,GAAGC,IAAI,MAC3D,EAAE;QAGN,MAAMC,OAAO,MAAMnC,SAASoC,UAAU,CAAC;YACrC5C;YACA4B,UAAUxB,QAAQwB,QAAQ;YAC1BE,UAAU1B,QAAQ0B,QAAQ;YAC1BQ;YACAO,UAAUzC,QAAQyC,QAAQ;YAC1Bd,kBAAkB3B,QAAQ2B,gBAAgB;YAC1CE,WAAWD,SAAS5B,QAAQ6B,SAAS,EAAE;YACvCC,sBAAsB9B,QAAQ8B,oBAAoB,IAAI,EAAE;YACxDY,UAAU;gBACRC,aAAa;gBACbC,aAAa,IAAIC;YACnB;QACF;QAEAb,QAAQc,OAAO,CAACxD,cAAc;QAG9ByD,QAAQC,GAAG,CAAC,OAAO9D,MAAM+D,IAAI,CAAC;QAC9BF,QAAQC,GAAG,CAACxD,WAAW,CAAC,SAAS,EAAE+C,KAAKF,EAAE,EAAE;QAC5CU,QAAQC,GAAG,CAACxD,WAAW,CAAC,aAAa,EAAE+C,KAAK3C,WAAW,EAAE;QACzDmD,QAAQC,GAAG,CAACxD,WAAW,CAAC,UAAU,EAAE0D,iBAAiBX,KAAKf,QAAQ,EAAE,CAAC,EAAEe,KAAKf,QAAQ,EAAE;QACtFuB,QAAQC,GAAG,CAACxD,WAAW,CAAC,UAAU,EAAE+C,KAAKb,QAAQ,EAAE;QACnDqB,QAAQC,GAAG,CAACxD,WAAW,CAAC,QAAQ,EAAE+C,KAAKY,MAAM,EAAE;QAE/C,IAAIZ,KAAKa,cAAc,CAAC/B,MAAM,GAAG,GAAG;YAClC0B,QAAQC,GAAG,CAACxD,WAAW,CAAC,aAAa,EAAE+C,KAAKa,cAAc,CAACC,IAAI,CAAC,OAAO;QACzE;QAGA,IAAIrD,QAAQsD,KAAK,EAAE;YACjBP,QAAQC,GAAG,CAAC,OAAO9D,MAAM+D,IAAI,CAAC;YAC9B,MAAMM,kBAAkBnD,UAAUmC,KAAKF,EAAE;QAC3C,OAAO;YACLU,QAAQC,GAAG,CACT,OAAO9D,MAAMsE,IAAI,CAAC,CAAC,iDAAiD,EAAEjB,KAAKF,EAAE,EAAE;QAEnF;IACF,EAAE,OAAOoB,OAAO;QACdV,QAAQU,KAAK,CAAClE,YAAY;QAC1BwD,QAAQU,KAAK,CAAClE,YAAY,AAACkE,MAAgBxC,OAAO;QAClDyC,QAAQC,IAAI,CAAC;IACf;AACF,GAAG;AAEL,eAAezD;IACb,MAAM0D,KAAK,MAAMlE,gBAAgBmE,WAAW;IAC5C,OAAOD,GAAG1D,gBAAgB;AAC5B;AAEA,eAAeK,UAAUH,QAAkB;IACzC,MAAM0D,QAAQ,MAAM1D,SAAS2D,QAAQ;IAErC,IAAID,MAAMzC,MAAM,KAAK,GAAG;QACtB0B,QAAQC,GAAG,CAACxD,WAAW;QACvB;IACF;IAEAuD,QAAQC,GAAG,CAAC,OAAO9D,MAAM+D,IAAI,CAAC;IAC9B,MAAMe,QAAQC,QAAQ;IACtB,MAAMC,QAAQ,IAAIF,MAAM;QACtBG,MAAM;YAAC;YAAM;YAAe;YAAY;YAAU;YAAY;SAAS;QACvEC,OAAO;YAAED,MAAM;gBAAC;aAAO;QAAC;IAC1B;IAEAL,MAAMO,OAAO,CAAC,CAAC9B;QACb2B,MAAMI,IAAI,CAAC;YACT/B,KAAKF,EAAE,CAACkC,SAAS,CAAC,GAAG;YACrBhC,KAAK3C,WAAW,CAAC2E,SAAS,CAAC,GAAG,MAAOhC,CAAAA,KAAK3C,WAAW,CAACyB,MAAM,GAAG,KAAK,QAAQ,EAAC;YAC7E6B,iBAAiBX,KAAKf,QAAQ;YAC9BgD,mBAAmBjC,KAAKY,MAAM;YAC9B,GAAGZ,KAAKkC,QAAQ,CAAC,CAAC,CAAC;YACnBlC,KAAKa,cAAc,CAAC/B,MAAM;SAC3B;IACH;IAEA0B,QAAQC,GAAG,CAACkB,MAAMQ,QAAQ;AAC5B;AAEA,eAAejE,WAAWL,QAAkB,EAAEuE,MAAc;IAC1D,MAAM3C,UAAU7C,IAAI,sBAAsB8C,KAAK;IAE/C,IAAI;QACF,MAAM7B,SAASK,UAAU,CAACkE;QAC1B3C,QAAQc,OAAO,CAACxD,cAAc;IAChC,EAAE,OAAOmE,OAAO;QACdzB,QAAQ4C,IAAI,CAACrF,YAAY;QACzB,MAAMkE;IACR;AACF;AAEA,eAAe9C,UAAUP,QAAkB,EAAEuE,MAAc;IACzD,MAAM3C,UAAU7C,IAAI,oBAAoB8C,KAAK;IAE7C,IAAI;QACF,MAAM4C,UAAU,MAAMzE,SAASO,SAAS,CAACgE;QACzC3C,QAAQc,OAAO,CAACxD,cAAc;QAC9ByD,QAAQC,GAAG,CAACxD,WAAW,CAAC,aAAa,EAAEqF,QAAQxC,EAAE,EAAE;IACrD,EAAE,OAAOoB,OAAO;QACdzB,QAAQ4C,IAAI,CAACrF,YAAY;QACzB,MAAMkE;IACR;AACF;AAEA,eAAeF,kBAAkBnD,QAAkB,EAAEuE,MAAc;IACjE,IAAIG,eAAe,CAAC;IACpB,IAAIC,YAAY;IAEhB,MAAMC,cAAcf,QAAQ;IAC5B,MAAMgB,MAAM,IAAID,YAAYE,SAAS,CAAC;QACpCC,QAAQ,eAAejG,MAAMkG,IAAI,CAAC,WAAW;QAC7CC,iBAAiB;QACjBC,mBAAmB;QACnBC,YAAY;IACd;IAEAN,IAAIhD,KAAK,CAAC,KAAK,GAAG;QAAEkB,QAAQ;IAAkB;IAE9C,MAAMqC,WAAWC,YAAY;QAC3B,IAAI;YACF,MAAMlD,OAAO,MAAMnC,SAASsF,OAAO,CAACf;YAEpC,IAAIpC,KAAKkC,QAAQ,KAAKK,cAAc;gBAClCA,eAAevC,KAAKkC,QAAQ;gBAC5BQ,IAAIU,MAAM,CAACpD,KAAKkC,QAAQ,EAAE;oBAAEtB,QAAQZ,KAAKY,MAAM;gBAAC;YAClD;YAEA,IAAIZ,KAAKY,MAAM,KAAK,eAAeZ,KAAKY,MAAM,KAAK,UAAU;gBAC3D4B,YAAY;gBACZE,IAAIW,IAAI;gBACRC,cAAcL;gBAEdzC,QAAQC,GAAG,CAAC,OAAO9D,MAAM+D,IAAI,CAAC;gBAC9BF,QAAQC,GAAG,CAACxD,WAAW,CAAC,QAAQ,EAAE+C,KAAKY,MAAM,EAAE;gBAC/CJ,QAAQC,GAAG,CAACxD,WAAW,CAAC,UAAU,EAAEsG,eAAevD,KAAKwD,WAAW,GAAGxD,KAAKyD,SAAS,GAAG;gBAEvF,IAAIzD,KAAK0D,MAAM,EAAE;oBACflD,QAAQC,GAAG,CAACxD,WAAW;oBACvBuD,QAAQC,GAAG,CAAC9D,MAAMsE,IAAI,CAAC0C,KAAKC,SAAS,CAAC5D,KAAK0D,MAAM,EAAE,MAAM;gBAC3D;gBAEA,IAAI1D,KAAKkB,KAAK,EAAE;oBACdV,QAAQC,GAAG,CAACzD,YAAY,CAAC,OAAO,EAAEgD,KAAKkB,KAAK,EAAE;gBAChD;YACF;QACF,EAAE,OAAOA,OAAO;YACdoC,cAAcL;YACdP,IAAIW,IAAI;YACR7C,QAAQU,KAAK,CAAClE,YAAY,0BAA0B,AAACkE,MAAgBxC,OAAO;QAC9E;IACF,GAAG;IAGHyC,QAAQ0C,EAAE,CAAC,UAAU;QACnB,IAAI,CAACrB,WAAW;YACdc,cAAcL;YACdP,IAAIW,IAAI;YACR7C,QAAQC,GAAG,CAAC,OAAOvD,cAAc;YACjCiE,QAAQC,IAAI,CAAC;QACf;IACF;AACF;AAEA,SAAST,iBAAiB1B,QAAgB;IACxC,MAAM6E,SAAiC;QACrCC,KAAK;QACLC,QAAQ;QACRC,MAAM;QACNC,UAAU;IACZ;IACA,OAAOJ,MAAM,CAAC7E,SAAS,IAAI;AAC7B;AAEA,SAASgD,mBAAmBrB,MAAc;IACxC,MAAMkD,SAAiC;QACrCK,SAASxH,MAAMsE,IAAI,CAAC;QACpBmD,UAAUzH,MAAM0H,MAAM,CAAC;QACvBC,aAAa3H,MAAM4H,IAAI,CAAC;QACxB/B,WAAW7F,MAAM6H,KAAK,CAAC;QACvBC,QAAQ9H,MAAM+H,GAAG,CAAC;IACpB;IACA,OAAOZ,MAAM,CAAClD,OAAO,IAAIjE,MAAMsE,IAAI,CAAC;AACtC;AAEA,SAASsC,eAAeoB,EAAU;IAChC,MAAMC,UAAUC,KAAKC,KAAK,CAACH,KAAK;IAChC,MAAMI,UAAUF,KAAKC,KAAK,CAACF,UAAU;IACrC,MAAMI,QAAQH,KAAKC,KAAK,CAACC,UAAU;IAEnC,IAAIC,QAAQ,GAAG,OAAO,GAAGA,MAAM,EAAE,EAAED,UAAU,GAAG,CAAC,CAAC;IAClD,IAAIA,UAAU,GAAG,OAAO,GAAGA,QAAQ,EAAE,EAAEH,UAAU,GAAG,CAAC,CAAC;IACtD,OAAO,GAAGA,QAAQ,CAAC,CAAC;AACtB"}