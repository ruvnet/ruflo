{"version":3,"sources":["../../../src/core/InitController.ts"],"sourcesContent":["/**\r\n * InitController - Main orchestration and mode selection\r\n * Handles the core initialization flow and coordinates with all other components\r\n */\r\n\r\nimport { ConfigManager } from './ConfigManager.js';\r\nimport { DatabaseManager } from './DatabaseManager.js';\r\nimport { ModeFactory } from './ModeFactory.js';\r\nimport { TopologyManager } from './TopologyManager.js';\r\nimport { AgentRegistry } from './AgentRegistry.js';\r\nimport { MetricsCollector } from './MetricsCollector.js';\r\nimport { IInitMode, InitConfig, InitResult, InitMode } from '../types/interfaces.js';\r\n\r\nexport interface InitControllerConfig {\r\n  mode?: InitMode;\r\n  topology?: 'mesh' | 'hierarchical' | 'ring' | 'star';\r\n  maxAgents?: number;\r\n  strategy?: 'balanced' | 'specialized' | 'adaptive';\r\n  database?: 'sqlite' | 'json';\r\n  configPath?: string;\r\n  debug?: boolean;\r\n}\r\n\r\nexport class InitController {\r\n  private configManager: ConfigManager;\r\n  private databaseManager: DatabaseManager;\r\n  private modeFactory: ModeFactory;\r\n  private topologyManager: TopologyManager;\r\n  private agentRegistry: AgentRegistry;\r\n  private metricsCollector: MetricsCollector;\r\n  private initialized: boolean = false;\r\n\r\n  constructor(private config: InitControllerConfig = {}) {\r\n    this.configManager = new ConfigManager(config.configPath);\r\n    this.databaseManager = new DatabaseManager(config.database || 'sqlite');\r\n    this.modeFactory = new ModeFactory();\r\n    this.topologyManager = new TopologyManager(this.databaseManager);\r\n    this.agentRegistry = new AgentRegistry(this.databaseManager);\r\n    this.metricsCollector = new MetricsCollector(this.databaseManager);\r\n  }\r\n\r\n  /**\r\n   * Main initialization method - orchestrates the entire init process\r\n   */\r\n  async initialize(): Promise<InitResult> {\r\n    const startTime = Date.now();\r\n\r\n    try {\r\n      // Validate and load configuration\r\n      const validationResult = await this.configManager.validate();\r\n      if (!validationResult.valid) {\r\n        throw new Error(`Configuration validation failed: ${validationResult.errors.join(', ')}`);\r\n      }\r\n\r\n      // Initialize database\r\n      await this.databaseManager.initialize();\r\n\r\n      // Set up topology\r\n      await this.topologyManager.configure(this.config.topology || 'mesh');\r\n\r\n      // Initialize agent registry\r\n      await this.agentRegistry.initialize();\r\n\r\n      // Create and execute the specific initialization mode\r\n      const mode = this.modeFactory.createMode(this.config.mode || 'standard');\r\n      const initConfig: InitConfig = {\r\n        ...this.config,\r\n        configManager: this.configManager,\r\n        databaseManager: this.databaseManager,\r\n        topologyManager: this.topologyManager,\r\n        agentRegistry: this.agentRegistry,\r\n        metricsCollector: this.metricsCollector\r\n      };\r\n\r\n      const result = await mode.initialize(initConfig);\r\n\r\n      // Collect initialization metrics\r\n      const endTime = Date.now();\r\n      await this.metricsCollector.recordInitialization({\r\n        mode: this.config.mode || 'standard',\r\n        duration: endTime - startTime,\r\n        success: true,\r\n        components: result.components || [],\r\n        timestamp: new Date().toISOString()\r\n      });\r\n\r\n      this.initialized = true;\r\n\r\n      return {\r\n        success: true,\r\n        mode: this.config.mode || 'standard',\r\n        components: result.components,\r\n        topology: this.config.topology || 'mesh',\r\n        duration: endTime - startTime,\r\n        message: result.message || 'Initialization completed successfully',\r\n        metadata: {\r\n          configValid: true,\r\n          databaseInitialized: true,\r\n          topologyConfigured: true,\r\n          agentRegistryReady: true,\r\n          ...result.metadata\r\n        }\r\n      };\r\n\r\n    } catch (error) {\r\n      const endTime = Date.now();\r\n      await this.metricsCollector.recordInitialization({\r\n        mode: this.config.mode || 'standard',\r\n        duration: endTime - startTime,\r\n        success: false,\r\n        error: error instanceof Error ? error.message : String(error),\r\n        timestamp: new Date().toISOString()\r\n      });\r\n\r\n      return {\r\n        success: false,\r\n        mode: this.config.mode || 'standard',\r\n        duration: endTime - startTime,\r\n        error: error instanceof Error ? error.message : String(error),\r\n        message: 'Initialization failed'\r\n      };\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get current initialization status\r\n   */\r\n  getStatus(): { initialized: boolean; mode?: InitMode; components?: string[] } {\r\n    return {\r\n      initialized: this.initialized,\r\n      mode: this.config.mode,\r\n      components: this.initialized ? ['ConfigManager', 'DatabaseManager', 'TopologyManager', 'AgentRegistry'] : []\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Shutdown and cleanup resources\r\n   */\r\n  async shutdown(): Promise<void> {\r\n    if (this.databaseManager) {\r\n      await this.databaseManager.close();\r\n    }\r\n    this.initialized = false;\r\n  }\r\n\r\n  /**\r\n   * Validate the current configuration\r\n   */\r\n  async validateConfiguration(): Promise<{ valid: boolean; errors: string[] }> {\r\n    return await this.configManager.validate();\r\n  }\r\n\r\n  /**\r\n   * Get available initialization modes\r\n   */\r\n  getAvailableModes(): InitMode[] {\r\n    return this.modeFactory.getAvailableModes();\r\n  }\r\n\r\n  /**\r\n   * Get topology information\r\n   */\r\n  async getTopologyInfo(): Promise<any> {\r\n    return await this.topologyManager.getTopologyInfo();\r\n  }\r\n\r\n  /**\r\n   * Get registered agents\r\n   */\r\n  async getAgents(): Promise<any[]> {\r\n    return await this.agentRegistry.getActiveAgents();\r\n  }\r\n\r\n  /**\r\n   * Get initialization metrics\r\n   */\r\n  async getMetrics(): Promise<any> {\r\n    return await this.metricsCollector.getInitializationMetrics();\r\n  }\r\n}"],"names":["ConfigManager","DatabaseManager","ModeFactory","TopologyManager","AgentRegistry","MetricsCollector","InitController","configManager","databaseManager","modeFactory","topologyManager","agentRegistry","metricsCollector","initialized","config","configPath","database","initialize","startTime","Date","now","validationResult","validate","valid","Error","errors","join","configure","topology","mode","createMode","initConfig","result","endTime","recordInitialization","duration","success","components","timestamp","toISOString","message","metadata","configValid","databaseInitialized","topologyConfigured","agentRegistryReady","error","String","getStatus","shutdown","close","validateConfiguration","getAvailableModes","getTopologyInfo","getAgents","getActiveAgents","getMetrics","getInitializationMetrics"],"mappings":"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"}