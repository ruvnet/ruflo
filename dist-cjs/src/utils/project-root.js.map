{"version":3,"sources":["../../../src/utils/project-root.js"],"sourcesContent":["import path from 'path';\r\nimport fs from 'fs';\r\n\r\n/**\r\n * Find the project root directory by looking for marker files\r\n * Starting from the current directory and traversing up\r\n * @param {string} startDir - Starting directory (defaults to process.cwd())\r\n * @returns {string} - The project root directory path\r\n */\r\nexport function findProjectRoot(startDir = process.cwd()) {\r\n  let currentDir = path.resolve(startDir);\r\n  const root = path.parse(currentDir).root;\r\n  \r\n  // First, look for the main claude-flow project root\r\n  let searchDir = currentDir;\r\n  while (searchDir !== root) {\r\n    const packageJsonPath = path.join(searchDir, 'package.json');\r\n    if (fs.existsSync(packageJsonPath)) {\r\n      try {\r\n        const packageJson = JSON.parse(fs.readFileSync(packageJsonPath, 'utf8'));\r\n        // Check if this is the main claude-flow package\r\n        if (packageJson.name === 'claude-flow' || \r\n            packageJson.name === '@anthropic/claude-flow') {\r\n          // Also verify it has the expected structure\r\n          if (fs.existsSync(path.join(searchDir, 'bin/claude-flow')) ||\r\n              fs.existsSync(path.join(searchDir, 'src/cli')) ||\r\n              fs.existsSync(path.join(searchDir, 'src/memory'))) {\r\n            return searchDir;\r\n          }\r\n        }\r\n      } catch (e) {\r\n        // Continue searching if we can't parse package.json\r\n      }\r\n    }\r\n    \r\n    // Check for .git directory (strong indicator of project root)\r\n    if (fs.existsSync(path.join(searchDir, '.git'))) {\r\n      // If we find .git and it has claude-flow structure, use it\r\n      if (fs.existsSync(path.join(searchDir, 'bin/claude-flow')) ||\r\n          fs.existsSync(path.join(searchDir, '.claude-flow')) ||\r\n          fs.existsSync(path.join(searchDir, 'CLAUDE.md'))) {\r\n        return searchDir;\r\n      }\r\n    }\r\n    \r\n    // Move up one directory\r\n    const parentDir = path.dirname(searchDir);\r\n    if (parentDir === searchDir) {\r\n      break;\r\n    }\r\n    searchDir = parentDir;\r\n  }\r\n  \r\n  // Fallback: look for any .claude-flow or .swarm directory going up\r\n  searchDir = currentDir;\r\n  while (searchDir !== root) {\r\n    if (fs.existsSync(path.join(searchDir, '.claude-flow')) ||\r\n        fs.existsSync(path.join(searchDir, '.swarm'))) {\r\n      // Additional check for main project markers\r\n      if (fs.existsSync(path.join(searchDir, 'CLAUDE.md')) ||\r\n          fs.existsSync(path.join(searchDir, 'bin/claude-flow'))) {\r\n        return searchDir;\r\n      }\r\n    }\r\n    \r\n    const parentDir = path.dirname(searchDir);\r\n    if (parentDir === searchDir) {\r\n      break;\r\n    }\r\n    searchDir = parentDir;\r\n  }\r\n  \r\n  // Final fallback to process.cwd()\r\n  return process.cwd();\r\n}\r\n\r\n/**\r\n * Get the .claude-flow directory path relative to project root\r\n * @param {string} startDir - Starting directory for search\r\n * @returns {string} - Path to .claude-flow directory\r\n */\r\nexport function getClaudeFlowDir(startDir) {\r\n  const root = findProjectRoot(startDir);\r\n  return path.join(root, '.claude-flow');\r\n}\r\n\r\n/**\r\n * Get the .swarm directory path relative to project root\r\n * @param {string} startDir - Starting directory for search\r\n * @returns {string} - Path to .swarm directory\r\n */\r\nexport function getSwarmDir(startDir) {\r\n  const root = findProjectRoot(startDir);\r\n  return path.join(root, '.swarm');\r\n}\r\n\r\n/**\r\n * Get the .hive-mind directory path relative to project root\r\n * @param {string} startDir - Starting directory for search\r\n * @returns {string} - Path to .hive-mind directory\r\n */\r\nexport function getHiveMindDir(startDir) {\r\n  const root = findProjectRoot(startDir);\r\n  return path.join(root, '.hive-mind');\r\n}\r\n\r\n// Cached project root to avoid repeated filesystem lookups\r\nlet cachedProjectRoot = null;\r\n\r\n/**\r\n * Get cached project root or find it\r\n * @returns {string} - The project root directory path\r\n */\r\nexport function getProjectRoot() {\r\n  if (!cachedProjectRoot) {\r\n    cachedProjectRoot = findProjectRoot();\r\n  }\r\n  return cachedProjectRoot;\r\n}\r\n\r\n/**\r\n * Clear the cached project root (useful for testing)\r\n */\r\nexport function clearProjectRootCache() {\r\n  cachedProjectRoot = null;\r\n}"],"names":["path","fs","findProjectRoot","startDir","process","cwd","currentDir","resolve","root","parse","searchDir","packageJsonPath","join","existsSync","packageJson","JSON","readFileSync","name","e","parentDir","dirname","getClaudeFlowDir","getSwarmDir","getHiveMindDir","cachedProjectRoot","getProjectRoot","clearProjectRootCache"],"mappings":"AAAA,OAAOA,UAAU,OAAO;AACxB,OAAOC,QAAQ,KAAK;AAQpB,OAAO,SAASC,gBAAgBC,WAAWC,QAAQC,GAAG,EAAE;IACtD,IAAIC,aAAaN,KAAKO,OAAO,CAACJ;IAC9B,MAAMK,OAAOR,KAAKS,KAAK,CAACH,YAAYE,IAAI;IAGxC,IAAIE,YAAYJ;IAChB,MAAOI,cAAcF,KAAM;QACzB,MAAMG,kBAAkBX,KAAKY,IAAI,CAACF,WAAW;QAC7C,IAAIT,GAAGY,UAAU,CAACF,kBAAkB;YAClC,IAAI;gBACF,MAAMG,cAAcC,KAAKN,KAAK,CAACR,GAAGe,YAAY,CAACL,iBAAiB;gBAEhE,IAAIG,YAAYG,IAAI,KAAK,iBACrBH,YAAYG,IAAI,KAAK,0BAA0B;oBAEjD,IAAIhB,GAAGY,UAAU,CAACb,KAAKY,IAAI,CAACF,WAAW,uBACnCT,GAAGY,UAAU,CAACb,KAAKY,IAAI,CAACF,WAAW,eACnCT,GAAGY,UAAU,CAACb,KAAKY,IAAI,CAACF,WAAW,gBAAgB;wBACrD,OAAOA;oBACT;gBACF;YACF,EAAE,OAAOQ,GAAG,CAEZ;QACF;QAGA,IAAIjB,GAAGY,UAAU,CAACb,KAAKY,IAAI,CAACF,WAAW,UAAU;YAE/C,IAAIT,GAAGY,UAAU,CAACb,KAAKY,IAAI,CAACF,WAAW,uBACnCT,GAAGY,UAAU,CAACb,KAAKY,IAAI,CAACF,WAAW,oBACnCT,GAAGY,UAAU,CAACb,KAAKY,IAAI,CAACF,WAAW,eAAe;gBACpD,OAAOA;YACT;QACF;QAGA,MAAMS,YAAYnB,KAAKoB,OAAO,CAACV;QAC/B,IAAIS,cAAcT,WAAW;YAC3B;QACF;QACAA,YAAYS;IACd;IAGAT,YAAYJ;IACZ,MAAOI,cAAcF,KAAM;QACzB,IAAIP,GAAGY,UAAU,CAACb,KAAKY,IAAI,CAACF,WAAW,oBACnCT,GAAGY,UAAU,CAACb,KAAKY,IAAI,CAACF,WAAW,YAAY;YAEjD,IAAIT,GAAGY,UAAU,CAACb,KAAKY,IAAI,CAACF,WAAW,iBACnCT,GAAGY,UAAU,CAACb,KAAKY,IAAI,CAACF,WAAW,qBAAqB;gBAC1D,OAAOA;YACT;QACF;QAEA,MAAMS,YAAYnB,KAAKoB,OAAO,CAACV;QAC/B,IAAIS,cAAcT,WAAW;YAC3B;QACF;QACAA,YAAYS;IACd;IAGA,OAAOf,QAAQC,GAAG;AACpB;AAOA,OAAO,SAASgB,iBAAiBlB,QAAQ;IACvC,MAAMK,OAAON,gBAAgBC;IAC7B,OAAOH,KAAKY,IAAI,CAACJ,MAAM;AACzB;AAOA,OAAO,SAASc,YAAYnB,QAAQ;IAClC,MAAMK,OAAON,gBAAgBC;IAC7B,OAAOH,KAAKY,IAAI,CAACJ,MAAM;AACzB;AAOA,OAAO,SAASe,eAAepB,QAAQ;IACrC,MAAMK,OAAON,gBAAgBC;IAC7B,OAAOH,KAAKY,IAAI,CAACJ,MAAM;AACzB;AAGA,IAAIgB,oBAAoB;AAMxB,OAAO,SAASC;IACd,IAAI,CAACD,mBAAmB;QACtBA,oBAAoBtB;IACtB;IACA,OAAOsB;AACT;AAKA,OAAO,SAASE;IACdF,oBAAoB;AACtB"}