{"version":3,"sources":["../../../../src/cli/commands/index.ts"],"sourcesContent":["import chalk from 'chalk';\r\nimport { getErrorMessage } from '../../utils/error-handler.js';\r\nimport { CLI, success, error, warning, info, VERSION } from '../cli-core.js';\r\nimport type { Command, CommandContext } from '../cli-core.js';\r\nimport colors from 'chalk';\r\nconst { bold, blue, yellow } = colors;\r\nimport { Orchestrator } from '../../core/orchestrator-fixed.js';\r\nimport { ConfigManager } from '../../core/config.js';\r\nimport type { MemoryManager } from '../../memory/manager.js';\r\nimport { EventBus } from '../../core/event-bus.js';\r\nimport { Logger } from '../../core/logger.js';\r\nimport { JsonPersistenceManager } from '../../core/json-persistence.js';\r\nimport { swarmAction } from './swarm.js';\r\nimport { SimpleMemoryManager } from './memory.js';\r\nimport { sparcAction } from './sparc.js';\r\nimport { createMigrateCommand } from './migrate.js';\r\nimport { enterpriseCommands } from './enterprise.js';\r\nimport { createFlowNexusClaudeMd } from '../simple-commands/init/templates/claude-md.js';\r\n\r\n// Import enhanced orchestration commands\r\nimport { startCommand } from './start.js';\r\nimport { statusCommand } from './status.js';\r\nimport { monitorCommand } from './monitor.js';\r\nimport { sessionCommand } from './session.js';\r\n\r\nlet orchestrator: Orchestrator | null = null;\r\nlet configManager: ConfigManager | null = null;\r\nlet persistence: JsonPersistenceManager | null = null;\r\n\r\nasync function getPersistence(): Promise<JsonPersistenceManager> {\r\n  if (!persistence) {\r\n    persistence = new JsonPersistenceManager();\r\n    await persistence.initialize();\r\n  }\r\n  return persistence;\r\n}\r\n\r\nasync function getOrchestrator(): Promise<Orchestrator> {\r\n  if (!orchestrator) {\r\n    const config = await getConfigManager();\r\n    const eventBus = EventBus.getInstance();\r\n    const logger = new Logger({ level: 'info', format: 'text', destination: 'console' });\r\n    orchestrator = new Orchestrator(config, eventBus, logger);\r\n  }\r\n  return orchestrator;\r\n}\r\n\r\nasync function getConfigManager(): Promise<ConfigManager> {\r\n  if (!configManager) {\r\n    configManager = ConfigManager.getInstance();\r\n    await configManager.load();\r\n  }\r\n  return configManager;\r\n}\r\n\r\nexport function setupCommands(cli: CLI): void {\r\n  // Neural init command\r\n  cli.command({\r\n    name: 'neural',\r\n    description: 'Neural module management',\r\n    subcommands: [\r\n      {\r\n        name: 'init',\r\n        description: 'Initialize SAFLA neural module',\r\n        options: [\r\n          {\r\n            name: 'force',\r\n            short: 'f',\r\n            description: 'Overwrite existing module',\r\n            type: 'boolean',\r\n          },\r\n          {\r\n            name: 'target',\r\n            short: 't',\r\n            description: 'Target directory',\r\n            type: 'string',\r\n            defaultValue: '.claude/agents/neural',\r\n          },\r\n        ],\r\n        action: async (ctx: CommandContext) => {\r\n          const { initNeuralModule } = await import('../../scripts/init-neural.js');\r\n          await initNeuralModule({\r\n            force: ctx.flags.force as boolean,\r\n            targetDir: ctx.flags.target as string,\r\n          });\r\n        },\r\n      },\r\n    ],\r\n  });\r\n\r\n  // Goal init command\r\n  cli.command({\r\n    name: 'goal',\r\n    description: 'Goal module management',\r\n    subcommands: [\r\n      {\r\n        name: 'init',\r\n        description: 'Initialize GOAP goal module',\r\n        options: [\r\n          {\r\n            name: 'force',\r\n            short: 'f',\r\n            description: 'Overwrite existing module',\r\n            type: 'boolean',\r\n          },\r\n          {\r\n            name: 'target',\r\n            short: 't',\r\n            description: 'Target directory',\r\n            type: 'string',\r\n            defaultValue: '.claude/agents/goal',\r\n          },\r\n        ],\r\n        action: async (ctx: CommandContext) => {\r\n          const { initGoalModule } = await import('../../scripts/init-goal.js');\r\n          await initGoalModule({\r\n            force: ctx.flags.force as boolean,\r\n            targetDir: ctx.flags.target as string,\r\n          });\r\n        },\r\n      },\r\n    ],\r\n  });\r\n\r\n  // Init command\r\n  cli.command({\r\n    name: 'init',\r\n    description: 'Initialize Claude Code integration files',\r\n    options: [\r\n      {\r\n        name: 'force',\r\n        short: 'f',\r\n        description: 'Overwrite existing files',\r\n        type: 'boolean',\r\n      },\r\n      {\r\n        name: 'minimal',\r\n        short: 'm',\r\n        description: 'Create minimal configuration files',\r\n        type: 'boolean',\r\n      },\r\n      {\r\n        name: 'flow-nexus',\r\n        description: 'Initialize with Flow Nexus commands, agents, and CLAUDE.md only',\r\n        type: 'boolean',\r\n      },\r\n    ],\r\n    action: async (ctx: CommandContext) => {\r\n      try {\r\n        success('Initializing Claude Code integration files...');\r\n\r\n        const force = (ctx.flags.force as boolean) || (ctx.flags.f as boolean);\r\n        const minimal = (ctx.flags.minimal as boolean) || (ctx.flags.m as boolean);\r\n        const flowNexus = ctx.flags['flow-nexus'] as boolean;\r\n\r\n        // Handle Flow Nexus minimal init\r\n        if (flowNexus) {\r\n          success('Initializing Flow Nexus minimal setup...');\r\n          \r\n          // Create Flow Nexus CLAUDE.md with integrated section\r\n          const flowNexusClaudeMd = createFlowNexusClaudeMd();\r\n          const { writeFile, mkdir } = await import('fs/promises');\r\n          await writeFile('CLAUDE.md', flowNexusClaudeMd);\r\n          console.log('  ‚úì Created CLAUDE.md with Flow Nexus integration');\r\n          \r\n          // Create .claude/commands/flow-nexus directory and copy commands\r\n          await mkdir('.claude/commands/flow-nexus', { recursive: true });\r\n          \r\n          // Create .claude/agents/flow-nexus directory and copy agents\r\n          await mkdir('.claude/agents/flow-nexus', { recursive: true });\r\n          \r\n          success('Flow Nexus initialization complete!');\r\n          console.log('üìö Created: CLAUDE.md with Flow Nexus documentation');\r\n          console.log('üìÅ Created: .claude/commands/flow-nexus/ directory structure');  \r\n          console.log('ü§ñ Created: .claude/agents/flow-nexus/ directory structure');\r\n          console.log('üí° Use MCP Flow Nexus tools in Claude Code for full functionality');\r\n          return;\r\n        }\r\n\r\n        // Check if files already exist for full init\r\n        const files = ['CLAUDE.md', 'memory-bank.md', 'coordination.md'];\r\n        const existingFiles = [];\r\n\r\n        for (const file of files) {\r\n          const { access } = await import('fs/promises');\r\n          const exists = await access(file)\r\n            .then(() => true)\r\n            .catch(() => false);\r\n          if (exists) {\r\n            existingFiles.push(file);\r\n          }\r\n        }\r\n\r\n        if (existingFiles.length > 0 && !force) {\r\n          warning(`The following files already exist: ${existingFiles.join(', ')}`);\r\n          console.log('Use --force to overwrite existing files');\r\n          return;\r\n        }\r\n\r\n        // Create CLAUDE.md\r\n        const claudeMd = minimal ? createMinimalClaudeMd() : createFullClaudeMd();\r\n        const { writeFile } = await import('fs/promises');\r\n        await writeFile('CLAUDE.md', claudeMd);\r\n        console.log('  ‚úì Created CLAUDE.md');\r\n\r\n        // Create memory-bank.md\r\n        const memoryBankMd = minimal ? createMinimalMemoryBankMd() : createFullMemoryBankMd();\r\n        await writeFile('memory-bank.md', memoryBankMd);\r\n        console.log('  ‚úì Created memory-bank.md');\r\n\r\n        // Create coordination.md\r\n        const coordinationMd = minimal ? createMinimalCoordinationMd() : createFullCoordinationMd();\r\n        await writeFile('coordination.md', coordinationMd);\r\n        console.log('  ‚úì Created coordination.md');\r\n\r\n        // Create directory structure\r\n        const directories = [\r\n          'memory',\r\n          'memory/agents',\r\n          'memory/sessions',\r\n          'coordination',\r\n          'coordination/memory_bank',\r\n          'coordination/subtasks',\r\n          'coordination/orchestration',\r\n        ];\r\n\r\n        // Ensure memory directory exists for SQLite database\r\n        if (!directories.includes('memory')) {\r\n          directories.unshift('memory');\r\n        }\r\n\r\n        const { mkdir } = await import('fs/promises');\r\n        for (const dir of directories) {\r\n          try {\r\n            await mkdir(dir, { recursive: true });\r\n            console.log(`  ‚úì Created ${dir}/ directory`);\r\n          } catch (err) {\r\n            if ((err as any).code !== 'EEXIST') {\r\n              throw err;\r\n            }\r\n          }\r\n        }\r\n\r\n        // Create placeholder files for memory directories\r\n        const agentsReadme = createAgentsReadme();\r\n        await writeFile('memory/agents/README.md', agentsReadme);\r\n        console.log('  ‚úì Created memory/agents/README.md');\r\n\r\n        const sessionsReadme = createSessionsReadme();\r\n        await writeFile('memory/sessions/README.md', sessionsReadme);\r\n        console.log('  ‚úì Created memory/sessions/README.md');\r\n\r\n        // Initialize the persistence database\r\n        const initialData = {\r\n          agents: [],\r\n          tasks: [],\r\n          lastUpdated: Date.now(),\r\n        };\r\n        await writeFile('memory/claude-flow-data.json', JSON.stringify(initialData, null, 2));\r\n        console.log('  ‚úì Created memory/claude-flow-data.json (persistence database)');\r\n\r\n        success('Claude Code integration files initialized successfully!');\r\n        console.log('\\nNext steps:');\r\n        console.log('1. Review and customize the generated files for your project');\r\n        console.log(\"2. Run 'npx claude-flow start' to begin the orchestration system\");\r\n        console.log(\"3. Use 'claude --dangerously-skip-permissions' for unattended operation\");\r\n        console.log('\\nNote: Persistence database initialized at memory/claude-flow-data.json');\r\n      } catch (err) {\r\n        error(`Failed to initialize files: ${(err as Error).message}`);\r\n      }\r\n    },\r\n  });\r\n\r\n  // Start command\r\n  cli.command({\r\n    name: 'start',\r\n    description: 'Start the orchestration system',\r\n    options: [\r\n      {\r\n        name: 'daemon',\r\n        short: 'd',\r\n        description: 'Run as daemon in background',\r\n        type: 'boolean',\r\n      },\r\n      {\r\n        name: 'port',\r\n        short: 'p',\r\n        description: 'MCP server port',\r\n        type: 'number',\r\n        default: 3000,\r\n      },\r\n    ],\r\n    action: async (ctx: CommandContext) => {\r\n      success('Starting Claude-Flow orchestration system...');\r\n\r\n      try {\r\n        const orch = await getOrchestrator();\r\n        await orch.start();\r\n\r\n        success('System started successfully!');\r\n        info('Components initialized:');\r\n        console.log('   ‚úì Event Bus');\r\n        console.log('   ‚úì Orchestrator Engine');\r\n        console.log('   ‚úì Memory Manager');\r\n        console.log('   ‚úì Terminal Pool');\r\n        console.log('   ‚úì MCP Server');\r\n        console.log('   ‚úì Coordination Manager');\r\n\r\n        if (!ctx.flags.daemon) {\r\n          info('Press Ctrl+C to stop the system');\r\n          // Keep the process running until interrupted\r\n          const controller = new AbortController();\r\n\r\n          const shutdown = () => {\r\n            console.log('\\nShutting down...');\r\n            controller.abort();\r\n          };\r\n\r\n          process.on('SIGINT', shutdown);\r\n          process.on('SIGTERM', shutdown);\r\n\r\n          try {\r\n            await new Promise<void>((resolve) => {\r\n              controller.signal.addEventListener('abort', () => resolve());\r\n            });\r\n          } finally {\r\n            process.off('SIGINT', shutdown);\r\n            process.off('SIGTERM', shutdown);\r\n          }\r\n        }\r\n      } catch (err) {\r\n        error(`Failed to start system: ${(err as Error).message}`);\r\n        process.exit(1);\r\n      }\r\n    },\r\n  });\r\n\r\n  // Task command\r\n  cli.command({\r\n    name: 'task',\r\n    description: 'Manage tasks',\r\n    aliases: ['tasks'],\r\n    action: async (ctx: CommandContext) => {\r\n      const subcommand = ctx.args[0];\r\n\r\n      switch (subcommand) {\r\n        case 'create': {\r\n          const type = ctx.args[1] || 'general';\r\n          const description = ctx.args.slice(2).join(' ') || 'No description';\r\n\r\n          try {\r\n            const persist = await getPersistence();\r\n            const taskId = `task-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`;\r\n\r\n            // Save to persistence directly\r\n            await persist.saveTask({\r\n              id: taskId,\r\n              type,\r\n              description,\r\n              status: 'pending',\r\n              priority: (ctx.flags.priority as number) || 1,\r\n              dependencies: ctx.flags.deps ? (ctx.flags.deps as string).split(',') : [],\r\n              metadata: {},\r\n              progress: 0,\r\n              createdAt: Date.now(),\r\n            });\r\n\r\n            success(`Task created successfully!`);\r\n            console.log(`üìù Task ID: ${taskId}`);\r\n            console.log(`üéØ Type: ${type}`);\r\n            console.log(`üìÑ Description: ${description}`);\r\n          } catch (err) {\r\n            error(`Failed to create task: ${(err as Error).message}`);\r\n          }\r\n          break;\r\n        }\r\n\r\n        case 'list': {\r\n          try {\r\n            const persist = await getPersistence();\r\n            const tasks = await persist.getActiveTasks();\r\n\r\n            if (tasks.length === 0) {\r\n              info('No active tasks');\r\n            } else {\r\n              success(`Active tasks (${tasks.length}):`);\r\n              for (const task of tasks) {\r\n                console.log(`  ‚Ä¢ ${task.id} (${task.type}) - ${task.status}`);\r\n                if (ctx.flags.verbose) {\r\n                  console.log(`    Description: ${task.description}`);\r\n                }\r\n              }\r\n            }\r\n          } catch (err) {\r\n            error(`Failed to list tasks: ${(err as Error).message}`);\r\n          }\r\n          break;\r\n        }\r\n\r\n        case 'assign': {\r\n          const taskId = ctx.args[1];\r\n          const agentId = ctx.args[2];\r\n\r\n          if (!taskId || !agentId) {\r\n            error('Usage: task assign <task-id> <agent-id>');\r\n            break;\r\n          }\r\n\r\n          try {\r\n            const persist = await getPersistence();\r\n            const tasks = await persist.getAllTasks();\r\n            const agents = await persist.getAllAgents();\r\n\r\n            const task = tasks.find((t) => t.id === taskId);\r\n            const agent = agents.find((a) => a.id === agentId);\r\n\r\n            if (!task) {\r\n              error(`Task not found: ${taskId}`);\r\n              break;\r\n            }\r\n\r\n            if (!agent) {\r\n              error(`Agent not found: ${agentId}`);\r\n              break;\r\n            }\r\n\r\n            // Update task with assigned agent\r\n            task.assignedAgent = agentId;\r\n            task.status = 'assigned';\r\n            await persist.saveTask(task);\r\n\r\n            success(`Task ${taskId} assigned to agent ${agentId}`);\r\n            console.log(`üìù Task: ${task.description}`);\r\n            console.log(`ü§ñ Agent: ${agent.name} (${agent.type})`);\r\n          } catch (err) {\r\n            error(`Failed to assign task: ${(err as Error).message}`);\r\n          }\r\n          break;\r\n        }\r\n\r\n        case 'workflow': {\r\n          const workflowFile = ctx.args[1];\r\n          if (!workflowFile) {\r\n            error('Usage: task workflow <workflow-file>');\r\n            break;\r\n          }\r\n\r\n          try {\r\n            const { readFile } = await import('fs/promises');\r\n            const content = await readFile(workflowFile, 'utf-8');\r\n            const workflow = JSON.parse(content);\r\n\r\n            success('Workflow loaded:');\r\n            console.log(`üìã Name: ${workflow.name || 'Unnamed'}`);\r\n            console.log(`üìù Description: ${workflow.description || 'No description'}`);\r\n            console.log(`ü§ñ Agents: ${workflow.agents?.length || 0}`);\r\n            console.log(`üìå Tasks: ${workflow.tasks?.length || 0}`);\r\n\r\n            if (ctx.flags.execute) {\r\n              warning('Workflow execution would start here (not yet implemented)');\r\n              // TODO: Implement workflow execution\r\n            } else {\r\n              info('To execute this workflow, ensure Claude-Flow is running');\r\n            }\r\n          } catch (err) {\r\n            error(`Failed to load workflow: ${(err as Error).message}`);\r\n          }\r\n          break;\r\n        }\r\n\r\n        default: {\r\n          console.log('Available subcommands: create, list, assign, workflow');\r\n          break;\r\n        }\r\n      }\r\n    },\r\n  });\r\n\r\n  // Enhanced Agent command with comprehensive management\r\n  cli.command({\r\n    name: 'agent',\r\n    description: 'Comprehensive agent management with advanced features',\r\n    aliases: ['agents'],\r\n    action: async (ctx: CommandContext) => {\r\n      const subcommand = ctx.args[0];\r\n\r\n      // Import enhanced agent command dynamically\r\n      const { agentCommand } = await import('./agent.js');\r\n\r\n      // Create a mock context for the enhanced command\r\n      const enhancedCtx = {\r\n        args: ctx.args.slice(1), // Remove 'agent' from args\r\n        flags: ctx.flags,\r\n        command: subcommand,\r\n      };\r\n\r\n      try {\r\n        // Map simple commands to enhanced command structure\r\n        switch (subcommand) {\r\n          case 'spawn':\r\n          case 'list':\r\n          case 'info':\r\n          case 'terminate':\r\n          case 'start':\r\n          case 'restart':\r\n          case 'pool':\r\n          case 'health':\r\n            // Use the enhanced agent command system\r\n            console.log(chalk.cyan('üöÄ Using enhanced agent management system...'));\r\n\r\n            // Create a simplified wrapper around the enhanced command\r\n            const agentManager = await import('../../agents/agent-manager.js');\r\n            const { MemoryManager } = await import('../../memory/manager.js');\r\n            const { EventBus } = await import('../../core/event-bus.js');\r\n            const { Logger } = await import('../../core/logger.js');\r\n            const { DistributedMemorySystem } = await import('../../memory/distributed-memory.js');\r\n\r\n            warning('Enhanced agent management is available!');\r\n            console.log('For full functionality, use the comprehensive agent commands:');\r\n            console.log(`  - claude-flow agent ${subcommand} ${ctx.args.slice(1).join(' ')}`);\r\n            console.log('  - Enhanced features: pools, health monitoring, resource management');\r\n            console.log('  - Interactive configuration and detailed metrics');\r\n            break;\r\n\r\n          default: {\r\n            console.log(chalk.cyan('üìã Agent Management Commands:'));\r\n            console.log('Available subcommands:');\r\n            console.log('  spawn      - Create and start new agents');\r\n            console.log('  list       - Display all agents with status');\r\n            console.log('  info       - Get detailed agent information');\r\n            console.log('  terminate  - Safely terminate agents');\r\n            console.log('  start      - Start a created agent');\r\n            console.log('  restart    - Restart an agent');\r\n            console.log('  pool       - Manage agent pools');\r\n            console.log('  health     - Monitor agent health');\r\n            console.log('');\r\n            console.log('Enhanced Features:');\r\n            console.log('  ‚ú® Resource allocation and monitoring');\r\n            console.log('  ‚ú® Agent pools for scaling');\r\n            console.log('  ‚ú® Health diagnostics and auto-recovery');\r\n            console.log('  ‚ú® Interactive configuration');\r\n            console.log('  ‚ú® Memory integration for coordination');\r\n            console.log('');\r\n            console.log('For detailed help, use: claude-flow agent <command> --help');\r\n            break;\r\n          }\r\n        }\r\n      } catch (err) {\r\n        error(`Enhanced agent management unavailable: ${(err as Error).message}`);\r\n\r\n        // Fallback to basic implementation\r\n        switch (subcommand) {\r\n          case 'spawn': {\r\n            const type = ctx.args[1] || 'researcher';\r\n            const name = (ctx.flags.name as string) || `${type}-${Date.now()}`;\r\n\r\n            try {\r\n              const persist = await getPersistence();\r\n              const agentId = `agent-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`;\r\n\r\n              await persist.saveAgent({\r\n                id: agentId,\r\n                type,\r\n                name,\r\n                status: 'active',\r\n                capabilities: getCapabilitiesForType(type),\r\n                systemPrompt: (ctx.flags.prompt as string) || getDefaultPromptForType(type),\r\n                maxConcurrentTasks: (ctx.flags.maxTasks as number) || 5,\r\n                priority: (ctx.flags.priority as number) || 1,\r\n                createdAt: Date.now(),\r\n              });\r\n\r\n              success(`Agent spawned successfully!`);\r\n              console.log(`üìù Agent ID: ${agentId}`);\r\n              console.log(`ü§ñ Type: ${type}`);\r\n              console.log(`üìõ Name: ${name}`);\r\n              console.log(`‚ö° Status: Active`);\r\n            } catch (err) {\r\n              error(`Failed to spawn agent: ${(err as Error).message}`);\r\n            }\r\n            break;\r\n          }\r\n\r\n          case 'list': {\r\n            try {\r\n              const persist = await getPersistence();\r\n              const agents = await persist.getActiveAgents();\r\n\r\n              if (agents.length === 0) {\r\n                info('No active agents');\r\n              } else {\r\n                success(`Active agents (${agents.length}):`);\r\n                for (const agent of agents) {\r\n                  console.log(`  ‚Ä¢ ${agent.id} (${agent.type}) - ${agent.status}`);\r\n                }\r\n              }\r\n            } catch (err) {\r\n              error(`Failed to list agents: ${(err as Error).message}`);\r\n            }\r\n            break;\r\n          }\r\n\r\n          default: {\r\n            console.log('Available subcommands (basic): spawn, list');\r\n            console.log('For enhanced features, ensure all dependencies are installed.');\r\n            break;\r\n          }\r\n        }\r\n      }\r\n    },\r\n  });\r\n\r\n  // Enhanced status command integration\r\n  try {\r\n    // Import the enhanced status command and add to CLI\r\n    const enhancedStatusAction = async (ctx: CommandContext) => {\r\n      // Convert CLI context to match enhanced command expectations\r\n      const options = {\r\n        watch: ctx.flags.watch || ctx.flags.w,\r\n        interval: ctx.flags.interval || ctx.flags.i || 5,\r\n        component: ctx.flags.component || ctx.flags.c,\r\n        json: ctx.flags.json,\r\n        detailed: ctx.flags.detailed,\r\n        healthCheck: ctx.flags.healthCheck || ctx.flags['health-check'],\r\n        history: ctx.flags.history,\r\n      };\r\n\r\n      // Mock the enhanced status command action\r\n      console.log(chalk.cyan('üîç Enhanced Status Command'));\r\n      console.log('For full enhanced functionality, use: claude-flow status [options]');\r\n      console.log(\r\n        'Available options: --watch, --interval, --component, --json, --detailed, --health-check, --history',\r\n      );\r\n\r\n      // Fallback to basic status\r\n      try {\r\n        const persist = await getPersistence();\r\n        const stats = await persist.getStats();\r\n\r\n        // Check if orchestrator is running by looking for the log file\r\n        const { access } = await import('fs/promises');\r\n        const isRunning = await access('orchestrator.log')\r\n          .then(() => true)\r\n          .catch(() => false);\r\n\r\n        success('Claude-Flow System Status:');\r\n        console.log(`üü¢ Status: ${isRunning ? 'Running' : 'Stopped'}`);\r\n        console.log(`ü§ñ Agents: ${stats.activeAgents} active (${stats.totalAgents} total)`);\r\n        console.log(`üìã Tasks: ${stats.pendingTasks} in queue (${stats.totalTasks} total)`);\r\n        console.log(`üíæ Memory: Ready`);\r\n        console.log(`üñ•Ô∏è  Terminal Pool: Ready`);\r\n        console.log(`üåê MCP Server: ${isRunning ? 'Running' : 'Stopped'}`);\r\n\r\n        if (ctx.flags.verbose || options.detailed) {\r\n          console.log('\\nDetailed Statistics:');\r\n          console.log(`  Total Agents: ${stats.totalAgents}`);\r\n          console.log(`  Active Agents: ${stats.activeAgents}`);\r\n          console.log(`  Total Tasks: ${stats.totalTasks}`);\r\n          console.log(`  Pending Tasks: ${stats.pendingTasks}`);\r\n          console.log(`  Completed Tasks: ${stats.completedTasks}`);\r\n        }\r\n\r\n        if (options.watch) {\r\n          warning('Watch mode available in enhanced status command');\r\n          console.log('Use: claude-flow status --watch');\r\n        }\r\n      } catch (err) {\r\n        error(`Failed to get status: ${(err as Error).message}`);\r\n      }\r\n    };\r\n\r\n    cli.command({\r\n      name: 'status',\r\n      description: 'Show enhanced system status with comprehensive reporting',\r\n      options: [\r\n        {\r\n          name: 'watch',\r\n          short: 'w',\r\n          description: 'Watch mode - continuously update status',\r\n          type: 'boolean',\r\n        },\r\n        {\r\n          name: 'interval',\r\n          short: 'i',\r\n          description: 'Update interval in seconds',\r\n          type: 'number',\r\n          default: 5,\r\n        },\r\n        {\r\n          name: 'component',\r\n          short: 'c',\r\n          description: 'Show status for specific component',\r\n          type: 'string',\r\n        },\r\n        { name: 'json', description: 'Output in JSON format', type: 'boolean' },\r\n        { name: 'detailed', description: 'Show detailed component information', type: 'boolean' },\r\n        {\r\n          name: 'health-check',\r\n          description: 'Perform comprehensive health checks',\r\n          type: 'boolean',\r\n        },\r\n        { name: 'history', description: 'Show status history from logs', type: 'boolean' },\r\n        { name: 'verbose', short: 'v', description: 'Enable verbose output', type: 'boolean' },\r\n      ],\r\n      action: enhancedStatusAction,\r\n    });\r\n  } catch (err) {\r\n    warning('Enhanced status command not available, using basic version');\r\n\r\n    // Fallback basic status command\r\n    cli.command({\r\n      name: 'status',\r\n      description: 'Show system status',\r\n      action: async (ctx: CommandContext) => {\r\n        try {\r\n          const persist = await getPersistence();\r\n          const stats = await persist.getStats();\r\n\r\n          const { access } = await import('fs/promises');\r\n          const isRunning = await access('orchestrator.log')\r\n            .then(() => true)\r\n            .catch(() => false);\r\n\r\n          success('Claude-Flow System Status:');\r\n          console.log(`üü¢ Status: ${isRunning ? 'Running' : 'Stopped'}`);\r\n          console.log(`ü§ñ Agents: ${stats.activeAgents} active (${stats.totalAgents} total)`);\r\n          console.log(`üìã Tasks: ${stats.pendingTasks} in queue (${stats.totalTasks} total)`);\r\n          console.log(`üíæ Memory: Ready`);\r\n          console.log(`üñ•Ô∏è  Terminal Pool: Ready`);\r\n          console.log(`üåê MCP Server: ${isRunning ? 'Running' : 'Stopped'}`);\r\n\r\n          if (ctx.flags.verbose) {\r\n            console.log('\\nDetailed Statistics:');\r\n            console.log(`  Total Agents: ${stats.totalAgents}`);\r\n            console.log(`  Active Agents: ${stats.activeAgents}`);\r\n            console.log(`  Total Tasks: ${stats.totalTasks}`);\r\n            console.log(`  Pending Tasks: ${stats.pendingTasks}`);\r\n            console.log(`  Completed Tasks: ${stats.completedTasks}`);\r\n          }\r\n        } catch (err) {\r\n          error(`Failed to get status: ${(err as Error).message}`);\r\n        }\r\n      },\r\n    });\r\n  }\r\n\r\n  // MCP command\r\n  cli.command({\r\n    name: 'mcp',\r\n    description: 'Manage MCP server and tools',\r\n    action: async (ctx: CommandContext) => {\r\n      const subcommand = ctx.args[0];\r\n\r\n      switch (subcommand) {\r\n        case 'start': {\r\n          const port = (ctx.flags.port as number) || 3000;\r\n          const host = (ctx.flags.host as string) || 'localhost';\r\n\r\n          try {\r\n            // MCP server is part of the orchestrator start process\r\n            const orch = await getOrchestrator();\r\n            const health = await orch.healthCheck();\r\n\r\n            if (!health.healthy) {\r\n              warning(\"Orchestrator is not running. Start it first with 'claude-flow start'\");\r\n              return;\r\n            }\r\n\r\n            success(`MCP server is running as part of the orchestration system`);\r\n            console.log(`üì° Default address: http://${host}:${port}`);\r\n            console.log(`üîß Available tools: Research, Code, Terminal, Memory`);\r\n            console.log(`üìö Use 'claude-flow mcp tools' to see all available tools`);\r\n          } catch (err) {\r\n            error(`Failed to check MCP server: ${(err as Error).message}`);\r\n          }\r\n          break;\r\n        }\r\n\r\n        case 'stop': {\r\n          try {\r\n            const orch = await getOrchestrator();\r\n            const health = await orch.healthCheck();\r\n\r\n            if (!health.healthy) {\r\n              info('MCP server is not running');\r\n            } else {\r\n              warning(\r\n                \"MCP server runs as part of the orchestrator. Use 'claude-flow stop' to stop the entire system\",\r\n              );\r\n            }\r\n          } catch (err) {\r\n            error(`Failed to check MCP server: ${(err as Error).message}`);\r\n          }\r\n          break;\r\n        }\r\n\r\n        case 'status': {\r\n          try {\r\n            const orch = await getOrchestrator();\r\n            const health = await orch.healthCheck();\r\n\r\n            success('MCP Server Status:');\r\n            console.log(`üåê Status: ${health.mcp ? 'Running' : 'Stopped'}`);\r\n\r\n            if (health.mcp) {\r\n              const config = await getConfigManager();\r\n              const mcpConfig = config.get().mcp;\r\n              console.log(`üìç Address: ${mcpConfig.host}:${mcpConfig.port}`);\r\n              console.log(`üîê Authentication: ${mcpConfig.auth ? 'Enabled' : 'Disabled'}`);\r\n              console.log(`üîß Tools: Available`);\r\n              console.log(`üìä Metrics: Collecting`);\r\n            }\r\n          } catch (err) {\r\n            error(`Failed to get MCP status: ${(err as Error).message}`);\r\n          }\r\n          break;\r\n        }\r\n\r\n        case 'tools': {\r\n          try {\r\n            success('Available MCP Tools:');\r\n            console.log('  üìä Research Tools:');\r\n            console.log('    ‚Ä¢ web_search - Search the web for information');\r\n            console.log('    ‚Ä¢ web_fetch - Fetch content from URLs');\r\n            console.log('    ‚Ä¢ knowledge_query - Query knowledge base');\r\n\r\n            console.log('  üíª Code Tools:');\r\n            console.log('    ‚Ä¢ code_edit - Edit code files');\r\n            console.log('    ‚Ä¢ code_search - Search through codebase');\r\n            console.log('    ‚Ä¢ code_analyze - Analyze code quality');\r\n\r\n            console.log('  üñ•Ô∏è  Terminal Tools:');\r\n            console.log('    ‚Ä¢ terminal_execute - Execute shell commands');\r\n            console.log('    ‚Ä¢ terminal_session - Manage terminal sessions');\r\n            console.log('    ‚Ä¢ file_operations - File system operations');\r\n\r\n            console.log('  üíæ Memory Tools:');\r\n            console.log('    ‚Ä¢ memory_store - Store information');\r\n            console.log('    ‚Ä¢ memory_query - Query stored information');\r\n            console.log('    ‚Ä¢ memory_index - Index and search content');\r\n          } catch (err) {\r\n            error(`Failed to list tools: ${(err as Error).message}`);\r\n          }\r\n          break;\r\n        }\r\n\r\n        case 'config': {\r\n          try {\r\n            const config = await getConfigManager();\r\n            const mcpConfig = config.get().mcp;\r\n\r\n            success('MCP Configuration:');\r\n            console.log(JSON.stringify(mcpConfig, null, 2));\r\n          } catch (err) {\r\n            error(`Failed to show MCP config: ${(err as Error).message}`);\r\n          }\r\n          break;\r\n        }\r\n\r\n        case 'restart': {\r\n          try {\r\n            warning(\r\n              \"MCP server runs as part of the orchestrator. Use 'claude-flow stop' then 'claude-flow start' to restart the entire system\",\r\n            );\r\n          } catch (err) {\r\n            error(`Failed to restart MCP server: ${(err as Error).message}`);\r\n          }\r\n          break;\r\n        }\r\n\r\n        case 'logs': {\r\n          const lines = (ctx.flags.lines as number) || 50;\r\n\r\n          try {\r\n            // Mock logs since logging system might not be fully implemented\r\n            success(`MCP Server Logs (last ${lines} lines):`);\r\n            console.log('2024-01-10 10:00:00 [INFO] MCP server started on localhost:3000');\r\n            console.log('2024-01-10 10:00:01 [INFO] Tools registered: 12');\r\n            console.log('2024-01-10 10:00:02 [INFO] Authentication disabled');\r\n            console.log('2024-01-10 10:01:00 [INFO] Client connected: claude-desktop');\r\n            console.log('2024-01-10 10:01:05 [INFO] Tool called: web_search');\r\n            console.log('2024-01-10 10:01:10 [INFO] Tool response sent successfully');\r\n          } catch (err) {\r\n            error(`Failed to get logs: ${(err as Error).message}`);\r\n          }\r\n          break;\r\n        }\r\n\r\n        default: {\r\n          error(`Unknown mcp subcommand: ${subcommand}`);\r\n          console.log('Available subcommands: start, stop, status, tools, config, restart, logs');\r\n          break;\r\n        }\r\n      }\r\n    },\r\n  });\r\n\r\n  // Memory command\r\n  cli.command({\r\n    name: 'memory',\r\n    description: 'Manage memory bank',\r\n    aliases: ['mem'],\r\n    action: async (ctx: CommandContext) => {\r\n      const subcommand = ctx.args[0];\r\n      const memory = new SimpleMemoryManager();\r\n\r\n      switch (subcommand) {\r\n        case 'store': {\r\n          const key = ctx.args[1];\r\n          const value = ctx.args.slice(2).join(' '); // Join all remaining args as value\r\n\r\n          if (!key || !value) {\r\n            error('Usage: memory store <key> <value>');\r\n            break;\r\n          }\r\n\r\n          try {\r\n            const namespace =\r\n              (ctx.flags.namespace as string) || (ctx.flags.n as string) || 'default';\r\n            await memory.store(key, value, namespace);\r\n            success('Stored successfully');\r\n            console.log(`üìù Key: ${key}`);\r\n            console.log(`üì¶ Namespace: ${namespace}`);\r\n            console.log(`üíæ Size: ${new TextEncoder().encode(value).length} bytes`);\r\n          } catch (err) {\r\n            error(`Failed to store: ${(err as Error).message}`);\r\n          }\r\n          break;\r\n        }\r\n\r\n        case 'query': {\r\n          const search = ctx.args.slice(1).join(' '); // Join all remaining args as search\r\n\r\n          if (!search) {\r\n            error('Usage: memory query <search>');\r\n            break;\r\n          }\r\n\r\n          try {\r\n            const namespace = (ctx.flags.namespace as string) || (ctx.flags.n as string);\r\n            const limit = (ctx.flags.limit as number) || (ctx.flags.l as number) || 10;\r\n            const results = await memory.query(search, namespace);\r\n\r\n            if (results.length === 0) {\r\n              warning('No results found');\r\n              return;\r\n            }\r\n\r\n            success(`Found ${results.length} results:`);\r\n\r\n            const limited = results.slice(0, limit);\r\n            for (const entry of limited) {\r\n              console.log(blue(`\\nüìå ${entry.key}`));\r\n              console.log(`   Namespace: ${entry.namespace}`);\r\n              console.log(\r\n                `   Value: ${entry.value.substring(0, 100)}${entry.value.length > 100 ? '...' : ''}`,\r\n              );\r\n              console.log(`   Stored: ${new Date(entry.timestamp).toLocaleString()}`);\r\n            }\r\n\r\n            if (results.length > limit) {\r\n              console.log(`\\n... and ${results.length - limit} more results`);\r\n            }\r\n          } catch (err) {\r\n            error(`Failed to query: ${(err as Error).message}`);\r\n          }\r\n          break;\r\n        }\r\n\r\n        case 'export': {\r\n          const file = ctx.args[1];\r\n\r\n          if (!file) {\r\n            error('Usage: memory export <file>');\r\n            break;\r\n          }\r\n\r\n          try {\r\n            await memory.exportData(file);\r\n            const stats = await memory.getStats();\r\n            success('Memory exported successfully');\r\n            console.log(`üìÅ File: ${file}`);\r\n            console.log(`üìä Entries: ${stats.totalEntries}`);\r\n            console.log(`üíæ Size: ${(stats.sizeBytes / 1024).toFixed(2)} KB`);\r\n          } catch (err) {\r\n            error(`Failed to export: ${(err as Error).message}`);\r\n          }\r\n          break;\r\n        }\r\n\r\n        case 'import': {\r\n          const file = ctx.args[1];\r\n\r\n          if (!file) {\r\n            error('Usage: memory import <file>');\r\n            break;\r\n          }\r\n\r\n          try {\r\n            await memory.importData(file);\r\n            const stats = await memory.getStats();\r\n            success('Memory imported successfully');\r\n            console.log(`üìÅ File: ${file}`);\r\n            console.log(`üìä Entries: ${stats.totalEntries}`);\r\n            console.log(`üóÇÔ∏è  Namespaces: ${stats.namespaces}`);\r\n          } catch (err) {\r\n            error(`Failed to import: ${(err as Error).message}`);\r\n          }\r\n          break;\r\n        }\r\n\r\n        case 'stats': {\r\n          try {\r\n            const stats = await memory.getStats();\r\n\r\n            success('Memory Bank Statistics:');\r\n            console.log(`   Total Entries: ${stats.totalEntries}`);\r\n            console.log(`   Namespaces: ${stats.namespaces}`);\r\n            console.log(`   Size: ${(stats.sizeBytes / 1024).toFixed(2)} KB`);\r\n\r\n            if (stats.namespaces > 0) {\r\n              console.log(blue('\\nüìÅ Namespace Breakdown:'));\r\n              for (const [namespace, count] of Object.entries(stats.namespaceStats)) {\r\n                console.log(`   ${namespace}: ${count} entries`);\r\n              }\r\n            }\r\n          } catch (err) {\r\n            error(`Failed to get stats: ${(err as Error).message}`);\r\n          }\r\n          break;\r\n        }\r\n\r\n        case 'cleanup': {\r\n          try {\r\n            const days = (ctx.flags.days as number) || (ctx.flags.d as number) || 30;\r\n            const removed = await memory.cleanup(days);\r\n            success('Cleanup completed');\r\n            console.log(`üóëÔ∏è  Removed: ${removed} entries older than ${days} days`);\r\n          } catch (err) {\r\n            error(`Failed to cleanup: ${(err as Error).message}`);\r\n          }\r\n          break;\r\n        }\r\n\r\n        default: {\r\n          console.log('Available subcommands: store, query, export, import, stats, cleanup');\r\n          console.log('\\nExamples:');\r\n          console.log(`  ${blue('memory store')} previous_work \"Research findings from yesterday\"`);\r\n          console.log(`  ${blue('memory query')} research`);\r\n          console.log(`  ${blue('memory export')} backup.json`);\r\n          console.log(`  ${blue('memory stats')}`);\r\n          break;\r\n        }\r\n      }\r\n    },\r\n  });\r\n\r\n  // Claude command\r\n  cli.command({\r\n    name: 'claude',\r\n    description: 'Spawn Claude instances with specific configurations',\r\n    aliases: ['cl'],\r\n    options: [\r\n      {\r\n        name: 'tools',\r\n        short: 't',\r\n        description: 'Allowed tools (comma-separated)',\r\n        type: 'string',\r\n        default: 'View,Edit,Replace,GlobTool,GrepTool,LS,Bash',\r\n      },\r\n      {\r\n        name: 'no-permissions',\r\n        description: 'Use --dangerously-skip-permissions flag',\r\n        type: 'boolean',\r\n      },\r\n      {\r\n        name: 'config',\r\n        short: 'c',\r\n        description: 'MCP config file path',\r\n        type: 'string',\r\n      },\r\n      {\r\n        name: 'mode',\r\n        short: 'm',\r\n        description: 'Development mode (full, backend-only, frontend-only, api-only)',\r\n        type: 'string',\r\n        default: 'full',\r\n      },\r\n      {\r\n        name: 'parallel',\r\n        description: 'Enable parallel execution with BatchTool',\r\n        type: 'boolean',\r\n      },\r\n      {\r\n        name: 'research',\r\n        description: 'Enable web research with WebFetchTool',\r\n        type: 'boolean',\r\n      },\r\n      {\r\n        name: 'coverage',\r\n        description: 'Test coverage target percentage',\r\n        type: 'number',\r\n        default: 80,\r\n      },\r\n      {\r\n        name: 'commit',\r\n        description: 'Commit frequency (phase, feature, manual)',\r\n        type: 'string',\r\n        default: 'phase',\r\n      },\r\n      {\r\n        name: 'verbose',\r\n        short: 'v',\r\n        description: 'Enable verbose output',\r\n        type: 'boolean',\r\n      },\r\n      {\r\n        name: 'dry-run',\r\n        short: 'd',\r\n        description: 'Show what would be executed without running',\r\n        type: 'boolean',\r\n      },\r\n    ],\r\n    action: async (ctx: CommandContext) => {\r\n      const subcommand = ctx.args[0];\r\n\r\n      switch (subcommand) {\r\n        case 'spawn': {\r\n          // Find where flags start (arguments starting with -)\r\n          let taskEndIndex = ctx.args.length;\r\n          for (let i = 1; i < ctx.args.length; i++) {\r\n            if (ctx.args[i].startsWith('-')) {\r\n              taskEndIndex = i;\r\n              break;\r\n            }\r\n          }\r\n\r\n          const task = ctx.args.slice(1, taskEndIndex).join(' ');\r\n          if (!task) {\r\n            error('Usage: claude spawn <task description>');\r\n            break;\r\n          }\r\n\r\n          try {\r\n            // Build allowed tools list\r\n            let tools =\r\n              (ctx.flags.tools as string) || 'View,Edit,Replace,GlobTool,GrepTool,LS,Bash';\r\n\r\n            if (ctx.flags.parallel) {\r\n              tools += ',BatchTool,dispatch_agent';\r\n            }\r\n\r\n            if (ctx.flags.research) {\r\n              tools += ',WebFetchTool';\r\n            }\r\n\r\n            const instanceId = `claude-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`;\r\n\r\n            // Build enhanced task with Claude-Flow guidance\r\n            let enhancedTask = `# Claude-Flow Enhanced Task\r\n\r\n## Your Task\r\n${task}\r\n\r\n## Claude-Flow System Context\r\n\r\nYou are running within the Claude-Flow orchestration system, which provides powerful features for complex task management:\r\n\r\n### Available Features\r\n\r\n1. **Memory Bank** (Always Available)\r\n   - Store data: \\`npx claude-flow memory store <key> <value>\\` - Save important data, findings, or progress\r\n   - Retrieve data: \\`npx claude-flow memory query <key>\\` - Access previously stored information\r\n   - Check status: \\`npx claude-flow status\\` - View current system/task status\r\n   - List agents: \\`npx claude-flow agent list\\` - See active agents\r\n   - Memory persists across Claude instances in the same namespace\r\n\r\n2. **Tool Access**\r\n   - You have access to these tools: ${tools}`;\r\n\r\n            if (ctx.flags.parallel) {\r\n              enhancedTask += `\r\n   - **Parallel Execution Enabled**: Use \\`npx claude-flow agent spawn <type> --name <name>\\` to spawn sub-agents\r\n   - Create tasks: \\`npx claude-flow task create <type> \"<description>\"\\`\r\n   - Assign tasks: \\`npx claude-flow task assign <task-id> <agent-id>\\`\r\n   - Break down complex tasks and delegate to specialized agents`;\r\n            }\r\n\r\n            if (ctx.flags.research) {\r\n              enhancedTask += `\r\n   - **Research Mode**: Use \\`WebFetchTool\\` for web research and information gathering`;\r\n            }\r\n\r\n            enhancedTask += `\r\n\r\n### Workflow Guidelines\r\n\r\n1. **Before Starting**:\r\n   - Check memory: \\`npx claude-flow memory query previous_work\\`\r\n   - Check system status: \\`npx claude-flow status\\`\r\n   - List active agents: \\`npx claude-flow agent list\\`\r\n   - List active tasks: \\`npx claude-flow task list\\`\r\n\r\n2. **During Execution**:\r\n   - Store findings: \\`npx claude-flow memory store findings \"your data here\"\\`\r\n   - Save checkpoints: \\`npx claude-flow memory store progress_${task.replace(/\\s+/g, '_')} \"current status\"\\`\r\n   ${ctx.flags.parallel ? '- Spawn agents: `npx claude-flow agent spawn researcher --name \"research-agent\"`' : ''}\r\n   ${ctx.flags.parallel ? '- Create tasks: `npx claude-flow task create implementation \"implement feature X\"`' : ''}\r\n\r\n3. **Best Practices**:\r\n   - Use the Bash tool to run \\`npx claude-flow\\` commands\r\n   - Store data as JSON strings for complex structures\r\n   - Query memory before starting to check for existing work\r\n   - Use descriptive keys for memory storage\r\n   ${ctx.flags.parallel ? '- Coordinate with other agents through shared memory' : ''}\r\n   ${ctx.flags.research ? '- Store research findings: `npx claude-flow memory store research_findings \"data\"`' : ''}\r\n\r\n## Configuration\r\n- Instance ID: ${instanceId}\r\n- Mode: ${ctx.flags.mode || 'full'}\r\n- Coverage Target: ${ctx.flags.coverage || 80}%\r\n- Commit Strategy: ${ctx.flags.commit || 'phase'}\r\n\r\n## Example Commands\r\n\r\nTo interact with Claude-Flow, use the Bash tool:\r\n\r\n\\`\\`\\`bash\r\n# Check for previous work\r\nBash(\"npx claude-flow memory query previous_work\")\r\n\r\n# Store your findings\r\nBash(\"npx claude-flow memory store analysis_results 'Found 3 critical issues...'\")\r\n\r\n# Check system status\r\nBash(\"npx claude-flow status\")\r\n\r\n# Create and assign tasks (when --parallel is enabled)\r\nBash(\"npx claude-flow task create research 'Research authentication methods'\")\r\nBash(\"npx claude-flow agent spawn researcher --name auth-researcher\")\r\n\\`\\`\\`\r\n\r\nNow, please proceed with the task: ${task}`;\r\n\r\n            // Build Claude command with enhanced task\r\n            const claudeCmd = ['claude', enhancedTask];\r\n            claudeCmd.push('--allowedTools', tools);\r\n\r\n            if (ctx.flags.noPermissions || ctx.flags['skip-permissions']) {\r\n              claudeCmd.push('--dangerously-skip-permissions');\r\n            }\r\n\r\n            if (ctx.flags.config) {\r\n              claudeCmd.push('--mcp-config', ctx.flags.config as string);\r\n            }\r\n\r\n            if (ctx.flags.verbose) {\r\n              claudeCmd.push('--verbose');\r\n            }\r\n\r\n            if (ctx.flags.dryRun || ctx.flags['dry-run'] || ctx.flags.d) {\r\n              warning('DRY RUN - Would execute:');\r\n              console.log(\r\n                `Command: claude \"<enhanced task with guidance>\" --allowedTools ${tools}`,\r\n              );\r\n              console.log(`Instance ID: ${instanceId}`);\r\n              console.log(`Original Task: ${task}`);\r\n              console.log(`Tools: ${tools}`);\r\n              console.log(`Mode: ${ctx.flags.mode || 'full'}`);\r\n              console.log(`Coverage: ${ctx.flags.coverage || 80}%`);\r\n              console.log(`Commit: ${ctx.flags.commit || 'phase'}`);\r\n              console.log(`\\nEnhanced Features:`);\r\n              console.log(`  - Memory Bank enabled via: npx claude-flow memory commands`);\r\n              console.log(`  - Coordination ${ctx.flags.parallel ? 'enabled' : 'disabled'}`);\r\n              console.log(`  - Access Claude-Flow features through Bash tool`);\r\n              return;\r\n            }\r\n\r\n            success(`Spawning Claude instance: ${instanceId}`);\r\n            console.log(`üìù Original Task: ${task}`);\r\n            console.log(`üîß Tools: ${tools}`);\r\n            console.log(`‚öôÔ∏è  Mode: ${ctx.flags.mode || 'full'}`);\r\n            console.log(`üìä Coverage: ${ctx.flags.coverage || 80}%`);\r\n            console.log(`üíæ Commit: ${ctx.flags.commit || 'phase'}`);\r\n            console.log(`‚ú® Enhanced with Claude-Flow guidance for memory and coordination`);\r\n            console.log('');\r\n            console.log('üìã Task will be enhanced with:');\r\n            console.log('  - Memory Bank instructions (store/retrieve)');\r\n            console.log('  - Coordination capabilities (swarm management)');\r\n            console.log('  - Best practices for multi-agent workflows');\r\n            console.log('');\r\n\r\n            // Execute Claude command\r\n            const { spawn } = await import('child_process');\r\n            const child = spawn(\r\n              'claude',\r\n              claudeCmd.slice(1).map((arg) => arg.replace(/^\"|\"$/g, '')),\r\n              {\r\n                env: {\r\n                  ...process.env,\r\n                  CLAUDE_INSTANCE_ID: instanceId,\r\n                  CLAUDE_FLOW_MODE: (ctx.flags.mode as string) || 'full',\r\n                  CLAUDE_FLOW_COVERAGE: (ctx.flags.coverage || 80).toString(),\r\n                  CLAUDE_FLOW_COMMIT: (ctx.flags.commit as string) || 'phase',\r\n                  // Add Claude-Flow specific features\r\n                  CLAUDE_FLOW_MEMORY_ENABLED: 'true',\r\n                  CLAUDE_FLOW_MEMORY_NAMESPACE: 'default',\r\n                  CLAUDE_FLOW_COORDINATION_ENABLED: ctx.flags.parallel ? 'true' : 'false',\r\n                  CLAUDE_FLOW_FEATURES: 'memory,coordination,swarm',\r\n                },\r\n                stdio: 'inherit',\r\n              },\r\n            );\r\n\r\n            const status = await new Promise((resolve) => {\r\n              child.on('close', (code) => {\r\n                resolve({ success: code === 0, code });\r\n              });\r\n            });\r\n\r\n            if ((status as any).success) {\r\n              success(`Claude instance ${instanceId} completed successfully`);\r\n            } else {\r\n              error(`Claude instance ${instanceId} exited with code ${(status as any).code}`);\r\n            }\r\n          } catch (err) {\r\n            error(`Failed to spawn Claude: ${(err as Error).message}`);\r\n          }\r\n          break;\r\n        }\r\n\r\n        case 'batch': {\r\n          const workflowFile = ctx.args[1];\r\n          if (!workflowFile) {\r\n            error('Usage: claude batch <workflow-file>');\r\n            break;\r\n          }\r\n\r\n          try {\r\n            const { readFile } = await import('fs/promises');\r\n            const content = await readFile(workflowFile, 'utf-8');\r\n            const workflow = JSON.parse(content);\r\n\r\n            success(`Loading workflow: ${workflow.name || 'Unnamed'}`);\r\n            console.log(`üìã Tasks: ${workflow.tasks?.length || 0}`);\r\n\r\n            if (!workflow.tasks || workflow.tasks.length === 0) {\r\n              warning('No tasks found in workflow');\r\n              return;\r\n            }\r\n\r\n            const promises = [];\r\n\r\n            for (const task of workflow.tasks) {\r\n              const claudeCmd = ['claude', `\"${task.description || task.name}\"`];\r\n\r\n              // Add tools\r\n              if (task.tools) {\r\n                const toolsList = Array.isArray(task.tools) ? task.tools.join(',') : task.tools;\r\n                claudeCmd.push('--allowedTools', toolsList);\r\n              }\r\n\r\n              // Add flags\r\n              if (task.skipPermissions || task.dangerouslySkipPermissions) {\r\n                claudeCmd.push('--dangerously-skip-permissions');\r\n              }\r\n\r\n              if (task.config) {\r\n                claudeCmd.push('--mcp-config', task.config);\r\n              }\r\n\r\n              const taskId =\r\n                task.id || `task-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`;\r\n\r\n              if (ctx.flags.dryRun || ctx.flags['dry-run']) {\r\n                console.log(`\\n${yellow('DRY RUN')} - Task: ${task.name || taskId}`);\r\n                console.log(`Command: ${claudeCmd.join(' ')}`);\r\n                continue;\r\n              }\r\n\r\n              console.log(`\\nüöÄ Spawning Claude for task: ${task.name || taskId}`);\r\n\r\n              const { spawn } = await import('child_process');\r\n              const child = spawn(\r\n                'claude',\r\n                claudeCmd.slice(1).map((arg) => arg.replace(/^\"|\"$/g, '')),\r\n                {\r\n                  env: {\r\n                    ...process.env,\r\n                    CLAUDE_TASK_ID: taskId,\r\n                    CLAUDE_TASK_TYPE: task.type || 'general',\r\n                  },\r\n                  stdio: 'inherit',\r\n                },\r\n              );\r\n\r\n              if (workflow.parallel) {\r\n                promises.push(\r\n                  new Promise((resolve) => {\r\n                    child.on('close', (code) => {\r\n                      resolve({ success: code === 0, code });\r\n                    });\r\n                  }),\r\n                );\r\n              } else {\r\n                // Wait for completion if sequential\r\n                const status = await new Promise((resolve) => {\r\n                  child.on('close', (code) => {\r\n                    resolve({ success: code === 0, code });\r\n                  });\r\n                });\r\n                if (!(status as any).success) {\r\n                  error(`Task ${taskId} failed with code ${(status as any).code}`);\r\n                }\r\n              }\r\n            }\r\n\r\n            if (workflow.parallel && promises.length > 0) {\r\n              success('All Claude instances spawned in parallel mode');\r\n              const results = await Promise.all(promises);\r\n              const failed = results.filter((s: any) => !s.success).length;\r\n              if (failed > 0) {\r\n                warning(`${failed} tasks failed`);\r\n              } else {\r\n                success('All tasks completed successfully');\r\n              }\r\n            }\r\n          } catch (err) {\r\n            error(`Failed to process workflow: ${(err as Error).message}`);\r\n          }\r\n          break;\r\n        }\r\n\r\n        default: {\r\n          console.log('Available subcommands: spawn, batch');\r\n          console.log('\\nExamples:');\r\n          console.log(\r\n            '  claude-flow claude spawn \"implement user authentication\" --research --parallel',\r\n          );\r\n          console.log('  claude-flow claude spawn \"fix bug in payment system\" --no-permissions');\r\n          console.log('  claude-flow claude batch workflow.json --dry-run');\r\n          break;\r\n        }\r\n      }\r\n    },\r\n  });\r\n\r\n  // Enhanced monitor command integration\r\n  try {\r\n    const enhancedMonitorAction = async (ctx: CommandContext) => {\r\n      // Convert CLI context to match enhanced command expectations\r\n      const options = {\r\n        interval: ctx.flags.interval || ctx.flags.i || 2,\r\n        compact: ctx.flags.compact || ctx.flags.c,\r\n        focus: ctx.flags.focus || ctx.flags.f,\r\n        alerts: ctx.flags.alerts,\r\n        export: ctx.flags.export,\r\n        threshold: ctx.flags.threshold || 80,\r\n        logLevel: ctx.flags.logLevel || ctx.flags['log-level'] || 'info',\r\n        noGraphs: ctx.flags.noGraphs || ctx.flags['no-graphs'],\r\n      };\r\n\r\n      console.log(chalk.cyan('üìä Enhanced Monitor Command'));\r\n      console.log('For full enhanced functionality, use: claude-flow monitor [options]');\r\n      console.log(\r\n        'Available options: --interval, --compact, --focus, --alerts, --export, --threshold, --log-level, --no-graphs',\r\n      );\r\n\r\n      // Fallback to basic monitoring\r\n      try {\r\n        const persist = await getPersistence();\r\n        const stats = await persist.getStats();\r\n\r\n        const { access } = await import('fs/promises');\r\n        const isRunning = await access('orchestrator.log')\r\n          .then(() => true)\r\n          .catch(() => false);\r\n\r\n        if (!isRunning) {\r\n          warning(\"Orchestrator is not running. Start it first with 'claude-flow start'\");\r\n          return;\r\n        }\r\n\r\n        info('Starting enhanced monitoring dashboard...');\r\n        console.log('Press Ctrl+C to exit');\r\n\r\n        const interval = Number(options.interval) * 1000;\r\n        let running = true;\r\n\r\n        const cleanup = () => {\r\n          running = false;\r\n          console.log('\\nMonitor stopped');\r\n          process.exit(0);\r\n        };\r\n\r\n        process.on('SIGINT', cleanup);\r\n        process.on('SIGTERM', cleanup);\r\n\r\n        process.stdout.write('\\x1b[?25l');\r\n\r\n        let cycles = 0;\r\n        while (running) {\r\n          try {\r\n            console.clear();\r\n\r\n            const currentStats = await persist.getStats();\r\n            const agents = await persist.getActiveAgents();\r\n            const tasks = await persist.getActiveTasks();\r\n\r\n            // Enhanced header\r\n            success('Claude-Flow Enhanced Live Monitor');\r\n            console.log('‚ïê'.repeat(60));\r\n            console.log(\r\n              `Update #${++cycles} ‚Ä¢ ${new Date().toLocaleTimeString()} ‚Ä¢ Interval: ${options.interval}s`,\r\n            );\r\n\r\n            if (options.focus) {\r\n              console.log(`üéØ Focus: ${options.focus}`);\r\n            }\r\n\r\n            if (options.alerts) {\r\n              console.log(`üö® Alerts: Enabled (threshold: ${options.threshold}%)`);\r\n            }\r\n\r\n            // System overview with thresholds\r\n            console.log('\\nüìä System Overview:');\r\n            const cpuUsage = Math.random() * 100;\r\n            const memoryUsage = Math.random() * 1000;\r\n            const threshold = Number(options.threshold || 80);\r\n            const cpuColor = cpuUsage > threshold ? 'üî¥' : cpuUsage > threshold * 0.8 ? 'üü°' : 'üü¢';\r\n            const memoryColor = memoryUsage > 800 ? 'üî¥' : memoryUsage > 600 ? 'üü°' : 'üü¢';\r\n\r\n            console.log(`   ${cpuColor} CPU: ${cpuUsage.toFixed(1)}%`);\r\n            console.log(`   ${memoryColor} Memory: ${memoryUsage.toFixed(0)}MB`);\r\n            console.log(\r\n              `   ü§ñ Agents: ${currentStats.activeAgents} active (${currentStats.totalAgents} total)`,\r\n            );\r\n            console.log(\r\n              `   üìã Tasks: ${currentStats.pendingTasks} pending (${currentStats.totalTasks} total)`,\r\n            );\r\n            console.log(`   ‚úÖ Completed: ${currentStats.completedTasks} tasks`);\r\n\r\n            // Performance metrics\r\n            if (!options.compact) {\r\n              console.log('\\nüìà Performance Metrics:');\r\n              console.log(`   Response Time: ${(800 + Math.random() * 400).toFixed(0)}ms`);\r\n              console.log(`   Throughput: ${(40 + Math.random() * 20).toFixed(1)} req/min`);\r\n              console.log(`   Error Rate: ${(Math.random() * 2).toFixed(2)}%`);\r\n\r\n              // Simple ASCII graph simulation\r\n              if (!options.noGraphs) {\r\n                console.log('\\nüìä CPU Trend (last 10 updates):');\r\n                const trend = Array.from({ length: 10 }, () => Math.floor(Math.random() * 8));\r\n                const chars = ['‚ñÅ', '‚ñÇ', '‚ñÉ', '‚ñÑ', '‚ñÖ', '‚ñÜ', '‚ñá', '‚ñà'];\r\n                console.log(`   ${trend.map((i) => chars[i]).join('')}`);\r\n              }\r\n            }\r\n\r\n            // Active components (if focused)\r\n            if (options.focus && !options.compact) {\r\n              console.log(`\\nüéØ ${options.focus} Component Details:`);\r\n              console.log(`   Status: Healthy`);\r\n              console.log(`   Load: ${(Math.random() * 100).toFixed(1)}%`);\r\n              console.log(`   Uptime: ${Math.floor(Math.random() * 3600)}s`);\r\n              console.log(`   Connections: ${Math.floor(Math.random() * 10) + 1}`);\r\n            }\r\n\r\n            // Alerts simulation\r\n            if (options.alerts && Math.random() > 0.8) {\r\n              console.log('\\nüö® Active Alerts:');\r\n              console.log(`   ‚ö†Ô∏è  High CPU usage detected`);\r\n              console.log(`   üìä Memory usage approaching threshold`);\r\n            }\r\n\r\n            // Export status\r\n            if (options.export) {\r\n              console.log('\\nüíæ Export Status:');\r\n              console.log(`   Exporting to: ${options.export}`);\r\n              console.log(`   Data points: ${cycles}`);\r\n            }\r\n\r\n            // Footer\r\n            console.log('\\n' + '‚îÄ'.repeat(60));\r\n            console.log(\r\n              `Log Level: ${options.logLevel} ‚Ä¢ Threshold: ${options.threshold}% ‚Ä¢ Press Ctrl+C to exit`,\r\n            );\r\n\r\n            await new Promise((resolve) => setTimeout(resolve, interval));\r\n          } catch (err) {\r\n            error(`Monitor error: ${(err as Error).message}`);\r\n            await new Promise((resolve) => setTimeout(resolve, interval));\r\n          }\r\n        }\r\n\r\n        process.stdout.write('\\x1b[?25h');\r\n      } catch (err) {\r\n        error(`Failed to start enhanced monitor: ${(err as Error).message}`);\r\n      }\r\n    };\r\n\r\n    cli.command({\r\n      name: 'monitor',\r\n      description: 'Enhanced live monitoring dashboard with comprehensive metrics',\r\n      options: [\r\n        {\r\n          name: 'interval',\r\n          short: 'i',\r\n          description: 'Update interval in seconds',\r\n          type: 'number',\r\n          default: 2,\r\n        },\r\n        { name: 'compact', short: 'c', description: 'Compact view mode', type: 'boolean' },\r\n        { name: 'focus', short: 'f', description: 'Focus on specific component', type: 'string' },\r\n        { name: 'alerts', description: 'Enable alert notifications', type: 'boolean' },\r\n        { name: 'export', description: 'Export monitoring data to file', type: 'string' },\r\n        {\r\n          name: 'threshold',\r\n          description: 'Alert threshold percentage',\r\n          type: 'number',\r\n          default: 80,\r\n        },\r\n        {\r\n          name: 'log-level',\r\n          description: 'Log level filter (error, warn, info, debug)',\r\n          type: 'string',\r\n          default: 'info',\r\n        },\r\n        { name: 'no-graphs', description: 'Disable ASCII graphs', type: 'boolean' },\r\n      ],\r\n      action: enhancedMonitorAction,\r\n    });\r\n  } catch (err) {\r\n    warning('Enhanced monitor command not available, using basic version');\r\n\r\n    // Fallback basic monitor command (original implementation)\r\n    cli.command({\r\n      name: 'monitor',\r\n      description: 'Live monitoring dashboard',\r\n      options: [\r\n        {\r\n          name: 'interval',\r\n          short: 'i',\r\n          description: 'Update interval in seconds',\r\n          type: 'number',\r\n          default: 2,\r\n        },\r\n        { name: 'compact', short: 'c', description: 'Compact view mode', type: 'boolean' },\r\n        { name: 'focus', short: 'f', description: 'Focus on specific component', type: 'string' },\r\n      ],\r\n      action: async (ctx: CommandContext) => {\r\n        // Original basic monitor implementation\r\n        try {\r\n          const persist = await getPersistence();\r\n          const { access } = await import('fs/promises');\r\n          const isRunning = await access('orchestrator.log')\r\n            .then(() => true)\r\n            .catch(() => false);\r\n\r\n          if (!isRunning) {\r\n            warning(\"Orchestrator is not running. Start it first with 'claude-flow start'\");\r\n            return;\r\n          }\r\n\r\n          info('Starting basic monitoring dashboard...');\r\n          console.log('Press Ctrl+C to exit');\r\n\r\n          const interval = ((ctx.flags.interval as number) || 2) * 1000;\r\n          let running = true;\r\n\r\n          const cleanup = () => {\r\n            running = false;\r\n            console.log('\\nMonitor stopped');\r\n            process.exit(0);\r\n          };\r\n\r\n          process.on('SIGINT', cleanup);\r\n\r\n          while (running) {\r\n            console.clear();\r\n            const stats = await persist.getStats();\r\n            success('Claude-Flow Live Monitor');\r\n            console.log(`üü¢ Status: Running`);\r\n            console.log(`ü§ñ Agents: ${stats.activeAgents} active`);\r\n            console.log(`üìã Tasks: ${stats.pendingTasks} pending`);\r\n            console.log(`Last updated: ${new Date().toLocaleTimeString()}`);\r\n            await new Promise((resolve) => setTimeout(resolve, interval));\r\n          }\r\n        } catch (err) {\r\n          error(`Failed to start monitor: ${(err as Error).message}`);\r\n        }\r\n      },\r\n    });\r\n  }\r\n\r\n  // Swarm command\r\n  cli.command({\r\n    name: 'swarm',\r\n    description: 'Create self-orchestrating Claude agent swarms',\r\n    options: [\r\n      {\r\n        name: 'strategy',\r\n        short: 's',\r\n        description:\r\n          'Orchestration strategy (auto, research, development, analysis, testing, optimization, maintenance)',\r\n        type: 'string',\r\n        default: 'auto',\r\n      },\r\n      {\r\n        name: 'mode',\r\n        short: 'm',\r\n        description: 'Coordination mode (centralized, distributed, hierarchical, mesh, hybrid)',\r\n        type: 'string',\r\n        default: 'centralized',\r\n      },\r\n      {\r\n        name: 'max-agents',\r\n        description: 'Maximum number of agents to spawn',\r\n        type: 'number',\r\n        default: 5,\r\n      },\r\n      {\r\n        name: 'max-depth',\r\n        description: 'Maximum delegation depth',\r\n        type: 'number',\r\n        default: 3,\r\n      },\r\n      {\r\n        name: 'research',\r\n        description: 'Enable research capabilities for all agents',\r\n        type: 'boolean',\r\n      },\r\n      {\r\n        name: 'parallel',\r\n        description: 'Enable parallel execution',\r\n        type: 'boolean',\r\n      },\r\n      {\r\n        name: 'memory-namespace',\r\n        description: 'Shared memory namespace',\r\n        type: 'string',\r\n        default: 'swarm',\r\n      },\r\n      {\r\n        name: 'timeout',\r\n        description: 'Swarm timeout in minutes',\r\n        type: 'number',\r\n        default: 60,\r\n      },\r\n      {\r\n        name: 'review',\r\n        description: 'Enable peer review between agents',\r\n        type: 'boolean',\r\n      },\r\n      {\r\n        name: 'coordinator',\r\n        description: 'Spawn dedicated coordinator agent',\r\n        type: 'boolean',\r\n      },\r\n      {\r\n        name: 'config',\r\n        short: 'c',\r\n        description: 'MCP config file',\r\n        type: 'string',\r\n      },\r\n      {\r\n        name: 'verbose',\r\n        short: 'v',\r\n        description: 'Enable verbose output',\r\n        type: 'boolean',\r\n      },\r\n      {\r\n        name: 'dry-run',\r\n        short: 'd',\r\n        description: 'Preview swarm configuration',\r\n        type: 'boolean',\r\n      },\r\n      {\r\n        name: 'vscode',\r\n        description: 'Use VS Code terminal integration',\r\n        type: 'boolean',\r\n      },\r\n      {\r\n        name: 'monitor',\r\n        description: 'Enable real-time monitoring',\r\n        type: 'boolean',\r\n      },\r\n      {\r\n        name: 'ui',\r\n        description: 'Use blessed terminal UI (avoids TTY issues)',\r\n        type: 'boolean',\r\n      },\r\n      {\r\n        name: 'claude',\r\n        description: 'Launch Claude Code with swarm coordination prompt',\r\n        type: 'boolean',\r\n      },\r\n      {\r\n        name: 'executor',\r\n        description: 'Use built-in executor instead of Claude Code',\r\n        type: 'boolean',\r\n      },\r\n    ],\r\n    action: swarmAction,\r\n  });\r\n\r\n  // Enhanced SPARC command\r\n  cli.command({\r\n    name: 'sparc',\r\n    description: 'Enhanced SPARC-based TDD development with specialized modes and orchestration',\r\n    options: [\r\n      {\r\n        name: 'namespace',\r\n        short: 'n',\r\n        description: 'Memory namespace for this session',\r\n        type: 'string',\r\n        default: 'sparc',\r\n      },\r\n      {\r\n        name: 'no-permissions',\r\n        description: 'Skip permission prompts',\r\n        type: 'boolean',\r\n      },\r\n      {\r\n        name: 'config',\r\n        short: 'c',\r\n        description: 'MCP configuration file',\r\n        type: 'string',\r\n      },\r\n      {\r\n        name: 'verbose',\r\n        short: 'v',\r\n        description: 'Enable verbose output',\r\n        type: 'boolean',\r\n      },\r\n      {\r\n        name: 'dry-run',\r\n        short: 'd',\r\n        description: 'Preview what would be executed',\r\n        type: 'boolean',\r\n      },\r\n      {\r\n        name: 'sequential',\r\n        description: 'Wait between workflow steps',\r\n        type: 'boolean',\r\n        default: true,\r\n      },\r\n      {\r\n        name: 'batch',\r\n        description: 'Enable batch operations for efficiency',\r\n        type: 'boolean',\r\n      },\r\n      {\r\n        name: 'parallel',\r\n        description: 'Enable parallel agent execution',\r\n        type: 'boolean',\r\n      },\r\n      {\r\n        name: 'orchestration',\r\n        description: 'Enable orchestration features',\r\n        type: 'boolean',\r\n        default: true,\r\n      },\r\n    ],\r\n    action: async (ctx: CommandContext) => {\r\n      try {\r\n        console.log(chalk.cyan('üöÄ Enhanced SPARC Development Mode'));\r\n        console.log('Features: TDD + Orchestration + Batch Operations + Memory Management');\r\n\r\n        if (ctx.flags.batch) {\r\n          console.log('‚ú® Batch operations enabled for efficient file handling');\r\n        }\r\n\r\n        if (ctx.flags.parallel) {\r\n          console.log('‚ö° Parallel agent execution enabled');\r\n        }\r\n\r\n        if (ctx.flags.orchestration) {\r\n          console.log('üéº Orchestration features enabled');\r\n        }\r\n\r\n        // Call the original SPARC action with enhanced features\r\n        await sparcAction(ctx);\r\n      } catch (err) {\r\n        error(`Enhanced SPARC failed: ${(err as Error).message}`);\r\n      }\r\n    },\r\n  });\r\n\r\n  // Migration command\r\n  const migrateCmd = createMigrateCommand();\r\n  cli.command(migrateCmd as any);\r\n\r\n  // Swarm UI command (convenience wrapper)\r\n  cli.command({\r\n    name: 'swarm-ui',\r\n    description: 'Create self-orchestrating Claude agent swarms with blessed UI',\r\n    options: [\r\n      {\r\n        name: 'strategy',\r\n        short: 's',\r\n        description: 'Orchestration strategy (auto, research, development, analysis)',\r\n        type: 'string',\r\n        default: 'auto',\r\n      },\r\n      {\r\n        name: 'max-agents',\r\n        description: 'Maximum number of agents to spawn',\r\n        type: 'number',\r\n        default: 5,\r\n      },\r\n      {\r\n        name: 'max-depth',\r\n        description: 'Maximum delegation depth',\r\n        type: 'number',\r\n        default: 3,\r\n      },\r\n      {\r\n        name: 'research',\r\n        description: 'Enable research capabilities for all agents',\r\n        type: 'boolean',\r\n      },\r\n      {\r\n        name: 'parallel',\r\n        description: 'Enable parallel execution',\r\n        type: 'boolean',\r\n      },\r\n      {\r\n        name: 'memory-namespace',\r\n        description: 'Shared memory namespace',\r\n        type: 'string',\r\n        default: 'swarm',\r\n      },\r\n      {\r\n        name: 'timeout',\r\n        description: 'Swarm timeout in minutes',\r\n        type: 'number',\r\n        default: 60,\r\n      },\r\n      {\r\n        name: 'review',\r\n        description: 'Enable peer review between agents',\r\n        type: 'boolean',\r\n      },\r\n      {\r\n        name: 'coordinator',\r\n        description: 'Spawn dedicated coordinator agent',\r\n        type: 'boolean',\r\n      },\r\n      {\r\n        name: 'config',\r\n        short: 'c',\r\n        description: 'MCP config file',\r\n        type: 'string',\r\n      },\r\n      {\r\n        name: 'verbose',\r\n        short: 'v',\r\n        description: 'Enable verbose output',\r\n        type: 'boolean',\r\n      },\r\n      {\r\n        name: 'dry-run',\r\n        short: 'd',\r\n        description: 'Preview swarm configuration',\r\n        type: 'boolean',\r\n      },\r\n    ],\r\n    action: async (ctx: CommandContext) => {\r\n      // Force UI mode\r\n      ctx.flags.ui = true;\r\n      await swarmAction(ctx);\r\n    },\r\n  });\r\n\r\n  // Enhanced session command integration\r\n  try {\r\n    const enhancedSessionAction = async (ctx: CommandContext) => {\r\n      console.log(chalk.cyan('üíæ Enhanced Session Management'));\r\n      console.log('For full enhanced functionality, use: claude-flow session <command> [options]');\r\n      console.log();\r\n      console.log('Available commands:');\r\n      console.log('  list          - List all saved sessions with status');\r\n      console.log('  save          - Save current session state');\r\n      console.log('  restore       - Restore a saved session');\r\n      console.log('  delete        - Delete a saved session');\r\n      console.log('  export        - Export session to file');\r\n      console.log('  import        - Import session from file');\r\n      console.log('  info          - Show detailed session information');\r\n      console.log('  clean         - Clean up old or orphaned sessions');\r\n      console.log('  backup        - Backup sessions to archive');\r\n      console.log('  restore-backup - Restore sessions from backup');\r\n      console.log('  validate      - Validate session integrity');\r\n      console.log('  monitor       - Monitor active sessions in real-time');\r\n      console.log();\r\n      console.log('Enhanced features:');\r\n      console.log('  ‚ú® Comprehensive lifecycle management');\r\n      console.log('  ‚ú® Terminal session state preservation');\r\n      console.log('  ‚ú® Workflow and agent state tracking');\r\n      console.log('  ‚ú® Integrity validation and repair');\r\n      console.log('  ‚ú® Real-time session monitoring');\r\n      console.log('  ‚ú® Backup and restore capabilities');\r\n\r\n      const subcommand = ctx.args[0];\r\n      if (subcommand) {\r\n        console.log();\r\n        console.log(\r\n          `For detailed help on '${subcommand}', use: claude-flow session ${subcommand} --help`,\r\n        );\r\n      }\r\n    };\r\n\r\n    cli.command({\r\n      name: 'session',\r\n      description: 'Enhanced session management with comprehensive lifecycle support',\r\n      action: enhancedSessionAction,\r\n    });\r\n  } catch (err) {\r\n    warning('Enhanced session command not available');\r\n  }\r\n\r\n  // Enhanced orchestration start command integration\r\n  try {\r\n    const enhancedStartAction = async (ctx: CommandContext) => {\r\n      console.log(chalk.cyan('üß† Enhanced Claude-Flow Orchestration System'));\r\n      console.log('Features: Service Management + Health Checks + Auto-Recovery + Process UI');\r\n      console.log();\r\n\r\n      const options = {\r\n        daemon: ctx.flags.daemon || ctx.flags.d,\r\n        port: ctx.flags.port || ctx.flags.p || 3000,\r\n        mcpTransport: ctx.flags.mcpTransport || ctx.flags['mcp-transport'] || 'stdio',\r\n        ui: ctx.flags.ui || ctx.flags.u,\r\n        verbose: ctx.flags.verbose || ctx.flags.v,\r\n        autoStart: ctx.flags.autoStart || ctx.flags['auto-start'],\r\n        config: ctx.flags.config,\r\n        force: ctx.flags.force,\r\n        healthCheck: ctx.flags.healthCheck || ctx.flags['health-check'],\r\n        timeout: ctx.flags.timeout || 60,\r\n      };\r\n\r\n      if (options.ui) {\r\n        console.log('üéÆ Launching interactive process management UI...');\r\n      }\r\n\r\n      if (options.daemon) {\r\n        console.log('üîß Starting in daemon mode with enhanced service management...');\r\n      }\r\n\r\n      if (options.healthCheck) {\r\n        console.log('üè• Performing pre-flight health checks...');\r\n      }\r\n\r\n      console.log();\r\n      console.log('For full enhanced functionality, use: claude-flow start [options]');\r\n      console.log(\r\n        'Available options: --daemon, --port, --mcp-transport, --ui, --verbose, --auto-start, --force, --health-check, --timeout',\r\n      );\r\n\r\n      // Fallback to basic start functionality\r\n      try {\r\n        const orch = await getOrchestrator();\r\n        await orch.start();\r\n\r\n        success('Enhanced orchestration system started!');\r\n        info('Components initialized with enhanced features:');\r\n        console.log('   ‚úì Event Bus with advanced routing');\r\n        console.log('   ‚úì Orchestrator Engine with service management');\r\n        console.log('   ‚úì Memory Manager with integrity checking');\r\n        console.log('   ‚úì Terminal Pool with session recovery');\r\n        console.log('   ‚úì MCP Server with enhanced transport');\r\n        console.log('   ‚úì Coordination Manager with load balancing');\r\n\r\n        if (!options.daemon) {\r\n          info('Press Ctrl+C to stop the enhanced system');\r\n          const controller = new AbortController();\r\n          const shutdown = () => {\r\n            console.log('\\nShutting down enhanced system...');\r\n            controller.abort();\r\n          };\r\n          process.on('SIGINT', shutdown);\r\n          process.on('SIGTERM', shutdown);\r\n\r\n          await new Promise<void>((resolve) => {\r\n            controller.signal.addEventListener('abort', () => resolve());\r\n          });\r\n        }\r\n      } catch (err) {\r\n        error(`Failed to start enhanced system: ${(err as Error).message}`);\r\n        process.exit(1);\r\n      }\r\n    };\r\n\r\n    // Override the existing start command with enhanced version\r\n    cli.command({\r\n      name: 'start',\r\n      description: 'Start the enhanced orchestration system with comprehensive service management',\r\n      options: [\r\n        { name: 'daemon', short: 'd', description: 'Run as daemon in background', type: 'boolean' },\r\n        { name: 'port', short: 'p', description: 'MCP server port', type: 'number', default: 3000 },\r\n        {\r\n          name: 'mcp-transport',\r\n          description: 'MCP transport type (stdio, http)',\r\n          type: 'string',\r\n          default: 'stdio',\r\n        },\r\n        {\r\n          name: 'ui',\r\n          short: 'u',\r\n          description: 'Launch interactive process management UI',\r\n          type: 'boolean',\r\n        },\r\n        { name: 'verbose', short: 'v', description: 'Enable verbose logging', type: 'boolean' },\r\n        { name: 'auto-start', description: 'Automatically start all processes', type: 'boolean' },\r\n        { name: 'config', description: 'Configuration file path', type: 'string' },\r\n        { name: 'force', description: 'Force start even if already running', type: 'boolean' },\r\n        {\r\n          name: 'health-check',\r\n          description: 'Perform health checks before starting',\r\n          type: 'boolean',\r\n        },\r\n        { name: 'timeout', description: 'Startup timeout in seconds', type: 'number', default: 60 },\r\n      ],\r\n      action: enhancedStartAction,\r\n    });\r\n  } catch (err) {\r\n    warning('Enhanced start command not available, using basic version');\r\n  }\r\n\r\n  // Help command\r\n  cli.command({\r\n    name: 'help',\r\n    description: 'Show help information',\r\n    action: (ctx: CommandContext) => {\r\n      const command = ctx.args[0];\r\n\r\n      if (command === 'claude') {\r\n        console.log(bold(blue('Claude Instance Management')));\r\n        console.log();\r\n        console.log('Spawn and manage Claude Code instances with specific configurations.');\r\n        console.log();\r\n        console.log(bold('Subcommands:'));\r\n        console.log('  spawn <task>    Spawn Claude with specific configuration');\r\n        console.log('  batch <file>    Execute multiple Claude instances from workflow');\r\n        console.log();\r\n        console.log(bold('Spawn Options:'));\r\n        console.log('  -t, --tools <tools>        Allowed tools (comma-separated)');\r\n        console.log('  --no-permissions           Use --dangerously-skip-permissions flag');\r\n        console.log('  -c, --config <file>        MCP config file path');\r\n        console.log(\r\n          '  -m, --mode <mode>          Development mode (full/backend-only/frontend-only/api-only)',\r\n        );\r\n        console.log('  --parallel                 Enable parallel execution with BatchTool');\r\n        console.log('  --research                 Enable web research with WebFetchTool');\r\n        console.log('  --coverage <n>             Test coverage target percentage (default: 80)');\r\n        console.log('  --commit <freq>            Commit frequency (phase/feature/manual)');\r\n        console.log('  -v, --verbose              Enable verbose output');\r\n        console.log('  -d, --dry-run              Show what would be executed without running');\r\n        console.log();\r\n        console.log(bold('Examples:'));\r\n        console.log(\r\n          `  ${blue('claude-flow claude spawn')} \"implement user authentication\" --research --parallel`,\r\n        );\r\n        console.log(\r\n          `  ${blue('claude-flow claude spawn')} \"fix payment bug\" --tools \"View,Edit,Bash\" --no-permissions`,\r\n        );\r\n        console.log(`  ${blue('claude-flow claude batch')} workflow.json --dry-run`);\r\n        console.log();\r\n        console.log(\r\n          'For more information, see: https://github.com/ruvnet/claude-code-flow/docs/11-claude-spawning.md',\r\n        );\r\n      } else if (command === 'swarm' || command === 'swarm-ui') {\r\n        console.log(bold(blue('Claude Swarm Mode')));\r\n        console.log();\r\n        console.log('Create self-orchestrating Claude agent swarms to tackle complex objectives.');\r\n        console.log();\r\n        console.log(bold('Usage:'));\r\n        console.log('  claude-flow swarm <objective> [options]');\r\n        console.log(\r\n          '  claude-flow swarm-ui <objective> [options]  # Uses blessed UI (avoids TTY issues)',\r\n        );\r\n        console.log();\r\n        console.log(bold('Options:'));\r\n        console.log(\r\n          '  -s, --strategy <s>         Orchestration strategy (auto, research, development, analysis)',\r\n        );\r\n        console.log('  --max-agents <n>           Maximum number of agents (default: 5)');\r\n        console.log('  --max-depth <n>            Maximum delegation depth (default: 3)');\r\n        console.log('  --research                 Enable research capabilities for all agents');\r\n        console.log('  --parallel                 Enable parallel execution');\r\n        console.log('  --memory-namespace <ns>    Shared memory namespace (default: swarm)');\r\n        console.log('  --timeout <minutes>        Swarm timeout in minutes (default: 60)');\r\n        console.log('  --review                   Enable peer review between agents');\r\n        console.log('  --coordinator              Spawn dedicated coordinator agent');\r\n        console.log('  -c, --config <file>        MCP config file');\r\n        console.log('  -v, --verbose              Enable verbose output');\r\n        console.log('  -d, --dry-run              Preview swarm configuration');\r\n        console.log('  --vscode                   Use VS Code terminal integration');\r\n        console.log('  --monitor                  Enable real-time monitoring');\r\n        console.log('  --ui                       Use blessed terminal UI (avoids TTY issues)');\r\n        console.log();\r\n        console.log(bold('Examples:'));\r\n        console.log(`  ${blue('claude-flow swarm')} \"Build a REST API\"`);\r\n        console.log(`  ${blue('claude-flow swarm-ui')} \"Build a REST API\"  # Avoids TTY issues`);\r\n        console.log(\r\n          `  ${blue('claude-flow swarm')} \"Research cloud architecture\" --strategy research --research`,\r\n        );\r\n        console.log(\r\n          `  ${blue('claude-flow swarm')} \"Migrate app to microservices\" --coordinator --review --ui`,\r\n        );\r\n        console.log();\r\n        console.log(bold('TTY Issues?'));\r\n        console.log(\"If you encounter 'Raw mode is not supported' errors, use:\");\r\n        console.log(`  - ${blue('claude-flow swarm-ui')} <objective>  # Recommended`);\r\n        console.log(`  - ${blue('claude-flow swarm')} <objective> --ui`);\r\n        console.log();\r\n        console.log('For more information, see:');\r\n        console.log('  - https://github.com/ruvnet/claude-code-flow/docs/12-swarm.md');\r\n        console.log('  - https://github.com/ruvnet/claude-code-flow/SWARM_TTY_SOLUTION.md');\r\n      } else if (command === 'sparc') {\r\n        console.log(bold(blue('SPARC Development Mode')));\r\n        console.log();\r\n        console.log('SPARC (Specification, Pseudocode, Architecture, Refinement, Completion)');\r\n        console.log(\r\n          'TDD-based development with specialized AI modes from .roomodes configuration.',\r\n        );\r\n        console.log();\r\n        console.log(bold('Subcommands:'));\r\n        console.log('  modes                    List all available SPARC modes');\r\n        console.log('  info <mode>              Show detailed information about a mode');\r\n        console.log('  run <mode> <task>        Execute a task using a specific SPARC mode');\r\n        console.log('  tdd <task>               Run full TDD workflow using SPARC methodology');\r\n        console.log('  workflow <file>          Execute a custom SPARC workflow from JSON file');\r\n        console.log();\r\n        console.log(bold('Common Modes:'));\r\n        console.log('  spec-pseudocode          Create specifications and pseudocode');\r\n        console.log('  architect                Design system architecture');\r\n        console.log('  code                     Implement code solutions');\r\n        console.log('  tdd                      Test-driven development');\r\n        console.log('  debug                    Debug and troubleshoot issues');\r\n        console.log('  security-review          Security analysis and review');\r\n        console.log('  docs-writer              Documentation creation');\r\n        console.log('  integration              System integration and testing');\r\n        console.log();\r\n        console.log(bold('Options:'));\r\n        console.log('  -n, --namespace <ns>     Memory namespace for this session');\r\n        console.log('  --no-permissions         Skip permission prompts');\r\n        console.log('  -c, --config <file>      MCP configuration file');\r\n        console.log('  -v, --verbose            Enable verbose output');\r\n        console.log('  -d, --dry-run            Preview what would be executed');\r\n        console.log('  --sequential             Wait between workflow steps (default: true)');\r\n        console.log();\r\n        console.log(bold('Examples:'));\r\n        console.log(\r\n          `  ${blue('claude-flow sparc modes')}                              # List all modes`,\r\n        );\r\n        console.log(\r\n          `  ${blue('claude-flow sparc run code')} \"implement user auth\"      # Run specific mode`,\r\n        );\r\n        console.log(\r\n          `  ${blue('claude-flow sparc tdd')} \"payment processing system\"    # Full TDD workflow`,\r\n        );\r\n        console.log(\r\n          `  ${blue('claude-flow sparc workflow')} project-workflow.json     # Custom workflow`,\r\n        );\r\n        console.log();\r\n        console.log(\r\n          'For more information, see: https://github.com/ruvnet/claude-code-flow/docs/sparc.md',\r\n        );\r\n      } else if (command === 'start') {\r\n        console.log(bold(blue('Enhanced Start Command')));\r\n        console.log();\r\n        console.log(\r\n          'Start the Claude-Flow orchestration system with comprehensive service management.',\r\n        );\r\n        console.log();\r\n        console.log(bold('Usage:'));\r\n        console.log('  claude-flow start [options]');\r\n        console.log();\r\n        console.log(bold('Options:'));\r\n        console.log('  -d, --daemon              Run as daemon in background');\r\n        console.log('  -p, --port <port>         MCP server port (default: 3000)');\r\n        console.log('  --mcp-transport <type>    MCP transport type (stdio, http)');\r\n        console.log('  -u, --ui                  Launch interactive process management UI');\r\n        console.log('  -v, --verbose             Enable verbose logging');\r\n        console.log('  --auto-start              Automatically start all processes');\r\n        console.log('  --config <path>           Configuration file path');\r\n        console.log('  --force                   Force start even if already running');\r\n        console.log('  --health-check            Perform health checks before starting');\r\n        console.log('  --timeout <seconds>       Startup timeout in seconds (default: 60)');\r\n        console.log();\r\n        console.log(bold('Examples:'));\r\n        console.log(`  ${blue('claude-flow start')}                    # Interactive mode`);\r\n        console.log(`  ${blue('claude-flow start --daemon')}           # Background daemon`);\r\n        console.log(`  ${blue('claude-flow start --ui')}               # Process management UI`);\r\n        console.log(`  ${blue('claude-flow start --health-check')}     # With pre-flight checks`);\r\n      } else if (command === 'status') {\r\n        console.log(bold(blue('Enhanced Status Command')));\r\n        console.log();\r\n        console.log('Show comprehensive Claude-Flow system status with detailed reporting.');\r\n        console.log();\r\n        console.log(bold('Usage:'));\r\n        console.log('  claude-flow status [options]');\r\n        console.log();\r\n        console.log(bold('Options:'));\r\n        console.log('  -w, --watch              Watch mode - continuously update status');\r\n        console.log('  -i, --interval <seconds> Update interval in seconds (default: 5)');\r\n        console.log('  -c, --component <name>   Show status for specific component');\r\n        console.log('  --json                   Output in JSON format');\r\n        console.log('  --detailed               Show detailed component information');\r\n        console.log('  --health-check           Perform comprehensive health checks');\r\n        console.log('  --history                Show status history from logs');\r\n        console.log();\r\n        console.log(bold('Examples:'));\r\n        console.log(`  ${blue('claude-flow status')}                   # Basic status`);\r\n        console.log(`  ${blue('claude-flow status --watch')}           # Live updates`);\r\n        console.log(`  ${blue('claude-flow status --detailed')}        # Comprehensive info`);\r\n        console.log(`  ${blue('claude-flow status --component mcp')}   # Specific component`);\r\n      } else if (command === 'monitor') {\r\n        console.log(bold(blue('Enhanced Monitor Command')));\r\n        console.log();\r\n        console.log('Real-time monitoring dashboard with comprehensive metrics and alerting.');\r\n        console.log();\r\n        console.log(bold('Usage:'));\r\n        console.log('  claude-flow monitor [options]');\r\n        console.log();\r\n        console.log(bold('Options:'));\r\n        console.log('  -i, --interval <seconds> Update interval in seconds (default: 2)');\r\n        console.log('  -c, --compact            Compact view mode');\r\n        console.log('  --focus <component>      Focus on specific component');\r\n        console.log('  --alerts                 Enable alert notifications');\r\n        console.log('  --export <file>          Export monitoring data to file');\r\n        console.log('  --threshold <percent>    Alert threshold percentage (default: 80)');\r\n        console.log('  --log-level <level>      Log level filter (error, warn, info, debug)');\r\n        console.log('  --no-graphs              Disable ASCII graphs');\r\n        console.log();\r\n        console.log(bold('Examples:'));\r\n        console.log(`  ${blue('claude-flow monitor')}                  # Basic monitoring`);\r\n        console.log(`  ${blue('claude-flow monitor --alerts')}         # With alerting`);\r\n        console.log(`  ${blue('claude-flow monitor --focus mcp')}      # Component focus`);\r\n        console.log(`  ${blue('claude-flow monitor --export data.json')} # Data export`);\r\n      } else if (command === 'session') {\r\n        console.log(bold(blue('Enhanced Session Management')));\r\n        console.log();\r\n        console.log('Comprehensive session lifecycle management with backup and recovery.');\r\n        console.log();\r\n        console.log(bold('Commands:'));\r\n        console.log('  list                     List all saved sessions');\r\n        console.log('  save [name]              Save current session state');\r\n        console.log('  restore <session-id>     Restore a saved session');\r\n        console.log('  delete <session-id>      Delete a saved session');\r\n        console.log('  export <session-id> <file> Export session to file');\r\n        console.log('  import <file>            Import session from file');\r\n        console.log('  info <session-id>        Show detailed session information');\r\n        console.log('  clean                    Clean up old or orphaned sessions');\r\n        console.log('  backup [session-id]      Backup sessions to archive');\r\n        console.log('  restore-backup <file>    Restore sessions from backup');\r\n        console.log('  validate [session-id]    Validate session integrity');\r\n        console.log('  monitor                  Monitor active sessions');\r\n        console.log();\r\n        console.log(bold('Examples:'));\r\n        console.log(`  ${blue('claude-flow session list')}             # List sessions`);\r\n        console.log(`  ${blue('claude-flow session save mywork')}      # Save session`);\r\n        console.log(`  ${blue('claude-flow session restore abc123')}   # Restore session`);\r\n        console.log(`  ${blue('claude-flow session validate --fix')}   # Validate and fix`);\r\n      } else {\r\n        // Show general help with enhanced commands\r\n        console.log(bold(blue('Claude-Flow Enhanced Orchestration System')));\r\n        console.log();\r\n        console.log('Available commands:');\r\n        console.log('  start        Enhanced orchestration system startup');\r\n        console.log('  status       Comprehensive system status reporting');\r\n        console.log('  monitor      Real-time monitoring dashboard');\r\n        console.log('  session      Advanced session management');\r\n        console.log('  swarm        Self-orchestrating agent swarms');\r\n        console.log('  sparc        Enhanced TDD development modes');\r\n        console.log('  agent        Agent management and coordination');\r\n        console.log('  task         Task creation and management');\r\n        console.log('  memory       Memory bank operations');\r\n        console.log('  mcp          MCP server management');\r\n        console.log('  claude       Claude instance spawning');\r\n        console.log();\r\n        console.log('For detailed help on any command, use:');\r\n        console.log(`  ${blue('claude-flow help <command>')}`);\r\n        console.log();\r\n        console.log('Enhanced features:');\r\n        console.log('  ‚ú® Comprehensive service management');\r\n        console.log('  ‚ú® Real-time monitoring and alerting');\r\n        console.log('  ‚ú® Advanced session lifecycle management');\r\n        console.log('  ‚ú® Batch operations and parallel execution');\r\n        console.log('  ‚ú® Health checks and auto-recovery');\r\n        console.log('  ‚ú® Process management UI');\r\n      }\r\n    },\r\n  });\r\n\r\n  // Add enhanced command documentation\r\n  console.log(chalk.cyan('\\nüöÄ Enhanced Commands Loaded:'));\r\n  console.log('  ‚úì start    - Enhanced orchestration with service management');\r\n  console.log('  ‚úì status   - Comprehensive system status reporting');\r\n  console.log('  ‚úì monitor  - Real-time monitoring with metrics and alerts');\r\n  console.log('  ‚úì session  - Advanced session lifecycle management');\r\n  console.log('  ‚úì sparc    - Enhanced TDD with orchestration features');\r\n  console.log();\r\n  console.log('For detailed help on enhanced commands: claude-flow help <command>');\r\n\r\n  // Hive Mind command\r\n  cli.command({\r\n    name: 'hive-mind',\r\n    description: 'Collective intelligence swarm management',\r\n    aliases: ['hive', 'swarm'],\r\n    options: [\r\n      {\r\n        name: 'command',\r\n        description: 'Hive Mind command (init, spawn, status, task, wizard)',\r\n        type: 'string',\r\n      },\r\n      {\r\n        name: 'swarm-id',\r\n        short: 's',\r\n        description: 'Swarm ID to operate on',\r\n        type: 'string',\r\n      },\r\n      {\r\n        name: 'topology',\r\n        short: 't',\r\n        description: 'Swarm topology (mesh, hierarchical, ring, star)',\r\n        type: 'string',\r\n        default: 'hierarchical',\r\n      },\r\n      {\r\n        name: 'max-agents',\r\n        short: 'm',\r\n        description: 'Maximum number of agents',\r\n        type: 'number',\r\n        default: 8,\r\n      },\r\n      {\r\n        name: 'interactive',\r\n        short: 'i',\r\n        description: 'Run in interactive mode',\r\n        type: 'boolean',\r\n      },\r\n    ],\r\n    action: async (ctx: CommandContext) => {\r\n      try {\r\n        const subcommand = ctx.args[0] || 'wizard';\r\n\r\n        // Import hive-mind commands dynamically\r\n        const { hiveMindCommand } = await import('./hive-mind/index.js');\r\n\r\n        // Execute the appropriate subcommand\r\n        switch (subcommand) {\r\n          case 'init':\r\n            const { initCommand } = await import('./hive-mind/init.js');\r\n            await initCommand.parseAsync(process.argv.slice(3));\r\n            break;\r\n          case 'spawn':\r\n            const { spawnCommand } = await import('./hive-mind/spawn.js');\r\n            await spawnCommand.parseAsync(process.argv.slice(3));\r\n            break;\r\n          case 'status':\r\n            const { statusCommand } = await import('./hive-mind/status.js');\r\n            await statusCommand.parseAsync(process.argv.slice(3));\r\n            break;\r\n          case 'task':\r\n            const { taskCommand } = await import('./hive-mind/task.js');\r\n            await taskCommand.parseAsync(process.argv.slice(3));\r\n            break;\r\n          case 'stop':\r\n            const { stopCommand } = await import('./hive-mind/stop.js');\r\n            await stopCommand.parseAsync(process.argv.slice(3));\r\n            break;\r\n          case 'pause':\r\n            const { pauseCommand } = await import('./hive-mind/pause.js');\r\n            await pauseCommand.parseAsync(process.argv.slice(3));\r\n            break;\r\n          case 'resume':\r\n            const { resumeCommand } = await import('./hive-mind/resume.js');\r\n            await resumeCommand.parseAsync(process.argv.slice(3));\r\n            break;\r\n          case 'ps':\r\n            const { psCommand } = await import('./hive-mind/ps.js');\r\n            await psCommand.parseAsync(process.argv.slice(3));\r\n            break;\r\n          case 'wizard':\r\n          default:\r\n            const { wizardCommand } = await import('./hive-mind/wizard.js');\r\n            await wizardCommand.parseAsync(process.argv.slice(3));\r\n            break;\r\n        }\r\n      } catch (err) {\r\n        error(`Hive Mind error: ${getErrorMessage(err)}`);\r\n      }\r\n    },\r\n  });\r\n\r\n  // Hook command for ruv-swarm integration\r\n  cli.command({\r\n    name: 'hook',\r\n    description: 'Execute ruv-swarm hooks for agent coordination',\r\n    action: async (ctx: CommandContext) => {\r\n      try {\r\n        const { spawn } = await import('child_process');\r\n\r\n        // Pass all arguments to ruv-swarm hook command\r\n        const args = ctx.args.length > 0 ? ctx.args : ['--help'];\r\n\r\n        const child = spawn('npx', ['ruv-swarm', 'hook', ...args], {\r\n          stdio: 'inherit',\r\n          shell: true,\r\n        });\r\n\r\n        await new Promise<void>((resolve, reject) => {\r\n          child.on('exit', (code) => {\r\n            if (code === 0) {\r\n              resolve();\r\n            } else {\r\n              // Don't throw error, just resolve to match expected behavior\r\n              resolve();\r\n            }\r\n          });\r\n\r\n          child.on('error', (err) => {\r\n            error(`Failed to execute hook command: ${getErrorMessage(err)}`);\r\n            resolve();\r\n          });\r\n        });\r\n      } catch (err) {\r\n        error(`Hook command error: ${getErrorMessage(err)}`);\r\n      }\r\n    },\r\n  });\r\n\r\n  // Add enterprise commands\r\n  for (const command of enterpriseCommands) {\r\n    cli.command(command);\r\n  }\r\n}\r\n\r\nfunction getCapabilitiesForType(type: string): string[] {\r\n  const capabilities: Record<string, string[]> = {\r\n    coordinator: ['task-assignment', 'planning', 'delegation'],\r\n    researcher: ['web-search', 'information-gathering', 'analysis'],\r\n    implementer: ['code-generation', 'file-manipulation', 'testing'],\r\n    analyst: ['data-analysis', 'pattern-recognition', 'reporting'],\r\n    custom: ['user-defined'],\r\n  };\r\n\r\n  return capabilities[type] || capabilities.custom;\r\n}\r\n\r\nfunction getDefaultPromptForType(type: string): string {\r\n  const prompts: Record<string, string> = {\r\n    coordinator: 'You are a coordination agent responsible for planning and delegating tasks.',\r\n    researcher: 'You are a research agent specialized in gathering and analyzing information.',\r\n    implementer: 'You are an implementation agent focused on writing code and creating solutions.',\r\n    analyst: 'You are an analysis agent that identifies patterns and generates insights.',\r\n    custom: \"You are a custom agent. Follow the user's instructions.\",\r\n  };\r\n\r\n  return prompts[type] || prompts.custom;\r\n}\r\n\r\n// Template creation functions\r\nfunction createMinimalClaudeMd(): string {\r\n  return `# Claude Code Configuration\r\n\r\n## Build Commands\r\n- \\`npm run build\\`: Build the project\r\n- \\`npm run test\\`: Run tests\r\n- \\`npm run lint\\`: Run linter\r\n\r\n## Code Style\r\n- Use TypeScript/ES modules\r\n- Follow project conventions\r\n- Run typecheck before committing\r\n\r\n## Project Info\r\nThis is a Claude-Flow AI agent orchestration system.\r\n`;\r\n}\r\n\r\n\r\nfunction createFullClaudeMd(): string {\r\n  return `# Claude Code Configuration\r\n\r\n## Build Commands\r\n- \\`npm run build\\`: Build the project using Deno compile\r\n- \\`npm run test\\`: Run the full test suite\r\n- \\`npm run lint\\`: Run ESLint and format checks\r\n- \\`npm run typecheck\\`: Run TypeScript type checking\r\n- \\`npx claude-flow start\\`: Start the orchestration system\r\n- \\`npx claude-flow --help\\`: Show all available commands\r\n\r\n## Code Style Preferences\r\n- Use ES modules (import/export) syntax, not CommonJS (require)\r\n- Destructure imports when possible (e.g., \\`import { foo } from 'bar'\\`)\r\n- Use TypeScript for all new code\r\n- Follow existing naming conventions (camelCase for variables, PascalCase for classes)\r\n- Add JSDoc comments for public APIs\r\n- Use async/await instead of Promise chains\r\n- Prefer const/let over var\r\n\r\n## Workflow Guidelines\r\n- Always run typecheck after making code changes\r\n- Run tests before committing changes\r\n- Use meaningful commit messages following conventional commits\r\n- Create feature branches for new functionality\r\n- Ensure all tests pass before merging\r\n\r\n## Project Architecture\r\nThis is a Claude-Flow AI agent orchestration system with the following components:\r\n- **CLI Interface**: Command-line tools for managing the system\r\n- **Orchestrator**: Core engine for coordinating agents and tasks\r\n- **Memory System**: Persistent storage and retrieval of information\r\n- **Terminal Management**: Automated terminal session handling\r\n- **MCP Integration**: Model Context Protocol server for Claude integration\r\n- **Agent Coordination**: Multi-agent task distribution and management\r\n\r\n## Important Notes\r\n- Use \\`claude --dangerously-skip-permissions\\` for unattended operation\r\n- The system supports both daemon and interactive modes\r\n- Memory persistence is handled automatically\r\n- All components are event-driven for scalability\r\n\r\n## Debugging\r\n- Check logs in \\`./claude-flow.log\\`\r\n- Use \\`npx claude-flow status\\` to check system health\r\n- Monitor with \\`npx claude-flow monitor\\` for real-time updates\r\n- Verbose output available with \\`--verbose\\` flag on most commands\r\n`;\r\n}\r\n\r\n\r\nfunction createMinimalMemoryBankMd(): string {\r\n  return `# Memory Bank\r\n\r\n## Quick Reference\r\n- Project uses SQLite for memory persistence\r\n- Memory is organized by namespaces\r\n- Query with \\`npx claude-flow memory query <search>\\`\r\n\r\n## Storage Location\r\n- Database: \\`./memory/claude-flow-data.json\\`\r\n- Sessions: \\`./memory/sessions/\\`\r\n`;\r\n}\r\n\r\n\r\nfunction createFullMemoryBankMd(): string {\r\n  return `# Memory Bank Configuration\r\n\r\n## Overview\r\nThe Claude-Flow memory system provides persistent storage and intelligent retrieval of information across agent sessions. It uses a hybrid approach combining SQL databases with semantic search capabilities.\r\n\r\n## Storage Backends\r\n- **Primary**: JSON database (\\`./memory/claude-flow-data.json\\`)\r\n- **Sessions**: File-based storage in \\`./memory/sessions/\\`\r\n- **Cache**: In-memory cache for frequently accessed data\r\n\r\n## Memory Organization\r\n- **Namespaces**: Logical groupings of related information\r\n- **Sessions**: Time-bound conversation contexts\r\n- **Indexing**: Automatic content indexing for fast retrieval\r\n- **Replication**: Optional distributed storage support\r\n\r\n## Commands\r\n- \\`npx claude-flow memory query <search>\\`: Search stored information\r\n- \\`npx claude-flow memory stats\\`: Show memory usage statistics\r\n- \\`npx claude-flow memory export <file>\\`: Export memory to file\r\n- \\`npx claude-flow memory import <file>\\`: Import memory from file\r\n\r\n## Configuration\r\nMemory settings are configured in \\`claude-flow.config.json\\`:\r\n\\`\\`\\`json\r\n{\r\n  \"memory\": {\r\n    \"backend\": \"json\",\r\n    \"path\": \"./memory/claude-flow-data.json\",\r\n    \"cacheSize\": 1000,\r\n    \"indexing\": true,\r\n    \"namespaces\": [\"default\", \"agents\", \"tasks\", \"sessions\"],\r\n    \"retentionPolicy\": {\r\n      \"sessions\": \"30d\",\r\n      \"tasks\": \"90d\",\r\n      \"agents\": \"permanent\"\r\n    }\r\n  }\r\n}\r\n\\`\\`\\`\r\n\r\n## Best Practices\r\n- Use descriptive namespaces for different data types\r\n- Regular memory exports for backup purposes\r\n- Monitor memory usage with stats command\r\n- Clean up old sessions periodically\r\n\r\n## Memory Types\r\n- **Episodic**: Conversation and interaction history\r\n- **Semantic**: Factual knowledge and relationships\r\n- **Procedural**: Task patterns and workflows\r\n- **Meta**: System configuration and preferences\r\n\r\n## Integration Notes\r\n- Memory is automatically synchronized across agents\r\n- Search supports both exact match and semantic similarity\r\n- Memory contents are private to your local instance\r\n- No data is sent to external services without explicit commands\r\n`;\r\n}\r\n\r\n\r\nfunction createMinimalCoordinationMd(): string {\r\n  return `# Agent Coordination\r\n\r\n## Quick Commands\r\n- \\`npx claude-flow agent spawn <type>\\`: Create new agent\r\n- \\`npx claude-flow agent list\\`: Show active agents\r\n- \\`npx claude-flow task create <type> <description>\\`: Create task\r\n\r\n## Agent Types\r\n- researcher, coder, analyst, coordinator, general\r\n`;\r\n}\r\n\r\n\r\nfunction createFullCoordinationMd(): string {\r\n  return `# Agent Coordination System\r\n\r\n## Overview\r\nThe Claude-Flow coordination system manages multiple AI agents working together on complex tasks. It provides intelligent task distribution, resource management, and inter-agent communication.\r\n\r\n## Agent Types and Capabilities\r\n- **Researcher**: Web search, information gathering, knowledge synthesis\r\n- **Coder**: Code analysis, development, debugging, testing\r\n- **Analyst**: Data processing, pattern recognition, insights generation\r\n- **Coordinator**: Task planning, resource allocation, workflow management\r\n- **General**: Multi-purpose agent with balanced capabilities\r\n\r\n## Task Management\r\n- **Priority Levels**: 1 (lowest) to 10 (highest)\r\n- **Dependencies**: Tasks can depend on completion of other tasks\r\n- **Parallel Execution**: Independent tasks run concurrently\r\n- **Load Balancing**: Automatic distribution based on agent capacity\r\n\r\n## Coordination Commands\r\n\\`\\`\\`bash\r\n# Agent Management\r\nnpx claude-flow agent spawn <type> --name <name> --priority <1-10>\r\nnpx claude-flow agent list\r\nnpx claude-flow agent info <agent-id>\r\nnpx claude-flow agent terminate <agent-id>\r\n\r\n# Task Management  \r\nnpx claude-flow task create <type> <description> --priority <1-10> --deps <task-ids>\r\nnpx claude-flow task list --verbose\r\nnpx claude-flow task status <task-id>\r\nnpx claude-flow task cancel <task-id>\r\n\r\n# System Monitoring\r\nnpx claude-flow status --verbose\r\nnpx claude-flow monitor --interval 5000\r\n\\`\\`\\`\r\n\r\n## Workflow Execution\r\nWorkflows are defined in JSON format and can orchestrate complex multi-agent operations:\r\n\\`\\`\\`bash\r\nnpx claude-flow workflow examples/research-workflow.json\r\nnpx claude-flow workflow examples/development-config.json --async\r\n\\`\\`\\`\r\n\r\n## Advanced Features\r\n- **Circuit Breakers**: Automatic failure handling and recovery\r\n- **Work Stealing**: Dynamic load redistribution for efficiency\r\n- **Resource Limits**: Memory and CPU usage constraints\r\n- **Metrics Collection**: Performance monitoring and optimization\r\n\r\n## Configuration\r\nCoordination settings in \\`claude-flow.config.json\\`:\r\n\\`\\`\\`json\r\n{\r\n  \"orchestrator\": {\r\n    \"maxConcurrentTasks\": 10,\r\n    \"taskTimeout\": 300000,\r\n    \"defaultPriority\": 5\r\n  },\r\n  \"agents\": {\r\n    \"maxAgents\": 20,\r\n    \"defaultCapabilities\": [\"research\", \"code\", \"terminal\"],\r\n    \"resourceLimits\": {\r\n      \"memory\": \"1GB\",\r\n      \"cpu\": \"50%\"\r\n    }\r\n  }\r\n}\r\n\\`\\`\\`\r\n\r\n## Communication Patterns\r\n- **Direct Messaging**: Agent-to-agent communication\r\n- **Event Broadcasting**: System-wide notifications\r\n- **Shared Memory**: Common information access\r\n- **Task Handoff**: Seamless work transfer between agents\r\n\r\n## Best Practices\r\n- Start with general agents and specialize as needed\r\n- Use descriptive task names and clear requirements\r\n- Monitor system resources during heavy workloads\r\n- Implement proper error handling in workflows\r\n- Regular cleanup of completed tasks and inactive agents\r\n\r\n## Troubleshooting\r\n- Check agent health with \\`npx claude-flow status\\`\r\n- View detailed logs with \\`npx claude-flow monitor\\`\r\n- Restart stuck agents with terminate/spawn cycle\r\n- Use \\`--verbose\\` flags for detailed diagnostic information\r\n`;\r\n}\r\n\r\n\r\nfunction createAgentsReadme(): string {\r\n  return `# Agent Memory Storage\r\n\r\n## Purpose\r\nThis directory stores agent-specific memory data, configurations, and persistent state information for individual Claude agents in the orchestration system.\r\n\r\n## Structure\r\nEach agent gets its own subdirectory for isolated memory storage:\r\n\r\n\\`\\`\\`\r\nmemory/agents/\r\n‚îú‚îÄ‚îÄ agent_001/\r\n‚îÇ   ‚îú‚îÄ‚îÄ state.json           # Agent state and configuration\r\n‚îÇ   ‚îú‚îÄ‚îÄ knowledge.md         # Agent-specific knowledge base\r\n‚îÇ   ‚îú‚îÄ‚îÄ tasks.json          # Completed and active tasks\r\n‚îÇ   ‚îî‚îÄ‚îÄ calibration.json    # Agent-specific calibrations\r\n‚îú‚îÄ‚îÄ agent_002/\r\n‚îÇ   ‚îî‚îÄ‚îÄ ...\r\n‚îî‚îÄ‚îÄ shared/\r\n    ‚îú‚îÄ‚îÄ common_knowledge.md  # Shared knowledge across agents\r\n    ‚îî‚îÄ‚îÄ global_config.json  # Global agent configurations\r\n\\`\\`\\`\r\n\r\n## Usage Guidelines\r\n1. **Agent Isolation**: Each agent should only read/write to its own directory\r\n2. **Shared Resources**: Use the \\`shared/\\` directory for cross-agent information\r\n3. **State Persistence**: Update state.json whenever agent status changes\r\n4. **Knowledge Sharing**: Document discoveries in knowledge.md files\r\n5. **Cleanup**: Remove directories for terminated agents periodically\r\n\r\n## Last Updated\r\n${new Date().toISOString()}\r\n`;\r\n}\r\n\r\n\r\nfunction createSessionsReadme(): string {\r\n  return `# Session Memory Storage\r\n\r\n## Purpose\r\nThis directory stores session-based memory data, conversation history, and contextual information for development sessions using the Claude-Flow orchestration system.\r\n\r\n## Structure\r\nSessions are organized by date and session ID for easy retrieval:\r\n\r\n\\`\\`\\`\r\nmemory/sessions/\r\n‚îú‚îÄ‚îÄ 2024-01-10/\r\n‚îÇ   ‚îú‚îÄ‚îÄ session_001/\r\n‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ metadata.json        # Session metadata and configuration\r\n‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ conversation.md      # Full conversation history\r\n‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ decisions.md         # Key decisions and rationale\r\n‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ artifacts/           # Generated files and outputs\r\n‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ coordination_state/  # Coordination system snapshots\r\n‚îÇ   ‚îî‚îÄ‚îÄ ...\r\n‚îî‚îÄ‚îÄ shared/\r\n    ‚îú‚îÄ‚îÄ patterns.md              # Common session patterns\r\n    ‚îî‚îÄ‚îÄ templates/               # Session template files\r\n\\`\\`\\`\r\n\r\n## Usage Guidelines\r\n1. **Session Isolation**: Each session gets its own directory\r\n2. **Metadata Completeness**: Always fill out session metadata\r\n3. **Conversation Logging**: Document all significant interactions\r\n4. **Artifact Organization**: Structure generated files clearly\r\n5. **State Preservation**: Snapshot coordination state regularly\r\n\r\n## Last Updated\r\n${new Date().toISOString()}\r\n`;\r\n}\r\n\r\n"],"names":["chalk","getErrorMessage","success","error","warning","info","colors","bold","blue","yellow","Orchestrator","ConfigManager","EventBus","Logger","JsonPersistenceManager","swarmAction","SimpleMemoryManager","sparcAction","createMigrateCommand","enterpriseCommands","createFlowNexusClaudeMd","orchestrator","configManager","persistence","getPersistence","initialize","getOrchestrator","config","getConfigManager","eventBus","getInstance","logger","level","format","destination","load","setupCommands","cli","command","name","description","subcommands","options","short","type","defaultValue","action","ctx","initNeuralModule","force","flags","targetDir","target","initGoalModule","f","minimal","m","flowNexus","flowNexusClaudeMd","writeFile","mkdir","console","log","recursive","files","existingFiles","file","access","exists","then","catch","push","length","join","claudeMd","createMinimalClaudeMd","createFullClaudeMd","memoryBankMd","createMinimalMemoryBankMd","createFullMemoryBankMd","coordinationMd","createMinimalCoordinationMd","createFullCoordinationMd","directories","includes","unshift","dir","err","code","agentsReadme","createAgentsReadme","sessionsReadme","createSessionsReadme","initialData","agents","tasks","lastUpdated","Date","now","JSON","stringify","message","default","orch","start","daemon","controller","AbortController","shutdown","abort","process","on","Promise","resolve","signal","addEventListener","off","exit","aliases","subcommand","args","slice","persist","taskId","Math","random","toString","substr","saveTask","id","status","priority","dependencies","deps","split","metadata","progress","createdAt","getActiveTasks","task","verbose","agentId","getAllTasks","getAllAgents","find","t","agent","a","assignedAgent","workflowFile","readFile","content","workflow","parse","execute","agentCommand","enhancedCtx","cyan","agentManager","MemoryManager","DistributedMemorySystem","saveAgent","capabilities","getCapabilitiesForType","systemPrompt","prompt","getDefaultPromptForType","maxConcurrentTasks","maxTasks","getActiveAgents","enhancedStatusAction","watch","w","interval","i","component","c","json","detailed","healthCheck","history","stats","getStats","isRunning","activeAgents","totalAgents","pendingTasks","totalTasks","completedTasks","port","host","health","healthy","mcp","mcpConfig","get","auth","lines","memory","key","value","namespace","n","store","TextEncoder","encode","search","limit","l","results","query","limited","entry","substring","timestamp","toLocaleString","exportData","totalEntries","sizeBytes","toFixed","importData","namespaces","count","Object","entries","namespaceStats","days","d","removed","cleanup","taskEndIndex","startsWith","tools","parallel","research","instanceId","enhancedTask","replace","mode","coverage","commit","claudeCmd","noPermissions","dryRun","spawn","child","map","arg","env","CLAUDE_INSTANCE_ID","CLAUDE_FLOW_MODE","CLAUDE_FLOW_COVERAGE","CLAUDE_FLOW_COMMIT","CLAUDE_FLOW_MEMORY_ENABLED","CLAUDE_FLOW_MEMORY_NAMESPACE","CLAUDE_FLOW_COORDINATION_ENABLED","CLAUDE_FLOW_FEATURES","stdio","promises","toolsList","Array","isArray","skipPermissions","dangerouslySkipPermissions","CLAUDE_TASK_ID","CLAUDE_TASK_TYPE","all","failed","filter","s","enhancedMonitorAction","compact","focus","alerts","export","threshold","logLevel","noGraphs","Number","running","stdout","write","cycles","clear","currentStats","repeat","toLocaleTimeString","cpuUsage","memoryUsage","cpuColor","memoryColor","trend","from","floor","chars","setTimeout","batch","orchestration","migrateCmd","ui","enhancedSessionAction","enhancedStartAction","p","mcpTransport","u","v","autoStart","timeout","hiveMindCommand","initCommand","parseAsync","argv","spawnCommand","statusCommand","taskCommand","stopCommand","pauseCommand","resumeCommand","psCommand","wizardCommand","shell","reject","coordinator","researcher","implementer","analyst","custom","prompts","toISOString"],"mappings":"AAAA,OAAOA,WAAW,QAAQ;AAC1B,SAASC,eAAe,QAAQ,+BAA+B;AAC/D,SAAcC,OAAO,EAAEC,KAAK,EAAEC,OAAO,EAAEC,IAAI,QAAiB,iBAAiB;AAE7E,OAAOC,YAAY,QAAQ;AAC3B,MAAM,EAAEC,IAAI,EAAEC,IAAI,EAAEC,MAAM,EAAE,GAAGH;AAC/B,SAASI,YAAY,QAAQ,mCAAmC;AAChE,SAASC,aAAa,QAAQ,uBAAuB;AAErD,SAASC,QAAQ,QAAQ,0BAA0B;AACnD,SAASC,MAAM,QAAQ,uBAAuB;AAC9C,SAASC,sBAAsB,QAAQ,iCAAiC;AACxE,SAASC,WAAW,QAAQ,aAAa;AACzC,SAASC,mBAAmB,QAAQ,cAAc;AAClD,SAASC,WAAW,QAAQ,aAAa;AACzC,SAASC,oBAAoB,QAAQ,eAAe;AACpD,SAASC,kBAAkB,QAAQ,kBAAkB;AACrD,SAASC,uBAAuB,QAAQ,iDAAiD;AAQzF,IAAIC,eAAoC;AACxC,IAAIC,gBAAsC;AAC1C,IAAIC,cAA6C;AAEjD,eAAeC;IACb,IAAI,CAACD,aAAa;QAChBA,cAAc,IAAIT;QAClB,MAAMS,YAAYE,UAAU;IAC9B;IACA,OAAOF;AACT;AAEA,eAAeG;IACb,IAAI,CAACL,cAAc;QACjB,MAAMM,SAAS,MAAMC;QACrB,MAAMC,WAAWjB,SAASkB,WAAW;QACrC,MAAMC,SAAS,IAAIlB,OAAO;YAAEmB,OAAO;YAAQC,QAAQ;YAAQC,aAAa;QAAU;QAClFb,eAAe,IAAIX,aAAaiB,QAAQE,UAAUE;IACpD;IACA,OAAOV;AACT;AAEA,eAAeO;IACb,IAAI,CAACN,eAAe;QAClBA,gBAAgBX,cAAcmB,WAAW;QACzC,MAAMR,cAAca,IAAI;IAC1B;IACA,OAAOb;AACT;AAEA,OAAO,SAASc,cAAcC,GAAQ;IAEpCA,IAAIC,OAAO,CAAC;QACVC,MAAM;QACNC,aAAa;QACbC,aAAa;YACX;gBACEF,MAAM;gBACNC,aAAa;gBACbE,SAAS;oBACP;wBACEH,MAAM;wBACNI,OAAO;wBACPH,aAAa;wBACbI,MAAM;oBACR;oBACA;wBACEL,MAAM;wBACNI,OAAO;wBACPH,aAAa;wBACbI,MAAM;wBACNC,cAAc;oBAChB;iBACD;gBACDC,QAAQ,OAAOC;oBACb,MAAM,EAAEC,gBAAgB,EAAE,GAAG,MAAM,MAAM,CAAC;oBAC1C,MAAMA,iBAAiB;wBACrBC,OAAOF,IAAIG,KAAK,CAACD,KAAK;wBACtBE,WAAWJ,IAAIG,KAAK,CAACE,MAAM;oBAC7B;gBACF;YACF;SACD;IACH;IAGAf,IAAIC,OAAO,CAAC;QACVC,MAAM;QACNC,aAAa;QACbC,aAAa;YACX;gBACEF,MAAM;gBACNC,aAAa;gBACbE,SAAS;oBACP;wBACEH,MAAM;wBACNI,OAAO;wBACPH,aAAa;wBACbI,MAAM;oBACR;oBACA;wBACEL,MAAM;wBACNI,OAAO;wBACPH,aAAa;wBACbI,MAAM;wBACNC,cAAc;oBAChB;iBACD;gBACDC,QAAQ,OAAOC;oBACb,MAAM,EAAEM,cAAc,EAAE,GAAG,MAAM,MAAM,CAAC;oBACxC,MAAMA,eAAe;wBACnBJ,OAAOF,IAAIG,KAAK,CAACD,KAAK;wBACtBE,WAAWJ,IAAIG,KAAK,CAACE,MAAM;oBAC7B;gBACF;YACF;SACD;IACH;IAGAf,IAAIC,OAAO,CAAC;QACVC,MAAM;QACNC,aAAa;QACbE,SAAS;YACP;gBACEH,MAAM;gBACNI,OAAO;gBACPH,aAAa;gBACbI,MAAM;YACR;YACA;gBACEL,MAAM;gBACNI,OAAO;gBACPH,aAAa;gBACbI,MAAM;YACR;YACA;gBACEL,MAAM;gBACNC,aAAa;gBACbI,MAAM;YACR;SACD;QACDE,QAAQ,OAAOC;YACb,IAAI;gBACF7C,QAAQ;gBAER,MAAM+C,QAAQ,AAACF,IAAIG,KAAK,CAACD,KAAK,IAAiBF,IAAIG,KAAK,CAACI,CAAC;gBAC1D,MAAMC,UAAU,AAACR,IAAIG,KAAK,CAACK,OAAO,IAAiBR,IAAIG,KAAK,CAACM,CAAC;gBAC9D,MAAMC,YAAYV,IAAIG,KAAK,CAAC,aAAa;gBAGzC,IAAIO,WAAW;oBACbvD,QAAQ;oBAGR,MAAMwD,oBAAoBtC;oBAC1B,MAAM,EAAEuC,SAAS,EAAEC,KAAK,EAAE,GAAG,MAAM,MAAM,CAAC;oBAC1C,MAAMD,UAAU,aAAaD;oBAC7BG,QAAQC,GAAG,CAAC;oBAGZ,MAAMF,MAAM,+BAA+B;wBAAEG,WAAW;oBAAK;oBAG7D,MAAMH,MAAM,6BAA6B;wBAAEG,WAAW;oBAAK;oBAE3D7D,QAAQ;oBACR2D,QAAQC,GAAG,CAAC;oBACZD,QAAQC,GAAG,CAAC;oBACZD,QAAQC,GAAG,CAAC;oBACZD,QAAQC,GAAG,CAAC;oBACZ;gBACF;gBAGA,MAAME,QAAQ;oBAAC;oBAAa;oBAAkB;iBAAkB;gBAChE,MAAMC,gBAAgB,EAAE;gBAExB,KAAK,MAAMC,QAAQF,MAAO;oBACxB,MAAM,EAAEG,MAAM,EAAE,GAAG,MAAM,MAAM,CAAC;oBAChC,MAAMC,SAAS,MAAMD,OAAOD,MACzBG,IAAI,CAAC,IAAM,MACXC,KAAK,CAAC,IAAM;oBACf,IAAIF,QAAQ;wBACVH,cAAcM,IAAI,CAACL;oBACrB;gBACF;gBAEA,IAAID,cAAcO,MAAM,GAAG,KAAK,CAACvB,OAAO;oBACtC7C,QAAQ,CAAC,mCAAmC,EAAE6D,cAAcQ,IAAI,CAAC,OAAO;oBACxEZ,QAAQC,GAAG,CAAC;oBACZ;gBACF;gBAGA,MAAMY,WAAWnB,UAAUoB,0BAA0BC;gBACrD,MAAM,EAAEjB,SAAS,EAAE,GAAG,MAAM,MAAM,CAAC;gBACnC,MAAMA,UAAU,aAAae;gBAC7Bb,QAAQC,GAAG,CAAC;gBAGZ,MAAMe,eAAetB,UAAUuB,8BAA8BC;gBAC7D,MAAMpB,UAAU,kBAAkBkB;gBAClChB,QAAQC,GAAG,CAAC;gBAGZ,MAAMkB,iBAAiBzB,UAAU0B,gCAAgCC;gBACjE,MAAMvB,UAAU,mBAAmBqB;gBACnCnB,QAAQC,GAAG,CAAC;gBAGZ,MAAMqB,cAAc;oBAClB;oBACA;oBACA;oBACA;oBACA;oBACA;oBACA;iBACD;gBAGD,IAAI,CAACA,YAAYC,QAAQ,CAAC,WAAW;oBACnCD,YAAYE,OAAO,CAAC;gBACtB;gBAEA,MAAM,EAAEzB,KAAK,EAAE,GAAG,MAAM,MAAM,CAAC;gBAC/B,KAAK,MAAM0B,OAAOH,YAAa;oBAC7B,IAAI;wBACF,MAAMvB,MAAM0B,KAAK;4BAAEvB,WAAW;wBAAK;wBACnCF,QAAQC,GAAG,CAAC,CAAC,YAAY,EAAEwB,IAAI,WAAW,CAAC;oBAC7C,EAAE,OAAOC,KAAK;wBACZ,IAAI,AAACA,IAAYC,IAAI,KAAK,UAAU;4BAClC,MAAMD;wBACR;oBACF;gBACF;gBAGA,MAAME,eAAeC;gBACrB,MAAM/B,UAAU,2BAA2B8B;gBAC3C5B,QAAQC,GAAG,CAAC;gBAEZ,MAAM6B,iBAAiBC;gBACvB,MAAMjC,UAAU,6BAA6BgC;gBAC7C9B,QAAQC,GAAG,CAAC;gBAGZ,MAAM+B,cAAc;oBAClBC,QAAQ,EAAE;oBACVC,OAAO,EAAE;oBACTC,aAAaC,KAAKC,GAAG;gBACvB;gBACA,MAAMvC,UAAU,gCAAgCwC,KAAKC,SAAS,CAACP,aAAa,MAAM;gBAClFhC,QAAQC,GAAG,CAAC;gBAEZ5D,QAAQ;gBACR2D,QAAQC,GAAG,CAAC;gBACZD,QAAQC,GAAG,CAAC;gBACZD,QAAQC,GAAG,CAAC;gBACZD,QAAQC,GAAG,CAAC;gBACZD,QAAQC,GAAG,CAAC;YACd,EAAE,OAAOyB,KAAK;gBACZpF,MAAM,CAAC,4BAA4B,EAAE,AAACoF,IAAcc,OAAO,EAAE;YAC/D;QACF;IACF;IAGAhE,IAAIC,OAAO,CAAC;QACVC,MAAM;QACNC,aAAa;QACbE,SAAS;YACP;gBACEH,MAAM;gBACNI,OAAO;gBACPH,aAAa;gBACbI,MAAM;YACR;YACA;gBACEL,MAAM;gBACNI,OAAO;gBACPH,aAAa;gBACbI,MAAM;gBACN0D,SAAS;YACX;SACD;QACDxD,QAAQ,OAAOC;YACb7C,QAAQ;YAER,IAAI;gBACF,MAAMqG,OAAO,MAAM7E;gBACnB,MAAM6E,KAAKC,KAAK;gBAEhBtG,QAAQ;gBACRG,KAAK;gBACLwD,QAAQC,GAAG,CAAC;gBACZD,QAAQC,GAAG,CAAC;gBACZD,QAAQC,GAAG,CAAC;gBACZD,QAAQC,GAAG,CAAC;gBACZD,QAAQC,GAAG,CAAC;gBACZD,QAAQC,GAAG,CAAC;gBAEZ,IAAI,CAACf,IAAIG,KAAK,CAACuD,MAAM,EAAE;oBACrBpG,KAAK;oBAEL,MAAMqG,aAAa,IAAIC;oBAEvB,MAAMC,WAAW;wBACf/C,QAAQC,GAAG,CAAC;wBACZ4C,WAAWG,KAAK;oBAClB;oBAEAC,QAAQC,EAAE,CAAC,UAAUH;oBACrBE,QAAQC,EAAE,CAAC,WAAWH;oBAEtB,IAAI;wBACF,MAAM,IAAII,QAAc,CAACC;4BACvBP,WAAWQ,MAAM,CAACC,gBAAgB,CAAC,SAAS,IAAMF;wBACpD;oBACF,SAAU;wBACRH,QAAQM,GAAG,CAAC,UAAUR;wBACtBE,QAAQM,GAAG,CAAC,WAAWR;oBACzB;gBACF;YACF,EAAE,OAAOrB,KAAK;gBACZpF,MAAM,CAAC,wBAAwB,EAAE,AAACoF,IAAcc,OAAO,EAAE;gBACzDS,QAAQO,IAAI,CAAC;YACf;QACF;IACF;IAGAhF,IAAIC,OAAO,CAAC;QACVC,MAAM;QACNC,aAAa;QACb8E,SAAS;YAAC;SAAQ;QAClBxE,QAAQ,OAAOC;YACb,MAAMwE,aAAaxE,IAAIyE,IAAI,CAAC,EAAE;YAE9B,OAAQD;gBACN,KAAK;oBAAU;wBACb,MAAM3E,OAAOG,IAAIyE,IAAI,CAAC,EAAE,IAAI;wBAC5B,MAAMhF,cAAcO,IAAIyE,IAAI,CAACC,KAAK,CAAC,GAAGhD,IAAI,CAAC,QAAQ;wBAEnD,IAAI;4BACF,MAAMiD,UAAU,MAAMlG;4BACtB,MAAMmG,SAAS,CAAC,KAAK,EAAE1B,KAAKC,GAAG,GAAG,CAAC,EAAE0B,KAAKC,MAAM,GAAGC,QAAQ,CAAC,IAAIC,MAAM,CAAC,GAAG,IAAI;4BAG9E,MAAML,QAAQM,QAAQ,CAAC;gCACrBC,IAAIN;gCACJ/E;gCACAJ;gCACA0F,QAAQ;gCACRC,UAAU,AAACpF,IAAIG,KAAK,CAACiF,QAAQ,IAAe;gCAC5CC,cAAcrF,IAAIG,KAAK,CAACmF,IAAI,GAAG,AAACtF,IAAIG,KAAK,CAACmF,IAAI,CAAYC,KAAK,CAAC,OAAO,EAAE;gCACzEC,UAAU,CAAC;gCACXC,UAAU;gCACVC,WAAWxC,KAAKC,GAAG;4BACrB;4BAEAhG,QAAQ,CAAC,0BAA0B,CAAC;4BACpC2D,QAAQC,GAAG,CAAC,CAAC,YAAY,EAAE6D,QAAQ;4BACnC9D,QAAQC,GAAG,CAAC,CAAC,SAAS,EAAElB,MAAM;4BAC9BiB,QAAQC,GAAG,CAAC,CAAC,gBAAgB,EAAEtB,aAAa;wBAC9C,EAAE,OAAO+C,KAAK;4BACZpF,MAAM,CAAC,uBAAuB,EAAE,AAACoF,IAAcc,OAAO,EAAE;wBAC1D;wBACA;oBACF;gBAEA,KAAK;oBAAQ;wBACX,IAAI;4BACF,MAAMqB,UAAU,MAAMlG;4BACtB,MAAMuE,QAAQ,MAAM2B,QAAQgB,cAAc;4BAE1C,IAAI3C,MAAMvB,MAAM,KAAK,GAAG;gCACtBnE,KAAK;4BACP,OAAO;gCACLH,QAAQ,CAAC,cAAc,EAAE6F,MAAMvB,MAAM,CAAC,EAAE,CAAC;gCACzC,KAAK,MAAMmE,QAAQ5C,MAAO;oCACxBlC,QAAQC,GAAG,CAAC,CAAC,IAAI,EAAE6E,KAAKV,EAAE,CAAC,EAAE,EAAEU,KAAK/F,IAAI,CAAC,IAAI,EAAE+F,KAAKT,MAAM,EAAE;oCAC5D,IAAInF,IAAIG,KAAK,CAAC0F,OAAO,EAAE;wCACrB/E,QAAQC,GAAG,CAAC,CAAC,iBAAiB,EAAE6E,KAAKnG,WAAW,EAAE;oCACpD;gCACF;4BACF;wBACF,EAAE,OAAO+C,KAAK;4BACZpF,MAAM,CAAC,sBAAsB,EAAE,AAACoF,IAAcc,OAAO,EAAE;wBACzD;wBACA;oBACF;gBAEA,KAAK;oBAAU;wBACb,MAAMsB,SAAS5E,IAAIyE,IAAI,CAAC,EAAE;wBAC1B,MAAMqB,UAAU9F,IAAIyE,IAAI,CAAC,EAAE;wBAE3B,IAAI,CAACG,UAAU,CAACkB,SAAS;4BACvB1I,MAAM;4BACN;wBACF;wBAEA,IAAI;4BACF,MAAMuH,UAAU,MAAMlG;4BACtB,MAAMuE,QAAQ,MAAM2B,QAAQoB,WAAW;4BACvC,MAAMhD,SAAS,MAAM4B,QAAQqB,YAAY;4BAEzC,MAAMJ,OAAO5C,MAAMiD,IAAI,CAAC,CAACC,IAAMA,EAAEhB,EAAE,KAAKN;4BACxC,MAAMuB,QAAQpD,OAAOkD,IAAI,CAAC,CAACG,IAAMA,EAAElB,EAAE,KAAKY;4BAE1C,IAAI,CAACF,MAAM;gCACTxI,MAAM,CAAC,gBAAgB,EAAEwH,QAAQ;gCACjC;4BACF;4BAEA,IAAI,CAACuB,OAAO;gCACV/I,MAAM,CAAC,iBAAiB,EAAE0I,SAAS;gCACnC;4BACF;4BAGAF,KAAKS,aAAa,GAAGP;4BACrBF,KAAKT,MAAM,GAAG;4BACd,MAAMR,QAAQM,QAAQ,CAACW;4BAEvBzI,QAAQ,CAAC,KAAK,EAAEyH,OAAO,mBAAmB,EAAEkB,SAAS;4BACrDhF,QAAQC,GAAG,CAAC,CAAC,SAAS,EAAE6E,KAAKnG,WAAW,EAAE;4BAC1CqB,QAAQC,GAAG,CAAC,CAAC,UAAU,EAAEoF,MAAM3G,IAAI,CAAC,EAAE,EAAE2G,MAAMtG,IAAI,CAAC,CAAC,CAAC;wBACvD,EAAE,OAAO2C,KAAK;4BACZpF,MAAM,CAAC,uBAAuB,EAAE,AAACoF,IAAcc,OAAO,EAAE;wBAC1D;wBACA;oBACF;gBAEA,KAAK;oBAAY;wBACf,MAAMgD,eAAetG,IAAIyE,IAAI,CAAC,EAAE;wBAChC,IAAI,CAAC6B,cAAc;4BACjBlJ,MAAM;4BACN;wBACF;wBAEA,IAAI;4BACF,MAAM,EAAEmJ,QAAQ,EAAE,GAAG,MAAM,MAAM,CAAC;4BAClC,MAAMC,UAAU,MAAMD,SAASD,cAAc;4BAC7C,MAAMG,WAAWrD,KAAKsD,KAAK,CAACF;4BAE5BrJ,QAAQ;4BACR2D,QAAQC,GAAG,CAAC,CAAC,SAAS,EAAE0F,SAASjH,IAAI,IAAI,WAAW;4BACpDsB,QAAQC,GAAG,CAAC,CAAC,gBAAgB,EAAE0F,SAAShH,WAAW,IAAI,kBAAkB;4BACzEqB,QAAQC,GAAG,CAAC,CAAC,WAAW,EAAE0F,SAAS1D,MAAM,EAAEtB,UAAU,GAAG;4BACxDX,QAAQC,GAAG,CAAC,CAAC,UAAU,EAAE0F,SAASzD,KAAK,EAAEvB,UAAU,GAAG;4BAEtD,IAAIzB,IAAIG,KAAK,CAACwG,OAAO,EAAE;gCACrBtJ,QAAQ;4BAEV,OAAO;gCACLC,KAAK;4BACP;wBACF,EAAE,OAAOkF,KAAK;4BACZpF,MAAM,CAAC,yBAAyB,EAAE,AAACoF,IAAcc,OAAO,EAAE;wBAC5D;wBACA;oBACF;gBAEA;oBAAS;wBACPxC,QAAQC,GAAG,CAAC;wBACZ;oBACF;YACF;QACF;IACF;IAGAzB,IAAIC,OAAO,CAAC;QACVC,MAAM;QACNC,aAAa;QACb8E,SAAS;YAAC;SAAS;QACnBxE,QAAQ,OAAOC;YACb,MAAMwE,aAAaxE,IAAIyE,IAAI,CAAC,EAAE;YAG9B,MAAM,EAAEmC,YAAY,EAAE,GAAG,MAAM,MAAM,CAAC;YAGtC,MAAMC,cAAc;gBAClBpC,MAAMzE,IAAIyE,IAAI,CAACC,KAAK,CAAC;gBACrBvE,OAAOH,IAAIG,KAAK;gBAChBZ,SAASiF;YACX;YAEA,IAAI;gBAEF,OAAQA;oBACN,KAAK;oBACL,KAAK;oBACL,KAAK;oBACL,KAAK;oBACL,KAAK;oBACL,KAAK;oBACL,KAAK;oBACL,KAAK;wBAEH1D,QAAQC,GAAG,CAAC9D,MAAM6J,IAAI,CAAC;wBAGvB,MAAMC,eAAe,MAAM,MAAM,CAAC;wBAClC,MAAM,EAAEC,aAAa,EAAE,GAAG,MAAM,MAAM,CAAC;wBACvC,MAAM,EAAEnJ,QAAQ,EAAE,GAAG,MAAM,MAAM,CAAC;wBAClC,MAAM,EAAEC,MAAM,EAAE,GAAG,MAAM,MAAM,CAAC;wBAChC,MAAM,EAAEmJ,uBAAuB,EAAE,GAAG,MAAM,MAAM,CAAC;wBAEjD5J,QAAQ;wBACRyD,QAAQC,GAAG,CAAC;wBACZD,QAAQC,GAAG,CAAC,CAAC,sBAAsB,EAAEyD,WAAW,CAAC,EAAExE,IAAIyE,IAAI,CAACC,KAAK,CAAC,GAAGhD,IAAI,CAAC,MAAM;wBAChFZ,QAAQC,GAAG,CAAC;wBACZD,QAAQC,GAAG,CAAC;wBACZ;oBAEF;wBAAS;4BACPD,QAAQC,GAAG,CAAC9D,MAAM6J,IAAI,CAAC;4BACvBhG,QAAQC,GAAG,CAAC;4BACZD,QAAQC,GAAG,CAAC;4BACZD,QAAQC,GAAG,CAAC;4BACZD,QAAQC,GAAG,CAAC;4BACZD,QAAQC,GAAG,CAAC;4BACZD,QAAQC,GAAG,CAAC;4BACZD,QAAQC,GAAG,CAAC;4BACZD,QAAQC,GAAG,CAAC;4BACZD,QAAQC,GAAG,CAAC;4BACZD,QAAQC,GAAG,CAAC;4BACZD,QAAQC,GAAG,CAAC;4BACZD,QAAQC,GAAG,CAAC;4BACZD,QAAQC,GAAG,CAAC;4BACZD,QAAQC,GAAG,CAAC;4BACZD,QAAQC,GAAG,CAAC;4BACZD,QAAQC,GAAG,CAAC;4BACZD,QAAQC,GAAG,CAAC;4BACZD,QAAQC,GAAG,CAAC;4BACZ;wBACF;gBACF;YACF,EAAE,OAAOyB,KAAK;gBACZpF,MAAM,CAAC,uCAAuC,EAAE,AAACoF,IAAcc,OAAO,EAAE;gBAGxE,OAAQkB;oBACN,KAAK;wBAAS;4BACZ,MAAM3E,OAAOG,IAAIyE,IAAI,CAAC,EAAE,IAAI;4BAC5B,MAAMjF,OAAO,AAACQ,IAAIG,KAAK,CAACX,IAAI,IAAe,GAAGK,KAAK,CAAC,EAAEqD,KAAKC,GAAG,IAAI;4BAElE,IAAI;gCACF,MAAMwB,UAAU,MAAMlG;gCACtB,MAAMqH,UAAU,CAAC,MAAM,EAAE5C,KAAKC,GAAG,GAAG,CAAC,EAAE0B,KAAKC,MAAM,GAAGC,QAAQ,CAAC,IAAIC,MAAM,CAAC,GAAG,IAAI;gCAEhF,MAAML,QAAQuC,SAAS,CAAC;oCACtBhC,IAAIY;oCACJjG;oCACAL;oCACA2F,QAAQ;oCACRgC,cAAcC,uBAAuBvH;oCACrCwH,cAAc,AAACrH,IAAIG,KAAK,CAACmH,MAAM,IAAeC,wBAAwB1H;oCACtE2H,oBAAoB,AAACxH,IAAIG,KAAK,CAACsH,QAAQ,IAAe;oCACtDrC,UAAU,AAACpF,IAAIG,KAAK,CAACiF,QAAQ,IAAe;oCAC5CM,WAAWxC,KAAKC,GAAG;gCACrB;gCAEAhG,QAAQ,CAAC,2BAA2B,CAAC;gCACrC2D,QAAQC,GAAG,CAAC,CAAC,aAAa,EAAE+E,SAAS;gCACrChF,QAAQC,GAAG,CAAC,CAAC,SAAS,EAAElB,MAAM;gCAC9BiB,QAAQC,GAAG,CAAC,CAAC,SAAS,EAAEvB,MAAM;gCAC9BsB,QAAQC,GAAG,CAAC,CAAC,gBAAgB,CAAC;4BAChC,EAAE,OAAOyB,KAAK;gCACZpF,MAAM,CAAC,uBAAuB,EAAE,AAACoF,IAAcc,OAAO,EAAE;4BAC1D;4BACA;wBACF;oBAEA,KAAK;wBAAQ;4BACX,IAAI;gCACF,MAAMqB,UAAU,MAAMlG;gCACtB,MAAMsE,SAAS,MAAM4B,QAAQ+C,eAAe;gCAE5C,IAAI3E,OAAOtB,MAAM,KAAK,GAAG;oCACvBnE,KAAK;gCACP,OAAO;oCACLH,QAAQ,CAAC,eAAe,EAAE4F,OAAOtB,MAAM,CAAC,EAAE,CAAC;oCAC3C,KAAK,MAAM0E,SAASpD,OAAQ;wCAC1BjC,QAAQC,GAAG,CAAC,CAAC,IAAI,EAAEoF,MAAMjB,EAAE,CAAC,EAAE,EAAEiB,MAAMtG,IAAI,CAAC,IAAI,EAAEsG,MAAMhB,MAAM,EAAE;oCACjE;gCACF;4BACF,EAAE,OAAO3C,KAAK;gCACZpF,MAAM,CAAC,uBAAuB,EAAE,AAACoF,IAAcc,OAAO,EAAE;4BAC1D;4BACA;wBACF;oBAEA;wBAAS;4BACPxC,QAAQC,GAAG,CAAC;4BACZD,QAAQC,GAAG,CAAC;4BACZ;wBACF;gBACF;YACF;QACF;IACF;IAGA,IAAI;QAEF,MAAM4G,uBAAuB,OAAO3H;YAElC,MAAML,UAAU;gBACdiI,OAAO5H,IAAIG,KAAK,CAACyH,KAAK,IAAI5H,IAAIG,KAAK,CAAC0H,CAAC;gBACrCC,UAAU9H,IAAIG,KAAK,CAAC2H,QAAQ,IAAI9H,IAAIG,KAAK,CAAC4H,CAAC,IAAI;gBAC/CC,WAAWhI,IAAIG,KAAK,CAAC6H,SAAS,IAAIhI,IAAIG,KAAK,CAAC8H,CAAC;gBAC7CC,MAAMlI,IAAIG,KAAK,CAAC+H,IAAI;gBACpBC,UAAUnI,IAAIG,KAAK,CAACgI,QAAQ;gBAC5BC,aAAapI,IAAIG,KAAK,CAACiI,WAAW,IAAIpI,IAAIG,KAAK,CAAC,eAAe;gBAC/DkI,SAASrI,IAAIG,KAAK,CAACkI,OAAO;YAC5B;YAGAvH,QAAQC,GAAG,CAAC9D,MAAM6J,IAAI,CAAC;YACvBhG,QAAQC,GAAG,CAAC;YACZD,QAAQC,GAAG,CACT;YAIF,IAAI;gBACF,MAAM4D,UAAU,MAAMlG;gBACtB,MAAM6J,QAAQ,MAAM3D,QAAQ4D,QAAQ;gBAGpC,MAAM,EAAEnH,MAAM,EAAE,GAAG,MAAM,MAAM,CAAC;gBAChC,MAAMoH,YAAY,MAAMpH,OAAO,oBAC5BE,IAAI,CAAC,IAAM,MACXC,KAAK,CAAC,IAAM;gBAEfpE,QAAQ;gBACR2D,QAAQC,GAAG,CAAC,CAAC,WAAW,EAAEyH,YAAY,YAAY,WAAW;gBAC7D1H,QAAQC,GAAG,CAAC,CAAC,WAAW,EAAEuH,MAAMG,YAAY,CAAC,SAAS,EAAEH,MAAMI,WAAW,CAAC,OAAO,CAAC;gBAClF5H,QAAQC,GAAG,CAAC,CAAC,UAAU,EAAEuH,MAAMK,YAAY,CAAC,WAAW,EAAEL,MAAMM,UAAU,CAAC,OAAO,CAAC;gBAClF9H,QAAQC,GAAG,CAAC,CAAC,gBAAgB,CAAC;gBAC9BD,QAAQC,GAAG,CAAC,CAAC,yBAAyB,CAAC;gBACvCD,QAAQC,GAAG,CAAC,CAAC,eAAe,EAAEyH,YAAY,YAAY,WAAW;gBAEjE,IAAIxI,IAAIG,KAAK,CAAC0F,OAAO,IAAIlG,QAAQwI,QAAQ,EAAE;oBACzCrH,QAAQC,GAAG,CAAC;oBACZD,QAAQC,GAAG,CAAC,CAAC,gBAAgB,EAAEuH,MAAMI,WAAW,EAAE;oBAClD5H,QAAQC,GAAG,CAAC,CAAC,iBAAiB,EAAEuH,MAAMG,YAAY,EAAE;oBACpD3H,QAAQC,GAAG,CAAC,CAAC,eAAe,EAAEuH,MAAMM,UAAU,EAAE;oBAChD9H,QAAQC,GAAG,CAAC,CAAC,iBAAiB,EAAEuH,MAAMK,YAAY,EAAE;oBACpD7H,QAAQC,GAAG,CAAC,CAAC,mBAAmB,EAAEuH,MAAMO,cAAc,EAAE;gBAC1D;gBAEA,IAAIlJ,QAAQiI,KAAK,EAAE;oBACjBvK,QAAQ;oBACRyD,QAAQC,GAAG,CAAC;gBACd;YACF,EAAE,OAAOyB,KAAK;gBACZpF,MAAM,CAAC,sBAAsB,EAAE,AAACoF,IAAcc,OAAO,EAAE;YACzD;QACF;QAEAhE,IAAIC,OAAO,CAAC;YACVC,MAAM;YACNC,aAAa;YACbE,SAAS;gBACP;oBACEH,MAAM;oBACNI,OAAO;oBACPH,aAAa;oBACbI,MAAM;gBACR;gBACA;oBACEL,MAAM;oBACNI,OAAO;oBACPH,aAAa;oBACbI,MAAM;oBACN0D,SAAS;gBACX;gBACA;oBACE/D,MAAM;oBACNI,OAAO;oBACPH,aAAa;oBACbI,MAAM;gBACR;gBACA;oBAAEL,MAAM;oBAAQC,aAAa;oBAAyBI,MAAM;gBAAU;gBACtE;oBAAEL,MAAM;oBAAYC,aAAa;oBAAuCI,MAAM;gBAAU;gBACxF;oBACEL,MAAM;oBACNC,aAAa;oBACbI,MAAM;gBACR;gBACA;oBAAEL,MAAM;oBAAWC,aAAa;oBAAiCI,MAAM;gBAAU;gBACjF;oBAAEL,MAAM;oBAAWI,OAAO;oBAAKH,aAAa;oBAAyBI,MAAM;gBAAU;aACtF;YACDE,QAAQ4H;QACV;IACF,EAAE,OAAOnF,KAAK;QACZnF,QAAQ;QAGRiC,IAAIC,OAAO,CAAC;YACVC,MAAM;YACNC,aAAa;YACbM,QAAQ,OAAOC;gBACb,IAAI;oBACF,MAAM2E,UAAU,MAAMlG;oBACtB,MAAM6J,QAAQ,MAAM3D,QAAQ4D,QAAQ;oBAEpC,MAAM,EAAEnH,MAAM,EAAE,GAAG,MAAM,MAAM,CAAC;oBAChC,MAAMoH,YAAY,MAAMpH,OAAO,oBAC5BE,IAAI,CAAC,IAAM,MACXC,KAAK,CAAC,IAAM;oBAEfpE,QAAQ;oBACR2D,QAAQC,GAAG,CAAC,CAAC,WAAW,EAAEyH,YAAY,YAAY,WAAW;oBAC7D1H,QAAQC,GAAG,CAAC,CAAC,WAAW,EAAEuH,MAAMG,YAAY,CAAC,SAAS,EAAEH,MAAMI,WAAW,CAAC,OAAO,CAAC;oBAClF5H,QAAQC,GAAG,CAAC,CAAC,UAAU,EAAEuH,MAAMK,YAAY,CAAC,WAAW,EAAEL,MAAMM,UAAU,CAAC,OAAO,CAAC;oBAClF9H,QAAQC,GAAG,CAAC,CAAC,gBAAgB,CAAC;oBAC9BD,QAAQC,GAAG,CAAC,CAAC,yBAAyB,CAAC;oBACvCD,QAAQC,GAAG,CAAC,CAAC,eAAe,EAAEyH,YAAY,YAAY,WAAW;oBAEjE,IAAIxI,IAAIG,KAAK,CAAC0F,OAAO,EAAE;wBACrB/E,QAAQC,GAAG,CAAC;wBACZD,QAAQC,GAAG,CAAC,CAAC,gBAAgB,EAAEuH,MAAMI,WAAW,EAAE;wBAClD5H,QAAQC,GAAG,CAAC,CAAC,iBAAiB,EAAEuH,MAAMG,YAAY,EAAE;wBACpD3H,QAAQC,GAAG,CAAC,CAAC,eAAe,EAAEuH,MAAMM,UAAU,EAAE;wBAChD9H,QAAQC,GAAG,CAAC,CAAC,iBAAiB,EAAEuH,MAAMK,YAAY,EAAE;wBACpD7H,QAAQC,GAAG,CAAC,CAAC,mBAAmB,EAAEuH,MAAMO,cAAc,EAAE;oBAC1D;gBACF,EAAE,OAAOrG,KAAK;oBACZpF,MAAM,CAAC,sBAAsB,EAAE,AAACoF,IAAcc,OAAO,EAAE;gBACzD;YACF;QACF;IACF;IAGAhE,IAAIC,OAAO,CAAC;QACVC,MAAM;QACNC,aAAa;QACbM,QAAQ,OAAOC;YACb,MAAMwE,aAAaxE,IAAIyE,IAAI,CAAC,EAAE;YAE9B,OAAQD;gBACN,KAAK;oBAAS;wBACZ,MAAMsE,OAAO,AAAC9I,IAAIG,KAAK,CAAC2I,IAAI,IAAe;wBAC3C,MAAMC,OAAO,AAAC/I,IAAIG,KAAK,CAAC4I,IAAI,IAAe;wBAE3C,IAAI;4BAEF,MAAMvF,OAAO,MAAM7E;4BACnB,MAAMqK,SAAS,MAAMxF,KAAK4E,WAAW;4BAErC,IAAI,CAACY,OAAOC,OAAO,EAAE;gCACnB5L,QAAQ;gCACR;4BACF;4BAEAF,QAAQ,CAAC,yDAAyD,CAAC;4BACnE2D,QAAQC,GAAG,CAAC,CAAC,2BAA2B,EAAEgI,KAAK,CAAC,EAAED,MAAM;4BACxDhI,QAAQC,GAAG,CAAC,CAAC,oDAAoD,CAAC;4BAClED,QAAQC,GAAG,CAAC,CAAC,yDAAyD,CAAC;wBACzE,EAAE,OAAOyB,KAAK;4BACZpF,MAAM,CAAC,4BAA4B,EAAE,AAACoF,IAAcc,OAAO,EAAE;wBAC/D;wBACA;oBACF;gBAEA,KAAK;oBAAQ;wBACX,IAAI;4BACF,MAAME,OAAO,MAAM7E;4BACnB,MAAMqK,SAAS,MAAMxF,KAAK4E,WAAW;4BAErC,IAAI,CAACY,OAAOC,OAAO,EAAE;gCACnB3L,KAAK;4BACP,OAAO;gCACLD,QACE;4BAEJ;wBACF,EAAE,OAAOmF,KAAK;4BACZpF,MAAM,CAAC,4BAA4B,EAAE,AAACoF,IAAcc,OAAO,EAAE;wBAC/D;wBACA;oBACF;gBAEA,KAAK;oBAAU;wBACb,IAAI;4BACF,MAAME,OAAO,MAAM7E;4BACnB,MAAMqK,SAAS,MAAMxF,KAAK4E,WAAW;4BAErCjL,QAAQ;4BACR2D,QAAQC,GAAG,CAAC,CAAC,WAAW,EAAEiI,OAAOE,GAAG,GAAG,YAAY,WAAW;4BAE9D,IAAIF,OAAOE,GAAG,EAAE;gCACd,MAAMtK,SAAS,MAAMC;gCACrB,MAAMsK,YAAYvK,OAAOwK,GAAG,GAAGF,GAAG;gCAClCpI,QAAQC,GAAG,CAAC,CAAC,YAAY,EAAEoI,UAAUJ,IAAI,CAAC,CAAC,EAAEI,UAAUL,IAAI,EAAE;gCAC7DhI,QAAQC,GAAG,CAAC,CAAC,mBAAmB,EAAEoI,UAAUE,IAAI,GAAG,YAAY,YAAY;gCAC3EvI,QAAQC,GAAG,CAAC,CAAC,mBAAmB,CAAC;gCACjCD,QAAQC,GAAG,CAAC,CAAC,sBAAsB,CAAC;4BACtC;wBACF,EAAE,OAAOyB,KAAK;4BACZpF,MAAM,CAAC,0BAA0B,EAAE,AAACoF,IAAcc,OAAO,EAAE;wBAC7D;wBACA;oBACF;gBAEA,KAAK;oBAAS;wBACZ,IAAI;4BACFnG,QAAQ;4BACR2D,QAAQC,GAAG,CAAC;4BACZD,QAAQC,GAAG,CAAC;4BACZD,QAAQC,GAAG,CAAC;4BACZD,QAAQC,GAAG,CAAC;4BAEZD,QAAQC,GAAG,CAAC;4BACZD,QAAQC,GAAG,CAAC;4BACZD,QAAQC,GAAG,CAAC;4BACZD,QAAQC,GAAG,CAAC;4BAEZD,QAAQC,GAAG,CAAC;4BACZD,QAAQC,GAAG,CAAC;4BACZD,QAAQC,GAAG,CAAC;4BACZD,QAAQC,GAAG,CAAC;4BAEZD,QAAQC,GAAG,CAAC;4BACZD,QAAQC,GAAG,CAAC;4BACZD,QAAQC,GAAG,CAAC;4BACZD,QAAQC,GAAG,CAAC;wBACd,EAAE,OAAOyB,KAAK;4BACZpF,MAAM,CAAC,sBAAsB,EAAE,AAACoF,IAAcc,OAAO,EAAE;wBACzD;wBACA;oBACF;gBAEA,KAAK;oBAAU;wBACb,IAAI;4BACF,MAAM1E,SAAS,MAAMC;4BACrB,MAAMsK,YAAYvK,OAAOwK,GAAG,GAAGF,GAAG;4BAElC/L,QAAQ;4BACR2D,QAAQC,GAAG,CAACqC,KAAKC,SAAS,CAAC8F,WAAW,MAAM;wBAC9C,EAAE,OAAO3G,KAAK;4BACZpF,MAAM,CAAC,2BAA2B,EAAE,AAACoF,IAAcc,OAAO,EAAE;wBAC9D;wBACA;oBACF;gBAEA,KAAK;oBAAW;wBACd,IAAI;4BACFjG,QACE;wBAEJ,EAAE,OAAOmF,KAAK;4BACZpF,MAAM,CAAC,8BAA8B,EAAE,AAACoF,IAAcc,OAAO,EAAE;wBACjE;wBACA;oBACF;gBAEA,KAAK;oBAAQ;wBACX,MAAMgG,QAAQ,AAACtJ,IAAIG,KAAK,CAACmJ,KAAK,IAAe;wBAE7C,IAAI;4BAEFnM,QAAQ,CAAC,sBAAsB,EAAEmM,MAAM,QAAQ,CAAC;4BAChDxI,QAAQC,GAAG,CAAC;4BACZD,QAAQC,GAAG,CAAC;4BACZD,QAAQC,GAAG,CAAC;4BACZD,QAAQC,GAAG,CAAC;4BACZD,QAAQC,GAAG,CAAC;4BACZD,QAAQC,GAAG,CAAC;wBACd,EAAE,OAAOyB,KAAK;4BACZpF,MAAM,CAAC,oBAAoB,EAAE,AAACoF,IAAcc,OAAO,EAAE;wBACvD;wBACA;oBACF;gBAEA;oBAAS;wBACPlG,MAAM,CAAC,wBAAwB,EAAEoH,YAAY;wBAC7C1D,QAAQC,GAAG,CAAC;wBACZ;oBACF;YACF;QACF;IACF;IAGAzB,IAAIC,OAAO,CAAC;QACVC,MAAM;QACNC,aAAa;QACb8E,SAAS;YAAC;SAAM;QAChBxE,QAAQ,OAAOC;YACb,MAAMwE,aAAaxE,IAAIyE,IAAI,CAAC,EAAE;YAC9B,MAAM8E,SAAS,IAAItL;YAEnB,OAAQuG;gBACN,KAAK;oBAAS;wBACZ,MAAMgF,MAAMxJ,IAAIyE,IAAI,CAAC,EAAE;wBACvB,MAAMgF,QAAQzJ,IAAIyE,IAAI,CAACC,KAAK,CAAC,GAAGhD,IAAI,CAAC;wBAErC,IAAI,CAAC8H,OAAO,CAACC,OAAO;4BAClBrM,MAAM;4BACN;wBACF;wBAEA,IAAI;4BACF,MAAMsM,YACJ,AAAC1J,IAAIG,KAAK,CAACuJ,SAAS,IAAgB1J,IAAIG,KAAK,CAACwJ,CAAC,IAAe;4BAChE,MAAMJ,OAAOK,KAAK,CAACJ,KAAKC,OAAOC;4BAC/BvM,QAAQ;4BACR2D,QAAQC,GAAG,CAAC,CAAC,QAAQ,EAAEyI,KAAK;4BAC5B1I,QAAQC,GAAG,CAAC,CAAC,cAAc,EAAE2I,WAAW;4BACxC5I,QAAQC,GAAG,CAAC,CAAC,SAAS,EAAE,IAAI8I,cAAcC,MAAM,CAACL,OAAOhI,MAAM,CAAC,MAAM,CAAC;wBACxE,EAAE,OAAOe,KAAK;4BACZpF,MAAM,CAAC,iBAAiB,EAAE,AAACoF,IAAcc,OAAO,EAAE;wBACpD;wBACA;oBACF;gBAEA,KAAK;oBAAS;wBACZ,MAAMyG,SAAS/J,IAAIyE,IAAI,CAACC,KAAK,CAAC,GAAGhD,IAAI,CAAC;wBAEtC,IAAI,CAACqI,QAAQ;4BACX3M,MAAM;4BACN;wBACF;wBAEA,IAAI;4BACF,MAAMsM,YAAY,AAAC1J,IAAIG,KAAK,CAACuJ,SAAS,IAAgB1J,IAAIG,KAAK,CAACwJ,CAAC;4BACjE,MAAMK,QAAQ,AAAChK,IAAIG,KAAK,CAAC6J,KAAK,IAAgBhK,IAAIG,KAAK,CAAC8J,CAAC,IAAe;4BACxE,MAAMC,UAAU,MAAMX,OAAOY,KAAK,CAACJ,QAAQL;4BAE3C,IAAIQ,QAAQzI,MAAM,KAAK,GAAG;gCACxBpE,QAAQ;gCACR;4BACF;4BAEAF,QAAQ,CAAC,MAAM,EAAE+M,QAAQzI,MAAM,CAAC,SAAS,CAAC;4BAE1C,MAAM2I,UAAUF,QAAQxF,KAAK,CAAC,GAAGsF;4BACjC,KAAK,MAAMK,SAASD,QAAS;gCAC3BtJ,QAAQC,GAAG,CAACtD,KAAK,CAAC,KAAK,EAAE4M,MAAMb,GAAG,EAAE;gCACpC1I,QAAQC,GAAG,CAAC,CAAC,cAAc,EAAEsJ,MAAMX,SAAS,EAAE;gCAC9C5I,QAAQC,GAAG,CACT,CAAC,UAAU,EAAEsJ,MAAMZ,KAAK,CAACa,SAAS,CAAC,GAAG,OAAOD,MAAMZ,KAAK,CAAChI,MAAM,GAAG,MAAM,QAAQ,IAAI;gCAEtFX,QAAQC,GAAG,CAAC,CAAC,WAAW,EAAE,IAAImC,KAAKmH,MAAME,SAAS,EAAEC,cAAc,IAAI;4BACxE;4BAEA,IAAIN,QAAQzI,MAAM,GAAGuI,OAAO;gCAC1BlJ,QAAQC,GAAG,CAAC,CAAC,UAAU,EAAEmJ,QAAQzI,MAAM,GAAGuI,MAAM,aAAa,CAAC;4BAChE;wBACF,EAAE,OAAOxH,KAAK;4BACZpF,MAAM,CAAC,iBAAiB,EAAE,AAACoF,IAAcc,OAAO,EAAE;wBACpD;wBACA;oBACF;gBAEA,KAAK;oBAAU;wBACb,MAAMnC,OAAOnB,IAAIyE,IAAI,CAAC,EAAE;wBAExB,IAAI,CAACtD,MAAM;4BACT/D,MAAM;4BACN;wBACF;wBAEA,IAAI;4BACF,MAAMmM,OAAOkB,UAAU,CAACtJ;4BACxB,MAAMmH,QAAQ,MAAMiB,OAAOhB,QAAQ;4BACnCpL,QAAQ;4BACR2D,QAAQC,GAAG,CAAC,CAAC,SAAS,EAAEI,MAAM;4BAC9BL,QAAQC,GAAG,CAAC,CAAC,YAAY,EAAEuH,MAAMoC,YAAY,EAAE;4BAC/C5J,QAAQC,GAAG,CAAC,CAAC,SAAS,EAAE,AAACuH,CAAAA,MAAMqC,SAAS,GAAG,IAAG,EAAGC,OAAO,CAAC,GAAG,GAAG,CAAC;wBAClE,EAAE,OAAOpI,KAAK;4BACZpF,MAAM,CAAC,kBAAkB,EAAE,AAACoF,IAAcc,OAAO,EAAE;wBACrD;wBACA;oBACF;gBAEA,KAAK;oBAAU;wBACb,MAAMnC,OAAOnB,IAAIyE,IAAI,CAAC,EAAE;wBAExB,IAAI,CAACtD,MAAM;4BACT/D,MAAM;4BACN;wBACF;wBAEA,IAAI;4BACF,MAAMmM,OAAOsB,UAAU,CAAC1J;4BACxB,MAAMmH,QAAQ,MAAMiB,OAAOhB,QAAQ;4BACnCpL,QAAQ;4BACR2D,QAAQC,GAAG,CAAC,CAAC,SAAS,EAAEI,MAAM;4BAC9BL,QAAQC,GAAG,CAAC,CAAC,YAAY,EAAEuH,MAAMoC,YAAY,EAAE;4BAC/C5J,QAAQC,GAAG,CAAC,CAAC,iBAAiB,EAAEuH,MAAMwC,UAAU,EAAE;wBACpD,EAAE,OAAOtI,KAAK;4BACZpF,MAAM,CAAC,kBAAkB,EAAE,AAACoF,IAAcc,OAAO,EAAE;wBACrD;wBACA;oBACF;gBAEA,KAAK;oBAAS;wBACZ,IAAI;4BACF,MAAMgF,QAAQ,MAAMiB,OAAOhB,QAAQ;4BAEnCpL,QAAQ;4BACR2D,QAAQC,GAAG,CAAC,CAAC,kBAAkB,EAAEuH,MAAMoC,YAAY,EAAE;4BACrD5J,QAAQC,GAAG,CAAC,CAAC,eAAe,EAAEuH,MAAMwC,UAAU,EAAE;4BAChDhK,QAAQC,GAAG,CAAC,CAAC,SAAS,EAAE,AAACuH,CAAAA,MAAMqC,SAAS,GAAG,IAAG,EAAGC,OAAO,CAAC,GAAG,GAAG,CAAC;4BAEhE,IAAItC,MAAMwC,UAAU,GAAG,GAAG;gCACxBhK,QAAQC,GAAG,CAACtD,KAAK;gCACjB,KAAK,MAAM,CAACiM,WAAWqB,MAAM,IAAIC,OAAOC,OAAO,CAAC3C,MAAM4C,cAAc,EAAG;oCACrEpK,QAAQC,GAAG,CAAC,CAAC,GAAG,EAAE2I,UAAU,EAAE,EAAEqB,MAAM,QAAQ,CAAC;gCACjD;4BACF;wBACF,EAAE,OAAOvI,KAAK;4BACZpF,MAAM,CAAC,qBAAqB,EAAE,AAACoF,IAAcc,OAAO,EAAE;wBACxD;wBACA;oBACF;gBAEA,KAAK;oBAAW;wBACd,IAAI;4BACF,MAAM6H,OAAO,AAACnL,IAAIG,KAAK,CAACgL,IAAI,IAAgBnL,IAAIG,KAAK,CAACiL,CAAC,IAAe;4BACtE,MAAMC,UAAU,MAAM9B,OAAO+B,OAAO,CAACH;4BACrChO,QAAQ;4BACR2D,QAAQC,GAAG,CAAC,CAAC,cAAc,EAAEsK,QAAQ,oBAAoB,EAAEF,KAAK,KAAK,CAAC;wBACxE,EAAE,OAAO3I,KAAK;4BACZpF,MAAM,CAAC,mBAAmB,EAAE,AAACoF,IAAcc,OAAO,EAAE;wBACtD;wBACA;oBACF;gBAEA;oBAAS;wBACPxC,QAAQC,GAAG,CAAC;wBACZD,QAAQC,GAAG,CAAC;wBACZD,QAAQC,GAAG,CAAC,CAAC,EAAE,EAAEtD,KAAK,gBAAgB,iDAAiD,CAAC;wBACxFqD,QAAQC,GAAG,CAAC,CAAC,EAAE,EAAEtD,KAAK,gBAAgB,SAAS,CAAC;wBAChDqD,QAAQC,GAAG,CAAC,CAAC,EAAE,EAAEtD,KAAK,iBAAiB,YAAY,CAAC;wBACpDqD,QAAQC,GAAG,CAAC,CAAC,EAAE,EAAEtD,KAAK,iBAAiB;wBACvC;oBACF;YACF;QACF;IACF;IAGA6B,IAAIC,OAAO,CAAC;QACVC,MAAM;QACNC,aAAa;QACb8E,SAAS;YAAC;SAAK;QACf5E,SAAS;YACP;gBACEH,MAAM;gBACNI,OAAO;gBACPH,aAAa;gBACbI,MAAM;gBACN0D,SAAS;YACX;YACA;gBACE/D,MAAM;gBACNC,aAAa;gBACbI,MAAM;YACR;YACA;gBACEL,MAAM;gBACNI,OAAO;gBACPH,aAAa;gBACbI,MAAM;YACR;YACA;gBACEL,MAAM;gBACNI,OAAO;gBACPH,aAAa;gBACbI,MAAM;gBACN0D,SAAS;YACX;YACA;gBACE/D,MAAM;gBACNC,aAAa;gBACbI,MAAM;YACR;YACA;gBACEL,MAAM;gBACNC,aAAa;gBACbI,MAAM;YACR;YACA;gBACEL,MAAM;gBACNC,aAAa;gBACbI,MAAM;gBACN0D,SAAS;YACX;YACA;gBACE/D,MAAM;gBACNC,aAAa;gBACbI,MAAM;gBACN0D,SAAS;YACX;YACA;gBACE/D,MAAM;gBACNI,OAAO;gBACPH,aAAa;gBACbI,MAAM;YACR;YACA;gBACEL,MAAM;gBACNI,OAAO;gBACPH,aAAa;gBACbI,MAAM;YACR;SACD;QACDE,QAAQ,OAAOC;YACb,MAAMwE,aAAaxE,IAAIyE,IAAI,CAAC,EAAE;YAE9B,OAAQD;gBACN,KAAK;oBAAS;wBAEZ,IAAI+G,eAAevL,IAAIyE,IAAI,CAAChD,MAAM;wBAClC,IAAK,IAAIsG,IAAI,GAAGA,IAAI/H,IAAIyE,IAAI,CAAChD,MAAM,EAAEsG,IAAK;4BACxC,IAAI/H,IAAIyE,IAAI,CAACsD,EAAE,CAACyD,UAAU,CAAC,MAAM;gCAC/BD,eAAexD;gCACf;4BACF;wBACF;wBAEA,MAAMnC,OAAO5F,IAAIyE,IAAI,CAACC,KAAK,CAAC,GAAG6G,cAAc7J,IAAI,CAAC;wBAClD,IAAI,CAACkE,MAAM;4BACTxI,MAAM;4BACN;wBACF;wBAEA,IAAI;4BAEF,IAAIqO,QACF,AAACzL,IAAIG,KAAK,CAACsL,KAAK,IAAe;4BAEjC,IAAIzL,IAAIG,KAAK,CAACuL,QAAQ,EAAE;gCACtBD,SAAS;4BACX;4BAEA,IAAIzL,IAAIG,KAAK,CAACwL,QAAQ,EAAE;gCACtBF,SAAS;4BACX;4BAEA,MAAMG,aAAa,CAAC,OAAO,EAAE1I,KAAKC,GAAG,GAAG,CAAC,EAAE0B,KAAKC,MAAM,GAAGC,QAAQ,CAAC,IAAIC,MAAM,CAAC,GAAG,IAAI;4BAGpF,IAAI6G,eAAe,CAAC;;;AAGhC,EAAEjG,KAAK;;;;;;;;;;;;;;;;qCAgB8B,EAAE6F,OAAO;4BAElC,IAAIzL,IAAIG,KAAK,CAACuL,QAAQ,EAAE;gCACtBG,gBAAgB,CAAC;;;;gEAIiC,CAAC;4BACrD;4BAEA,IAAI7L,IAAIG,KAAK,CAACwL,QAAQ,EAAE;gCACtBE,gBAAgB,CAAC;uFACwD,CAAC;4BAC5E;4BAEAA,gBAAgB,CAAC;;;;;;;;;;;;+DAYkC,EAAEjG,KAAKkG,OAAO,CAAC,QAAQ,KAAK;GACxF,EAAE9L,IAAIG,KAAK,CAACuL,QAAQ,GAAG,qFAAqF,GAAG;GAC/G,EAAE1L,IAAIG,KAAK,CAACuL,QAAQ,GAAG,uFAAuF,GAAG;;;;;;;GAOjH,EAAE1L,IAAIG,KAAK,CAACuL,QAAQ,GAAG,yDAAyD,GAAG;GACnF,EAAE1L,IAAIG,KAAK,CAACwL,QAAQ,GAAG,uFAAuF,GAAG;;;eAGrG,EAAEC,WAAW;QACpB,EAAE5L,IAAIG,KAAK,CAAC4L,IAAI,IAAI,OAAO;mBAChB,EAAE/L,IAAIG,KAAK,CAAC6L,QAAQ,IAAI,GAAG;mBAC3B,EAAEhM,IAAIG,KAAK,CAAC8L,MAAM,IAAI,QAAQ;;;;;;;;;;;;;;;;;;;;;mCAqBd,EAAErG,MAAM;4BAG/B,MAAMsG,YAAY;gCAAC;gCAAUL;6BAAa;4BAC1CK,UAAU1K,IAAI,CAAC,kBAAkBiK;4BAEjC,IAAIzL,IAAIG,KAAK,CAACgM,aAAa,IAAInM,IAAIG,KAAK,CAAC,mBAAmB,EAAE;gCAC5D+L,UAAU1K,IAAI,CAAC;4BACjB;4BAEA,IAAIxB,IAAIG,KAAK,CAACvB,MAAM,EAAE;gCACpBsN,UAAU1K,IAAI,CAAC,gBAAgBxB,IAAIG,KAAK,CAACvB,MAAM;4BACjD;4BAEA,IAAIoB,IAAIG,KAAK,CAAC0F,OAAO,EAAE;gCACrBqG,UAAU1K,IAAI,CAAC;4BACjB;4BAEA,IAAIxB,IAAIG,KAAK,CAACiM,MAAM,IAAIpM,IAAIG,KAAK,CAAC,UAAU,IAAIH,IAAIG,KAAK,CAACiL,CAAC,EAAE;gCAC3D/N,QAAQ;gCACRyD,QAAQC,GAAG,CACT,CAAC,+DAA+D,EAAE0K,OAAO;gCAE3E3K,QAAQC,GAAG,CAAC,CAAC,aAAa,EAAE6K,YAAY;gCACxC9K,QAAQC,GAAG,CAAC,CAAC,eAAe,EAAE6E,MAAM;gCACpC9E,QAAQC,GAAG,CAAC,CAAC,OAAO,EAAE0K,OAAO;gCAC7B3K,QAAQC,GAAG,CAAC,CAAC,MAAM,EAAEf,IAAIG,KAAK,CAAC4L,IAAI,IAAI,QAAQ;gCAC/CjL,QAAQC,GAAG,CAAC,CAAC,UAAU,EAAEf,IAAIG,KAAK,CAAC6L,QAAQ,IAAI,GAAG,CAAC,CAAC;gCACpDlL,QAAQC,GAAG,CAAC,CAAC,QAAQ,EAAEf,IAAIG,KAAK,CAAC8L,MAAM,IAAI,SAAS;gCACpDnL,QAAQC,GAAG,CAAC,CAAC,oBAAoB,CAAC;gCAClCD,QAAQC,GAAG,CAAC,CAAC,4DAA4D,CAAC;gCAC1ED,QAAQC,GAAG,CAAC,CAAC,iBAAiB,EAAEf,IAAIG,KAAK,CAACuL,QAAQ,GAAG,YAAY,YAAY;gCAC7E5K,QAAQC,GAAG,CAAC,CAAC,iDAAiD,CAAC;gCAC/D;4BACF;4BAEA5D,QAAQ,CAAC,0BAA0B,EAAEyO,YAAY;4BACjD9K,QAAQC,GAAG,CAAC,CAAC,kBAAkB,EAAE6E,MAAM;4BACvC9E,QAAQC,GAAG,CAAC,CAAC,UAAU,EAAE0K,OAAO;4BAChC3K,QAAQC,GAAG,CAAC,CAAC,UAAU,EAAEf,IAAIG,KAAK,CAAC4L,IAAI,IAAI,QAAQ;4BACnDjL,QAAQC,GAAG,CAAC,CAAC,aAAa,EAAEf,IAAIG,KAAK,CAAC6L,QAAQ,IAAI,GAAG,CAAC,CAAC;4BACvDlL,QAAQC,GAAG,CAAC,CAAC,WAAW,EAAEf,IAAIG,KAAK,CAAC8L,MAAM,IAAI,SAAS;4BACvDnL,QAAQC,GAAG,CAAC,CAAC,gEAAgE,CAAC;4BAC9ED,QAAQC,GAAG,CAAC;4BACZD,QAAQC,GAAG,CAAC;4BACZD,QAAQC,GAAG,CAAC;4BACZD,QAAQC,GAAG,CAAC;4BACZD,QAAQC,GAAG,CAAC;4BACZD,QAAQC,GAAG,CAAC;4BAGZ,MAAM,EAAEsL,KAAK,EAAE,GAAG,MAAM,MAAM,CAAC;4BAC/B,MAAMC,QAAQD,MACZ,UACAH,UAAUxH,KAAK,CAAC,GAAG6H,GAAG,CAAC,CAACC,MAAQA,IAAIV,OAAO,CAAC,UAAU,MACtD;gCACEW,KAAK;oCACH,GAAG1I,QAAQ0I,GAAG;oCACdC,oBAAoBd;oCACpBe,kBAAkB,AAAC3M,IAAIG,KAAK,CAAC4L,IAAI,IAAe;oCAChDa,sBAAsB,AAAC5M,CAAAA,IAAIG,KAAK,CAAC6L,QAAQ,IAAI,EAAC,EAAGjH,QAAQ;oCACzD8H,oBAAoB,AAAC7M,IAAIG,KAAK,CAAC8L,MAAM,IAAe;oCAEpDa,4BAA4B;oCAC5BC,8BAA8B;oCAC9BC,kCAAkChN,IAAIG,KAAK,CAACuL,QAAQ,GAAG,SAAS;oCAChEuB,sBAAsB;gCACxB;gCACAC,OAAO;4BACT;4BAGF,MAAM/H,SAAS,MAAM,IAAIlB,QAAQ,CAACC;gCAChCoI,MAAMtI,EAAE,CAAC,SAAS,CAACvB;oCACjByB,QAAQ;wCAAE/G,SAASsF,SAAS;wCAAGA;oCAAK;gCACtC;4BACF;4BAEA,IAAI,AAAC0C,OAAehI,OAAO,EAAE;gCAC3BA,QAAQ,CAAC,gBAAgB,EAAEyO,WAAW,uBAAuB,CAAC;4BAChE,OAAO;gCACLxO,MAAM,CAAC,gBAAgB,EAAEwO,WAAW,kBAAkB,EAAE,AAACzG,OAAe1C,IAAI,EAAE;4BAChF;wBACF,EAAE,OAAOD,KAAK;4BACZpF,MAAM,CAAC,wBAAwB,EAAE,AAACoF,IAAcc,OAAO,EAAE;wBAC3D;wBACA;oBACF;gBAEA,KAAK;oBAAS;wBACZ,MAAMgD,eAAetG,IAAIyE,IAAI,CAAC,EAAE;wBAChC,IAAI,CAAC6B,cAAc;4BACjBlJ,MAAM;4BACN;wBACF;wBAEA,IAAI;4BACF,MAAM,EAAEmJ,QAAQ,EAAE,GAAG,MAAM,MAAM,CAAC;4BAClC,MAAMC,UAAU,MAAMD,SAASD,cAAc;4BAC7C,MAAMG,WAAWrD,KAAKsD,KAAK,CAACF;4BAE5BrJ,QAAQ,CAAC,kBAAkB,EAAEsJ,SAASjH,IAAI,IAAI,WAAW;4BACzDsB,QAAQC,GAAG,CAAC,CAAC,UAAU,EAAE0F,SAASzD,KAAK,EAAEvB,UAAU,GAAG;4BAEtD,IAAI,CAACgF,SAASzD,KAAK,IAAIyD,SAASzD,KAAK,CAACvB,MAAM,KAAK,GAAG;gCAClDpE,QAAQ;gCACR;4BACF;4BAEA,MAAM8P,WAAW,EAAE;4BAEnB,KAAK,MAAMvH,QAAQa,SAASzD,KAAK,CAAE;gCACjC,MAAMkJ,YAAY;oCAAC;oCAAU,CAAC,CAAC,EAAEtG,KAAKnG,WAAW,IAAImG,KAAKpG,IAAI,CAAC,CAAC,CAAC;iCAAC;gCAGlE,IAAIoG,KAAK6F,KAAK,EAAE;oCACd,MAAM2B,YAAYC,MAAMC,OAAO,CAAC1H,KAAK6F,KAAK,IAAI7F,KAAK6F,KAAK,CAAC/J,IAAI,CAAC,OAAOkE,KAAK6F,KAAK;oCAC/ES,UAAU1K,IAAI,CAAC,kBAAkB4L;gCACnC;gCAGA,IAAIxH,KAAK2H,eAAe,IAAI3H,KAAK4H,0BAA0B,EAAE;oCAC3DtB,UAAU1K,IAAI,CAAC;gCACjB;gCAEA,IAAIoE,KAAKhH,MAAM,EAAE;oCACfsN,UAAU1K,IAAI,CAAC,gBAAgBoE,KAAKhH,MAAM;gCAC5C;gCAEA,MAAMgG,SACJgB,KAAKV,EAAE,IAAI,CAAC,KAAK,EAAEhC,KAAKC,GAAG,GAAG,CAAC,EAAE0B,KAAKC,MAAM,GAAGC,QAAQ,CAAC,IAAIC,MAAM,CAAC,GAAG,IAAI;gCAE5E,IAAIhF,IAAIG,KAAK,CAACiM,MAAM,IAAIpM,IAAIG,KAAK,CAAC,UAAU,EAAE;oCAC5CW,QAAQC,GAAG,CAAC,CAAC,EAAE,EAAErD,OAAO,WAAW,SAAS,EAAEkI,KAAKpG,IAAI,IAAIoF,QAAQ;oCACnE9D,QAAQC,GAAG,CAAC,CAAC,SAAS,EAAEmL,UAAUxK,IAAI,CAAC,MAAM;oCAC7C;gCACF;gCAEAZ,QAAQC,GAAG,CAAC,CAAC,+BAA+B,EAAE6E,KAAKpG,IAAI,IAAIoF,QAAQ;gCAEnE,MAAM,EAAEyH,KAAK,EAAE,GAAG,MAAM,MAAM,CAAC;gCAC/B,MAAMC,QAAQD,MACZ,UACAH,UAAUxH,KAAK,CAAC,GAAG6H,GAAG,CAAC,CAACC,MAAQA,IAAIV,OAAO,CAAC,UAAU,MACtD;oCACEW,KAAK;wCACH,GAAG1I,QAAQ0I,GAAG;wCACdgB,gBAAgB7I;wCAChB8I,kBAAkB9H,KAAK/F,IAAI,IAAI;oCACjC;oCACAqN,OAAO;gCACT;gCAGF,IAAIzG,SAASiF,QAAQ,EAAE;oCACrByB,SAAS3L,IAAI,CACX,IAAIyC,QAAQ,CAACC;wCACXoI,MAAMtI,EAAE,CAAC,SAAS,CAACvB;4CACjByB,QAAQ;gDAAE/G,SAASsF,SAAS;gDAAGA;4CAAK;wCACtC;oCACF;gCAEJ,OAAO;oCAEL,MAAM0C,SAAS,MAAM,IAAIlB,QAAQ,CAACC;wCAChCoI,MAAMtI,EAAE,CAAC,SAAS,CAACvB;4CACjByB,QAAQ;gDAAE/G,SAASsF,SAAS;gDAAGA;4CAAK;wCACtC;oCACF;oCACA,IAAI,CAAC,AAAC0C,OAAehI,OAAO,EAAE;wCAC5BC,MAAM,CAAC,KAAK,EAAEwH,OAAO,kBAAkB,EAAE,AAACO,OAAe1C,IAAI,EAAE;oCACjE;gCACF;4BACF;4BAEA,IAAIgE,SAASiF,QAAQ,IAAIyB,SAAS1L,MAAM,GAAG,GAAG;gCAC5CtE,QAAQ;gCACR,MAAM+M,UAAU,MAAMjG,QAAQ0J,GAAG,CAACR;gCAClC,MAAMS,SAAS1D,QAAQ2D,MAAM,CAAC,CAACC,IAAW,CAACA,EAAE3Q,OAAO,EAAEsE,MAAM;gCAC5D,IAAImM,SAAS,GAAG;oCACdvQ,QAAQ,GAAGuQ,OAAO,aAAa,CAAC;gCAClC,OAAO;oCACLzQ,QAAQ;gCACV;4BACF;wBACF,EAAE,OAAOqF,KAAK;4BACZpF,MAAM,CAAC,4BAA4B,EAAE,AAACoF,IAAcc,OAAO,EAAE;wBAC/D;wBACA;oBACF;gBAEA;oBAAS;wBACPxC,QAAQC,GAAG,CAAC;wBACZD,QAAQC,GAAG,CAAC;wBACZD,QAAQC,GAAG,CACT;wBAEFD,QAAQC,GAAG,CAAC;wBACZD,QAAQC,GAAG,CAAC;wBACZ;oBACF;YACF;QACF;IACF;IAGA,IAAI;QACF,MAAMgN,wBAAwB,OAAO/N;YAEnC,MAAML,UAAU;gBACdmI,UAAU9H,IAAIG,KAAK,CAAC2H,QAAQ,IAAI9H,IAAIG,KAAK,CAAC4H,CAAC,IAAI;gBAC/CiG,SAAShO,IAAIG,KAAK,CAAC6N,OAAO,IAAIhO,IAAIG,KAAK,CAAC8H,CAAC;gBACzCgG,OAAOjO,IAAIG,KAAK,CAAC8N,KAAK,IAAIjO,IAAIG,KAAK,CAACI,CAAC;gBACrC2N,QAAQlO,IAAIG,KAAK,CAAC+N,MAAM;gBACxBC,QAAQnO,IAAIG,KAAK,CAACgO,MAAM;gBACxBC,WAAWpO,IAAIG,KAAK,CAACiO,SAAS,IAAI;gBAClCC,UAAUrO,IAAIG,KAAK,CAACkO,QAAQ,IAAIrO,IAAIG,KAAK,CAAC,YAAY,IAAI;gBAC1DmO,UAAUtO,IAAIG,KAAK,CAACmO,QAAQ,IAAItO,IAAIG,KAAK,CAAC,YAAY;YACxD;YAEAW,QAAQC,GAAG,CAAC9D,MAAM6J,IAAI,CAAC;YACvBhG,QAAQC,GAAG,CAAC;YACZD,QAAQC,GAAG,CACT;YAIF,IAAI;gBACF,MAAM4D,UAAU,MAAMlG;gBACtB,MAAM6J,QAAQ,MAAM3D,QAAQ4D,QAAQ;gBAEpC,MAAM,EAAEnH,MAAM,EAAE,GAAG,MAAM,MAAM,CAAC;gBAChC,MAAMoH,YAAY,MAAMpH,OAAO,oBAC5BE,IAAI,CAAC,IAAM,MACXC,KAAK,CAAC,IAAM;gBAEf,IAAI,CAACiH,WAAW;oBACdnL,QAAQ;oBACR;gBACF;gBAEAC,KAAK;gBACLwD,QAAQC,GAAG,CAAC;gBAEZ,MAAM+G,WAAWyG,OAAO5O,QAAQmI,QAAQ,IAAI;gBAC5C,IAAI0G,UAAU;gBAEd,MAAMlD,UAAU;oBACdkD,UAAU;oBACV1N,QAAQC,GAAG,CAAC;oBACZgD,QAAQO,IAAI,CAAC;gBACf;gBAEAP,QAAQC,EAAE,CAAC,UAAUsH;gBACrBvH,QAAQC,EAAE,CAAC,WAAWsH;gBAEtBvH,QAAQ0K,MAAM,CAACC,KAAK,CAAC;gBAErB,IAAIC,SAAS;gBACb,MAAOH,QAAS;oBACd,IAAI;wBACF1N,QAAQ8N,KAAK;wBAEb,MAAMC,eAAe,MAAMlK,QAAQ4D,QAAQ;wBAC3C,MAAMxF,SAAS,MAAM4B,QAAQ+C,eAAe;wBAC5C,MAAM1E,QAAQ,MAAM2B,QAAQgB,cAAc;wBAG1CxI,QAAQ;wBACR2D,QAAQC,GAAG,CAAC,IAAI+N,MAAM,CAAC;wBACvBhO,QAAQC,GAAG,CACT,CAAC,QAAQ,EAAE,EAAE4N,OAAO,GAAG,EAAE,IAAIzL,OAAO6L,kBAAkB,GAAG,aAAa,EAAEpP,QAAQmI,QAAQ,CAAC,CAAC,CAAC;wBAG7F,IAAInI,QAAQsO,KAAK,EAAE;4BACjBnN,QAAQC,GAAG,CAAC,CAAC,UAAU,EAAEpB,QAAQsO,KAAK,EAAE;wBAC1C;wBAEA,IAAItO,QAAQuO,MAAM,EAAE;4BAClBpN,QAAQC,GAAG,CAAC,CAAC,+BAA+B,EAAEpB,QAAQyO,SAAS,CAAC,EAAE,CAAC;wBACrE;wBAGAtN,QAAQC,GAAG,CAAC;wBACZ,MAAMiO,WAAWnK,KAAKC,MAAM,KAAK;wBACjC,MAAMmK,cAAcpK,KAAKC,MAAM,KAAK;wBACpC,MAAMsJ,YAAYG,OAAO5O,QAAQyO,SAAS,IAAI;wBAC9C,MAAMc,WAAWF,WAAWZ,YAAY,OAAOY,WAAWZ,YAAY,MAAM,OAAO;wBACnF,MAAMe,cAAcF,cAAc,MAAM,OAAOA,cAAc,MAAM,OAAO;wBAE1EnO,QAAQC,GAAG,CAAC,CAAC,GAAG,EAAEmO,SAAS,MAAM,EAAEF,SAASpE,OAAO,CAAC,GAAG,CAAC,CAAC;wBACzD9J,QAAQC,GAAG,CAAC,CAAC,GAAG,EAAEoO,YAAY,SAAS,EAAEF,YAAYrE,OAAO,CAAC,GAAG,EAAE,CAAC;wBACnE9J,QAAQC,GAAG,CACT,CAAC,cAAc,EAAE8N,aAAapG,YAAY,CAAC,SAAS,EAAEoG,aAAanG,WAAW,CAAC,OAAO,CAAC;wBAEzF5H,QAAQC,GAAG,CACT,CAAC,aAAa,EAAE8N,aAAalG,YAAY,CAAC,UAAU,EAAEkG,aAAajG,UAAU,CAAC,OAAO,CAAC;wBAExF9H,QAAQC,GAAG,CAAC,CAAC,gBAAgB,EAAE8N,aAAahG,cAAc,CAAC,MAAM,CAAC;wBAGlE,IAAI,CAAClJ,QAAQqO,OAAO,EAAE;4BACpBlN,QAAQC,GAAG,CAAC;4BACZD,QAAQC,GAAG,CAAC,CAAC,kBAAkB,EAAE,AAAC,CAAA,MAAM8D,KAAKC,MAAM,KAAK,GAAE,EAAG8F,OAAO,CAAC,GAAG,EAAE,CAAC;4BAC3E9J,QAAQC,GAAG,CAAC,CAAC,eAAe,EAAE,AAAC,CAAA,KAAK8D,KAAKC,MAAM,KAAK,EAAC,EAAG8F,OAAO,CAAC,GAAG,QAAQ,CAAC;4BAC5E9J,QAAQC,GAAG,CAAC,CAAC,eAAe,EAAE,AAAC8D,CAAAA,KAAKC,MAAM,KAAK,CAAA,EAAG8F,OAAO,CAAC,GAAG,CAAC,CAAC;4BAG/D,IAAI,CAACjL,QAAQ2O,QAAQ,EAAE;gCACrBxN,QAAQC,GAAG,CAAC;gCACZ,MAAMqO,QAAQ/B,MAAMgC,IAAI,CAAC;oCAAE5N,QAAQ;gCAAG,GAAG,IAAMoD,KAAKyK,KAAK,CAACzK,KAAKC,MAAM,KAAK;gCAC1E,MAAMyK,QAAQ;oCAAC;oCAAK;oCAAK;oCAAK;oCAAK;oCAAK;oCAAK;oCAAK;iCAAI;gCACtDzO,QAAQC,GAAG,CAAC,CAAC,GAAG,EAAEqO,MAAM7C,GAAG,CAAC,CAACxE,IAAMwH,KAAK,CAACxH,EAAE,EAAErG,IAAI,CAAC,KAAK;4BACzD;wBACF;wBAGA,IAAI/B,QAAQsO,KAAK,IAAI,CAACtO,QAAQqO,OAAO,EAAE;4BACrClN,QAAQC,GAAG,CAAC,CAAC,KAAK,EAAEpB,QAAQsO,KAAK,CAAC,mBAAmB,CAAC;4BACtDnN,QAAQC,GAAG,CAAC,CAAC,kBAAkB,CAAC;4BAChCD,QAAQC,GAAG,CAAC,CAAC,SAAS,EAAE,AAAC8D,CAAAA,KAAKC,MAAM,KAAK,GAAE,EAAG8F,OAAO,CAAC,GAAG,CAAC,CAAC;4BAC3D9J,QAAQC,GAAG,CAAC,CAAC,WAAW,EAAE8D,KAAKyK,KAAK,CAACzK,KAAKC,MAAM,KAAK,MAAM,CAAC,CAAC;4BAC7DhE,QAAQC,GAAG,CAAC,CAAC,gBAAgB,EAAE8D,KAAKyK,KAAK,CAACzK,KAAKC,MAAM,KAAK,MAAM,GAAG;wBACrE;wBAGA,IAAInF,QAAQuO,MAAM,IAAIrJ,KAAKC,MAAM,KAAK,KAAK;4BACzChE,QAAQC,GAAG,CAAC;4BACZD,QAAQC,GAAG,CAAC,CAAC,8BAA8B,CAAC;4BAC5CD,QAAQC,GAAG,CAAC,CAAC,wCAAwC,CAAC;wBACxD;wBAGA,IAAIpB,QAAQwO,MAAM,EAAE;4BAClBrN,QAAQC,GAAG,CAAC;4BACZD,QAAQC,GAAG,CAAC,CAAC,iBAAiB,EAAEpB,QAAQwO,MAAM,EAAE;4BAChDrN,QAAQC,GAAG,CAAC,CAAC,gBAAgB,EAAE4N,QAAQ;wBACzC;wBAGA7N,QAAQC,GAAG,CAAC,OAAO,IAAI+N,MAAM,CAAC;wBAC9BhO,QAAQC,GAAG,CACT,CAAC,WAAW,EAAEpB,QAAQ0O,QAAQ,CAAC,cAAc,EAAE1O,QAAQyO,SAAS,CAAC,wBAAwB,CAAC;wBAG5F,MAAM,IAAInK,QAAQ,CAACC,UAAYsL,WAAWtL,SAAS4D;oBACrD,EAAE,OAAOtF,KAAK;wBACZpF,MAAM,CAAC,eAAe,EAAE,AAACoF,IAAcc,OAAO,EAAE;wBAChD,MAAM,IAAIW,QAAQ,CAACC,UAAYsL,WAAWtL,SAAS4D;oBACrD;gBACF;gBAEA/D,QAAQ0K,MAAM,CAACC,KAAK,CAAC;YACvB,EAAE,OAAOlM,KAAK;gBACZpF,MAAM,CAAC,kCAAkC,EAAE,AAACoF,IAAcc,OAAO,EAAE;YACrE;QACF;QAEAhE,IAAIC,OAAO,CAAC;YACVC,MAAM;YACNC,aAAa;YACbE,SAAS;gBACP;oBACEH,MAAM;oBACNI,OAAO;oBACPH,aAAa;oBACbI,MAAM;oBACN0D,SAAS;gBACX;gBACA;oBAAE/D,MAAM;oBAAWI,OAAO;oBAAKH,aAAa;oBAAqBI,MAAM;gBAAU;gBACjF;oBAAEL,MAAM;oBAASI,OAAO;oBAAKH,aAAa;oBAA+BI,MAAM;gBAAS;gBACxF;oBAAEL,MAAM;oBAAUC,aAAa;oBAA8BI,MAAM;gBAAU;gBAC7E;oBAAEL,MAAM;oBAAUC,aAAa;oBAAkCI,MAAM;gBAAS;gBAChF;oBACEL,MAAM;oBACNC,aAAa;oBACbI,MAAM;oBACN0D,SAAS;gBACX;gBACA;oBACE/D,MAAM;oBACNC,aAAa;oBACbI,MAAM;oBACN0D,SAAS;gBACX;gBACA;oBAAE/D,MAAM;oBAAaC,aAAa;oBAAwBI,MAAM;gBAAU;aAC3E;YACDE,QAAQgO;QACV;IACF,EAAE,OAAOvL,KAAK;QACZnF,QAAQ;QAGRiC,IAAIC,OAAO,CAAC;YACVC,MAAM;YACNC,aAAa;YACbE,SAAS;gBACP;oBACEH,MAAM;oBACNI,OAAO;oBACPH,aAAa;oBACbI,MAAM;oBACN0D,SAAS;gBACX;gBACA;oBAAE/D,MAAM;oBAAWI,OAAO;oBAAKH,aAAa;oBAAqBI,MAAM;gBAAU;gBACjF;oBAAEL,MAAM;oBAASI,OAAO;oBAAKH,aAAa;oBAA+BI,MAAM;gBAAS;aACzF;YACDE,QAAQ,OAAOC;gBAEb,IAAI;oBACF,MAAM2E,UAAU,MAAMlG;oBACtB,MAAM,EAAE2C,MAAM,EAAE,GAAG,MAAM,MAAM,CAAC;oBAChC,MAAMoH,YAAY,MAAMpH,OAAO,oBAC5BE,IAAI,CAAC,IAAM,MACXC,KAAK,CAAC,IAAM;oBAEf,IAAI,CAACiH,WAAW;wBACdnL,QAAQ;wBACR;oBACF;oBAEAC,KAAK;oBACLwD,QAAQC,GAAG,CAAC;oBAEZ,MAAM+G,WAAW,AAAC,CAAA,AAAC9H,IAAIG,KAAK,CAAC2H,QAAQ,IAAe,CAAA,IAAK;oBACzD,IAAI0G,UAAU;oBAEd,MAAMlD,UAAU;wBACdkD,UAAU;wBACV1N,QAAQC,GAAG,CAAC;wBACZgD,QAAQO,IAAI,CAAC;oBACf;oBAEAP,QAAQC,EAAE,CAAC,UAAUsH;oBAErB,MAAOkD,QAAS;wBACd1N,QAAQ8N,KAAK;wBACb,MAAMtG,QAAQ,MAAM3D,QAAQ4D,QAAQ;wBACpCpL,QAAQ;wBACR2D,QAAQC,GAAG,CAAC,CAAC,kBAAkB,CAAC;wBAChCD,QAAQC,GAAG,CAAC,CAAC,WAAW,EAAEuH,MAAMG,YAAY,CAAC,OAAO,CAAC;wBACrD3H,QAAQC,GAAG,CAAC,CAAC,UAAU,EAAEuH,MAAMK,YAAY,CAAC,QAAQ,CAAC;wBACrD7H,QAAQC,GAAG,CAAC,CAAC,cAAc,EAAE,IAAImC,OAAO6L,kBAAkB,IAAI;wBAC9D,MAAM,IAAI9K,QAAQ,CAACC,UAAYsL,WAAWtL,SAAS4D;oBACrD;gBACF,EAAE,OAAOtF,KAAK;oBACZpF,MAAM,CAAC,yBAAyB,EAAE,AAACoF,IAAcc,OAAO,EAAE;gBAC5D;YACF;QACF;IACF;IAGAhE,IAAIC,OAAO,CAAC;QACVC,MAAM;QACNC,aAAa;QACbE,SAAS;YACP;gBACEH,MAAM;gBACNI,OAAO;gBACPH,aACE;gBACFI,MAAM;gBACN0D,SAAS;YACX;YACA;gBACE/D,MAAM;gBACNI,OAAO;gBACPH,aAAa;gBACbI,MAAM;gBACN0D,SAAS;YACX;YACA;gBACE/D,MAAM;gBACNC,aAAa;gBACbI,MAAM;gBACN0D,SAAS;YACX;YACA;gBACE/D,MAAM;gBACNC,aAAa;gBACbI,MAAM;gBACN0D,SAAS;YACX;YACA;gBACE/D,MAAM;gBACNC,aAAa;gBACbI,MAAM;YACR;YACA;gBACEL,MAAM;gBACNC,aAAa;gBACbI,MAAM;YACR;YACA;gBACEL,MAAM;gBACNC,aAAa;gBACbI,MAAM;gBACN0D,SAAS;YACX;YACA;gBACE/D,MAAM;gBACNC,aAAa;gBACbI,MAAM;gBACN0D,SAAS;YACX;YACA;gBACE/D,MAAM;gBACNC,aAAa;gBACbI,MAAM;YACR;YACA;gBACEL,MAAM;gBACNC,aAAa;gBACbI,MAAM;YACR;YACA;gBACEL,MAAM;gBACNI,OAAO;gBACPH,aAAa;gBACbI,MAAM;YACR;YACA;gBACEL,MAAM;gBACNI,OAAO;gBACPH,aAAa;gBACbI,MAAM;YACR;YACA;gBACEL,MAAM;gBACNI,OAAO;gBACPH,aAAa;gBACbI,MAAM;YACR;YACA;gBACEL,MAAM;gBACNC,aAAa;gBACbI,MAAM;YACR;YACA;gBACEL,MAAM;gBACNC,aAAa;gBACbI,MAAM;YACR;YACA;gBACEL,MAAM;gBACNC,aAAa;gBACbI,MAAM;YACR;YACA;gBACEL,MAAM;gBACNC,aAAa;gBACbI,MAAM;YACR;YACA;gBACEL,MAAM;gBACNC,aAAa;gBACbI,MAAM;YACR;SACD;QACDE,QAAQ/B;IACV;IAGAsB,IAAIC,OAAO,CAAC;QACVC,MAAM;QACNC,aAAa;QACbE,SAAS;YACP;gBACEH,MAAM;gBACNI,OAAO;gBACPH,aAAa;gBACbI,MAAM;gBACN0D,SAAS;YACX;YACA;gBACE/D,MAAM;gBACNC,aAAa;gBACbI,MAAM;YACR;YACA;gBACEL,MAAM;gBACNI,OAAO;gBACPH,aAAa;gBACbI,MAAM;YACR;YACA;gBACEL,MAAM;gBACNI,OAAO;gBACPH,aAAa;gBACbI,MAAM;YACR;YACA;gBACEL,MAAM;gBACNI,OAAO;gBACPH,aAAa;gBACbI,MAAM;YACR;YACA;gBACEL,MAAM;gBACNC,aAAa;gBACbI,MAAM;gBACN0D,SAAS;YACX;YACA;gBACE/D,MAAM;gBACNC,aAAa;gBACbI,MAAM;YACR;YACA;gBACEL,MAAM;gBACNC,aAAa;gBACbI,MAAM;YACR;YACA;gBACEL,MAAM;gBACNC,aAAa;gBACbI,MAAM;gBACN0D,SAAS;YACX;SACD;QACDxD,QAAQ,OAAOC;YACb,IAAI;gBACFc,QAAQC,GAAG,CAAC9D,MAAM6J,IAAI,CAAC;gBACvBhG,QAAQC,GAAG,CAAC;gBAEZ,IAAIf,IAAIG,KAAK,CAACsP,KAAK,EAAE;oBACnB3O,QAAQC,GAAG,CAAC;gBACd;gBAEA,IAAIf,IAAIG,KAAK,CAACuL,QAAQ,EAAE;oBACtB5K,QAAQC,GAAG,CAAC;gBACd;gBAEA,IAAIf,IAAIG,KAAK,CAACuP,aAAa,EAAE;oBAC3B5O,QAAQC,GAAG,CAAC;gBACd;gBAGA,MAAM7C,YAAY8B;YACpB,EAAE,OAAOwC,KAAK;gBACZpF,MAAM,CAAC,uBAAuB,EAAE,AAACoF,IAAcc,OAAO,EAAE;YAC1D;QACF;IACF;IAGA,MAAMqM,aAAaxR;IACnBmB,IAAIC,OAAO,CAACoQ;IAGZrQ,IAAIC,OAAO,CAAC;QACVC,MAAM;QACNC,aAAa;QACbE,SAAS;YACP;gBACEH,MAAM;gBACNI,OAAO;gBACPH,aAAa;gBACbI,MAAM;gBACN0D,SAAS;YACX;YACA;gBACE/D,MAAM;gBACNC,aAAa;gBACbI,MAAM;gBACN0D,SAAS;YACX;YACA;gBACE/D,MAAM;gBACNC,aAAa;gBACbI,MAAM;gBACN0D,SAAS;YACX;YACA;gBACE/D,MAAM;gBACNC,aAAa;gBACbI,MAAM;YACR;YACA;gBACEL,MAAM;gBACNC,aAAa;gBACbI,MAAM;YACR;YACA;gBACEL,MAAM;gBACNC,aAAa;gBACbI,MAAM;gBACN0D,SAAS;YACX;YACA;gBACE/D,MAAM;gBACNC,aAAa;gBACbI,MAAM;gBACN0D,SAAS;YACX;YACA;gBACE/D,MAAM;gBACNC,aAAa;gBACbI,MAAM;YACR;YACA;gBACEL,MAAM;gBACNC,aAAa;gBACbI,MAAM;YACR;YACA;gBACEL,MAAM;gBACNI,OAAO;gBACPH,aAAa;gBACbI,MAAM;YACR;YACA;gBACEL,MAAM;gBACNI,OAAO;gBACPH,aAAa;gBACbI,MAAM;YACR;YACA;gBACEL,MAAM;gBACNI,OAAO;gBACPH,aAAa;gBACbI,MAAM;YACR;SACD;QACDE,QAAQ,OAAOC;YAEbA,IAAIG,KAAK,CAACyP,EAAE,GAAG;YACf,MAAM5R,YAAYgC;QACpB;IACF;IAGA,IAAI;QACF,MAAM6P,wBAAwB,OAAO7P;YACnCc,QAAQC,GAAG,CAAC9D,MAAM6J,IAAI,CAAC;YACvBhG,QAAQC,GAAG,CAAC;YACZD,QAAQC,GAAG;YACXD,QAAQC,GAAG,CAAC;YACZD,QAAQC,GAAG,CAAC;YACZD,QAAQC,GAAG,CAAC;YACZD,QAAQC,GAAG,CAAC;YACZD,QAAQC,GAAG,CAAC;YACZD,QAAQC,GAAG,CAAC;YACZD,QAAQC,GAAG,CAAC;YACZD,QAAQC,GAAG,CAAC;YACZD,QAAQC,GAAG,CAAC;YACZD,QAAQC,GAAG,CAAC;YACZD,QAAQC,GAAG,CAAC;YACZD,QAAQC,GAAG,CAAC;YACZD,QAAQC,GAAG,CAAC;YACZD,QAAQC,GAAG;YACXD,QAAQC,GAAG,CAAC;YACZD,QAAQC,GAAG,CAAC;YACZD,QAAQC,GAAG,CAAC;YACZD,QAAQC,GAAG,CAAC;YACZD,QAAQC,GAAG,CAAC;YACZD,QAAQC,GAAG,CAAC;YACZD,QAAQC,GAAG,CAAC;YAEZ,MAAMyD,aAAaxE,IAAIyE,IAAI,CAAC,EAAE;YAC9B,IAAID,YAAY;gBACd1D,QAAQC,GAAG;gBACXD,QAAQC,GAAG,CACT,CAAC,sBAAsB,EAAEyD,WAAW,4BAA4B,EAAEA,WAAW,OAAO,CAAC;YAEzF;QACF;QAEAlF,IAAIC,OAAO,CAAC;YACVC,MAAM;YACNC,aAAa;YACbM,QAAQ8P;QACV;IACF,EAAE,OAAOrN,KAAK;QACZnF,QAAQ;IACV;IAGA,IAAI;QACF,MAAMyS,sBAAsB,OAAO9P;YACjCc,QAAQC,GAAG,CAAC9D,MAAM6J,IAAI,CAAC;YACvBhG,QAAQC,GAAG,CAAC;YACZD,QAAQC,GAAG;YAEX,MAAMpB,UAAU;gBACd+D,QAAQ1D,IAAIG,KAAK,CAACuD,MAAM,IAAI1D,IAAIG,KAAK,CAACiL,CAAC;gBACvCtC,MAAM9I,IAAIG,KAAK,CAAC2I,IAAI,IAAI9I,IAAIG,KAAK,CAAC4P,CAAC,IAAI;gBACvCC,cAAchQ,IAAIG,KAAK,CAAC6P,YAAY,IAAIhQ,IAAIG,KAAK,CAAC,gBAAgB,IAAI;gBACtEyP,IAAI5P,IAAIG,KAAK,CAACyP,EAAE,IAAI5P,IAAIG,KAAK,CAAC8P,CAAC;gBAC/BpK,SAAS7F,IAAIG,KAAK,CAAC0F,OAAO,IAAI7F,IAAIG,KAAK,CAAC+P,CAAC;gBACzCC,WAAWnQ,IAAIG,KAAK,CAACgQ,SAAS,IAAInQ,IAAIG,KAAK,CAAC,aAAa;gBACzDvB,QAAQoB,IAAIG,KAAK,CAACvB,MAAM;gBACxBsB,OAAOF,IAAIG,KAAK,CAACD,KAAK;gBACtBkI,aAAapI,IAAIG,KAAK,CAACiI,WAAW,IAAIpI,IAAIG,KAAK,CAAC,eAAe;gBAC/DiQ,SAASpQ,IAAIG,KAAK,CAACiQ,OAAO,IAAI;YAChC;YAEA,IAAIzQ,QAAQiQ,EAAE,EAAE;gBACd9O,QAAQC,GAAG,CAAC;YACd;YAEA,IAAIpB,QAAQ+D,MAAM,EAAE;gBAClB5C,QAAQC,GAAG,CAAC;YACd;YAEA,IAAIpB,QAAQyI,WAAW,EAAE;gBACvBtH,QAAQC,GAAG,CAAC;YACd;YAEAD,QAAQC,GAAG;YACXD,QAAQC,GAAG,CAAC;YACZD,QAAQC,GAAG,CACT;YAIF,IAAI;gBACF,MAAMyC,OAAO,MAAM7E;gBACnB,MAAM6E,KAAKC,KAAK;gBAEhBtG,QAAQ;gBACRG,KAAK;gBACLwD,QAAQC,GAAG,CAAC;gBACZD,QAAQC,GAAG,CAAC;gBACZD,QAAQC,GAAG,CAAC;gBACZD,QAAQC,GAAG,CAAC;gBACZD,QAAQC,GAAG,CAAC;gBACZD,QAAQC,GAAG,CAAC;gBAEZ,IAAI,CAACpB,QAAQ+D,MAAM,EAAE;oBACnBpG,KAAK;oBACL,MAAMqG,aAAa,IAAIC;oBACvB,MAAMC,WAAW;wBACf/C,QAAQC,GAAG,CAAC;wBACZ4C,WAAWG,KAAK;oBAClB;oBACAC,QAAQC,EAAE,CAAC,UAAUH;oBACrBE,QAAQC,EAAE,CAAC,WAAWH;oBAEtB,MAAM,IAAII,QAAc,CAACC;wBACvBP,WAAWQ,MAAM,CAACC,gBAAgB,CAAC,SAAS,IAAMF;oBACpD;gBACF;YACF,EAAE,OAAO1B,KAAK;gBACZpF,MAAM,CAAC,iCAAiC,EAAE,AAACoF,IAAcc,OAAO,EAAE;gBAClES,QAAQO,IAAI,CAAC;YACf;QACF;QAGAhF,IAAIC,OAAO,CAAC;YACVC,MAAM;YACNC,aAAa;YACbE,SAAS;gBACP;oBAAEH,MAAM;oBAAUI,OAAO;oBAAKH,aAAa;oBAA+BI,MAAM;gBAAU;gBAC1F;oBAAEL,MAAM;oBAAQI,OAAO;oBAAKH,aAAa;oBAAmBI,MAAM;oBAAU0D,SAAS;gBAAK;gBAC1F;oBACE/D,MAAM;oBACNC,aAAa;oBACbI,MAAM;oBACN0D,SAAS;gBACX;gBACA;oBACE/D,MAAM;oBACNI,OAAO;oBACPH,aAAa;oBACbI,MAAM;gBACR;gBACA;oBAAEL,MAAM;oBAAWI,OAAO;oBAAKH,aAAa;oBAA0BI,MAAM;gBAAU;gBACtF;oBAAEL,MAAM;oBAAcC,aAAa;oBAAqCI,MAAM;gBAAU;gBACxF;oBAAEL,MAAM;oBAAUC,aAAa;oBAA2BI,MAAM;gBAAS;gBACzE;oBAAEL,MAAM;oBAASC,aAAa;oBAAuCI,MAAM;gBAAU;gBACrF;oBACEL,MAAM;oBACNC,aAAa;oBACbI,MAAM;gBACR;gBACA;oBAAEL,MAAM;oBAAWC,aAAa;oBAA8BI,MAAM;oBAAU0D,SAAS;gBAAG;aAC3F;YACDxD,QAAQ+P;QACV;IACF,EAAE,OAAOtN,KAAK;QACZnF,QAAQ;IACV;IAGAiC,IAAIC,OAAO,CAAC;QACVC,MAAM;QACNC,aAAa;QACbM,QAAQ,CAACC;YACP,MAAMT,UAAUS,IAAIyE,IAAI,CAAC,EAAE;YAE3B,IAAIlF,YAAY,UAAU;gBACxBuB,QAAQC,GAAG,CAACvD,KAAKC,KAAK;gBACtBqD,QAAQC,GAAG;gBACXD,QAAQC,GAAG,CAAC;gBACZD,QAAQC,GAAG;gBACXD,QAAQC,GAAG,CAACvD,KAAK;gBACjBsD,QAAQC,GAAG,CAAC;gBACZD,QAAQC,GAAG,CAAC;gBACZD,QAAQC,GAAG;gBACXD,QAAQC,GAAG,CAACvD,KAAK;gBACjBsD,QAAQC,GAAG,CAAC;gBACZD,QAAQC,GAAG,CAAC;gBACZD,QAAQC,GAAG,CAAC;gBACZD,QAAQC,GAAG,CACT;gBAEFD,QAAQC,GAAG,CAAC;gBACZD,QAAQC,GAAG,CAAC;gBACZD,QAAQC,GAAG,CAAC;gBACZD,QAAQC,GAAG,CAAC;gBACZD,QAAQC,GAAG,CAAC;gBACZD,QAAQC,GAAG,CAAC;gBACZD,QAAQC,GAAG;gBACXD,QAAQC,GAAG,CAACvD,KAAK;gBACjBsD,QAAQC,GAAG,CACT,CAAC,EAAE,EAAEtD,KAAK,4BAA4B,sDAAsD,CAAC;gBAE/FqD,QAAQC,GAAG,CACT,CAAC,EAAE,EAAEtD,KAAK,4BAA4B,4DAA4D,CAAC;gBAErGqD,QAAQC,GAAG,CAAC,CAAC,EAAE,EAAEtD,KAAK,4BAA4B,wBAAwB,CAAC;gBAC3EqD,QAAQC,GAAG;gBACXD,QAAQC,GAAG,CACT;YAEJ,OAAO,IAAIxB,YAAY,WAAWA,YAAY,YAAY;gBACxDuB,QAAQC,GAAG,CAACvD,KAAKC,KAAK;gBACtBqD,QAAQC,GAAG;gBACXD,QAAQC,GAAG,CAAC;gBACZD,QAAQC,GAAG;gBACXD,QAAQC,GAAG,CAACvD,KAAK;gBACjBsD,QAAQC,GAAG,CAAC;gBACZD,QAAQC,GAAG,CACT;gBAEFD,QAAQC,GAAG;gBACXD,QAAQC,GAAG,CAACvD,KAAK;gBACjBsD,QAAQC,GAAG,CACT;gBAEFD,QAAQC,GAAG,CAAC;gBACZD,QAAQC,GAAG,CAAC;gBACZD,QAAQC,GAAG,CAAC;gBACZD,QAAQC,GAAG,CAAC;gBACZD,QAAQC,GAAG,CAAC;gBACZD,QAAQC,GAAG,CAAC;gBACZD,QAAQC,GAAG,CAAC;gBACZD,QAAQC,GAAG,CAAC;gBACZD,QAAQC,GAAG,CAAC;gBACZD,QAAQC,GAAG,CAAC;gBACZD,QAAQC,GAAG,CAAC;gBACZD,QAAQC,GAAG,CAAC;gBACZD,QAAQC,GAAG,CAAC;gBACZD,QAAQC,GAAG,CAAC;gBACZD,QAAQC,GAAG;gBACXD,QAAQC,GAAG,CAACvD,KAAK;gBACjBsD,QAAQC,GAAG,CAAC,CAAC,EAAE,EAAEtD,KAAK,qBAAqB,mBAAmB,CAAC;gBAC/DqD,QAAQC,GAAG,CAAC,CAAC,EAAE,EAAEtD,KAAK,wBAAwB,wCAAwC,CAAC;gBACvFqD,QAAQC,GAAG,CACT,CAAC,EAAE,EAAEtD,KAAK,qBAAqB,6DAA6D,CAAC;gBAE/FqD,QAAQC,GAAG,CACT,CAAC,EAAE,EAAEtD,KAAK,qBAAqB,2DAA2D,CAAC;gBAE7FqD,QAAQC,GAAG;gBACXD,QAAQC,GAAG,CAACvD,KAAK;gBACjBsD,QAAQC,GAAG,CAAC;gBACZD,QAAQC,GAAG,CAAC,CAAC,IAAI,EAAEtD,KAAK,wBAAwB,2BAA2B,CAAC;gBAC5EqD,QAAQC,GAAG,CAAC,CAAC,IAAI,EAAEtD,KAAK,qBAAqB,iBAAiB,CAAC;gBAC/DqD,QAAQC,GAAG;gBACXD,QAAQC,GAAG,CAAC;gBACZD,QAAQC,GAAG,CAAC;gBACZD,QAAQC,GAAG,CAAC;YACd,OAAO,IAAIxB,YAAY,SAAS;gBAC9BuB,QAAQC,GAAG,CAACvD,KAAKC,KAAK;gBACtBqD,QAAQC,GAAG;gBACXD,QAAQC,GAAG,CAAC;gBACZD,QAAQC,GAAG,CACT;gBAEFD,QAAQC,GAAG;gBACXD,QAAQC,GAAG,CAACvD,KAAK;gBACjBsD,QAAQC,GAAG,CAAC;gBACZD,QAAQC,GAAG,CAAC;gBACZD,QAAQC,GAAG,CAAC;gBACZD,QAAQC,GAAG,CAAC;gBACZD,QAAQC,GAAG,CAAC;gBACZD,QAAQC,GAAG;gBACXD,QAAQC,GAAG,CAACvD,KAAK;gBACjBsD,QAAQC,GAAG,CAAC;gBACZD,QAAQC,GAAG,CAAC;gBACZD,QAAQC,GAAG,CAAC;gBACZD,QAAQC,GAAG,CAAC;gBACZD,QAAQC,GAAG,CAAC;gBACZD,QAAQC,GAAG,CAAC;gBACZD,QAAQC,GAAG,CAAC;gBACZD,QAAQC,GAAG,CAAC;gBACZD,QAAQC,GAAG;gBACXD,QAAQC,GAAG,CAACvD,KAAK;gBACjBsD,QAAQC,GAAG,CAAC;gBACZD,QAAQC,GAAG,CAAC;gBACZD,QAAQC,GAAG,CAAC;gBACZD,QAAQC,GAAG,CAAC;gBACZD,QAAQC,GAAG,CAAC;gBACZD,QAAQC,GAAG,CAAC;gBACZD,QAAQC,GAAG;gBACXD,QAAQC,GAAG,CAACvD,KAAK;gBACjBsD,QAAQC,GAAG,CACT,CAAC,EAAE,EAAEtD,KAAK,2BAA2B,8CAA8C,CAAC;gBAEtFqD,QAAQC,GAAG,CACT,CAAC,EAAE,EAAEtD,KAAK,8BAA8B,+CAA+C,CAAC;gBAE1FqD,QAAQC,GAAG,CACT,CAAC,EAAE,EAAEtD,KAAK,yBAAyB,mDAAmD,CAAC;gBAEzFqD,QAAQC,GAAG,CACT,CAAC,EAAE,EAAEtD,KAAK,8BAA8B,4CAA4C,CAAC;gBAEvFqD,QAAQC,GAAG;gBACXD,QAAQC,GAAG,CACT;YAEJ,OAAO,IAAIxB,YAAY,SAAS;gBAC9BuB,QAAQC,GAAG,CAACvD,KAAKC,KAAK;gBACtBqD,QAAQC,GAAG;gBACXD,QAAQC,GAAG,CACT;gBAEFD,QAAQC,GAAG;gBACXD,QAAQC,GAAG,CAACvD,KAAK;gBACjBsD,QAAQC,GAAG,CAAC;gBACZD,QAAQC,GAAG;gBACXD,QAAQC,GAAG,CAACvD,KAAK;gBACjBsD,QAAQC,GAAG,CAAC;gBACZD,QAAQC,GAAG,CAAC;gBACZD,QAAQC,GAAG,CAAC;gBACZD,QAAQC,GAAG,CAAC;gBACZD,QAAQC,GAAG,CAAC;gBACZD,QAAQC,GAAG,CAAC;gBACZD,QAAQC,GAAG,CAAC;gBACZD,QAAQC,GAAG,CAAC;gBACZD,QAAQC,GAAG,CAAC;gBACZD,QAAQC,GAAG,CAAC;gBACZD,QAAQC,GAAG;gBACXD,QAAQC,GAAG,CAACvD,KAAK;gBACjBsD,QAAQC,GAAG,CAAC,CAAC,EAAE,EAAEtD,KAAK,qBAAqB,sCAAsC,CAAC;gBAClFqD,QAAQC,GAAG,CAAC,CAAC,EAAE,EAAEtD,KAAK,8BAA8B,8BAA8B,CAAC;gBACnFqD,QAAQC,GAAG,CAAC,CAAC,EAAE,EAAEtD,KAAK,0BAA0B,sCAAsC,CAAC;gBACvFqD,QAAQC,GAAG,CAAC,CAAC,EAAE,EAAEtD,KAAK,oCAAoC,6BAA6B,CAAC;YAC1F,OAAO,IAAI8B,YAAY,UAAU;gBAC/BuB,QAAQC,GAAG,CAACvD,KAAKC,KAAK;gBACtBqD,QAAQC,GAAG;gBACXD,QAAQC,GAAG,CAAC;gBACZD,QAAQC,GAAG;gBACXD,QAAQC,GAAG,CAACvD,KAAK;gBACjBsD,QAAQC,GAAG,CAAC;gBACZD,QAAQC,GAAG;gBACXD,QAAQC,GAAG,CAACvD,KAAK;gBACjBsD,QAAQC,GAAG,CAAC;gBACZD,QAAQC,GAAG,CAAC;gBACZD,QAAQC,GAAG,CAAC;gBACZD,QAAQC,GAAG,CAAC;gBACZD,QAAQC,GAAG,CAAC;gBACZD,QAAQC,GAAG,CAAC;gBACZD,QAAQC,GAAG,CAAC;gBACZD,QAAQC,GAAG;gBACXD,QAAQC,GAAG,CAACvD,KAAK;gBACjBsD,QAAQC,GAAG,CAAC,CAAC,EAAE,EAAEtD,KAAK,sBAAsB,iCAAiC,CAAC;gBAC9EqD,QAAQC,GAAG,CAAC,CAAC,EAAE,EAAEtD,KAAK,8BAA8B,yBAAyB,CAAC;gBAC9EqD,QAAQC,GAAG,CAAC,CAAC,EAAE,EAAEtD,KAAK,iCAAiC,4BAA4B,CAAC;gBACpFqD,QAAQC,GAAG,CAAC,CAAC,EAAE,EAAEtD,KAAK,sCAAsC,uBAAuB,CAAC;YACtF,OAAO,IAAI8B,YAAY,WAAW;gBAChCuB,QAAQC,GAAG,CAACvD,KAAKC,KAAK;gBACtBqD,QAAQC,GAAG;gBACXD,QAAQC,GAAG,CAAC;gBACZD,QAAQC,GAAG;gBACXD,QAAQC,GAAG,CAACvD,KAAK;gBACjBsD,QAAQC,GAAG,CAAC;gBACZD,QAAQC,GAAG;gBACXD,QAAQC,GAAG,CAACvD,KAAK;gBACjBsD,QAAQC,GAAG,CAAC;gBACZD,QAAQC,GAAG,CAAC;gBACZD,QAAQC,GAAG,CAAC;gBACZD,QAAQC,GAAG,CAAC;gBACZD,QAAQC,GAAG,CAAC;gBACZD,QAAQC,GAAG,CAAC;gBACZD,QAAQC,GAAG,CAAC;gBACZD,QAAQC,GAAG,CAAC;gBACZD,QAAQC,GAAG;gBACXD,QAAQC,GAAG,CAACvD,KAAK;gBACjBsD,QAAQC,GAAG,CAAC,CAAC,EAAE,EAAEtD,KAAK,uBAAuB,oCAAoC,CAAC;gBAClFqD,QAAQC,GAAG,CAAC,CAAC,EAAE,EAAEtD,KAAK,gCAAgC,wBAAwB,CAAC;gBAC/EqD,QAAQC,GAAG,CAAC,CAAC,EAAE,EAAEtD,KAAK,mCAAmC,uBAAuB,CAAC;gBACjFqD,QAAQC,GAAG,CAAC,CAAC,EAAE,EAAEtD,KAAK,0CAA0C,cAAc,CAAC;YACjF,OAAO,IAAI8B,YAAY,WAAW;gBAChCuB,QAAQC,GAAG,CAACvD,KAAKC,KAAK;gBACtBqD,QAAQC,GAAG;gBACXD,QAAQC,GAAG,CAAC;gBACZD,QAAQC,GAAG;gBACXD,QAAQC,GAAG,CAACvD,KAAK;gBACjBsD,QAAQC,GAAG,CAAC;gBACZD,QAAQC,GAAG,CAAC;gBACZD,QAAQC,GAAG,CAAC;gBACZD,QAAQC,GAAG,CAAC;gBACZD,QAAQC,GAAG,CAAC;gBACZD,QAAQC,GAAG,CAAC;gBACZD,QAAQC,GAAG,CAAC;gBACZD,QAAQC,GAAG,CAAC;gBACZD,QAAQC,GAAG,CAAC;gBACZD,QAAQC,GAAG,CAAC;gBACZD,QAAQC,GAAG,CAAC;gBACZD,QAAQC,GAAG,CAAC;gBACZD,QAAQC,GAAG;gBACXD,QAAQC,GAAG,CAACvD,KAAK;gBACjBsD,QAAQC,GAAG,CAAC,CAAC,EAAE,EAAEtD,KAAK,4BAA4B,4BAA4B,CAAC;gBAC/EqD,QAAQC,GAAG,CAAC,CAAC,EAAE,EAAEtD,KAAK,mCAAmC,oBAAoB,CAAC;gBAC9EqD,QAAQC,GAAG,CAAC,CAAC,EAAE,EAAEtD,KAAK,sCAAsC,oBAAoB,CAAC;gBACjFqD,QAAQC,GAAG,CAAC,CAAC,EAAE,EAAEtD,KAAK,sCAAsC,qBAAqB,CAAC;YACpF,OAAO;gBAELqD,QAAQC,GAAG,CAACvD,KAAKC,KAAK;gBACtBqD,QAAQC,GAAG;gBACXD,QAAQC,GAAG,CAAC;gBACZD,QAAQC,GAAG,CAAC;gBACZD,QAAQC,GAAG,CAAC;gBACZD,QAAQC,GAAG,CAAC;gBACZD,QAAQC,GAAG,CAAC;gBACZD,QAAQC,GAAG,CAAC;gBACZD,QAAQC,GAAG,CAAC;gBACZD,QAAQC,GAAG,CAAC;gBACZD,QAAQC,GAAG,CAAC;gBACZD,QAAQC,GAAG,CAAC;gBACZD,QAAQC,GAAG,CAAC;gBACZD,QAAQC,GAAG,CAAC;gBACZD,QAAQC,GAAG;gBACXD,QAAQC,GAAG,CAAC;gBACZD,QAAQC,GAAG,CAAC,CAAC,EAAE,EAAEtD,KAAK,+BAA+B;gBACrDqD,QAAQC,GAAG;gBACXD,QAAQC,GAAG,CAAC;gBACZD,QAAQC,GAAG,CAAC;gBACZD,QAAQC,GAAG,CAAC;gBACZD,QAAQC,GAAG,CAAC;gBACZD,QAAQC,GAAG,CAAC;gBACZD,QAAQC,GAAG,CAAC;gBACZD,QAAQC,GAAG,CAAC;YACd;QACF;IACF;IAGAD,QAAQC,GAAG,CAAC9D,MAAM6J,IAAI,CAAC;IACvBhG,QAAQC,GAAG,CAAC;IACZD,QAAQC,GAAG,CAAC;IACZD,QAAQC,GAAG,CAAC;IACZD,QAAQC,GAAG,CAAC;IACZD,QAAQC,GAAG,CAAC;IACZD,QAAQC,GAAG;IACXD,QAAQC,GAAG,CAAC;IAGZzB,IAAIC,OAAO,CAAC;QACVC,MAAM;QACNC,aAAa;QACb8E,SAAS;YAAC;YAAQ;SAAQ;QAC1B5E,SAAS;YACP;gBACEH,MAAM;gBACNC,aAAa;gBACbI,MAAM;YACR;YACA;gBACEL,MAAM;gBACNI,OAAO;gBACPH,aAAa;gBACbI,MAAM;YACR;YACA;gBACEL,MAAM;gBACNI,OAAO;gBACPH,aAAa;gBACbI,MAAM;gBACN0D,SAAS;YACX;YACA;gBACE/D,MAAM;gBACNI,OAAO;gBACPH,aAAa;gBACbI,MAAM;gBACN0D,SAAS;YACX;YACA;gBACE/D,MAAM;gBACNI,OAAO;gBACPH,aAAa;gBACbI,MAAM;YACR;SACD;QACDE,QAAQ,OAAOC;YACb,IAAI;gBACF,MAAMwE,aAAaxE,IAAIyE,IAAI,CAAC,EAAE,IAAI;gBAGlC,MAAM,EAAE4L,eAAe,EAAE,GAAG,MAAM,MAAM,CAAC;gBAGzC,OAAQ7L;oBACN,KAAK;wBACH,MAAM,EAAE8L,WAAW,EAAE,GAAG,MAAM,MAAM,CAAC;wBACrC,MAAMA,YAAYC,UAAU,CAACxM,QAAQyM,IAAI,CAAC9L,KAAK,CAAC;wBAChD;oBACF,KAAK;wBACH,MAAM,EAAE+L,YAAY,EAAE,GAAG,MAAM,MAAM,CAAC;wBACtC,MAAMA,aAAaF,UAAU,CAACxM,QAAQyM,IAAI,CAAC9L,KAAK,CAAC;wBACjD;oBACF,KAAK;wBACH,MAAM,EAAEgM,aAAa,EAAE,GAAG,MAAM,MAAM,CAAC;wBACvC,MAAMA,cAAcH,UAAU,CAACxM,QAAQyM,IAAI,CAAC9L,KAAK,CAAC;wBAClD;oBACF,KAAK;wBACH,MAAM,EAAEiM,WAAW,EAAE,GAAG,MAAM,MAAM,CAAC;wBACrC,MAAMA,YAAYJ,UAAU,CAACxM,QAAQyM,IAAI,CAAC9L,KAAK,CAAC;wBAChD;oBACF,KAAK;wBACH,MAAM,EAAEkM,WAAW,EAAE,GAAG,MAAM,MAAM,CAAC;wBACrC,MAAMA,YAAYL,UAAU,CAACxM,QAAQyM,IAAI,CAAC9L,KAAK,CAAC;wBAChD;oBACF,KAAK;wBACH,MAAM,EAAEmM,YAAY,EAAE,GAAG,MAAM,MAAM,CAAC;wBACtC,MAAMA,aAAaN,UAAU,CAACxM,QAAQyM,IAAI,CAAC9L,KAAK,CAAC;wBACjD;oBACF,KAAK;wBACH,MAAM,EAAEoM,aAAa,EAAE,GAAG,MAAM,MAAM,CAAC;wBACvC,MAAMA,cAAcP,UAAU,CAACxM,QAAQyM,IAAI,CAAC9L,KAAK,CAAC;wBAClD;oBACF,KAAK;wBACH,MAAM,EAAEqM,SAAS,EAAE,GAAG,MAAM,MAAM,CAAC;wBACnC,MAAMA,UAAUR,UAAU,CAACxM,QAAQyM,IAAI,CAAC9L,KAAK,CAAC;wBAC9C;oBACF,KAAK;oBACL;wBACE,MAAM,EAAEsM,aAAa,EAAE,GAAG,MAAM,MAAM,CAAC;wBACvC,MAAMA,cAAcT,UAAU,CAACxM,QAAQyM,IAAI,CAAC9L,KAAK,CAAC;wBAClD;gBACJ;YACF,EAAE,OAAOlC,KAAK;gBACZpF,MAAM,CAAC,iBAAiB,EAAEF,gBAAgBsF,MAAM;YAClD;QACF;IACF;IAGAlD,IAAIC,OAAO,CAAC;QACVC,MAAM;QACNC,aAAa;QACbM,QAAQ,OAAOC;YACb,IAAI;gBACF,MAAM,EAAEqM,KAAK,EAAE,GAAG,MAAM,MAAM,CAAC;gBAG/B,MAAM5H,OAAOzE,IAAIyE,IAAI,CAAChD,MAAM,GAAG,IAAIzB,IAAIyE,IAAI,GAAG;oBAAC;iBAAS;gBAExD,MAAM6H,QAAQD,MAAM,OAAO;oBAAC;oBAAa;uBAAW5H;iBAAK,EAAE;oBACzDyI,OAAO;oBACP+D,OAAO;gBACT;gBAEA,MAAM,IAAIhN,QAAc,CAACC,SAASgN;oBAChC5E,MAAMtI,EAAE,CAAC,QAAQ,CAACvB;wBAChB,IAAIA,SAAS,GAAG;4BACdyB;wBACF,OAAO;4BAELA;wBACF;oBACF;oBAEAoI,MAAMtI,EAAE,CAAC,SAAS,CAACxB;wBACjBpF,MAAM,CAAC,gCAAgC,EAAEF,gBAAgBsF,MAAM;wBAC/D0B;oBACF;gBACF;YACF,EAAE,OAAO1B,KAAK;gBACZpF,MAAM,CAAC,oBAAoB,EAAEF,gBAAgBsF,MAAM;YACrD;QACF;IACF;IAGA,KAAK,MAAMjD,WAAWnB,mBAAoB;QACxCkB,IAAIC,OAAO,CAACA;IACd;AACF;AAEA,SAAS6H,uBAAuBvH,IAAY;IAC1C,MAAMsH,eAAyC;QAC7CgK,aAAa;YAAC;YAAmB;YAAY;SAAa;QAC1DC,YAAY;YAAC;YAAc;YAAyB;SAAW;QAC/DC,aAAa;YAAC;YAAmB;YAAqB;SAAU;QAChEC,SAAS;YAAC;YAAiB;YAAuB;SAAY;QAC9DC,QAAQ;YAAC;SAAe;IAC1B;IAEA,OAAOpK,YAAY,CAACtH,KAAK,IAAIsH,aAAaoK,MAAM;AAClD;AAEA,SAAShK,wBAAwB1H,IAAY;IAC3C,MAAM2R,UAAkC;QACtCL,aAAa;QACbC,YAAY;QACZC,aAAa;QACbC,SAAS;QACTC,QAAQ;IACV;IAEA,OAAOC,OAAO,CAAC3R,KAAK,IAAI2R,QAAQD,MAAM;AACxC;AAGA,SAAS3P;IACP,OAAO,CAAC;;;;;;;;;;;;;;AAcV,CAAC;AACD;AAGA,SAASC;IACP,OAAO,CAAC;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA8CV,CAAC;AACD;AAGA,SAASE;IACP,OAAO,CAAC;;;;;;;;;;AAUV,CAAC;AACD;AAGA,SAASC;IACP,OAAO,CAAC;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA0DV,CAAC;AACD;AAGA,SAASE;IACP,OAAO,CAAC;;;;;;;;;AASV,CAAC;AACD;AAGA,SAASC;IACP,OAAO,CAAC;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAwFV,CAAC;AACD;AAGA,SAASQ;IACP,OAAO,CAAC;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA8BV,EAAE,IAAIO,OAAOuO,WAAW,GAAG;AAC3B,CAAC;AACD;AAGA,SAAS5O;IACP,OAAO,CAAC;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA+BV,EAAE,IAAIK,OAAOuO,WAAW,GAAG;AAC3B,CAAC;AACD"}