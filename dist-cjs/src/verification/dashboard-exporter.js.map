{"version":3,"sources":["../../../src/verification/dashboard-exporter.ts"],"sourcesContent":["/**\r\n * Dashboard Exporter - Advanced data visualization and export system\r\n * \r\n * Provides comprehensive dashboard generation, real-time data export,\r\n * and visualization capabilities for truth telemetry metrics.\r\n */\r\n\r\nimport type { ILogger } from '../core/logger.js';\r\nimport type {\r\n  DashboardData,\r\n  DataPoint,\r\n  AgentPerformanceChart,\r\n  ErrorDistributionChart,\r\n  SystemLoadChart,\r\n  AgentRanking,\r\n  CriticalIssue,\r\n  SystemInsight,\r\n  TruthMetric,\r\n  AgentTruthScore,\r\n  SystemTruthMetrics,\r\n  TruthAlert,\r\n  TruthTelemetryConfig,\r\n} from './telemetry.js';\r\n\r\nexport interface DashboardConfiguration {\r\n  title: string;\r\n  description: string;\r\n  refreshInterval: number;\r\n  timeRange: {\r\n    default: string; // '1h', '24h', '7d', '30d'\r\n    options: string[];\r\n  };\r\n  panels: DashboardPanel[];\r\n  filters: DashboardFilter[];\r\n  layout: DashboardLayout;\r\n  styling: DashboardStyling;\r\n}\r\n\r\nexport interface DashboardPanel {\r\n  id: string;\r\n  title: string;\r\n  type: 'chart' | 'table' | 'stat' | 'gauge' | 'heatmap' | 'timeline' | 'alert';\r\n  chartType?: 'line' | 'bar' | 'pie' | 'scatter' | 'area' | 'histogram';\r\n  dataSource: string;\r\n  query: string;\r\n  position: { x: number; y: number; width: number; height: number };\r\n  config: PanelConfiguration;\r\n  drillDown?: DrillDownConfig;\r\n}\r\n\r\nexport interface PanelConfiguration {\r\n  yAxis?: {\r\n    min?: number;\r\n    max?: number;\r\n    label?: string;\r\n    scale?: 'linear' | 'logarithmic';\r\n  };\r\n  xAxis?: {\r\n    label?: string;\r\n    format?: string;\r\n  };\r\n  colors?: string[];\r\n  thresholds?: Array<{\r\n    value: number;\r\n    color: string;\r\n    condition: 'gt' | 'lt' | 'eq';\r\n  }>;\r\n  aggregation?: 'sum' | 'avg' | 'min' | 'max' | 'count' | 'p50' | 'p95' | 'p99';\r\n  groupBy?: string[];\r\n  orderBy?: { field: string; direction: 'asc' | 'desc' };\r\n  limit?: number;\r\n  format?: {\r\n    decimals?: number;\r\n    unit?: string;\r\n    prefix?: string;\r\n    suffix?: string;\r\n  };\r\n}\r\n\r\nexport interface DrillDownConfig {\r\n  enabled: boolean;\r\n  target: string; // dashboard ID or URL\r\n  parameters: Record<string, string>;\r\n}\r\n\r\nexport interface DashboardFilter {\r\n  id: string;\r\n  name: string;\r\n  type: 'dropdown' | 'text' | 'date' | 'range' | 'multiselect';\r\n  field: string;\r\n  options?: Array<{ label: string; value: string }>;\r\n  defaultValue?: any;\r\n  dependencies?: string[]; // Other filter IDs this depends on\r\n}\r\n\r\nexport interface DashboardLayout {\r\n  type: 'grid' | 'flow' | 'tabs';\r\n  gridSize: { columns: number; rows: number };\r\n  responsive: boolean;\r\n  breakpoints: Record<string, { columns: number; margin: number; padding: number }>;\r\n}\r\n\r\nexport interface DashboardStyling {\r\n  theme: 'light' | 'dark' | 'auto';\r\n  primaryColor: string;\r\n  secondaryColor: string;\r\n  backgroundColor: string;\r\n  textColor: string;\r\n  borderColor: string;\r\n  fontFamily: string;\r\n  fontSize: {\r\n    small: string;\r\n    medium: string;\r\n    large: string;\r\n  };\r\n}\r\n\r\nexport interface ExportFormat {\r\n  type: 'json' | 'csv' | 'excel' | 'pdf' | 'png' | 'svg' | 'prometheus';\r\n  options: {\r\n    compression?: 'none' | 'gzip' | 'brotli';\r\n    delimiter?: string; // for CSV\r\n    orientation?: 'portrait' | 'landscape'; // for PDF\r\n    quality?: number; // for images\r\n    width?: number;\r\n    height?: number;\r\n  };\r\n}\r\n\r\nexport interface ReportTemplate {\r\n  id: string;\r\n  name: string;\r\n  description: string;\r\n  type: 'executive' | 'technical' | 'operational' | 'compliance';\r\n  schedule?: {\r\n    frequency: 'hourly' | 'daily' | 'weekly' | 'monthly';\r\n    time?: string; // HH:MM\r\n    dayOfWeek?: number; // 0-6\r\n    dayOfMonth?: number; // 1-31\r\n  };\r\n  recipients: string[];\r\n  format: ExportFormat;\r\n  sections: ReportSection[];\r\n}\r\n\r\nexport interface ReportSection {\r\n  title: string;\r\n  type: 'summary' | 'chart' | 'table' | 'text' | 'alert_summary';\r\n  query?: string;\r\n  template?: string;\r\n  config?: Record<string, any>;\r\n}\r\n\r\nexport interface VisualizationData {\r\n  series: DataSeries[];\r\n  annotations: Annotation[];\r\n  metadata: VisualizationMetadata;\r\n}\r\n\r\nexport interface DataSeries {\r\n  name: string;\r\n  data: DataPoint[];\r\n  type: 'line' | 'bar' | 'area' | 'scatter';\r\n  color?: string;\r\n  yAxis?: 'left' | 'right';\r\n  visible: boolean;\r\n  style?: {\r\n    lineWidth?: number;\r\n    fillOpacity?: number;\r\n    markerSize?: number;\r\n  };\r\n}\r\n\r\nexport interface Annotation {\r\n  type: 'line' | 'band' | 'point' | 'text';\r\n  timestamp?: Date;\r\n  startTime?: Date;\r\n  endTime?: Date;\r\n  value?: number;\r\n  text?: string;\r\n  color?: string;\r\n  style?: 'solid' | 'dashed' | 'dotted';\r\n}\r\n\r\nexport interface VisualizationMetadata {\r\n  title: string;\r\n  subtitle?: string;\r\n  yAxisLabel?: string;\r\n  xAxisLabel?: string;\r\n  timeRange: { start: Date; end: Date };\r\n  dataPoints: number;\r\n  lastUpdated: Date;\r\n  aggregationLevel: string;\r\n}\r\n\r\nexport class DashboardExporter {\r\n  private config: TruthTelemetryConfig;\r\n  private logger: ILogger;\r\n  \r\n  // Dashboard management\r\n  private dashboards = new Map<string, DashboardConfiguration>();\r\n  private reportTemplates = new Map<string, ReportTemplate>();\r\n  private scheduledReports = new Map<string, NodeJS.Timeout>();\r\n  \r\n  // Data processing\r\n  private dataProcessors = new Map<string, DataProcessor>();\r\n  private visualizationCache = new Map<string, VisualizationData>();\r\n  \r\n  // Export state\r\n  private exportQueue: ExportJob[] = [];\r\n  private activeExports = new Set<string>();\r\n  \r\n  constructor(config: TruthTelemetryConfig, logger: ILogger) {\r\n    this.config = config;\r\n    this.logger = logger;\r\n    \r\n    this.initializeDataProcessors();\r\n    this.initializeDefaultDashboards();\r\n  }\r\n  \r\n  async initialize(): Promise<void> {\r\n    this.logger.info('Initializing Dashboard Exporter', {\r\n      dashboardEnabled: this.config.dashboardEnabled,\r\n      exportFormat: this.config.exportFormat,\r\n    });\r\n    \r\n    // Load dashboard configurations\r\n    await this.loadDashboardConfigurations();\r\n    \r\n    // Start scheduled reports\r\n    this.startScheduledReports();\r\n    \r\n    this.logger.info('Dashboard Exporter initialized successfully', {\r\n      dashboards: this.dashboards.size,\r\n      reportTemplates: this.reportTemplates.size,\r\n    });\r\n  }\r\n  \r\n  async shutdown(): Promise<void> {\r\n    this.logger.info('Shutting down Dashboard Exporter');\r\n    \r\n    // Stop scheduled reports\r\n    this.stopScheduledReports();\r\n    \r\n    // Wait for active exports to complete\r\n    await this.waitForActiveExports();\r\n    \r\n    // Save configurations\r\n    await this.saveDashboardConfigurations();\r\n    \r\n    this.logger.info('Dashboard Exporter shutdown complete');\r\n  }\r\n  \r\n  // ========================================================================================\r\n  // Dashboard Generation\r\n  // ========================================================================================\r\n  \r\n  async generateDashboard(data: {\r\n    systemMetrics: SystemTruthMetrics;\r\n    agentScores: AgentTruthScore[];\r\n    truthMetrics: TruthMetric[];\r\n    activeAlerts: TruthAlert[];\r\n  }): Promise<DashboardData> {\r\n    try {\r\n      // Generate summary statistics\r\n      const summary = await this.generateSummary(data);\r\n      \r\n      // Generate charts\r\n      const charts = await this.generateCharts(data);\r\n      \r\n      // Generate tables\r\n      const tables = await this.generateTables(data);\r\n      \r\n      // Generate insights\r\n      const insights = await this.generateInsights(data);\r\n      \r\n      const dashboardData: DashboardData = {\r\n        timestamp: new Date(),\r\n        summary,\r\n        charts,\r\n        tables,\r\n        insights,\r\n      };\r\n      \r\n      // Cache the result\r\n      this.cacheDashboardData(dashboardData);\r\n      \r\n      return dashboardData;\r\n      \r\n    } catch (error) {\r\n      this.logger.error('Error generating dashboard', error);\r\n      throw error;\r\n    }\r\n  }\r\n  \r\n  private async generateSummary(data: any): Promise<DashboardData['summary']> {\r\n    const { systemMetrics, agentScores, activeAlerts } = data;\r\n    \r\n    // Calculate overall system health\r\n    const healthScore = this.calculateOverallHealth(systemMetrics, agentScores);\r\n    \r\n    return {\r\n      overallHealth: healthScore,\r\n      truthAccuracy: systemMetrics.overallAccuracy,\r\n      humanInterventionRate: systemMetrics.humanInterventionRate,\r\n      systemEfficiency: systemMetrics.efficiency,\r\n      alertCount: activeAlerts.length,\r\n    };\r\n  }\r\n  \r\n  private async generateCharts(data: any): Promise<DashboardData['charts']> {\r\n    const { systemMetrics, agentScores, truthMetrics, activeAlerts } = data;\r\n    \r\n    return {\r\n      accuracyTrend: await this.generateAccuracyTrend(truthMetrics),\r\n      interventionTrend: await this.generateInterventionTrend(truthMetrics),\r\n      agentPerformance: await this.generateAgentPerformanceChart(agentScores),\r\n      errorDistribution: await this.generateErrorDistribution(truthMetrics),\r\n      systemLoad: await this.generateSystemLoadChart(systemMetrics),\r\n    };\r\n  }\r\n  \r\n  private async generateTables(data: any): Promise<DashboardData['tables']> {\r\n    const { agentScores, activeAlerts } = data;\r\n    \r\n    return {\r\n      topPerformers: await this.generateTopPerformers(agentScores),\r\n      recentAlerts: activeAlerts.slice(-10).map(this.formatAlertForTable),\r\n      criticalIssues: await this.generateCriticalIssues(data),\r\n    };\r\n  }\r\n  \r\n  private async generateInsights(data: any): Promise<SystemInsight[]> {\r\n    const insights: SystemInsight[] = [];\r\n    \r\n    // Performance insights\r\n    const performanceInsight = await this.analyzePerformanceInsights(data);\r\n    if (performanceInsight) insights.push(performanceInsight);\r\n    \r\n    // Efficiency insights\r\n    const efficiencyInsight = await this.analyzeEfficiencyInsights(data);\r\n    if (efficiencyInsight) insights.push(efficiencyInsight);\r\n    \r\n    // Quality insights\r\n    const qualityInsight = await this.analyzeQualityInsights(data);\r\n    if (qualityInsight) insights.push(qualityInsight);\r\n    \r\n    // Risk insights\r\n    const riskInsight = await this.analyzeRiskInsights(data);\r\n    if (riskInsight) insights.push(riskInsight);\r\n    \r\n    return insights;\r\n  }\r\n  \r\n  // ========================================================================================\r\n  // Chart Generation\r\n  // ========================================================================================\r\n  \r\n  private async generateAccuracyTrend(truthMetrics: TruthMetric[]): Promise<DataPoint[]> {\r\n    const accuracyMetrics = truthMetrics\r\n      .filter(m => m.metricType === 'accuracy')\r\n      .sort((a, b) => a.timestamp.getTime() - b.timestamp.getTime());\r\n    \r\n    // Group by time intervals (hourly)\r\n    const hourlyData = new Map<number, number[]>();\r\n    \r\n    accuracyMetrics.forEach(metric => {\r\n      const hour = Math.floor(metric.timestamp.getTime() / (60 * 60 * 1000)) * (60 * 60 * 1000);\r\n      if (!hourlyData.has(hour)) {\r\n        hourlyData.set(hour, []);\r\n      }\r\n      hourlyData.get(hour)!.push(metric.value);\r\n    });\r\n    \r\n    // Calculate hourly averages\r\n    const dataPoints: DataPoint[] = [];\r\n    for (const [hour, values] of hourlyData) {\r\n      const average = values.reduce((sum, val) => sum + val, 0) / values.length;\r\n      dataPoints.push({\r\n        timestamp: new Date(hour),\r\n        value: average,\r\n        label: `${values.length} samples`,\r\n      });\r\n    }\r\n    \r\n    return dataPoints.slice(-24); // Last 24 hours\r\n  }\r\n  \r\n  private async generateInterventionTrend(truthMetrics: TruthMetric[]): Promise<DataPoint[]> {\r\n    const hourlyData = new Map<number, { total: number; interventions: number }>();\r\n    \r\n    truthMetrics.forEach(metric => {\r\n      const hour = Math.floor(metric.timestamp.getTime() / (60 * 60 * 1000)) * (60 * 60 * 1000);\r\n      if (!hourlyData.has(hour)) {\r\n        hourlyData.set(hour, { total: 0, interventions: 0 });\r\n      }\r\n      \r\n      const data = hourlyData.get(hour)!;\r\n      data.total++;\r\n      \r\n      if (metric.context.verificationMethod === 'human' || metric.context.verificationMethod === 'hybrid') {\r\n        data.interventions++;\r\n      }\r\n    });\r\n    \r\n    const dataPoints: DataPoint[] = [];\r\n    for (const [hour, data] of hourlyData) {\r\n      const rate = data.total > 0 ? data.interventions / data.total : 0;\r\n      dataPoints.push({\r\n        timestamp: new Date(hour),\r\n        value: rate,\r\n        label: `${data.interventions}/${data.total}`,\r\n      });\r\n    }\r\n    \r\n    return dataPoints.slice(-24);\r\n  }\r\n  \r\n  private async generateAgentPerformanceChart(agentScores: AgentTruthScore[]): Promise<AgentPerformanceChart[]> {\r\n    return agentScores\r\n      .sort((a, b) => b.overallScore - a.overallScore)\r\n      .slice(0, 20) // Top 20 agents\r\n      .map(score => {\r\n        const recentWindow = score.recentPerformance.find(w => w.period === 'recent');\r\n        const trend = this.calculateTrend(score.trends);\r\n        \r\n        return {\r\n          agentId: score.agentId,\r\n          score: score.overallScore,\r\n          trend,\r\n          tasks: recentWindow?.metrics.totalTasks || 0,\r\n          accuracy: score.components.accuracy,\r\n        };\r\n      });\r\n  }\r\n  \r\n  private async generateErrorDistribution(truthMetrics: TruthMetric[]): Promise<ErrorDistributionChart[]> {\r\n    const errorCounts = new Map<string, number>();\r\n    const severityCounts = new Map<string, number>();\r\n    \r\n    let totalErrors = 0;\r\n    \r\n    truthMetrics.forEach(metric => {\r\n      metric.validation.errors.forEach(error => {\r\n        totalErrors++;\r\n        \r\n        // Count by error type\r\n        errorCounts.set(error.type, (errorCounts.get(error.type) || 0) + 1);\r\n        \r\n        // Count by severity\r\n        severityCounts.set(error.severity, (severityCounts.get(error.severity) || 0) + 1);\r\n      });\r\n    });\r\n    \r\n    const distribution: ErrorDistributionChart[] = [];\r\n    \r\n    // Add error types\r\n    for (const [errorType, count] of errorCounts) {\r\n      distribution.push({\r\n        category: errorType,\r\n        count,\r\n        percentage: totalErrors > 0 ? (count / totalErrors) * 100 : 0,\r\n        severity: 'mixed',\r\n      });\r\n    }\r\n    \r\n    return distribution.sort((a, b) => b.count - a.count).slice(0, 10);\r\n  }\r\n  \r\n  private async generateSystemLoadChart(systemMetrics: SystemTruthMetrics): Promise<SystemLoadChart[]> {\r\n    // Generate synthetic load data (would typically come from time-series DB)\r\n    const dataPoints: SystemLoadChart[] = [];\r\n    const now = Date.now();\r\n    const hourMs = 60 * 60 * 1000;\r\n    \r\n    for (let i = 23; i >= 0; i--) {\r\n      const timestamp = new Date(now - (i * hourMs));\r\n      \r\n      // Simulate load variation\r\n      const baseLoad = systemMetrics.totalTasks / 24; // Average per hour\r\n      const variation = (Math.random() - 0.5) * 0.3; // Â±30% variation\r\n      const load = Math.max(0, baseLoad * (1 + variation));\r\n      \r\n      const capacity = systemMetrics.agentCount * 10; // 10 tasks per agent per hour\r\n      const utilization = capacity > 0 ? Math.min(1, load / capacity) : 0;\r\n      \r\n      dataPoints.push({\r\n        timestamp,\r\n        load,\r\n        capacity,\r\n        utilization,\r\n      });\r\n    }\r\n    \r\n    return dataPoints;\r\n  }\r\n  \r\n  // ========================================================================================\r\n  // Table Generation\r\n  // ========================================================================================\r\n  \r\n  private async generateTopPerformers(agentScores: AgentTruthScore[]): Promise<AgentRanking[]> {\r\n    return agentScores\r\n      .sort((a, b) => b.overallScore - a.overallScore)\r\n      .slice(0, 10)\r\n      .map((score, index) => {\r\n        const recentWindow = score.recentPerformance.find(w => w.period === 'recent');\r\n        \r\n        return {\r\n          rank: index + 1,\r\n          agentId: score.agentId,\r\n          score: score.overallScore,\r\n          tasks: recentWindow?.metrics.totalTasks || 0,\r\n          accuracy: score.components.accuracy,\r\n          efficiency: score.components.efficiency,\r\n        };\r\n      });\r\n  }\r\n  \r\n  private formatAlertForTable = (alert: TruthAlert): any => ({\r\n    id: alert.id,\r\n    timestamp: alert.timestamp,\r\n    severity: alert.severity,\r\n    type: alert.type,\r\n    message: alert.message.substring(0, 100) + (alert.message.length > 100 ? '...' : ''),\r\n    source: alert.source,\r\n    resolved: alert.resolved,\r\n  });\r\n  \r\n  private async generateCriticalIssues(data: any): Promise<CriticalIssue[]> {\r\n    const { systemMetrics, agentScores, activeAlerts } = data;\r\n    const issues: CriticalIssue[] = [];\r\n    \r\n    // System-wide issues\r\n    if (systemMetrics.overallAccuracy < 0.9) {\r\n      issues.push({\r\n        id: 'system-accuracy-low',\r\n        severity: 'critical',\r\n        description: `System accuracy (${(systemMetrics.overallAccuracy * 100).toFixed(1)}%) below target`,\r\n        affectedAgents: ['system-wide'],\r\n        impact: 'High risk of incorrect outputs across all agents',\r\n        eta: new Date(Date.now() + 24 * 60 * 60 * 1000), // 24 hours\r\n      });\r\n    }\r\n    \r\n    // Agent-specific issues\r\n    const problematicAgents = agentScores.filter(score => \r\n      score.riskAssessment.level === 'critical' || score.riskAssessment.level === 'high'\r\n    );\r\n    \r\n    if (problematicAgents.length > 0) {\r\n      issues.push({\r\n        id: 'agents-at-risk',\r\n        severity: problematicAgents.some(a => a.riskAssessment.level === 'critical') ? 'critical' : 'high',\r\n        description: `${problematicAgents.length} agents at risk`,\r\n        affectedAgents: problematicAgents.map(a => a.agentId),\r\n        impact: 'Reduced system reliability and increased intervention needs',\r\n        eta: new Date(Date.now() + 12 * 60 * 60 * 1000), // 12 hours\r\n      });\r\n    }\r\n    \r\n    // Alert-based issues\r\n    const criticalAlerts = activeAlerts.filter(a => a.severity === 'critical' || a.severity === 'emergency');\r\n    if (criticalAlerts.length > 5) {\r\n      issues.push({\r\n        id: 'high-alert-volume',\r\n        severity: 'high',\r\n        description: `${criticalAlerts.length} critical alerts active`,\r\n        affectedAgents: [...new Set(criticalAlerts.map(a => a.source))],\r\n        impact: 'System may be overwhelmed, requiring immediate attention',\r\n        eta: new Date(Date.now() + 2 * 60 * 60 * 1000), // 2 hours\r\n      });\r\n    }\r\n    \r\n    return issues.slice(0, 5); // Top 5 issues\r\n  }\r\n  \r\n  // ========================================================================================\r\n  // Insight Generation\r\n  // ========================================================================================\r\n  \r\n  private async analyzePerformanceInsights(data: any): Promise<SystemInsight | null> {\r\n    const { systemMetrics, agentScores } = data;\r\n    \r\n    const avgScore = agentScores.length > 0 ? \r\n      agentScores.reduce((sum, s) => sum + s.overallScore, 0) / agentScores.length : 0;\r\n    \r\n    if (avgScore < 0.8) {\r\n      return {\r\n        type: 'performance',\r\n        title: 'Performance Below Target',\r\n        description: `Average agent performance (${(avgScore * 100).toFixed(1)}%) is below the 80% target. Consider reviewing agent training or task distribution.`,\r\n        impact: 'high',\r\n        actionable: true,\r\n        recommendations: [\r\n          'Review agent training data quality',\r\n          'Analyze common failure patterns',\r\n          'Consider load balancing adjustments',\r\n          'Implement performance coaching for underperforming agents',\r\n        ],\r\n      };\r\n    }\r\n    \r\n    if (systemMetrics.throughput < 50) { // Assuming 50 tasks/hour target\r\n      return {\r\n        type: 'performance',\r\n        title: 'Low System Throughput',\r\n        description: `Current throughput (${systemMetrics.throughput.toFixed(1)} tasks/hour) is below expected levels.`,\r\n        impact: 'medium',\r\n        actionable: true,\r\n        recommendations: [\r\n          'Scale up agent capacity',\r\n          'Optimize task routing algorithms',\r\n          'Reduce task complexity where possible',\r\n        ],\r\n      };\r\n    }\r\n    \r\n    return null;\r\n  }\r\n  \r\n  private async analyzeEfficiencyInsights(data: any): Promise<SystemInsight | null> {\r\n    const { systemMetrics } = data;\r\n    \r\n    if (systemMetrics.humanInterventionRate > 0.15) {\r\n      return {\r\n        type: 'efficiency',\r\n        title: 'High Human Intervention Rate',\r\n        description: `Human intervention rate (${(systemMetrics.humanInterventionRate * 100).toFixed(1)}%) exceeds the 10% target, indicating automation gaps.`,\r\n        impact: 'medium',\r\n        actionable: true,\r\n        recommendations: [\r\n          'Identify common intervention patterns',\r\n          'Improve agent decision-making capabilities',\r\n          'Implement better confidence scoring',\r\n          'Add more automated validation rules',\r\n        ],\r\n      };\r\n    }\r\n    \r\n    if (systemMetrics.efficiency < 0.8) {\r\n      return {\r\n        type: 'efficiency',\r\n        title: 'System Efficiency Below Target',\r\n        description: `Current system efficiency (${(systemMetrics.efficiency * 100).toFixed(1)}%) is below the 80% target.`,\r\n        impact: 'medium',\r\n        actionable: true,\r\n        recommendations: [\r\n          'Optimize resource allocation',\r\n          'Reduce task processing overhead',\r\n          'Implement caching strategies',\r\n        ],\r\n      };\r\n    }\r\n    \r\n    return null;\r\n  }\r\n  \r\n  private async analyzeQualityInsights(data: any): Promise<SystemInsight | null> {\r\n    const { systemMetrics, truthMetrics } = data;\r\n    \r\n    if (systemMetrics.overallAccuracy < 0.95) {\r\n      const recentErrors = truthMetrics\r\n        .filter(m => m.timestamp > new Date(Date.now() - 24 * 60 * 60 * 1000))\r\n        .flatMap(m => m.validation.errors);\r\n      \r\n      const commonErrors = this.getTopErrorTypes(recentErrors);\r\n      \r\n      return {\r\n        type: 'quality',\r\n        title: 'Accuracy Below Target',\r\n        description: `System accuracy (${(systemMetrics.overallAccuracy * 100).toFixed(1)}%) is below the 95% target. Most common error: ${commonErrors[0]?.type || 'unknown'}.`,\r\n        impact: 'high',\r\n        actionable: true,\r\n        recommendations: [\r\n          `Focus on resolving ${commonErrors[0]?.type || 'common'} errors`,\r\n          'Implement additional validation checks',\r\n          'Review training data for bias or gaps',\r\n          'Consider ensemble approaches for critical tasks',\r\n        ],\r\n      };\r\n    }\r\n    \r\n    return null;\r\n  }\r\n  \r\n  private async analyzeRiskInsights(data: any): Promise<SystemInsight | null> {\r\n    const { agentScores } = data;\r\n    \r\n    const highRiskAgents = agentScores.filter(s => \r\n      s.riskAssessment.level === 'high' || s.riskAssessment.level === 'critical'\r\n    );\r\n    \r\n    if (highRiskAgents.length > agentScores.length * 0.2) { // More than 20% at risk\r\n      return {\r\n        type: 'risk',\r\n        title: 'High Risk Agent Population',\r\n        description: `${highRiskAgents.length} agents (${((highRiskAgents.length / agentScores.length) * 100).toFixed(1)}%) are classified as high risk.`,\r\n        impact: 'high',\r\n        actionable: true,\r\n        recommendations: [\r\n          'Implement immediate monitoring for at-risk agents',\r\n          'Consider redistributing tasks away from high-risk agents',\r\n          'Investigate common risk factors',\r\n          'Implement risk mitigation strategies',\r\n        ],\r\n      };\r\n    }\r\n    \r\n    return null;\r\n  }\r\n  \r\n  // ========================================================================================\r\n  // Export System\r\n  // ========================================================================================\r\n  \r\n  async exportDashboard(\r\n    dashboardId: string,\r\n    format: ExportFormat,\r\n    options?: {\r\n      timeRange?: { start: Date; end: Date };\r\n      filters?: Record<string, any>;\r\n    }\r\n  ): Promise<string> {\r\n    const exportId = `export-${Date.now()}-${Math.random().toString(36).slice(2)}`;\r\n    \r\n    const exportJob: ExportJob = {\r\n      id: exportId,\r\n      type: 'dashboard',\r\n      target: dashboardId,\r\n      format,\r\n      options: options || {},\r\n      status: 'pending',\r\n      createdAt: new Date(),\r\n      progress: 0,\r\n    };\r\n    \r\n    this.exportQueue.push(exportJob);\r\n    this.processExportQueue();\r\n    \r\n    return exportId;\r\n  }\r\n  \r\n  async generateReport(templateId: string, options?: Record<string, any>): Promise<string> {\r\n    const template = this.reportTemplates.get(templateId);\r\n    if (!template) {\r\n      throw new Error(`Report template not found: ${templateId}`);\r\n    }\r\n    \r\n    const exportId = `report-${Date.now()}-${Math.random().toString(36).slice(2)}`;\r\n    \r\n    const exportJob: ExportJob = {\r\n      id: exportId,\r\n      type: 'report',\r\n      target: templateId,\r\n      format: template.format,\r\n      options: options || {},\r\n      status: 'pending',\r\n      createdAt: new Date(),\r\n      progress: 0,\r\n    };\r\n    \r\n    this.exportQueue.push(exportJob);\r\n    this.processExportQueue();\r\n    \r\n    return exportId;\r\n  }\r\n  \r\n  private async processExportQueue(): Promise<void> {\r\n    if (this.exportQueue.length === 0 || this.activeExports.size >= 3) {\r\n      return; // No jobs or max concurrent exports reached\r\n    }\r\n    \r\n    const job = this.exportQueue.shift();\r\n    if (!job) return;\r\n    \r\n    this.activeExports.add(job.id);\r\n    job.status = 'processing';\r\n    \r\n    try {\r\n      const result = await this.executeExportJob(job);\r\n      job.status = 'completed';\r\n      job.result = result;\r\n      job.completedAt = new Date();\r\n      \r\n      this.logger.info('Export job completed', {\r\n        jobId: job.id,\r\n        type: job.type,\r\n        format: job.format.type,\r\n        duration: job.completedAt.getTime() - job.createdAt.getTime(),\r\n      });\r\n      \r\n    } catch (error) {\r\n      job.status = 'failed';\r\n      job.error = error instanceof Error ? error.message : String(error);\r\n      \r\n      this.logger.error('Export job failed', {\r\n        jobId: job.id,\r\n        error: job.error,\r\n      });\r\n    } finally {\r\n      this.activeExports.delete(job.id);\r\n      job.progress = 100;\r\n      \r\n      // Process next job\r\n      setTimeout(() => this.processExportQueue(), 100);\r\n    }\r\n  }\r\n  \r\n  private async executeExportJob(job: ExportJob): Promise<ExportResult> {\r\n    switch (job.type) {\r\n      case 'dashboard':\r\n        return await this.exportDashboardData(job);\r\n      case 'report':\r\n        return await this.generateReportData(job);\r\n      default:\r\n        throw new Error(`Unknown export type: ${job.type}`);\r\n    }\r\n  }\r\n  \r\n  private async exportDashboardData(job: ExportJob): Promise<ExportResult> {\r\n    // Implementation would generate actual export data\r\n    // For now, returning a placeholder\r\n    \r\n    job.progress = 50;\r\n    \r\n    const data = {\r\n      dashboardId: job.target,\r\n      exportedAt: new Date(),\r\n      format: job.format.type,\r\n      data: {}, // Would contain actual dashboard data\r\n    };\r\n    \r\n    job.progress = 100;\r\n    \r\n    return {\r\n      format: job.format.type,\r\n      size: JSON.stringify(data).length,\r\n      path: `/exports/${job.id}.${job.format.type}`,\r\n      data: job.format.type === 'json' ? data : `Exported data (${job.format.type})`,\r\n    };\r\n  }\r\n  \r\n  private async generateReportData(job: ExportJob): Promise<ExportResult> {\r\n    const template = this.reportTemplates.get(job.target);\r\n    if (!template) {\r\n      throw new Error(`Report template not found: ${job.target}`);\r\n    }\r\n    \r\n    job.progress = 25;\r\n    \r\n    // Generate report sections\r\n    const sections = await Promise.all(\r\n      template.sections.map(section => this.generateReportSection(section))\r\n    );\r\n    \r\n    job.progress = 75;\r\n    \r\n    const reportData = {\r\n      template: template.name,\r\n      type: template.type,\r\n      generatedAt: new Date(),\r\n      sections,\r\n    };\r\n    \r\n    job.progress = 100;\r\n    \r\n    return {\r\n      format: template.format.type,\r\n      size: JSON.stringify(reportData).length,\r\n      path: `/reports/${job.id}.${template.format.type}`,\r\n      data: reportData,\r\n    };\r\n  }\r\n  \r\n  private async generateReportSection(section: ReportSection): Promise<any> {\r\n    switch (section.type) {\r\n      case 'summary':\r\n        return { type: 'summary', title: section.title, data: {} };\r\n      case 'chart':\r\n        return { type: 'chart', title: section.title, data: [] };\r\n      case 'table':\r\n        return { type: 'table', title: section.title, data: [] };\r\n      case 'text':\r\n        return { type: 'text', title: section.title, content: section.template || '' };\r\n      case 'alert_summary':\r\n        return { type: 'alert_summary', title: section.title, data: [] };\r\n      default:\r\n        return { type: 'unknown', title: section.title, data: null };\r\n    }\r\n  }\r\n  \r\n  // ========================================================================================\r\n  // Utility Methods\r\n  // ========================================================================================\r\n  \r\n  private calculateOverallHealth(systemMetrics: SystemTruthMetrics, agentScores: AgentTruthScore[]): number {\r\n    const systemHealth = (\r\n      systemMetrics.overallAccuracy * 0.4 +\r\n      systemMetrics.systemReliability * 0.3 +\r\n      systemMetrics.efficiency * 0.2 +\r\n      (1 - systemMetrics.humanInterventionRate) * 0.1\r\n    );\r\n    \r\n    const agentHealth = agentScores.length > 0 ?\r\n      agentScores.reduce((sum, score) => sum + score.overallScore, 0) / agentScores.length : 0.8;\r\n    \r\n    return (systemHealth * 0.6) + (agentHealth * 0.4);\r\n  }\r\n  \r\n  private calculateTrend(trends: any[]): 'up' | 'down' | 'stable' {\r\n    const improvingTrends = trends.filter(t => t.direction === 'improving').length;\r\n    const decliningTrends = trends.filter(t => t.direction === 'declining').length;\r\n    \r\n    if (improvingTrends > decliningTrends) return 'up';\r\n    if (decliningTrends > improvingTrends) return 'down';\r\n    return 'stable';\r\n  }\r\n  \r\n  private getTopErrorTypes(errors: any[]): Array<{ type: string; count: number }> {\r\n    const errorCounts = new Map<string, number>();\r\n    \r\n    errors.forEach(error => {\r\n      errorCounts.set(error.type, (errorCounts.get(error.type) || 0) + 1);\r\n    });\r\n    \r\n    return Array.from(errorCounts.entries())\r\n      .map(([type, count]) => ({ type, count }))\r\n      .sort((a, b) => b.count - a.count);\r\n  }\r\n  \r\n  private cacheDashboardData(data: DashboardData): void {\r\n    // Implement caching logic\r\n    const cacheKey = `dashboard-${data.timestamp.toISOString()}`;\r\n    // Would typically use Redis or similar for caching\r\n  }\r\n  \r\n  private initializeDataProcessors(): void {\r\n    // Initialize data processing functions\r\n    this.dataProcessors.set('accuracy', new AccuracyProcessor());\r\n    this.dataProcessors.set('efficiency', new EfficiencyProcessor());\r\n    this.dataProcessors.set('alerts', new AlertProcessor());\r\n  }\r\n  \r\n  private initializeDefaultDashboards(): void {\r\n    // Create default dashboard configurations\r\n    const defaultDashboard: DashboardConfiguration = {\r\n      title: 'Truth Telemetry Overview',\r\n      description: 'Comprehensive view of system truth metrics and agent performance',\r\n      refreshInterval: 30000,\r\n      timeRange: {\r\n        default: '24h',\r\n        options: ['1h', '6h', '24h', '7d', '30d'],\r\n      },\r\n      panels: [\r\n        {\r\n          id: 'accuracy-trend',\r\n          title: 'Accuracy Trend',\r\n          type: 'chart',\r\n          chartType: 'line',\r\n          dataSource: 'truthMetrics',\r\n          query: 'SELECT timestamp, AVG(value) FROM truth_metrics WHERE metric_type = \"accuracy\" GROUP BY hour',\r\n          position: { x: 0, y: 0, width: 6, height: 4 },\r\n          config: {\r\n            yAxis: { min: 0, max: 1, label: 'Accuracy' },\r\n            colors: ['#2196F3'],\r\n            thresholds: [\r\n              { value: 0.95, color: '#4CAF50', condition: 'gt' },\r\n              { value: 0.9, color: '#FF9800', condition: 'gt' },\r\n            ],\r\n          },\r\n        },\r\n        {\r\n          id: 'system-health',\r\n          title: 'System Health',\r\n          type: 'stat',\r\n          dataSource: 'systemMetrics',\r\n          query: 'SELECT overall_health FROM system_metrics ORDER BY timestamp DESC LIMIT 1',\r\n          position: { x: 6, y: 0, width: 3, height: 2 },\r\n          config: {\r\n            format: { decimals: 1, suffix: '%' },\r\n            thresholds: [\r\n              { value: 95, color: '#4CAF50', condition: 'gt' },\r\n              { value: 80, color: '#FF9800', condition: 'gt' },\r\n            ],\r\n          },\r\n        },\r\n      ],\r\n      filters: [\r\n        {\r\n          id: 'timeRange',\r\n          name: 'Time Range',\r\n          type: 'dropdown',\r\n          field: 'timestamp',\r\n          options: [\r\n            { label: 'Last Hour', value: '1h' },\r\n            { label: 'Last 24 Hours', value: '24h' },\r\n            { label: 'Last Week', value: '7d' },\r\n          ],\r\n          defaultValue: '24h',\r\n        },\r\n      ],\r\n      layout: {\r\n        type: 'grid',\r\n        gridSize: { columns: 12, rows: 8 },\r\n        responsive: true,\r\n        breakpoints: {\r\n          lg: { columns: 12, margin: 16, padding: 16 },\r\n          md: { columns: 8, margin: 12, padding: 12 },\r\n          sm: { columns: 4, margin: 8, padding: 8 },\r\n        },\r\n      },\r\n      styling: {\r\n        theme: 'light',\r\n        primaryColor: '#2196F3',\r\n        secondaryColor: '#FFC107',\r\n        backgroundColor: '#FFFFFF',\r\n        textColor: '#333333',\r\n        borderColor: '#E0E0E0',\r\n        fontFamily: 'Inter, sans-serif',\r\n        fontSize: {\r\n          small: '12px',\r\n          medium: '14px',\r\n          large: '16px',\r\n        },\r\n      },\r\n    };\r\n    \r\n    this.dashboards.set('default', defaultDashboard);\r\n  }\r\n  \r\n  private async loadDashboardConfigurations(): Promise<void> {\r\n    // Placeholder for loading configurations from storage\r\n    this.logger.debug('Loading dashboard configurations');\r\n  }\r\n  \r\n  private async saveDashboardConfigurations(): Promise<void> {\r\n    // Placeholder for saving configurations to storage\r\n    this.logger.debug('Saving dashboard configurations');\r\n  }\r\n  \r\n  private startScheduledReports(): void {\r\n    for (const [templateId, template] of this.reportTemplates) {\r\n      if (template.schedule) {\r\n        const interval = this.calculateScheduleInterval(template.schedule);\r\n        if (interval > 0) {\r\n          const timeout = setInterval(() => {\r\n            this.generateReport(templateId);\r\n          }, interval);\r\n          \r\n          this.scheduledReports.set(templateId, timeout);\r\n        }\r\n      }\r\n    }\r\n  }\r\n  \r\n  private stopScheduledReports(): void {\r\n    for (const timeout of this.scheduledReports.values()) {\r\n      clearInterval(timeout);\r\n    }\r\n    this.scheduledReports.clear();\r\n  }\r\n  \r\n  private calculateScheduleInterval(schedule: ReportTemplate['schedule']): number {\r\n    if (!schedule) return 0;\r\n    \r\n    switch (schedule.frequency) {\r\n      case 'hourly': return 60 * 60 * 1000;\r\n      case 'daily': return 24 * 60 * 60 * 1000;\r\n      case 'weekly': return 7 * 24 * 60 * 60 * 1000;\r\n      case 'monthly': return 30 * 24 * 60 * 60 * 1000;\r\n      default: return 0;\r\n    }\r\n  }\r\n  \r\n  private async waitForActiveExports(): Promise<void> {\r\n    while (this.activeExports.size > 0) {\r\n      await new Promise(resolve => setTimeout(resolve, 1000));\r\n    }\r\n  }\r\n  \r\n  // ========================================================================================\r\n  // Public API\r\n  // ========================================================================================\r\n  \r\n  getDashboardConfiguration(dashboardId: string): DashboardConfiguration | undefined {\r\n    return this.dashboards.get(dashboardId);\r\n  }\r\n  \r\n  getAllDashboards(): DashboardConfiguration[] {\r\n    return Array.from(this.dashboards.values());\r\n  }\r\n  \r\n  createDashboard(config: Omit<DashboardConfiguration, 'id'>): string {\r\n    const dashboardId = `dashboard-${Date.now()}`;\r\n    this.dashboards.set(dashboardId, { ...config } as DashboardConfiguration);\r\n    return dashboardId;\r\n  }\r\n  \r\n  updateDashboard(dashboardId: string, updates: Partial<DashboardConfiguration>): boolean {\r\n    const dashboard = this.dashboards.get(dashboardId);\r\n    if (!dashboard) return false;\r\n    \r\n    this.dashboards.set(dashboardId, { ...dashboard, ...updates });\r\n    return true;\r\n  }\r\n  \r\n  deleteDashboard(dashboardId: string): boolean {\r\n    return this.dashboards.delete(dashboardId);\r\n  }\r\n  \r\n  getExportStatus(exportId: string): ExportJob | null {\r\n    return this.exportQueue.find(job => job.id === exportId) || null;\r\n  }\r\n  \r\n  cancelExport(exportId: string): boolean {\r\n    const jobIndex = this.exportQueue.findIndex(job => job.id === exportId);\r\n    if (jobIndex >= 0) {\r\n      this.exportQueue.splice(jobIndex, 1);\r\n      return true;\r\n    }\r\n    return false;\r\n  }\r\n}\r\n\r\n// ========================================================================================\r\n// Supporting Classes and Interfaces\r\n// ========================================================================================\r\n\r\ninterface ExportJob {\r\n  id: string;\r\n  type: 'dashboard' | 'report';\r\n  target: string;\r\n  format: ExportFormat;\r\n  options: Record<string, any>;\r\n  status: 'pending' | 'processing' | 'completed' | 'failed';\r\n  progress: number;\r\n  createdAt: Date;\r\n  completedAt?: Date;\r\n  result?: ExportResult;\r\n  error?: string;\r\n}\r\n\r\ninterface ExportResult {\r\n  format: string;\r\n  size: number;\r\n  path: string;\r\n  data: any;\r\n}\r\n\r\nabstract class DataProcessor {\r\n  abstract process(data: any, options?: any): Promise<any>;\r\n}\r\n\r\nclass AccuracyProcessor extends DataProcessor {\r\n  async process(data: TruthMetric[], options?: any): Promise<any> {\r\n    // Process accuracy-specific data\r\n    return data.filter(m => m.metricType === 'accuracy');\r\n  }\r\n}\r\n\r\nclass EfficiencyProcessor extends DataProcessor {\r\n  async process(data: TruthMetric[], options?: any): Promise<any> {\r\n    // Process efficiency-specific data\r\n    return data.filter(m => m.metricType === 'efficiency');\r\n  }\r\n}\r\n\r\nclass AlertProcessor extends DataProcessor {\r\n  async process(data: TruthAlert[], options?: any): Promise<any> {\r\n    // Process alert-specific data\r\n    return data.filter(a => !a.resolved);\r\n  }\r\n}"],"names":["DashboardExporter","config","logger","dashboards","Map","reportTemplates","scheduledReports","dataProcessors","visualizationCache","exportQueue","activeExports","Set","initializeDataProcessors","initializeDefaultDashboards","initialize","info","dashboardEnabled","exportFormat","loadDashboardConfigurations","startScheduledReports","size","shutdown","stopScheduledReports","waitForActiveExports","saveDashboardConfigurations","generateDashboard","data","summary","generateSummary","charts","generateCharts","tables","generateTables","insights","generateInsights","dashboardData","timestamp","Date","cacheDashboardData","error","systemMetrics","agentScores","activeAlerts","healthScore","calculateOverallHealth","overallHealth","truthAccuracy","overallAccuracy","humanInterventionRate","systemEfficiency","efficiency","alertCount","length","truthMetrics","accuracyTrend","generateAccuracyTrend","interventionTrend","generateInterventionTrend","agentPerformance","generateAgentPerformanceChart","errorDistribution","generateErrorDistribution","systemLoad","generateSystemLoadChart","topPerformers","generateTopPerformers","recentAlerts","slice","map","formatAlertForTable","criticalIssues","generateCriticalIssues","performanceInsight","analyzePerformanceInsights","push","efficiencyInsight","analyzeEfficiencyInsights","qualityInsight","analyzeQualityInsights","riskInsight","analyzeRiskInsights","accuracyMetrics","filter","m","metricType","sort","a","b","getTime","hourlyData","forEach","metric","hour","Math","floor","has","set","get","value","dataPoints","values","average","reduce","sum","val","label","total","interventions","context","verificationMethod","rate","overallScore","score","recentWindow","recentPerformance","find","w","period","trend","calculateTrend","trends","agentId","tasks","metrics","totalTasks","accuracy","components","errorCounts","severityCounts","totalErrors","validation","errors","type","severity","distribution","errorType","count","category","percentage","now","hourMs","i","baseLoad","variation","random","load","max","capacity","agentCount","utilization","min","index","rank","alert","id","message","substring","source","resolved","issues","description","toFixed","affectedAgents","impact","eta","problematicAgents","riskAssessment","level","some","criticalAlerts","avgScore","s","title","actionable","recommendations","throughput","recentErrors","flatMap","commonErrors","getTopErrorTypes","highRiskAgents","exportDashboard","dashboardId","format","options","exportId","toString","exportJob","target","status","createdAt","progress","processExportQueue","generateReport","templateId","template","Error","job","shift","add","result","executeExportJob","completedAt","jobId","duration","String","delete","setTimeout","exportDashboardData","generateReportData","exportedAt","JSON","stringify","path","sections","Promise","all","section","generateReportSection","reportData","name","generatedAt","content","systemHealth","systemReliability","agentHealth","improvingTrends","t","direction","decliningTrends","Array","from","entries","cacheKey","toISOString","AccuracyProcessor","EfficiencyProcessor","AlertProcessor","defaultDashboard","refreshInterval","timeRange","default","panels","chartType","dataSource","query","position","x","y","width","height","yAxis","colors","thresholds","color","condition","decimals","suffix","filters","field","defaultValue","layout","gridSize","columns","rows","responsive","breakpoints","lg","margin","padding","md","sm","styling","theme","primaryColor","secondaryColor","backgroundColor","textColor","borderColor","fontFamily","fontSize","small","medium","large","debug","schedule","interval","calculateScheduleInterval","timeout","setInterval","clearInterval","clear","frequency","resolve","getDashboardConfiguration","getAllDashboards","createDashboard","updateDashboard","updates","dashboard","deleteDashboard","getExportStatus","cancelExport","jobIndex","findIndex","splice","DataProcessor","process"],"mappings":"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"}