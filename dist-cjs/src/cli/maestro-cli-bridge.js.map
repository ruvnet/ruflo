{"version":3,"sources":["../../../src/cli/maestro-cli-bridge.ts"],"sourcesContent":["/**\r\n * Maestro CLI Bridge - Optimization Implementation\r\n * \r\n * This bridge provides optimized CLI integration for the Maestro specifications-driven\r\n * development framework, implementing performance enhancements and intelligent features\r\n * while maintaining compatibility with existing infrastructure.\r\n * \r\n * Key optimizations:\r\n * - Parallel dependency initialization with caching\r\n * - Performance monitoring integration\r\n * - Configuration validation and management\r\n * - Intelligent error handling and recovery\r\n */\r\n\r\nimport { join } from 'path';\r\nimport chalk from 'chalk';\r\nimport { EventEmitter } from 'events';\r\n\r\n// Core infrastructure\r\nimport { Config } from '../utils/types.js';\r\nimport { SystemError } from '../utils/errors.js';\r\nimport { IEventBus } from '../core/event-bus.js';\r\nimport { ILogger } from '../core/logger.js';\r\nimport { IMemoryManager } from '../memory/manager.js';\r\nimport { AgentManager } from '../agents/agent-manager.js';\r\nimport { Orchestrator } from '../core/orchestrator.js';\r\n\r\n// Maestro system\r\nimport { MaestroSwarmCoordinator, MaestroSwarmConfig } from '../maestro/maestro-swarm-coordinator.js';\r\n\r\n// Performance monitoring\r\nimport { agenticHookManager } from '../services/agentic-flow-hooks/index.js';\r\n\r\nexport interface MaestroCLIBridgeConfig {\r\n  enablePerformanceMonitoring: boolean;\r\n  initializationTimeout: number;\r\n  cacheEnabled: boolean;\r\n  logLevel: 'debug' | 'info' | 'warn' | 'error';\r\n}\r\n\r\nexport interface PerformanceMetrics {\r\n  operation: string;\r\n  duration: number;\r\n  success: boolean;\r\n  timestamp: number;\r\n  memoryUsage?: number;\r\n  error?: string;\r\n}\r\n\r\n/**\r\n * CLI Bridge for optimized Maestro integration\r\n */\r\nexport class MaestroCLIBridge {\r\n  private swarmCoordinator?: MaestroSwarmCoordinator;\r\n  private initializationCache: Map<string, any> = new Map();\r\n  private configCache?: Config;\r\n  private performanceMetrics: PerformanceMetrics[] = [];\r\n  private initialized: boolean = false;\r\n\r\n  constructor(\r\n    private bridgeConfig: Partial<MaestroCLIBridgeConfig> = {}\r\n  ) {\r\n    // Set default configuration\r\n    this.bridgeConfig = {\r\n      enablePerformanceMonitoring: true,\r\n      initializationTimeout: 30000, // 30 seconds\r\n      cacheEnabled: true,\r\n      logLevel: 'info',\r\n      ...this.bridgeConfig\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Initialize orchestrator with parallel dependency loading and caching\r\n   */\r\n  async initializeOrchestrator(): Promise<MaestroSwarmCoordinator> {\r\n    const startTime = Date.now();\r\n\r\n    try {\r\n      if (this.swarmCoordinator && this.initialized) {\r\n        console.log(chalk.green('‚úÖ Using cached Maestro swarm coordinator'));\r\n        return this.swarmCoordinator;\r\n      }\r\n\r\n      console.log(chalk.blue('üöÄ Initializing Maestro orchestrator...'));\r\n\r\n      // Parallel initialization with caching\r\n      const [config, eventBus, logger, memoryManager, agentManager, mainOrchestrator] = \r\n        await Promise.all([\r\n          this.getOrCreateConfig(),\r\n          this.getOrCreateEventBus(),\r\n          this.getOrCreateLogger(),\r\n          this.getOrCreateMemoryManager(),\r\n          this.getOrCreateAgentManager(),\r\n          this.getOrCreateMainOrchestrator()\r\n        ]);\r\n\r\n      // Create optimized Maestro configuration\r\n      const maestroConfig = this.getOptimizedMaestroConfig();\r\n\r\n      // Initialize native swarm coordinator\r\n      this.swarmCoordinator = new MaestroSwarmCoordinator(\r\n        maestroConfig,\r\n        eventBus,\r\n        logger\r\n      );\r\n\r\n      // Initialize native hive mind swarm with performance monitoring\r\n      await this.executeWithMonitoring('swarm_init', async () => {\r\n        const swarmId = await this.swarmCoordinator!.initialize();\r\n        console.log(chalk.green(`‚úÖ Native hive mind swarm initialized: ${swarmId}`));\r\n      });\r\n\r\n      this.initialized = true;\r\n      const duration = Date.now() - startTime;\r\n      \r\n      console.log(chalk.green(`‚úÖ Maestro orchestrator ready (${duration}ms)`));\r\n      \r\n      // Report performance metrics\r\n      await this.reportPerformanceMetric('orchestrator_init', duration, true);\r\n\r\n      return this.swarmCoordinator;\r\n\r\n    } catch (error) {\r\n      const duration = Date.now() - startTime;\r\n      await this.reportPerformanceMetric('orchestrator_init', duration, false, error instanceof Error ? error.message : String(error));\r\n      \r\n      console.error(chalk.red(`‚ùå Failed to initialize Maestro orchestrator: ${error instanceof Error ? error.message : String(error)}`));\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Execute operation with performance monitoring\r\n   */\r\n  async executeWithMonitoring<T>(\r\n    operation: string,\r\n    fn: () => Promise<T>,\r\n    context?: Record<string, any>\r\n  ): Promise<T> {\r\n    if (!this.bridgeConfig.enablePerformanceMonitoring) {\r\n      return await fn();\r\n    }\r\n\r\n    const startTime = Date.now();\r\n    const startMemory = process.memoryUsage().heapUsed;\r\n\r\n    try {\r\n      // Execute pre-operation hooks\r\n      await this.executePerformanceHook('performance-metric', {\r\n        metric: `${operation}_start`,\r\n        value: startTime,\r\n        unit: 'timestamp',\r\n        context: { operation, ...context }\r\n      });\r\n\r\n      const result = await fn();\r\n      \r\n      const endTime = Date.now();\r\n      const endMemory = process.memoryUsage().heapUsed;\r\n      const duration = endTime - startTime;\r\n      const memoryDelta = endMemory - startMemory;\r\n\r\n      // Record metrics\r\n      await this.reportPerformanceMetric(operation, duration, true, undefined, memoryDelta);\r\n\r\n      // Execute post-operation hooks\r\n      await this.executePerformanceHook('performance-metric', {\r\n        metric: `${operation}_complete`,\r\n        value: duration,\r\n        unit: 'milliseconds',\r\n        context: { \r\n          operation, \r\n          success: true, \r\n          memoryDelta: memoryDelta / 1024 / 1024, // MB\r\n          ...context \r\n        }\r\n      });\r\n\r\n      return result;\r\n\r\n    } catch (error) {\r\n      const duration = Date.now() - startTime;\r\n      const memoryDelta = process.memoryUsage().heapUsed - startMemory;\r\n\r\n      await this.reportPerformanceMetric(operation, duration, false, error instanceof Error ? error.message : String(error), memoryDelta);\r\n\r\n      // Execute error hooks\r\n      await this.executePerformanceHook('performance-metric', {\r\n        metric: `${operation}_error`,\r\n        value: duration,\r\n        unit: 'milliseconds',\r\n        context: { \r\n          operation, \r\n          success: false, \r\n          error: error instanceof Error ? error.message : String(error),\r\n          memoryDelta: memoryDelta / 1024 / 1024, // MB\r\n          ...context \r\n        }\r\n      });\r\n\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get optimized Maestro configuration\r\n   */\r\n  private getOptimizedMaestroConfig(): MaestroSwarmConfig {\r\n    return {\r\n      hiveMindConfig: {\r\n        name: 'maestro-specs-driven-swarm',\r\n        topology: 'specs-driven',\r\n        queenMode: 'strategic',\r\n        maxAgents: 8,\r\n        consensusThreshold: 0.66,\r\n        memoryTTL: 86400000,\r\n        autoSpawn: true,\r\n        enableConsensus: true,\r\n        enableMemory: true,\r\n        enableCommunication: true\r\n      },\r\n      enableConsensusValidation: true,\r\n      enableLivingDocumentation: true,\r\n      enableSteeringIntegration: true,\r\n      specsDirectory: join(process.cwd(), 'docs', 'maestro', 'specs'),\r\n      steeringDirectory: join(process.cwd(), 'docs', 'maestro', 'steering')\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Cached configuration management\r\n   */\r\n  private async getOrCreateConfig(): Promise<Config> {\r\n    const cacheKey = 'config';\r\n    \r\n    if (this.bridgeConfig.cacheEnabled && this.initializationCache.has(cacheKey)) {\r\n      return this.initializationCache.get(cacheKey);\r\n    }\r\n\r\n    // Create basic configuration - in a real implementation, this would load from file\r\n    const config: Config = {\r\n      env: (process.env.NODE_ENV as 'development' | 'production' | 'test') || 'development',\r\n      logLevel: this.bridgeConfig.logLevel || 'info',\r\n      enableMetrics: this.bridgeConfig.enablePerformanceMonitoring || true\r\n    };\r\n\r\n    if (this.bridgeConfig.cacheEnabled) {\r\n      this.initializationCache.set(cacheKey, config);\r\n    }\r\n\r\n    return config;\r\n  }\r\n\r\n  /**\r\n   * Cached event bus creation\r\n   */\r\n  private async getOrCreateEventBus(): Promise<IEventBus> {\r\n    const cacheKey = 'eventBus';\r\n    \r\n    if (this.bridgeConfig.cacheEnabled && this.initializationCache.has(cacheKey)) {\r\n      return this.initializationCache.get(cacheKey);\r\n    }\r\n\r\n    // Create simple event bus implementation\r\n    const eventBus: IEventBus = new EventEmitter() as any;\r\n\r\n    if (this.bridgeConfig.cacheEnabled) {\r\n      this.initializationCache.set(cacheKey, eventBus);\r\n    }\r\n\r\n    return eventBus;\r\n  }\r\n\r\n  /**\r\n   * Cached logger creation\r\n   */\r\n  private async getOrCreateLogger(): Promise<ILogger> {\r\n    const cacheKey = 'logger';\r\n    \r\n    if (this.bridgeConfig.cacheEnabled && this.initializationCache.has(cacheKey)) {\r\n      return this.initializationCache.get(cacheKey);\r\n    }\r\n\r\n    // Create simple logger implementation\r\n    const logger: ILogger = {\r\n      debug: (message: string, ...args: any[]) => {\r\n        if (this.bridgeConfig.logLevel === 'debug') {\r\n          console.log(chalk.gray(`[DEBUG] ${message}`), ...args);\r\n        }\r\n      },\r\n      info: (message: string, ...args: any[]) => {\r\n        console.log(chalk.blue(`[INFO] ${message}`), ...args);\r\n      },\r\n      warn: (message: string, ...args: any[]) => {\r\n        console.log(chalk.yellow(`[WARN] ${message}`), ...args);\r\n      },\r\n      error: (message: string, ...args: any[]) => {\r\n        console.log(chalk.red(`[ERROR] ${message}`), ...args);\r\n      },\r\n      configure: async (config: any) => { /* no-op */ },\r\n      level: this.bridgeConfig.logLevel\r\n    };\r\n\r\n    if (this.bridgeConfig.cacheEnabled) {\r\n      this.initializationCache.set(cacheKey, logger);\r\n    }\r\n\r\n    return logger;\r\n  }\r\n\r\n  /**\r\n   * Cached memory manager creation\r\n   */\r\n  private async getOrCreateMemoryManager(): Promise<IMemoryManager> {\r\n    const cacheKey = 'memoryManager';\r\n    \r\n    if (this.bridgeConfig.cacheEnabled && this.initializationCache.has(cacheKey)) {\r\n      return this.initializationCache.get(cacheKey);\r\n    }\r\n\r\n    // Create simple memory manager implementation\r\n    const memoryManager: IMemoryManager = {\r\n      initialize: async () => {},\r\n      shutdown: async () => {},\r\n      createBank: async (agentId: string) => `bank-${agentId}`,\r\n      closeBank: async (bankId: string) => {},\r\n      store: async (entry: any) => {},\r\n      retrieve: async (id: string) => undefined,\r\n      query: async (query: any) => [],\r\n      update: async (id: string, updates: any) => {},\r\n      delete: async (id: string) => {},\r\n      getHealthStatus: async () => ({ healthy: true }),\r\n      performMaintenance: async () => {}\r\n    };\r\n\r\n    if (this.bridgeConfig.cacheEnabled) {\r\n      this.initializationCache.set(cacheKey, memoryManager);\r\n    }\r\n\r\n    return memoryManager;\r\n  }\r\n\r\n  /**\r\n   * Cached agent manager creation\r\n   */\r\n  private async getOrCreateAgentManager(): Promise<AgentManager> {\r\n    const cacheKey = 'agentManager';\r\n    \r\n    if (this.bridgeConfig.cacheEnabled && this.initializationCache.has(cacheKey)) {\r\n      return this.initializationCache.get(cacheKey);\r\n    }\r\n\r\n    // Create agent manager - this would integrate with existing system\r\n    const config = await this.getOrCreateConfig();\r\n    const eventBus = await this.getOrCreateEventBus();\r\n    const logger = await this.getOrCreateLogger();\r\n    const memoryManager = await this.getOrCreateMemoryManager();\r\n    \r\n    const agentManager = new AgentManager(\r\n      { maxAgents: 10 }, // AgentManagerConfig\r\n      logger,\r\n      eventBus,\r\n      memoryManager as any // Cast to DistributedMemorySystem\r\n    );\r\n\r\n    if (this.bridgeConfig.cacheEnabled) {\r\n      this.initializationCache.set(cacheKey, agentManager);\r\n    }\r\n\r\n    return agentManager;\r\n  }\r\n\r\n  /**\r\n   * Cached main orchestrator creation\r\n   */\r\n  private async getOrCreateMainOrchestrator(): Promise<Orchestrator> {\r\n    const cacheKey = 'mainOrchestrator';\r\n    \r\n    if (this.bridgeConfig.cacheEnabled && this.initializationCache.has(cacheKey)) {\r\n      return this.initializationCache.get(cacheKey);\r\n    }\r\n\r\n    // Create main orchestrator with required parameters\r\n    const config = await this.getOrCreateConfig();\r\n    const eventBus = await this.getOrCreateEventBus();\r\n    const logger = await this.getOrCreateLogger();\r\n    const memoryManager = await this.getOrCreateMemoryManager();\r\n    \r\n    // Create mock dependencies for orchestrator\r\n    const mockTerminalManager = {} as any;\r\n    const mockCoordinationManager = {} as any;\r\n    const mockMCPServer = {} as any;\r\n    \r\n    const orchestrator = new Orchestrator(\r\n      config,\r\n      mockTerminalManager,\r\n      memoryManager,\r\n      mockCoordinationManager,\r\n      mockMCPServer,\r\n      eventBus,\r\n      logger\r\n    );\r\n\r\n    if (this.bridgeConfig.cacheEnabled) {\r\n      this.initializationCache.set(cacheKey, orchestrator);\r\n    }\r\n\r\n    return orchestrator;\r\n  }\r\n\r\n  /**\r\n   * Execute performance hooks\r\n   */\r\n  private async executePerformanceHook(type: string, data: any): Promise<void> {\r\n    try {\r\n      await agenticHookManager.executeHooks(type as any, data, {\r\n        sessionId: `maestro-cli-${Date.now()}`,\r\n        timestamp: Date.now(),\r\n        correlationId: `maestro-performance`,\r\n        metadata: { source: 'maestro-cli-bridge' },\r\n        memory: { namespace: 'maestro', provider: 'memory', cache: new Map() },\r\n        neural: { modelId: 'default', patterns: null as any, training: null as any },\r\n        performance: { metrics: new Map(), bottlenecks: [], optimizations: [] }\r\n      } as any);\r\n    } catch (error) {\r\n      // Don't let hook failures break the main operation\r\n      console.warn(chalk.yellow(`‚ö†Ô∏è  Performance hook failed: ${error instanceof Error ? error.message : String(error)}`));\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Report performance metrics\r\n   */\r\n  private async reportPerformanceMetric(\r\n    operation: string,\r\n    duration: number,\r\n    success: boolean,\r\n    error?: string,\r\n    memoryUsage?: number\r\n  ): Promise<void> {\r\n    const metric: PerformanceMetrics = {\r\n      operation,\r\n      duration,\r\n      success,\r\n      timestamp: Date.now(),\r\n      memoryUsage,\r\n      error\r\n    };\r\n\r\n    this.performanceMetrics.push(metric);\r\n\r\n    // Keep only last 100 metrics\r\n    if (this.performanceMetrics.length > 100) {\r\n      this.performanceMetrics.shift();\r\n    }\r\n\r\n    // Log performance information\r\n    if (this.bridgeConfig.logLevel === 'debug') {\r\n      const memoryInfo = memoryUsage ? ` (${(memoryUsage / 1024 / 1024).toFixed(2)}MB)` : '';\r\n      console.log(\r\n        chalk.gray(\r\n          `[PERF] ${operation}: ${duration}ms ${success ? '‚úì' : '‚úó'}${memoryInfo}`\r\n        )\r\n      );\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get performance summary\r\n   */\r\n  getPerformanceSummary(): any {\r\n    const successful = this.performanceMetrics.filter(m => m.success);\r\n    const failed = this.performanceMetrics.filter(m => !m.success);\r\n    \r\n    const avgDuration = successful.length > 0 \r\n      ? successful.reduce((sum, m) => sum + m.duration, 0) / successful.length\r\n      : 0;\r\n\r\n    return {\r\n      totalOperations: this.performanceMetrics.length,\r\n      successfulOperations: successful.length,\r\n      failedOperations: failed.length,\r\n      successRate: this.performanceMetrics.length > 0 \r\n        ? (successful.length / this.performanceMetrics.length) * 100\r\n        : 0,\r\n      averageDuration: Math.round(avgDuration),\r\n      recentMetrics: this.performanceMetrics.slice(-10)\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Validate configuration and environment\r\n   */\r\n  async validateConfiguration(): Promise<{ valid: boolean; issues: string[] }> {\r\n    const issues: string[] = [];\r\n\r\n    try {\r\n      // Check Node.js version\r\n      const nodeVersion = process.versions.node;\r\n      const majorVersion = parseInt(nodeVersion.split('.')[0]);\r\n      if (majorVersion < 16) {\r\n        issues.push(`Node.js version ${nodeVersion} is not supported. Minimum required: 16.0.0`);\r\n      }\r\n\r\n      // Check available memory\r\n      const memoryUsage = process.memoryUsage();\r\n      const availableMemory = memoryUsage.heapTotal;\r\n      if (availableMemory < 100 * 1024 * 1024) { // 100MB\r\n        issues.push('Low available memory detected. Maestro requires at least 100MB heap space');\r\n      }\r\n\r\n      // Check file system permissions\r\n      const specsDir = join(process.cwd(), 'docs', 'maestro', 'specs');\r\n      try {\r\n        const fs = await import('fs/promises');\r\n        await fs.access(specsDir, fs.constants.F_OK);\r\n      } catch {\r\n        // Directory doesn't exist, which is fine - it will be created\r\n      }\r\n\r\n      return {\r\n        valid: issues.length === 0,\r\n        issues\r\n      };\r\n\r\n    } catch (error) {\r\n      issues.push(`Configuration validation failed: ${error instanceof Error ? error.message : String(error)}`);\r\n      return { valid: false, issues };\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Clear caches and reset state\r\n   */\r\n  clearCache(): void {\r\n    this.initializationCache.clear();\r\n    this.configCache = undefined;\r\n    this.initialized = false;\r\n    console.log(chalk.gray('üßπ Maestro CLI bridge cache cleared'));\r\n  }\r\n\r\n  /**\r\n   * Shutdown and cleanup resources\r\n   */\r\n  async shutdown(): Promise<void> {\r\n    if (this.swarmCoordinator) {\r\n      await this.swarmCoordinator.shutdown();\r\n    }\r\n    \r\n    this.clearCache();\r\n    this.performanceMetrics = [];\r\n    \r\n    console.log(chalk.green('‚úÖ Maestro CLI bridge shutdown complete'));\r\n  }\r\n}"],"names":["join","chalk","EventEmitter","AgentManager","Orchestrator","MaestroSwarmCoordinator","agenticHookManager","MaestroCLIBridge","swarmCoordinator","initializationCache","Map","configCache","performanceMetrics","initialized","bridgeConfig","enablePerformanceMonitoring","initializationTimeout","cacheEnabled","logLevel","initializeOrchestrator","startTime","Date","now","console","log","green","blue","config","eventBus","logger","memoryManager","agentManager","mainOrchestrator","Promise","all","getOrCreateConfig","getOrCreateEventBus","getOrCreateLogger","getOrCreateMemoryManager","getOrCreateAgentManager","getOrCreateMainOrchestrator","maestroConfig","getOptimizedMaestroConfig","executeWithMonitoring","swarmId","initialize","duration","reportPerformanceMetric","error","Error","message","String","red","operation","fn","context","startMemory","process","memoryUsage","heapUsed","executePerformanceHook","metric","value","unit","result","endTime","endMemory","memoryDelta","undefined","success","hiveMindConfig","name","topology","queenMode","maxAgents","consensusThreshold","memoryTTL","autoSpawn","enableConsensus","enableMemory","enableCommunication","enableConsensusValidation","enableLivingDocumentation","enableSteeringIntegration","specsDirectory","cwd","steeringDirectory","cacheKey","has","get","env","NODE_ENV","enableMetrics","set","debug","args","gray","info","warn","yellow","configure","level","shutdown","createBank","agentId","closeBank","bankId","store","entry","retrieve","id","query","update","updates","delete","getHealthStatus","healthy","performMaintenance","mockTerminalManager","mockCoordinationManager","mockMCPServer","orchestrator","type","data","executeHooks","sessionId","timestamp","correlationId","metadata","source","memory","namespace","provider","cache","neural","modelId","patterns","training","performance","metrics","bottlenecks","optimizations","push","length","shift","memoryInfo","toFixed","getPerformanceSummary","successful","filter","m","failed","avgDuration","reduce","sum","totalOperations","successfulOperations","failedOperations","successRate","averageDuration","Math","round","recentMetrics","slice","validateConfiguration","issues","nodeVersion","versions","node","majorVersion","parseInt","split","availableMemory","heapTotal","specsDir","fs","access","constants","F_OK","valid","clearCache","clear"],"mappings":"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"}