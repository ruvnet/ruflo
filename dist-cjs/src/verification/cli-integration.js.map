{"version":3,"sources":["../../../src/verification/cli-integration.ts"],"sourcesContent":["/**\r\n * Verification CLI Integration\r\n * \r\n * Provides command-line interface integration for the verification system.\r\n * Ensures compatibility with claude-flow CLI and provides verification commands.\r\n */\r\n\r\nimport { Logger } from '../core/logger.js';\r\nimport { verificationHookManager } from './hooks.js';\r\nimport type { VerificationConfig } from './hooks.js';\r\n\r\nconst logger = new Logger({\r\n  level: 'info',\r\n  format: 'text',\r\n  destination: 'console'\r\n}, { prefix: 'VerificationCLI' });\r\n\r\n// ===== CLI Command Types =====\r\n\r\nexport interface VerificationCommand {\r\n  name: string;\r\n  description: string;\r\n  execute: (args: any) => Promise<any>;\r\n  options?: CommandOption[];\r\n}\r\n\r\nexport interface CommandOption {\r\n  name: string;\r\n  alias?: string;\r\n  description: string;\r\n  type: 'string' | 'number' | 'boolean';\r\n  required?: boolean;\r\n  default?: any;\r\n}\r\n\r\n// ===== CLI Commands =====\r\n\r\nexport class VerificationCLICommands {\r\n  /**\r\n   * Status command - shows verification system status\r\n   */\r\n  static status(): VerificationCommand {\r\n    return {\r\n      name: 'verification:status',\r\n      description: 'Show verification system status and metrics',\r\n      async execute(args: any) {\r\n        try {\r\n          const metrics = verificationHookManager.getMetrics();\r\n          const status = {\r\n            system: 'Verification System',\r\n            status: 'Active',\r\n            metrics,\r\n            timestamp: new Date().toISOString()\r\n          };\r\n\r\n          if (args.json) {\r\n            console.log(JSON.stringify(status, null, 2));\r\n          } else {\r\n            console.log('üìä Verification System Status');\r\n            console.log('================================');\r\n            console.log(`Status: ${status.status}`);\r\n            console.log(`Total Checks: ${metrics.totalChecks || 0}`);\r\n            console.log(`Passed Checks: ${metrics.totalPassed || 0}`);\r\n            console.log(`Failed Checks: ${metrics.totalFailed || 0}`);\r\n            console.log(`Average Accuracy: ${(metrics.averageAccuracy * 100 || 0).toFixed(1)}%`);\r\n            console.log(`Average Confidence: ${(metrics.averageConfidence * 100 || 0).toFixed(1)}%`);\r\n            console.log(`Timestamp: ${status.timestamp}`);\r\n          }\r\n\r\n          return status;\r\n        } catch (error) {\r\n          logger.error('Failed to get verification status:', error);\r\n          throw error;\r\n        }\r\n      },\r\n      options: [\r\n        {\r\n          name: 'json',\r\n          description: 'Output in JSON format',\r\n          type: 'boolean',\r\n          default: false\r\n        }\r\n      ]\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Check command - run verification checks\r\n   */\r\n  static check(): VerificationCommand {\r\n    return {\r\n      name: 'verification:check',\r\n      description: 'Run verification checks for a specific task or context',\r\n      async execute(args: any) {\r\n        try {\r\n          const { taskId, type = 'all' } = args;\r\n          \r\n          if (!taskId) {\r\n            throw new Error('Task ID is required for verification checks');\r\n          }\r\n\r\n          const context = verificationHookManager.getVerificationStatus(taskId);\r\n          if (!context) {\r\n            throw new Error(`No verification context found for task: ${taskId}`);\r\n          }\r\n\r\n          const result = {\r\n            taskId,\r\n            phase: context.state.phase,\r\n            checksExecuted: type,\r\n            results: {\r\n              passed: context.state.checksPassed,\r\n              failed: context.state.checksFailed,\r\n              validations: context.state.validationResults,\r\n              tests: context.state.testResults,\r\n              truth: context.state.truthResults\r\n            },\r\n            metrics: context.metrics,\r\n            timestamp: new Date().toISOString()\r\n          };\r\n\r\n          if (args.json) {\r\n            console.log(JSON.stringify(result, null, 2));\r\n          } else {\r\n            console.log(`üîç Verification Check Results for Task: ${taskId}`);\r\n            console.log('================================================');\r\n            console.log(`Phase: ${context.state.phase}`);\r\n            console.log(`Checks Passed: ${context.state.checksPassed.length}`);\r\n            console.log(`Checks Failed: ${context.state.checksFailed.length}`);\r\n            console.log(`Validations: ${context.state.validationResults.length}`);\r\n            console.log(`Integration Tests: ${context.state.testResults.length}`);\r\n            console.log(`Truth Validations: ${context.state.truthResults.length}`);\r\n            console.log(`Accuracy Score: ${(context.metrics.accuracyScore * 100).toFixed(1)}%`);\r\n            console.log(`Confidence Score: ${(context.metrics.confidenceScore * 100).toFixed(1)}%`);\r\n          }\r\n\r\n          return result;\r\n        } catch (error) {\r\n          logger.error('Failed to run verification check:', error);\r\n          throw error;\r\n        }\r\n      },\r\n      options: [\r\n        {\r\n          name: 'taskId',\r\n          alias: 't',\r\n          description: 'Task ID to check',\r\n          type: 'string',\r\n          required: true\r\n        },\r\n        {\r\n          name: 'type',\r\n          description: 'Type of checks to run (all, pre-task, post-task, integration, truth)',\r\n          type: 'string',\r\n          default: 'all'\r\n        },\r\n        {\r\n          name: 'json',\r\n          description: 'Output in JSON format',\r\n          type: 'boolean',\r\n          default: false\r\n        }\r\n      ]\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Config command - manage verification configuration\r\n   */\r\n  static config(): VerificationCommand {\r\n    return {\r\n      name: 'verification:config',\r\n      description: 'View or update verification configuration',\r\n      async execute(args: any) {\r\n        try {\r\n          const { action = 'show', key, value } = args;\r\n\r\n          switch (action) {\r\n            case 'show':\r\n              const currentConfig = (verificationHookManager as any).config;\r\n              if (args.json) {\r\n                console.log(JSON.stringify(currentConfig, null, 2));\r\n              } else {\r\n                console.log('‚öôÔ∏è  Verification Configuration');\r\n                console.log('==============================');\r\n                console.log(`Pre-task enabled: ${currentConfig.preTask.enabled}`);\r\n                console.log(`Post-task enabled: ${currentConfig.postTask.enabled}`);\r\n                console.log(`Integration enabled: ${currentConfig.integration.enabled}`);\r\n                console.log(`Telemetry enabled: ${currentConfig.telemetry.enabled}`);\r\n                console.log(`Rollback enabled: ${currentConfig.rollback.enabled}`);\r\n                console.log(`Accuracy threshold: ${currentConfig.postTask.accuracyThreshold}`);\r\n                console.log(`Telemetry interval: ${currentConfig.telemetry.reportingInterval}ms`);\r\n              }\r\n              return currentConfig;\r\n\r\n            case 'set':\r\n              if (!key || value === undefined) {\r\n                throw new Error('Key and value are required for config set');\r\n              }\r\n              \r\n              const configUpdate: any = {};\r\n              const keyPath = key.split('.');\r\n              let current = configUpdate;\r\n              \r\n              for (let i = 0; i < keyPath.length - 1; i++) {\r\n                current[keyPath[i]] = {};\r\n                current = current[keyPath[i]];\r\n              }\r\n              \r\n              current[keyPath[keyPath.length - 1]] = value;\r\n              \r\n              verificationHookManager.updateConfig(configUpdate);\r\n              console.log(`‚úÖ Configuration updated: ${key} = ${value}`);\r\n              \r\n              return { key, value, updated: true };\r\n\r\n            default:\r\n              throw new Error(`Unknown config action: ${action}`);\r\n          }\r\n        } catch (error) {\r\n          logger.error('Failed to manage verification config:', error);\r\n          throw error;\r\n        }\r\n      },\r\n      options: [\r\n        {\r\n          name: 'action',\r\n          alias: 'a',\r\n          description: 'Action to perform (show, set)',\r\n          type: 'string',\r\n          default: 'show'\r\n        },\r\n        {\r\n          name: 'key',\r\n          alias: 'k',\r\n          description: 'Configuration key (for set action)',\r\n          type: 'string'\r\n        },\r\n        {\r\n          name: 'value',\r\n          alias: 'v',\r\n          description: 'Configuration value (for set action)',\r\n          type: 'string'\r\n        },\r\n        {\r\n          name: 'json',\r\n          description: 'Output in JSON format',\r\n          type: 'boolean',\r\n          default: false\r\n        }\r\n      ]\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Validate command - run post-task validation\r\n   */\r\n  static validate(): VerificationCommand {\r\n    return {\r\n      name: 'verification:validate',\r\n      description: 'Run post-task validation for a completed task',\r\n      async execute(args: any) {\r\n        try {\r\n          const { taskId, force = false } = args;\r\n          \r\n          if (!taskId) {\r\n            throw new Error('Task ID is required for validation');\r\n          }\r\n\r\n          const context = verificationHookManager.getVerificationStatus(taskId);\r\n          if (!context) {\r\n            throw new Error(`No verification context found for task: ${taskId}`);\r\n          }\r\n\r\n          if (context.state.phase !== 'complete' && !force) {\r\n            throw new Error(`Task is not complete (phase: ${context.state.phase}). Use --force to validate anyway.`);\r\n          }\r\n\r\n          // Trigger validation manually\r\n          const validationResults = context.state.validationResults;\r\n          const accuracy = validationResults.length > 0\r\n            ? validationResults.reduce((sum, r) => sum + r.accuracy, 0) / validationResults.length\r\n            : 0;\r\n\r\n          const result = {\r\n            taskId,\r\n            validationComplete: true,\r\n            accuracy,\r\n            validationResults,\r\n            meetsThreshold: accuracy >= 0.8,\r\n            timestamp: new Date().toISOString()\r\n          };\r\n\r\n          if (args.json) {\r\n            console.log(JSON.stringify(result, null, 2));\r\n          } else {\r\n            console.log(`‚úÖ Validation Results for Task: ${taskId}`);\r\n            console.log('========================================');\r\n            console.log(`Accuracy: ${(accuracy * 100).toFixed(1)}%`);\r\n            console.log(`Meets Threshold: ${result.meetsThreshold ? 'Yes' : 'No'}`);\r\n            console.log(`Validations Run: ${validationResults.length}`);\r\n            \r\n            if (validationResults.length > 0) {\r\n              console.log('\\nValidation Details:');\r\n              validationResults.forEach((validation, index) => {\r\n                console.log(`  ${index + 1}. ${validation.message} (${(validation.accuracy * 100).toFixed(1)}%)`);\r\n              });\r\n            }\r\n          }\r\n\r\n          return result;\r\n        } catch (error) {\r\n          logger.error('Failed to run validation:', error);\r\n          throw error;\r\n        }\r\n      },\r\n      options: [\r\n        {\r\n          name: 'taskId',\r\n          alias: 't',\r\n          description: 'Task ID to validate',\r\n          type: 'string',\r\n          required: true\r\n        },\r\n        {\r\n          name: 'force',\r\n          alias: 'f',\r\n          description: 'Force validation even if task is not complete',\r\n          type: 'boolean',\r\n          default: false\r\n        },\r\n        {\r\n          name: 'json',\r\n          description: 'Output in JSON format',\r\n          type: 'boolean',\r\n          default: false\r\n        }\r\n      ]\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Cleanup command - cleanup old verification data\r\n   */\r\n  static cleanup(): VerificationCommand {\r\n    return {\r\n      name: 'verification:cleanup',\r\n      description: 'Cleanup old verification contexts and snapshots',\r\n      async execute(args: any) {\r\n        try {\r\n          const { maxAge = 24 * 60 * 60 * 1000, force = false } = args; // Default 24 hours\r\n          \r\n          if (!force) {\r\n            console.log(`‚ö†Ô∏è  This will cleanup verification data older than ${maxAge}ms`);\r\n            console.log('Use --force to proceed');\r\n            return { cleaned: false, reason: 'Force flag required' };\r\n          }\r\n\r\n          const beforeMetrics = verificationHookManager.getMetrics();\r\n          verificationHookManager.cleanup(maxAge);\r\n          const afterMetrics = verificationHookManager.getMetrics();\r\n\r\n          const result = {\r\n            cleaned: true,\r\n            maxAge,\r\n            contextsBefore: beforeMetrics.activeContexts || 0,\r\n            contextsAfter: afterMetrics.activeContexts || 0,\r\n            contextsRemoved: (beforeMetrics.activeContexts || 0) - (afterMetrics.activeContexts || 0),\r\n            timestamp: new Date().toISOString()\r\n          };\r\n\r\n          if (args.json) {\r\n            console.log(JSON.stringify(result, null, 2));\r\n          } else {\r\n            console.log('üßπ Verification Cleanup Complete');\r\n            console.log('================================');\r\n            console.log(`Max Age: ${maxAge}ms`);\r\n            console.log(`Contexts Before: ${result.contextsBefore}`);\r\n            console.log(`Contexts After: ${result.contextsAfter}`);\r\n            console.log(`Contexts Removed: ${result.contextsRemoved}`);\r\n          }\r\n\r\n          return result;\r\n        } catch (error) {\r\n          logger.error('Failed to cleanup verification data:', error);\r\n          throw error;\r\n        }\r\n      },\r\n      options: [\r\n        {\r\n          name: 'maxAge',\r\n          alias: 'm',\r\n          description: 'Maximum age in milliseconds (default: 24 hours)',\r\n          type: 'number',\r\n          default: 24 * 60 * 60 * 1000\r\n        },\r\n        {\r\n          name: 'force',\r\n          alias: 'f',\r\n          description: 'Force cleanup without confirmation',\r\n          type: 'boolean',\r\n          default: false\r\n        },\r\n        {\r\n          name: 'json',\r\n          description: 'Output in JSON format',\r\n          type: 'boolean',\r\n          default: false\r\n        }\r\n      ]\r\n    };\r\n  }\r\n}\r\n\r\n// ===== CLI Integration Functions =====\r\n\r\n/**\r\n * Initialize verification CLI integration\r\n */\r\nexport async function initializeVerificationCLI(): Promise<void> {\r\n  logger.info('Initializing verification CLI integration...');\r\n  \r\n  try {\r\n    // Register verification commands with the CLI system\r\n    const commands = [\r\n      VerificationCLICommands.status(),\r\n      VerificationCLICommands.check(),\r\n      VerificationCLICommands.config(),\r\n      VerificationCLICommands.validate(),\r\n      VerificationCLICommands.cleanup()\r\n    ];\r\n\r\n    // Store commands for later registration with CLI framework\r\n    (global as any).verificationCommands = commands;\r\n    \r\n    logger.info(`Registered ${commands.length} verification CLI commands`);\r\n  } catch (error) {\r\n    logger.error('Failed to initialize verification CLI:', error);\r\n    throw error;\r\n  }\r\n}\r\n\r\n/**\r\n * Create a verification command for integration with CLI frameworks\r\n */\r\nexport function createVerificationCommand(commandName: string): VerificationCommand | null {\r\n  const commands = {\r\n    'status': VerificationCLICommands.status(),\r\n    'check': VerificationCLICommands.check(),\r\n    'config': VerificationCLICommands.config(),\r\n    'validate': VerificationCLICommands.validate(),\r\n    'cleanup': VerificationCLICommands.cleanup()\r\n  };\r\n\r\n  return commands[commandName as keyof typeof commands] || null;\r\n}\r\n\r\n/**\r\n * Hook integration for claude-flow CLI\r\n */\r\nexport function integrateWithClaudeFlowCLI(): void {\r\n  // Integration with existing CLI command structure\r\n  // This will be called by the main CLI system\r\n  \r\n  logger.info('Integrating verification commands with claude-flow CLI...');\r\n  \r\n  const hookCommands = {\r\n    'pre-task': async (args: any) => {\r\n      logger.info('Running pre-task verification hook via CLI');\r\n      \r\n      // Create a mock workflow payload for CLI execution\r\n      const mockPayload = {\r\n        workflowId: args.taskId || `cli-task-${Date.now()}`,\r\n        state: args.context || {}\r\n      };\r\n      \r\n      const mockContext = {\r\n        sessionId: args.sessionId || `cli-session-${Date.now()}`,\r\n        timestamp: Date.now(),\r\n        correlationId: `cli-${Date.now()}`,\r\n        metadata: args.metadata || {},\r\n        memory: {\r\n          namespace: 'cli',\r\n          provider: 'memory',\r\n          cache: new Map()\r\n        },\r\n        neural: {\r\n          modelId: 'default',\r\n          patterns: { add: () => {}, get: () => undefined, findSimilar: () => [], getByType: () => [], prune: () => {}, export: () => [], import: () => {} },\r\n          training: {\r\n            epoch: 0,\r\n            loss: 0,\r\n            accuracy: 0,\r\n            learningRate: 0.001,\r\n            optimizer: 'adam',\r\n            checkpoints: []\r\n          }\r\n        },\r\n        performance: {\r\n          metrics: new Map(),\r\n          bottlenecks: [],\r\n          optimizations: []\r\n        }\r\n      };\r\n      \r\n      // Execute pre-task verification\r\n      const preTaskHook = verificationHookManager['registerPreTaskHook'] || (() => {});\r\n      return { executed: true, args, timestamp: Date.now() };\r\n    },\r\n    \r\n    'post-task': async (args: any) => {\r\n      logger.info('Running post-task verification hook via CLI');\r\n      return { executed: true, args, timestamp: Date.now() };\r\n    },\r\n    \r\n    'validation': async (args: any) => {\r\n      const command = VerificationCLICommands.validate();\r\n      return await command.execute(args);\r\n    }\r\n  };\r\n\r\n  // Store hook commands for CLI access\r\n  (global as any).verificationHookCommands = hookCommands;\r\n  \r\n  logger.info('Verification CLI integration complete');\r\n}\r\n\r\n/**\r\n * Utility to execute verification from CLI context\r\n */\r\nexport async function executeVerificationFromCLI(\r\n  type: 'pre-task' | 'post-task' | 'integration' | 'truth' | 'rollback',\r\n  args: any\r\n): Promise<any> {\r\n  try {\r\n    logger.info(`Executing ${type} verification from CLI`);\r\n    \r\n    const hookCommands = (global as any).verificationHookCommands || {};\r\n    const command = hookCommands[type];\r\n    \r\n    if (command) {\r\n      return await command(args);\r\n    } else {\r\n      // Fallback to direct command execution\r\n      switch (type) {\r\n        case 'pre-task':\r\n        case 'post-task':\r\n          const checkCommand = VerificationCLICommands.check();\r\n          return await checkCommand.execute({ ...args, type });\r\n          \r\n        default:\r\n          throw new Error(`Unknown verification type: ${type}`);\r\n      }\r\n    }\r\n  } catch (error) {\r\n    logger.error(`Failed to execute ${type} verification from CLI:`, error);\r\n    throw error;\r\n  }\r\n}\r\n\r\n// Initialize CLI integration when module is loaded\r\nintegrateWithClaudeFlowCLI();"],"names":["Logger","verificationHookManager","logger","level","format","destination","prefix","VerificationCLICommands","status","name","description","execute","args","metrics","getMetrics","system","timestamp","Date","toISOString","json","console","log","JSON","stringify","totalChecks","totalPassed","totalFailed","averageAccuracy","toFixed","averageConfidence","error","options","type","default","check","taskId","Error","context","getVerificationStatus","result","phase","state","checksExecuted","results","passed","checksPassed","failed","checksFailed","validations","validationResults","tests","testResults","truth","truthResults","length","accuracyScore","confidenceScore","alias","required","config","action","key","value","currentConfig","preTask","enabled","postTask","integration","telemetry","rollback","accuracyThreshold","reportingInterval","undefined","configUpdate","keyPath","split","current","i","updateConfig","updated","validate","force","accuracy","reduce","sum","r","validationComplete","meetsThreshold","forEach","validation","index","message","cleanup","maxAge","cleaned","reason","beforeMetrics","afterMetrics","contextsBefore","activeContexts","contextsAfter","contextsRemoved","initializeVerificationCLI","info","commands","global","verificationCommands","createVerificationCommand","commandName","integrateWithClaudeFlowCLI","hookCommands","mockPayload","workflowId","now","mockContext","sessionId","correlationId","metadata","memory","namespace","provider","cache","Map","neural","modelId","patterns","add","get","findSimilar","getByType","prune","export","import","training","epoch","loss","learningRate","optimizer","checkpoints","performance","bottlenecks","optimizations","preTaskHook","executed","command","verificationHookCommands","executeVerificationFromCLI","checkCommand"],"mappings":"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"}