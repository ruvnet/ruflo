{"version":3,"sources":["../../../../src/cli/__tests__/simple-cli.test.js"],"sourcesContent":["/**\r\n * Tests for simple-cli.js\r\n */\r\n\r\nimport { jest } from '@jest/globals';\r\nimport { parseFlags } from '../utils.js';\r\n\r\n// Mock the command registry\r\njest.mock('../command-registry.js', () => ({\r\n  executeCommand: jest.fn(),\r\n  hasCommand: jest.fn(),\r\n  showCommandHelp: jest.fn(),\r\n  showAllCommands: jest.fn(),\r\n  listCommands: jest.fn(() => ['init', 'agent', 'task', 'memory', 'swarm']),\r\n  commandRegistry: new Map(),\r\n  registerCoreCommands: jest.fn(),\r\n}));\r\n\r\n// Mock node-compat\r\njest.mock('../node-compat.js', () => ({\r\n  args: () => process.argv.slice(2),\r\n  cwd: () => process.cwd(),\r\n  isMainModule: () => true,\r\n}));\r\n\r\ndescribe('Claude-Flow CLI', () => {\r\n  let originalArgv;\r\n  let originalExit;\r\n  let consoleLogSpy;\r\n  let consoleErrorSpy;\r\n\r\n  beforeEach(() => {\r\n    originalArgv = process.argv;\r\n    originalExit = process.exit;\r\n    process.exit = jest.fn();\r\n    consoleLogSpy = jest.spyOn(console, 'log').mockImplementation();\r\n    consoleErrorSpy = jest.spyOn(console, 'error').mockImplementation();\r\n    jest.clearAllMocks();\r\n  });\r\n\r\n  afterEach(() => {\r\n    process.argv = originalArgv;\r\n    process.exit = originalExit;\r\n    consoleLogSpy.mockRestore();\r\n    consoleErrorSpy.mockRestore();\r\n  });\r\n\r\n  describe('Help output', () => {\r\n    test('should show help when no arguments provided', async () => {\r\n      process.argv = ['node', 'claude-flow'];\r\n\r\n      const { executeCommand, hasCommand, showAllCommands } = await import(\r\n        '../command-registry.js'\r\n      );\r\n      hasCommand.mockReturnValue(false);\r\n\r\n      // Import after mocks are set up\r\n      await import('../simple-cli.js');\r\n\r\n      expect(consoleLogSpy).toHaveBeenCalled();\r\n      const output = consoleLogSpy.mock.calls.join('\\n');\r\n      expect(output).toContain('Claude-Flow v2.0.0');\r\n      expect(output).toContain('USAGE:');\r\n      expect(output).toContain('claude-flow <command> [options]');\r\n    });\r\n\r\n    test('should show help for --help flag', async () => {\r\n      process.argv = ['node', 'claude-flow', '--help'];\r\n\r\n      const { hasCommand } = await import('../command-registry.js');\r\n      hasCommand.mockReturnValue(false);\r\n\r\n      await import('../simple-cli.js');\r\n\r\n      expect(consoleLogSpy).toHaveBeenCalled();\r\n      const output = consoleLogSpy.mock.calls.join('\\n');\r\n      expect(output).toContain('Claude-Flow v2.0.0');\r\n    });\r\n\r\n    test('should show version for --version flag', async () => {\r\n      process.argv = ['node', 'claude-flow', '--version'];\r\n\r\n      await import('../simple-cli.js');\r\n\r\n      expect(consoleLogSpy).toHaveBeenCalledWith('2.0.0');\r\n      expect(process.exit).toHaveBeenCalledWith(0);\r\n    });\r\n  });\r\n\r\n  describe('Command execution', () => {\r\n    test('should execute valid command', async () => {\r\n      process.argv = ['node', 'claude-flow', 'init', '--sparc'];\r\n\r\n      const { executeCommand, hasCommand } = await import('../command-registry.js');\r\n      hasCommand.mockReturnValue(true);\r\n      executeCommand.mockResolvedValue(undefined);\r\n\r\n      await import('../simple-cli.js');\r\n\r\n      expect(hasCommand).toHaveBeenCalledWith('init');\r\n      expect(executeCommand).toHaveBeenCalledWith('init', ['--sparc'], {});\r\n    });\r\n\r\n    test('should handle command with multiple arguments', async () => {\r\n      process.argv = [\r\n        'node',\r\n        'claude-flow',\r\n        'swarm',\r\n        'Build a REST API',\r\n        '--strategy',\r\n        'development',\r\n      ];\r\n\r\n      const { executeCommand, hasCommand } = await import('../command-registry.js');\r\n      hasCommand.mockReturnValue(true);\r\n      executeCommand.mockResolvedValue(undefined);\r\n\r\n      await import('../simple-cli.js');\r\n\r\n      expect(hasCommand).toHaveBeenCalledWith('swarm');\r\n      expect(executeCommand).toHaveBeenCalledWith('swarm', ['Build a REST API'], {\r\n        strategy: 'development',\r\n      });\r\n    });\r\n\r\n    test('should show error for unknown command', async () => {\r\n      process.argv = ['node', 'claude-flow', 'invalid-command'];\r\n\r\n      const { hasCommand, listCommands } = await import('../command-registry.js');\r\n      hasCommand.mockReturnValue(false);\r\n\r\n      await import('../simple-cli.js');\r\n\r\n      expect(consoleErrorSpy).toHaveBeenCalledWith(\r\n        expect.stringContaining('Unknown command: invalid-command'),\r\n      );\r\n      expect(consoleLogSpy).toHaveBeenCalledWith(expect.stringContaining('Available commands:'));\r\n    });\r\n  });\r\n\r\n  describe('Flag parsing', () => {\r\n    test('should parse boolean flags correctly', () => {\r\n      const flags = parseFlags(['--force', '--verbose']);\r\n      expect(flags).toEqual({ force: true, verbose: true });\r\n    });\r\n\r\n    test('should parse value flags correctly', () => {\r\n      const flags = parseFlags(['--port', '8080', '--name', 'test']);\r\n      expect(flags).toEqual({ port: '8080', name: 'test' });\r\n    });\r\n\r\n    test('should handle mixed flags and arguments', () => {\r\n      const flags = parseFlags(['arg1', '--flag', 'value', 'arg2', '--bool']);\r\n      expect(flags).toEqual({ flag: 'value', bool: true });\r\n    });\r\n\r\n    test('should handle flags with equals sign', () => {\r\n      const flags = parseFlags(['--port=8080', '--name=test']);\r\n      expect(flags).toEqual({ port: '8080', name: 'test' });\r\n    });\r\n  });\r\n\r\n  describe('Error handling', () => {\r\n    test('should handle command execution errors gracefully', async () => {\r\n      process.argv = ['node', 'claude-flow', 'init'];\r\n\r\n      const { executeCommand, hasCommand } = await import('../command-registry.js');\r\n      hasCommand.mockReturnValue(true);\r\n      executeCommand.mockRejectedValue(new Error('Test error'));\r\n\r\n      await import('../simple-cli.js');\r\n\r\n      expect(consoleErrorSpy).toHaveBeenCalledWith(\r\n        expect.stringContaining('Error executing command:'),\r\n      );\r\n      expect(process.exit).toHaveBeenCalledWith(1);\r\n    });\r\n\r\n    test('should handle missing required arguments', async () => {\r\n      process.argv = ['node', 'claude-flow', 'agent'];\r\n\r\n      const { executeCommand, hasCommand } = await import('../command-registry.js');\r\n      hasCommand.mockReturnValue(true);\r\n      executeCommand.mockRejectedValue(new Error('Missing required argument'));\r\n\r\n      await import('../simple-cli.js');\r\n\r\n      expect(consoleErrorSpy).toHaveBeenCalledWith(\r\n        expect.stringContaining('Missing required argument'),\r\n      );\r\n    });\r\n  });\r\n});\r\n"],"names":["jest","parseFlags","mock","executeCommand","fn","hasCommand","showCommandHelp","showAllCommands","listCommands","commandRegistry","Map","registerCoreCommands","args","process","argv","slice","cwd","isMainModule","describe","originalArgv","originalExit","consoleLogSpy","consoleErrorSpy","beforeEach","exit","spyOn","console","mockImplementation","clearAllMocks","afterEach","mockRestore","test","mockReturnValue","expect","toHaveBeenCalled","output","calls","join","toContain","toHaveBeenCalledWith","mockResolvedValue","undefined","strategy","stringContaining","flags","toEqual","force","verbose","port","name","flag","bool","mockRejectedValue","Error"],"mappings":"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"}