{"version":3,"sources":["../../../../src/cli/simple-commands/stream-chain-clean.js"],"sourcesContent":["#!/usr/bin/env node\r\n/**\r\n * Stream Chain Command - Connect multiple Claude instances via stream-json\r\n * Clean implementation focused on real Claude CLI execution\r\n */\r\n\r\nimport { exec, execSync } from 'child_process';\r\n\r\n/**\r\n * Check if claude CLI is available\r\n */\r\nfunction checkClaudeAvailable() {\r\n  try {\r\n    execSync('which claude', { stdio: 'ignore' });\r\n    return true;\r\n  } catch {\r\n    return false;\r\n  }\r\n}\r\n\r\n/**\r\n * Mock implementation for fallback\r\n */\r\nfunction mockResponse(prompt) {\r\n  return {\r\n    success: true,\r\n    duration: 500,\r\n    output: `‚úÖ Mock response for: ${prompt.slice(0, 50)}...`,\r\n    stream: null,\r\n    error: null\r\n  };\r\n}\r\n\r\n/**\r\n * Execute a single Claude CLI command\r\n */\r\nasync function executeClaudeCommand(prompt, timeout = 20000, useStreamJson = false) {\r\n  return new Promise((resolve) => {\r\n    const args = ['-p'];\r\n    \r\n    if (useStreamJson) {\r\n      args.push('--output-format', 'stream-json', '--verbose');\r\n    }\r\n    \r\n    args.push(prompt);\r\n    const command = `claude ${args.join(' ')}`;\r\n    \r\n    console.log(`üîÑ Executing: ${command}`);\r\n    \r\n    const startTime = Date.now();\r\n    \r\n    exec(command, { \r\n      timeout,\r\n      maxBuffer: 1024 * 1024 * 10 // 10MB buffer\r\n    }, (error, stdout, stderr) => {\r\n      const duration = Date.now() - startTime;\r\n      \r\n      if (error && error.code === 'TIMEOUT') {\r\n        console.log('‚ö†Ô∏è  Claude CLI timed out, using mock response...');\r\n        resolve(mockResponse(prompt));\r\n        return;\r\n      }\r\n      \r\n      if (error) {\r\n        console.error('Claude CLI error:', error.message);\r\n        resolve(mockResponse(prompt));\r\n        return;\r\n      }\r\n      \r\n      resolve({\r\n        success: true,\r\n        duration,\r\n        output: stdout.trim(),\r\n        stream: useStreamJson ? stdout : null,\r\n        error: stderr ? stderr.trim() : null\r\n      });\r\n    });\r\n  });\r\n}\r\n\r\n/**\r\n * Main stream chain command\r\n */\r\nexport async function streamChainCommand(args, flags) {\r\n  const subcommand = args[0] || 'help';\r\n  \r\n  if (subcommand === 'help') {\r\n    console.log(`\r\nüîó Stream Chain Command\r\n\r\nUSAGE:\r\n  stream-chain run \"prompt1\" \"prompt2\" [...]  # Execute custom chain\r\n  stream-chain demo                           # Run demo chain\r\n  stream-chain test                           # Test Claude CLI\r\n  stream-chain help                           # Show this help\r\n\r\nOPTIONS:\r\n  --timeout <seconds>   Timeout per step (default: 20)\r\n  --mock               Force mock mode\r\n  --verbose            Show detailed output\r\n\r\nEXAMPLES:\r\n  stream-chain run \"Hello\" \"How are you?\"\r\n  stream-chain demo --timeout 30\r\n  stream-chain test\r\n\r\nFor real execution, Claude CLI must be installed and configured.\r\n    `);\r\n    return;\r\n  }\r\n  \r\n  if (subcommand === 'test') {\r\n    console.log('üß™ Testing Claude CLI...');\r\n    \r\n    if (!checkClaudeAvailable()) {\r\n      console.log('‚ùå Claude CLI not found');\r\n      return;\r\n    }\r\n    \r\n    const result = await executeClaudeCommand('Hello, test', 10000);\r\n    console.log('‚úÖ Test result:', result.success ? 'PASSED' : 'FAILED');\r\n    if (result.output) {\r\n      console.log('üìÑ Output:', result.output.slice(0, 100) + '...');\r\n    }\r\n    return;\r\n  }\r\n  \r\n  if (subcommand === 'demo') {\r\n    console.log('üé≠ Running Stream Chain Demo');\r\n    console.log('‚îÅ'.repeat(50));\r\n    \r\n    const prompts = [\r\n      \"Analyze requirements for a todo app\",\r\n      \"Design the data model\",\r\n      \"Create implementation plan\"\r\n    ];\r\n    \r\n    return runChain(prompts, flags);\r\n  }\r\n  \r\n  if (subcommand === 'run') {\r\n    const prompts = args.slice(1);\r\n    \r\n    if (prompts.length < 2) {\r\n      console.error('‚ùå Error: Need at least 2 prompts');\r\n      console.log('Usage: stream-chain run \"prompt1\" \"prompt2\" [...]');\r\n      return;\r\n    }\r\n    \r\n    return runChain(prompts, flags);\r\n  }\r\n  \r\n  console.error(`‚ùå Unknown subcommand: ${subcommand}`);\r\n  console.log('Use \"stream-chain help\" for usage information');\r\n}\r\n\r\n/**\r\n * Execute a chain of prompts\r\n */\r\nasync function runChain(prompts, flags) {\r\n  const timeout = (flags.timeout || 20) * 1000;\r\n  const useMock = flags.mock || !checkClaudeAvailable();\r\n  \r\n  if (useMock) {\r\n    console.log('‚ÑπÔ∏è  Using mock mode (Claude CLI not available or --mock flag used)');\r\n  } else {\r\n    console.log('‚ÑπÔ∏è  Using real Claude CLI execution');\r\n  }\r\n  \r\n  console.log(`üìù Chain length: ${prompts.length} steps\\n`);\r\n  \r\n  const results = [];\r\n  \r\n  for (let i = 0; i < prompts.length; i++) {\r\n    const prompt = prompts[i];\r\n    console.log(`üîÑ Step ${i + 1}/${prompts.length}: ${prompt.slice(0, 50)}...`);\r\n    \r\n    let result;\r\n    if (useMock) {\r\n      result = mockResponse(prompt);\r\n    } else {\r\n      result = await executeClaudeCommand(prompt, timeout, false);\r\n    }\r\n    \r\n    results.push({\r\n      step: i + 1,\r\n      prompt: prompt.slice(0, 50),\r\n      success: result.success,\r\n      duration: result.duration\r\n    });\r\n    \r\n    if (!result.success) {\r\n      console.error(`‚ùå Step ${i + 1} failed`);\r\n      break;\r\n    }\r\n    \r\n    console.log(`‚úÖ Step ${i + 1} completed (${result.duration}ms)`);\r\n    if (flags.verbose && result.output) {\r\n      console.log(`   Output: ${result.output.slice(0, 200)}...`);\r\n    }\r\n  }\r\n  \r\n  // Summary\r\n  console.log('\\n' + '‚ïê'.repeat(50));\r\n  console.log('üìä Chain Summary');\r\n  console.log('‚ïê'.repeat(50));\r\n  \r\n  for (const result of results) {\r\n    const status = result.success ? '‚úÖ' : '‚ùå';\r\n    console.log(`${status} Step ${result.step}: ${result.prompt}... (${result.duration}ms)`);\r\n  }\r\n  \r\n  const totalTime = results.reduce((sum, r) => sum + r.duration, 0);\r\n  console.log(`\\n‚è±Ô∏è  Total execution time: ${totalTime}ms`);\r\n}\r\n\r\nexport default streamChainCommand;"],"names":["exec","execSync","checkClaudeAvailable","stdio","mockResponse","prompt","success","duration","output","slice","stream","error","executeClaudeCommand","timeout","useStreamJson","Promise","resolve","args","push","command","join","console","log","startTime","Date","now","maxBuffer","stdout","stderr","code","message","trim","streamChainCommand","flags","subcommand","result","repeat","prompts","runChain","length","useMock","mock","results","i","step","verbose","status","totalTime","reduce","sum","r"],"mappings":"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"}