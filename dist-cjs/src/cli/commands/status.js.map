{"version":3,"sources":["../../../../src/cli/commands/status.ts"],"sourcesContent":["import { promises as fs } from 'node:fs';\r\n/**\r\n * Status command for Claude-Flow\r\n */\r\n\r\nimport { Command } from '../commander-fix.js';\r\nimport chalk from 'chalk';\r\nimport Table from 'cli-table3';\r\nimport { formatHealthStatus, formatDuration, formatStatusIndicator } from '../formatter.js';\r\nimport { VERSION } from '../../core/version.js';\r\nimport { MetricsReader } from '../../utils/metrics-reader.js';\r\n\r\nexport const statusCommand = new Command()\r\n  .name('status')\r\n  .description('Show Claude-Flow system status')\r\n  .option('-w, --watch', 'Watch mode - continuously update status')\r\n  .option('-i, --interval <seconds>', 'Update interval in seconds', '5')\r\n  .option('-c, --component <name>', 'Show status for specific component')\r\n  .option('--json', 'Output in JSON format')\r\n  .action(async (options: any) => {\r\n    if (options.watch) {\r\n      await watchStatus(options);\r\n    } else {\r\n      await showStatus(options);\r\n    }\r\n  });\r\n\r\nasync function showStatus(options: any): Promise<void> {\r\n  try {\r\n    // In a real implementation, this would connect to the running orchestrator\r\n    const status = await getSystemStatus();\r\n\r\n    if (options.json) {\r\n      console.log(JSON.stringify(status, null, 2));\r\n      return;\r\n    }\r\n\r\n    if (options.component) {\r\n      showComponentStatus(status, options.component);\r\n    } else {\r\n      showFullStatus(status);\r\n    }\r\n  } catch (error) {\r\n    if (\r\n      (error as Error).message.includes('ECONNREFUSED') ||\r\n      (error as Error).message.includes('connection refused')\r\n    ) {\r\n      console.error(chalk.red('✗ Claude-Flow is not running'));\r\n      console.log(chalk.gray('Start it with: claude-flow start'));\r\n    } else {\r\n      console.error(chalk.red('Error getting status:'), (error as Error).message);\r\n    }\r\n  }\r\n}\r\n\r\nasync function watchStatus(options: any): Promise<void> {\r\n  const interval = parseInt(options.interval) * 1000;\r\n\r\n  console.log(chalk.cyan('Watching Claude-Flow status...'));\r\n  console.log(chalk.gray(`Update interval: ${options.interval}s`));\r\n  console.log(chalk.gray('Press Ctrl+C to stop\\n'));\r\n\r\n  // eslint-disable-next-line no-constant-condition\r\n  while (true) {\r\n    // Clear screen and show status\r\n    console.clear();\r\n    console.log(chalk.cyan.bold('Claude-Flow Status Monitor'));\r\n    console.log(chalk.gray(`Last updated: ${new Date().toLocaleTimeString()}\\n`));\r\n\r\n    try {\r\n      await showStatus({ ...options, json: false });\r\n    } catch (error) {\r\n      console.error(chalk.red('Status update failed:'), (error as Error).message);\r\n    }\r\n\r\n    await new Promise((resolve) => setTimeout(resolve, interval));\r\n  }\r\n}\r\n\r\nfunction showFullStatus(status: any): void {\r\n  // System overview\r\n  console.log(chalk.cyan.bold('System Overview'));\r\n  console.log('─'.repeat(50));\r\n\r\n  const statusIcon = formatStatusIndicator(status.overall);\r\n  console.log(\r\n    `${statusIcon} Overall Status: ${getStatusColor(status.overall)(status.overall.toUpperCase())}`,\r\n  );\r\n  console.log(`${chalk.white('Uptime:')} ${formatDuration(status.uptime)}`);\r\n  console.log(`${chalk.white('Version:')} ${status.version}`);\r\n  console.log(`${chalk.white('Started:')} ${new Date(status.startTime).toLocaleString()}`);\r\n  console.log();\r\n\r\n  // Components status\r\n  console.log(chalk.cyan.bold('Components'));\r\n  console.log('─'.repeat(50));\r\n\r\n  const componentRows = [];\r\n  for (const [name, component] of Object.entries(status.components)) {\r\n    const comp = component as any;\r\n    const statusIcon = formatStatusIndicator(comp.status);\r\n    const statusText = getStatusColor(comp.status)(comp.status.toUpperCase());\r\n\r\n    componentRows.push([\r\n      chalk.white(name),\r\n      `${statusIcon} ${statusText}`,\r\n      formatDuration(comp.uptime || 0),\r\n      comp.details || '-',\r\n    ]);\r\n  }\r\n\r\n  const componentTable = new Table({\r\n    head: ['Component', 'Status', 'Uptime', 'Details'],\r\n  });\r\n  componentTable.push(...componentRows);\r\n\r\n  console.log(componentTable.toString());\r\n  console.log();\r\n\r\n  // Resource usage\r\n  if (status.resources) {\r\n    console.log(chalk.cyan.bold('Resource Usage'));\r\n    console.log('─'.repeat(50));\r\n\r\n    const resourceRows = [];\r\n    for (const [name, resource] of Object.entries(status.resources)) {\r\n      const res = resource as any;\r\n      const percentage = ((res.used / res.total) * 100).toFixed(1);\r\n      const color = getResourceColor(parseFloat(percentage));\r\n\r\n      resourceRows.push([\r\n        chalk.white(name),\r\n        res.used.toString(),\r\n        res.total.toString(),\r\n        color(`${percentage}%`),\r\n      ]);\r\n    }\r\n\r\n    const resourceTable = new Table({\r\n      head: ['Resource', 'Used', 'Total', 'Percentage'],\r\n    });\r\n    resourceTable.push(...resourceRows);\r\n\r\n    console.log(resourceTable.toString());\r\n    console.log();\r\n  }\r\n\r\n  // Active agents\r\n  if (status.agents) {\r\n    console.log(chalk.cyan.bold(`Active Agents (${status.agents.length})`));\r\n    console.log('─'.repeat(50));\r\n\r\n    if (status.agents.length > 0) {\r\n      const agentRows = [];\r\n      for (const agent of status.agents) {\r\n        const statusIcon = formatStatusIndicator(agent.status);\r\n        const statusText = getStatusColor(agent.status)(agent.status);\r\n\r\n        agentRows.push([\r\n          chalk.gray(agent.id.slice(0, 8)),\r\n          chalk.white(agent.name),\r\n          agent.type,\r\n          `${statusIcon} ${statusText}`,\r\n          agent.activeTasks.toString(),\r\n        ]);\r\n      }\r\n\r\n      const agentTable = new Table({\r\n        head: ['ID', 'Name', 'Type', 'Status', 'Tasks'],\r\n      });\r\n      agentTable.push(...agentRows);\r\n\r\n      console.log(agentTable.toString());\r\n    } else {\r\n      console.log(chalk.gray('No active agents'));\r\n    }\r\n    console.log();\r\n  }\r\n\r\n  // Recent tasks\r\n  if (status.recentTasks) {\r\n    console.log(chalk.cyan.bold('Recent Tasks'));\r\n    console.log('─'.repeat(50));\r\n\r\n    if (status.recentTasks.length > 0) {\r\n      const taskRows = [];\r\n      for (const task of status.recentTasks.slice(0, 10)) {\r\n        const statusIcon = formatStatusIndicator(task.status);\r\n        const statusText = getStatusColor(task.status)(task.status);\r\n\r\n        taskRows.push([\r\n          chalk.gray(task.id.slice(0, 8)),\r\n          task.type,\r\n          `${statusIcon} ${statusText}`,\r\n          formatDuration(Date.now() - new Date(task.startTime).getTime()),\r\n          task.assignedTo ? chalk.gray(task.assignedTo.slice(0, 8)) : '-',\r\n        ]);\r\n      }\r\n\r\n      const taskTable = new Table({\r\n        head: ['ID', 'Type', 'Status', 'Duration', 'Agent'],\r\n      });\r\n      taskTable.push(...taskRows);\r\n\r\n      console.log(taskTable.toString());\r\n    } else {\r\n      console.log(chalk.gray('No recent tasks'));\r\n    }\r\n  }\r\n}\r\n\r\nfunction showComponentStatus(status: any, componentName: string): void {\r\n  const component = status.components[componentName];\r\n\r\n  if (!component) {\r\n    console.error(chalk.red(`Component '${componentName}' not found`));\r\n    console.log(chalk.gray(`Available components: ${Object.keys(status.components).join(', ')}`));\r\n    return;\r\n  }\r\n\r\n  console.log(chalk.cyan.bold(`Component: ${componentName}`));\r\n  console.log('─'.repeat(50));\r\n\r\n  const statusIcon = formatStatusIndicator(component.status);\r\n  console.log(\r\n    `${statusIcon} Status: ${getStatusColor(component.status)(component.status.toUpperCase())}`,\r\n  );\r\n  console.log(`${chalk.white('Uptime:')} ${formatDuration(component.uptime || 0)}`);\r\n\r\n  if (component.details) {\r\n    console.log(`${chalk.white('Details:')} ${component.details}`);\r\n  }\r\n\r\n  if (component.metrics) {\r\n    console.log();\r\n    console.log(chalk.cyan('Metrics:'));\r\n\r\n    const metricRows = [];\r\n    for (const [name, value] of Object.entries(component.metrics)) {\r\n      metricRows.push([chalk.white(name), (value as any).toString()]);\r\n    }\r\n\r\n    const metricsTable = new Table({\r\n      head: ['Metric', 'Value'],\r\n    });\r\n    metricsTable.push(...metricRows);\r\n    console.log(metricsTable.toString());\r\n  }\r\n\r\n  if (component.errors && component.errors.length > 0) {\r\n    console.log();\r\n    console.log(chalk.red('Recent Errors:'));\r\n\r\n    const errorRows = [];\r\n    for (const error of component.errors.slice(0, 5)) {\r\n      errorRows.push([new Date(error.timestamp).toLocaleTimeString(), error.message]);\r\n    }\r\n\r\n    const errorTable = new Table({\r\n      head: ['Time', 'Error'],\r\n    });\r\n    errorTable.push(...errorRows);\r\n    console.log(errorTable.toString());\r\n  }\r\n}\r\n\r\nasync function getSystemStatus(): Promise<any> {\r\n  const reader = new MetricsReader();\r\n  \r\n  // Get real metrics from files\r\n  const [systemMetrics, perfMetrics, agents, recentTasks, overallHealth] = await Promise.all([\r\n    reader.getSystemMetrics(),\r\n    reader.getPerformanceMetrics(),\r\n    reader.getActiveAgents(),\r\n    reader.getRecentTasks(5),\r\n    reader.getOverallHealth()\r\n  ]);\r\n  \r\n  // Calculate uptime and memory in MB\r\n  const uptime = systemMetrics ? systemMetrics.uptime * 1000 : 0; // Convert to ms\r\n  const memUsedMB = systemMetrics ? Math.round(systemMetrics.memoryUsed / (1024 * 1024)) : 0;\r\n  const memTotalMB = systemMetrics ? Math.round(systemMetrics.memoryTotal / (1024 * 1024)) : 512;\r\n  \r\n  // Determine component health based on metrics\r\n  const orchestratorStatus = perfMetrics && perfMetrics.totalTasks > 0 ? 'healthy' : 'idle';\r\n  const agentsStatus = agents.length > 0 ? 'healthy' : 'idle';\r\n  const memoryStatus = systemMetrics && systemMetrics.memoryUsagePercent < 80 ? 'healthy' : \r\n                       systemMetrics && systemMetrics.memoryUsagePercent < 90 ? 'warning' : 'error';\r\n  \r\n  // Count active agents\r\n  const activeAgentCount = agents.filter(a => a.status === 'active' || a.status === 'busy').length;\r\n  \r\n  return {\r\n    overall: overallHealth,\r\n    version: VERSION,\r\n    uptime: uptime,\r\n    startTime: Date.now() - uptime,\r\n    components: {\r\n      orchestrator: {\r\n        status: orchestratorStatus,\r\n        uptime: uptime,\r\n        details: perfMetrics ? `${perfMetrics.totalTasks} tasks processed` : 'No tasks yet',\r\n      },\r\n      agents: {\r\n        status: agentsStatus,\r\n        uptime: uptime,\r\n        details: `${activeAgentCount} active, ${agents.length} total agents`,\r\n      },\r\n      memory: {\r\n        status: memoryStatus,\r\n        uptime: uptime,\r\n        details: `Using ${memUsedMB}MB of ${memTotalMB}MB`,\r\n      },\r\n    },\r\n    resources: {\r\n      memory: {\r\n        used: memUsedMB,\r\n        total: memTotalMB,\r\n      },\r\n      cpu: {\r\n        used: systemMetrics ? Math.round(systemMetrics.cpuLoad * 100) : 0,\r\n        total: 100,\r\n      },\r\n    },\r\n    agents: agents,\r\n    recentTasks: recentTasks,\r\n  };\r\n}\r\n\r\nfunction getStatusColor(status: string): (text: string) => string {\r\n  switch (status.toLowerCase()) {\r\n    case 'healthy':\r\n    case 'active':\r\n    case 'completed':\r\n      return chalk.green;\r\n    case 'warning':\r\n    case 'idle':\r\n    case 'pending':\r\n      return chalk.yellow;\r\n    case 'error':\r\n    case 'failed':\r\n      return chalk.red;\r\n    default:\r\n      return chalk.gray;\r\n  }\r\n}\r\n\r\nfunction getResourceColor(percentage: number): (text: string) => string {\r\n  if (percentage < 50) return chalk.green;\r\n  if (percentage < 80) return chalk.yellow;\r\n  return chalk.red;\r\n}\r\n"],"names":["Command","chalk","Table","formatDuration","formatStatusIndicator","VERSION","MetricsReader","statusCommand","name","description","option","action","options","watch","watchStatus","showStatus","status","getSystemStatus","json","console","log","JSON","stringify","component","showComponentStatus","showFullStatus","error","message","includes","red","gray","interval","parseInt","cyan","clear","bold","Date","toLocaleTimeString","Promise","resolve","setTimeout","repeat","statusIcon","overall","getStatusColor","toUpperCase","white","uptime","version","startTime","toLocaleString","componentRows","Object","entries","components","comp","statusText","push","details","componentTable","head","toString","resources","resourceRows","resource","res","percentage","used","total","toFixed","color","getResourceColor","parseFloat","resourceTable","agents","length","agentRows","agent","id","slice","type","activeTasks","agentTable","recentTasks","taskRows","task","now","getTime","assignedTo","taskTable","componentName","keys","join","metrics","metricRows","value","metricsTable","errors","errorRows","timestamp","errorTable","reader","systemMetrics","perfMetrics","overallHealth","all","getSystemMetrics","getPerformanceMetrics","getActiveAgents","getRecentTasks","getOverallHealth","memUsedMB","Math","round","memoryUsed","memTotalMB","memoryTotal","orchestratorStatus","totalTasks","agentsStatus","memoryStatus","memoryUsagePercent","activeAgentCount","filter","a","orchestrator","memory","cpu","cpuLoad","toLowerCase","green","yellow"],"mappings":"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"}