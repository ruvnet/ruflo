{"version":3,"sources":["../../../../src/cli/simple-commands/goal.js"],"sourcesContent":["/**\r\n * Goal module commands\r\n * Handles 'goal init' and other goal-related commands\r\n */\r\n\r\nimport { promises as fs } from 'fs';\r\nimport path from 'path';\r\nimport chalk from 'chalk';\r\n\r\nexport async function goalCommand(args, flags) {\r\n  const subcommand = args[0];\r\n  \r\n  if (!subcommand) {\r\n    console.log(chalk.magenta('üéØ Claude Flow Goal Module'));\r\n    console.log('\\nUsage: claude-flow goal <command> [options]');\r\n    console.log('\\nCommands:');\r\n    console.log('  init    Initialize GOAP goal module');\r\n    console.log('\\nOptions:');\r\n    console.log('  --force        Overwrite existing module');\r\n    console.log('  --target <dir> Target directory (default: .claude/agents/goal)');\r\n    return;\r\n  }\r\n  \r\n  if (subcommand === 'init') {\r\n    await initGoalModule(flags);\r\n  } else {\r\n    console.error(chalk.red(`Unknown goal subcommand: ${subcommand}`));\r\n    process.exit(1);\r\n  }\r\n}\r\n\r\nasync function initGoalModule(flags = {}) {\r\n  const targetDir = path.resolve(process.cwd(), flags.target || '.claude/agents/goal');\r\n  \r\n  console.log(chalk.magenta('üéØ Initializing Claude Flow Goal Module...'));\r\n  console.log(chalk.gray(`  Target: ${targetDir}`));\r\n  \r\n  try {\r\n    // Check if exists\r\n    if (await exists(targetDir) && !flags.force) {\r\n      console.log(chalk.yellow('‚ö†Ô∏è  Goal module already exists. Use --force to overwrite.'));\r\n      return;\r\n    }\r\n    \r\n    // Create directory\r\n    await fs.mkdir(targetDir, { recursive: true });\r\n    \r\n    // Create goal-planner agent content (full content from memory)\r\n    const plannerContent = `---\r\nname: goal-planner\r\ndescription: \"Goal-Oriented Action Planning (GOAP) specialist that dynamically creates intelligent plans to achieve complex objectives. Uses gaming AI techniques to discover novel solutions by combining actions in creative ways. Excels at adaptive replanning, multi-step reasoning, and finding optimal paths through complex state spaces.\"\r\ncolor: purple\r\n---\r\n\r\nYou are a Goal-Oriented Action Planning (GOAP) specialist, an advanced AI planner that uses intelligent algorithms to dynamically create optimal action sequences for achieving complex objectives. Your expertise combines gaming AI techniques with practical software engineering to discover novel solutions through creative action composition.\r\n\r\nYour core capabilities:\r\n- **Dynamic Planning**: Use A* search algorithms to find optimal paths through state spaces\r\n- **Precondition Analysis**: Evaluate action requirements and dependencies\r\n- **Effect Prediction**: Model how actions change world state\r\n- **Adaptive Replanning**: Adjust plans based on execution results and changing conditions\r\n- **Goal Decomposition**: Break complex objectives into achievable sub-goals\r\n- **Cost Optimization**: Find the most efficient path considering action costs\r\n- **Novel Solution Discovery**: Combine known actions in creative ways\r\n- **Mixed Execution**: Blend LLM-based reasoning with deterministic code actions\r\n- **Tool Group Management**: Match actions to available tools and capabilities\r\n- **Domain Modeling**: Work with strongly-typed state representations\r\n- **Continuous Learning**: Update planning strategies based on execution feedback\r\n\r\nYour planning methodology follows the GOAP algorithm:\r\n\r\n1. **State Assessment**:\r\n   - Analyze current world state (what is true now)\r\n   - Define goal state (what should be true)\r\n   - Identify the gap between current and goal states\r\n\r\n2. **Action Analysis**:\r\n   - Inventory available actions with their preconditions and effects\r\n   - Determine which actions are currently applicable\r\n   - Calculate action costs and priorities\r\n\r\n3. **Plan Generation**:\r\n   - Use A* pathfinding to search through possible action sequences\r\n   - Evaluate paths based on cost and heuristic distance to goal\r\n   - Generate optimal plan that transforms current state to goal state\r\n\r\n4. **Execution Monitoring** (OODA Loop):\r\n   - **Observe**: Monitor current state and execution progress\r\n   - **Orient**: Analyze changes and deviations from expected state\r\n   - **Decide**: Determine if replanning is needed\r\n   - **Act**: Execute next action or trigger replanning\r\n\r\n5. **Dynamic Replanning**:\r\n   - Detect when actions fail or produce unexpected results\r\n   - Recalculate optimal path from new current state\r\n   - Adapt to changing conditions and new information\r\n\r\n## MCP Integration Examples\r\n\r\n\\`\\`\\`javascript\r\n// Orchestrate complex goal achievement\r\nmcp__claude-flow__task_orchestrate {\r\n  task: \"achieve_production_deployment\",\r\n  strategy: \"adaptive\",\r\n  priority: \"high\"\r\n}\r\n\r\n// Coordinate with swarm for parallel planning\r\nmcp__claude-flow__swarm_init {\r\n  topology: \"hierarchical\",\r\n  maxAgents: 5\r\n}\r\n\r\n// Store successful plans for reuse\r\nmcp__claude-flow__memory_usage {\r\n  action: \"store\",\r\n  namespace: \"goap-plans\",\r\n  key: \"deployment_plan_v1\",\r\n  value: JSON.stringify(successful_plan)\r\n}\r\n\\`\\`\\``;\r\n    \r\n    await fs.writeFile(path.join(targetDir, 'goal-planner.md'), plannerContent);\r\n    console.log(chalk.gray('  ‚úì Created goal-planner.md'));\r\n    \r\n    console.log(chalk.green('\\n‚úÖ Goal module initialized successfully!'));\r\n    console.log(chalk.magenta('\\nüìö Usage:'));\r\n    console.log(chalk.gray('  ‚Ä¢ In Claude Code: @agent-goal-planner \"Create deployment plan\"'));\r\n    console.log(chalk.gray('  ‚Ä¢ View agent: cat .claude/agents/goal/goal-planner.md'));\r\n    \r\n  } catch (error) {\r\n    console.error(chalk.red('‚ùå Failed to initialize goal module:'), error.message);\r\n    process.exit(1);\r\n  }\r\n}\r\n\r\nasync function exists(path) {\r\n  try {\r\n    await fs.access(path);\r\n    return true;\r\n  } catch {\r\n    return false;\r\n  }\r\n}\r\n\r\nexport default goalCommand;"],"names":["promises","fs","path","chalk","goalCommand","args","flags","subcommand","console","log","magenta","initGoalModule","error","red","process","exit","targetDir","resolve","cwd","target","gray","exists","force","yellow","mkdir","recursive","plannerContent","writeFile","join","green","message","access"],"mappings":"AAKA,SAASA,YAAYC,EAAE,QAAQ,KAAK;AACpC,OAAOC,UAAU,OAAO;AACxB,OAAOC,WAAW,QAAQ;AAE1B,OAAO,eAAeC,YAAYC,IAAI,EAAEC,KAAK;IAC3C,MAAMC,aAAaF,IAAI,CAAC,EAAE;IAE1B,IAAI,CAACE,YAAY;QACfC,QAAQC,GAAG,CAACN,MAAMO,OAAO,CAAC;QAC1BF,QAAQC,GAAG,CAAC;QACZD,QAAQC,GAAG,CAAC;QACZD,QAAQC,GAAG,CAAC;QACZD,QAAQC,GAAG,CAAC;QACZD,QAAQC,GAAG,CAAC;QACZD,QAAQC,GAAG,CAAC;QACZ;IACF;IAEA,IAAIF,eAAe,QAAQ;QACzB,MAAMI,eAAeL;IACvB,OAAO;QACLE,QAAQI,KAAK,CAACT,MAAMU,GAAG,CAAC,CAAC,yBAAyB,EAAEN,YAAY;QAChEO,QAAQC,IAAI,CAAC;IACf;AACF;AAEA,eAAeJ,eAAeL,QAAQ,CAAC,CAAC;IACtC,MAAMU,YAAYd,KAAKe,OAAO,CAACH,QAAQI,GAAG,IAAIZ,MAAMa,MAAM,IAAI;IAE9DX,QAAQC,GAAG,CAACN,MAAMO,OAAO,CAAC;IAC1BF,QAAQC,GAAG,CAACN,MAAMiB,IAAI,CAAC,CAAC,UAAU,EAAEJ,WAAW;IAE/C,IAAI;QAEF,IAAI,MAAMK,OAAOL,cAAc,CAACV,MAAMgB,KAAK,EAAE;YAC3Cd,QAAQC,GAAG,CAACN,MAAMoB,MAAM,CAAC;YACzB;QACF;QAGA,MAAMtB,GAAGuB,KAAK,CAACR,WAAW;YAAES,WAAW;QAAK;QAG5C,MAAMC,iBAAiB,CAAC;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;MAwEtB,CAAC;QAEH,MAAMzB,GAAG0B,SAAS,CAACzB,KAAK0B,IAAI,CAACZ,WAAW,oBAAoBU;QAC5DlB,QAAQC,GAAG,CAACN,MAAMiB,IAAI,CAAC;QAEvBZ,QAAQC,GAAG,CAACN,MAAM0B,KAAK,CAAC;QACxBrB,QAAQC,GAAG,CAACN,MAAMO,OAAO,CAAC;QAC1BF,QAAQC,GAAG,CAACN,MAAMiB,IAAI,CAAC;QACvBZ,QAAQC,GAAG,CAACN,MAAMiB,IAAI,CAAC;IAEzB,EAAE,OAAOR,OAAO;QACdJ,QAAQI,KAAK,CAACT,MAAMU,GAAG,CAAC,wCAAwCD,MAAMkB,OAAO;QAC7EhB,QAAQC,IAAI,CAAC;IACf;AACF;AAEA,eAAeM,OAAOnB,IAAI;IACxB,IAAI;QACF,MAAMD,GAAG8B,MAAM,CAAC7B;QAChB,OAAO;IACT,EAAE,OAAM;QACN,OAAO;IACT;AACF;AAEA,eAAeE,YAAY"}