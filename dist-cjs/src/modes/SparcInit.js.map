{"version":3,"sources":["../../../src/modes/SparcInit.ts"],"sourcesContent":["/**\r\n * SparcInit - SPARC methodology initialization mode\r\n * Sets up Test-Driven Development with SPARC workflow\r\n */\r\n\r\nimport { IInitMode, InitConfig, InitResult } from '../types/interfaces.js';\r\n\r\nexport class SparcInit implements IInitMode {\r\n  getDescription(): string {\r\n    return 'SPARC (Specification, Pseudocode, Architecture, Refinement, Completion) initialization with TDD workflow';\r\n  }\r\n\r\n  getRequiredComponents(): string[] {\r\n    return ['ConfigManager', 'DatabaseManager', 'TopologyManager', 'AgentRegistry', 'MCPIntegrator'];\r\n  }\r\n\r\n  validate(): boolean {\r\n    return true; // SPARC mode is always valid\r\n  }\r\n\r\n  async initialize(config: InitConfig): Promise<InitResult> {\r\n    const components: string[] = [];\r\n\r\n    try {\r\n      // Basic initialization\r\n      if (config.configManager) {\r\n        components.push('ConfigManager');\r\n      }\r\n\r\n      if (config.databaseManager) {\r\n        await config.databaseManager.initialize();\r\n        components.push('DatabaseManager');\r\n      }\r\n\r\n      // Use hierarchical topology for SPARC workflow stages\r\n      if (config.topologyManager) {\r\n        await config.topologyManager.configure('hierarchical', []);\r\n        components.push('TopologyManager');\r\n      }\r\n\r\n      if (config.agentRegistry) {\r\n        await config.agentRegistry.initialize();\r\n        components.push('AgentRegistry');\r\n      }\r\n\r\n      // Spawn SPARC-specific agents\r\n      if (config.agentRegistry) {\r\n        // SPARC Coordinator (orchestrates the entire SPARC workflow)\r\n        await config.agentRegistry.spawn('coordinator', {\r\n          capabilities: ['sparc-coordination', 'workflow-management', 'tdd-orchestration'],\r\n          metadata: {\r\n            role: 'sparc-coordinator',\r\n            phase: 'all',\r\n            authority: 'high'\r\n          }\r\n        });\r\n\r\n        // Specification Agent\r\n        await config.agentRegistry.spawn('analyst', {\r\n          capabilities: ['requirement-analysis', 'specification-writing', 'user-story-creation'],\r\n          metadata: {\r\n            role: 'specification-agent',\r\n            phase: 'specification',\r\n            workflow: 'sparc'\r\n          }\r\n        });\r\n\r\n        // Pseudocode Agent\r\n        await config.agentRegistry.spawn('researcher', {\r\n          capabilities: ['algorithm-design', 'pseudocode-creation', 'logic-planning'],\r\n          metadata: {\r\n            role: 'pseudocode-agent',\r\n            phase: 'pseudocode',\r\n            workflow: 'sparc'\r\n          }\r\n        });\r\n\r\n        // Architecture Agent\r\n        await config.agentRegistry.spawn('reviewer', {\r\n          capabilities: ['system-architecture', 'design-patterns', 'component-design'],\r\n          metadata: {\r\n            role: 'architecture-agent',\r\n            phase: 'architecture',\r\n            workflow: 'sparc'\r\n          }\r\n        });\r\n\r\n        // Refinement Agent (TDD focus)\r\n        await config.agentRegistry.spawn('coder', {\r\n          capabilities: ['test-driven-development', 'unit-testing', 'refactoring', 'implementation'],\r\n          metadata: {\r\n            role: 'refinement-agent',\r\n            phase: 'refinement',\r\n            workflow: 'sparc'\r\n          }\r\n        });\r\n\r\n        // Completion Agent\r\n        await config.agentRegistry.spawn('tester', {\r\n          capabilities: ['integration-testing', 'validation', 'quality-assurance', 'documentation'],\r\n          metadata: {\r\n            role: 'completion-agent',\r\n            phase: 'completion',\r\n            workflow: 'sparc'\r\n          }\r\n        });\r\n\r\n        components.push('SparcAgents');\r\n      }\r\n\r\n      // Initialize SPARC MCP integration\r\n      if (config.mcpIntegrator) {\r\n        await config.mcpIntegrator.initialize();\r\n\r\n        // Test SPARC-related MCP functions\r\n        const sparcStatus = await config.mcpIntegrator.executeCommand({\r\n          tool: 'claude-flow',\r\n          function: 'sparc_mode',\r\n          parameters: { mode: 'dev', task_description: 'Initialize SPARC workflow' }\r\n        });\r\n\r\n        if (sparcStatus.success) {\r\n          components.push('SparcMCP');\r\n        }\r\n      }\r\n\r\n      // Set up SPARC workflow memory structures\r\n      if (config.databaseManager) {\r\n        await config.databaseManager.store('sparc-config', {\r\n          initialized: true,\r\n          mode: 'sparc',\r\n          phases: ['specification', 'pseudocode', 'architecture', 'refinement', 'completion'],\r\n          tddEnabled: true,\r\n          workflowActive: false,\r\n          currentPhase: null,\r\n          timestamp: new Date().toISOString()\r\n        }, 'sparc');\r\n\r\n        // Initialize phase tracking\r\n        const phases = ['specification', 'pseudocode', 'architecture', 'refinement', 'completion'];\r\n        for (const phase of phases) {\r\n          await config.databaseManager.store(`phase-${phase}`, {\r\n            name: phase,\r\n            status: 'pending',\r\n            agent: null,\r\n            artifacts: [],\r\n            dependencies: this.getPhaseDependencies(phase)\r\n          }, 'sparc');\r\n        }\r\n\r\n        // Initialize TDD tracking\r\n        await config.databaseManager.store('tdd-status', {\r\n          testSuites: [],\r\n          coverage: 0,\r\n          redGreenRefactor: {\r\n            red: [],\r\n            green: [],\r\n            refactor: []\r\n          }\r\n        }, 'sparc');\r\n\r\n        components.push('SparcMemory');\r\n      }\r\n\r\n      // Set up SPARC workflow templates\r\n      if (config.databaseManager) {\r\n        await config.databaseManager.store('workflow-templates', {\r\n          'feature-development': {\r\n            phases: phases.map(phase => ({\r\n              name: phase,\r\n              description: this.getPhaseDescription(phase),\r\n              estimatedDuration: this.getPhaseEstimatedDuration(phase),\r\n              deliverables: this.getPhaseDeliverables(phase)\r\n            }))\r\n          }\r\n        }, 'sparc');\r\n\r\n        components.push('SparcTemplates');\r\n      }\r\n\r\n      return {\r\n        success: true,\r\n        mode: 'sparc',\r\n        components,\r\n        topology: 'hierarchical',\r\n        message: 'SPARC workflow initialization completed successfully - TDD methodology active',\r\n        metadata: {\r\n          sparcPhases: 5,\r\n          tddEnabled: true,\r\n          agentSpecialization: true,\r\n          workflowOrchestration: true,\r\n          testDrivenDevelopment: true\r\n        }\r\n      };\r\n\r\n    } catch (error) {\r\n      return {\r\n        success: false,\r\n        mode: 'sparc',\r\n        components,\r\n        error: error instanceof Error ? error.message : String(error),\r\n        message: 'SPARC initialization failed'\r\n      };\r\n    }\r\n  }\r\n\r\n  private getPhaseDependencies(phase: string): string[] {\r\n    const dependencies: Record<string, string[]> = {\r\n      'specification': [],\r\n      'pseudocode': ['specification'],\r\n      'architecture': ['specification', 'pseudocode'],\r\n      'refinement': ['specification', 'pseudocode', 'architecture'],\r\n      'completion': ['specification', 'pseudocode', 'architecture', 'refinement']\r\n    };\r\n\r\n    return dependencies[phase] || [];\r\n  }\r\n\r\n  private getPhaseDescription(phase: string): string {\r\n    const descriptions: Record<string, string> = {\r\n      'specification': 'Analyze requirements and create detailed specifications',\r\n      'pseudocode': 'Design algorithms and create pseudocode representations',\r\n      'architecture': 'Design system architecture and component structure',\r\n      'refinement': 'Implement code using Test-Driven Development methodology',\r\n      'completion': 'Integration testing, validation, and documentation'\r\n    };\r\n\r\n    return descriptions[phase] || 'Unknown phase';\r\n  }\r\n\r\n  private getPhaseEstimatedDuration(phase: string): number {\r\n    const durations: Record<string, number> = {\r\n      'specification': 1800, // 30 minutes\r\n      'pseudocode': 1200,    // 20 minutes\r\n      'architecture': 2400,  // 40 minutes\r\n      'refinement': 3600,    // 60 minutes (main implementation)\r\n      'completion': 1800     // 30 minutes\r\n    };\r\n\r\n    return durations[phase] || 1800;\r\n  }\r\n\r\n  private getPhaseDeliverables(phase: string): string[] {\r\n    const deliverables: Record<string, string[]> = {\r\n      'specification': ['Requirements document', 'User stories', 'Acceptance criteria'],\r\n      'pseudocode': ['Algorithm pseudocode', 'Logic flow diagrams', 'Data structures'],\r\n      'architecture': ['System architecture', 'Component diagrams', 'API specifications'],\r\n      'refinement': ['Test suites', 'Implementation code', 'Refactored code'],\r\n      'completion': ['Integration tests', 'Documentation', 'Deployment artifacts']\r\n    };\r\n\r\n    return deliverables[phase] || [];\r\n  }\r\n}"],"names":["SparcInit","getDescription","getRequiredComponents","validate","initialize","config","components","configManager","push","databaseManager","topologyManager","configure","agentRegistry","spawn","capabilities","metadata","role","phase","authority","workflow","mcpIntegrator","sparcStatus","executeCommand","tool","function","parameters","mode","task_description","success","store","initialized","phases","tddEnabled","workflowActive","currentPhase","timestamp","Date","toISOString","name","status","agent","artifacts","dependencies","getPhaseDependencies","testSuites","coverage","redGreenRefactor","red","green","refactor","map","description","getPhaseDescription","estimatedDuration","getPhaseEstimatedDuration","deliverables","getPhaseDeliverables","topology","message","sparcPhases","agentSpecialization","workflowOrchestration","testDrivenDevelopment","error","Error","String","descriptions","durations"],"mappings":"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"}