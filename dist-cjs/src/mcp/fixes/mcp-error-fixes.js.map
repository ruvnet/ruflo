{"version":3,"sources":["../../../../src/mcp/fixes/mcp-error-fixes.js"],"sourcesContent":["/**\r\n * MCP Error Fixes\r\n * Fixes for agent_metrics, swarm_monitor, and neural_train errors\r\n */\r\n\r\n// Fix 1: agent_metrics - Ensure neuralNetworks is always an array\r\nexport function fixAgentMetrics(data) {\r\n  if (!data) {\r\n    return {\r\n      success: true,\r\n      agentId: null,\r\n      metrics: {\r\n        tasksCompleted: 0,\r\n        successRate: 0,\r\n        avgExecutionTime: 0,\r\n        neuralNetworks: [], // Ensure it's an array\r\n        memoryUsage: 0,\r\n        cpuUsage: 0,\r\n      },\r\n      timestamp: new Date().toISOString(),\r\n    };\r\n  }\r\n\r\n  // Ensure neuralNetworks is an array\r\n  if (data.metrics && !Array.isArray(data.metrics.neuralNetworks)) {\r\n    data.metrics.neuralNetworks = [];\r\n  }\r\n\r\n  // If neuralNetworks exists but isn't an array, convert it\r\n  if (data.neuralNetworks && !Array.isArray(data.neuralNetworks)) {\r\n    data.neuralNetworks = [];\r\n  }\r\n\r\n  return data;\r\n}\r\n\r\n// Fix 2: swarm_monitor - Ensure recentEvents is always an array\r\nexport function fixSwarmMonitor(data) {\r\n  if (!data) {\r\n    return {\r\n      success: true,\r\n      monitoring: {\r\n        swarmId: null,\r\n        status: 'active',\r\n        recentEvents: [], // Ensure it's an array\r\n        agentActivity: [],\r\n        taskProgress: [],\r\n        resourceUsage: {\r\n          cpu: 0,\r\n          memory: 0,\r\n          network: 0,\r\n        },\r\n      },\r\n      timestamp: new Date().toISOString(),\r\n    };\r\n  }\r\n\r\n  // Ensure recentEvents is an array\r\n  if (data.monitoring && !Array.isArray(data.monitoring.recentEvents)) {\r\n    data.monitoring.recentEvents = [];\r\n  }\r\n\r\n  // If recentEvents exists at top level but isn't an array, convert it\r\n  if (data.recentEvents && !Array.isArray(data.recentEvents)) {\r\n    data.recentEvents = [];\r\n  }\r\n\r\n  return data;\r\n}\r\n\r\n// Fix 3: neural_train - Add proper parameter validation\r\nexport function fixNeuralTrain(args) {\r\n  // Ensure agentId is provided as a string\r\n  if (!args.agentId && !args.agent_id) {\r\n    // Generate a default agent ID if not provided\r\n    args.agentId = `agent_${Date.now()}_${Math.random().toString(36).substr(2, 6)}`;\r\n  }\r\n\r\n  // Normalize parameter names\r\n  if (args.agent_id && !args.agentId) {\r\n    args.agentId = args.agent_id;\r\n  }\r\n\r\n  // Ensure agentId is a string\r\n  if (typeof args.agentId !== 'string') {\r\n    args.agentId = String(args.agentId || '');\r\n  }\r\n\r\n  // Set default iterations if not provided\r\n  if (!args.iterations && !args.epochs) {\r\n    args.iterations = 10;\r\n  }\r\n\r\n  // Normalize epochs to iterations\r\n  if (args.epochs && !args.iterations) {\r\n    args.iterations = args.epochs;\r\n  }\r\n\r\n  return args;\r\n}\r\n\r\n// Wrapper function to handle ruv-swarm MCP responses\r\nexport function wrapRuvSwarmResponse(toolName, response) {\r\n  try {\r\n    // Parse response if it's a string\r\n    let data = response;\r\n    if (typeof response === 'string') {\r\n      try {\r\n        data = JSON.parse(response);\r\n      } catch {\r\n        // If can't parse, wrap in object\r\n        data = { output: response };\r\n      }\r\n    }\r\n\r\n    // Apply specific fixes based on tool name\r\n    switch (toolName) {\r\n      case 'agent_metrics':\r\n      case 'mcp__ruv-swarm__agent_metrics':\r\n        return fixAgentMetrics(data);\r\n\r\n      case 'swarm_monitor':\r\n      case 'mcp__ruv-swarm__swarm_monitor':\r\n        return fixSwarmMonitor(data);\r\n\r\n      case 'neural_train':\r\n      case 'mcp__ruv-swarm__neural_train':\r\n        // For neural_train, we fix the args before calling\r\n        return data;\r\n\r\n      default:\r\n        return data;\r\n    }\r\n  } catch (error) {\r\n    console.error(`Error wrapping response for ${toolName}:`, error);\r\n    return {\r\n      success: false,\r\n      error: error.message,\r\n      timestamp: new Date().toISOString(),\r\n    };\r\n  }\r\n}\r\n\r\n// Export for use in MCP server\r\nif (typeof module !== 'undefined' && module.exports) {\r\n  module.exports = {\r\n    fixAgentMetrics,\r\n    fixSwarmMonitor,\r\n    fixNeuralTrain,\r\n    wrapRuvSwarmResponse,\r\n  };\r\n}"],"names":["fixAgentMetrics","data","success","agentId","metrics","tasksCompleted","successRate","avgExecutionTime","neuralNetworks","memoryUsage","cpuUsage","timestamp","Date","toISOString","Array","isArray","fixSwarmMonitor","monitoring","swarmId","status","recentEvents","agentActivity","taskProgress","resourceUsage","cpu","memory","network","fixNeuralTrain","args","agent_id","now","Math","random","toString","substr","String","iterations","epochs","wrapRuvSwarmResponse","toolName","response","JSON","parse","output","error","console","message","module","exports"],"mappings":"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"}