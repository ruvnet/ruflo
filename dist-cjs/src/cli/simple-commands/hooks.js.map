{"version":3,"sources":["../../../../src/cli/simple-commands/hooks.js"],"sourcesContent":["import {\r\n  printSuccess,\r\n  printError,\r\n  printWarning,\r\n  execRuvSwarmHook,\r\n  checkRuvSwarmAvailable,\r\n} from '../utils.js';\r\nimport { SqliteMemoryStore } from '../../memory/sqlite-store.js';\r\n\r\n// Initialize memory store\r\nlet memoryStore = null;\r\n\r\nasync function getMemoryStore() {\r\n  if (!memoryStore) {\r\n    memoryStore = new SqliteMemoryStore();\r\n    await memoryStore.initialize();\r\n  }\r\n  return memoryStore;\r\n}\r\n\r\n// Simple ID generator\r\nfunction generateId(prefix = 'id') {\r\n  return `${prefix}-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`;\r\n}\r\n\r\nexport async function hooksAction(subArgs, flags) {\r\n  const subcommand = subArgs[0];\r\n  const options = flags;\r\n\r\n  if (options.help || options.h || !subcommand) {\r\n    showHooksHelp();\r\n    return;\r\n  }\r\n\r\n  try {\r\n    switch (subcommand) {\r\n      // Pre-Operation Hooks\r\n      case 'pre-task':\r\n        await preTaskCommand(subArgs, flags);\r\n        break;\r\n      case 'pre-edit':\r\n        await preEditCommand(subArgs, flags);\r\n        break;\r\n      case 'pre-bash':\r\n      case 'pre-command': // Support both names for compatibility\r\n        await preBashCommand(subArgs, flags);\r\n        break;\r\n\r\n      // Post-Operation Hooks\r\n      case 'post-task':\r\n        await postTaskCommand(subArgs, flags);\r\n        break;\r\n      case 'post-edit':\r\n        await postEditCommand(subArgs, flags);\r\n        break;\r\n      case 'post-bash':\r\n      case 'post-command': // Support both names for compatibility\r\n        await postBashCommand(subArgs, flags);\r\n        break;\r\n      case 'post-search':\r\n        await postSearchCommand(subArgs, flags);\r\n        break;\r\n\r\n      // MCP Integration Hooks\r\n      case 'mcp-initialized':\r\n        await mcpInitializedCommand(subArgs, flags);\r\n        break;\r\n      case 'agent-spawned':\r\n        await agentSpawnedCommand(subArgs, flags);\r\n        break;\r\n      case 'task-orchestrated':\r\n        await taskOrchestratedCommand(subArgs, flags);\r\n        break;\r\n      case 'neural-trained':\r\n        await neuralTrainedCommand(subArgs, flags);\r\n        break;\r\n\r\n      // Session Hooks\r\n      case 'session-end':\r\n        await sessionEndCommand(subArgs, flags);\r\n        break;\r\n      case 'session-restore':\r\n        await sessionRestoreCommand(subArgs, flags);\r\n        break;\r\n      case 'notify':\r\n        await notifyCommand(subArgs, flags);\r\n        break;\r\n\r\n      // NEW: PreToolUse Modification Hooks (v2.0.10+)\r\n      case 'modify-bash':\r\n        await modifyBashCommand(subArgs, flags);\r\n        break;\r\n      case 'modify-file':\r\n        await modifyFileCommand(subArgs, flags);\r\n        break;\r\n      case 'modify-git-commit':\r\n        await modifyGitCommitCommand(subArgs, flags);\r\n        break;\r\n\r\n      default:\r\n        printError(`Unknown hooks command: ${subcommand}`);\r\n        showHooksHelp();\r\n    }\r\n  } catch (err) {\r\n    printError(`Hooks command failed: ${err.message}`);\r\n  }\r\n}\r\n\r\n// ===== PRE-OPERATION HOOKS =====\r\n\r\nasync function preTaskCommand(subArgs, flags) {\r\n  const options = flags;\r\n  const description = options.description || 'Unnamed task';\r\n  const taskId = options['task-id'] || options.taskId || generateId('task');\r\n  const agentId = options['agent-id'] || options.agentId;\r\n  const autoSpawnAgents = options['auto-spawn-agents'] !== 'false';\r\n\r\n  console.log(`ðŸ”„ Executing pre-task hook...`);\r\n  console.log(`ðŸ“‹ Task: ${description}`);\r\n  console.log(`ðŸ†” Task ID: ${taskId}`);\r\n  if (agentId) console.log(`ðŸ¤– Agent: ${agentId}`);\r\n\r\n  try {\r\n    const store = await getMemoryStore();\r\n    const taskData = {\r\n      taskId,\r\n      description,\r\n      agentId,\r\n      autoSpawnAgents,\r\n      status: 'started',\r\n      startedAt: new Date().toISOString(),\r\n    };\r\n\r\n    await store.store(`task:${taskId}`, taskData, {\r\n      namespace: 'hooks:pre-task',\r\n      metadata: { hookType: 'pre-task', agentId },\r\n    });\r\n\r\n    await store.store(\r\n      `task-index:${Date.now()}`,\r\n      {\r\n        taskId,\r\n        description,\r\n        timestamp: new Date().toISOString(),\r\n      },\r\n      { namespace: 'task-index' },\r\n    );\r\n\r\n    console.log(`  ðŸ’¾ Saved to .swarm/memory.db`);\r\n\r\n    // Execute ruv-swarm hook if available (with timeout for npx scenarios)\r\n    try {\r\n      const checkPromise = checkRuvSwarmAvailable();\r\n      const timeoutPromise = new Promise((_, reject) => \r\n        setTimeout(() => reject(new Error('Timeout')), 3000)\r\n      );\r\n      \r\n      const isAvailable = await Promise.race([checkPromise, timeoutPromise]);\r\n      \r\n      if (isAvailable) {\r\n        console.log(`\\nðŸ”„ Executing ruv-swarm pre-task hook...`);\r\n        const hookResult = await execRuvSwarmHook('pre-task', {\r\n          description,\r\n          'task-id': taskId,\r\n          'auto-spawn-agents': autoSpawnAgents,\r\n          ...(agentId ? { 'agent-id': agentId } : {}),\r\n        });\r\n\r\n        if (hookResult.success) {\r\n          await store.store(\r\n            `task:${taskId}:ruv-output`,\r\n            {\r\n              output: hookResult.output,\r\n              timestamp: new Date().toISOString(),\r\n            },\r\n            { namespace: 'hooks:ruv-swarm' },\r\n          );\r\n\r\n          printSuccess(`âœ… Pre-task hook completed successfully`);\r\n        }\r\n      }\r\n    } catch (err) {\r\n      // Skip ruv-swarm hook if it times out or fails\r\n      console.log(`\\nâš ï¸  Skipping ruv-swarm hook (${err.message})`);\r\n    }\r\n\r\n    console.log(`\\nðŸŽ¯ TASK PREPARATION COMPLETE`);\r\n    \r\n    // Close the memory store to prevent hanging\r\n    if (memoryStore && memoryStore.close) {\r\n      memoryStore.close();\r\n    }\r\n    \r\n    // Force exit after a short delay to ensure cleanup\r\n    setTimeout(() => {\r\n      process.exit(0);\r\n    }, 100);\r\n  } catch (err) {\r\n    printError(`Pre-task hook failed: ${err.message}`);\r\n    \r\n    // Close the memory store on error too\r\n    if (memoryStore && memoryStore.close) {\r\n      memoryStore.close();\r\n    }\r\n    \r\n    // Force exit after a short delay to ensure cleanup\r\n    setTimeout(() => {\r\n      process.exit(1);\r\n    }, 100);\r\n  }\r\n}\r\n\r\nasync function preEditCommand(subArgs, flags) {\r\n  const options = flags;\r\n  const file = options.file || 'unknown-file';\r\n  const operation = options.operation || 'edit';\r\n  const autoAssignAgents = options['auto-assign-agents'] || false;\r\n  const loadContext = options['load-context'] || false;\r\n\r\n  console.log(`ðŸ“ Executing pre-edit hook...`);\r\n  console.log(`ðŸ“„ File: ${file}`);\r\n  console.log(`âš™ï¸  Operation: ${operation}`);\r\n  if (autoAssignAgents) console.log(`ðŸ¤– Auto-assign agents: ENABLED`);\r\n  if (loadContext) console.log(`ðŸ”„ Load context: ENABLED`);\r\n\r\n  try {\r\n    const store = await getMemoryStore();\r\n\r\n    // Auto-assign agents based on file type\r\n    let assignedAgentType = 'general';\r\n    let recommendedAgent = null;\r\n\r\n    if (autoAssignAgents) {\r\n      const path = await import('path');\r\n      const ext = path.extname(file).toLowerCase();\r\n\r\n      const agentMapping = {\r\n        '.js': 'javascript-developer',\r\n        '.ts': 'typescript-developer',\r\n        '.py': 'python-developer',\r\n        '.go': 'golang-developer',\r\n        '.rs': 'rust-developer',\r\n        '.java': 'java-developer',\r\n        '.cpp': 'cpp-developer',\r\n        '.c': 'c-developer',\r\n        '.css': 'frontend-developer',\r\n        '.html': 'frontend-developer',\r\n        '.vue': 'frontend-developer',\r\n        '.react': 'frontend-developer',\r\n        '.md': 'technical-writer',\r\n        '.yml': 'devops-engineer',\r\n        '.yaml': 'devops-engineer',\r\n        '.json': 'config-specialist',\r\n        '.sql': 'database-expert',\r\n        '.sh': 'system-admin',\r\n        '.dockerfile': 'devops-engineer',\r\n      };\r\n\r\n      assignedAgentType = agentMapping[ext] || 'general-developer';\r\n      recommendedAgent = {\r\n        type: assignedAgentType,\r\n        file: file,\r\n        extension: ext,\r\n        recommended: true,\r\n      };\r\n\r\n      console.log(`  ðŸ¤– Recommended agent: ${assignedAgentType}`);\r\n    }\r\n\r\n    // Load context if requested\r\n    let contextData = null;\r\n    if (loadContext) {\r\n      try {\r\n        // Check if file exists and get basic info\r\n        const fs = await import('fs');\r\n        const path = await import('path');\r\n\r\n        if (fs.existsSync(file)) {\r\n          const stats = fs.statSync(file);\r\n          const dirname = path.dirname(file);\r\n          const basename = path.basename(file);\r\n\r\n          contextData = {\r\n            fileExists: true,\r\n            size: stats.size,\r\n            modified: stats.mtime,\r\n            directory: dirname,\r\n            filename: basename,\r\n            isDirectory: stats.isDirectory(),\r\n          };\r\n\r\n          console.log(`  ðŸ“ Context loaded: ${basename} (${stats.size} bytes)`);\r\n        } else {\r\n          contextData = {\r\n            fileExists: false,\r\n            willCreate: true,\r\n            directory: path.dirname(file),\r\n            filename: path.basename(file),\r\n          };\r\n          console.log(`  ðŸ“ Context: New file will be created`);\r\n        }\r\n      } catch (err) {\r\n        console.log(`  âš ï¸  Warning: Could not load context for ${file}`);\r\n        contextData = { error: err.message };\r\n      }\r\n    }\r\n\r\n    const editData = {\r\n      file,\r\n      operation,\r\n      timestamp: new Date().toISOString(),\r\n      editId: generateId('edit'),\r\n      autoAssignAgents,\r\n      loadContext,\r\n      assignedAgentType,\r\n      recommendedAgent,\r\n      contextData,\r\n    };\r\n\r\n    await store.store(`edit:${editData.editId}:pre`, editData, {\r\n      namespace: 'hooks:pre-edit',\r\n      metadata: { hookType: 'pre-edit', file, agentType: assignedAgentType },\r\n    });\r\n\r\n    // Store agent recommendation if enabled\r\n    if (autoAssignAgents && recommendedAgent) {\r\n      await store.store(`agent-recommendation:${file}`, recommendedAgent, {\r\n        namespace: 'agent-assignments',\r\n        ttl: 3600, // 1 hour\r\n      });\r\n    }\r\n\r\n    console.log(`  ðŸ’¾ Pre-edit state saved to .swarm/memory.db`);\r\n    printSuccess(`âœ… Pre-edit hook completed`);\r\n  } catch (err) {\r\n    printError(`Pre-edit hook failed: ${err.message}`);\r\n  }\r\n}\r\n\r\nasync function preBashCommand(subArgs, flags) {\r\n  const options = flags;\r\n  const command = options.command || subArgs.slice(1).join(' ') || '';\r\n  const workingDir = options.cwd || process.cwd();\r\n  const validateSafety = options['validate-safety'] === true || options['validate-safety'] === 'true' || options.validate === true || options.validate === 'true' || false;\r\n  const prepareResources = options['prepare-resources'] === true || options['prepare-resources'] === 'true' || false;\r\n\r\n  console.log(`ðŸ”§ Executing pre-bash hook...`);\r\n  console.log(`ðŸ“œ Command: ${command}`);\r\n  console.log(`ðŸ“ Working dir: ${workingDir}`);\r\n  if (validateSafety) console.log(`ðŸ”’ Safety validation: ENABLED`);\r\n  if (prepareResources) console.log(`ðŸ› ï¸  Resource preparation: ENABLED`);\r\n\r\n  try {\r\n    const store = await getMemoryStore();\r\n    let safetyResult = 'skipped';\r\n\r\n    if (validateSafety) {\r\n      // Basic safety validation\r\n      const dangerousCommands = [\r\n        'rm -rf /',\r\n        'rm -rf .',\r\n        'rm -rf *',\r\n        'format',\r\n        'fdisk',\r\n        'mkfs',\r\n        'curl * | bash',\r\n        'wget * | sh',\r\n        'eval',\r\n        'exec',\r\n        'chmod 777',\r\n      ];\r\n\r\n      const isDangerous = command && typeof command === 'string' && command.length > 0 \r\n        ? dangerousCommands.some((dangerous) =>\r\n            command.toLowerCase().includes(dangerous.toLowerCase()),\r\n          )\r\n        : false;\r\n\r\n      safetyResult = isDangerous ? 'dangerous' : 'safe';\r\n\r\n      if (isDangerous) {\r\n        console.log(`  âš ï¸  Safety check: DANGEROUS COMMAND DETECTED`);\r\n        console.log(`  ðŸš« Command blocked for safety`);\r\n        printError(`Command blocked due to safety validation: ${command}`);\r\n        return;\r\n      }\r\n    }\r\n\r\n    if (prepareResources) {\r\n      // Resource preparation - create working directory if needed\r\n      const fs = await import('fs');\r\n      const path = await import('path');\r\n\r\n      if (!fs.existsSync(workingDir)) {\r\n        fs.mkdirSync(workingDir, { recursive: true });\r\n        console.log(`  ðŸ“ Created working directory: ${workingDir}`);\r\n      }\r\n\r\n      // Check available disk space\r\n      try {\r\n        const stats = fs.statSync(workingDir);\r\n        console.log(`  ðŸ’¾ Working directory prepared`);\r\n      } catch (err) {\r\n        console.log(`  âš ï¸  Warning: Could not check working directory`);\r\n      }\r\n    }\r\n\r\n    const bashData = {\r\n      command,\r\n      workingDir,\r\n      timestamp: new Date().toISOString(),\r\n      bashId: generateId('bash'),\r\n      safety: safetyResult,\r\n      validationEnabled: validateSafety,\r\n      resourcesPrepped: prepareResources,\r\n    };\r\n\r\n    await store.store(`bash:${bashData.bashId}:pre`, bashData, {\r\n      namespace: 'hooks:pre-bash',\r\n      metadata: { hookType: 'pre-bash', command, safety: safetyResult },\r\n    });\r\n\r\n    console.log(`  ðŸ’¾ Command logged to .swarm/memory.db`);\r\n    console.log(`  ðŸ”’ Safety check: ${safetyResult.toUpperCase()}`);\r\n    printSuccess(`âœ… Pre-bash hook completed`);\r\n  } catch (err) {\r\n    printError(`Pre-bash hook failed: ${err.message}`);\r\n  }\r\n}\r\n\r\n// ===== POST-OPERATION HOOKS =====\r\n\r\nasync function postTaskCommand(subArgs, flags) {\r\n  const options = flags;\r\n  const taskId = options['task-id'] || options.taskId || generateId('task');\r\n  const analyzePerformance = options['analyze-performance'] !== 'false';\r\n\r\n  console.log(`ðŸ Executing post-task hook...`);\r\n  console.log(`ðŸ†” Task ID: ${taskId}`);\r\n\r\n  try {\r\n    const store = await getMemoryStore();\r\n    const taskData = await store.retrieve(`task:${taskId}`, {\r\n      namespace: 'hooks:pre-task',\r\n    });\r\n\r\n    const completedData = {\r\n      ...(taskData || {}),\r\n      status: 'completed',\r\n      completedAt: new Date().toISOString(),\r\n      duration: taskData ? Date.now() - new Date(taskData.startedAt).getTime() : null,\r\n    };\r\n\r\n    await store.store(`task:${taskId}:completed`, completedData, {\r\n      namespace: 'hooks:post-task',\r\n      metadata: { hookType: 'post-task' },\r\n    });\r\n\r\n    if (analyzePerformance && completedData.duration) {\r\n      const metrics = {\r\n        taskId,\r\n        duration: completedData.duration,\r\n        durationHuman: `${(completedData.duration / 1000).toFixed(2)}s`,\r\n        timestamp: new Date().toISOString(),\r\n      };\r\n\r\n      await store.store(`metrics:${taskId}`, metrics, {\r\n        namespace: 'performance',\r\n      });\r\n      console.log(`  ðŸ“Š Performance: ${metrics.durationHuman}`);\r\n    }\r\n\r\n    console.log(`  ðŸ’¾ Task completion saved to .swarm/memory.db`);\r\n    printSuccess(`âœ… Post-task hook completed`);\r\n  } catch (err) {\r\n    printError(`Post-task hook failed: ${err.message}`);\r\n  }\r\n}\r\n\r\nasync function postEditCommand(subArgs, flags) {\r\n  const options = flags;\r\n  const file = options.file || 'unknown-file';\r\n  let memoryKey = options['memory-key'] || options.memoryKey;\r\n  \r\n  // Handle case where memory-key is passed as a boolean flag without value\r\n  if (memoryKey === true) {\r\n    // Generate a default memory key based on the file path and timestamp\r\n    const path = await import('path');\r\n    const basename = path.basename(file);\r\n    memoryKey = `edit:${basename}:${Date.now()}`;\r\n  }\r\n  \r\n  const format = options.format || false;\r\n  const updateMemory = options['update-memory'] || false;\r\n  const trainNeural = options['train-neural'] || false;\r\n\r\n  console.log(`ðŸ“ Executing post-edit hook...`);\r\n  console.log(`ðŸ“„ File: ${file}`);\r\n  if (memoryKey) console.log(`ðŸ’¾ Memory key: ${memoryKey}`);\r\n  if (format) console.log(`ðŸŽ¨ Auto-format: ENABLED`);\r\n  if (updateMemory) console.log(`ðŸ§  Memory update: ENABLED`);\r\n  if (trainNeural) console.log(`ðŸ¤– Neural training: ENABLED`);\r\n\r\n  try {\r\n    const store = await getMemoryStore();\r\n    const path = await import('path');\r\n    const fs = await import('fs');\r\n\r\n    // Auto-format file if requested\r\n    let formatResult = null;\r\n    if (format && fs.existsSync(file)) {\r\n      const ext = path.extname(file).toLowerCase();\r\n      const formatters = {\r\n        '.js': 'prettier',\r\n        '.ts': 'prettier',\r\n        '.json': 'prettier',\r\n        '.css': 'prettier',\r\n        '.html': 'prettier',\r\n        '.py': 'black',\r\n        '.go': 'gofmt',\r\n        '.rs': 'rustfmt',\r\n        '.java': 'google-java-format',\r\n        '.cpp': 'clang-format',\r\n        '.c': 'clang-format',\r\n      };\r\n\r\n      const formatter = formatters[ext];\r\n      if (formatter) {\r\n        console.log(`  ðŸŽ¨ Auto-formatting with ${formatter}...`);\r\n        formatResult = {\r\n          formatter,\r\n          extension: ext,\r\n          attempted: true,\r\n          timestamp: new Date().toISOString(),\r\n        };\r\n      } else {\r\n        console.log(`  âš ï¸  No formatter available for ${ext}`);\r\n        formatResult = {\r\n          extension: ext,\r\n          attempted: false,\r\n          reason: 'No formatter available',\r\n        };\r\n      }\r\n    }\r\n\r\n    // Update memory with edit context\r\n    let memoryUpdate = null;\r\n    if (updateMemory) {\r\n      const editContext = {\r\n        file,\r\n        editedAt: new Date().toISOString(),\r\n        editId: generateId('edit'),\r\n        formatted: formatResult?.attempted || false,\r\n        fileSize: fs.existsSync(file) ? fs.statSync(file).size : 0,\r\n        directory: path.dirname(file),\r\n        basename: path.basename(file),\r\n      };\r\n\r\n      memoryUpdate = editContext;\r\n\r\n      // Store in coordination namespace\r\n      await store.store(`edit-context:${editContext.editId}`, editContext, {\r\n        namespace: 'coordination',\r\n        metadata: { type: 'edit-context', file },\r\n      });\r\n\r\n      console.log(`  ðŸ§  Edit context stored in memory`);\r\n    }\r\n\r\n    // Train neural patterns if requested\r\n    let neuralTraining = null;\r\n    if (trainNeural) {\r\n      // Simulate neural training with file patterns\r\n      const ext = path.extname(file).toLowerCase();\r\n      const basename = path.basename(file);\r\n      const editTime = new Date().toISOString();\r\n\r\n      const patterns = {\r\n        fileType: ext,\r\n        fileName: basename,\r\n        editTime,\r\n        confidence: Math.random() * 0.5 + 0.5, // 50-100% confidence\r\n        patterns: [\r\n          `${ext}_edit_pattern`,\r\n          `${basename}_modification`,\r\n          `edit_${Date.now()}_sequence`,\r\n        ],\r\n      };\r\n\r\n      neuralTraining = patterns;\r\n\r\n      await store.store(`neural-pattern:${generateId('pattern')}`, patterns, {\r\n        namespace: 'neural-training',\r\n        metadata: { type: 'edit-pattern', file, extension: ext },\r\n      });\r\n\r\n      console.log(\r\n        `  ðŸ¤– Neural patterns trained (${(patterns.confidence * 100).toFixed(1)}% confidence)`,\r\n      );\r\n    }\r\n\r\n    const editData = {\r\n      file,\r\n      memoryKey,\r\n      timestamp: new Date().toISOString(),\r\n      editId: generateId('edit'),\r\n      format,\r\n      updateMemory,\r\n      trainNeural,\r\n      formatResult,\r\n      memoryUpdate,\r\n      neuralTraining,\r\n    };\r\n\r\n    await store.store(`edit:${editData.editId}:post`, editData, {\r\n      namespace: 'hooks:post-edit',\r\n      metadata: { hookType: 'post-edit', file, formatted: formatResult?.attempted || false },\r\n    });\r\n\r\n    if (memoryKey && typeof memoryKey === 'string') {\r\n      await store.store(\r\n        memoryKey,\r\n        {\r\n          file,\r\n          editedAt: new Date().toISOString(),\r\n          editId: editData.editId,\r\n          enhanced: true,\r\n          formatResult,\r\n          memoryUpdate,\r\n          neuralTraining,\r\n        },\r\n        { namespace: 'coordination' },\r\n      );\r\n    }\r\n\r\n    const historyKey = `file-history:${file.replace(/\\//g, '_')}:${Date.now()}`;\r\n    await store.store(\r\n      historyKey,\r\n      {\r\n        file,\r\n        editId: editData.editId,\r\n        timestamp: new Date().toISOString(),\r\n        enhanced: true,\r\n        features: {\r\n          format,\r\n          updateMemory,\r\n          trainNeural,\r\n        },\r\n      },\r\n      { namespace: 'file-history' },\r\n    );\r\n\r\n    console.log(`  ðŸ’¾ Post-edit data saved to .swarm/memory.db`);\r\n    printSuccess(`âœ… Post-edit hook completed`);\r\n  } catch (err) {\r\n    printError(`Post-edit hook failed: ${err.message}`);\r\n  }\r\n}\r\n\r\nasync function postBashCommand(subArgs, flags) {\r\n  const options = flags;\r\n  const command = options.command || subArgs.slice(1).join(' ');\r\n  const exitCode = options['exit-code'] || '0';\r\n  const output = options.output || '';\r\n  const trackMetrics = options['track-metrics'] || false;\r\n  const storeResults = options['store-results'] || false;\r\n  const duration = options.duration || 0;\r\n\r\n  console.log(`ðŸ”§ Executing post-bash hook...`);\r\n  console.log(`ðŸ“œ Command: ${command}`);\r\n  console.log(`ðŸ“Š Exit code: ${exitCode}`);\r\n  if (trackMetrics) console.log(`ðŸ“Š Metrics tracking: ENABLED`);\r\n  if (storeResults) console.log(`ðŸ’¾ Results storage: ENABLED`);\r\n\r\n  try {\r\n    const store = await getMemoryStore();\r\n    const startTime = Date.now();\r\n\r\n    // Calculate performance metrics if enabled\r\n    let metrics = null;\r\n    if (trackMetrics) {\r\n      const commandLength = command.length;\r\n      const outputLength = output.length;\r\n      const success = parseInt(exitCode) === 0;\r\n\r\n      metrics = {\r\n        commandLength,\r\n        outputLength,\r\n        success,\r\n        duration: parseInt(duration) || 0,\r\n        exitCode: parseInt(exitCode),\r\n        timestamp: new Date().toISOString(),\r\n        complexity: commandLength > 100 ? 'high' : commandLength > 50 ? 'medium' : 'low',\r\n      };\r\n\r\n      console.log(\r\n        `  ðŸ“Š Command metrics: ${commandLength} chars, ${outputLength} output, ${success ? 'SUCCESS' : 'FAILED'}`,\r\n      );\r\n    }\r\n\r\n    const bashData = {\r\n      command,\r\n      exitCode,\r\n      output: storeResults ? output.substring(0, 5000) : output.substring(0, 1000), // Store more if requested\r\n      timestamp: new Date().toISOString(),\r\n      bashId: generateId('bash'),\r\n      trackMetrics,\r\n      storeResults,\r\n      metrics,\r\n    };\r\n\r\n    await store.store(`bash:${bashData.bashId}:post`, bashData, {\r\n      namespace: 'hooks:post-bash',\r\n      metadata: { hookType: 'post-bash', command, exitCode, success: parseInt(exitCode) === 0 },\r\n    });\r\n\r\n    // Store detailed results if enabled\r\n    if (storeResults) {\r\n      await store.store(\r\n        `command-results:${bashData.bashId}`,\r\n        {\r\n          command,\r\n          exitCode,\r\n          output,\r\n          timestamp: new Date().toISOString(),\r\n          fullOutput: true,\r\n        },\r\n        { namespace: 'command-results' },\r\n      );\r\n\r\n      console.log(`  ðŸ’¾ Full command results stored`);\r\n    }\r\n\r\n    // Store metrics if enabled\r\n    if (trackMetrics && metrics) {\r\n      await store.store(`command-metrics:${bashData.bashId}`, metrics, {\r\n        namespace: 'performance-metrics',\r\n      });\r\n\r\n      // Update running metrics\r\n      const existingMetrics = (await store.retrieve('command-metrics-summary', {\r\n        namespace: 'performance-metrics',\r\n      })) || { totalCommands: 0, successRate: 0, avgDuration: 0 };\r\n\r\n      existingMetrics.totalCommands += 1;\r\n      existingMetrics.successRate =\r\n        (existingMetrics.successRate * (existingMetrics.totalCommands - 1) +\r\n          (metrics.success ? 1 : 0)) /\r\n        existingMetrics.totalCommands;\r\n      existingMetrics.avgDuration =\r\n        (existingMetrics.avgDuration * (existingMetrics.totalCommands - 1) + metrics.duration) /\r\n        existingMetrics.totalCommands;\r\n      existingMetrics.lastUpdated = new Date().toISOString();\r\n\r\n      await store.store('command-metrics-summary', existingMetrics, {\r\n        namespace: 'performance-metrics',\r\n      });\r\n    }\r\n\r\n    // Update command history\r\n    await store.store(\r\n      `command-history:${Date.now()}`,\r\n      {\r\n        command,\r\n        exitCode,\r\n        timestamp: new Date().toISOString(),\r\n        success: parseInt(exitCode) === 0,\r\n        hasMetrics: trackMetrics,\r\n        hasResults: storeResults,\r\n      },\r\n      { namespace: 'command-history' },\r\n    );\r\n\r\n    console.log(`  ðŸ’¾ Command execution logged to .swarm/memory.db`);\r\n    printSuccess(`âœ… Post-bash hook completed`);\r\n  } catch (err) {\r\n    printError(`Post-bash hook failed: ${err.message}`);\r\n  }\r\n}\r\n\r\nasync function postSearchCommand(subArgs, flags) {\r\n  const options = flags;\r\n  const query = options.query || subArgs.slice(1).join(' ');\r\n  const resultCount = options['result-count'] || '0';\r\n  const searchType = options.type || 'general';\r\n\r\n  console.log(`ðŸ” Executing post-search hook...`);\r\n  console.log(`ðŸ”Ž Query: ${query}`);\r\n  console.log(`ðŸ“Š Results: ${resultCount}`);\r\n\r\n  try {\r\n    const store = await getMemoryStore();\r\n    const searchData = {\r\n      query,\r\n      resultCount: parseInt(resultCount),\r\n      searchType,\r\n      timestamp: new Date().toISOString(),\r\n      searchId: generateId('search'),\r\n    };\r\n\r\n    await store.store(`search:${searchData.searchId}`, searchData, {\r\n      namespace: 'hooks:post-search',\r\n      metadata: { hookType: 'post-search', query },\r\n    });\r\n\r\n    // Cache search for future use\r\n    await store.store(\r\n      `search-cache:${query}`,\r\n      {\r\n        resultCount: searchData.resultCount,\r\n        cachedAt: new Date().toISOString(),\r\n      },\r\n      { namespace: 'search-cache', ttl: 3600 },\r\n    ); // 1 hour TTL\r\n\r\n    console.log(`  ðŸ’¾ Search results cached to .swarm/memory.db`);\r\n    printSuccess(`âœ… Post-search hook completed`);\r\n  } catch (err) {\r\n    printError(`Post-search hook failed: ${err.message}`);\r\n  }\r\n}\r\n\r\n// ===== MCP INTEGRATION HOOKS =====\r\n\r\nasync function mcpInitializedCommand(subArgs, flags) {\r\n  const options = flags;\r\n  const serverName = options.server || 'claude-flow';\r\n  const sessionId = options['session-id'] || generateId('mcp-session');\r\n\r\n  console.log(`ðŸ”Œ Executing mcp-initialized hook...`);\r\n  console.log(`ðŸ’» Server: ${serverName}`);\r\n  console.log(`ðŸ†” Session: ${sessionId}`);\r\n\r\n  try {\r\n    const store = await getMemoryStore();\r\n    const mcpData = {\r\n      serverName,\r\n      sessionId,\r\n      initializedAt: new Date().toISOString(),\r\n      status: 'active',\r\n    };\r\n\r\n    await store.store(`mcp:${sessionId}`, mcpData, {\r\n      namespace: 'hooks:mcp-initialized',\r\n      metadata: { hookType: 'mcp-initialized', server: serverName },\r\n    });\r\n\r\n    console.log(`  ðŸ’¾ MCP session saved to .swarm/memory.db`);\r\n    printSuccess(`âœ… MCP initialized hook completed`);\r\n  } catch (err) {\r\n    printError(`MCP initialized hook failed: ${err.message}`);\r\n  }\r\n}\r\n\r\nasync function agentSpawnedCommand(subArgs, flags) {\r\n  const options = flags;\r\n  const agentType = options.type || 'generic';\r\n  const agentName = options.name || generateId('agent');\r\n  const swarmId = options['swarm-id'] || 'default';\r\n\r\n  console.log(`ðŸ¤– Executing agent-spawned hook...`);\r\n  console.log(`ðŸ“› Agent: ${agentName}`);\r\n  console.log(`ðŸ·ï¸  Type: ${agentType}`);\r\n\r\n  try {\r\n    const store = await getMemoryStore();\r\n    const agentData = {\r\n      agentName,\r\n      agentType,\r\n      swarmId,\r\n      spawnedAt: new Date().toISOString(),\r\n      status: 'active',\r\n    };\r\n\r\n    await store.store(`agent:${agentName}`, agentData, {\r\n      namespace: 'hooks:agent-spawned',\r\n      metadata: { hookType: 'agent-spawned', type: agentType },\r\n    });\r\n\r\n    // Update agent roster\r\n    await store.store(\r\n      `agent-roster:${Date.now()}`,\r\n      {\r\n        agentName,\r\n        action: 'spawned',\r\n        timestamp: new Date().toISOString(),\r\n      },\r\n      { namespace: 'agent-roster' },\r\n    );\r\n\r\n    console.log(`  ðŸ’¾ Agent registered to .swarm/memory.db`);\r\n    printSuccess(`âœ… Agent spawned hook completed`);\r\n  } catch (err) {\r\n    printError(`Agent spawned hook failed: ${err.message}`);\r\n  }\r\n}\r\n\r\nasync function taskOrchestratedCommand(subArgs, flags) {\r\n  const options = flags;\r\n  const taskId = options['task-id'] || generateId('orchestrated-task');\r\n  const strategy = options.strategy || 'balanced';\r\n  const priority = options.priority || 'medium';\r\n\r\n  console.log(`ðŸŽ­ Executing task-orchestrated hook...`);\r\n  console.log(`ðŸ†” Task: ${taskId}`);\r\n  console.log(`ðŸ“Š Strategy: ${strategy}`);\r\n\r\n  try {\r\n    const store = await getMemoryStore();\r\n    const orchestrationData = {\r\n      taskId,\r\n      strategy,\r\n      priority,\r\n      orchestratedAt: new Date().toISOString(),\r\n      status: 'orchestrated',\r\n    };\r\n\r\n    await store.store(`orchestration:${taskId}`, orchestrationData, {\r\n      namespace: 'hooks:task-orchestrated',\r\n      metadata: { hookType: 'task-orchestrated', strategy },\r\n    });\r\n\r\n    console.log(`  ðŸ’¾ Orchestration saved to .swarm/memory.db`);\r\n    printSuccess(`âœ… Task orchestrated hook completed`);\r\n  } catch (err) {\r\n    printError(`Task orchestrated hook failed: ${err.message}`);\r\n  }\r\n}\r\n\r\nasync function neuralTrainedCommand(subArgs, flags) {\r\n  const options = flags;\r\n  const modelName = options.model || 'default-neural';\r\n  const accuracy = options.accuracy || '0.0';\r\n  const patterns = options.patterns || '0';\r\n\r\n  console.log(`ðŸ§  Executing neural-trained hook...`);\r\n  console.log(`ðŸ¤– Model: ${modelName}`);\r\n  console.log(`ðŸ“Š Accuracy: ${accuracy}%`);\r\n\r\n  try {\r\n    const store = await getMemoryStore();\r\n    const trainingData = {\r\n      modelName,\r\n      accuracy: parseFloat(accuracy),\r\n      patternsLearned: parseInt(patterns),\r\n      trainedAt: new Date().toISOString(),\r\n    };\r\n\r\n    await store.store(`neural:${modelName}:${Date.now()}`, trainingData, {\r\n      namespace: 'hooks:neural-trained',\r\n      metadata: { hookType: 'neural-trained', model: modelName },\r\n    });\r\n\r\n    console.log(`  ðŸ’¾ Training results saved to .swarm/memory.db`);\r\n    printSuccess(`âœ… Neural trained hook completed`);\r\n  } catch (err) {\r\n    printError(`Neural trained hook failed: ${err.message}`);\r\n  }\r\n}\r\n\r\n// ===== SESSION HOOKS =====\r\n\r\nasync function sessionEndCommand(subArgs, flags) {\r\n  const options = flags;\r\n  const generateSummary = options['generate-summary'] !== 'false';\r\n  const persistState = options['persist-state'] !== 'false';\r\n  const exportMetrics = options['export-metrics'] || false;\r\n\r\n  console.log(`ðŸ”š Executing session-end hook...`);\r\n  if (generateSummary) console.log(`ðŸ“Š Summary generation: ENABLED`);\r\n  if (persistState) console.log(`ðŸ’¾ State persistence: ENABLED`);\r\n  if (exportMetrics) console.log(`ðŸ“ˆ Metrics export: ENABLED`);\r\n\r\n  try {\r\n    const store = await getMemoryStore();\r\n    const tasks = await store.list({ namespace: 'task-index', limit: 1000 });\r\n    const edits = await store.list({ namespace: 'file-history', limit: 1000 });\r\n    const commands = await store.list({ namespace: 'command-history', limit: 1000 });\r\n    const agents = await store.list({ namespace: 'agent-roster', limit: 1000 });\r\n\r\n    // Calculate session metrics\r\n    let metrics = null;\r\n    if (exportMetrics) {\r\n      const now = new Date();\r\n      const sessionStart = Math.min(\r\n        ...tasks.map((t) => new Date(t.value.timestamp || now).getTime()),\r\n        ...edits.map((e) => new Date(e.value.timestamp || now).getTime()),\r\n        ...commands.map((c) => new Date(c.value.timestamp || now).getTime()),\r\n      );\r\n\r\n      const duration = now.getTime() - sessionStart;\r\n      const successfulCommands = commands.filter((c) => c.value.success !== false).length;\r\n      const commandSuccessRate = commands.length > 0 ? successfulCommands / commands.length : 1;\r\n\r\n      metrics = {\r\n        sessionDuration: duration,\r\n        sessionDurationHuman: `${Math.round(duration / 1000 / 60)} minutes`,\r\n        totalTasks: tasks.length,\r\n        totalEdits: edits.length,\r\n        totalCommands: commands.length,\r\n        uniqueAgents: agents.length,\r\n        commandSuccessRate: Math.round(commandSuccessRate * 100),\r\n        avgTasksPerMinute: Math.round((tasks.length / (duration / 1000 / 60)) * 100) / 100,\r\n        avgEditsPerMinute: Math.round((edits.length / (duration / 1000 / 60)) * 100) / 100,\r\n        timestamp: now.toISOString(),\r\n      };\r\n    }\r\n\r\n    const sessionData = {\r\n      endedAt: new Date().toISOString(),\r\n      totalTasks: tasks.length,\r\n      totalEdits: edits.length,\r\n      totalCommands: commands.length,\r\n      uniqueAgents: agents.length,\r\n      sessionId: generateId('session'),\r\n      generateSummary,\r\n      persistState,\r\n      exportMetrics,\r\n      metrics,\r\n    };\r\n\r\n    await store.store(`session:${sessionData.sessionId}`, sessionData, {\r\n      namespace: 'sessions',\r\n      metadata: { hookType: 'session-end' },\r\n    });\r\n\r\n    // Persist detailed state if requested\r\n    if (persistState) {\r\n      const detailedState = {\r\n        sessionId: sessionData.sessionId,\r\n        tasks: tasks.slice(0, 100), // Limit to prevent memory issues\r\n        edits: edits.slice(0, 100),\r\n        commands: commands.slice(0, 100),\r\n        agents: agents.slice(0, 50),\r\n        persistedAt: new Date().toISOString(),\r\n        fullState: true,\r\n      };\r\n\r\n      await store.store(`session-state:${sessionData.sessionId}`, detailedState, {\r\n        namespace: 'session-states',\r\n        metadata: { type: 'full-state', sessionId: sessionData.sessionId },\r\n      });\r\n\r\n      console.log(`  ðŸ’¾ Full session state persisted`);\r\n    }\r\n\r\n    // Export metrics if requested\r\n    if (exportMetrics && metrics) {\r\n      await store.store(`session-metrics:${sessionData.sessionId}`, metrics, {\r\n        namespace: 'session-metrics',\r\n        metadata: { type: 'performance-metrics', sessionId: sessionData.sessionId },\r\n      });\r\n\r\n      console.log(`  ðŸ“ˆ Session metrics exported`);\r\n    }\r\n\r\n    if (generateSummary) {\r\n      console.log(`\\nðŸ“Š SESSION SUMMARY:`);\r\n      console.log(`  ðŸ“‹ Tasks: ${sessionData.totalTasks}`);\r\n      console.log(`  âœï¸  Edits: ${sessionData.totalEdits}`);\r\n      console.log(`  ðŸ”§ Commands: ${sessionData.totalCommands}`);\r\n      console.log(`  ðŸ¤– Agents: ${sessionData.uniqueAgents}`);\r\n\r\n      if (metrics) {\r\n        console.log(`  â±ï¸  Duration: ${metrics.sessionDurationHuman}`);\r\n        console.log(`  ðŸ“ˆ Success Rate: ${metrics.commandSuccessRate}%`);\r\n        console.log(`  ðŸƒ Tasks/min: ${metrics.avgTasksPerMinute}`);\r\n        console.log(`  âœï¸  Edits/min: ${metrics.avgEditsPerMinute}`);\r\n      }\r\n    }\r\n\r\n    console.log(`  ðŸ’¾ Session saved to .swarm/memory.db`);\r\n\r\n    if (memoryStore) {\r\n      memoryStore.close();\r\n      memoryStore = null;\r\n    }\r\n\r\n    printSuccess(`âœ… Session-end hook completed`);\r\n  } catch (err) {\r\n    printError(`Session-end hook failed: ${err.message}`);\r\n  }\r\n}\r\n\r\nasync function sessionRestoreCommand(subArgs, flags) {\r\n  const options = flags;\r\n  const sessionId = options['session-id'] || 'latest';\r\n\r\n  console.log(`ðŸ”„ Executing session-restore hook...`);\r\n  console.log(`ðŸ†” Session: ${sessionId}`);\r\n\r\n  try {\r\n    const store = await getMemoryStore();\r\n\r\n    // Find session to restore\r\n    let sessionData;\r\n    if (sessionId === 'latest') {\r\n      const sessions = await store.list({ namespace: 'sessions', limit: 1 });\r\n      sessionData = sessions[0]?.value;\r\n    } else {\r\n      sessionData = await store.retrieve(`session:${sessionId}`, { namespace: 'sessions' });\r\n    }\r\n\r\n    if (sessionData) {\r\n      console.log(`\\nðŸ“Š RESTORED SESSION:`);\r\n      console.log(`  ðŸ†” ID: ${sessionData.sessionId || 'unknown'}`);\r\n      console.log(`  ðŸ“‹ Tasks: ${sessionData.totalTasks || 0}`);\r\n      console.log(`  âœï¸  Edits: ${sessionData.totalEdits || 0}`);\r\n      console.log(`  â° Ended: ${sessionData.endedAt || 'unknown'}`);\r\n\r\n      // Store restoration event\r\n      await store.store(\r\n        `session-restore:${Date.now()}`,\r\n        {\r\n          restoredSessionId: sessionData.sessionId || sessionId,\r\n          restoredAt: new Date().toISOString(),\r\n        },\r\n        { namespace: 'session-events' },\r\n      );\r\n\r\n      console.log(`  ðŸ’¾ Session restored from .swarm/memory.db`);\r\n      printSuccess(`âœ… Session restore completed`);\r\n    } else {\r\n      printWarning(`No session found with ID: ${sessionId}`);\r\n    }\r\n  } catch (err) {\r\n    printError(`Session restore hook failed: ${err.message}`);\r\n  }\r\n}\r\n\r\nasync function notifyCommand(subArgs, flags) {\r\n  const options = flags;\r\n  const message = options.message || subArgs.slice(1).join(' ');\r\n  const level = options.level || 'info';\r\n  const swarmStatus = options['swarm-status'] || 'active';\r\n\r\n  console.log(`ðŸ“¢ Executing notify hook...`);\r\n  console.log(`ðŸ’¬ Message: ${message}`);\r\n  console.log(`ðŸ“Š Level: ${level}`);\r\n\r\n  try {\r\n    const store = await getMemoryStore();\r\n    const notificationData = {\r\n      message,\r\n      level,\r\n      swarmStatus,\r\n      timestamp: new Date().toISOString(),\r\n      notifyId: generateId('notify'),\r\n    };\r\n\r\n    await store.store(`notification:${notificationData.notifyId}`, notificationData, {\r\n      namespace: 'hooks:notify',\r\n      metadata: { hookType: 'notify', level },\r\n    });\r\n\r\n    // Display notification\r\n    const icon = level === 'error' ? 'âŒ' : level === 'warning' ? 'âš ï¸' : 'âœ…';\r\n    console.log(`\\n${icon} NOTIFICATION:`);\r\n    console.log(`  ${message}`);\r\n    console.log(`  ðŸ Swarm: ${swarmStatus}`);\r\n\r\n    console.log(`\\n  ðŸ’¾ Notification saved to .swarm/memory.db`);\r\n    printSuccess(`âœ… Notify hook completed`);\r\n  } catch (err) {\r\n    printError(`Notify hook failed: ${err.message}`);\r\n  }\r\n}\r\n\r\n// ===== PRETOOLUSE MODIFICATION HOOKS (v2.0.10+) =====\r\n\r\nasync function modifyBashCommand(subArgs, flags) {\r\n  // Read JSON from stdin with timeout to detect if data is piped\r\n  let input = '';\r\n  let hasInput = false;\r\n\r\n  const timeout = setTimeout(() => {\r\n    if (!hasInput) {\r\n      console.log('Usage: echo \\'{\"tool_input\":{\"command\":\"your command\"}}\\' | claude-flow hooks modify-bash');\r\n      console.log('\\nThis hook reads JSON from stdin and outputs modified JSON.');\r\n      console.log('It is designed for use with Claude Code v2.0.10+ PreToolUse feature.');\r\n      console.log('\\nExample:');\r\n      console.log('  echo \\'{\"tool_input\":{\"command\":\"rm test.txt\"}}\\' | claude-flow hooks modify-bash');\r\n      process.exit(0);\r\n    }\r\n  }, 100); // 100ms timeout\r\n\r\n  for await (const chunk of process.stdin) {\r\n    hasInput = true;\r\n    clearTimeout(timeout);\r\n    input += chunk;\r\n  }\r\n\r\n  if (!input.trim()) {\r\n    return; // Silently exit if no input\r\n  }\r\n\r\n  const toolInput = JSON.parse(input);\r\n  const command = toolInput.tool_input?.command || '';\r\n\r\n  if (!command) {\r\n    console.log(input); // Pass through if no command\r\n    return;\r\n  }\r\n\r\n  let modifiedCommand = command;\r\n  const notes = [];\r\n\r\n  // 1. Safety: Add -i flag to rm commands\r\n  if (/^rm\\s/.test(command) && !/-[iI]/.test(command)) {\r\n    modifiedCommand = command.replace(/^rm /, 'rm -i ');\r\n    notes.push('[Safety: Added -i flag for interactive confirmation]');\r\n  }\r\n\r\n  // 2. Aliases\r\n  if (/^ll(\\s|$)/.test(command)) {\r\n    modifiedCommand = command.replace(/^ll/, 'ls -lah');\r\n    notes.push('[Alias: ll â†’ ls -lah]');\r\n  } else if (/^la(\\s|$)/.test(command)) {\r\n    modifiedCommand = command.replace(/^la/, 'ls -la');\r\n    notes.push('[Alias: la â†’ ls -la]');\r\n  }\r\n\r\n  // 3. Path correction: Redirect test files to /tmp\r\n  if (/>\\s*test.*\\.(txt|log|tmp|json|md)/.test(command) && !/\\/tmp\\//.test(command)) {\r\n    modifiedCommand = command.replace(/>\\s*(test[^/]*\\.(txt|log|tmp|json|md))/, '> /tmp/$1');\r\n    notes.push('[Path: Redirected test file to /tmp/]');\r\n  }\r\n\r\n  // 4. Secret detection\r\n  if (/(password|secret|token|api[-_]?key|auth)/i.test(command) && !/#\\s*SECRETS_OK/.test(command)) {\r\n    notes.push('[Security: Command contains sensitive keywords. Add \"# SECRETS_OK\" to bypass]');\r\n  }\r\n\r\n  // Output modified JSON\r\n  const output = {\r\n    ...toolInput,\r\n    tool_input: {\r\n      ...toolInput.tool_input,\r\n      command: modifiedCommand,\r\n    },\r\n  };\r\n\r\n  if (notes.length > 0) {\r\n    output.modification_notes = notes.join(' ');\r\n  }\r\n\r\n  console.log(JSON.stringify(output, null, 2));\r\n}\r\n\r\nasync function modifyFileCommand(subArgs, flags) {\r\n  // Read JSON from stdin with timeout to detect if data is piped\r\n  let input = '';\r\n  let hasInput = false;\r\n\r\n  const timeout = setTimeout(() => {\r\n    if (!hasInput) {\r\n      console.log('Usage: echo \\'{\"tool_input\":{\"file_path\":\"your/file.js\"}}\\' | claude-flow hooks modify-file');\r\n      console.log('\\nThis hook reads JSON from stdin and outputs modified JSON.');\r\n      console.log('It is designed for use with Claude Code v2.0.10+ PreToolUse feature.');\r\n      console.log('\\nExample:');\r\n      console.log('  echo \\'{\"tool_input\":{\"file_path\":\"test.js\"}}\\' | claude-flow hooks modify-file');\r\n      process.exit(0);\r\n    }\r\n  }, 100); // 100ms timeout\r\n\r\n  for await (const chunk of process.stdin) {\r\n    hasInput = true;\r\n    clearTimeout(timeout);\r\n    input += chunk;\r\n  }\r\n\r\n  if (!input.trim()) {\r\n    return; // Silently exit if no input\r\n  }\r\n\r\n  const toolInput = JSON.parse(input);\r\n  const filePath = toolInput.tool_input?.file_path || toolInput.tool_input?.path || '';\r\n\r\n  if (!filePath) {\r\n    console.log(input); // Pass through if no file path\r\n    return;\r\n  }\r\n\r\n  let modifiedPath = filePath;\r\n  let shouldModify = false;\r\n  const notes = [];\r\n\r\n  // 1. Root folder protection\r\n  const isRootFile = /^[^/]*\\.(js|ts|jsx|tsx|py|java|go|rs|cpp|c|h)$/.test(filePath) ||\r\n                     /^test.*\\.(txt|log|tmp|json|md)$/.test(filePath) ||\r\n                     /^(temp|tmp|working)/.test(filePath);\r\n\r\n  if (isRootFile) {\r\n    if (/test.*\\.(test|spec)\\.|\\.test\\.|\\.spec\\./.test(filePath)) {\r\n      modifiedPath = `tests/${filePath}`;\r\n      shouldModify = true;\r\n      notes.push('[Organization: Moved test file to /tests/]');\r\n    } else if (/test.*\\.md|temp.*\\.md|working.*\\.md|scratch.*\\.md/.test(filePath)) {\r\n      modifiedPath = `docs/working/${filePath}`;\r\n      shouldModify = true;\r\n      notes.push('[Organization: Moved working document to /docs/working/]');\r\n    } else if (/\\.(js|ts|jsx|tsx|py)$/.test(filePath)) {\r\n      modifiedPath = `src/${filePath}`;\r\n      shouldModify = true;\r\n      notes.push('[Organization: Moved source file to /src/]');\r\n    } else if (/^(temp|tmp|scratch)/.test(filePath)) {\r\n      modifiedPath = `/tmp/${filePath}`;\r\n      shouldModify = true;\r\n      notes.push('[Organization: Redirected temporary file to /tmp/]');\r\n    }\r\n  }\r\n\r\n  // 2. Format hints\r\n  if (/\\.(ts|tsx|js|jsx)$/.test(modifiedPath)) {\r\n    notes.push('[Tip: Auto-format with Prettier/ESLint recommended]');\r\n  } else if (/\\.py$/.test(modifiedPath)) {\r\n    notes.push('[Tip: Auto-format with Black/autopep8 recommended]');\r\n  }\r\n\r\n  // Output modified JSON\r\n  const output = {\r\n    ...toolInput,\r\n    tool_input: {\r\n      ...toolInput.tool_input,\r\n    },\r\n  };\r\n\r\n  if (shouldModify) {\r\n    if (toolInput.tool_input.file_path) {\r\n      output.tool_input.file_path = modifiedPath;\r\n    } else {\r\n      output.tool_input.path = modifiedPath;\r\n    }\r\n  }\r\n\r\n  if (notes.length > 0) {\r\n    output.modification_notes = notes.join(' ');\r\n  }\r\n\r\n  console.log(JSON.stringify(output, null, 2));\r\n}\r\n\r\nasync function modifyGitCommitCommand(subArgs, flags) {\r\n  // Read JSON from stdin with timeout to detect if data is piped\r\n  let input = '';\r\n  let hasInput = false;\r\n\r\n  const timeout = setTimeout(() => {\r\n    if (!hasInput) {\r\n      console.log('Usage: echo \\'{\"tool_input\":{\"command\":\"git commit -m \\\\\"message\\\\\"\"}}\\'  | claude-flow hooks modify-git-commit');\r\n      console.log('\\nThis hook reads JSON from stdin and outputs modified JSON.');\r\n      console.log('It is designed for use with Claude Code v2.0.10+ PreToolUse feature.');\r\n      console.log('\\nExample:');\r\n      console.log('  echo \\'{\"tool_input\":{\"command\":\"git commit -m \\\\\"fix bug\\\\\"\"}}\\'  | claude-flow hooks modify-git-commit');\r\n      process.exit(0);\r\n    }\r\n  }, 100); // 100ms timeout\r\n\r\n  for await (const chunk of process.stdin) {\r\n    hasInput = true;\r\n    clearTimeout(timeout);\r\n    input += chunk;\r\n  }\r\n\r\n  if (!input.trim()) {\r\n    return; // Silently exit if no input\r\n  }\r\n\r\n  const toolInput = JSON.parse(input);\r\n  const command = toolInput.tool_input?.command || '';\r\n\r\n  if (!command || !/git commit/.test(command)) {\r\n    console.log(input); // Pass through if not git commit\r\n    return;\r\n  }\r\n\r\n  // Extract commit message\r\n  const msgMatch = command.match(/-m\\s+[\"']([^\"']+)[\"']/) || command.match(/-m\\s+(\\S+)/);\r\n  const commitMsg = msgMatch ? msgMatch[1] : '';\r\n\r\n  if (!commitMsg || /^\\[(feat|fix|docs|style|refactor|test|chore|perf)\\]/.test(commitMsg)) {\r\n    console.log(input); // Already formatted or no message\r\n    return;\r\n  }\r\n\r\n  const notes = [];\r\n\r\n  // Get current branch\r\n  let branch = 'main';\r\n  let ticket = '';\r\n  try {\r\n    const { execSync } = await import('child_process');\r\n    branch = execSync('git rev-parse --abbrev-ref HEAD', { encoding: 'utf8' }).trim();\r\n\r\n    // Extract JIRA ticket\r\n    const ticketMatch = branch.match(/[A-Z]+-[0-9]+/);\r\n    if (ticketMatch) {\r\n      ticket = ticketMatch[0];\r\n    }\r\n  } catch {\r\n    // Git not available, continue\r\n  }\r\n\r\n  // Detect conventional commit type\r\n  let type = 'chore';\r\n  if (/^(add|implement|create|new)/i.test(commitMsg)) type = 'feat';\r\n  else if (/^(fix|resolve|patch|correct)/i.test(commitMsg)) type = 'fix';\r\n  else if (/^(update|modify|change|improve)/i.test(commitMsg)) type = 'refactor';\r\n  else if (/^(doc|documentation|readme)/i.test(commitMsg)) type = 'docs';\r\n  else if (/^(test|testing|spec)/i.test(commitMsg)) type = 'test';\r\n  else if (/^(style|format|lint)/i.test(commitMsg)) type = 'style';\r\n  else if (/^(perf|optimize|speed)/i.test(commitMsg)) type = 'perf';\r\n\r\n  // Format message\r\n  let formattedMsg = ticket\r\n    ? `[${type}] ${commitMsg} (${ticket})`\r\n    : `[${type}] ${commitMsg}`;\r\n\r\n  // Add co-author\r\n  if (!/Co-Authored-By/.test(command)) {\r\n    formattedMsg += `\\n\\nðŸ¤– Generated with Claude Flow\\nCo-Authored-By: claude-flow <noreply@ruv.io>`;\r\n  }\r\n\r\n  // Replace message in command\r\n  const modifiedCommand = command.replace(\r\n    /-m\\s+[\"'][^\"']+[\"']|-m\\s+\\S+/,\r\n    `-m \"$(cat <<'EOF'\\n${formattedMsg}\\nEOF\\n)\"`\r\n  );\r\n\r\n  notes.push(`[Auto-formatted: ${type} type${ticket ? ` + ${ticket}` : ''}]`);\r\n\r\n  // Output modified JSON\r\n  const output = {\r\n    ...toolInput,\r\n    tool_input: {\r\n      ...toolInput.tool_input,\r\n      command: modifiedCommand,\r\n    },\r\n    modification_notes: notes.join(' '),\r\n  };\r\n\r\n  console.log(JSON.stringify(output, null, 2));\r\n}\r\n\r\nfunction showHooksHelp() {\r\n  console.log('Claude Flow Hooks (with .swarm/memory.db persistence):\\n');\r\n\r\n  console.log('Pre-Operation Hooks:');\r\n  console.log('  pre-task        Execute before starting a task');\r\n  console.log('  pre-edit        Validate before file modifications');\r\n  console.log('                  --auto-assign-agents  Auto-assign agents based on file type');\r\n  console.log('                  --load-context        Load file context');\r\n  console.log('  pre-bash        Check command safety (alias: pre-command)');\r\n  console.log('  pre-command     Same as pre-bash');\r\n  console.log('                  --validate-safety     Enable safety validation');\r\n  console.log('                  --prepare-resources   Prepare execution resources');\r\n\r\n  console.log('\\nPost-Operation Hooks:');\r\n  console.log('  post-task       Execute after completing a task');\r\n  console.log('  post-edit       Auto-format and log edits');\r\n  console.log('                  --format              Auto-format code');\r\n  console.log('                  --update-memory       Update agent memory');\r\n  console.log('                  --train-neural        Train neural patterns');\r\n  console.log('  post-bash       Log command execution (alias: post-command)');\r\n  console.log('  post-command    Same as post-bash');\r\n  console.log('                  --track-metrics       Track performance metrics');\r\n  console.log('                  --store-results       Store detailed results');\r\n  console.log('  post-search     Cache search results');\r\n\r\n  console.log('\\nMCP Integration Hooks:');\r\n  console.log('  mcp-initialized    Persist MCP configuration');\r\n  console.log('  agent-spawned      Update agent roster');\r\n  console.log('  task-orchestrated  Monitor task progress');\r\n  console.log('  neural-trained     Save pattern improvements');\r\n\r\n  console.log('\\nSession Hooks:');\r\n  console.log('  session-end        Generate summary and save state');\r\n  console.log('                     --generate-summary    Generate session summary');\r\n  console.log('                     --persist-state       Persist session state');\r\n  console.log('                     --export-metrics      Export performance metrics');\r\n  console.log('  session-restore    Load previous session state');\r\n  console.log('  notify             Custom notifications');\r\n\r\n  console.log('\\n===== NEW: PreToolUse Modification Hooks (v2.0.10+) =====');\r\n  console.log('  modify-bash        Modify Bash tool inputs (reads/writes JSON via stdin/stdout)');\r\n  console.log('                     â€¢ Safety: Adds -i flag to rm commands');\r\n  console.log('                     â€¢ Aliases: ll â†’ ls -lah, la â†’ ls -la');\r\n  console.log('                     â€¢ Path correction: Redirects test files to /tmp');\r\n  console.log('                     â€¢ Secret detection: Warns about sensitive keywords');\r\n  console.log('');\r\n  console.log('  modify-file        Modify Write/Edit tool inputs (reads/writes JSON via stdin/stdout)');\r\n  console.log('                     â€¢ Root folder protection: Moves files to appropriate directories');\r\n  console.log('                     â€¢ Organization: Tests â†’ /tests/, Sources â†’ /src/, Docs â†’ /docs/');\r\n  console.log('                     â€¢ Format hints: Suggests Prettier, Black, etc.');\r\n  console.log('');\r\n  console.log('  modify-git-commit  Modify git commit messages (reads/writes JSON via stdin/stdout)');\r\n  console.log('                     â€¢ Conventional commits: Auto-adds [feat], [fix], [docs], etc.');\r\n  console.log('                     â€¢ Ticket extraction: Extracts JIRA tickets from branch names');\r\n  console.log('                     â€¢ Co-author: Adds Claude Flow co-author footer');\r\n\r\n  console.log('\\nExamples:');\r\n  console.log('  hooks pre-command --command \"npm test\" --validate-safety true');\r\n  console.log('  hooks pre-edit --file \"src/app.js\" --auto-assign-agents true');\r\n  console.log('  hooks post-command --command \"build\" --track-metrics true');\r\n  console.log('  hooks post-edit --file \"src/app.js\" --format true --train-neural true');\r\n  console.log('  hooks session-end --generate-summary true --export-metrics true');\r\n  console.log('  hooks agent-spawned --name \"CodeReviewer\" --type \"reviewer\"');\r\n  console.log('  hooks notify --message \"Build completed\" --level \"success\"');\r\n  console.log('');\r\n  console.log('  # New modification hooks (stdin/stdout JSON):');\r\n  console.log('  echo \\'{\"tool_input\":{\"command\":\"rm test.txt\"}}\\' | hooks modify-bash');\r\n  console.log('  echo \\'{\"tool_input\":{\"file_path\":\"test.js\"}}\\' | hooks modify-file');\r\n  console.log('  echo \\'{\"tool_input\":{\"command\":\"git commit -m \\\\\"fix bug\\\\\"\"}}\\' | hooks modify-git-commit');\r\n\r\n  console.log('\\nCompatibility:');\r\n  console.log('  â€¢ pre-command and pre-bash are aliases');\r\n  console.log('  â€¢ post-command and post-bash are aliases');\r\n  console.log('  â€¢ Both --dash-case and camelCase parameters supported');\r\n  console.log('  â€¢ All parameters from settings.json template supported');\r\n  console.log('  â€¢ New modification hooks work with Claude Code v2.0.10+ PreToolUse feature');\r\n}\r\n\r\nexport default hooksAction;\r\n"],"names":["printSuccess","printError","printWarning","execRuvSwarmHook","checkRuvSwarmAvailable","SqliteMemoryStore","memoryStore","getMemoryStore","initialize","generateId","prefix","Date","now","Math","random","toString","substr","hooksAction","subArgs","flags","subcommand","options","help","h","showHooksHelp","preTaskCommand","preEditCommand","preBashCommand","postTaskCommand","postEditCommand","postBashCommand","postSearchCommand","mcpInitializedCommand","agentSpawnedCommand","taskOrchestratedCommand","neuralTrainedCommand","sessionEndCommand","sessionRestoreCommand","notifyCommand","modifyBashCommand","modifyFileCommand","modifyGitCommitCommand","err","message","description","taskId","agentId","autoSpawnAgents","console","log","store","taskData","status","startedAt","toISOString","namespace","metadata","hookType","timestamp","checkPromise","timeoutPromise","Promise","_","reject","setTimeout","Error","isAvailable","race","hookResult","success","output","close","process","exit","file","operation","autoAssignAgents","loadContext","assignedAgentType","recommendedAgent","path","ext","extname","toLowerCase","agentMapping","type","extension","recommended","contextData","fs","existsSync","stats","statSync","dirname","basename","fileExists","size","modified","mtime","directory","filename","isDirectory","willCreate","error","editData","editId","agentType","ttl","command","slice","join","workingDir","cwd","validateSafety","validate","prepareResources","safetyResult","dangerousCommands","isDangerous","length","some","dangerous","includes","mkdirSync","recursive","bashData","bashId","safety","validationEnabled","resourcesPrepped","toUpperCase","analyzePerformance","retrieve","completedData","completedAt","duration","getTime","metrics","durationHuman","toFixed","memoryKey","format","updateMemory","trainNeural","formatResult","formatters","formatter","attempted","reason","memoryUpdate","editContext","editedAt","formatted","fileSize","neuralTraining","editTime","patterns","fileType","fileName","confidence","enhanced","historyKey","replace","features","exitCode","trackMetrics","storeResults","startTime","commandLength","outputLength","parseInt","complexity","substring","fullOutput","existingMetrics","totalCommands","successRate","avgDuration","lastUpdated","hasMetrics","hasResults","query","resultCount","searchType","searchData","searchId","cachedAt","serverName","server","sessionId","mcpData","initializedAt","agentName","name","swarmId","agentData","spawnedAt","action","strategy","priority","orchestrationData","orchestratedAt","modelName","model","accuracy","trainingData","parseFloat","patternsLearned","trainedAt","generateSummary","persistState","exportMetrics","tasks","list","limit","edits","commands","agents","sessionStart","min","map","t","value","e","c","successfulCommands","filter","commandSuccessRate","sessionDuration","sessionDurationHuman","round","totalTasks","totalEdits","uniqueAgents","avgTasksPerMinute","avgEditsPerMinute","sessionData","endedAt","detailedState","persistedAt","fullState","sessions","restoredSessionId","restoredAt","level","swarmStatus","notificationData","notifyId","icon","input","hasInput","timeout","chunk","stdin","clearTimeout","trim","toolInput","JSON","parse","tool_input","modifiedCommand","notes","test","push","modification_notes","stringify","filePath","file_path","modifiedPath","shouldModify","isRootFile","msgMatch","match","commitMsg","branch","ticket","execSync","encoding","ticketMatch","formattedMsg"],"mappings":"AAAA,SACEA,YAAY,EACZC,UAAU,EACVC,YAAY,EACZC,gBAAgB,EAChBC,sBAAsB,QACjB,cAAc;AACrB,SAASC,iBAAiB,QAAQ,+BAA+B;AAGjE,IAAIC,cAAc;AAElB,eAAeC;IACb,IAAI,CAACD,aAAa;QAChBA,cAAc,IAAID;QAClB,MAAMC,YAAYE,UAAU;IAC9B;IACA,OAAOF;AACT;AAGA,SAASG,WAAWC,SAAS,IAAI;IAC/B,OAAO,GAAGA,OAAO,CAAC,EAAEC,KAAKC,GAAG,GAAG,CAAC,EAAEC,KAAKC,MAAM,GAAGC,QAAQ,CAAC,IAAIC,MAAM,CAAC,GAAG,IAAI;AAC7E;AAEA,OAAO,eAAeC,YAAYC,OAAO,EAAEC,KAAK;IAC9C,MAAMC,aAAaF,OAAO,CAAC,EAAE;IAC7B,MAAMG,UAAUF;IAEhB,IAAIE,QAAQC,IAAI,IAAID,QAAQE,CAAC,IAAI,CAACH,YAAY;QAC5CI;QACA;IACF;IAEA,IAAI;QACF,OAAQJ;YAEN,KAAK;gBACH,MAAMK,eAAeP,SAASC;gBAC9B;YACF,KAAK;gBACH,MAAMO,eAAeR,SAASC;gBAC9B;YACF,KAAK;YACL,KAAK;gBACH,MAAMQ,eAAeT,SAASC;gBAC9B;YAGF,KAAK;gBACH,MAAMS,gBAAgBV,SAASC;gBAC/B;YACF,KAAK;gBACH,MAAMU,gBAAgBX,SAASC;gBAC/B;YACF,KAAK;YACL,KAAK;gBACH,MAAMW,gBAAgBZ,SAASC;gBAC/B;YACF,KAAK;gBACH,MAAMY,kBAAkBb,SAASC;gBACjC;YAGF,KAAK;gBACH,MAAMa,sBAAsBd,SAASC;gBACrC;YACF,KAAK;gBACH,MAAMc,oBAAoBf,SAASC;gBACnC;YACF,KAAK;gBACH,MAAMe,wBAAwBhB,SAASC;gBACvC;YACF,KAAK;gBACH,MAAMgB,qBAAqBjB,SAASC;gBACpC;YAGF,KAAK;gBACH,MAAMiB,kBAAkBlB,SAASC;gBACjC;YACF,KAAK;gBACH,MAAMkB,sBAAsBnB,SAASC;gBACrC;YACF,KAAK;gBACH,MAAMmB,cAAcpB,SAASC;gBAC7B;YAGF,KAAK;gBACH,MAAMoB,kBAAkBrB,SAASC;gBACjC;YACF,KAAK;gBACH,MAAMqB,kBAAkBtB,SAASC;gBACjC;YACF,KAAK;gBACH,MAAMsB,uBAAuBvB,SAASC;gBACtC;YAEF;gBACElB,WAAW,CAAC,uBAAuB,EAAEmB,YAAY;gBACjDI;QACJ;IACF,EAAE,OAAOkB,KAAK;QACZzC,WAAW,CAAC,sBAAsB,EAAEyC,IAAIC,OAAO,EAAE;IACnD;AACF;AAIA,eAAelB,eAAeP,OAAO,EAAEC,KAAK;IAC1C,MAAME,UAAUF;IAChB,MAAMyB,cAAcvB,QAAQuB,WAAW,IAAI;IAC3C,MAAMC,SAASxB,OAAO,CAAC,UAAU,IAAIA,QAAQwB,MAAM,IAAIpC,WAAW;IAClE,MAAMqC,UAAUzB,OAAO,CAAC,WAAW,IAAIA,QAAQyB,OAAO;IACtD,MAAMC,kBAAkB1B,OAAO,CAAC,oBAAoB,KAAK;IAEzD2B,QAAQC,GAAG,CAAC,CAAC,6BAA6B,CAAC;IAC3CD,QAAQC,GAAG,CAAC,CAAC,SAAS,EAAEL,aAAa;IACrCI,QAAQC,GAAG,CAAC,CAAC,YAAY,EAAEJ,QAAQ;IACnC,IAAIC,SAASE,QAAQC,GAAG,CAAC,CAAC,UAAU,EAAEH,SAAS;IAE/C,IAAI;QACF,MAAMI,QAAQ,MAAM3C;QACpB,MAAM4C,WAAW;YACfN;YACAD;YACAE;YACAC;YACAK,QAAQ;YACRC,WAAW,IAAI1C,OAAO2C,WAAW;QACnC;QAEA,MAAMJ,MAAMA,KAAK,CAAC,CAAC,KAAK,EAAEL,QAAQ,EAAEM,UAAU;YAC5CI,WAAW;YACXC,UAAU;gBAAEC,UAAU;gBAAYX;YAAQ;QAC5C;QAEA,MAAMI,MAAMA,KAAK,CACf,CAAC,WAAW,EAAEvC,KAAKC,GAAG,IAAI,EAC1B;YACEiC;YACAD;YACAc,WAAW,IAAI/C,OAAO2C,WAAW;QACnC,GACA;YAAEC,WAAW;QAAa;QAG5BP,QAAQC,GAAG,CAAC,CAAC,8BAA8B,CAAC;QAG5C,IAAI;YACF,MAAMU,eAAevD;YACrB,MAAMwD,iBAAiB,IAAIC,QAAQ,CAACC,GAAGC,SACrCC,WAAW,IAAMD,OAAO,IAAIE,MAAM,aAAa;YAGjD,MAAMC,cAAc,MAAML,QAAQM,IAAI,CAAC;gBAACR;gBAAcC;aAAe;YAErE,IAAIM,aAAa;gBACflB,QAAQC,GAAG,CAAC,CAAC,yCAAyC,CAAC;gBACvD,MAAMmB,aAAa,MAAMjE,iBAAiB,YAAY;oBACpDyC;oBACA,WAAWC;oBACX,qBAAqBE;oBACrB,GAAID,UAAU;wBAAE,YAAYA;oBAAQ,IAAI,CAAC,CAAC;gBAC5C;gBAEA,IAAIsB,WAAWC,OAAO,EAAE;oBACtB,MAAMnB,MAAMA,KAAK,CACf,CAAC,KAAK,EAAEL,OAAO,WAAW,CAAC,EAC3B;wBACEyB,QAAQF,WAAWE,MAAM;wBACzBZ,WAAW,IAAI/C,OAAO2C,WAAW;oBACnC,GACA;wBAAEC,WAAW;oBAAkB;oBAGjCvD,aAAa,CAAC,sCAAsC,CAAC;gBACvD;YACF;QACF,EAAE,OAAO0C,KAAK;YAEZM,QAAQC,GAAG,CAAC,CAAC,+BAA+B,EAAEP,IAAIC,OAAO,CAAC,CAAC,CAAC;QAC9D;QAEAK,QAAQC,GAAG,CAAC,CAAC,8BAA8B,CAAC;QAG5C,IAAI3C,eAAeA,YAAYiE,KAAK,EAAE;YACpCjE,YAAYiE,KAAK;QACnB;QAGAP,WAAW;YACTQ,QAAQC,IAAI,CAAC;QACf,GAAG;IACL,EAAE,OAAO/B,KAAK;QACZzC,WAAW,CAAC,sBAAsB,EAAEyC,IAAIC,OAAO,EAAE;QAGjD,IAAIrC,eAAeA,YAAYiE,KAAK,EAAE;YACpCjE,YAAYiE,KAAK;QACnB;QAGAP,WAAW;YACTQ,QAAQC,IAAI,CAAC;QACf,GAAG;IACL;AACF;AAEA,eAAe/C,eAAeR,OAAO,EAAEC,KAAK;IAC1C,MAAME,UAAUF;IAChB,MAAMuD,OAAOrD,QAAQqD,IAAI,IAAI;IAC7B,MAAMC,YAAYtD,QAAQsD,SAAS,IAAI;IACvC,MAAMC,mBAAmBvD,OAAO,CAAC,qBAAqB,IAAI;IAC1D,MAAMwD,cAAcxD,OAAO,CAAC,eAAe,IAAI;IAE/C2B,QAAQC,GAAG,CAAC,CAAC,6BAA6B,CAAC;IAC3CD,QAAQC,GAAG,CAAC,CAAC,SAAS,EAAEyB,MAAM;IAC9B1B,QAAQC,GAAG,CAAC,CAAC,eAAe,EAAE0B,WAAW;IACzC,IAAIC,kBAAkB5B,QAAQC,GAAG,CAAC,CAAC,8BAA8B,CAAC;IAClE,IAAI4B,aAAa7B,QAAQC,GAAG,CAAC,CAAC,wBAAwB,CAAC;IAEvD,IAAI;QACF,MAAMC,QAAQ,MAAM3C;QAGpB,IAAIuE,oBAAoB;QACxB,IAAIC,mBAAmB;QAEvB,IAAIH,kBAAkB;YACpB,MAAMI,OAAO,MAAM,MAAM,CAAC;YAC1B,MAAMC,MAAMD,KAAKE,OAAO,CAACR,MAAMS,WAAW;YAE1C,MAAMC,eAAe;gBACnB,OAAO;gBACP,OAAO;gBACP,OAAO;gBACP,OAAO;gBACP,OAAO;gBACP,SAAS;gBACT,QAAQ;gBACR,MAAM;gBACN,QAAQ;gBACR,SAAS;gBACT,QAAQ;gBACR,UAAU;gBACV,OAAO;gBACP,QAAQ;gBACR,SAAS;gBACT,SAAS;gBACT,QAAQ;gBACR,OAAO;gBACP,eAAe;YACjB;YAEAN,oBAAoBM,YAAY,CAACH,IAAI,IAAI;YACzCF,mBAAmB;gBACjBM,MAAMP;gBACNJ,MAAMA;gBACNY,WAAWL;gBACXM,aAAa;YACf;YAEAvC,QAAQC,GAAG,CAAC,CAAC,wBAAwB,EAAE6B,mBAAmB;QAC5D;QAGA,IAAIU,cAAc;QAClB,IAAIX,aAAa;YACf,IAAI;gBAEF,MAAMY,KAAK,MAAM,MAAM,CAAC;gBACxB,MAAMT,OAAO,MAAM,MAAM,CAAC;gBAE1B,IAAIS,GAAGC,UAAU,CAAChB,OAAO;oBACvB,MAAMiB,QAAQF,GAAGG,QAAQ,CAAClB;oBAC1B,MAAMmB,UAAUb,KAAKa,OAAO,CAACnB;oBAC7B,MAAMoB,WAAWd,KAAKc,QAAQ,CAACpB;oBAE/Bc,cAAc;wBACZO,YAAY;wBACZC,MAAML,MAAMK,IAAI;wBAChBC,UAAUN,MAAMO,KAAK;wBACrBC,WAAWN;wBACXO,UAAUN;wBACVO,aAAaV,MAAMU,WAAW;oBAChC;oBAEArD,QAAQC,GAAG,CAAC,CAAC,qBAAqB,EAAE6C,SAAS,EAAE,EAAEH,MAAMK,IAAI,CAAC,OAAO,CAAC;gBACtE,OAAO;oBACLR,cAAc;wBACZO,YAAY;wBACZO,YAAY;wBACZH,WAAWnB,KAAKa,OAAO,CAACnB;wBACxB0B,UAAUpB,KAAKc,QAAQ,CAACpB;oBAC1B;oBACA1B,QAAQC,GAAG,CAAC,CAAC,sCAAsC,CAAC;gBACtD;YACF,EAAE,OAAOP,KAAK;gBACZM,QAAQC,GAAG,CAAC,CAAC,0CAA0C,EAAEyB,MAAM;gBAC/Dc,cAAc;oBAAEe,OAAO7D,IAAIC,OAAO;gBAAC;YACrC;QACF;QAEA,MAAM6D,WAAW;YACf9B;YACAC;YACAjB,WAAW,IAAI/C,OAAO2C,WAAW;YACjCmD,QAAQhG,WAAW;YACnBmE;YACAC;YACAC;YACAC;YACAS;QACF;QAEA,MAAMtC,MAAMA,KAAK,CAAC,CAAC,KAAK,EAAEsD,SAASC,MAAM,CAAC,IAAI,CAAC,EAAED,UAAU;YACzDjD,WAAW;YACXC,UAAU;gBAAEC,UAAU;gBAAYiB;gBAAMgC,WAAW5B;YAAkB;QACvE;QAGA,IAAIF,oBAAoBG,kBAAkB;YACxC,MAAM7B,MAAMA,KAAK,CAAC,CAAC,qBAAqB,EAAEwB,MAAM,EAAEK,kBAAkB;gBAClExB,WAAW;gBACXoD,KAAK;YACP;QACF;QAEA3D,QAAQC,GAAG,CAAC,CAAC,6CAA6C,CAAC;QAC3DjD,aAAa,CAAC,yBAAyB,CAAC;IAC1C,EAAE,OAAO0C,KAAK;QACZzC,WAAW,CAAC,sBAAsB,EAAEyC,IAAIC,OAAO,EAAE;IACnD;AACF;AAEA,eAAehB,eAAeT,OAAO,EAAEC,KAAK;IAC1C,MAAME,UAAUF;IAChB,MAAMyF,UAAUvF,QAAQuF,OAAO,IAAI1F,QAAQ2F,KAAK,CAAC,GAAGC,IAAI,CAAC,QAAQ;IACjE,MAAMC,aAAa1F,QAAQ2F,GAAG,IAAIxC,QAAQwC,GAAG;IAC7C,MAAMC,iBAAiB5F,OAAO,CAAC,kBAAkB,KAAK,QAAQA,OAAO,CAAC,kBAAkB,KAAK,UAAUA,QAAQ6F,QAAQ,KAAK,QAAQ7F,QAAQ6F,QAAQ,KAAK,UAAU;IACnK,MAAMC,mBAAmB9F,OAAO,CAAC,oBAAoB,KAAK,QAAQA,OAAO,CAAC,oBAAoB,KAAK,UAAU;IAE7G2B,QAAQC,GAAG,CAAC,CAAC,6BAA6B,CAAC;IAC3CD,QAAQC,GAAG,CAAC,CAAC,YAAY,EAAE2D,SAAS;IACpC5D,QAAQC,GAAG,CAAC,CAAC,gBAAgB,EAAE8D,YAAY;IAC3C,IAAIE,gBAAgBjE,QAAQC,GAAG,CAAC,CAAC,6BAA6B,CAAC;IAC/D,IAAIkE,kBAAkBnE,QAAQC,GAAG,CAAC,CAAC,kCAAkC,CAAC;IAEtE,IAAI;QACF,MAAMC,QAAQ,MAAM3C;QACpB,IAAI6G,eAAe;QAEnB,IAAIH,gBAAgB;YAElB,MAAMI,oBAAoB;gBACxB;gBACA;gBACA;gBACA;gBACA;gBACA;gBACA;gBACA;gBACA;gBACA;gBACA;aACD;YAED,MAAMC,cAAcV,WAAW,OAAOA,YAAY,YAAYA,QAAQW,MAAM,GAAG,IAC3EF,kBAAkBG,IAAI,CAAC,CAACC,YACtBb,QAAQzB,WAAW,GAAGuC,QAAQ,CAACD,UAAUtC,WAAW,OAEtD;YAEJiC,eAAeE,cAAc,cAAc;YAE3C,IAAIA,aAAa;gBACftE,QAAQC,GAAG,CAAC,CAAC,8CAA8C,CAAC;gBAC5DD,QAAQC,GAAG,CAAC,CAAC,+BAA+B,CAAC;gBAC7ChD,WAAW,CAAC,0CAA0C,EAAE2G,SAAS;gBACjE;YACF;QACF;QAEA,IAAIO,kBAAkB;YAEpB,MAAM1B,KAAK,MAAM,MAAM,CAAC;YACxB,MAAMT,OAAO,MAAM,MAAM,CAAC;YAE1B,IAAI,CAACS,GAAGC,UAAU,CAACqB,aAAa;gBAC9BtB,GAAGkC,SAAS,CAACZ,YAAY;oBAAEa,WAAW;gBAAK;gBAC3C5E,QAAQC,GAAG,CAAC,CAAC,gCAAgC,EAAE8D,YAAY;YAC7D;YAGA,IAAI;gBACF,MAAMpB,QAAQF,GAAGG,QAAQ,CAACmB;gBAC1B/D,QAAQC,GAAG,CAAC,CAAC,+BAA+B,CAAC;YAC/C,EAAE,OAAOP,KAAK;gBACZM,QAAQC,GAAG,CAAC,CAAC,gDAAgD,CAAC;YAChE;QACF;QAEA,MAAM4E,WAAW;YACfjB;YACAG;YACArD,WAAW,IAAI/C,OAAO2C,WAAW;YACjCwE,QAAQrH,WAAW;YACnBsH,QAAQX;YACRY,mBAAmBf;YACnBgB,kBAAkBd;QACpB;QAEA,MAAMjE,MAAMA,KAAK,CAAC,CAAC,KAAK,EAAE2E,SAASC,MAAM,CAAC,IAAI,CAAC,EAAED,UAAU;YACzDtE,WAAW;YACXC,UAAU;gBAAEC,UAAU;gBAAYmD;gBAASmB,QAAQX;YAAa;QAClE;QAEApE,QAAQC,GAAG,CAAC,CAAC,uCAAuC,CAAC;QACrDD,QAAQC,GAAG,CAAC,CAAC,mBAAmB,EAAEmE,aAAac,WAAW,IAAI;QAC9DlI,aAAa,CAAC,yBAAyB,CAAC;IAC1C,EAAE,OAAO0C,KAAK;QACZzC,WAAW,CAAC,sBAAsB,EAAEyC,IAAIC,OAAO,EAAE;IACnD;AACF;AAIA,eAAef,gBAAgBV,OAAO,EAAEC,KAAK;IAC3C,MAAME,UAAUF;IAChB,MAAM0B,SAASxB,OAAO,CAAC,UAAU,IAAIA,QAAQwB,MAAM,IAAIpC,WAAW;IAClE,MAAM0H,qBAAqB9G,OAAO,CAAC,sBAAsB,KAAK;IAE9D2B,QAAQC,GAAG,CAAC,CAAC,8BAA8B,CAAC;IAC5CD,QAAQC,GAAG,CAAC,CAAC,YAAY,EAAEJ,QAAQ;IAEnC,IAAI;QACF,MAAMK,QAAQ,MAAM3C;QACpB,MAAM4C,WAAW,MAAMD,MAAMkF,QAAQ,CAAC,CAAC,KAAK,EAAEvF,QAAQ,EAAE;YACtDU,WAAW;QACb;QAEA,MAAM8E,gBAAgB;YACpB,GAAIlF,YAAY,CAAC,CAAC;YAClBC,QAAQ;YACRkF,aAAa,IAAI3H,OAAO2C,WAAW;YACnCiF,UAAUpF,WAAWxC,KAAKC,GAAG,KAAK,IAAID,KAAKwC,SAASE,SAAS,EAAEmF,OAAO,KAAK;QAC7E;QAEA,MAAMtF,MAAMA,KAAK,CAAC,CAAC,KAAK,EAAEL,OAAO,UAAU,CAAC,EAAEwF,eAAe;YAC3D9E,WAAW;YACXC,UAAU;gBAAEC,UAAU;YAAY;QACpC;QAEA,IAAI0E,sBAAsBE,cAAcE,QAAQ,EAAE;YAChD,MAAME,UAAU;gBACd5F;gBACA0F,UAAUF,cAAcE,QAAQ;gBAChCG,eAAe,GAAG,AAACL,CAAAA,cAAcE,QAAQ,GAAG,IAAG,EAAGI,OAAO,CAAC,GAAG,CAAC,CAAC;gBAC/DjF,WAAW,IAAI/C,OAAO2C,WAAW;YACnC;YAEA,MAAMJ,MAAMA,KAAK,CAAC,CAAC,QAAQ,EAAEL,QAAQ,EAAE4F,SAAS;gBAC9ClF,WAAW;YACb;YACAP,QAAQC,GAAG,CAAC,CAAC,kBAAkB,EAAEwF,QAAQC,aAAa,EAAE;QAC1D;QAEA1F,QAAQC,GAAG,CAAC,CAAC,8CAA8C,CAAC;QAC5DjD,aAAa,CAAC,0BAA0B,CAAC;IAC3C,EAAE,OAAO0C,KAAK;QACZzC,WAAW,CAAC,uBAAuB,EAAEyC,IAAIC,OAAO,EAAE;IACpD;AACF;AAEA,eAAed,gBAAgBX,OAAO,EAAEC,KAAK;IAC3C,MAAME,UAAUF;IAChB,MAAMuD,OAAOrD,QAAQqD,IAAI,IAAI;IAC7B,IAAIkE,YAAYvH,OAAO,CAAC,aAAa,IAAIA,QAAQuH,SAAS;IAG1D,IAAIA,cAAc,MAAM;QAEtB,MAAM5D,OAAO,MAAM,MAAM,CAAC;QAC1B,MAAMc,WAAWd,KAAKc,QAAQ,CAACpB;QAC/BkE,YAAY,CAAC,KAAK,EAAE9C,SAAS,CAAC,EAAEnF,KAAKC,GAAG,IAAI;IAC9C;IAEA,MAAMiI,SAASxH,QAAQwH,MAAM,IAAI;IACjC,MAAMC,eAAezH,OAAO,CAAC,gBAAgB,IAAI;IACjD,MAAM0H,cAAc1H,OAAO,CAAC,eAAe,IAAI;IAE/C2B,QAAQC,GAAG,CAAC,CAAC,8BAA8B,CAAC;IAC5CD,QAAQC,GAAG,CAAC,CAAC,SAAS,EAAEyB,MAAM;IAC9B,IAAIkE,WAAW5F,QAAQC,GAAG,CAAC,CAAC,eAAe,EAAE2F,WAAW;IACxD,IAAIC,QAAQ7F,QAAQC,GAAG,CAAC,CAAC,uBAAuB,CAAC;IACjD,IAAI6F,cAAc9F,QAAQC,GAAG,CAAC,CAAC,yBAAyB,CAAC;IACzD,IAAI8F,aAAa/F,QAAQC,GAAG,CAAC,CAAC,2BAA2B,CAAC;IAE1D,IAAI;QACF,MAAMC,QAAQ,MAAM3C;QACpB,MAAMyE,OAAO,MAAM,MAAM,CAAC;QAC1B,MAAMS,KAAK,MAAM,MAAM,CAAC;QAGxB,IAAIuD,eAAe;QACnB,IAAIH,UAAUpD,GAAGC,UAAU,CAAChB,OAAO;YACjC,MAAMO,MAAMD,KAAKE,OAAO,CAACR,MAAMS,WAAW;YAC1C,MAAM8D,aAAa;gBACjB,OAAO;gBACP,OAAO;gBACP,SAAS;gBACT,QAAQ;gBACR,SAAS;gBACT,OAAO;gBACP,OAAO;gBACP,OAAO;gBACP,SAAS;gBACT,QAAQ;gBACR,MAAM;YACR;YAEA,MAAMC,YAAYD,UAAU,CAAChE,IAAI;YACjC,IAAIiE,WAAW;gBACblG,QAAQC,GAAG,CAAC,CAAC,0BAA0B,EAAEiG,UAAU,GAAG,CAAC;gBACvDF,eAAe;oBACbE;oBACA5D,WAAWL;oBACXkE,WAAW;oBACXzF,WAAW,IAAI/C,OAAO2C,WAAW;gBACnC;YACF,OAAO;gBACLN,QAAQC,GAAG,CAAC,CAAC,iCAAiC,EAAEgC,KAAK;gBACrD+D,eAAe;oBACb1D,WAAWL;oBACXkE,WAAW;oBACXC,QAAQ;gBACV;YACF;QACF;QAGA,IAAIC,eAAe;QACnB,IAAIP,cAAc;YAChB,MAAMQ,cAAc;gBAClB5E;gBACA6E,UAAU,IAAI5I,OAAO2C,WAAW;gBAChCmD,QAAQhG,WAAW;gBACnB+I,WAAWR,cAAcG,aAAa;gBACtCM,UAAUhE,GAAGC,UAAU,CAAChB,QAAQe,GAAGG,QAAQ,CAAClB,MAAMsB,IAAI,GAAG;gBACzDG,WAAWnB,KAAKa,OAAO,CAACnB;gBACxBoB,UAAUd,KAAKc,QAAQ,CAACpB;YAC1B;YAEA2E,eAAeC;YAGf,MAAMpG,MAAMA,KAAK,CAAC,CAAC,aAAa,EAAEoG,YAAY7C,MAAM,EAAE,EAAE6C,aAAa;gBACnE/F,WAAW;gBACXC,UAAU;oBAAE6B,MAAM;oBAAgBX;gBAAK;YACzC;YAEA1B,QAAQC,GAAG,CAAC,CAAC,kCAAkC,CAAC;QAClD;QAGA,IAAIyG,iBAAiB;QACrB,IAAIX,aAAa;YAEf,MAAM9D,MAAMD,KAAKE,OAAO,CAACR,MAAMS,WAAW;YAC1C,MAAMW,WAAWd,KAAKc,QAAQ,CAACpB;YAC/B,MAAMiF,WAAW,IAAIhJ,OAAO2C,WAAW;YAEvC,MAAMsG,WAAW;gBACfC,UAAU5E;gBACV6E,UAAUhE;gBACV6D;gBACAI,YAAYlJ,KAAKC,MAAM,KAAK,MAAM;gBAClC8I,UAAU;oBACR,GAAG3E,IAAI,aAAa,CAAC;oBACrB,GAAGa,SAAS,aAAa,CAAC;oBAC1B,CAAC,KAAK,EAAEnF,KAAKC,GAAG,GAAG,SAAS,CAAC;iBAC9B;YACH;YAEA8I,iBAAiBE;YAEjB,MAAM1G,MAAMA,KAAK,CAAC,CAAC,eAAe,EAAEzC,WAAW,YAAY,EAAEmJ,UAAU;gBACrErG,WAAW;gBACXC,UAAU;oBAAE6B,MAAM;oBAAgBX;oBAAMY,WAAWL;gBAAI;YACzD;YAEAjC,QAAQC,GAAG,CACT,CAAC,8BAA8B,EAAE,AAAC2G,CAAAA,SAASG,UAAU,GAAG,GAAE,EAAGpB,OAAO,CAAC,GAAG,aAAa,CAAC;QAE1F;QAEA,MAAMnC,WAAW;YACf9B;YACAkE;YACAlF,WAAW,IAAI/C,OAAO2C,WAAW;YACjCmD,QAAQhG,WAAW;YACnBoI;YACAC;YACAC;YACAC;YACAK;YACAK;QACF;QAEA,MAAMxG,MAAMA,KAAK,CAAC,CAAC,KAAK,EAAEsD,SAASC,MAAM,CAAC,KAAK,CAAC,EAAED,UAAU;YAC1DjD,WAAW;YACXC,UAAU;gBAAEC,UAAU;gBAAaiB;gBAAM8E,WAAWR,cAAcG,aAAa;YAAM;QACvF;QAEA,IAAIP,aAAa,OAAOA,cAAc,UAAU;YAC9C,MAAM1F,MAAMA,KAAK,CACf0F,WACA;gBACElE;gBACA6E,UAAU,IAAI5I,OAAO2C,WAAW;gBAChCmD,QAAQD,SAASC,MAAM;gBACvBuD,UAAU;gBACVhB;gBACAK;gBACAK;YACF,GACA;gBAAEnG,WAAW;YAAe;QAEhC;QAEA,MAAM0G,aAAa,CAAC,aAAa,EAAEvF,KAAKwF,OAAO,CAAC,OAAO,KAAK,CAAC,EAAEvJ,KAAKC,GAAG,IAAI;QAC3E,MAAMsC,MAAMA,KAAK,CACf+G,YACA;YACEvF;YACA+B,QAAQD,SAASC,MAAM;YACvB/C,WAAW,IAAI/C,OAAO2C,WAAW;YACjC0G,UAAU;YACVG,UAAU;gBACRtB;gBACAC;gBACAC;YACF;QACF,GACA;YAAExF,WAAW;QAAe;QAG9BP,QAAQC,GAAG,CAAC,CAAC,6CAA6C,CAAC;QAC3DjD,aAAa,CAAC,0BAA0B,CAAC;IAC3C,EAAE,OAAO0C,KAAK;QACZzC,WAAW,CAAC,uBAAuB,EAAEyC,IAAIC,OAAO,EAAE;IACpD;AACF;AAEA,eAAeb,gBAAgBZ,OAAO,EAAEC,KAAK;IAC3C,MAAME,UAAUF;IAChB,MAAMyF,UAAUvF,QAAQuF,OAAO,IAAI1F,QAAQ2F,KAAK,CAAC,GAAGC,IAAI,CAAC;IACzD,MAAMsD,WAAW/I,OAAO,CAAC,YAAY,IAAI;IACzC,MAAMiD,SAASjD,QAAQiD,MAAM,IAAI;IACjC,MAAM+F,eAAehJ,OAAO,CAAC,gBAAgB,IAAI;IACjD,MAAMiJ,eAAejJ,OAAO,CAAC,gBAAgB,IAAI;IACjD,MAAMkH,WAAWlH,QAAQkH,QAAQ,IAAI;IAErCvF,QAAQC,GAAG,CAAC,CAAC,8BAA8B,CAAC;IAC5CD,QAAQC,GAAG,CAAC,CAAC,YAAY,EAAE2D,SAAS;IACpC5D,QAAQC,GAAG,CAAC,CAAC,cAAc,EAAEmH,UAAU;IACvC,IAAIC,cAAcrH,QAAQC,GAAG,CAAC,CAAC,4BAA4B,CAAC;IAC5D,IAAIqH,cAActH,QAAQC,GAAG,CAAC,CAAC,2BAA2B,CAAC;IAE3D,IAAI;QACF,MAAMC,QAAQ,MAAM3C;QACpB,MAAMgK,YAAY5J,KAAKC,GAAG;QAG1B,IAAI6H,UAAU;QACd,IAAI4B,cAAc;YAChB,MAAMG,gBAAgB5D,QAAQW,MAAM;YACpC,MAAMkD,eAAenG,OAAOiD,MAAM;YAClC,MAAMlD,UAAUqG,SAASN,cAAc;YAEvC3B,UAAU;gBACR+B;gBACAC;gBACApG;gBACAkE,UAAUmC,SAASnC,aAAa;gBAChC6B,UAAUM,SAASN;gBACnB1G,WAAW,IAAI/C,OAAO2C,WAAW;gBACjCqH,YAAYH,gBAAgB,MAAM,SAASA,gBAAgB,KAAK,WAAW;YAC7E;YAEAxH,QAAQC,GAAG,CACT,CAAC,sBAAsB,EAAEuH,cAAc,QAAQ,EAAEC,aAAa,SAAS,EAAEpG,UAAU,YAAY,UAAU;QAE7G;QAEA,MAAMwD,WAAW;YACfjB;YACAwD;YACA9F,QAAQgG,eAAehG,OAAOsG,SAAS,CAAC,GAAG,QAAQtG,OAAOsG,SAAS,CAAC,GAAG;YACvElH,WAAW,IAAI/C,OAAO2C,WAAW;YACjCwE,QAAQrH,WAAW;YACnB4J;YACAC;YACA7B;QACF;QAEA,MAAMvF,MAAMA,KAAK,CAAC,CAAC,KAAK,EAAE2E,SAASC,MAAM,CAAC,KAAK,CAAC,EAAED,UAAU;YAC1DtE,WAAW;YACXC,UAAU;gBAAEC,UAAU;gBAAamD;gBAASwD;gBAAU/F,SAASqG,SAASN,cAAc;YAAE;QAC1F;QAGA,IAAIE,cAAc;YAChB,MAAMpH,MAAMA,KAAK,CACf,CAAC,gBAAgB,EAAE2E,SAASC,MAAM,EAAE,EACpC;gBACElB;gBACAwD;gBACA9F;gBACAZ,WAAW,IAAI/C,OAAO2C,WAAW;gBACjCuH,YAAY;YACd,GACA;gBAAEtH,WAAW;YAAkB;YAGjCP,QAAQC,GAAG,CAAC,CAAC,gCAAgC,CAAC;QAChD;QAGA,IAAIoH,gBAAgB5B,SAAS;YAC3B,MAAMvF,MAAMA,KAAK,CAAC,CAAC,gBAAgB,EAAE2E,SAASC,MAAM,EAAE,EAAEW,SAAS;gBAC/DlF,WAAW;YACb;YAGA,MAAMuH,kBAAkB,AAAC,MAAM5H,MAAMkF,QAAQ,CAAC,2BAA2B;gBACvE7E,WAAW;YACb,MAAO;gBAAEwH,eAAe;gBAAGC,aAAa;gBAAGC,aAAa;YAAE;YAE1DH,gBAAgBC,aAAa,IAAI;YACjCD,gBAAgBE,WAAW,GACzB,AAACF,CAAAA,gBAAgBE,WAAW,GAAIF,CAAAA,gBAAgBC,aAAa,GAAG,CAAA,IAC7DtC,CAAAA,QAAQpE,OAAO,GAAG,IAAI,CAAA,CAAC,IAC1ByG,gBAAgBC,aAAa;YAC/BD,gBAAgBG,WAAW,GACzB,AAACH,CAAAA,gBAAgBG,WAAW,GAAIH,CAAAA,gBAAgBC,aAAa,GAAG,CAAA,IAAKtC,QAAQF,QAAQ,AAAD,IACpFuC,gBAAgBC,aAAa;YAC/BD,gBAAgBI,WAAW,GAAG,IAAIvK,OAAO2C,WAAW;YAEpD,MAAMJ,MAAMA,KAAK,CAAC,2BAA2B4H,iBAAiB;gBAC5DvH,WAAW;YACb;QACF;QAGA,MAAML,MAAMA,KAAK,CACf,CAAC,gBAAgB,EAAEvC,KAAKC,GAAG,IAAI,EAC/B;YACEgG;YACAwD;YACA1G,WAAW,IAAI/C,OAAO2C,WAAW;YACjCe,SAASqG,SAASN,cAAc;YAChCe,YAAYd;YACZe,YAAYd;QACd,GACA;YAAE/G,WAAW;QAAkB;QAGjCP,QAAQC,GAAG,CAAC,CAAC,iDAAiD,CAAC;QAC/DjD,aAAa,CAAC,0BAA0B,CAAC;IAC3C,EAAE,OAAO0C,KAAK;QACZzC,WAAW,CAAC,uBAAuB,EAAEyC,IAAIC,OAAO,EAAE;IACpD;AACF;AAEA,eAAeZ,kBAAkBb,OAAO,EAAEC,KAAK;IAC7C,MAAME,UAAUF;IAChB,MAAMkK,QAAQhK,QAAQgK,KAAK,IAAInK,QAAQ2F,KAAK,CAAC,GAAGC,IAAI,CAAC;IACrD,MAAMwE,cAAcjK,OAAO,CAAC,eAAe,IAAI;IAC/C,MAAMkK,aAAalK,QAAQgE,IAAI,IAAI;IAEnCrC,QAAQC,GAAG,CAAC,CAAC,gCAAgC,CAAC;IAC9CD,QAAQC,GAAG,CAAC,CAAC,UAAU,EAAEoI,OAAO;IAChCrI,QAAQC,GAAG,CAAC,CAAC,YAAY,EAAEqI,aAAa;IAExC,IAAI;QACF,MAAMpI,QAAQ,MAAM3C;QACpB,MAAMiL,aAAa;YACjBH;YACAC,aAAaZ,SAASY;YACtBC;YACA7H,WAAW,IAAI/C,OAAO2C,WAAW;YACjCmI,UAAUhL,WAAW;QACvB;QAEA,MAAMyC,MAAMA,KAAK,CAAC,CAAC,OAAO,EAAEsI,WAAWC,QAAQ,EAAE,EAAED,YAAY;YAC7DjI,WAAW;YACXC,UAAU;gBAAEC,UAAU;gBAAe4H;YAAM;QAC7C;QAGA,MAAMnI,MAAMA,KAAK,CACf,CAAC,aAAa,EAAEmI,OAAO,EACvB;YACEC,aAAaE,WAAWF,WAAW;YACnCI,UAAU,IAAI/K,OAAO2C,WAAW;QAClC,GACA;YAAEC,WAAW;YAAgBoD,KAAK;QAAK;QAGzC3D,QAAQC,GAAG,CAAC,CAAC,8CAA8C,CAAC;QAC5DjD,aAAa,CAAC,4BAA4B,CAAC;IAC7C,EAAE,OAAO0C,KAAK;QACZzC,WAAW,CAAC,yBAAyB,EAAEyC,IAAIC,OAAO,EAAE;IACtD;AACF;AAIA,eAAeX,sBAAsBd,OAAO,EAAEC,KAAK;IACjD,MAAME,UAAUF;IAChB,MAAMwK,aAAatK,QAAQuK,MAAM,IAAI;IACrC,MAAMC,YAAYxK,OAAO,CAAC,aAAa,IAAIZ,WAAW;IAEtDuC,QAAQC,GAAG,CAAC,CAAC,oCAAoC,CAAC;IAClDD,QAAQC,GAAG,CAAC,CAAC,WAAW,EAAE0I,YAAY;IACtC3I,QAAQC,GAAG,CAAC,CAAC,YAAY,EAAE4I,WAAW;IAEtC,IAAI;QACF,MAAM3I,QAAQ,MAAM3C;QACpB,MAAMuL,UAAU;YACdH;YACAE;YACAE,eAAe,IAAIpL,OAAO2C,WAAW;YACrCF,QAAQ;QACV;QAEA,MAAMF,MAAMA,KAAK,CAAC,CAAC,IAAI,EAAE2I,WAAW,EAAEC,SAAS;YAC7CvI,WAAW;YACXC,UAAU;gBAAEC,UAAU;gBAAmBmI,QAAQD;YAAW;QAC9D;QAEA3I,QAAQC,GAAG,CAAC,CAAC,0CAA0C,CAAC;QACxDjD,aAAa,CAAC,gCAAgC,CAAC;IACjD,EAAE,OAAO0C,KAAK;QACZzC,WAAW,CAAC,6BAA6B,EAAEyC,IAAIC,OAAO,EAAE;IAC1D;AACF;AAEA,eAAeV,oBAAoBf,OAAO,EAAEC,KAAK;IAC/C,MAAME,UAAUF;IAChB,MAAMuF,YAAYrF,QAAQgE,IAAI,IAAI;IAClC,MAAM2G,YAAY3K,QAAQ4K,IAAI,IAAIxL,WAAW;IAC7C,MAAMyL,UAAU7K,OAAO,CAAC,WAAW,IAAI;IAEvC2B,QAAQC,GAAG,CAAC,CAAC,kCAAkC,CAAC;IAChDD,QAAQC,GAAG,CAAC,CAAC,UAAU,EAAE+I,WAAW;IACpChJ,QAAQC,GAAG,CAAC,CAAC,WAAW,EAAEyD,WAAW;IAErC,IAAI;QACF,MAAMxD,QAAQ,MAAM3C;QACpB,MAAM4L,YAAY;YAChBH;YACAtF;YACAwF;YACAE,WAAW,IAAIzL,OAAO2C,WAAW;YACjCF,QAAQ;QACV;QAEA,MAAMF,MAAMA,KAAK,CAAC,CAAC,MAAM,EAAE8I,WAAW,EAAEG,WAAW;YACjD5I,WAAW;YACXC,UAAU;gBAAEC,UAAU;gBAAiB4B,MAAMqB;YAAU;QACzD;QAGA,MAAMxD,MAAMA,KAAK,CACf,CAAC,aAAa,EAAEvC,KAAKC,GAAG,IAAI,EAC5B;YACEoL;YACAK,QAAQ;YACR3I,WAAW,IAAI/C,OAAO2C,WAAW;QACnC,GACA;YAAEC,WAAW;QAAe;QAG9BP,QAAQC,GAAG,CAAC,CAAC,yCAAyC,CAAC;QACvDjD,aAAa,CAAC,8BAA8B,CAAC;IAC/C,EAAE,OAAO0C,KAAK;QACZzC,WAAW,CAAC,2BAA2B,EAAEyC,IAAIC,OAAO,EAAE;IACxD;AACF;AAEA,eAAeT,wBAAwBhB,OAAO,EAAEC,KAAK;IACnD,MAAME,UAAUF;IAChB,MAAM0B,SAASxB,OAAO,CAAC,UAAU,IAAIZ,WAAW;IAChD,MAAM6L,WAAWjL,QAAQiL,QAAQ,IAAI;IACrC,MAAMC,WAAWlL,QAAQkL,QAAQ,IAAI;IAErCvJ,QAAQC,GAAG,CAAC,CAAC,sCAAsC,CAAC;IACpDD,QAAQC,GAAG,CAAC,CAAC,SAAS,EAAEJ,QAAQ;IAChCG,QAAQC,GAAG,CAAC,CAAC,aAAa,EAAEqJ,UAAU;IAEtC,IAAI;QACF,MAAMpJ,QAAQ,MAAM3C;QACpB,MAAMiM,oBAAoB;YACxB3J;YACAyJ;YACAC;YACAE,gBAAgB,IAAI9L,OAAO2C,WAAW;YACtCF,QAAQ;QACV;QAEA,MAAMF,MAAMA,KAAK,CAAC,CAAC,cAAc,EAAEL,QAAQ,EAAE2J,mBAAmB;YAC9DjJ,WAAW;YACXC,UAAU;gBAAEC,UAAU;gBAAqB6I;YAAS;QACtD;QAEAtJ,QAAQC,GAAG,CAAC,CAAC,4CAA4C,CAAC;QAC1DjD,aAAa,CAAC,kCAAkC,CAAC;IACnD,EAAE,OAAO0C,KAAK;QACZzC,WAAW,CAAC,+BAA+B,EAAEyC,IAAIC,OAAO,EAAE;IAC5D;AACF;AAEA,eAAeR,qBAAqBjB,OAAO,EAAEC,KAAK;IAChD,MAAME,UAAUF;IAChB,MAAMuL,YAAYrL,QAAQsL,KAAK,IAAI;IACnC,MAAMC,WAAWvL,QAAQuL,QAAQ,IAAI;IACrC,MAAMhD,WAAWvI,QAAQuI,QAAQ,IAAI;IAErC5G,QAAQC,GAAG,CAAC,CAAC,mCAAmC,CAAC;IACjDD,QAAQC,GAAG,CAAC,CAAC,UAAU,EAAEyJ,WAAW;IACpC1J,QAAQC,GAAG,CAAC,CAAC,aAAa,EAAE2J,SAAS,CAAC,CAAC;IAEvC,IAAI;QACF,MAAM1J,QAAQ,MAAM3C;QACpB,MAAMsM,eAAe;YACnBH;YACAE,UAAUE,WAAWF;YACrBG,iBAAiBrC,SAASd;YAC1BoD,WAAW,IAAIrM,OAAO2C,WAAW;QACnC;QAEA,MAAMJ,MAAMA,KAAK,CAAC,CAAC,OAAO,EAAEwJ,UAAU,CAAC,EAAE/L,KAAKC,GAAG,IAAI,EAAEiM,cAAc;YACnEtJ,WAAW;YACXC,UAAU;gBAAEC,UAAU;gBAAkBkJ,OAAOD;YAAU;QAC3D;QAEA1J,QAAQC,GAAG,CAAC,CAAC,+CAA+C,CAAC;QAC7DjD,aAAa,CAAC,+BAA+B,CAAC;IAChD,EAAE,OAAO0C,KAAK;QACZzC,WAAW,CAAC,4BAA4B,EAAEyC,IAAIC,OAAO,EAAE;IACzD;AACF;AAIA,eAAeP,kBAAkBlB,OAAO,EAAEC,KAAK;IAC7C,MAAME,UAAUF;IAChB,MAAM8L,kBAAkB5L,OAAO,CAAC,mBAAmB,KAAK;IACxD,MAAM6L,eAAe7L,OAAO,CAAC,gBAAgB,KAAK;IAClD,MAAM8L,gBAAgB9L,OAAO,CAAC,iBAAiB,IAAI;IAEnD2B,QAAQC,GAAG,CAAC,CAAC,gCAAgC,CAAC;IAC9C,IAAIgK,iBAAiBjK,QAAQC,GAAG,CAAC,CAAC,8BAA8B,CAAC;IACjE,IAAIiK,cAAclK,QAAQC,GAAG,CAAC,CAAC,6BAA6B,CAAC;IAC7D,IAAIkK,eAAenK,QAAQC,GAAG,CAAC,CAAC,0BAA0B,CAAC;IAE3D,IAAI;QACF,MAAMC,QAAQ,MAAM3C;QACpB,MAAM6M,QAAQ,MAAMlK,MAAMmK,IAAI,CAAC;YAAE9J,WAAW;YAAc+J,OAAO;QAAK;QACtE,MAAMC,QAAQ,MAAMrK,MAAMmK,IAAI,CAAC;YAAE9J,WAAW;YAAgB+J,OAAO;QAAK;QACxE,MAAME,WAAW,MAAMtK,MAAMmK,IAAI,CAAC;YAAE9J,WAAW;YAAmB+J,OAAO;QAAK;QAC9E,MAAMG,SAAS,MAAMvK,MAAMmK,IAAI,CAAC;YAAE9J,WAAW;YAAgB+J,OAAO;QAAK;QAGzE,IAAI7E,UAAU;QACd,IAAI0E,eAAe;YACjB,MAAMvM,MAAM,IAAID;YAChB,MAAM+M,eAAe7M,KAAK8M,GAAG,IACxBP,MAAMQ,GAAG,CAAC,CAACC,IAAM,IAAIlN,KAAKkN,EAAEC,KAAK,CAACpK,SAAS,IAAI9C,KAAK4H,OAAO,QAC3D+E,MAAMK,GAAG,CAAC,CAACG,IAAM,IAAIpN,KAAKoN,EAAED,KAAK,CAACpK,SAAS,IAAI9C,KAAK4H,OAAO,QAC3DgF,SAASI,GAAG,CAAC,CAACI,IAAM,IAAIrN,KAAKqN,EAAEF,KAAK,CAACpK,SAAS,IAAI9C,KAAK4H,OAAO;YAGnE,MAAMD,WAAW3H,IAAI4H,OAAO,KAAKkF;YACjC,MAAMO,qBAAqBT,SAASU,MAAM,CAAC,CAACF,IAAMA,EAAEF,KAAK,CAACzJ,OAAO,KAAK,OAAOkD,MAAM;YACnF,MAAM4G,qBAAqBX,SAASjG,MAAM,GAAG,IAAI0G,qBAAqBT,SAASjG,MAAM,GAAG;YAExFkB,UAAU;gBACR2F,iBAAiB7F;gBACjB8F,sBAAsB,GAAGxN,KAAKyN,KAAK,CAAC/F,WAAW,OAAO,IAAI,QAAQ,CAAC;gBACnEgG,YAAYnB,MAAM7F,MAAM;gBACxBiH,YAAYjB,MAAMhG,MAAM;gBACxBwD,eAAeyC,SAASjG,MAAM;gBAC9BkH,cAAchB,OAAOlG,MAAM;gBAC3B4G,oBAAoBtN,KAAKyN,KAAK,CAACH,qBAAqB;gBACpDO,mBAAmB7N,KAAKyN,KAAK,CAAC,AAAClB,MAAM7F,MAAM,GAAIgB,CAAAA,WAAW,OAAO,EAAC,IAAM,OAAO;gBAC/EoG,mBAAmB9N,KAAKyN,KAAK,CAAC,AAACf,MAAMhG,MAAM,GAAIgB,CAAAA,WAAW,OAAO,EAAC,IAAM,OAAO;gBAC/E7E,WAAW9C,IAAI0C,WAAW;YAC5B;QACF;QAEA,MAAMsL,cAAc;YAClBC,SAAS,IAAIlO,OAAO2C,WAAW;YAC/BiL,YAAYnB,MAAM7F,MAAM;YACxBiH,YAAYjB,MAAMhG,MAAM;YACxBwD,eAAeyC,SAASjG,MAAM;YAC9BkH,cAAchB,OAAOlG,MAAM;YAC3BsE,WAAWpL,WAAW;YACtBwM;YACAC;YACAC;YACA1E;QACF;QAEA,MAAMvF,MAAMA,KAAK,CAAC,CAAC,QAAQ,EAAE0L,YAAY/C,SAAS,EAAE,EAAE+C,aAAa;YACjErL,WAAW;YACXC,UAAU;gBAAEC,UAAU;YAAc;QACtC;QAGA,IAAIyJ,cAAc;YAChB,MAAM4B,gBAAgB;gBACpBjD,WAAW+C,YAAY/C,SAAS;gBAChCuB,OAAOA,MAAMvG,KAAK,CAAC,GAAG;gBACtB0G,OAAOA,MAAM1G,KAAK,CAAC,GAAG;gBACtB2G,UAAUA,SAAS3G,KAAK,CAAC,GAAG;gBAC5B4G,QAAQA,OAAO5G,KAAK,CAAC,GAAG;gBACxBkI,aAAa,IAAIpO,OAAO2C,WAAW;gBACnC0L,WAAW;YACb;YAEA,MAAM9L,MAAMA,KAAK,CAAC,CAAC,cAAc,EAAE0L,YAAY/C,SAAS,EAAE,EAAEiD,eAAe;gBACzEvL,WAAW;gBACXC,UAAU;oBAAE6B,MAAM;oBAAcwG,WAAW+C,YAAY/C,SAAS;gBAAC;YACnE;YAEA7I,QAAQC,GAAG,CAAC,CAAC,iCAAiC,CAAC;QACjD;QAGA,IAAIkK,iBAAiB1E,SAAS;YAC5B,MAAMvF,MAAMA,KAAK,CAAC,CAAC,gBAAgB,EAAE0L,YAAY/C,SAAS,EAAE,EAAEpD,SAAS;gBACrElF,WAAW;gBACXC,UAAU;oBAAE6B,MAAM;oBAAuBwG,WAAW+C,YAAY/C,SAAS;gBAAC;YAC5E;YAEA7I,QAAQC,GAAG,CAAC,CAAC,6BAA6B,CAAC;QAC7C;QAEA,IAAIgK,iBAAiB;YACnBjK,QAAQC,GAAG,CAAC,CAAC,qBAAqB,CAAC;YACnCD,QAAQC,GAAG,CAAC,CAAC,YAAY,EAAE2L,YAAYL,UAAU,EAAE;YACnDvL,QAAQC,GAAG,CAAC,CAAC,aAAa,EAAE2L,YAAYJ,UAAU,EAAE;YACpDxL,QAAQC,GAAG,CAAC,CAAC,eAAe,EAAE2L,YAAY7D,aAAa,EAAE;YACzD/H,QAAQC,GAAG,CAAC,CAAC,aAAa,EAAE2L,YAAYH,YAAY,EAAE;YAEtD,IAAIhG,SAAS;gBACXzF,QAAQC,GAAG,CAAC,CAAC,gBAAgB,EAAEwF,QAAQ4F,oBAAoB,EAAE;gBAC7DrL,QAAQC,GAAG,CAAC,CAAC,mBAAmB,EAAEwF,QAAQ0F,kBAAkB,CAAC,CAAC,CAAC;gBAC/DnL,QAAQC,GAAG,CAAC,CAAC,gBAAgB,EAAEwF,QAAQiG,iBAAiB,EAAE;gBAC1D1L,QAAQC,GAAG,CAAC,CAAC,iBAAiB,EAAEwF,QAAQkG,iBAAiB,EAAE;YAC7D;QACF;QAEA3L,QAAQC,GAAG,CAAC,CAAC,sCAAsC,CAAC;QAEpD,IAAI3C,aAAa;YACfA,YAAYiE,KAAK;YACjBjE,cAAc;QAChB;QAEAN,aAAa,CAAC,4BAA4B,CAAC;IAC7C,EAAE,OAAO0C,KAAK;QACZzC,WAAW,CAAC,yBAAyB,EAAEyC,IAAIC,OAAO,EAAE;IACtD;AACF;AAEA,eAAeN,sBAAsBnB,OAAO,EAAEC,KAAK;IACjD,MAAME,UAAUF;IAChB,MAAM0K,YAAYxK,OAAO,CAAC,aAAa,IAAI;IAE3C2B,QAAQC,GAAG,CAAC,CAAC,oCAAoC,CAAC;IAClDD,QAAQC,GAAG,CAAC,CAAC,YAAY,EAAE4I,WAAW;IAEtC,IAAI;QACF,MAAM3I,QAAQ,MAAM3C;QAGpB,IAAIqO;QACJ,IAAI/C,cAAc,UAAU;YAC1B,MAAMoD,WAAW,MAAM/L,MAAMmK,IAAI,CAAC;gBAAE9J,WAAW;gBAAY+J,OAAO;YAAE;YACpEsB,cAAcK,QAAQ,CAAC,EAAE,EAAEnB;QAC7B,OAAO;YACLc,cAAc,MAAM1L,MAAMkF,QAAQ,CAAC,CAAC,QAAQ,EAAEyD,WAAW,EAAE;gBAAEtI,WAAW;YAAW;QACrF;QAEA,IAAIqL,aAAa;YACf5L,QAAQC,GAAG,CAAC,CAAC,sBAAsB,CAAC;YACpCD,QAAQC,GAAG,CAAC,CAAC,SAAS,EAAE2L,YAAY/C,SAAS,IAAI,WAAW;YAC5D7I,QAAQC,GAAG,CAAC,CAAC,YAAY,EAAE2L,YAAYL,UAAU,IAAI,GAAG;YACxDvL,QAAQC,GAAG,CAAC,CAAC,aAAa,EAAE2L,YAAYJ,UAAU,IAAI,GAAG;YACzDxL,QAAQC,GAAG,CAAC,CAAC,WAAW,EAAE2L,YAAYC,OAAO,IAAI,WAAW;YAG5D,MAAM3L,MAAMA,KAAK,CACf,CAAC,gBAAgB,EAAEvC,KAAKC,GAAG,IAAI,EAC/B;gBACEsO,mBAAmBN,YAAY/C,SAAS,IAAIA;gBAC5CsD,YAAY,IAAIxO,OAAO2C,WAAW;YACpC,GACA;gBAAEC,WAAW;YAAiB;YAGhCP,QAAQC,GAAG,CAAC,CAAC,2CAA2C,CAAC;YACzDjD,aAAa,CAAC,2BAA2B,CAAC;QAC5C,OAAO;YACLE,aAAa,CAAC,0BAA0B,EAAE2L,WAAW;QACvD;IACF,EAAE,OAAOnJ,KAAK;QACZzC,WAAW,CAAC,6BAA6B,EAAEyC,IAAIC,OAAO,EAAE;IAC1D;AACF;AAEA,eAAeL,cAAcpB,OAAO,EAAEC,KAAK;IACzC,MAAME,UAAUF;IAChB,MAAMwB,UAAUtB,QAAQsB,OAAO,IAAIzB,QAAQ2F,KAAK,CAAC,GAAGC,IAAI,CAAC;IACzD,MAAMsI,QAAQ/N,QAAQ+N,KAAK,IAAI;IAC/B,MAAMC,cAAchO,OAAO,CAAC,eAAe,IAAI;IAE/C2B,QAAQC,GAAG,CAAC,CAAC,2BAA2B,CAAC;IACzCD,QAAQC,GAAG,CAAC,CAAC,YAAY,EAAEN,SAAS;IACpCK,QAAQC,GAAG,CAAC,CAAC,UAAU,EAAEmM,OAAO;IAEhC,IAAI;QACF,MAAMlM,QAAQ,MAAM3C;QACpB,MAAM+O,mBAAmB;YACvB3M;YACAyM;YACAC;YACA3L,WAAW,IAAI/C,OAAO2C,WAAW;YACjCiM,UAAU9O,WAAW;QACvB;QAEA,MAAMyC,MAAMA,KAAK,CAAC,CAAC,aAAa,EAAEoM,iBAAiBC,QAAQ,EAAE,EAAED,kBAAkB;YAC/E/L,WAAW;YACXC,UAAU;gBAAEC,UAAU;gBAAU2L;YAAM;QACxC;QAGA,MAAMI,OAAOJ,UAAU,UAAU,MAAMA,UAAU,YAAY,OAAO;QACpEpM,QAAQC,GAAG,CAAC,CAAC,EAAE,EAAEuM,KAAK,cAAc,CAAC;QACrCxM,QAAQC,GAAG,CAAC,CAAC,EAAE,EAAEN,SAAS;QAC1BK,QAAQC,GAAG,CAAC,CAAC,YAAY,EAAEoM,aAAa;QAExCrM,QAAQC,GAAG,CAAC,CAAC,6CAA6C,CAAC;QAC3DjD,aAAa,CAAC,uBAAuB,CAAC;IACxC,EAAE,OAAO0C,KAAK;QACZzC,WAAW,CAAC,oBAAoB,EAAEyC,IAAIC,OAAO,EAAE;IACjD;AACF;AAIA,eAAeJ,kBAAkBrB,OAAO,EAAEC,KAAK;IAE7C,IAAIsO,QAAQ;IACZ,IAAIC,WAAW;IAEf,MAAMC,UAAU3L,WAAW;QACzB,IAAI,CAAC0L,UAAU;YACb1M,QAAQC,GAAG,CAAC;YACZD,QAAQC,GAAG,CAAC;YACZD,QAAQC,GAAG,CAAC;YACZD,QAAQC,GAAG,CAAC;YACZD,QAAQC,GAAG,CAAC;YACZuB,QAAQC,IAAI,CAAC;QACf;IACF,GAAG;IAEH,WAAW,MAAMmL,SAASpL,QAAQqL,KAAK,CAAE;QACvCH,WAAW;QACXI,aAAaH;QACbF,SAASG;IACX;IAEA,IAAI,CAACH,MAAMM,IAAI,IAAI;QACjB;IACF;IAEA,MAAMC,YAAYC,KAAKC,KAAK,CAACT;IAC7B,MAAM7I,UAAUoJ,UAAUG,UAAU,EAAEvJ,WAAW;IAEjD,IAAI,CAACA,SAAS;QACZ5D,QAAQC,GAAG,CAACwM;QACZ;IACF;IAEA,IAAIW,kBAAkBxJ;IACtB,MAAMyJ,QAAQ,EAAE;IAGhB,IAAI,QAAQC,IAAI,CAAC1J,YAAY,CAAC,QAAQ0J,IAAI,CAAC1J,UAAU;QACnDwJ,kBAAkBxJ,QAAQsD,OAAO,CAAC,QAAQ;QAC1CmG,MAAME,IAAI,CAAC;IACb;IAGA,IAAI,YAAYD,IAAI,CAAC1J,UAAU;QAC7BwJ,kBAAkBxJ,QAAQsD,OAAO,CAAC,OAAO;QACzCmG,MAAME,IAAI,CAAC;IACb,OAAO,IAAI,YAAYD,IAAI,CAAC1J,UAAU;QACpCwJ,kBAAkBxJ,QAAQsD,OAAO,CAAC,OAAO;QACzCmG,MAAME,IAAI,CAAC;IACb;IAGA,IAAI,oCAAoCD,IAAI,CAAC1J,YAAY,CAAC,UAAU0J,IAAI,CAAC1J,UAAU;QACjFwJ,kBAAkBxJ,QAAQsD,OAAO,CAAC,0CAA0C;QAC5EmG,MAAME,IAAI,CAAC;IACb;IAGA,IAAI,4CAA4CD,IAAI,CAAC1J,YAAY,CAAC,iBAAiB0J,IAAI,CAAC1J,UAAU;QAChGyJ,MAAME,IAAI,CAAC;IACb;IAGA,MAAMjM,SAAS;QACb,GAAG0L,SAAS;QACZG,YAAY;YACV,GAAGH,UAAUG,UAAU;YACvBvJ,SAASwJ;QACX;IACF;IAEA,IAAIC,MAAM9I,MAAM,GAAG,GAAG;QACpBjD,OAAOkM,kBAAkB,GAAGH,MAAMvJ,IAAI,CAAC;IACzC;IAEA9D,QAAQC,GAAG,CAACgN,KAAKQ,SAAS,CAACnM,QAAQ,MAAM;AAC3C;AAEA,eAAe9B,kBAAkBtB,OAAO,EAAEC,KAAK;IAE7C,IAAIsO,QAAQ;IACZ,IAAIC,WAAW;IAEf,MAAMC,UAAU3L,WAAW;QACzB,IAAI,CAAC0L,UAAU;YACb1M,QAAQC,GAAG,CAAC;YACZD,QAAQC,GAAG,CAAC;YACZD,QAAQC,GAAG,CAAC;YACZD,QAAQC,GAAG,CAAC;YACZD,QAAQC,GAAG,CAAC;YACZuB,QAAQC,IAAI,CAAC;QACf;IACF,GAAG;IAEH,WAAW,MAAMmL,SAASpL,QAAQqL,KAAK,CAAE;QACvCH,WAAW;QACXI,aAAaH;QACbF,SAASG;IACX;IAEA,IAAI,CAACH,MAAMM,IAAI,IAAI;QACjB;IACF;IAEA,MAAMC,YAAYC,KAAKC,KAAK,CAACT;IAC7B,MAAMiB,WAAWV,UAAUG,UAAU,EAAEQ,aAAaX,UAAUG,UAAU,EAAEnL,QAAQ;IAElF,IAAI,CAAC0L,UAAU;QACb1N,QAAQC,GAAG,CAACwM;QACZ;IACF;IAEA,IAAImB,eAAeF;IACnB,IAAIG,eAAe;IACnB,MAAMR,QAAQ,EAAE;IAGhB,MAAMS,aAAa,iDAAiDR,IAAI,CAACI,aACtD,kCAAkCJ,IAAI,CAACI,aACvC,sBAAsBJ,IAAI,CAACI;IAE9C,IAAII,YAAY;QACd,IAAI,0CAA0CR,IAAI,CAACI,WAAW;YAC5DE,eAAe,CAAC,MAAM,EAAEF,UAAU;YAClCG,eAAe;YACfR,MAAME,IAAI,CAAC;QACb,OAAO,IAAI,oDAAoDD,IAAI,CAACI,WAAW;YAC7EE,eAAe,CAAC,aAAa,EAAEF,UAAU;YACzCG,eAAe;YACfR,MAAME,IAAI,CAAC;QACb,OAAO,IAAI,wBAAwBD,IAAI,CAACI,WAAW;YACjDE,eAAe,CAAC,IAAI,EAAEF,UAAU;YAChCG,eAAe;YACfR,MAAME,IAAI,CAAC;QACb,OAAO,IAAI,sBAAsBD,IAAI,CAACI,WAAW;YAC/CE,eAAe,CAAC,KAAK,EAAEF,UAAU;YACjCG,eAAe;YACfR,MAAME,IAAI,CAAC;QACb;IACF;IAGA,IAAI,qBAAqBD,IAAI,CAACM,eAAe;QAC3CP,MAAME,IAAI,CAAC;IACb,OAAO,IAAI,QAAQD,IAAI,CAACM,eAAe;QACrCP,MAAME,IAAI,CAAC;IACb;IAGA,MAAMjM,SAAS;QACb,GAAG0L,SAAS;QACZG,YAAY;YACV,GAAGH,UAAUG,UAAU;QACzB;IACF;IAEA,IAAIU,cAAc;QAChB,IAAIb,UAAUG,UAAU,CAACQ,SAAS,EAAE;YAClCrM,OAAO6L,UAAU,CAACQ,SAAS,GAAGC;QAChC,OAAO;YACLtM,OAAO6L,UAAU,CAACnL,IAAI,GAAG4L;QAC3B;IACF;IAEA,IAAIP,MAAM9I,MAAM,GAAG,GAAG;QACpBjD,OAAOkM,kBAAkB,GAAGH,MAAMvJ,IAAI,CAAC;IACzC;IAEA9D,QAAQC,GAAG,CAACgN,KAAKQ,SAAS,CAACnM,QAAQ,MAAM;AAC3C;AAEA,eAAe7B,uBAAuBvB,OAAO,EAAEC,KAAK;IAElD,IAAIsO,QAAQ;IACZ,IAAIC,WAAW;IAEf,MAAMC,UAAU3L,WAAW;QACzB,IAAI,CAAC0L,UAAU;YACb1M,QAAQC,GAAG,CAAC;YACZD,QAAQC,GAAG,CAAC;YACZD,QAAQC,GAAG,CAAC;YACZD,QAAQC,GAAG,CAAC;YACZD,QAAQC,GAAG,CAAC;YACZuB,QAAQC,IAAI,CAAC;QACf;IACF,GAAG;IAEH,WAAW,MAAMmL,SAASpL,QAAQqL,KAAK,CAAE;QACvCH,WAAW;QACXI,aAAaH;QACbF,SAASG;IACX;IAEA,IAAI,CAACH,MAAMM,IAAI,IAAI;QACjB;IACF;IAEA,MAAMC,YAAYC,KAAKC,KAAK,CAACT;IAC7B,MAAM7I,UAAUoJ,UAAUG,UAAU,EAAEvJ,WAAW;IAEjD,IAAI,CAACA,WAAW,CAAC,aAAa0J,IAAI,CAAC1J,UAAU;QAC3C5D,QAAQC,GAAG,CAACwM;QACZ;IACF;IAGA,MAAMsB,WAAWnK,QAAQoK,KAAK,CAAC,4BAA4BpK,QAAQoK,KAAK,CAAC;IACzE,MAAMC,YAAYF,WAAWA,QAAQ,CAAC,EAAE,GAAG;IAE3C,IAAI,CAACE,aAAa,sDAAsDX,IAAI,CAACW,YAAY;QACvFjO,QAAQC,GAAG,CAACwM;QACZ;IACF;IAEA,MAAMY,QAAQ,EAAE;IAGhB,IAAIa,SAAS;IACb,IAAIC,SAAS;IACb,IAAI;QACF,MAAM,EAAEC,QAAQ,EAAE,GAAG,MAAM,MAAM,CAAC;QAClCF,SAASE,SAAS,mCAAmC;YAAEC,UAAU;QAAO,GAAGtB,IAAI;QAG/E,MAAMuB,cAAcJ,OAAOF,KAAK,CAAC;QACjC,IAAIM,aAAa;YACfH,SAASG,WAAW,CAAC,EAAE;QACzB;IACF,EAAE,OAAM,CAER;IAGA,IAAIjM,OAAO;IACX,IAAI,+BAA+BiL,IAAI,CAACW,YAAY5L,OAAO;SACtD,IAAI,gCAAgCiL,IAAI,CAACW,YAAY5L,OAAO;SAC5D,IAAI,mCAAmCiL,IAAI,CAACW,YAAY5L,OAAO;SAC/D,IAAI,+BAA+BiL,IAAI,CAACW,YAAY5L,OAAO;SAC3D,IAAI,wBAAwBiL,IAAI,CAACW,YAAY5L,OAAO;SACpD,IAAI,wBAAwBiL,IAAI,CAACW,YAAY5L,OAAO;SACpD,IAAI,0BAA0BiL,IAAI,CAACW,YAAY5L,OAAO;IAG3D,IAAIkM,eAAeJ,SACf,CAAC,CAAC,EAAE9L,KAAK,EAAE,EAAE4L,UAAU,EAAE,EAAEE,OAAO,CAAC,CAAC,GACpC,CAAC,CAAC,EAAE9L,KAAK,EAAE,EAAE4L,WAAW;IAG5B,IAAI,CAAC,iBAAiBX,IAAI,CAAC1J,UAAU;QACnC2K,gBAAgB,CAAC,+EAA+E,CAAC;IACnG;IAGA,MAAMnB,kBAAkBxJ,QAAQsD,OAAO,CACrC,gCACA,CAAC,mBAAmB,EAAEqH,aAAa,SAAS,CAAC;IAG/ClB,MAAME,IAAI,CAAC,CAAC,iBAAiB,EAAElL,KAAK,KAAK,EAAE8L,SAAS,CAAC,GAAG,EAAEA,QAAQ,GAAG,GAAG,CAAC,CAAC;IAG1E,MAAM7M,SAAS;QACb,GAAG0L,SAAS;QACZG,YAAY;YACV,GAAGH,UAAUG,UAAU;YACvBvJ,SAASwJ;QACX;QACAI,oBAAoBH,MAAMvJ,IAAI,CAAC;IACjC;IAEA9D,QAAQC,GAAG,CAACgN,KAAKQ,SAAS,CAACnM,QAAQ,MAAM;AAC3C;AAEA,SAAS9C;IACPwB,QAAQC,GAAG,CAAC;IAEZD,QAAQC,GAAG,CAAC;IACZD,QAAQC,GAAG,CAAC;IACZD,QAAQC,GAAG,CAAC;IACZD,QAAQC,GAAG,CAAC;IACZD,QAAQC,GAAG,CAAC;IACZD,QAAQC,GAAG,CAAC;IACZD,QAAQC,GAAG,CAAC;IACZD,QAAQC,GAAG,CAAC;IACZD,QAAQC,GAAG,CAAC;IAEZD,QAAQC,GAAG,CAAC;IACZD,QAAQC,GAAG,CAAC;IACZD,QAAQC,GAAG,CAAC;IACZD,QAAQC,GAAG,CAAC;IACZD,QAAQC,GAAG,CAAC;IACZD,QAAQC,GAAG,CAAC;IACZD,QAAQC,GAAG,CAAC;IACZD,QAAQC,GAAG,CAAC;IACZD,QAAQC,GAAG,CAAC;IACZD,QAAQC,GAAG,CAAC;IACZD,QAAQC,GAAG,CAAC;IAEZD,QAAQC,GAAG,CAAC;IACZD,QAAQC,GAAG,CAAC;IACZD,QAAQC,GAAG,CAAC;IACZD,QAAQC,GAAG,CAAC;IACZD,QAAQC,GAAG,CAAC;IAEZD,QAAQC,GAAG,CAAC;IACZD,QAAQC,GAAG,CAAC;IACZD,QAAQC,GAAG,CAAC;IACZD,QAAQC,GAAG,CAAC;IACZD,QAAQC,GAAG,CAAC;IACZD,QAAQC,GAAG,CAAC;IACZD,QAAQC,GAAG,CAAC;IAEZD,QAAQC,GAAG,CAAC;IACZD,QAAQC,GAAG,CAAC;IACZD,QAAQC,GAAG,CAAC;IACZD,QAAQC,GAAG,CAAC;IACZD,QAAQC,GAAG,CAAC;IACZD,QAAQC,GAAG,CAAC;IACZD,QAAQC,GAAG,CAAC;IACZD,QAAQC,GAAG,CAAC;IACZD,QAAQC,GAAG,CAAC;IACZD,QAAQC,GAAG,CAAC;IACZD,QAAQC,GAAG,CAAC;IACZD,QAAQC,GAAG,CAAC;IACZD,QAAQC,GAAG,CAAC;IACZD,QAAQC,GAAG,CAAC;IACZD,QAAQC,GAAG,CAAC;IACZD,QAAQC,GAAG,CAAC;IAEZD,QAAQC,GAAG,CAAC;IACZD,QAAQC,GAAG,CAAC;IACZD,QAAQC,GAAG,CAAC;IACZD,QAAQC,GAAG,CAAC;IACZD,QAAQC,GAAG,CAAC;IACZD,QAAQC,GAAG,CAAC;IACZD,QAAQC,GAAG,CAAC;IACZD,QAAQC,GAAG,CAAC;IACZD,QAAQC,GAAG,CAAC;IACZD,QAAQC,GAAG,CAAC;IACZD,QAAQC,GAAG,CAAC;IACZD,QAAQC,GAAG,CAAC;IACZD,QAAQC,GAAG,CAAC;IAEZD,QAAQC,GAAG,CAAC;IACZD,QAAQC,GAAG,CAAC;IACZD,QAAQC,GAAG,CAAC;IACZD,QAAQC,GAAG,CAAC;IACZD,QAAQC,GAAG,CAAC;IACZD,QAAQC,GAAG,CAAC;AACd;AAEA,eAAehC,YAAY"}