{"version":3,"sources":["../../../../src/maestro/tests/native-hive-mind-integration.test.ts"],"sourcesContent":["/**\r\n * Native Hive Mind Integration Tests\r\n * \r\n * Comprehensive testing of the MaestroSwarmCoordinator and specs-driven\r\n * swarm topology to ensure proper integration with native hive mind.\r\n */\r\n\r\nimport { describe, beforeAll, afterAll, beforeEach, afterEach, it, expect, jest } from '@jest/globals';\r\nimport { EventBus } from '../../core/event-bus.js';\r\nimport { Logger } from '../../core/logger.js';\r\nimport { MaestroSwarmCoordinator, MaestroSwarmConfig } from '../maestro-swarm-coordinator.js';\r\nimport { HiveMindConfig } from '../../hive-mind/types.js';\r\nimport { join } from 'path';\r\nimport { tmpdir } from 'os';\r\nimport { mkdtemp, rm, access } from 'fs/promises';\r\n\r\ndescribe('Native Hive Mind Integration Tests', () => {\r\n  let swarmCoordinator: MaestroSwarmCoordinator;\r\n  let eventBus: EventBus;\r\n  let logger: Logger;\r\n  let tempDir: string;\r\n  let config: MaestroSwarmConfig;\r\n\r\n  beforeAll(async () => {\r\n    // Setup test environment\r\n    tempDir = await mkdtemp(join(tmpdir(), 'maestro-test-'));\r\n    \r\n    // Initialize core components\r\n    eventBus = new EventBus();\r\n    logger = new Logger({ level: 'debug' });\r\n    \r\n    // Configure test swarm\r\n    config = {\r\n      hiveMindConfig: {\r\n        name: 'test-maestro-specs-swarm',\r\n        topology: 'specs-driven',\r\n        queenMode: 'strategic',\r\n        maxAgents: 8,\r\n        consensusThreshold: 0.66,\r\n        memoryTTL: 60000, // 1 minute for testing\r\n        autoSpawn: true,\r\n        enableConsensus: true,\r\n        enableMemory: true,\r\n        enableCommunication: true\r\n      },\r\n      enableConsensusValidation: true,\r\n      enableLivingDocumentation: true,\r\n      enableSteeringIntegration: true,\r\n      specsDirectory: join(tempDir, 'specs'),\r\n      steeringDirectory: join(tempDir, 'steering')\r\n    };\r\n  });\r\n\r\n  afterAll(async () => {\r\n    // Cleanup\r\n    if (swarmCoordinator) {\r\n      await swarmCoordinator.shutdown();\r\n    }\r\n    await rm(tempDir, { recursive: true, force: true });\r\n  });\r\n\r\n  beforeEach(async () => {\r\n    // Create fresh coordinator for each test\r\n    swarmCoordinator = new MaestroSwarmCoordinator(config, eventBus, logger);\r\n  });\r\n\r\n  afterEach(async () => {\r\n    if (swarmCoordinator) {\r\n      await swarmCoordinator.shutdown();\r\n    }\r\n  });\r\n\r\n  describe('Swarm Initialization', () => {\r\n    it('should initialize native hive mind with specs-driven topology', async () => {\r\n      const swarmId = await swarmCoordinator.initialize();\r\n      \r\n      expect(swarmId).toBeDefined();\r\n      expect(typeof swarmId).toBe('string');\r\n      expect(swarmId).toMatch(/^swarm_/);\r\n    });\r\n\r\n    it('should spawn 8 specialized agents with correct types', async () => {\r\n      await swarmCoordinator.initialize();\r\n      \r\n      // Verify swarm status contains all expected agent types\r\n      const hiveMind = (swarmCoordinator as any).hiveMind;\r\n      const agents = hiveMind.agents;\r\n      \r\n      expect(agents.size).toBe(8);\r\n      \r\n      // Check for specs-driven agent types\r\n      const agentTypes = Array.from(agents.values()).map((agent: any) => agent.type);\r\n      expect(agentTypes).toContain('requirements_analyst');\r\n      expect(agentTypes).toContain('design_architect');\r\n      expect(agentTypes).toContain('task_planner');\r\n      expect(agentTypes).toContain('implementation_coder');\r\n      expect(agentTypes).toContain('quality_reviewer');\r\n      expect(agentTypes).toContain('steering_documenter');\r\n      \r\n      // Check agent counts\r\n      expect(agentTypes.filter(t => t === 'requirements_analyst')).toHaveLength(1);\r\n      expect(agentTypes.filter(t => t === 'design_architect')).toHaveLength(2);\r\n      expect(agentTypes.filter(t => t === 'task_planner')).toHaveLength(1);\r\n      expect(agentTypes.filter(t => t === 'implementation_coder')).toHaveLength(2);\r\n      expect(agentTypes.filter(t => t === 'quality_reviewer')).toHaveLength(1);\r\n      expect(agentTypes.filter(t => t === 'steering_documenter')).toHaveLength(1);\r\n    });\r\n\r\n    it('should initialize steering documents in swarm memory', async () => {\r\n      await swarmCoordinator.initialize();\r\n      \r\n      const hiveMind = (swarmCoordinator as any).hiveMind;\r\n      \r\n      // Check that default steering documents are initialized\r\n      const productSteering = await hiveMind.memory.retrieve('steering/product');\r\n      const techSteering = await hiveMind.memory.retrieve('steering/tech');\r\n      const workflowSteering = await hiveMind.memory.retrieve('steering/workflow');\r\n      \r\n      expect(productSteering).toBeDefined();\r\n      expect(productSteering.domain).toBe('product');\r\n      expect(techSteering).toBeDefined();\r\n      expect(techSteering.domain).toBe('tech');\r\n      expect(workflowSteering).toBeDefined();\r\n      expect(workflowSteering.domain).toBe('workflow');\r\n    });\r\n  });\r\n\r\n  describe('Specs-Driven Workflow', () => {\r\n    beforeEach(async () => {\r\n      await swarmCoordinator.initialize();\r\n    });\r\n\r\n    it('should create specification using requirements_analyst agent', async () => {\r\n      const featureName = 'test-auth-feature';\r\n      const initialRequest = 'Create user authentication system with JWT tokens';\r\n      \r\n      await swarmCoordinator.createSpec(featureName, initialRequest);\r\n      \r\n      // Verify workflow state\r\n      const workflowState = swarmCoordinator.getWorkflowState(featureName);\r\n      expect(workflowState).toBeDefined();\r\n      expect(workflowState!.featureName).toBe(featureName);\r\n      expect(workflowState!.currentPhase).toBe('Requirements Clarification');\r\n      expect(workflowState!.status).toBe('running');\r\n      \r\n      // Verify requirements file was created\r\n      const requirementsPath = join(config.specsDirectory, featureName, 'requirements.md');\r\n      await expect(access(requirementsPath)).resolves.not.toThrow();\r\n    }, 30000);\r\n\r\n    it('should generate design using parallel design_architect agents with consensus', async () => {\r\n      const featureName = 'test-design-feature';\r\n      \r\n      // First create spec\r\n      await swarmCoordinator.createSpec(featureName, 'Test feature for design generation');\r\n      \r\n      // Then generate design\r\n      await swarmCoordinator.generateDesign(featureName);\r\n      \r\n      // Verify workflow progression\r\n      const workflowState = swarmCoordinator.getWorkflowState(featureName);\r\n      expect(workflowState!.currentPhase).toBe('Research & Design');\r\n      expect(workflowState!.history).toHaveLength(2);\r\n      expect(workflowState!.history[1].phase).toBe('Research & Design');\r\n      expect(workflowState!.history[1].status).toBe('completed');\r\n      \r\n      // Verify design file was created\r\n      const designPath = join(config.specsDirectory, featureName, 'design.md');\r\n      await expect(access(designPath)).resolves.not.toThrow();\r\n    }, 60000);\r\n\r\n    it('should generate tasks using task_planner agent', async () => {\r\n      const featureName = 'test-tasks-feature';\r\n      \r\n      // Setup: create spec and design\r\n      await swarmCoordinator.createSpec(featureName, 'Test feature for task generation');\r\n      await swarmCoordinator.generateDesign(featureName);\r\n      \r\n      // Generate tasks\r\n      await swarmCoordinator.generateTasks(featureName);\r\n      \r\n      // Verify workflow progression\r\n      const workflowState = swarmCoordinator.getWorkflowState(featureName);\r\n      expect(workflowState!.currentPhase).toBe('Implementation Planning');\r\n      \r\n      // Verify tasks file was created\r\n      const tasksPath = join(config.specsDirectory, featureName, 'tasks.md');\r\n      await expect(access(tasksPath)).resolves.not.toThrow();\r\n    }, 90000);\r\n\r\n    it('should implement tasks using implementation_coder agents', async () => {\r\n      const featureName = 'test-implementation-feature';\r\n      \r\n      // Setup complete workflow\r\n      await swarmCoordinator.createSpec(featureName, 'Test feature for implementation');\r\n      await swarmCoordinator.generateDesign(featureName);\r\n      await swarmCoordinator.generateTasks(featureName);\r\n      \r\n      // Implement first task\r\n      await swarmCoordinator.implementTask(featureName, 1);\r\n      \r\n      // Verify workflow state\r\n      const workflowState = swarmCoordinator.getWorkflowState(featureName);\r\n      expect(workflowState!.currentPhase).toBe('Task Execution');\r\n      expect(workflowState!.currentTaskIndex).toBe(1);\r\n    }, 120000);\r\n  });\r\n\r\n  describe('Consensus Validation', () => {\r\n    beforeEach(async () => {\r\n      await swarmCoordinator.initialize();\r\n    });\r\n\r\n    it('should use consensus for phase approval when enabled', async () => {\r\n      const featureName = 'test-consensus-feature';\r\n      \r\n      await swarmCoordinator.createSpec(featureName, 'Test consensus validation');\r\n      \r\n      // Mock consensus engine for testing\r\n      const hiveMind = (swarmCoordinator as any).hiveMind;\r\n      const consensusEngine = hiveMind.consensus;\r\n      \r\n      jest.spyOn(consensusEngine, 'createProposal').mockResolvedValue('test-proposal-id');\r\n      jest.spyOn(consensusEngine, 'getProposalStatus').mockResolvedValue({\r\n        status: 'achieved',\r\n        currentRatio: 0.75\r\n      });\r\n      \r\n      await swarmCoordinator.approvePhase(featureName);\r\n      \r\n      expect(consensusEngine.createProposal).toHaveBeenCalled();\r\n      expect(consensusEngine.getProposalStatus).toHaveBeenCalled();\r\n    });\r\n\r\n    it('should handle consensus failure gracefully', async () => {\r\n      const featureName = 'test-consensus-failure';\r\n      \r\n      await swarmCoordinator.createSpec(featureName, 'Test consensus failure handling');\r\n      \r\n      // Mock consensus failure\r\n      const hiveMind = (swarmCoordinator as any).hiveMind;\r\n      const consensusEngine = hiveMind.consensus;\r\n      \r\n      jest.spyOn(consensusEngine, 'createProposal').mockResolvedValue('test-proposal-id');\r\n      jest.spyOn(consensusEngine, 'getProposalStatus').mockResolvedValue({\r\n        status: 'failed',\r\n        currentRatio: 0.4\r\n      });\r\n      \r\n      await expect(swarmCoordinator.approvePhase(featureName))\r\n        .rejects.toThrow('Phase approval consensus failed');\r\n    });\r\n  });\r\n\r\n  describe('Steering Integration', () => {\r\n    beforeEach(async () => {\r\n      await swarmCoordinator.initialize();\r\n    });\r\n\r\n    it('should create steering documents in swarm memory', async () => {\r\n      const domain = 'custom-steering';\r\n      const content = 'Custom steering guidelines for testing';\r\n      \r\n      await swarmCoordinator.createSteeringDocument(domain, content);\r\n      \r\n      const hiveMind = (swarmCoordinator as any).hiveMind;\r\n      const storedDoc = await hiveMind.memory.retrieve(`steering/${domain}`);\r\n      \r\n      expect(storedDoc).toBeDefined();\r\n      expect(storedDoc.content).toBe(content);\r\n      expect(storedDoc.domain).toBe(domain);\r\n      expect(storedDoc.maintainer).toBe('steering_documenter');\r\n    });\r\n\r\n    it('should broadcast steering updates to all agents', async () => {\r\n      const domain = 'broadcast-test';\r\n      const content = 'Test broadcast content';\r\n      \r\n      const hiveMind = (swarmCoordinator as any).hiveMind;\r\n      const broadcastSpy = jest.spyOn(hiveMind.communication, 'broadcast');\r\n      \r\n      await swarmCoordinator.createSteeringDocument(domain, content);\r\n      \r\n      expect(broadcastSpy).toHaveBeenCalledWith({\r\n        type: 'steering_update',\r\n        domain,\r\n        content: expect.stringContaining('Test broadcast content')\r\n      });\r\n    });\r\n\r\n    it('should retrieve steering context for agents', async () => {\r\n      await swarmCoordinator.createSteeringDocument('test-context', 'Context for testing');\r\n      \r\n      const steeringContext = await (swarmCoordinator as any).getSteeringContext();\r\n      \r\n      expect(steeringContext).toContain('test-context');\r\n      expect(steeringContext).toContain('Context for testing');\r\n    });\r\n  });\r\n\r\n  describe('Performance and Error Handling', () => {\r\n    beforeEach(async () => {\r\n      await swarmCoordinator.initialize();\r\n    });\r\n\r\n    it('should handle agent spawning limits gracefully', async () => {\r\n      // Test with reduced agent limit\r\n      const limitedConfig = {\r\n        ...config,\r\n        hiveMindConfig: {\r\n          ...config.hiveMindConfig,\r\n          maxAgents: 4\r\n        }\r\n      };\r\n      \r\n      const limitedCoordinator = new MaestroSwarmCoordinator(limitedConfig, eventBus, logger);\r\n      await limitedCoordinator.initialize();\r\n      \r\n      const hiveMind = (limitedCoordinator as any).hiveMind;\r\n      expect(hiveMind.agents.size).toBeLessThanOrEqual(4);\r\n      \r\n      await limitedCoordinator.shutdown();\r\n    });\r\n\r\n    it('should timeout on task completion properly', async () => {\r\n      const featureName = 'timeout-test';\r\n      \r\n      // Mock task that never completes\r\n      const hiveMind = (swarmCoordinator as any).hiveMind;\r\n      jest.spyOn(hiveMind, 'getTask').mockResolvedValue({\r\n        id: 'test-task',\r\n        status: 'in_progress',\r\n        result: null\r\n      });\r\n      \r\n      await expect(\r\n        (swarmCoordinator as any).waitForTaskCompletion('test-task', 1000)\r\n      ).rejects.toThrow('Task timeout');\r\n    });\r\n\r\n    it('should handle swarm shutdown gracefully', async () => {\r\n      const hiveMind = (swarmCoordinator as any).hiveMind;\r\n      const shutdownSpy = jest.spyOn(hiveMind, 'shutdown');\r\n      \r\n      await swarmCoordinator.shutdown();\r\n      \r\n      expect(shutdownSpy).toHaveBeenCalled();\r\n    });\r\n  });\r\n\r\n  describe('Event Integration', () => {\r\n    beforeEach(async () => {\r\n      await swarmCoordinator.initialize();\r\n    });\r\n\r\n    it('should emit maestro events through event bus', async () => {\r\n      const specCreatedSpy = jest.fn();\r\n      eventBus.on('maestro:spec_created', specCreatedSpy);\r\n      \r\n      await swarmCoordinator.createSpec('event-test', 'Test event emission');\r\n      \r\n      expect(specCreatedSpy).toHaveBeenCalledWith({\r\n        featureName: 'event-test'\r\n      });\r\n    });\r\n\r\n    it('should handle event-driven workflow progression', async () => {\r\n      const phaseApprovedSpy = jest.fn();\r\n      eventBus.on('maestro:phase_approved', phaseApprovedSpy);\r\n      \r\n      const featureName = 'workflow-events';\r\n      await swarmCoordinator.createSpec(featureName, 'Test workflow events');\r\n      \r\n      // Mock consensus for approval\r\n      const hiveMind = (swarmCoordinator as any).hiveMind;\r\n      const consensusEngine = hiveMind.consensus;\r\n      jest.spyOn(consensusEngine, 'createProposal').mockResolvedValue('test-proposal');\r\n      jest.spyOn(consensusEngine, 'getProposalStatus').mockResolvedValue({\r\n        status: 'achieved',\r\n        currentRatio: 0.8\r\n      });\r\n      \r\n      await swarmCoordinator.approvePhase(featureName);\r\n      \r\n      expect(phaseApprovedSpy).toHaveBeenCalledWith({\r\n        featureName,\r\n        nextPhase: 'Research & Design'\r\n      });\r\n    });\r\n  });\r\n});\r\n\r\n/**\r\n * Performance Benchmarks\r\n * \r\n * These tests measure performance improvements from native hive mind integration\r\n */\r\ndescribe('Performance Benchmarks', () => {\r\n  let coordinator: MaestroSwarmCoordinator;\r\n  let eventBus: EventBus;\r\n  let logger: Logger;\r\n  let tempDir: string;\r\n\r\n  beforeAll(async () => {\r\n    tempDir = await mkdtemp(join(tmpdir(), 'maestro-perf-'));\r\n    eventBus = new EventBus();\r\n    logger = new Logger({ level: 'warn' }); // Reduce logging for performance tests\r\n    \r\n    const config: MaestroSwarmConfig = {\r\n      hiveMindConfig: {\r\n        name: 'perf-test-swarm',\r\n        topology: 'specs-driven',\r\n        queenMode: 'strategic',\r\n        maxAgents: 8,\r\n        consensusThreshold: 0.66,\r\n        memoryTTL: 300000,\r\n        autoSpawn: true,\r\n        enableConsensus: false, // Disable for pure performance testing\r\n        enableMemory: true,\r\n        enableCommunication: true\r\n      },\r\n      enableConsensusValidation: false,\r\n      enableLivingDocumentation: true,\r\n      enableSteeringIntegration: true,\r\n      specsDirectory: join(tempDir, 'specs'),\r\n      steeringDirectory: join(tempDir, 'steering')\r\n    };\r\n    \r\n    coordinator = new MaestroSwarmCoordinator(config, eventBus, logger);\r\n    await coordinator.initialize();\r\n  });\r\n\r\n  afterAll(async () => {\r\n    await coordinator.shutdown();\r\n    await rm(tempDir, { recursive: true, force: true });\r\n  });\r\n\r\n  it('should initialize swarm within performance target (< 5 seconds)', async () => {\r\n    const startTime = Date.now();\r\n    \r\n    const testCoordinator = new MaestroSwarmCoordinator(\r\n      (coordinator as any).config,\r\n      eventBus,\r\n      logger\r\n    );\r\n    \r\n    await testCoordinator.initialize();\r\n    const duration = Date.now() - startTime;\r\n    \r\n    expect(duration).toBeLessThan(5000);\r\n    \r\n    await testCoordinator.shutdown();\r\n  });\r\n\r\n  it('should create specs within performance target (< 2 minutes)', async () => {\r\n    const startTime = Date.now();\r\n    \r\n    await coordinator.createSpec('perf-test-spec', 'Performance test specification');\r\n    \r\n    const duration = Date.now() - startTime;\r\n    expect(duration).toBeLessThan(120000); // 2 minutes\r\n  });\r\n\r\n  it('should handle multiple concurrent spec creations efficiently', async () => {\r\n    const startTime = Date.now();\r\n    const concurrentSpecs = 3;\r\n    \r\n    const promises = Array.from({ length: concurrentSpecs }, (_, i) =>\r\n      coordinator.createSpec(`concurrent-spec-${i}`, `Concurrent test spec ${i}`)\r\n    );\r\n    \r\n    await Promise.all(promises);\r\n    \r\n    const duration = Date.now() - startTime;\r\n    const avgTimePerSpec = duration / concurrentSpecs;\r\n    \r\n    // Should be more efficient than sequential execution\r\n    expect(avgTimePerSpec).toBeLessThan(90000); // < 1.5 minutes per spec on average\r\n  }, 300000);\r\n});"],"names":["describe","beforeAll","afterAll","beforeEach","afterEach","it","expect","jest","EventBus","Logger","MaestroSwarmCoordinator","join","tmpdir","mkdtemp","rm","access","swarmCoordinator","eventBus","logger","tempDir","config","level","hiveMindConfig","name","topology","queenMode","maxAgents","consensusThreshold","memoryTTL","autoSpawn","enableConsensus","enableMemory","enableCommunication","enableConsensusValidation","enableLivingDocumentation","enableSteeringIntegration","specsDirectory","steeringDirectory","shutdown","recursive","force","swarmId","initialize","toBeDefined","toBe","toMatch","hiveMind","agents","size","agentTypes","Array","from","values","map","agent","type","toContain","filter","t","toHaveLength","productSteering","memory","retrieve","techSteering","workflowSteering","domain","featureName","initialRequest","createSpec","workflowState","getWorkflowState","currentPhase","status","requirementsPath","resolves","not","toThrow","generateDesign","history","phase","designPath","generateTasks","tasksPath","implementTask","currentTaskIndex","consensusEngine","consensus","spyOn","mockResolvedValue","currentRatio","approvePhase","createProposal","toHaveBeenCalled","getProposalStatus","rejects","content","createSteeringDocument","storedDoc","maintainer","broadcastSpy","communication","toHaveBeenCalledWith","stringContaining","steeringContext","getSteeringContext","limitedConfig","limitedCoordinator","toBeLessThanOrEqual","id","result","waitForTaskCompletion","shutdownSpy","specCreatedSpy","fn","on","phaseApprovedSpy","nextPhase","coordinator","startTime","Date","now","testCoordinator","duration","toBeLessThan","concurrentSpecs","promises","length","_","i","Promise","all","avgTimePerSpec"],"mappings":"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"}