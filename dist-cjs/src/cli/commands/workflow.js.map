{"version":3,"sources":["../../../../src/cli/commands/workflow.ts"],"sourcesContent":["import { getErrorMessage } from '../../utils/error-handler.js';\r\n/**\r\n * Workflow execution commands for Claude-Flow\r\n */\r\n\r\nimport { Command } from '../commander-fix.js';\r\nimport { promises as fs } from 'node:fs';\r\nimport chalk from 'chalk';\r\nimport inquirer from 'inquirer';\r\nimport * as Table from 'cli-table3';\r\nimport { generateId } from '../../utils/helpers.js';\r\nimport { formatDuration, formatStatusIndicator, formatProgressBar } from '../formatter.js';\r\n\r\nexport const workflowCommand = new Command()\r\n  .name('workflow')\r\n  .description('Execute and manage workflows')\r\n  .action(() => {\r\n    workflowCommand.outputHelp();\r\n  })\r\n  .command('run')\r\n  .description('Execute a workflow from file')\r\n  .argument('<workflow-file>', 'Workflow file path')\r\n  .option('-d, --dry-run', 'Validate workflow without executing')\r\n  .option('-v, --variables <vars>', 'Override variables (JSON format)')\r\n  .option('-w, --watch', 'Watch workflow execution progress')\r\n  .option('--parallel', 'Allow parallel execution where possible')\r\n  .option('--fail-fast', 'Stop on first task failure')\r\n  .action(async (workflowFile: string, options: any) => {\r\n    await runWorkflow(workflowFile, options);\r\n  })\r\n  .command('validate')\r\n  .description('Validate a workflow file')\r\n  .argument('<workflow-file>', 'Workflow file path')\r\n  .option('--strict', 'Use strict validation mode')\r\n  .action(async (workflowFile: string, options: any) => {\r\n    await validateWorkflow(workflowFile, options);\r\n  })\r\n  .command('list')\r\n  .description('List running workflows')\r\n  .option('--all', 'Include completed workflows')\r\n  .option('--format <format>', 'Output format (table, json)', 'table')\r\n  .action(async (options: any) => {\r\n    await listWorkflows(options);\r\n  })\r\n  .command('status')\r\n  .description('Show workflow execution status')\r\n  .argument('<workflow-id>', 'Workflow ID')\r\n  .option('-w, --watch', 'Watch workflow progress')\r\n  .action(async (workflowId: string, options: any) => {\r\n    await showWorkflowStatus(workflowId, options);\r\n  })\r\n  .command('stop')\r\n  .description('Stop a running workflow')\r\n  .argument('<workflow-id>', 'Workflow ID')\r\n  .option('-f, --force', 'Force stop without cleanup')\r\n  .action(async (workflowId: string, options: any) => {\r\n    await stopWorkflow(workflowId, options);\r\n  })\r\n  .command('template')\r\n  .description('Generate workflow templates')\r\n  .argument('<template-type>', 'Template type')\r\n  .option('-o, --output <file>', 'Output file path')\r\n  .option('--format <format>', 'Template format (json, yaml)', 'json')\r\n  .action(async (templateType: string, options: any) => {\r\n    await generateTemplate(templateType, options);\r\n  });\r\n\r\ninterface WorkflowDefinition {\r\n  name: string;\r\n  version?: string;\r\n  description?: string;\r\n  variables?: Record<string, any>;\r\n  agents?: AgentDefinition[];\r\n  tasks: TaskDefinition[];\r\n  dependencies?: Record<string, string[]>;\r\n  settings?: WorkflowSettings;\r\n}\r\n\r\ninterface AgentDefinition {\r\n  id: string;\r\n  type: string;\r\n  name?: string;\r\n  config?: Record<string, any>;\r\n}\r\n\r\ninterface TaskDefinition {\r\n  id: string;\r\n  name?: string;\r\n  type: string;\r\n  description: string;\r\n  assignTo?: string;\r\n  depends?: string[];\r\n  input?: Record<string, any>;\r\n  timeout?: number;\r\n  retries?: number;\r\n  condition?: string;\r\n}\r\n\r\ninterface WorkflowSettings {\r\n  maxConcurrency?: number;\r\n  timeout?: number;\r\n  retryPolicy?: 'none' | 'immediate' | 'exponential';\r\n  failurePolicy?: 'fail-fast' | 'continue' | 'ignore';\r\n}\r\n\r\ninterface WorkflowExecution {\r\n  id: string;\r\n  workflowName: string;\r\n  status: 'pending' | 'running' | 'completed' | 'failed' | 'stopped';\r\n  startedAt: Date;\r\n  completedAt?: Date;\r\n  progress: {\r\n    total: number;\r\n    completed: number;\r\n    failed: number;\r\n  };\r\n  tasks: TaskExecution[];\r\n}\r\n\r\ninterface TaskExecution {\r\n  id: string;\r\n  taskId: string;\r\n  status: 'pending' | 'running' | 'completed' | 'failed' | 'skipped';\r\n  startedAt?: Date;\r\n  completedAt?: Date;\r\n  assignedAgent?: string;\r\n  error?: string;\r\n  output?: any;\r\n}\r\n\r\nasync function runWorkflow(workflowFile: string, options: any): Promise<void> {\r\n  try {\r\n    // Load and validate workflow\r\n    const workflow = await loadWorkflow(workflowFile);\r\n\r\n    if (options.dryRun) {\r\n      await validateWorkflowDefinition(workflow, true);\r\n      console.log(chalk.green('✓ Workflow validation passed'));\r\n      return;\r\n    }\r\n\r\n    // Override variables if provided\r\n    if (options.variables) {\r\n      try {\r\n        const vars = JSON.parse(options.variables);\r\n        workflow.variables = { ...workflow.variables, ...vars };\r\n      } catch (error) {\r\n        throw new Error(`Invalid variables JSON: ${(error as Error).message}`);\r\n      }\r\n    }\r\n\r\n    // Create execution plan\r\n    const execution = await createExecution(workflow);\r\n\r\n    console.log(chalk.cyan.bold('Starting workflow execution'));\r\n    console.log(`${chalk.white('Workflow:')} ${workflow.name}`);\r\n    console.log(`${chalk.white('ID:')} ${execution.id}`);\r\n    console.log(`${chalk.white('Tasks:')} ${execution.tasks.length}`);\r\n    console.log();\r\n\r\n    // Execute workflow\r\n    if (options.watch) {\r\n      await executeWorkflowWithWatch(execution, workflow, options);\r\n    } else {\r\n      await executeWorkflow(execution, workflow, options);\r\n    }\r\n  } catch (error) {\r\n    console.error(chalk.red('Workflow execution failed:'), (error as Error).message);\r\n    process.exit(1);\r\n  }\r\n}\r\n\r\nasync function validateWorkflow(workflowFile: string, options: any): Promise<void> {\r\n  try {\r\n    const workflow = await loadWorkflow(workflowFile);\r\n    await validateWorkflowDefinition(workflow, options.strict);\r\n\r\n    console.log(chalk.green('✓ Workflow validation passed'));\r\n    console.log(`${chalk.white('Name:')} ${workflow.name}`);\r\n    console.log(`${chalk.white('Tasks:')} ${workflow.tasks.length}`);\r\n    console.log(`${chalk.white('Agents:')} ${workflow.agents?.length || 0}`);\r\n\r\n    if (workflow.dependencies) {\r\n      const depCount = Object.values(workflow.dependencies).flat().length;\r\n      console.log(`${chalk.white('Dependencies:')} ${depCount}`);\r\n    }\r\n  } catch (error) {\r\n    console.error(chalk.red('✗ Workflow validation failed:'), (error as Error).message);\r\n    process.exit(1);\r\n  }\r\n}\r\n\r\nasync function listWorkflows(options: any): Promise<void> {\r\n  try {\r\n    // Mock workflow list - in production, this would query the orchestrator\r\n    const workflows = await getRunningWorkflows(options.all);\r\n\r\n    if (options.format === 'json') {\r\n      console.log(JSON.stringify(workflows, null, 2));\r\n      return;\r\n    }\r\n\r\n    if (workflows.length === 0) {\r\n      console.log(chalk.gray('No workflows found'));\r\n      return;\r\n    }\r\n\r\n    console.log(chalk.cyan.bold(`Workflows (${workflows.length})`));\r\n    console.log('─'.repeat(60));\r\n\r\n    const table = new Table.default({\r\n      head: ['ID', 'Name', 'Status', 'Progress', 'Started', 'Duration'],\r\n    });\r\n\r\n    for (const workflow of workflows) {\r\n      const statusIcon = formatStatusIndicator(workflow.status);\r\n      const progress = `${workflow.progress.completed}/${workflow.progress.total}`;\r\n      const progressBar = formatProgressBar(\r\n        workflow.progress.completed,\r\n        workflow.progress.total,\r\n        10,\r\n      );\r\n      const duration = workflow.completedAt\r\n        ? formatDuration(workflow.completedAt.getTime() - workflow.startedAt.getTime())\r\n        : formatDuration(Date.now() - workflow.startedAt.getTime());\r\n\r\n      table.push([\r\n        chalk.gray(workflow.id.substring(0, 8) + '...'),\r\n        chalk.white(workflow.workflowName),\r\n        `${statusIcon} ${workflow.status}`,\r\n        `${progressBar} ${progress}`,\r\n        workflow.startedAt.toLocaleTimeString(),\r\n        duration,\r\n      ]);\r\n    }\r\n\r\n    console.log(table.toString());\r\n  } catch (error) {\r\n    console.error(chalk.red('Failed to list workflows:'), (error as Error).message);\r\n  }\r\n}\r\n\r\nasync function showWorkflowStatus(workflowId: string, options: any): Promise<void> {\r\n  try {\r\n    if (options.watch) {\r\n      await watchWorkflowStatus(workflowId);\r\n    } else {\r\n      const execution = await getWorkflowExecution(workflowId);\r\n      displayWorkflowStatus(execution);\r\n    }\r\n  } catch (error) {\r\n    console.error(chalk.red('Failed to get workflow status:'), (error as Error).message);\r\n  }\r\n}\r\n\r\nasync function stopWorkflow(workflowId: string, options: any): Promise<void> {\r\n  try {\r\n    const execution = await getWorkflowExecution(workflowId);\r\n\r\n    if (execution.status !== 'running') {\r\n      console.log(chalk.yellow(`Workflow is not running (status: ${execution.status})`));\r\n      return;\r\n    }\r\n\r\n    if (!options.force) {\r\n      const { confirmed } = await inquirer.prompt([\r\n        {\r\n          type: 'confirm',\r\n          name: 'confirmed',\r\n          message: `Stop workflow \"${execution.workflowName}\"?`,\r\n          default: false,\r\n        },\r\n      ]);\r\n\r\n      if (!confirmed) {\r\n        console.log(chalk.gray('Stop cancelled'));\r\n        return;\r\n      }\r\n    }\r\n\r\n    console.log(chalk.yellow('Stopping workflow...'));\r\n\r\n    // Mock stopping - in production, this would call the orchestrator\r\n    if (options.force) {\r\n      console.log(chalk.red('• Force stopping all tasks'));\r\n    } else {\r\n      console.log(chalk.blue('• Gracefully stopping tasks'));\r\n      console.log(chalk.blue('• Cleaning up resources'));\r\n    }\r\n\r\n    console.log(chalk.green('✓ Workflow stopped'));\r\n  } catch (error) {\r\n    console.error(chalk.red('Failed to stop workflow:'), (error as Error).message);\r\n  }\r\n}\r\n\r\nasync function generateTemplate(templateType: string, options: any): Promise<void> {\r\n  const templates: Record<string, WorkflowDefinition> = {\r\n    research: {\r\n      name: 'Research Workflow',\r\n      description: 'Multi-stage research and analysis workflow',\r\n      variables: {\r\n        topic: 'quantum computing',\r\n        depth: 'comprehensive',\r\n      },\r\n      agents: [\r\n        { id: 'researcher', type: 'researcher', name: 'Research Agent' },\r\n        { id: 'analyst', type: 'analyst', name: 'Analysis Agent' },\r\n      ],\r\n      tasks: [\r\n        {\r\n          id: 'research-task',\r\n          type: 'research',\r\n          description: 'Research the given topic',\r\n          assignTo: 'researcher',\r\n          input: { topic: '${topic}', depth: '${depth}' },\r\n        },\r\n        {\r\n          id: 'analyze-task',\r\n          type: 'analysis',\r\n          description: 'Analyze research findings',\r\n          assignTo: 'analyst',\r\n          depends: ['research-task'],\r\n          input: { data: '${research-task.output}' },\r\n        },\r\n      ],\r\n      settings: {\r\n        maxConcurrency: 2,\r\n        timeout: 300000,\r\n        failurePolicy: 'fail-fast',\r\n      },\r\n    },\r\n    implementation: {\r\n      name: 'Implementation Workflow',\r\n      description: 'Code implementation and testing workflow',\r\n      agents: [\r\n        { id: 'implementer', type: 'implementer', name: 'Implementation Agent' },\r\n        { id: 'tester', type: 'implementer', name: 'Testing Agent' },\r\n      ],\r\n      tasks: [\r\n        {\r\n          id: 'implement',\r\n          type: 'implementation',\r\n          description: 'Implement the solution',\r\n          assignTo: 'implementer',\r\n        },\r\n        {\r\n          id: 'test',\r\n          type: 'testing',\r\n          description: 'Test the implementation',\r\n          assignTo: 'tester',\r\n          depends: ['implement'],\r\n        },\r\n      ],\r\n    },\r\n    coordination: {\r\n      name: 'Multi-Agent Coordination',\r\n      description: 'Complex multi-agent coordination workflow',\r\n      agents: [\r\n        { id: 'coordinator', type: 'coordinator', name: 'Coordinator Agent' },\r\n        { id: 'worker1', type: 'implementer', name: 'Worker Agent 1' },\r\n        { id: 'worker2', type: 'implementer', name: 'Worker Agent 2' },\r\n      ],\r\n      tasks: [\r\n        {\r\n          id: 'plan',\r\n          type: 'planning',\r\n          description: 'Create execution plan',\r\n          assignTo: 'coordinator',\r\n        },\r\n        {\r\n          id: 'work1',\r\n          type: 'implementation',\r\n          description: 'Execute part 1',\r\n          assignTo: 'worker1',\r\n          depends: ['plan'],\r\n        },\r\n        {\r\n          id: 'work2',\r\n          type: 'implementation',\r\n          description: 'Execute part 2',\r\n          assignTo: 'worker2',\r\n          depends: ['plan'],\r\n        },\r\n        {\r\n          id: 'integrate',\r\n          type: 'integration',\r\n          description: 'Integrate results',\r\n          assignTo: 'coordinator',\r\n          depends: ['work1', 'work2'],\r\n        },\r\n      ],\r\n      settings: {\r\n        maxConcurrency: 3,\r\n        failurePolicy: 'continue',\r\n      },\r\n    },\r\n  };\r\n\r\n  const template = templates[templateType];\r\n  if (!template) {\r\n    console.error(chalk.red(`Unknown template type: ${templateType}`));\r\n    console.log(chalk.gray('Available templates:'), Object.keys(templates).join(', '));\r\n    return;\r\n  }\r\n\r\n  const outputFile = options.output || `${templateType}-workflow.${options.format}`;\r\n\r\n  let content: string;\r\n  if (options.format === 'yaml') {\r\n    // In production, use a proper YAML library\r\n    console.log(chalk.yellow('YAML format not implemented, using JSON'));\r\n    content = JSON.stringify(template, null, 2);\r\n  } else {\r\n    content = JSON.stringify(template, null, 2);\r\n  }\r\n\r\n  await fs.writeFile(outputFile, content);\r\n\r\n  console.log(chalk.green('✓ Workflow template generated'));\r\n  console.log(`${chalk.white('Template:')} ${templateType}`);\r\n  console.log(`${chalk.white('File:')} ${outputFile}`);\r\n  console.log(`${chalk.white('Tasks:')} ${template.tasks.length}`);\r\n  console.log(`${chalk.white('Agents:')} ${template.agents?.length || 0}`);\r\n}\r\n\r\nasync function loadWorkflow(workflowFile: string): Promise<WorkflowDefinition> {\r\n  try {\r\n    const content = await fs.readFile(workflowFile, 'utf-8');\r\n\r\n    if (workflowFile.endsWith('.yaml') || workflowFile.endsWith('.yml')) {\r\n      // In production, use a proper YAML parser\r\n      throw new Error('YAML workflows not yet supported');\r\n    }\r\n\r\n    return JSON.parse(content) as WorkflowDefinition;\r\n  } catch (error) {\r\n    throw new Error(`Failed to load workflow file: ${getErrorMessage(error)}`);\r\n  }\r\n}\r\n\r\nasync function validateWorkflowDefinition(\r\n  workflow: WorkflowDefinition,\r\n  strict = false,\r\n): Promise<void> {\r\n  const errors: string[] = [];\r\n\r\n  // Basic validation\r\n  if (!workflow.name) errors.push('Workflow name is required');\r\n  if (!workflow.tasks || workflow.tasks.length === 0) errors.push('At least one task is required');\r\n\r\n  // Task validation\r\n  const taskIds = new Set<string>();\r\n  for (const task of workflow.tasks || []) {\r\n    if (!task.id) errors.push('Task ID is required');\r\n    if (taskIds.has(task.id)) errors.push(`Duplicate task ID: ${task.id}`);\r\n    taskIds.add(task.id);\r\n\r\n    if (!task.type) errors.push(`Task ${task.id}: type is required`);\r\n    if (!task.description) errors.push(`Task ${task.id}: description is required`);\r\n\r\n    // Validate dependencies\r\n    if (task.depends) {\r\n      for (const dep of task.depends) {\r\n        if (!taskIds.has(dep)) {\r\n          // Check if dependency exists in previous tasks\r\n          const taskIndex = workflow.tasks.indexOf(task);\r\n          const depExists = workflow.tasks.slice(0, taskIndex).some((t) => t.id === dep);\r\n          if (!depExists) {\r\n            errors.push(`Task ${task.id}: unknown dependency ${dep}`);\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  // Agent validation\r\n  if (workflow.agents) {\r\n    const agentIds = new Set<string>();\r\n    for (const agent of workflow.agents) {\r\n      if (!agent.id) errors.push('Agent ID is required');\r\n      if (agentIds.has(agent.id)) errors.push(`Duplicate agent ID: ${agent.id}`);\r\n      agentIds.add(agent.id);\r\n\r\n      if (!agent.type) errors.push(`Agent ${agent.id}: type is required`);\r\n    }\r\n\r\n    // Validate task assignments\r\n    for (const task of workflow.tasks) {\r\n      if (task.assignTo && !agentIds.has(task.assignTo)) {\r\n        errors.push(`Task ${task.id}: assigned to unknown agent ${task.assignTo}`);\r\n      }\r\n    }\r\n  }\r\n\r\n  // Strict validation\r\n  if (strict) {\r\n    // Check for circular dependencies\r\n    const graph = new Map<string, string[]>();\r\n    for (const task of workflow.tasks) {\r\n      graph.set(task.id, task.depends || []);\r\n    }\r\n\r\n    if (hasCircularDependencies(graph)) {\r\n      errors.push('Circular dependencies detected');\r\n    }\r\n  }\r\n\r\n  if (errors.length > 0) {\r\n    throw new Error('Workflow validation failed:\\n• ' + errors.join('\\n• '));\r\n  }\r\n}\r\n\r\nasync function createExecution(workflow: WorkflowDefinition): Promise<WorkflowExecution> {\r\n  const tasks: TaskExecution[] = workflow.tasks.map((task) => ({\r\n    id: generateId('task-exec'),\r\n    taskId: task.id,\r\n    status: 'pending',\r\n  }));\r\n\r\n  return {\r\n    id: generateId('workflow-exec'),\r\n    workflowName: workflow.name,\r\n    status: 'pending',\r\n    startedAt: new Date(),\r\n    progress: {\r\n      total: tasks.length,\r\n      completed: 0,\r\n      failed: 0,\r\n    },\r\n    tasks,\r\n  };\r\n}\r\n\r\nasync function executeWorkflow(\r\n  execution: WorkflowExecution,\r\n  workflow: WorkflowDefinition,\r\n  options: any,\r\n): Promise<void> {\r\n  execution.status = 'running';\r\n\r\n  console.log(chalk.blue('Executing workflow...'));\r\n  console.log();\r\n\r\n  // Mock execution - in production, this would use the orchestrator\r\n  for (let i = 0; i < execution.tasks.length; i++) {\r\n    const taskExec = execution.tasks[i];\r\n    const taskDef = workflow.tasks.find((t) => t.id === taskExec.taskId)!;\r\n\r\n    console.log(`${chalk.cyan('→')} Starting task: ${taskDef.description}`);\r\n\r\n    taskExec.status = 'running';\r\n    taskExec.startedAt = new Date();\r\n\r\n    // Simulate task execution\r\n    await new Promise((resolve) => setTimeout(resolve, 1000 + Math.random() * 2000));\r\n\r\n    // Random success/failure for demo\r\n    const success = Math.random() > 0.1; // 90% success rate\r\n\r\n    if (success) {\r\n      taskExec.status = 'completed';\r\n      taskExec.completedAt = new Date();\r\n      execution.progress.completed++;\r\n      console.log(`${chalk.green('✓')} Completed: ${taskDef.description}`);\r\n    } else {\r\n      taskExec.status = 'failed';\r\n      taskExec.completedAt = new Date();\r\n      taskExec.error = 'Simulated task failure';\r\n      execution.progress.failed++;\r\n      console.log(`${chalk.red('✗')} Failed: ${taskDef.description}`);\r\n\r\n      if (options.failFast || workflow.settings?.failurePolicy === 'fail-fast') {\r\n        execution.status = 'failed';\r\n        console.log(chalk.red('\\nWorkflow failed (fail-fast mode)'));\r\n        return;\r\n      }\r\n    }\r\n\r\n    console.log();\r\n  }\r\n\r\n  execution.status = execution.progress.failed > 0 ? 'failed' : 'completed';\r\n  execution.completedAt = new Date();\r\n\r\n  const duration = formatDuration(execution.completedAt.getTime() - execution.startedAt.getTime());\r\n\r\n  if (execution.status === 'completed') {\r\n    console.log(chalk.green.bold('✓ Workflow completed successfully'));\r\n  } else {\r\n    console.log(chalk.red.bold('✗ Workflow completed with failures'));\r\n  }\r\n\r\n  console.log(`${chalk.white('Duration:')} ${duration}`);\r\n  console.log(\r\n    `${chalk.white('Tasks:')} ${execution.progress.completed}/${execution.progress.total} completed`,\r\n  );\r\n\r\n  if (execution.progress.failed > 0) {\r\n    console.log(`${chalk.white('Failed:')} ${execution.progress.failed}`);\r\n  }\r\n}\r\n\r\nasync function executeWorkflowWithWatch(\r\n  execution: WorkflowExecution,\r\n  workflow: WorkflowDefinition,\r\n  options: any,\r\n): Promise<void> {\r\n  console.log(chalk.yellow('Starting workflow execution in watch mode...'));\r\n  console.log(chalk.gray('Press Ctrl+C to stop\\n'));\r\n\r\n  // Start execution in background and watch progress\r\n  const executionPromise = executeWorkflow(execution, workflow, options);\r\n\r\n  // Watch loop\r\n  const watchInterval = setInterval(() => {\r\n    displayWorkflowProgress(execution);\r\n  }, 1000);\r\n\r\n  try {\r\n    await executionPromise;\r\n  } finally {\r\n    clearInterval(watchInterval);\r\n    displayWorkflowProgress(execution);\r\n  }\r\n}\r\n\r\nasync function watchWorkflowStatus(workflowId: string): Promise<void> {\r\n  console.log(chalk.cyan('Watching workflow status...'));\r\n  console.log(chalk.gray('Press Ctrl+C to stop\\n'));\r\n\r\n  // eslint-disable-next-line no-constant-condition\r\n  while (true) {\r\n    try {\r\n      console.clear();\r\n      const execution = await getWorkflowExecution(workflowId);\r\n      displayWorkflowStatus(execution);\r\n\r\n      if (\r\n        execution.status === 'completed' ||\r\n        execution.status === 'failed' ||\r\n        execution.status === 'stopped'\r\n      ) {\r\n        console.log('\\n' + chalk.gray('Workflow finished. Exiting watch mode.'));\r\n        break;\r\n      }\r\n\r\n      await new Promise((resolve) => setTimeout(resolve, 2000));\r\n    } catch (error) {\r\n      console.error(chalk.red('Error watching workflow:'), (error as Error).message);\r\n      break;\r\n    }\r\n  }\r\n}\r\n\r\nfunction displayWorkflowStatus(execution: WorkflowExecution): void {\r\n  console.log(chalk.cyan.bold('Workflow Status'));\r\n  console.log('─'.repeat(50));\r\n\r\n  const statusIcon = formatStatusIndicator(execution.status);\r\n  const duration = execution.completedAt\r\n    ? formatDuration(execution.completedAt.getTime() - execution.startedAt.getTime())\r\n    : formatDuration(Date.now() - execution.startedAt.getTime());\r\n\r\n  console.log(`${chalk.white('Name:')} ${execution.workflowName}`);\r\n  console.log(`${chalk.white('ID:')} ${execution.id}`);\r\n  console.log(`${chalk.white('Status:')} ${statusIcon} ${execution.status}`);\r\n  console.log(`${chalk.white('Started:')} ${execution.startedAt.toLocaleString()}`);\r\n  console.log(`${chalk.white('Duration:')} ${duration}`);\r\n\r\n  const progressBar = formatProgressBar(\r\n    execution.progress.completed,\r\n    execution.progress.total,\r\n    40,\r\n    'Progress',\r\n  );\r\n  console.log(`${progressBar} ${execution.progress.completed}/${execution.progress.total}`);\r\n\r\n  if (execution.progress.failed > 0) {\r\n    console.log(\r\n      `${chalk.white('Failed Tasks:')} ${chalk.red(execution.progress.failed.toString())}`,\r\n    );\r\n  }\r\n  console.log();\r\n\r\n  // Task details\r\n  console.log(chalk.cyan.bold('Tasks'));\r\n  console.log('─'.repeat(50));\r\n\r\n  const table = new Table.default({\r\n    head: ['Task', 'Status', 'Duration', 'Agent'],\r\n  });\r\n\r\n  for (const taskExec of execution.tasks) {\r\n    const statusIcon = formatStatusIndicator(taskExec.status);\r\n    const duration =\r\n      taskExec.completedAt && taskExec.startedAt\r\n        ? formatDuration(taskExec.completedAt.getTime() - taskExec.startedAt.getTime())\r\n        : taskExec.startedAt\r\n          ? formatDuration(Date.now() - taskExec.startedAt.getTime())\r\n          : '-';\r\n\r\n    table.push([\r\n      chalk.white(taskExec.taskId),\r\n      `${statusIcon} ${taskExec.status}`,\r\n      duration,\r\n      taskExec.assignedAgent || '-',\r\n    ]);\r\n  }\r\n\r\n  console.log(table.toString());\r\n}\r\n\r\nfunction displayWorkflowProgress(execution: WorkflowExecution): void {\r\n  const progress = `${execution.progress.completed}/${execution.progress.total}`;\r\n  const progressBar = formatProgressBar(execution.progress.completed, execution.progress.total, 30);\r\n\r\n  console.log(`\\r${progressBar} ${progress} tasks completed`);\r\n}\r\n\r\nasync function getRunningWorkflows(includeAll = false): Promise<WorkflowExecution[]> {\r\n  // Mock workflow list - in production, this would query the orchestrator\r\n  return [\r\n    {\r\n      id: 'workflow-001',\r\n      workflowName: 'Research Workflow',\r\n      status: 'running' as const,\r\n      startedAt: new Date(Date.now() - 120000), // 2 minutes ago\r\n      progress: { total: 5, completed: 3, failed: 0 },\r\n      tasks: [],\r\n    },\r\n    {\r\n      id: 'workflow-002',\r\n      workflowName: 'Implementation Workflow',\r\n      status: 'completed' as const,\r\n      startedAt: new Date(Date.now() - 300000), // 5 minutes ago\r\n      completedAt: new Date(Date.now() - 60000), // 1 minute ago\r\n      progress: { total: 3, completed: 3, failed: 0 },\r\n      tasks: [],\r\n    },\r\n  ].filter((w) => includeAll || w.status === 'running');\r\n}\r\n\r\nasync function getWorkflowExecution(workflowId: string): Promise<WorkflowExecution> {\r\n  const workflows = await getRunningWorkflows(true);\r\n  const workflow = workflows.find((w) => w.id === workflowId || w.id.startsWith(workflowId));\r\n\r\n  if (!workflow) {\r\n    throw new Error(`Workflow '${workflowId}' not found`);\r\n  }\r\n\r\n  return workflow;\r\n}\r\n\r\nfunction hasCircularDependencies(graph: Map<string, string[]>): boolean {\r\n  const visited = new Set<string>();\r\n  const recursionStack = new Set<string>();\r\n\r\n  function hasCycle(node: string): boolean {\r\n    if (recursionStack.has(node)) return true;\r\n    if (visited.has(node)) return false;\r\n\r\n    visited.add(node);\r\n    recursionStack.add(node);\r\n\r\n    const dependencies = graph.get(node) || [];\r\n    for (const dep of dependencies) {\r\n      if (hasCycle(dep)) return true;\r\n    }\r\n\r\n    recursionStack.delete(node);\r\n    return false;\r\n  }\r\n\r\n  for (const node of graph.keys()) {\r\n    if (hasCycle(node)) return true;\r\n  }\r\n\r\n  return false;\r\n}\r\n"],"names":["getErrorMessage","Command","promises","fs","chalk","inquirer","Table","generateId","formatDuration","formatStatusIndicator","formatProgressBar","workflowCommand","name","description","action","outputHelp","command","argument","option","workflowFile","options","runWorkflow","validateWorkflow","listWorkflows","workflowId","showWorkflowStatus","stopWorkflow","templateType","generateTemplate","workflow","loadWorkflow","dryRun","validateWorkflowDefinition","console","log","green","variables","vars","JSON","parse","error","Error","message","execution","createExecution","cyan","bold","white","id","tasks","length","watch","executeWorkflowWithWatch","executeWorkflow","red","process","exit","strict","agents","dependencies","depCount","Object","values","flat","workflows","getRunningWorkflows","all","format","stringify","gray","repeat","table","default","head","statusIcon","status","progress","completed","total","progressBar","duration","completedAt","getTime","startedAt","Date","now","push","substring","workflowName","toLocaleTimeString","toString","watchWorkflowStatus","getWorkflowExecution","displayWorkflowStatus","yellow","force","confirmed","prompt","type","blue","templates","research","topic","depth","assignTo","input","depends","data","settings","maxConcurrency","timeout","failurePolicy","implementation","coordination","template","keys","join","outputFile","output","content","writeFile","readFile","endsWith","errors","taskIds","Set","task","has","add","dep","taskIndex","indexOf","depExists","slice","some","t","agentIds","agent","graph","Map","set","hasCircularDependencies","map","taskId","failed","i","taskExec","taskDef","find","Promise","resolve","setTimeout","Math","random","success","failFast","executionPromise","watchInterval","setInterval","displayWorkflowProgress","clearInterval","clear","toLocaleString","assignedAgent","includeAll","filter","w","startsWith","visited","recursionStack","hasCycle","node","get","delete"],"mappings":"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"}