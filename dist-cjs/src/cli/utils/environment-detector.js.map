{"version":3,"sources":["../../../../src/cli/utils/environment-detector.ts"],"sourcesContent":["/**\r\n * Environment Detection Utility for Claude-Flow v2.0\r\n * Detects execution environment and recommends appropriate flags\r\n */\r\n\r\nimport chalk from 'chalk';\r\n\r\nexport interface ExecutionEnvironment {\r\n  isInteractive: boolean;\r\n  isVSCode: boolean;\r\n  isVSCodeInsiders: boolean;\r\n  isCI: boolean;\r\n  isDocker: boolean;\r\n  isSSH: boolean;\r\n  isGitBash: boolean;\r\n  isWindowsTerminal: boolean;\r\n  isWSL: boolean;\r\n  isWindows: boolean;\r\n  supportsRawMode: boolean;\r\n  supportsColor: boolean;\r\n  terminalType: string;\r\n  recommendedFlags: string[];\r\n  warnings: string[];\r\n}\r\n\r\nexport interface EnvironmentOptions {\r\n  skipWarnings?: boolean;\r\n  autoApplyDefaults?: boolean;\r\n  verbose?: boolean;\r\n}\r\n\r\n/**\r\n * Detects the current execution environment\r\n */\r\nexport function detectExecutionEnvironment(options: EnvironmentOptions = {}): ExecutionEnvironment {\r\n  const env: ExecutionEnvironment = {\r\n    isInteractive: false,\r\n    isVSCode: false,\r\n    isVSCodeInsiders: false,\r\n    isCI: false,\r\n    isDocker: false,\r\n    isSSH: false,\r\n    isGitBash: false,\r\n    isWindowsTerminal: false,\r\n    isWSL: false,\r\n    isWindows: false,\r\n    supportsRawMode: false,\r\n    supportsColor: true,\r\n    terminalType: 'unknown',\r\n    recommendedFlags: [],\r\n    warnings: [],\r\n  };\r\n\r\n  // Basic TTY check\r\n  env.isInteractive = Boolean(process.stdin.isTTY && process.stdout.isTTY);\r\n\r\n  // Terminal program detection\r\n  const termProgram = process.env.TERM_PROGRAM?.toLowerCase() || '';\r\n  env.isVSCode = termProgram === 'vscode';\r\n  env.isVSCodeInsiders = termProgram === 'vscode-insiders';\r\n  env.terminalType = termProgram || process.env.TERM || 'unknown';\r\n\r\n  // CI environment detection\r\n  env.isCI = Boolean(\r\n    process.env.CI ||\r\n      process.env.GITHUB_ACTIONS ||\r\n      process.env.GITLAB_CI ||\r\n      process.env.JENKINS_URL ||\r\n      process.env.CIRCLECI ||\r\n      process.env.TRAVIS ||\r\n      process.env.BUILDKITE ||\r\n      process.env.DRONE,\r\n  );\r\n\r\n  // Docker detection\r\n  env.isDocker = Boolean(\r\n    process.env.DOCKER_CONTAINER ||\r\n      existsSync('/.dockerenv') ||\r\n      (existsSync('/proc/1/cgroup') && readFileSync('/proc/1/cgroup', 'utf8').includes('docker')),\r\n  );\r\n\r\n  // SSH detection\r\n  env.isSSH = Boolean(process.env.SSH_CLIENT || process.env.SSH_TTY);\r\n\r\n  // Git Bash detection\r\n  env.isGitBash =\r\n    process.env.TERM_PROGRAM === 'mintty' || process.env.MSYSTEM?.startsWith('MINGW') || false;\r\n\r\n  // Windows Terminal detection\r\n  env.isWindowsTerminal = Boolean(process.env.WT_SESSION);\r\n\r\n  // Windows detection\r\n  env.isWindows = process.platform === 'win32';\r\n\r\n  // WSL detection\r\n  env.isWSL = Boolean(\r\n    process.env.WSL_DISTRO_NAME ||\r\n      process.env.WSL_INTEROP ||\r\n      (existsSync('/proc/version') &&\r\n        readFileSync('/proc/version', 'utf8').toLowerCase().includes('microsoft')),\r\n  );\r\n\r\n  // Raw mode support check\r\n  env.supportsRawMode = checkRawModeSupport();\r\n\r\n  // Color support check\r\n  env.supportsColor =\r\n    process.env.NO_COLOR !== '1' &&\r\n    process.env.TERM !== 'dumb' &&\r\n    (process.stdout.isTTY || process.env.FORCE_COLOR === '1');\r\n\r\n  // Generate recommendations based on environment\r\n  generateRecommendations(env);\r\n\r\n  // Show warnings if requested\r\n  if (!options.skipWarnings && env.warnings.length > 0) {\r\n    showEnvironmentWarnings(env);\r\n  }\r\n\r\n  return env;\r\n}\r\n\r\n/**\r\n * Checks if raw mode is supported\r\n */\r\nfunction checkRawModeSupport(): boolean {\r\n  try {\r\n    if (!process.stdin.isTTY) return false;\r\n    if (typeof process.stdin.setRawMode !== 'function') return false;\r\n\r\n    // Try to set raw mode and immediately restore\r\n    const originalRawMode = process.stdin.isRaw;\r\n    process.stdin.setRawMode(true);\r\n    process.stdin.setRawMode(originalRawMode);\r\n\r\n    return true;\r\n  } catch {\r\n    return false;\r\n  }\r\n}\r\n\r\n/**\r\n * Generates recommendations based on environment\r\n */\r\nfunction generateRecommendations(env: ExecutionEnvironment): void {\r\n  // VS Code specific recommendations\r\n  if (env.isVSCode || env.isVSCodeInsiders) {\r\n    env.recommendedFlags.push('--dangerously-skip-permissions');\r\n    env.recommendedFlags.push('--non-interactive');\r\n    env.warnings.push('VS Code integrated terminal detected - interactive features may be limited');\r\n  }\r\n\r\n  // CI environment recommendations\r\n  if (env.isCI) {\r\n    env.recommendedFlags.push('--dangerously-skip-permissions');\r\n    env.recommendedFlags.push('--non-interactive');\r\n    env.recommendedFlags.push('--json');\r\n    env.warnings.push('CI environment detected - running in non-interactive mode');\r\n  }\r\n\r\n  // Docker recommendations\r\n  if (env.isDocker && !env.isInteractive) {\r\n    env.recommendedFlags.push('--dangerously-skip-permissions');\r\n    env.recommendedFlags.push('--non-interactive');\r\n    env.warnings.push('Docker container without TTY - interactive features disabled');\r\n  }\r\n\r\n  // SSH without TTY\r\n  if (env.isSSH && !env.isInteractive) {\r\n    env.recommendedFlags.push('--dangerously-skip-permissions');\r\n    env.warnings.push('SSH session without TTY - consider using ssh -t');\r\n  }\r\n\r\n  // Git Bash specific\r\n  if (env.isGitBash) {\r\n    env.warnings.push('Git Bash detected - some interactive features may not work correctly');\r\n  }\r\n\r\n  // WSL specific recommendations\r\n  if (env.isWSL) {\r\n    env.recommendedFlags.push('--no-interactive');\r\n    env.warnings.push('WSL detected - raw mode may cause hangs, using non-interactive mode');\r\n    if (!env.supportsRawMode) {\r\n      env.warnings.push('WSL subprocess context detected - interactive features disabled');\r\n    }\r\n  }\r\n\r\n  // Windows specific recommendations\r\n  if (env.isWindows && !env.isWSL) {\r\n    env.recommendedFlags.push('--compatible-ui');\r\n    env.warnings.push('Native Windows detected - using compatible UI mode');\r\n  }\r\n\r\n  // Raw mode not supported\r\n  if (!env.supportsRawMode && env.isInteractive) {\r\n    env.recommendedFlags.push('--compatible-ui');\r\n    env.warnings.push('Terminal does not support raw mode - using compatible UI');\r\n  }\r\n}\r\n\r\n/**\r\n * Shows environment warnings to the user\r\n */\r\nfunction showEnvironmentWarnings(env: ExecutionEnvironment): void {\r\n  if (env.warnings.length === 0) return;\r\n\r\n  console.log(chalk.yellow('\\n‚ö†Ô∏è  Environment Detection:'));\r\n  env.warnings.forEach((warning) => {\r\n    console.log(chalk.gray(`   ‚Ä¢ ${warning}`));\r\n  });\r\n\r\n  if (env.recommendedFlags.length > 0) {\r\n    console.log(chalk.cyan('\\nüí° Recommended flags for your environment:'));\r\n    console.log(chalk.gray(`   ${env.recommendedFlags.join(' ')}`));\r\n  }\r\n\r\n  console.log(); // Empty line for spacing\r\n}\r\n\r\n/**\r\n * Applies smart defaults based on environment\r\n */\r\nexport function applySmartDefaults<T extends Record<string, any>>(\r\n  options: T,\r\n  env?: ExecutionEnvironment,\r\n): T & { appliedDefaults: string[]; skipPermissions?: boolean; dangerouslySkipPermissions?: boolean; nonInteractive?: boolean; json?: boolean; noColor?: boolean; } {\r\n  const environment = env || detectExecutionEnvironment({ skipWarnings: true });\r\n  const appliedDefaults: string[] = [];\r\n  const enhanced = { ...options, appliedDefaults } as T & { appliedDefaults: string[]; skipPermissions?: boolean; dangerouslySkipPermissions?: boolean; nonInteractive?: boolean; json?: boolean; noColor?: boolean; };\r\n\r\n  // Apply defaults based on environment\r\n  if (\r\n    (environment.isVSCode || environment.isCI || !environment.supportsRawMode) &&\r\n    !options.hasOwnProperty('skipPermissions')\r\n  ) {\r\n    enhanced.skipPermissions = true;\r\n    enhanced.dangerouslySkipPermissions = true;\r\n    appliedDefaults.push('--dangerously-skip-permissions');\r\n  }\r\n\r\n  if (\r\n    (environment.isCI || !environment.isInteractive) &&\r\n    !options.hasOwnProperty('nonInteractive')\r\n  ) {\r\n    enhanced.nonInteractive = true;\r\n    appliedDefaults.push('--non-interactive');\r\n  }\r\n\r\n  if (environment.isCI && !options.hasOwnProperty('json')) {\r\n    enhanced.json = true;\r\n    appliedDefaults.push('--json');\r\n  }\r\n\r\n  if (!environment.supportsColor && !options.hasOwnProperty('noColor')) {\r\n    enhanced.noColor = true;\r\n    appliedDefaults.push('--no-color');\r\n  }\r\n\r\n  // Log applied defaults if verbose\r\n  if (options.verbose && appliedDefaults.length > 0) {\r\n    console.log(chalk.gray(`‚ÑπÔ∏è  Auto-applied flags: ${appliedDefaults.join(' ')}`));\r\n  }\r\n\r\n  return enhanced;\r\n}\r\n\r\n/**\r\n * Gets a human-readable environment description\r\n */\r\nexport function getEnvironmentDescription(env?: ExecutionEnvironment): string {\r\n  const environment = env || detectExecutionEnvironment({ skipWarnings: true });\r\n  const parts: string[] = [];\r\n\r\n  if (environment.isVSCode) parts.push('VS Code');\r\n  if (environment.isCI) parts.push('CI');\r\n  if (environment.isDocker) parts.push('Docker');\r\n  if (environment.isSSH) parts.push('SSH');\r\n  if (environment.isGitBash) parts.push('Git Bash');\r\n  if (environment.isWindowsTerminal) parts.push('Windows Terminal');\r\n  if (environment.isWSL) parts.push('WSL');\r\n  if (environment.isWindows && !environment.isWSL) parts.push('Windows');\r\n\r\n  if (parts.length === 0) {\r\n    parts.push(environment.terminalType);\r\n  }\r\n\r\n  const features: string[] = [];\r\n  if (environment.isInteractive) features.push('interactive');\r\n  if (environment.supportsRawMode) features.push('raw mode');\r\n  if (environment.supportsColor) features.push('color');\r\n\r\n  return `${parts.join('/')} (${features.join(', ')})`;\r\n}\r\n\r\n/**\r\n * Checks if we should use non-interactive mode\r\n */\r\nexport function shouldUseNonInteractiveMode(options?: { force?: boolean }): boolean {\r\n  if (options?.force) return true;\r\n\r\n  const env = detectExecutionEnvironment({ skipWarnings: true });\r\n  return (\r\n    !env.isInteractive ||\r\n    env.isCI ||\r\n    env.isVSCode ||\r\n    env.isWSL ||\r\n    env.isWindows ||\r\n    !env.supportsRawMode\r\n  );\r\n}\r\n\r\n// Helper functions (these would normally be imported)\r\nfunction existsSync(path: string): boolean {\r\n  try {\r\n    require('fs').accessSync(path);\r\n    return true;\r\n  } catch {\r\n    return false;\r\n  }\r\n}\r\n\r\nfunction readFileSync(path: string, encoding: string): string {\r\n  try {\r\n    return require('fs').readFileSync(path, encoding);\r\n  } catch {\r\n    return '';\r\n  }\r\n}\r\n\r\nexport default {\r\n  detectExecutionEnvironment,\r\n  applySmartDefaults,\r\n  getEnvironmentDescription,\r\n  shouldUseNonInteractiveMode,\r\n};\r\n"],"names":["chalk","detectExecutionEnvironment","options","env","isInteractive","isVSCode","isVSCodeInsiders","isCI","isDocker","isSSH","isGitBash","isWindowsTerminal","isWSL","isWindows","supportsRawMode","supportsColor","terminalType","recommendedFlags","warnings","Boolean","process","stdin","isTTY","stdout","termProgram","TERM_PROGRAM","toLowerCase","TERM","CI","GITHUB_ACTIONS","GITLAB_CI","JENKINS_URL","CIRCLECI","TRAVIS","BUILDKITE","DRONE","DOCKER_CONTAINER","existsSync","readFileSync","includes","SSH_CLIENT","SSH_TTY","MSYSTEM","startsWith","WT_SESSION","platform","WSL_DISTRO_NAME","WSL_INTEROP","checkRawModeSupport","NO_COLOR","FORCE_COLOR","generateRecommendations","skipWarnings","length","showEnvironmentWarnings","setRawMode","originalRawMode","isRaw","push","console","log","yellow","forEach","warning","gray","cyan","join","applySmartDefaults","environment","appliedDefaults","enhanced","hasOwnProperty","skipPermissions","dangerouslySkipPermissions","nonInteractive","json","noColor","verbose","getEnvironmentDescription","parts","features","shouldUseNonInteractiveMode","force","path","require","accessSync","encoding"],"mappings":"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"}