{"version":3,"sources":["../../../../src/cli/simple-commands/performance-hooks.js"],"sourcesContent":["/**\r\n * Performance Tracking Hooks\r\n * Integrates with all Claude Flow operations to track real performance metrics\r\n */\r\n\r\nimport {\r\n  trackTaskExecution,\r\n  trackAgentActivity,\r\n  trackNeuralEvent,\r\n  initializeMetrics\r\n} from './performance-metrics.js';\r\nimport { performance } from 'perf_hooks';\r\n\r\n// Track active operations\r\nconst activeOperations = new Map();\r\n\r\n// Initialize performance tracking\r\nexport async function initializePerformanceTracking() {\r\n  await initializeMetrics();\r\n  \r\n  // Hook into global events if available\r\n  if (global.claudeFlowHooks) {\r\n    global.claudeFlowHooks.on('task:start', onTaskStart);\r\n    global.claudeFlowHooks.on('task:end', onTaskEnd);\r\n    global.claudeFlowHooks.on('agent:spawn', onAgentSpawn);\r\n    global.claudeFlowHooks.on('agent:action', onAgentAction);\r\n    global.claudeFlowHooks.on('neural:event', onNeuralEvent);\r\n  }\r\n}\r\n\r\n// Task tracking\r\nexport function onTaskStart(taskId, taskType, metadata = {}) {\r\n  activeOperations.set(taskId, {\r\n    type: 'task',\r\n    taskType,\r\n    startTime: performance.now(),\r\n    metadata\r\n  });\r\n}\r\n\r\nexport async function onTaskEnd(taskId, success = true, error = null) {\r\n  const operation = activeOperations.get(taskId);\r\n  if (!operation) return;\r\n  \r\n  const duration = performance.now() - operation.startTime;\r\n  activeOperations.delete(taskId);\r\n  \r\n  await trackTaskExecution(\r\n    taskId,\r\n    operation.taskType,\r\n    success,\r\n    duration,\r\n    {\r\n      ...operation.metadata,\r\n      error: error ? error.message : undefined\r\n    }\r\n  );\r\n}\r\n\r\n// Agent tracking\r\nexport async function onAgentSpawn(agentId, agentType, metadata = {}) {\r\n  const startTime = performance.now();\r\n  \r\n  await trackAgentActivity(\r\n    agentId,\r\n    agentType,\r\n    'spawn',\r\n    performance.now() - startTime,\r\n    true\r\n  );\r\n}\r\n\r\nexport function onAgentActionStart(agentId, agentType, action) {\r\n  const key = `${agentId}:${action}`;\r\n  activeOperations.set(key, {\r\n    type: 'agent',\r\n    agentId,\r\n    agentType,\r\n    action,\r\n    startTime: performance.now()\r\n  });\r\n}\r\n\r\nexport async function onAgentAction(agentId, agentType, action, success = true) {\r\n  const key = `${agentId}:${action}`;\r\n  const operation = activeOperations.get(key);\r\n  \r\n  if (operation) {\r\n    const duration = performance.now() - operation.startTime;\r\n    activeOperations.delete(key);\r\n    \r\n    await trackAgentActivity(\r\n      agentId,\r\n      agentType,\r\n      action,\r\n      duration,\r\n      success\r\n    );\r\n  } else {\r\n    // Quick action without start tracking\r\n    await trackAgentActivity(\r\n      agentId,\r\n      agentType,\r\n      action,\r\n      0,\r\n      success\r\n    );\r\n  }\r\n}\r\n\r\n// Neural event tracking\r\nexport async function onNeuralEvent(eventType, metadata = {}) {\r\n  await trackNeuralEvent(eventType, metadata);\r\n}\r\n\r\n// Wrapper functions for easy integration\r\nexport function wrapTaskExecution(taskId, taskType, fn, metadata = {}) {\r\n  return async (...args) => {\r\n    onTaskStart(taskId, taskType, metadata);\r\n    try {\r\n      const result = await fn(...args);\r\n      await onTaskEnd(taskId, true);\r\n      return result;\r\n    } catch (error) {\r\n      await onTaskEnd(taskId, false, error);\r\n      throw error;\r\n    }\r\n  };\r\n}\r\n\r\nexport function wrapAgentAction(agentId, agentType, action, fn) {\r\n  return async (...args) => {\r\n    onAgentActionStart(agentId, agentType, action);\r\n    try {\r\n      const result = await fn(...args);\r\n      await onAgentAction(agentId, agentType, action, true);\r\n      return result;\r\n    } catch (error) {\r\n      await onAgentAction(agentId, agentType, action, false);\r\n      throw error;\r\n    }\r\n  };\r\n}\r\n\r\n// Integration helpers for existing commands\r\nexport function trackCommand(commandName) {\r\n  return function decorator(target, propertyKey, descriptor) {\r\n    const originalMethod = descriptor.value;\r\n    \r\n    descriptor.value = async function(...args) {\r\n      const taskId = `cmd-${commandName}-${Date.now()}`;\r\n      return wrapTaskExecution(taskId, commandName, originalMethod.bind(this))(...args);\r\n    };\r\n    \r\n    return descriptor;\r\n  };\r\n}\r\n\r\n// Manual tracking for commands that don't use decorators\r\nexport async function trackCommandExecution(commandName, fn, ...args) {\r\n  const taskId = `cmd-${commandName}-${Date.now()}`;\r\n  return wrapTaskExecution(taskId, commandName, fn)(...args);\r\n}\r\n\r\n// Export a simple API for manual tracking\r\nexport const performanceTracker = {\r\n  startTask: onTaskStart,\r\n  endTask: onTaskEnd,\r\n  trackAgent: onAgentAction,\r\n  trackNeural: onNeuralEvent,\r\n  wrapTask: wrapTaskExecution,\r\n  wrapAgent: wrapAgentAction\r\n};"],"names":["trackTaskExecution","trackAgentActivity","trackNeuralEvent","initializeMetrics","performance","activeOperations","Map","initializePerformanceTracking","global","claudeFlowHooks","on","onTaskStart","onTaskEnd","onAgentSpawn","onAgentAction","onNeuralEvent","taskId","taskType","metadata","set","type","startTime","now","success","error","operation","get","duration","delete","message","undefined","agentId","agentType","onAgentActionStart","action","key","eventType","wrapTaskExecution","fn","args","result","wrapAgentAction","trackCommand","commandName","decorator","target","propertyKey","descriptor","originalMethod","value","Date","bind","trackCommandExecution","performanceTracker","startTask","endTask","trackAgent","trackNeural","wrapTask","wrapAgent"],"mappings":"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"}