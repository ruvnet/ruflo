{"version":3,"sources":["../../../../src/services/agentic-flow-hooks/index.ts"],"sourcesContent":["/**\r\n * Agentic Flow Hook System\r\n * \r\n * Main entry point for the hook system integration with agentic-flow.\r\n * Provides initialization, registration, and management of all hook types.\r\n */\r\n\r\nimport { agenticHookManager } from './hook-manager.js';\r\nimport { registerLLMHooks } from './llm-hooks.js';\r\nimport { registerMemoryHooks } from './memory-hooks.js';\r\nimport { registerNeuralHooks } from './neural-hooks.js';\r\nimport { registerPerformanceHooks } from './performance-hooks.js';\r\nimport { registerWorkflowHooks } from './workflow-hooks.js';\r\nimport { Logger } from '../../core/logger.js';\r\n\r\nexport * from './types.js';\r\nexport { agenticHookManager } from './hook-manager.js';\r\nexport * from './llm-hooks.js';\r\nexport * from './memory-hooks.js';\r\nexport * from './neural-hooks.js';\r\nexport * from './performance-hooks.js';\r\nexport * from './workflow-hooks.js';\r\n\r\nconst logger = new Logger({\r\n  level: 'info',\r\n  format: 'text',\r\n  destination: 'console'\r\n}, { prefix: 'AgenticFlowHooks' });\r\n\r\n/**\r\n * Initialize the agentic-flow hook system\r\n */\r\nexport async function initializeAgenticFlowHooks(): Promise<void> {\r\n  logger.info('Initializing agentic-flow hook system...');\r\n  \r\n  try {\r\n    // Register all hook types\r\n    registerLLMHooks();\r\n    logger.debug('LLM hooks registered');\r\n    \r\n    registerMemoryHooks();\r\n    logger.debug('Memory hooks registered');\r\n    \r\n    registerNeuralHooks();\r\n    logger.debug('Neural hooks registered');\r\n    \r\n    registerPerformanceHooks();\r\n    logger.debug('Performance hooks registered');\r\n    \r\n    registerWorkflowHooks();\r\n    logger.debug('Workflow hooks registered');\r\n    \r\n    // Set up default pipelines\r\n    await setupDefaultPipelines();\r\n    \r\n    // Initialize metrics collection\r\n    startMetricsCollection();\r\n    \r\n    logger.info('Agentic-flow hook system initialized successfully');\r\n  } catch (error) {\r\n    logger.error('Failed to initialize agentic-flow hooks:', error);\r\n    throw error;\r\n  }\r\n}\r\n\r\n/**\r\n * Set up default hook pipelines\r\n */\r\nasync function setupDefaultPipelines(): Promise<void> {\r\n  // LLM Call Pipeline\r\n  agenticHookManager.createPipeline({\r\n    id: 'llm-call-pipeline',\r\n    name: 'LLM Call Pipeline',\r\n    stages: [\r\n      {\r\n        name: 'pre-call',\r\n        hooks: agenticHookManager.getHooks('pre-llm-call'),\r\n        parallel: false,\r\n      },\r\n      {\r\n        name: 'call-execution',\r\n        hooks: [], // Actual LLM call happens here\r\n        parallel: false,\r\n      },\r\n      {\r\n        name: 'post-call',\r\n        hooks: agenticHookManager.getHooks('post-llm-call'),\r\n        parallel: true,\r\n      },\r\n    ],\r\n    errorStrategy: 'continue',\r\n  });\r\n  \r\n  // Memory Operation Pipeline\r\n  agenticHookManager.createPipeline({\r\n    id: 'memory-operation-pipeline',\r\n    name: 'Memory Operation Pipeline',\r\n    stages: [\r\n      {\r\n        name: 'validation',\r\n        hooks: agenticHookManager.getHooks('pre-memory-store'),\r\n        parallel: false,\r\n      },\r\n      {\r\n        name: 'storage',\r\n        hooks: agenticHookManager.getHooks('post-memory-store'),\r\n        parallel: true,\r\n      },\r\n      {\r\n        name: 'sync',\r\n        hooks: agenticHookManager.getHooks('memory-sync'),\r\n        parallel: true,\r\n        condition: (ctx) => ctx.metadata.crossProvider === true,\r\n      },\r\n    ],\r\n    errorStrategy: 'rollback',\r\n  });\r\n  \r\n  // Workflow Execution Pipeline\r\n  agenticHookManager.createPipeline({\r\n    id: 'workflow-execution-pipeline',\r\n    name: 'Workflow Execution Pipeline',\r\n    stages: [\r\n      {\r\n        name: 'initialization',\r\n        hooks: agenticHookManager.getHooks('workflow-start'),\r\n        parallel: false,\r\n      },\r\n      {\r\n        name: 'execution',\r\n        hooks: [\r\n          ...agenticHookManager.getHooks('workflow-step'),\r\n          ...agenticHookManager.getHooks('workflow-decision'),\r\n        ],\r\n        parallel: false,\r\n      },\r\n      {\r\n        name: 'completion',\r\n        hooks: agenticHookManager.getHooks('workflow-complete'),\r\n        parallel: true,\r\n      },\r\n    ],\r\n    errorStrategy: 'fail-fast',\r\n  });\r\n}\r\n\r\n/**\r\n * Start background metrics collection\r\n */\r\nfunction startMetricsCollection(): void {\r\n  // Collect metrics every 30 seconds\r\n  setInterval(() => {\r\n    const metrics = agenticHookManager.getMetrics();\r\n    \r\n    // Log high-level metrics\r\n    logger.debug('Hook system metrics:', {\r\n      totalHooks: metrics['hooks.count'],\r\n      totalExecutions: metrics['hooks.executions'],\r\n      errorRate: metrics['hooks.errors'] / metrics['hooks.executions'] || 0,\r\n      cacheHitRate: metrics['hooks.cacheHits'] / metrics['hooks.executions'] || 0,\r\n    });\r\n    \r\n    // Emit metrics event\r\n    agenticHookManager.emit('metrics:collected', metrics);\r\n  }, 30000);\r\n}\r\n\r\n/**\r\n * Shutdown the hook system gracefully\r\n */\r\nexport async function shutdownAgenticFlowHooks(): Promise<void> {\r\n  logger.info('Shutting down agentic-flow hook system...');\r\n  \r\n  try {\r\n    // Wait for active executions to complete\r\n    const maxWaitTime = 10000; // 10 seconds\r\n    const startTime = Date.now();\r\n    \r\n    while (agenticHookManager.getMetrics()['executions.active'] > 0) {\r\n      if (Date.now() - startTime > maxWaitTime) {\r\n        logger.warn('Timeout waiting for active executions to complete');\r\n        break;\r\n      }\r\n      await new Promise(resolve => setTimeout(resolve, 100));\r\n    }\r\n    \r\n    // Remove all listeners\r\n    agenticHookManager.removeAllListeners();\r\n    \r\n    logger.info('Agentic-flow hook system shut down successfully');\r\n  } catch (error) {\r\n    logger.error('Error during hook system shutdown:', error);\r\n    throw error;\r\n  }\r\n}\r\n\r\n/**\r\n * Get hook system status\r\n */\r\nexport function getHookSystemStatus(): {\r\n  initialized: boolean;\r\n  metrics: Record<string, any>;\r\n  pipelines: string[];\r\n  activeExecutions: number;\r\n} {\r\n  const metrics = agenticHookManager.getMetrics();\r\n  \r\n  return {\r\n    initialized: metrics['hooks.count'] > 0,\r\n    metrics,\r\n    pipelines: [\r\n      'llm-call-pipeline',\r\n      'memory-operation-pipeline',\r\n      'workflow-execution-pipeline',\r\n    ],\r\n    activeExecutions: metrics['executions.active'] || 0,\r\n  };\r\n}\r\n\r\n/**\r\n * Create a context builder for hook execution\r\n */\r\nexport function createHookContext(): HookContextBuilder {\r\n  class ContextBuilder implements HookContextBuilder {\r\n    private context: Partial<AgenticHookContext> = {\r\n      timestamp: Date.now(),\r\n      correlationId: this.generateCorrelationId(),\r\n      metadata: {},\r\n    };\r\n    \r\n    withSession(sessionId: string): HookContextBuilder {\r\n      this.context.sessionId = sessionId;\r\n      return this;\r\n    }\r\n    \r\n    withMemory(namespace: string, provider: string): HookContextBuilder {\r\n      this.context.memory = {\r\n        namespace,\r\n        provider,\r\n        cache: new Map(),\r\n      };\r\n      return this;\r\n    }\r\n    \r\n    withNeural(modelId: string): HookContextBuilder {\r\n      this.context.neural = {\r\n        modelId,\r\n        patterns: this.createPatternStore(),\r\n        training: {\r\n          epoch: 0,\r\n          loss: 0,\r\n          accuracy: 0,\r\n          learningRate: 0.001,\r\n          optimizer: 'adam',\r\n          checkpoints: [],\r\n        },\r\n      };\r\n      return this;\r\n    }\r\n    \r\n    withPerformance(metrics: PerformanceMetric[]): HookContextBuilder {\r\n      const metricsMap = new Map<string, PerformanceMetric>();\r\n      metrics.forEach(m => metricsMap.set(m.name, m));\r\n      \r\n      this.context.performance = {\r\n        metrics: metricsMap,\r\n        bottlenecks: [],\r\n        optimizations: [],\r\n      };\r\n      return this;\r\n    }\r\n    \r\n    withMetadata(metadata: Record<string, any>): HookContextBuilder {\r\n      this.context.metadata = { ...this.context.metadata, ...metadata };\r\n      return this;\r\n    }\r\n    \r\n    build(): AgenticHookContext {\r\n      if (!this.context.sessionId) {\r\n        this.context.sessionId = this.generateSessionId();\r\n      }\r\n      \r\n      if (!this.context.memory) {\r\n        this.context.memory = {\r\n          namespace: 'default',\r\n          provider: 'memory',\r\n          cache: new Map(),\r\n        };\r\n      }\r\n      \r\n      if (!this.context.neural) {\r\n        this.context.neural = {\r\n          modelId: 'default',\r\n          patterns: this.createPatternStore(),\r\n          training: {\r\n            epoch: 0,\r\n            loss: 0,\r\n            accuracy: 0,\r\n            learningRate: 0.001,\r\n            optimizer: 'adam',\r\n            checkpoints: [],\r\n          },\r\n        };\r\n      }\r\n      \r\n      if (!this.context.performance) {\r\n        this.context.performance = {\r\n          metrics: new Map(),\r\n          bottlenecks: [],\r\n          optimizations: [],\r\n        };\r\n      }\r\n      \r\n      return this.context as AgenticHookContext;\r\n    }\r\n    \r\n    private generateCorrelationId(): string {\r\n      return `corr_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;\r\n    }\r\n    \r\n    private generateSessionId(): string {\r\n      return `sess_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;\r\n    }\r\n    \r\n    private createPatternStore(): PatternStore {\r\n      const patterns = new Map<string, Pattern>();\r\n      \r\n      return {\r\n        add(pattern: Pattern): void {\r\n          patterns.set(pattern.id, pattern);\r\n        },\r\n        \r\n        get(id: string): Pattern | undefined {\r\n          return patterns.get(id);\r\n        },\r\n        \r\n        findSimilar(pattern: Partial<Pattern>, threshold: number): Pattern[] {\r\n          const results: Pattern[] = [];\r\n          \r\n          for (const p of patterns.values()) {\r\n            // Simple similarity check\r\n            if (p.type === pattern.type && p.confidence >= threshold) {\r\n              results.push(p);\r\n            }\r\n          }\r\n          \r\n          return results;\r\n        },\r\n        \r\n        getByType(type: Pattern['type']): Pattern[] {\r\n          return Array.from(patterns.values()).filter(p => p.type === type);\r\n        },\r\n        \r\n        prune(maxAge: number): void {\r\n          const cutoff = Date.now() - maxAge;\r\n          for (const [id, pattern] of patterns) {\r\n            if (pattern.context.timestamp < cutoff) {\r\n              patterns.delete(id);\r\n            }\r\n          }\r\n        },\r\n        \r\n        export(): Pattern[] {\r\n          return Array.from(patterns.values());\r\n        },\r\n        \r\n        import(newPatterns: Pattern[]): void {\r\n          for (const pattern of newPatterns) {\r\n            patterns.set(pattern.id, pattern);\r\n          }\r\n        },\r\n      };\r\n    }\r\n  }\r\n  \r\n  return new ContextBuilder();\r\n}\r\n\r\n// Import types for the context builder\r\nimport type {\r\n  AgenticHookContext,\r\n  HookContextBuilder,\r\n  PatternStore,\r\n  Pattern,\r\n  PerformanceMetric,\r\n} from './types.js';"],"names":["agenticHookManager","registerLLMHooks","registerMemoryHooks","registerNeuralHooks","registerPerformanceHooks","registerWorkflowHooks","Logger","logger","level","format","destination","prefix","initializeAgenticFlowHooks","info","debug","setupDefaultPipelines","startMetricsCollection","error","createPipeline","id","name","stages","hooks","getHooks","parallel","errorStrategy","condition","ctx","metadata","crossProvider","setInterval","metrics","getMetrics","totalHooks","totalExecutions","errorRate","cacheHitRate","emit","shutdownAgenticFlowHooks","maxWaitTime","startTime","Date","now","warn","Promise","resolve","setTimeout","removeAllListeners","getHookSystemStatus","initialized","pipelines","activeExecutions","createHookContext","ContextBuilder","context","timestamp","correlationId","generateCorrelationId","withSession","sessionId","withMemory","namespace","provider","memory","cache","Map","withNeural","modelId","neural","patterns","createPatternStore","training","epoch","loss","accuracy","learningRate","optimizer","checkpoints","withPerformance","metricsMap","forEach","m","set","performance","bottlenecks","optimizations","withMetadata","build","generateSessionId","Math","random","toString","substr","add","pattern","get","findSimilar","threshold","results","p","values","type","confidence","push","getByType","Array","from","filter","prune","maxAge","cutoff","delete","export","import","newPatterns"],"mappings":"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"}