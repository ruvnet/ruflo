{"version":3,"sources":["../../../../src/cli/init/index.ts"],"sourcesContent":["// init/index.ts - Main init command orchestrator\r\nimport { printSuccess, printError } from '../utils.js';\r\nimport { createDirectoryStructure } from './directory-structure.js';\r\nimport { createSwarmCommands } from './swarm-commands.js';\r\nimport { createSparcEnvironment } from './sparc-environment.js';\r\nimport { createClaudeConfig } from './claude-config.js';\r\nimport { createBatchToolsGuide } from './batch-tools.js';\r\nimport { errorRecovery } from '../../utils/error-recovery.js';\r\n\r\nexport interface InitOptions {\r\n  sparc?: boolean;\r\n  force?: boolean;\r\n}\r\n\r\nexport async function initCommand(options: InitOptions = {}) {\r\n  // Wrap entire initialization in retry logic with automatic recovery\r\n  return errorRecovery.retryWithRecovery(\r\n    async () => {\r\n      try {\r\n        const fs = await import('fs/promises');\r\n        const path = await import('path');\r\n\r\n        printSuccess('Initializing Claude-Flow project...');\r\n\r\n        // Check WSL environment and apply fixes proactively\r\n        if (errorRecovery.isWSL()) {\r\n          console.log('ðŸ” WSL environment detected');\r\n          const wslCheck = await errorRecovery.recoverWSLErrors();\r\n          if (wslCheck.recovered) {\r\n            console.log('âœ… WSL environment optimized\\n');\r\n          }\r\n        }\r\n\r\n        // Phase 1: Create directory structure\r\n        console.log('\\nðŸ“ Phase 1: Creating directory structure...');\r\n        await createDirectoryStructure();\r\n\r\n        // Phase 2: Create base configuration\r\n        console.log('\\nâš™ï¸  Phase 2: Creating configuration...');\r\n        await createClaudeConfig(options);\r\n\r\n        // Phase 3: Create swarm commands and documentation\r\n        console.log('\\nðŸ¤– Phase 3: Creating swarm commands...');\r\n        await createSwarmCommands();\r\n\r\n        // Phase 4: Create batch tools guides\r\n        console.log('\\nðŸ”§ Phase 4: Creating batch tools guides...');\r\n        await createBatchToolsGuide();\r\n\r\n        // Phase 5: SPARC environment (if requested)\r\n        if (options.sparc) {\r\n          console.log('\\nðŸš€ Phase 5: Creating SPARC environment...');\r\n          await createSparcEnvironment();\r\n        }\r\n\r\n        // Success summary\r\n        console.log('\\nðŸŽ‰ Project initialized successfully!');\r\n        console.log('   ðŸ“ Created .claude/ directory structure');\r\n        console.log('   ðŸ“‹ Created comprehensive swarm command documentation');\r\n        console.log('   ðŸ”§ Created batch tools coordination guides');\r\n        console.log('   ðŸ“– Created detailed usage examples with orchestration');\r\n\r\n        console.log('\\n   Next steps:');\r\n        console.log('   1. Run \"claude-flow swarm --help\" to see swarm options');\r\n        console.log('   2. Check .claude/commands/swarm/ for detailed documentation');\r\n        console.log('   3. Review batch tools guide for orchestration patterns');\r\n        console.log('   4. Run \"claude-flow help\" for all available commands');\r\n\r\n        if (options.sparc) {\r\n          console.log('   5. Run \"claude-flow sparc modes\" to see available SPARC modes');\r\n          console.log('   6. Use TodoWrite/TodoRead for task coordination');\r\n          console.log('   7. Use Task tool for parallel agent execution');\r\n        }\r\n      } catch (error) {\r\n        // Attempt automatic error recovery\r\n        const recovery = await errorRecovery.recoverInitErrors(error);\r\n\r\n        if (recovery.recovered) {\r\n          console.log('âœ… Recovered from error, retrying initialization...\\n');\r\n          throw error; // Trigger retry\r\n        } else {\r\n          printError(\r\n            `Failed to initialize project: ${error instanceof Error ? error.message : String(error)}`,\r\n          );\r\n          throw error;\r\n        }\r\n      }\r\n    },\r\n    {\r\n      maxRetries: options.force ? 5 : 3,\r\n      delay: 1000,\r\n      onRetry: (attempt, error) => {\r\n        console.log(`\\nðŸ”„ Retry attempt ${attempt} after error recovery...`);\r\n      }\r\n    }\r\n  );\r\n}\r\n"],"names":["printSuccess","printError","createDirectoryStructure","createSwarmCommands","createSparcEnvironment","createClaudeConfig","createBatchToolsGuide","errorRecovery","initCommand","options","retryWithRecovery","fs","path","isWSL","console","log","wslCheck","recoverWSLErrors","recovered","sparc","error","recovery","recoverInitErrors","Error","message","String","maxRetries","force","delay","onRetry","attempt"],"mappings":"AACA,SAASA,YAAY,EAAEC,UAAU,QAAQ,cAAc;AACvD,SAASC,wBAAwB,QAAQ,2BAA2B;AACpE,SAASC,mBAAmB,QAAQ,sBAAsB;AAC1D,SAASC,sBAAsB,QAAQ,yBAAyB;AAChE,SAASC,kBAAkB,QAAQ,qBAAqB;AACxD,SAASC,qBAAqB,QAAQ,mBAAmB;AACzD,SAASC,aAAa,QAAQ,gCAAgC;AAO9D,OAAO,eAAeC,YAAYC,UAAuB,CAAC,CAAC;IAEzD,OAAOF,cAAcG,iBAAiB,CACpC;QACE,IAAI;YACF,MAAMC,KAAK,MAAM,MAAM,CAAC;YACxB,MAAMC,OAAO,MAAM,MAAM,CAAC;YAE1BZ,aAAa;YAGb,IAAIO,cAAcM,KAAK,IAAI;gBACzBC,QAAQC,GAAG,CAAC;gBACZ,MAAMC,WAAW,MAAMT,cAAcU,gBAAgB;gBACrD,IAAID,SAASE,SAAS,EAAE;oBACtBJ,QAAQC,GAAG,CAAC;gBACd;YACF;YAGAD,QAAQC,GAAG,CAAC;YACZ,MAAMb;YAGNY,QAAQC,GAAG,CAAC;YACZ,MAAMV,mBAAmBI;YAGzBK,QAAQC,GAAG,CAAC;YACZ,MAAMZ;YAGNW,QAAQC,GAAG,CAAC;YACZ,MAAMT;YAGN,IAAIG,QAAQU,KAAK,EAAE;gBACjBL,QAAQC,GAAG,CAAC;gBACZ,MAAMX;YACR;YAGAU,QAAQC,GAAG,CAAC;YACZD,QAAQC,GAAG,CAAC;YACZD,QAAQC,GAAG,CAAC;YACZD,QAAQC,GAAG,CAAC;YACZD,QAAQC,GAAG,CAAC;YAEZD,QAAQC,GAAG,CAAC;YACZD,QAAQC,GAAG,CAAC;YACZD,QAAQC,GAAG,CAAC;YACZD,QAAQC,GAAG,CAAC;YACZD,QAAQC,GAAG,CAAC;YAEZ,IAAIN,QAAQU,KAAK,EAAE;gBACjBL,QAAQC,GAAG,CAAC;gBACZD,QAAQC,GAAG,CAAC;gBACZD,QAAQC,GAAG,CAAC;YACd;QACF,EAAE,OAAOK,OAAO;YAEd,MAAMC,WAAW,MAAMd,cAAce,iBAAiB,CAACF;YAEvD,IAAIC,SAASH,SAAS,EAAE;gBACtBJ,QAAQC,GAAG,CAAC;gBACZ,MAAMK;YACR,OAAO;gBACLnB,WACE,CAAC,8BAA8B,EAAEmB,iBAAiBG,QAAQH,MAAMI,OAAO,GAAGC,OAAOL,QAAQ;gBAE3F,MAAMA;YACR;QACF;IACF,GACA;QACEM,YAAYjB,QAAQkB,KAAK,GAAG,IAAI;QAChCC,OAAO;QACPC,SAAS,CAACC,SAASV;YACjBN,QAAQC,GAAG,CAAC,CAAC,mBAAmB,EAAEe,QAAQ,wBAAwB,CAAC;QACrE;IACF;AAEJ"}