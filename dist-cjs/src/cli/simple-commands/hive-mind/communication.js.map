{"version":3,"sources":["../../../../../src/cli/simple-commands/hive-mind/communication.js"],"sourcesContent":["/**\r\n * Swarm Communication System for Hive Mind\r\n * Handles inter-agent messaging and coordination\r\n */\r\n\r\nimport EventEmitter from 'events';\r\nimport crypto from 'crypto';\r\n\r\n/**\r\n * Message types and their priorities\r\n */\r\nconst MESSAGE_TYPES = {\r\n  command: { priority: 1, reliable: true, encrypted: true },\r\n  query: { priority: 2, reliable: true, encrypted: false },\r\n  response: { priority: 2, reliable: true, encrypted: false },\r\n  broadcast: { priority: 3, reliable: false, encrypted: false },\r\n  heartbeat: { priority: 4, reliable: false, encrypted: false },\r\n  consensus: { priority: 1, reliable: true, encrypted: true },\r\n  task: { priority: 2, reliable: true, encrypted: false },\r\n  result: { priority: 2, reliable: true, encrypted: false },\r\n  error: { priority: 1, reliable: true, encrypted: false },\r\n  sync: { priority: 3, reliable: true, encrypted: false },\r\n};\r\n\r\n/**\r\n * Communication protocols\r\n */\r\nconst PROTOCOLS = {\r\n  direct: 'direct', // Point-to-point\r\n  broadcast: 'broadcast', // One-to-all\r\n  multicast: 'multicast', // One-to-many\r\n  gossip: 'gossip', // Epidemic spread\r\n  consensus: 'consensus', // Byzantine agreement\r\n};\r\n\r\n/**\r\n * SwarmCommunication class\r\n */\r\nexport class SwarmCommunication extends EventEmitter {\r\n  constructor(config = {}) {\r\n    super();\r\n\r\n    this.config = {\r\n      swarmId: config.swarmId,\r\n      encryption: config.encryption || false,\r\n      maxRetries: config.maxRetries || 3,\r\n      timeout: config.timeout || 5000,\r\n      bufferSize: config.bufferSize || 1000,\r\n      gossipFanout: config.gossipFanout || 3,\r\n      consensusQuorum: config.consensusQuorum || 0.67,\r\n      ...config,\r\n    };\r\n\r\n    this.state = {\r\n      agents: new Map(), // Connected agents\r\n      channels: new Map(), // Communication channels\r\n      messageBuffer: [], // Message queue\r\n      messageHistory: new Map(), // Sent messages\r\n      metrics: {\r\n        sent: 0,\r\n        received: 0,\r\n        failed: 0,\r\n        encrypted: 0,\r\n        latency: [],\r\n      },\r\n    };\r\n\r\n    this.encryptionKey = this.config.encryption ? crypto.randomBytes(32) : null;\r\n\r\n    this._initialize();\r\n  }\r\n\r\n  /**\r\n   * Initialize communication system\r\n   */\r\n  _initialize() {\r\n    // Set up message processing\r\n    this.messageProcessor = setInterval(() => {\r\n      this._processMessageBuffer();\r\n    }, 100);\r\n\r\n    // Set up heartbeat\r\n    this.heartbeatTimer = setInterval(() => {\r\n      this._sendHeartbeats();\r\n    }, 10000);\r\n\r\n    this.emit('communication:initialized', { swarmId: this.config.swarmId });\r\n  }\r\n\r\n  /**\r\n   * Register agent in communication network\r\n   */\r\n  registerAgent(agentId, metadata = {}) {\r\n    const agent = {\r\n      id: agentId,\r\n      status: 'online',\r\n      lastSeen: Date.now(),\r\n      metadata,\r\n      messageCount: 0,\r\n      channel: this._createChannel(agentId),\r\n    };\r\n\r\n    this.state.agents.set(agentId, agent);\r\n\r\n    // Announce new agent to swarm\r\n    this.broadcast(\r\n      {\r\n        type: 'agent_joined',\r\n        agentId,\r\n        metadata,\r\n      },\r\n      'sync',\r\n    );\r\n\r\n    this.emit('agent:registered', agent);\r\n    return agent;\r\n  }\r\n\r\n  /**\r\n   * Unregister agent from network\r\n   */\r\n  unregisterAgent(agentId) {\r\n    const agent = this.state.agents.get(agentId);\r\n    if (!agent) return;\r\n\r\n    // Close channel\r\n    const channel = this.state.channels.get(agentId);\r\n    if (channel) {\r\n      channel.close();\r\n      this.state.channels.delete(agentId);\r\n    }\r\n\r\n    this.state.agents.delete(agentId);\r\n\r\n    // Announce agent departure\r\n    this.broadcast(\r\n      {\r\n        type: 'agent_left',\r\n        agentId,\r\n      },\r\n      'sync',\r\n    );\r\n\r\n    this.emit('agent:unregistered', { agentId });\r\n  }\r\n\r\n  /**\r\n   * Send direct message to agent\r\n   */\r\n  async send(toAgentId, message, type = 'query') {\r\n    const messageId = this._generateMessageId();\r\n    const timestamp = Date.now();\r\n\r\n    const envelope = {\r\n      id: messageId,\r\n      from: 'system', // Will be set by sender\r\n      to: toAgentId,\r\n      type,\r\n      timestamp,\r\n      message,\r\n      protocol: PROTOCOLS.direct,\r\n    };\r\n\r\n    // Encrypt if needed\r\n    if (this.config.encryption && MESSAGE_TYPES[type]?.encrypted) {\r\n      envelope.message = this._encrypt(message);\r\n      envelope.encrypted = true;\r\n      this.state.metrics.encrypted++;\r\n    }\r\n\r\n    // Add to buffer\r\n    this._addToBuffer(envelope);\r\n\r\n    // Track message\r\n    this.state.messageHistory.set(messageId, {\r\n      ...envelope,\r\n      status: 'pending',\r\n      attempts: 0,\r\n    });\r\n\r\n    this.state.metrics.sent++;\r\n\r\n    // Return promise that resolves when message is acknowledged\r\n    return new Promise((resolve, reject) => {\r\n      const timeout = setTimeout(() => {\r\n        reject(new Error(`Message timeout: ${messageId}`));\r\n      }, this.config.timeout);\r\n\r\n      this.once(`ack:${messageId}`, () => {\r\n        clearTimeout(timeout);\r\n        resolve({ messageId, delivered: true });\r\n      });\r\n\r\n      this.once(`nack:${messageId}`, (error) => {\r\n        clearTimeout(timeout);\r\n        reject(error);\r\n      });\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Broadcast message to all agents\r\n   */\r\n  broadcast(message, type = 'broadcast') {\r\n    const messageId = this._generateMessageId();\r\n    const timestamp = Date.now();\r\n\r\n    const envelope = {\r\n      id: messageId,\r\n      from: 'system',\r\n      to: '*',\r\n      type,\r\n      timestamp,\r\n      message,\r\n      protocol: PROTOCOLS.broadcast,\r\n    };\r\n\r\n    // Broadcasts are typically not encrypted\r\n    this._addToBuffer(envelope);\r\n\r\n    this.state.metrics.sent++;\r\n\r\n    this.emit('message:broadcast', envelope);\r\n\r\n    return { messageId, recipients: this.state.agents.size };\r\n  }\r\n\r\n  /**\r\n   * Multicast message to specific agents\r\n   */\r\n  multicast(agentIds, message, type = 'query') {\r\n    const messageId = this._generateMessageId();\r\n    const timestamp = Date.now();\r\n\r\n    const envelopes = agentIds.map((agentId) => ({\r\n      id: `${messageId}-${agentId}`,\r\n      from: 'system',\r\n      to: agentId,\r\n      type,\r\n      timestamp,\r\n      message,\r\n      protocol: PROTOCOLS.multicast,\r\n      groupId: messageId,\r\n    }));\r\n\r\n    envelopes.forEach((envelope) => this._addToBuffer(envelope));\r\n\r\n    this.state.metrics.sent += envelopes.length;\r\n\r\n    return { messageId, recipients: agentIds.length };\r\n  }\r\n\r\n  /**\r\n   * Gossip protocol for epidemic spread\r\n   */\r\n  gossip(message, type = 'sync') {\r\n    const messageId = this._generateMessageId();\r\n    const timestamp = Date.now();\r\n\r\n    // Select random agents for initial spread\r\n    const agents = Array.from(this.state.agents.keys());\r\n    const selected = this._selectRandomAgents(agents, this.config.gossipFanout);\r\n\r\n    selected.forEach((agentId) => {\r\n      const envelope = {\r\n        id: `${messageId}-${agentId}`,\r\n        from: 'system',\r\n        to: agentId,\r\n        type,\r\n        timestamp,\r\n        message: {\r\n          ...message,\r\n          _gossip: {\r\n            originalId: messageId,\r\n            hops: 0,\r\n            seen: [],\r\n          },\r\n        },\r\n        protocol: PROTOCOLS.gossip,\r\n      };\r\n\r\n      this._addToBuffer(envelope);\r\n    });\r\n\r\n    this.state.metrics.sent += selected.length;\r\n\r\n    return { messageId, initialTargets: selected };\r\n  }\r\n\r\n  /**\r\n   * Byzantine consensus protocol\r\n   */\r\n  async consensus(proposal, validators = []) {\r\n    const consensusId = this._generateMessageId();\r\n    const timestamp = Date.now();\r\n\r\n    // If no validators specified, use all online agents\r\n    if (validators.length === 0) {\r\n      validators = Array.from(this.state.agents.keys()).filter(\r\n        (id) => this.state.agents.get(id).status === 'online',\r\n      );\r\n    }\r\n\r\n    const votes = new Map();\r\n    const votePromises = [];\r\n\r\n    // Phase 1: Proposal\r\n    validators.forEach((agentId) => {\r\n      const envelope = {\r\n        id: `${consensusId}-propose-${agentId}`,\r\n        from: 'system',\r\n        to: agentId,\r\n        type: 'consensus',\r\n        timestamp,\r\n        message: {\r\n          phase: 'propose',\r\n          consensusId,\r\n          proposal,\r\n        },\r\n        protocol: PROTOCOLS.consensus,\r\n      };\r\n\r\n      this._addToBuffer(envelope);\r\n\r\n      // Create promise for vote\r\n      const votePromise = new Promise((resolve) => {\r\n        this.once(`vote:${consensusId}:${agentId}`, (vote) => {\r\n          votes.set(agentId, vote);\r\n          resolve({ agentId, vote });\r\n        });\r\n\r\n        // Timeout for vote\r\n        setTimeout(() => {\r\n          if (!votes.has(agentId)) {\r\n            votes.set(agentId, null);\r\n            resolve({ agentId, vote: null });\r\n          }\r\n        }, this.config.timeout);\r\n      });\r\n\r\n      votePromises.push(votePromise);\r\n    });\r\n\r\n    // Wait for all votes\r\n    await Promise.all(votePromises);\r\n\r\n    // Phase 2: Tally and decide\r\n    const voteCount = {};\r\n    let totalVotes = 0;\r\n\r\n    votes.forEach((vote) => {\r\n      if (vote !== null) {\r\n        voteCount[vote] = (voteCount[vote] || 0) + 1;\r\n        totalVotes++;\r\n      }\r\n    });\r\n\r\n    // Check if consensus reached\r\n    const sortedVotes = Object.entries(voteCount).sort((a, b) => b[1] - a[1]);\r\n    const winner = sortedVotes[0];\r\n    const consensusReached = winner && winner[1] / validators.length >= this.config.consensusQuorum;\r\n\r\n    const result = {\r\n      consensusId,\r\n      proposal,\r\n      validators: validators.length,\r\n      votes: Object.fromEntries(votes),\r\n      voteCount,\r\n      winner: consensusReached ? winner[0] : null,\r\n      consensusReached,\r\n      quorum: this.config.consensusQuorum,\r\n      timestamp: Date.now(),\r\n    };\r\n\r\n    // Phase 3: Announce result\r\n    this.broadcast(\r\n      {\r\n        phase: 'result',\r\n        consensusId,\r\n        result,\r\n      },\r\n      'consensus',\r\n    );\r\n\r\n    this.emit('consensus:completed', result);\r\n\r\n    return result;\r\n  }\r\n\r\n  /**\r\n   * Handle incoming message\r\n   */\r\n  handleMessage(envelope) {\r\n    this.state.metrics.received++;\r\n\r\n    // Update agent last seen\r\n    const agent = this.state.agents.get(envelope.from);\r\n    if (agent) {\r\n      agent.lastSeen = Date.now();\r\n      agent.messageCount++;\r\n    }\r\n\r\n    // Decrypt if needed\r\n    if (envelope.encrypted && this.config.encryption) {\r\n      try {\r\n        envelope.message = this._decrypt(envelope.message);\r\n      } catch (error) {\r\n        this.emit('error', { type: 'decryption_failed', envelope, error });\r\n        return;\r\n      }\r\n    }\r\n\r\n    // Process based on protocol\r\n    switch (envelope.protocol) {\r\n      case PROTOCOLS.direct:\r\n        this._handleDirectMessage(envelope);\r\n        break;\r\n\r\n      case PROTOCOLS.broadcast:\r\n        this._handleBroadcastMessage(envelope);\r\n        break;\r\n\r\n      case PROTOCOLS.multicast:\r\n        this._handleMulticastMessage(envelope);\r\n        break;\r\n\r\n      case PROTOCOLS.gossip:\r\n        this._handleGossipMessage(envelope);\r\n        break;\r\n\r\n      case PROTOCOLS.consensus:\r\n        this._handleConsensusMessage(envelope);\r\n        break;\r\n\r\n      default:\r\n        this.emit('error', { type: 'unknown_protocol', envelope });\r\n    }\r\n\r\n    // Emit general message event\r\n    this.emit('message:received', envelope);\r\n  }\r\n\r\n  /**\r\n   * Handle direct message\r\n   */\r\n  _handleDirectMessage(envelope) {\r\n    // Send acknowledgment\r\n    this._sendAck(envelope.id, envelope.from);\r\n\r\n    // Emit specific event for message type\r\n    this.emit(`message:${envelope.type}`, envelope);\r\n  }\r\n\r\n  /**\r\n   * Handle broadcast message\r\n   */\r\n  _handleBroadcastMessage(envelope) {\r\n    // No ack for broadcasts\r\n    this.emit(`broadcast:${envelope.type}`, envelope);\r\n  }\r\n\r\n  /**\r\n   * Handle multicast message\r\n   */\r\n  _handleMulticastMessage(envelope) {\r\n    // Send ack to original sender\r\n    this._sendAck(envelope.groupId, envelope.from);\r\n\r\n    this.emit(`multicast:${envelope.type}`, envelope);\r\n  }\r\n\r\n  /**\r\n   * Handle gossip message\r\n   */\r\n  _handleGossipMessage(envelope) {\r\n    const gossipData = envelope.message._gossip;\r\n\r\n    // Check if we've seen this message\r\n    if (gossipData.seen.includes(this.config.swarmId)) {\r\n      return;\r\n    }\r\n\r\n    // Mark as seen\r\n    gossipData.seen.push(this.config.swarmId);\r\n    gossipData.hops++;\r\n\r\n    // Process the message\r\n    this.emit(`gossip:${envelope.type}`, envelope);\r\n\r\n    // Continue spreading if hop count is low\r\n    if (gossipData.hops < 3) {\r\n      const agents = Array.from(this.state.agents.keys()).filter(\r\n        (id) => !gossipData.seen.includes(id),\r\n      );\r\n\r\n      const selected = this._selectRandomAgents(agents, this.config.gossipFanout);\r\n\r\n      selected.forEach((agentId) => {\r\n        const newEnvelope = {\r\n          ...envelope,\r\n          id: `${gossipData.originalId}-${agentId}-hop${gossipData.hops}`,\r\n          to: agentId,\r\n          from: this.config.swarmId,\r\n        };\r\n\r\n        this._addToBuffer(newEnvelope);\r\n      });\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Handle consensus message\r\n   */\r\n  _handleConsensusMessage(envelope) {\r\n    const { phase, consensusId } = envelope.message;\r\n\r\n    switch (phase) {\r\n      case 'propose':\r\n        // Agent should vote on proposal\r\n        this.emit('consensus:proposal', envelope);\r\n        break;\r\n\r\n      case 'vote':\r\n        // Collect vote\r\n        this.emit(`vote:${consensusId}:${envelope.from}`, envelope.message.vote);\r\n        break;\r\n\r\n      case 'result':\r\n        // Consensus result announced\r\n        this.emit('consensus:result', envelope.message.result);\r\n        break;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Send acknowledgment\r\n   */\r\n  _sendAck(messageId, toAgent) {\r\n    const ack = {\r\n      id: `ack-${messageId}`,\r\n      from: this.config.swarmId,\r\n      to: toAgent,\r\n      type: 'ack',\r\n      timestamp: Date.now(),\r\n      message: { originalId: messageId },\r\n      protocol: PROTOCOLS.direct,\r\n    };\r\n\r\n    this._addToBuffer(ack);\r\n  }\r\n\r\n  /**\r\n   * Create communication channel\r\n   */\r\n  _createChannel(agentId) {\r\n    // In production, this would create actual network channels\r\n    // For now, we simulate with event emitters\r\n    const channel = new EventEmitter();\r\n\r\n    channel.send = (message) => {\r\n      this.emit(`channel:${agentId}`, message);\r\n    };\r\n\r\n    channel.close = () => {\r\n      channel.removeAllListeners();\r\n    };\r\n\r\n    this.state.channels.set(agentId, channel);\r\n\r\n    return channel;\r\n  }\r\n\r\n  /**\r\n   * Add message to buffer\r\n   */\r\n  _addToBuffer(envelope) {\r\n    this.state.messageBuffer.push(envelope);\r\n\r\n    // Limit buffer size\r\n    if (this.state.messageBuffer.length > this.config.bufferSize) {\r\n      const dropped = this.state.messageBuffer.shift();\r\n      this.emit('message:dropped', dropped);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Process message buffer\r\n   */\r\n  _processMessageBuffer() {\r\n    const toProcess = this.state.messageBuffer.splice(0, 10);\r\n\r\n    toProcess.forEach((envelope) => {\r\n      // Simulate network delay\r\n      setTimeout(() => {\r\n        if (envelope.to === '*') {\r\n          // Broadcast to all agents\r\n          this.state.agents.forEach((agent) => {\r\n            this.emit(`deliver:${agent.id}`, envelope);\r\n          });\r\n        } else {\r\n          // Direct delivery\r\n          this.emit(`deliver:${envelope.to}`, envelope);\r\n        }\r\n\r\n        // Update message history\r\n        const history = this.state.messageHistory.get(envelope.id);\r\n        if (history) {\r\n          history.status = 'sent';\r\n          history.sentAt = Date.now();\r\n        }\r\n      }, Math.random() * 100);\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Send heartbeats to all agents\r\n   */\r\n  _sendHeartbeats() {\r\n    const now = Date.now();\r\n\r\n    this.state.agents.forEach((agent, agentId) => {\r\n      // Check if agent is still responsive\r\n      if (now - agent.lastSeen > 30000) {\r\n        agent.status = 'offline';\r\n        this.emit('agent:offline', { agentId });\r\n      }\r\n\r\n      // Send heartbeat\r\n      const heartbeat = {\r\n        id: `heartbeat-${now}-${agentId}`,\r\n        from: 'system',\r\n        to: agentId,\r\n        type: 'heartbeat',\r\n        timestamp: now,\r\n        message: { timestamp: now },\r\n        protocol: PROTOCOLS.direct,\r\n      };\r\n\r\n      this._addToBuffer(heartbeat);\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Select random agents\r\n   */\r\n  _selectRandomAgents(agents, count) {\r\n    const shuffled = [...agents].sort(() => Math.random() - 0.5);\r\n    return shuffled.slice(0, Math.min(count, agents.length));\r\n  }\r\n\r\n  /**\r\n   * Generate unique message ID\r\n   */\r\n  _generateMessageId() {\r\n    return `msg-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`;\r\n  }\r\n\r\n  /**\r\n   * Encrypt message\r\n   */\r\n  _encrypt(data) {\r\n    if (!this.encryptionKey) return data;\r\n\r\n    const iv = crypto.randomBytes(16);\r\n    const cipher = crypto.createCipheriv('aes-256-cbc', this.encryptionKey, iv);\r\n\r\n    let encrypted = cipher.update(JSON.stringify(data), 'utf8', 'hex');\r\n    encrypted += cipher.final('hex');\r\n\r\n    return {\r\n      iv: iv.toString('hex'),\r\n      data: encrypted,\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Decrypt message\r\n   */\r\n  _decrypt(encrypted) {\r\n    if (!this.encryptionKey) return encrypted;\r\n\r\n    const iv = Buffer.from(encrypted.iv, 'hex');\r\n    const decipher = crypto.createDecipheriv('aes-256-cbc', this.encryptionKey, iv);\r\n\r\n    let decrypted = decipher.update(encrypted.data, 'hex', 'utf8');\r\n    decrypted += decipher.final('utf8');\r\n\r\n    return JSON.parse(decrypted);\r\n  }\r\n\r\n  /**\r\n   * Get communication statistics\r\n   */\r\n  getStatistics() {\r\n    const avgLatency =\r\n      this.state.metrics.latency.length > 0\r\n        ? this.state.metrics.latency.reduce((a, b) => a + b, 0) / this.state.metrics.latency.length\r\n        : 0;\r\n\r\n    return {\r\n      agents: {\r\n        total: this.state.agents.size,\r\n        online: Array.from(this.state.agents.values()).filter((a) => a.status === 'online').length,\r\n        offline: Array.from(this.state.agents.values()).filter((a) => a.status === 'offline')\r\n          .length,\r\n      },\r\n      messages: {\r\n        sent: this.state.metrics.sent,\r\n        received: this.state.metrics.received,\r\n        failed: this.state.metrics.failed,\r\n        encrypted: this.state.metrics.encrypted,\r\n        buffered: this.state.messageBuffer.length,\r\n      },\r\n      performance: {\r\n        avgLatency: avgLatency.toFixed(2),\r\n        successRate:\r\n          this.state.metrics.sent > 0\r\n            ? (\r\n                ((this.state.metrics.sent - this.state.metrics.failed) / this.state.metrics.sent) *\r\n                100\r\n              ).toFixed(2)\r\n            : 100,\r\n      },\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Close communication system\r\n   */\r\n  close() {\r\n    // Clear timers\r\n    if (this.messageProcessor) clearInterval(this.messageProcessor);\r\n    if (this.heartbeatTimer) clearInterval(this.heartbeatTimer);\r\n\r\n    // Close all channels\r\n    this.state.channels.forEach((channel) => channel.close());\r\n\r\n    this.emit('communication:closed');\r\n  }\r\n}\r\n"],"names":["EventEmitter","crypto","MESSAGE_TYPES","command","priority","reliable","encrypted","query","response","broadcast","heartbeat","consensus","task","result","error","sync","PROTOCOLS","direct","multicast","gossip","SwarmCommunication","config","swarmId","encryption","maxRetries","timeout","bufferSize","gossipFanout","consensusQuorum","state","agents","Map","channels","messageBuffer","messageHistory","metrics","sent","received","failed","latency","encryptionKey","randomBytes","_initialize","messageProcessor","setInterval","_processMessageBuffer","heartbeatTimer","_sendHeartbeats","emit","registerAgent","agentId","metadata","agent","id","status","lastSeen","Date","now","messageCount","channel","_createChannel","set","type","unregisterAgent","get","close","delete","send","toAgentId","message","messageId","_generateMessageId","timestamp","envelope","from","to","protocol","_encrypt","_addToBuffer","attempts","Promise","resolve","reject","setTimeout","Error","once","clearTimeout","delivered","recipients","size","agentIds","envelopes","map","groupId","forEach","length","Array","keys","selected","_selectRandomAgents","_gossip","originalId","hops","seen","initialTargets","proposal","validators","consensusId","filter","votes","votePromises","phase","votePromise","vote","has","push","all","voteCount","totalVotes","sortedVotes","Object","entries","sort","a","b","winner","consensusReached","fromEntries","quorum","handleMessage","_decrypt","_handleDirectMessage","_handleBroadcastMessage","_handleMulticastMessage","_handleGossipMessage","_handleConsensusMessage","_sendAck","gossipData","includes","newEnvelope","toAgent","ack","removeAllListeners","dropped","shift","toProcess","splice","history","sentAt","Math","random","count","shuffled","slice","min","toString","substr","data","iv","cipher","createCipheriv","update","JSON","stringify","final","Buffer","decipher","createDecipheriv","decrypted","parse","getStatistics","avgLatency","reduce","total","online","values","offline","messages","buffered","performance","toFixed","successRate","clearInterval"],"mappings":"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"}