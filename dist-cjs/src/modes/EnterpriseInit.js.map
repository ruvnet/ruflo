{"version":3,"sources":["../../../src/modes/EnterpriseInit.ts"],"sourcesContent":["/**\r\n * EnterpriseInit - Enterprise initialization mode\r\n * Sets up enterprise-grade features with security, compliance, and scalability\r\n */\r\n\r\nimport { IInitMode, InitConfig, InitResult } from '../types/interfaces.js';\r\n\r\nexport class EnterpriseInit implements IInitMode {\r\n  getDescription(): string {\r\n    return 'Enterprise initialization with authentication, encryption, audit trails, and compliance features';\r\n  }\r\n\r\n  getRequiredComponents(): string[] {\r\n    return ['ConfigManager', 'DatabaseManager', 'TopologyManager', 'AgentRegistry', 'ConsensusEngine', 'MetricsCollector', 'MCPIntegrator'];\r\n  }\r\n\r\n  validate(): boolean {\r\n    // Check for enterprise requirements\r\n    const hasSecurityConfig = !!(process.env.ENTERPRISE_SECRET_KEY || process.env.ENCRYPTION_KEY);\r\n    const hasAuditConfig = !!(process.env.AUDIT_ENABLED || process.env.COMPLIANCE_MODE);\r\n\r\n    return hasSecurityConfig || hasAuditConfig; // At least one enterprise feature\r\n  }\r\n\r\n  async initialize(config: InitConfig): Promise<InitResult> {\r\n    const components: string[] = [];\r\n\r\n    try {\r\n      // Basic initialization\r\n      if (config.configManager) {\r\n        components.push('ConfigManager');\r\n      }\r\n\r\n      if (config.databaseManager) {\r\n        await config.databaseManager.initialize();\r\n        components.push('DatabaseManager');\r\n      }\r\n\r\n      // Use star topology for enterprise (centralized control)\r\n      if (config.topologyManager) {\r\n        await config.topologyManager.configure('star', []);\r\n        components.push('TopologyManager');\r\n      }\r\n\r\n      if (config.agentRegistry) {\r\n        await config.agentRegistry.initialize();\r\n        components.push('AgentRegistry');\r\n      }\r\n\r\n      // Initialize Byzantine consensus for enterprise security\r\n      if (config.consensusEngine) {\r\n        await config.consensusEngine.setAlgorithm('byzantine');\r\n        components.push('ConsensusEngine');\r\n      }\r\n\r\n      // Spawn enterprise-specific agents\r\n      if (config.agentRegistry) {\r\n        // Security Manager\r\n        await config.agentRegistry.spawn('coordinator', {\r\n          capabilities: ['security-management', 'authentication', 'authorization', 'encryption'],\r\n          metadata: {\r\n            role: 'security-manager',\r\n            clearanceLevel: 'high',\r\n            specialization: 'security',\r\n            enterpriseAgent: true\r\n          }\r\n        });\r\n\r\n        // Compliance Officer\r\n        await config.agentRegistry.spawn('reviewer', {\r\n          capabilities: ['compliance-checking', 'audit-trail', 'regulatory-compliance', 'policy-enforcement'],\r\n          metadata: {\r\n            role: 'compliance-officer',\r\n            clearanceLevel: 'high',\r\n            specialization: 'compliance',\r\n            enterpriseAgent: true\r\n          }\r\n        });\r\n\r\n        // Resource Manager\r\n        await config.agentRegistry.spawn('optimizer', {\r\n          capabilities: ['resource-allocation', 'capacity-planning', 'cost-optimization', 'scaling'],\r\n          metadata: {\r\n            role: 'resource-manager',\r\n            clearanceLevel: 'medium',\r\n            specialization: 'resource-management',\r\n            enterpriseAgent: true\r\n          }\r\n        });\r\n\r\n        // Audit Agent\r\n        await config.agentRegistry.spawn('analyst', {\r\n          capabilities: ['audit-logging', 'security-monitoring', 'anomaly-detection', 'forensics'],\r\n          metadata: {\r\n            role: 'audit-agent',\r\n            clearanceLevel: 'high',\r\n            specialization: 'audit',\r\n            enterpriseAgent: true\r\n          }\r\n        });\r\n\r\n        // Enterprise Coordinator\r\n        await config.agentRegistry.spawn('coordinator', {\r\n          capabilities: ['enterprise-orchestration', 'workflow-management', 'integration', 'governance'],\r\n          metadata: {\r\n            role: 'enterprise-coordinator',\r\n            clearanceLevel: 'high',\r\n            specialization: 'enterprise-orchestration',\r\n            enterpriseAgent: true,\r\n            authority: 'enterprise'\r\n          }\r\n        });\r\n\r\n        components.push('EnterpriseAgents');\r\n      }\r\n\r\n      // Initialize enterprise MCP integration\r\n      if (config.mcpIntegrator) {\r\n        await config.mcpIntegrator.initialize();\r\n\r\n        // Test enterprise MCP functions\r\n        const enterpriseStatus = await config.mcpIntegrator.executeCommand({\r\n          tool: 'flow-nexus',\r\n          function: 'auth_init',\r\n          parameters: { mode: 'service' }\r\n        });\r\n\r\n        if (enterpriseStatus.success) {\r\n          components.push('EnterpriseMCP');\r\n        }\r\n      }\r\n\r\n      // Set up enterprise memory structures\r\n      if (config.databaseManager) {\r\n        await config.databaseManager.store('enterprise-config', {\r\n          initialized: true,\r\n          mode: 'enterprise',\r\n          securityLevel: 'high',\r\n          encryptionEnabled: true,\r\n          auditEnabled: true,\r\n          complianceMode: process.env.COMPLIANCE_MODE || 'standard',\r\n          features: [\r\n            'authentication',\r\n            'authorization',\r\n            'encryption',\r\n            'audit-trail',\r\n            'compliance',\r\n            'monitoring',\r\n            'governance'\r\n          ],\r\n          timestamp: new Date().toISOString()\r\n        }, 'enterprise');\r\n\r\n        // Initialize security policies\r\n        await config.databaseManager.store('security-policies', {\r\n          authentication: {\r\n            required: true,\r\n            method: 'multi-factor',\r\n            sessionTimeout: 3600,\r\n            passwordPolicy: {\r\n              minLength: 12,\r\n              requireSpecialChars: true,\r\n              requireNumbers: true,\r\n              maxAge: 90\r\n            }\r\n          },\r\n          authorization: {\r\n            model: 'role-based',\r\n            principle: 'least-privilege',\r\n            roles: ['admin', 'operator', 'viewer', 'auditor']\r\n          },\r\n          encryption: {\r\n            algorithm: 'AES-256',\r\n            keyRotation: 'monthly',\r\n            transitEncryption: true,\r\n            restEncryption: true\r\n          }\r\n        }, 'enterprise');\r\n\r\n        // Initialize audit configuration\r\n        await config.databaseManager.store('audit-config', {\r\n          enabled: true,\r\n          logLevel: 'comprehensive',\r\n          retention: '7-years',\r\n          compliance: ['SOX', 'GDPR', 'HIPAA'],\r\n          monitoring: {\r\n            realTime: true,\r\n            alerting: true,\r\n            anomalyDetection: true\r\n          }\r\n        }, 'enterprise');\r\n\r\n        // Initialize compliance frameworks\r\n        await config.databaseManager.store('compliance-frameworks', {\r\n          'SOX': {\r\n            requirements: ['financial-controls', 'audit-trails', 'segregation-of-duties'],\r\n            monitoring: true,\r\n            reporting: 'quarterly'\r\n          },\r\n          'GDPR': {\r\n            requirements: ['data-protection', 'privacy-by-design', 'right-to-deletion'],\r\n            monitoring: true,\r\n            reporting: 'incident-based'\r\n          },\r\n          'HIPAA': {\r\n            requirements: ['data-encryption', 'access-controls', 'audit-logs'],\r\n            monitoring: true,\r\n            reporting: 'annual'\r\n          }\r\n        }, 'enterprise');\r\n\r\n        components.push('EnterpriseMemory');\r\n      }\r\n\r\n      // Initialize enterprise metrics and monitoring\r\n      if (config.metricsCollector) {\r\n        await config.metricsCollector.initialize();\r\n\r\n        // Record enterprise initialization metrics\r\n        await config.metricsCollector.recordSystemMetrics({\r\n          cpuUsage: 35, // Lower due to security overhead\r\n          memoryUsage: 75, // Higher due to enterprise features\r\n          diskUsage: 45,\r\n          networkLatency: 20, // Higher due to encryption\r\n          activeConnections: 8\r\n        });\r\n\r\n        // Set up enterprise-specific metrics\r\n        await config.metricsCollector.recordAgentMetrics('security-manager', {\r\n          tasksCompleted: 0,\r\n          successRate: 1.0,\r\n          averageResponseTime: 500, // Security checks take time\r\n          resourceUtilization: {\r\n            memory: 512,\r\n            cpu: 2,\r\n            storage: 200,\r\n            network: 20\r\n          }\r\n        });\r\n\r\n        components.push('EnterpriseMetrics');\r\n      }\r\n\r\n      // Set up enterprise governance\r\n      if (config.databaseManager) {\r\n        await config.databaseManager.store('governance-rules', {\r\n          dataGovernance: {\r\n            classification: ['public', 'internal', 'confidential', 'restricted'],\r\n            retention: { default: '7-years', financial: '10-years' },\r\n            access: 'role-based'\r\n          },\r\n          operationalGovernance: {\r\n            approvalWorkflows: true,\r\n            changeManagement: true,\r\n            incidentResponse: true\r\n          },\r\n          riskManagement: {\r\n            riskAssessment: 'quarterly',\r\n            threatModeling: true,\r\n            vulnerabilityScanning: true\r\n          }\r\n        }, 'enterprise');\r\n\r\n        components.push('EnterpriseGovernance');\r\n      }\r\n\r\n      return {\r\n        success: true,\r\n        mode: 'enterprise',\r\n        components,\r\n        topology: 'star',\r\n        message: 'Enterprise initialization completed successfully - Security and compliance active',\r\n        metadata: {\r\n          securityLevel: 'high',\r\n          encryptionEnabled: true,\r\n          auditEnabled: true,\r\n          complianceFrameworks: ['SOX', 'GDPR', 'HIPAA'],\r\n          authenticationRequired: true,\r\n          governanceActive: true,\r\n          enterpriseFeatures: components.length\r\n        }\r\n      };\r\n\r\n    } catch (error) {\r\n      return {\r\n        success: false,\r\n        mode: 'enterprise',\r\n        components,\r\n        error: error instanceof Error ? error.message : String(error),\r\n        message: 'Enterprise initialization failed'\r\n      };\r\n    }\r\n  }\r\n}"],"names":["EnterpriseInit","getDescription","getRequiredComponents","validate","hasSecurityConfig","process","env","ENTERPRISE_SECRET_KEY","ENCRYPTION_KEY","hasAuditConfig","AUDIT_ENABLED","COMPLIANCE_MODE","initialize","config","components","configManager","push","databaseManager","topologyManager","configure","agentRegistry","consensusEngine","setAlgorithm","spawn","capabilities","metadata","role","clearanceLevel","specialization","enterpriseAgent","authority","mcpIntegrator","enterpriseStatus","executeCommand","tool","function","parameters","mode","success","store","initialized","securityLevel","encryptionEnabled","auditEnabled","complianceMode","features","timestamp","Date","toISOString","authentication","required","method","sessionTimeout","passwordPolicy","minLength","requireSpecialChars","requireNumbers","maxAge","authorization","model","principle","roles","encryption","algorithm","keyRotation","transitEncryption","restEncryption","enabled","logLevel","retention","compliance","monitoring","realTime","alerting","anomalyDetection","requirements","reporting","metricsCollector","recordSystemMetrics","cpuUsage","memoryUsage","diskUsage","networkLatency","activeConnections","recordAgentMetrics","tasksCompleted","successRate","averageResponseTime","resourceUtilization","memory","cpu","storage","network","dataGovernance","classification","default","financial","access","operationalGovernance","approvalWorkflows","changeManagement","incidentResponse","riskManagement","riskAssessment","threatModeling","vulnerabilityScanning","topology","message","complianceFrameworks","authenticationRequired","governanceActive","enterpriseFeatures","length","error","Error","String"],"mappings":"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"}