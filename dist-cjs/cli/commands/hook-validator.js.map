{
  "version": 3,
  "sources": ["../../../src/cli/commands/hook-validator.ts"],
  "sourcesContent": ["/**\n * Hook validation utilities\n */\n\nimport type { HookType } from './hook-types.js';\n\nexport interface ValidationResult {\n  valid: boolean;\n  errors: string[];\n  warnings: string[];\n}\n\n/**\n * Validate hook parameters before execution\n */\nexport function validateHookParams(\n  hookType: HookType,\n  params: Record<string, any>,\n): ValidationResult {\n  const result: ValidationResult = {\n    valid: true,\n    errors: [],\n    warnings: [],\n  };\n\n  // Common validations\n  if (params.metadata && typeof params.metadata === 'string') {\n    try {\n      JSON.parse(params.metadata);\n    } catch {\n      result.errors.push('Invalid JSON in --metadata parameter');\n      result.valid = false;\n    }\n  }\n\n  // Hook-specific validations\n  switch (hookType) {\n    case 'pre-task':\n      if (params.complexity && !['low', 'medium', 'high'].includes(params.complexity)) {\n        result.errors.push('--complexity must be one of: low, medium, high');\n        result.valid = false;\n      }\n      if (params.estimatedMinutes && isNaN(Number(params.estimatedMinutes))) {\n        result.errors.push('--estimated-minutes must be a number');\n        result.valid = false;\n      }\n      break;\n\n    case 'post-task':\n      if (!params.taskId) {\n        result.errors.push('--task-id is required for post-task hook');\n        result.valid = false;\n      }\n      break;\n\n    case 'pre-edit':\n    case 'post-edit':\n      if (!params.file) {\n        result.errors.push(`--file is required for ${hookType} hook`);\n        result.valid = false;\n      }\n      if (hookType === 'pre-edit' && params.operation) {\n        if (!['read', 'write', 'edit', 'delete'].includes(params.operation)) {\n          result.errors.push('--operation must be one of: read, write, edit, delete');\n          result.valid = false;\n        }\n      }\n      break;\n\n    case 'pre-command':\n    case 'post-command':\n      if (!params.command) {\n        result.errors.push(`--command is required for ${hookType} hook`);\n        result.valid = false;\n      }\n      if (hookType === 'post-command' && params.exitCode) {\n        if (isNaN(Number(params.exitCode))) {\n          result.errors.push('--exit-code must be a number');\n          result.valid = false;\n        }\n      }\n      break;\n\n    case 'session-restore':\n      if (!params.sessionId) {\n        result.errors.push('--session-id is required for session-restore hook');\n        result.valid = false;\n      }\n      break;\n\n    case 'pre-search':\n      if (!params.query) {\n        result.errors.push('--query is required for pre-search hook');\n        result.valid = false;\n      }\n      if (params.maxResults && isNaN(Number(params.maxResults))) {\n        result.errors.push('--max-results must be a number');\n        result.valid = false;\n      }\n      break;\n\n    case 'notification':\n      if (!params.message) {\n        result.errors.push('--message is required for notification hook');\n        result.valid = false;\n      }\n      if (params.level && !['info', 'warning', 'error'].includes(params.level)) {\n        result.errors.push('--level must be one of: info, warning, error');\n        result.valid = false;\n      }\n      break;\n\n    case 'performance':\n      if (params.duration && isNaN(Number(params.duration))) {\n        result.errors.push('--duration must be a number');\n        result.valid = false;\n      }\n      if (params.metrics && typeof params.metrics === 'string') {\n        try {\n          JSON.parse(params.metrics);\n        } catch {\n          result.errors.push('Invalid JSON in --metrics parameter');\n          result.valid = false;\n        }\n      }\n      break;\n\n    case 'memory-sync':\n      if (params.direction && !['push', 'pull', 'sync'].includes(params.direction)) {\n        result.errors.push('--direction must be one of: push, pull, sync');\n        result.valid = false;\n      }\n      break;\n\n    case 'telemetry':\n      if (!params.event) {\n        result.errors.push('--event is required for telemetry hook');\n        result.valid = false;\n      }\n      if (params.data && typeof params.data === 'string') {\n        try {\n          JSON.parse(params.data);\n        } catch {\n          result.errors.push('Invalid JSON in --data parameter');\n          result.valid = false;\n        }\n      }\n      break;\n  }\n\n  // Add warnings for deprecated or unusual usage\n  if (hookType === 'session-start' && params.loadPrevious && !params.sessionId) {\n    result.warnings.push('--load-previous without --session-id may load unexpected data');\n  }\n\n  if (\n    hookType === 'post-edit' &&\n    params.format &&\n    !params.file?.match(/\\.(js|ts|jsx|tsx|py|java|cpp|cs)$/)\n  ) {\n    result.warnings.push('--format may not work correctly for this file type');\n  }\n\n  return result;\n}\n\n/**\n * Sanitize hook parameters for safe execution\n */\nexport function sanitizeHookParams(params: Record<string, any>): Record<string, any> {\n  const sanitized: Record<string, any> = {};\n\n  for (const [key, value] of Object.entries(params)) {\n    if (value === undefined || value === null) {\n      continue;\n    }\n\n    // Sanitize file paths\n    if (['file', 'saveTo', 'target'].includes(key) && typeof value === 'string') {\n      // Remove potentially dangerous characters\n      sanitized[key] = value.replace(/[<>\"|?*]/g, '');\n    }\n    // Sanitize commands\n    else if (key === 'command' && typeof value === 'string') {\n      // Basic command injection prevention\n      sanitized[key] = value.replace(/[;&|`$()]/g, '');\n    }\n    // Keep other values as-is\n    else {\n      sanitized[key] = value;\n    }\n  }\n\n  return sanitized;\n}\n"],
  "mappings": "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",
  "names": []
}
