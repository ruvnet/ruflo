{"version":3,"sources":["../../../../src/cli/simple-commands/stream-processor.js"],"sourcesContent":["/**\r\n * Stream processor for Claude stream-json output\r\n * Provides real-time status updates and progress tracking\r\n */\r\n\r\nimport { Transform } from 'stream';\r\n\r\nexport class StreamJsonProcessor extends Transform {\r\n  constructor(options = {}) {\r\n    super({ objectMode: false });\r\n    this.buffer = '';\r\n    this.agentId = options.agentId;\r\n    this.agentName = options.agentName || 'Agent';\r\n    this.agentIcon = options.agentIcon || 'ðŸ¤–';\r\n    this.taskId = options.taskId || 'unknown';\r\n    this.startTime = Date.now();\r\n    this.eventCount = 0;\r\n    this.lastUpdate = Date.now();\r\n    this.options = options;\r\n    this.display = options.display; // Reference to concurrent display\r\n  }\r\n\r\n  _transform(chunk, encoding, callback) {\r\n    this.buffer += chunk.toString();\r\n    const lines = this.buffer.split('\\n');\r\n    this.buffer = lines.pop() || '';\r\n\r\n    for (const line of lines) {\r\n      if (line.trim()) {\r\n        try {\r\n          const event = JSON.parse(line);\r\n          this.processEvent(event);\r\n        } catch (e) {\r\n          // Not JSON, pass through if in verbose mode\r\n          if (this.options.verbose) {\r\n            console.log(`[${this.agentName}] ${line}`);\r\n          }\r\n        }\r\n      }\r\n    }\r\n\r\n    // Update progress display periodically\r\n    if (Date.now() - this.lastUpdate > 1000) {\r\n      this.updateProgress();\r\n      this.lastUpdate = Date.now();\r\n    }\r\n\r\n    callback();\r\n  }\r\n\r\n  _flush(callback) {\r\n    if (this.buffer.trim()) {\r\n      try {\r\n        const event = JSON.parse(this.buffer);\r\n        this.processEvent(event);\r\n      } catch (e) {\r\n        // Ignore\r\n      }\r\n    }\r\n    this.showFinalStatus();\r\n    callback();\r\n  }\r\n\r\n  processEvent(event) {\r\n    this.eventCount++;\r\n    \r\n    // If we have a concurrent display, update it instead of console logging\r\n    if (this.display) {\r\n      this.updateDisplay(event);\r\n      return;\r\n    }\r\n    \r\n    // Handle quiet mode - show important actions and commands\r\n    if (this.options.verbose === false && this.options.logLevel === 'quiet') {\r\n      switch (event.type) {\r\n        case 'system':\r\n          if (event.subtype === 'init') {\r\n            console.log(`ðŸ¤– ${this.agentName} - Started`);\r\n          }\r\n          break;\r\n        case 'assistant':\r\n          // In quiet mode, still show bash commands and key actions\r\n          if (event.message?.content?.length > 0) {\r\n            const content = event.message.content[0];\r\n            if (content.type === 'tool_use' && content.name === 'Bash' && content.input?.command) {\r\n              const command = content.input.command;\r\n              if (command.length > 60) {\r\n                console.log(`  ðŸ”§ ${command.substring(0, 57)}...`);\r\n              } else {\r\n                console.log(`  ðŸ”§ ${command}`);\r\n              }\r\n            } else if (content.type === 'tool_use' && ['WebSearch', 'Read', 'Write'].includes(content.name)) {\r\n              const toolName = content.name.replace(/([A-Z])/g, ' $1').trim();\r\n              if (content.input) {\r\n                const firstKey = Object.keys(content.input)[0];\r\n                const firstValue = content.input[firstKey];\r\n                if (typeof firstValue === 'string' && firstValue.length < 40) {\r\n                  console.log(`  ðŸ”§ ${toolName}: ${firstValue}`);\r\n                } else {\r\n                  console.log(`  ðŸ”§ ${toolName}`);\r\n                }\r\n              }\r\n            }\r\n          }\r\n          break;\r\n        case 'result':\r\n          if (event.subtype === 'success') {\r\n            console.log(`âœ… ${this.agentName} - Completed (${this.formatDuration(event.duration_ms)})`);\r\n          } else if (event.is_error) {\r\n            console.log(`âŒ ${this.agentName} - Failed: ${event.error || 'Unknown error'}`);\r\n          }\r\n          break;\r\n      }\r\n      return;\r\n    }\r\n    \r\n    // Use clean, concise formatting for non-interactive mode\r\n    switch (event.type) {\r\n      case 'system':\r\n        if (event.subtype === 'init') {\r\n          console.log(`\\nðŸ¤– ${this.agentName} - Started (Session: ${event.session_id?.substring(0, 8) || 'unknown'})`);\r\n        }\r\n        break;\r\n        \r\n      case 'assistant':\r\n        if (event.message?.content?.length > 0) {\r\n          const content = event.message.content[0];\r\n          if (content.type === 'text') {\r\n            // Show only the first meaningful line, skip verbose details\r\n            const lines = content.text.split('\\n').filter(line => line.trim());\r\n            if (lines.length > 0) {\r\n              const firstLine = lines[0].trim();\r\n              if (firstLine.length > 100) {\r\n                console.log(`ðŸ’­ ${firstLine.substring(0, 97)}...`);\r\n              } else {\r\n                console.log(`ðŸ’­ ${firstLine}`);\r\n              }\r\n            }\r\n          } else if (content.type === 'tool_use') {\r\n            // Show tool use with actual command/input when available\r\n            const toolName = content.name.replace(/([A-Z])/g, ' $1').trim();\r\n            \r\n            // For Bash tool, show the actual command\r\n            if (content.name === 'Bash' && content.input?.command) {\r\n              const command = content.input.command;\r\n              if (command.length > 80) {\r\n                console.log(`ðŸ”§ Bash: ${command.substring(0, 77)}...`);\r\n              } else {\r\n                console.log(`ðŸ”§ Bash: ${command}`);\r\n              }\r\n            }\r\n            // For other tools, show key parameters\r\n            else if (content.input && Object.keys(content.input).length > 0) {\r\n              const firstKey = Object.keys(content.input)[0];\r\n              const firstValue = content.input[firstKey];\r\n              \r\n              if (typeof firstValue === 'string' && firstValue.length < 60) {\r\n                console.log(`ðŸ”§ ${toolName}: ${firstValue}`);\r\n              } else if (typeof firstValue === 'string') {\r\n                console.log(`ðŸ”§ ${toolName}: ${firstValue.substring(0, 57)}...`);\r\n              } else {\r\n                console.log(`ðŸ”§ ${toolName}`);\r\n              }\r\n            } else {\r\n              console.log(`ðŸ”§ ${toolName}`);\r\n            }\r\n          }\r\n        }\r\n        break;\r\n        \r\n      case 'user':\r\n        // Tool results - show only success/failure\r\n        if (event.message?.content?.[0]?.type === 'tool_result') {\r\n          const result = event.message.content[0];\r\n          if (!result.is_error) {\r\n            console.log(`  âœ… Tool completed`);\r\n          } else {\r\n            console.log(`  âŒ Tool failed: ${result.error || 'Unknown error'}`);\r\n          }\r\n        }\r\n        break;\r\n        \r\n      case 'result':\r\n        if (event.subtype === 'success') {\r\n          console.log(`\\nâœ… ${this.agentName} - Completed (${this.formatDuration(event.duration_ms)})`);\r\n          if (event.total_cost_usd) {\r\n            console.log(`   ðŸ’° Cost: $${event.total_cost_usd.toFixed(4)}`);\r\n          }\r\n        } else if (event.is_error) {\r\n          console.log(`\\nâŒ ${this.agentName} - Failed: ${event.error || 'Unknown error'}`);\r\n        }\r\n        break;\r\n        \r\n      default:\r\n        // Only show important events in verbose mode\r\n        if (this.options.verbose && ['tool_call', 'error', 'warning'].includes(event.type)) {\r\n          console.log(`â„¹ï¸  [${event.type}] ${event.message || JSON.stringify(event).substring(0, 80)}...`);\r\n        }\r\n    }\r\n  }\r\n  \r\n  /**\r\n   * Update the concurrent display instead of console\r\n   */\r\n  updateDisplay(event) {\r\n    switch (event.type) {\r\n      case 'system':\r\n        if (event.subtype === 'init') {\r\n          this.display.updateAgent(this.agentId, { status: 'active' });\r\n          this.display.addActivity(this.agentId, 'Initialized');\r\n        }\r\n        break;\r\n        \r\n      case 'assistant':\r\n        if (event.message?.content?.length > 0) {\r\n          const content = event.message.content[0];\r\n          if (content.type === 'text') {\r\n            const preview = content.text.substring(0, 80);\r\n            this.display.addActivity(this.agentId, preview);\r\n          } else if (content.type === 'tool_use') {\r\n            this.display.addActivity(this.agentId, `Using ${content.name}`, content.name);\r\n          }\r\n        }\r\n        break;\r\n        \r\n      case 'user':\r\n        // Tool results\r\n        if (event.message?.content?.[0]?.type === 'tool_result') {\r\n          const result = event.message.content[0];\r\n          if (!result.is_error) {\r\n            this.display.addActivity(this.agentId, 'Tool completed', null);\r\n          }\r\n        }\r\n        break;\r\n        \r\n      case 'result':\r\n        if (event.subtype === 'success') {\r\n          this.display.updateAgent(this.agentId, { \r\n            status: 'completed',\r\n            progress: 100\r\n          });\r\n          this.display.addActivity(this.agentId, 'Task completed successfully');\r\n        } else if (event.is_error) {\r\n          this.display.updateAgent(this.agentId, { \r\n            status: 'failed'\r\n          });\r\n          this.display.addActivity(this.agentId, `Failed: ${event.error || 'Unknown error'}`);\r\n        }\r\n        break;\r\n    }\r\n  }\r\n\r\n  updateProgress() {\r\n    // Don't show progress updates in interactive-style mode - events handle the display\r\n  }\r\n\r\n  showFinalStatus() {\r\n    const elapsed = this.formatDuration(Date.now() - this.startTime);\r\n    if (this.eventCount > 0) {\r\n      console.log(`\\nðŸ“Š ${this.agentName} - Processed ${this.eventCount} events in ${elapsed}`);\r\n    }\r\n  }\r\n\r\n  getSpinner() {\r\n    const frames = ['â ‹', 'â ™', 'â ¹', 'â ¸', 'â ¼', 'â ´', 'â ¦', 'â §', 'â ‡', 'â '];\r\n    return frames[Math.floor(Date.now() / 100) % frames.length];\r\n  }\r\n\r\n  getProgressBar(elapsed, expected) {\r\n    const progress = Math.min(elapsed / expected, 1);\r\n    const filled = Math.floor(progress * 10);\r\n    const empty = 10 - filled;\r\n    return '[' + 'â–ˆ'.repeat(filled) + 'â–‘'.repeat(empty) + ']';\r\n  }\r\n\r\n  formatDuration(ms) {\r\n    const seconds = Math.floor(ms / 1000);\r\n    const minutes = Math.floor(seconds / 60);\r\n    if (minutes > 0) {\r\n      return `${minutes}m ${seconds % 60}s`;\r\n    }\r\n    return `${seconds}s`;\r\n  }\r\n\r\n  formatToolParams(input) {\r\n    if (!input || typeof input !== 'object' || Object.keys(input).length === 0) {\r\n      return '';\r\n    }\r\n    \r\n    // Format key parameters for display\r\n    const keys = Object.keys(input);\r\n    if (keys.length === 1) {\r\n      const key = keys[0];\r\n      const value = input[key];\r\n      if (typeof value === 'string' && value.length < 30) {\r\n        return `(${key}: \"${value}\")`;\r\n      } else if (typeof value === 'number' || typeof value === 'boolean') {\r\n        return `(${key}: ${value})`;\r\n      }\r\n    } else if (keys.length <= 3) {\r\n      const params = keys.map(key => {\r\n        const value = input[key];\r\n        if (typeof value === 'string' && value.length < 20) {\r\n          return `${key}: \"${value}\"`;\r\n        } else if (typeof value === 'number' || typeof value === 'boolean') {\r\n          return `${key}: ${value}`;\r\n        } else {\r\n          return `${key}: ...`;\r\n        }\r\n      }).join(', ');\r\n      return `(${params})`;\r\n    }\r\n    \r\n    return '(...)';\r\n  }\r\n}\r\n\r\n/**\r\n * Create a stream processor for an agent\r\n */\r\nexport function createStreamProcessor(agentName, agentIcon, options = {}) {\r\n  return new StreamJsonProcessor({\r\n    agentName,\r\n    agentIcon,\r\n    ...options\r\n  });\r\n}"],"names":["Transform","StreamJsonProcessor","options","objectMode","buffer","agentId","agentName","agentIcon","taskId","startTime","Date","now","eventCount","lastUpdate","display","_transform","chunk","encoding","callback","toString","lines","split","pop","line","trim","event","JSON","parse","processEvent","e","verbose","console","log","updateProgress","_flush","showFinalStatus","updateDisplay","logLevel","type","subtype","message","content","length","name","input","command","substring","includes","toolName","replace","firstKey","Object","keys","firstValue","formatDuration","duration_ms","is_error","error","session_id","text","filter","firstLine","result","total_cost_usd","toFixed","stringify","updateAgent","status","addActivity","preview","progress","elapsed","getSpinner","frames","Math","floor","getProgressBar","expected","min","filled","empty","repeat","ms","seconds","minutes","formatToolParams","key","value","params","map","join","createStreamProcessor"],"mappings":"AAKA,SAASA,SAAS,QAAQ,SAAS;AAEnC,OAAO,MAAMC,4BAA4BD;IACvC,YAAYE,UAAU,CAAC,CAAC,CAAE;QACxB,KAAK,CAAC;YAAEC,YAAY;QAAM;QAC1B,IAAI,CAACC,MAAM,GAAG;QACd,IAAI,CAACC,OAAO,GAAGH,QAAQG,OAAO;QAC9B,IAAI,CAACC,SAAS,GAAGJ,QAAQI,SAAS,IAAI;QACtC,IAAI,CAACC,SAAS,GAAGL,QAAQK,SAAS,IAAI;QACtC,IAAI,CAACC,MAAM,GAAGN,QAAQM,MAAM,IAAI;QAChC,IAAI,CAACC,SAAS,GAAGC,KAAKC,GAAG;QACzB,IAAI,CAACC,UAAU,GAAG;QAClB,IAAI,CAACC,UAAU,GAAGH,KAAKC,GAAG;QAC1B,IAAI,CAACT,OAAO,GAAGA;QACf,IAAI,CAACY,OAAO,GAAGZ,QAAQY,OAAO;IAChC;IAEAC,WAAWC,KAAK,EAAEC,QAAQ,EAAEC,QAAQ,EAAE;QACpC,IAAI,CAACd,MAAM,IAAIY,MAAMG,QAAQ;QAC7B,MAAMC,QAAQ,IAAI,CAAChB,MAAM,CAACiB,KAAK,CAAC;QAChC,IAAI,CAACjB,MAAM,GAAGgB,MAAME,GAAG,MAAM;QAE7B,KAAK,MAAMC,QAAQH,MAAO;YACxB,IAAIG,KAAKC,IAAI,IAAI;gBACf,IAAI;oBACF,MAAMC,QAAQC,KAAKC,KAAK,CAACJ;oBACzB,IAAI,CAACK,YAAY,CAACH;gBACpB,EAAE,OAAOI,GAAG;oBAEV,IAAI,IAAI,CAAC3B,OAAO,CAAC4B,OAAO,EAAE;wBACxBC,QAAQC,GAAG,CAAC,CAAC,CAAC,EAAE,IAAI,CAAC1B,SAAS,CAAC,EAAE,EAAEiB,MAAM;oBAC3C;gBACF;YACF;QACF;QAGA,IAAIb,KAAKC,GAAG,KAAK,IAAI,CAACE,UAAU,GAAG,MAAM;YACvC,IAAI,CAACoB,cAAc;YACnB,IAAI,CAACpB,UAAU,GAAGH,KAAKC,GAAG;QAC5B;QAEAO;IACF;IAEAgB,OAAOhB,QAAQ,EAAE;QACf,IAAI,IAAI,CAACd,MAAM,CAACoB,IAAI,IAAI;YACtB,IAAI;gBACF,MAAMC,QAAQC,KAAKC,KAAK,CAAC,IAAI,CAACvB,MAAM;gBACpC,IAAI,CAACwB,YAAY,CAACH;YACpB,EAAE,OAAOI,GAAG,CAEZ;QACF;QACA,IAAI,CAACM,eAAe;QACpBjB;IACF;IAEAU,aAAaH,KAAK,EAAE;QAClB,IAAI,CAACb,UAAU;QAGf,IAAI,IAAI,CAACE,OAAO,EAAE;YAChB,IAAI,CAACsB,aAAa,CAACX;YACnB;QACF;QAGA,IAAI,IAAI,CAACvB,OAAO,CAAC4B,OAAO,KAAK,SAAS,IAAI,CAAC5B,OAAO,CAACmC,QAAQ,KAAK,SAAS;YACvE,OAAQZ,MAAMa,IAAI;gBAChB,KAAK;oBACH,IAAIb,MAAMc,OAAO,KAAK,QAAQ;wBAC5BR,QAAQC,GAAG,CAAC,CAAC,GAAG,EAAE,IAAI,CAAC1B,SAAS,CAAC,UAAU,CAAC;oBAC9C;oBACA;gBACF,KAAK;oBAEH,IAAImB,MAAMe,OAAO,EAAEC,SAASC,SAAS,GAAG;wBACtC,MAAMD,UAAUhB,MAAMe,OAAO,CAACC,OAAO,CAAC,EAAE;wBACxC,IAAIA,QAAQH,IAAI,KAAK,cAAcG,QAAQE,IAAI,KAAK,UAAUF,QAAQG,KAAK,EAAEC,SAAS;4BACpF,MAAMA,UAAUJ,QAAQG,KAAK,CAACC,OAAO;4BACrC,IAAIA,QAAQH,MAAM,GAAG,IAAI;gCACvBX,QAAQC,GAAG,CAAC,CAAC,KAAK,EAAEa,QAAQC,SAAS,CAAC,GAAG,IAAI,GAAG,CAAC;4BACnD,OAAO;gCACLf,QAAQC,GAAG,CAAC,CAAC,KAAK,EAAEa,SAAS;4BAC/B;wBACF,OAAO,IAAIJ,QAAQH,IAAI,KAAK,cAAc;4BAAC;4BAAa;4BAAQ;yBAAQ,CAACS,QAAQ,CAACN,QAAQE,IAAI,GAAG;4BAC/F,MAAMK,WAAWP,QAAQE,IAAI,CAACM,OAAO,CAAC,YAAY,OAAOzB,IAAI;4BAC7D,IAAIiB,QAAQG,KAAK,EAAE;gCACjB,MAAMM,WAAWC,OAAOC,IAAI,CAACX,QAAQG,KAAK,CAAC,CAAC,EAAE;gCAC9C,MAAMS,aAAaZ,QAAQG,KAAK,CAACM,SAAS;gCAC1C,IAAI,OAAOG,eAAe,YAAYA,WAAWX,MAAM,GAAG,IAAI;oCAC5DX,QAAQC,GAAG,CAAC,CAAC,KAAK,EAAEgB,SAAS,EAAE,EAAEK,YAAY;gCAC/C,OAAO;oCACLtB,QAAQC,GAAG,CAAC,CAAC,KAAK,EAAEgB,UAAU;gCAChC;4BACF;wBACF;oBACF;oBACA;gBACF,KAAK;oBACH,IAAIvB,MAAMc,OAAO,KAAK,WAAW;wBAC/BR,QAAQC,GAAG,CAAC,CAAC,EAAE,EAAE,IAAI,CAAC1B,SAAS,CAAC,cAAc,EAAE,IAAI,CAACgD,cAAc,CAAC7B,MAAM8B,WAAW,EAAE,CAAC,CAAC;oBAC3F,OAAO,IAAI9B,MAAM+B,QAAQ,EAAE;wBACzBzB,QAAQC,GAAG,CAAC,CAAC,EAAE,EAAE,IAAI,CAAC1B,SAAS,CAAC,WAAW,EAAEmB,MAAMgC,KAAK,IAAI,iBAAiB;oBAC/E;oBACA;YACJ;YACA;QACF;QAGA,OAAQhC,MAAMa,IAAI;YAChB,KAAK;gBACH,IAAIb,MAAMc,OAAO,KAAK,QAAQ;oBAC5BR,QAAQC,GAAG,CAAC,CAAC,KAAK,EAAE,IAAI,CAAC1B,SAAS,CAAC,qBAAqB,EAAEmB,MAAMiC,UAAU,EAAEZ,UAAU,GAAG,MAAM,UAAU,CAAC,CAAC;gBAC7G;gBACA;YAEF,KAAK;gBACH,IAAIrB,MAAMe,OAAO,EAAEC,SAASC,SAAS,GAAG;oBACtC,MAAMD,UAAUhB,MAAMe,OAAO,CAACC,OAAO,CAAC,EAAE;oBACxC,IAAIA,QAAQH,IAAI,KAAK,QAAQ;wBAE3B,MAAMlB,QAAQqB,QAAQkB,IAAI,CAACtC,KAAK,CAAC,MAAMuC,MAAM,CAACrC,CAAAA,OAAQA,KAAKC,IAAI;wBAC/D,IAAIJ,MAAMsB,MAAM,GAAG,GAAG;4BACpB,MAAMmB,YAAYzC,KAAK,CAAC,EAAE,CAACI,IAAI;4BAC/B,IAAIqC,UAAUnB,MAAM,GAAG,KAAK;gCAC1BX,QAAQC,GAAG,CAAC,CAAC,GAAG,EAAE6B,UAAUf,SAAS,CAAC,GAAG,IAAI,GAAG,CAAC;4BACnD,OAAO;gCACLf,QAAQC,GAAG,CAAC,CAAC,GAAG,EAAE6B,WAAW;4BAC/B;wBACF;oBACF,OAAO,IAAIpB,QAAQH,IAAI,KAAK,YAAY;wBAEtC,MAAMU,WAAWP,QAAQE,IAAI,CAACM,OAAO,CAAC,YAAY,OAAOzB,IAAI;wBAG7D,IAAIiB,QAAQE,IAAI,KAAK,UAAUF,QAAQG,KAAK,EAAEC,SAAS;4BACrD,MAAMA,UAAUJ,QAAQG,KAAK,CAACC,OAAO;4BACrC,IAAIA,QAAQH,MAAM,GAAG,IAAI;gCACvBX,QAAQC,GAAG,CAAC,CAAC,SAAS,EAAEa,QAAQC,SAAS,CAAC,GAAG,IAAI,GAAG,CAAC;4BACvD,OAAO;gCACLf,QAAQC,GAAG,CAAC,CAAC,SAAS,EAAEa,SAAS;4BACnC;wBACF,OAEK,IAAIJ,QAAQG,KAAK,IAAIO,OAAOC,IAAI,CAACX,QAAQG,KAAK,EAAEF,MAAM,GAAG,GAAG;4BAC/D,MAAMQ,WAAWC,OAAOC,IAAI,CAACX,QAAQG,KAAK,CAAC,CAAC,EAAE;4BAC9C,MAAMS,aAAaZ,QAAQG,KAAK,CAACM,SAAS;4BAE1C,IAAI,OAAOG,eAAe,YAAYA,WAAWX,MAAM,GAAG,IAAI;gCAC5DX,QAAQC,GAAG,CAAC,CAAC,GAAG,EAAEgB,SAAS,EAAE,EAAEK,YAAY;4BAC7C,OAAO,IAAI,OAAOA,eAAe,UAAU;gCACzCtB,QAAQC,GAAG,CAAC,CAAC,GAAG,EAAEgB,SAAS,EAAE,EAAEK,WAAWP,SAAS,CAAC,GAAG,IAAI,GAAG,CAAC;4BACjE,OAAO;gCACLf,QAAQC,GAAG,CAAC,CAAC,GAAG,EAAEgB,UAAU;4BAC9B;wBACF,OAAO;4BACLjB,QAAQC,GAAG,CAAC,CAAC,GAAG,EAAEgB,UAAU;wBAC9B;oBACF;gBACF;gBACA;YAEF,KAAK;gBAEH,IAAIvB,MAAMe,OAAO,EAAEC,SAAS,CAAC,EAAE,EAAEH,SAAS,eAAe;oBACvD,MAAMwB,SAASrC,MAAMe,OAAO,CAACC,OAAO,CAAC,EAAE;oBACvC,IAAI,CAACqB,OAAON,QAAQ,EAAE;wBACpBzB,QAAQC,GAAG,CAAC,CAAC,kBAAkB,CAAC;oBAClC,OAAO;wBACLD,QAAQC,GAAG,CAAC,CAAC,iBAAiB,EAAE8B,OAAOL,KAAK,IAAI,iBAAiB;oBACnE;gBACF;gBACA;YAEF,KAAK;gBACH,IAAIhC,MAAMc,OAAO,KAAK,WAAW;oBAC/BR,QAAQC,GAAG,CAAC,CAAC,IAAI,EAAE,IAAI,CAAC1B,SAAS,CAAC,cAAc,EAAE,IAAI,CAACgD,cAAc,CAAC7B,MAAM8B,WAAW,EAAE,CAAC,CAAC;oBAC3F,IAAI9B,MAAMsC,cAAc,EAAE;wBACxBhC,QAAQC,GAAG,CAAC,CAAC,aAAa,EAAEP,MAAMsC,cAAc,CAACC,OAAO,CAAC,IAAI;oBAC/D;gBACF,OAAO,IAAIvC,MAAM+B,QAAQ,EAAE;oBACzBzB,QAAQC,GAAG,CAAC,CAAC,IAAI,EAAE,IAAI,CAAC1B,SAAS,CAAC,WAAW,EAAEmB,MAAMgC,KAAK,IAAI,iBAAiB;gBACjF;gBACA;YAEF;gBAEE,IAAI,IAAI,CAACvD,OAAO,CAAC4B,OAAO,IAAI;oBAAC;oBAAa;oBAAS;iBAAU,CAACiB,QAAQ,CAACtB,MAAMa,IAAI,GAAG;oBAClFP,QAAQC,GAAG,CAAC,CAAC,KAAK,EAAEP,MAAMa,IAAI,CAAC,EAAE,EAAEb,MAAMe,OAAO,IAAId,KAAKuC,SAAS,CAACxC,OAAOqB,SAAS,CAAC,GAAG,IAAI,GAAG,CAAC;gBACjG;QACJ;IACF;IAKAV,cAAcX,KAAK,EAAE;QACnB,OAAQA,MAAMa,IAAI;YAChB,KAAK;gBACH,IAAIb,MAAMc,OAAO,KAAK,QAAQ;oBAC5B,IAAI,CAACzB,OAAO,CAACoD,WAAW,CAAC,IAAI,CAAC7D,OAAO,EAAE;wBAAE8D,QAAQ;oBAAS;oBAC1D,IAAI,CAACrD,OAAO,CAACsD,WAAW,CAAC,IAAI,CAAC/D,OAAO,EAAE;gBACzC;gBACA;YAEF,KAAK;gBACH,IAAIoB,MAAMe,OAAO,EAAEC,SAASC,SAAS,GAAG;oBACtC,MAAMD,UAAUhB,MAAMe,OAAO,CAACC,OAAO,CAAC,EAAE;oBACxC,IAAIA,QAAQH,IAAI,KAAK,QAAQ;wBAC3B,MAAM+B,UAAU5B,QAAQkB,IAAI,CAACb,SAAS,CAAC,GAAG;wBAC1C,IAAI,CAAChC,OAAO,CAACsD,WAAW,CAAC,IAAI,CAAC/D,OAAO,EAAEgE;oBACzC,OAAO,IAAI5B,QAAQH,IAAI,KAAK,YAAY;wBACtC,IAAI,CAACxB,OAAO,CAACsD,WAAW,CAAC,IAAI,CAAC/D,OAAO,EAAE,CAAC,MAAM,EAAEoC,QAAQE,IAAI,EAAE,EAAEF,QAAQE,IAAI;oBAC9E;gBACF;gBACA;YAEF,KAAK;gBAEH,IAAIlB,MAAMe,OAAO,EAAEC,SAAS,CAAC,EAAE,EAAEH,SAAS,eAAe;oBACvD,MAAMwB,SAASrC,MAAMe,OAAO,CAACC,OAAO,CAAC,EAAE;oBACvC,IAAI,CAACqB,OAAON,QAAQ,EAAE;wBACpB,IAAI,CAAC1C,OAAO,CAACsD,WAAW,CAAC,IAAI,CAAC/D,OAAO,EAAE,kBAAkB;oBAC3D;gBACF;gBACA;YAEF,KAAK;gBACH,IAAIoB,MAAMc,OAAO,KAAK,WAAW;oBAC/B,IAAI,CAACzB,OAAO,CAACoD,WAAW,CAAC,IAAI,CAAC7D,OAAO,EAAE;wBACrC8D,QAAQ;wBACRG,UAAU;oBACZ;oBACA,IAAI,CAACxD,OAAO,CAACsD,WAAW,CAAC,IAAI,CAAC/D,OAAO,EAAE;gBACzC,OAAO,IAAIoB,MAAM+B,QAAQ,EAAE;oBACzB,IAAI,CAAC1C,OAAO,CAACoD,WAAW,CAAC,IAAI,CAAC7D,OAAO,EAAE;wBACrC8D,QAAQ;oBACV;oBACA,IAAI,CAACrD,OAAO,CAACsD,WAAW,CAAC,IAAI,CAAC/D,OAAO,EAAE,CAAC,QAAQ,EAAEoB,MAAMgC,KAAK,IAAI,iBAAiB;gBACpF;gBACA;QACJ;IACF;IAEAxB,iBAAiB,CAEjB;IAEAE,kBAAkB;QAChB,MAAMoC,UAAU,IAAI,CAACjB,cAAc,CAAC5C,KAAKC,GAAG,KAAK,IAAI,CAACF,SAAS;QAC/D,IAAI,IAAI,CAACG,UAAU,GAAG,GAAG;YACvBmB,QAAQC,GAAG,CAAC,CAAC,KAAK,EAAE,IAAI,CAAC1B,SAAS,CAAC,aAAa,EAAE,IAAI,CAACM,UAAU,CAAC,WAAW,EAAE2D,SAAS;QAC1F;IACF;IAEAC,aAAa;QACX,MAAMC,SAAS;YAAC;YAAK;YAAK;YAAK;YAAK;YAAK;YAAK;YAAK;YAAK;YAAK;SAAI;QACjE,OAAOA,MAAM,CAACC,KAAKC,KAAK,CAACjE,KAAKC,GAAG,KAAK,OAAO8D,OAAO/B,MAAM,CAAC;IAC7D;IAEAkC,eAAeL,OAAO,EAAEM,QAAQ,EAAE;QAChC,MAAMP,WAAWI,KAAKI,GAAG,CAACP,UAAUM,UAAU;QAC9C,MAAME,SAASL,KAAKC,KAAK,CAACL,WAAW;QACrC,MAAMU,QAAQ,KAAKD;QACnB,OAAO,MAAM,IAAIE,MAAM,CAACF,UAAU,IAAIE,MAAM,CAACD,SAAS;IACxD;IAEA1B,eAAe4B,EAAE,EAAE;QACjB,MAAMC,UAAUT,KAAKC,KAAK,CAACO,KAAK;QAChC,MAAME,UAAUV,KAAKC,KAAK,CAACQ,UAAU;QACrC,IAAIC,UAAU,GAAG;YACf,OAAO,GAAGA,QAAQ,EAAE,EAAED,UAAU,GAAG,CAAC,CAAC;QACvC;QACA,OAAO,GAAGA,QAAQ,CAAC,CAAC;IACtB;IAEAE,iBAAiBzC,KAAK,EAAE;QACtB,IAAI,CAACA,SAAS,OAAOA,UAAU,YAAYO,OAAOC,IAAI,CAACR,OAAOF,MAAM,KAAK,GAAG;YAC1E,OAAO;QACT;QAGA,MAAMU,OAAOD,OAAOC,IAAI,CAACR;QACzB,IAAIQ,KAAKV,MAAM,KAAK,GAAG;YACrB,MAAM4C,MAAMlC,IAAI,CAAC,EAAE;YACnB,MAAMmC,QAAQ3C,KAAK,CAAC0C,IAAI;YACxB,IAAI,OAAOC,UAAU,YAAYA,MAAM7C,MAAM,GAAG,IAAI;gBAClD,OAAO,CAAC,CAAC,EAAE4C,IAAI,GAAG,EAAEC,MAAM,EAAE,CAAC;YAC/B,OAAO,IAAI,OAAOA,UAAU,YAAY,OAAOA,UAAU,WAAW;gBAClE,OAAO,CAAC,CAAC,EAAED,IAAI,EAAE,EAAEC,MAAM,CAAC,CAAC;YAC7B;QACF,OAAO,IAAInC,KAAKV,MAAM,IAAI,GAAG;YAC3B,MAAM8C,SAASpC,KAAKqC,GAAG,CAACH,CAAAA;gBACtB,MAAMC,QAAQ3C,KAAK,CAAC0C,IAAI;gBACxB,IAAI,OAAOC,UAAU,YAAYA,MAAM7C,MAAM,GAAG,IAAI;oBAClD,OAAO,GAAG4C,IAAI,GAAG,EAAEC,MAAM,CAAC,CAAC;gBAC7B,OAAO,IAAI,OAAOA,UAAU,YAAY,OAAOA,UAAU,WAAW;oBAClE,OAAO,GAAGD,IAAI,EAAE,EAAEC,OAAO;gBAC3B,OAAO;oBACL,OAAO,GAAGD,IAAI,KAAK,CAAC;gBACtB;YACF,GAAGI,IAAI,CAAC;YACR,OAAO,CAAC,CAAC,EAAEF,OAAO,CAAC,CAAC;QACtB;QAEA,OAAO;IACT;AACF;AAKA,OAAO,SAASG,sBAAsBrF,SAAS,EAAEC,SAAS,EAAEL,UAAU,CAAC,CAAC;IACtE,OAAO,IAAID,oBAAoB;QAC7BK;QACAC;QACA,GAAGL,OAAO;IACZ;AACF"}