{"version":3,"sources":["../../../../src/cli/utils/interactive-detector.js"],"sourcesContent":["// interactive-detector.js - Detect and handle non-interactive environments\r\n\r\n/**\r\n * Check if the current environment supports interactive TTY features\r\n */\r\nexport function isInteractive() {\r\n  // Check if stdin is a TTY\r\n  if (!process.stdin.isTTY) {\r\n    return false;\r\n  }\r\n\r\n  // Check if stdout is a TTY\r\n  if (!process.stdout.isTTY) {\r\n    return false;\r\n  }\r\n\r\n  // Check for CI environment variables\r\n  const ciVars = [\r\n    'CI',\r\n    'CONTINUOUS_INTEGRATION',\r\n    'GITHUB_ACTIONS',\r\n    'GITLAB_CI',\r\n    'JENKINS_URL',\r\n    'TRAVIS',\r\n    'CIRCLECI',\r\n    'CODEBUILD_BUILD_ID',\r\n    'BUILDKITE',\r\n    'DRONE',\r\n  ];\r\n\r\n  for (const varName of ciVars) {\r\n    if (process.env[varName]) {\r\n      return false;\r\n    }\r\n  }\r\n\r\n  // Check if running inside Docker (common indicator)\r\n  if (process.env.DOCKER_CONTAINER || process.env.KUBERNETES_SERVICE_HOST) {\r\n    return false;\r\n  }\r\n\r\n  // Check if running in non-interactive mode explicitly\r\n  if (process.env.CLAUDE_FLOW_NON_INTERACTIVE === 'true') {\r\n    return false;\r\n  }\r\n\r\n  return true;\r\n}\r\n\r\n/**\r\n * Check if raw mode is supported (for Ink UI components)\r\n */\r\nexport function isRawModeSupported() {\r\n  return process.stdin.isTTY && process.stdin.setRawMode !== undefined;\r\n}\r\n\r\n/**\r\n * Get environment type for logging/debugging\r\n */\r\nexport function getEnvironmentType() {\r\n  if (!process.stdin.isTTY) return 'non-tty-stdin';\r\n  if (!process.stdout.isTTY) return 'non-tty-stdout';\r\n  if (process.env.CI) return 'ci-environment';\r\n  if (process.env.GITHUB_ACTIONS) return 'github-actions';\r\n  if (process.env.DOCKER_CONTAINER) return 'docker';\r\n  if (process.env.WSL_DISTRO_NAME || process.env.WSL_INTEROP) return 'wsl';\r\n  if (process.platform === 'win32') return 'windows';\r\n  if (process.env.TERM_PROGRAM === 'vscode') return 'vscode';\r\n  if (!isRawModeSupported()) return 'no-raw-mode';\r\n  return 'interactive';\r\n}\r\n\r\n/**\r\n * Wrap a command to handle non-interactive environments\r\n */\r\nexport function handleNonInteractive(commandName, interactiveFn, nonInteractiveFn) {\r\n  return async (...args) => {\r\n    if (isInteractive() && isRawModeSupported()) {\r\n      // Run interactive version\r\n      return interactiveFn(...args);\r\n    } else {\r\n      // Run non-interactive version or show helpful message\r\n      if (nonInteractiveFn) {\r\n        return nonInteractiveFn(...args);\r\n      } else {\r\n        console.error(`\\n⚠️  ${commandName} requires an interactive terminal.`);\r\n        console.error(`\\nDetected environment: ${getEnvironmentType()}`);\r\n        console.error('\\nPossible solutions:');\r\n        console.error('1. Run this command in an interactive terminal');\r\n        console.error('2. Use environment variables for authentication:');\r\n        console.error('   export ANTHROPIC_API_KEY=\"your-api-key\"');\r\n        console.error('3. Use --non-interactive flag with required parameters');\r\n        console.error('4. If using Docker, run with: docker run -it');\r\n        console.error('5. If using SSH, ensure pseudo-TTY allocation with: ssh -t');\r\n        console.error(\r\n          '\\nFor more info: https://github.com/ruvnet/claude-code-flow/docs/non-interactive.md\\n',\r\n        );\r\n        process.exit(1);\r\n      }\r\n    }\r\n  };\r\n}\r\n\r\n/**\r\n * Show warning for commands that work better in interactive mode\r\n */\r\nexport function warnNonInteractive(commandName) {\r\n  if (!isInteractive()) {\r\n    console.warn(\r\n      `\\n⚠️  Running '${commandName}' in non-interactive mode (${getEnvironmentType()})`,\r\n    );\r\n    console.warn(\r\n      'Some features may be limited. For full functionality, use an interactive terminal.\\n',\r\n    );\r\n  }\r\n}\r\n\r\n/**\r\n * Check for required environment variables in non-interactive mode\r\n */\r\nexport function checkNonInteractiveAuth() {\r\n  if (!isInteractive()) {\r\n    const apiKey = process.env.ANTHROPIC_API_KEY || process.env.CLAUDE_API_KEY;\r\n    if (!apiKey) {\r\n      console.error('\\n❌ Non-interactive mode requires API key to be set.');\r\n      console.error('\\nSet one of these environment variables:');\r\n      console.error('  export ANTHROPIC_API_KEY=\"your-api-key\"');\r\n      console.error('  export CLAUDE_API_KEY=\"your-api-key\"');\r\n      console.error('\\nOr run in an interactive terminal for login prompt.\\n');\r\n      return false;\r\n    }\r\n    return true;\r\n  }\r\n  return true;\r\n}\r\n"],"names":["isInteractive","process","stdin","isTTY","stdout","ciVars","varName","env","DOCKER_CONTAINER","KUBERNETES_SERVICE_HOST","CLAUDE_FLOW_NON_INTERACTIVE","isRawModeSupported","setRawMode","undefined","getEnvironmentType","CI","GITHUB_ACTIONS","WSL_DISTRO_NAME","WSL_INTEROP","platform","TERM_PROGRAM","handleNonInteractive","commandName","interactiveFn","nonInteractiveFn","args","console","error","exit","warnNonInteractive","warn","checkNonInteractiveAuth","apiKey","ANTHROPIC_API_KEY","CLAUDE_API_KEY"],"mappings":"AAKA,OAAO,SAASA;IAEd,IAAI,CAACC,QAAQC,KAAK,CAACC,KAAK,EAAE;QACxB,OAAO;IACT;IAGA,IAAI,CAACF,QAAQG,MAAM,CAACD,KAAK,EAAE;QACzB,OAAO;IACT;IAGA,MAAME,SAAS;QACb;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;KACD;IAED,KAAK,MAAMC,WAAWD,OAAQ;QAC5B,IAAIJ,QAAQM,GAAG,CAACD,QAAQ,EAAE;YACxB,OAAO;QACT;IACF;IAGA,IAAIL,QAAQM,GAAG,CAACC,gBAAgB,IAAIP,QAAQM,GAAG,CAACE,uBAAuB,EAAE;QACvE,OAAO;IACT;IAGA,IAAIR,QAAQM,GAAG,CAACG,2BAA2B,KAAK,QAAQ;QACtD,OAAO;IACT;IAEA,OAAO;AACT;AAKA,OAAO,SAASC;IACd,OAAOV,QAAQC,KAAK,CAACC,KAAK,IAAIF,QAAQC,KAAK,CAACU,UAAU,KAAKC;AAC7D;AAKA,OAAO,SAASC;IACd,IAAI,CAACb,QAAQC,KAAK,CAACC,KAAK,EAAE,OAAO;IACjC,IAAI,CAACF,QAAQG,MAAM,CAACD,KAAK,EAAE,OAAO;IAClC,IAAIF,QAAQM,GAAG,CAACQ,EAAE,EAAE,OAAO;IAC3B,IAAId,QAAQM,GAAG,CAACS,cAAc,EAAE,OAAO;IACvC,IAAIf,QAAQM,GAAG,CAACC,gBAAgB,EAAE,OAAO;IACzC,IAAIP,QAAQM,GAAG,CAACU,eAAe,IAAIhB,QAAQM,GAAG,CAACW,WAAW,EAAE,OAAO;IACnE,IAAIjB,QAAQkB,QAAQ,KAAK,SAAS,OAAO;IACzC,IAAIlB,QAAQM,GAAG,CAACa,YAAY,KAAK,UAAU,OAAO;IAClD,IAAI,CAACT,sBAAsB,OAAO;IAClC,OAAO;AACT;AAKA,OAAO,SAASU,qBAAqBC,WAAW,EAAEC,aAAa,EAAEC,gBAAgB;IAC/E,OAAO,OAAO,GAAGC;QACf,IAAIzB,mBAAmBW,sBAAsB;YAE3C,OAAOY,iBAAiBE;QAC1B,OAAO;YAEL,IAAID,kBAAkB;gBACpB,OAAOA,oBAAoBC;YAC7B,OAAO;gBACLC,QAAQC,KAAK,CAAC,CAAC,MAAM,EAAEL,YAAY,kCAAkC,CAAC;gBACtEI,QAAQC,KAAK,CAAC,CAAC,wBAAwB,EAAEb,sBAAsB;gBAC/DY,QAAQC,KAAK,CAAC;gBACdD,QAAQC,KAAK,CAAC;gBACdD,QAAQC,KAAK,CAAC;gBACdD,QAAQC,KAAK,CAAC;gBACdD,QAAQC,KAAK,CAAC;gBACdD,QAAQC,KAAK,CAAC;gBACdD,QAAQC,KAAK,CAAC;gBACdD,QAAQC,KAAK,CACX;gBAEF1B,QAAQ2B,IAAI,CAAC;YACf;QACF;IACF;AACF;AAKA,OAAO,SAASC,mBAAmBP,WAAW;IAC5C,IAAI,CAACtB,iBAAiB;QACpB0B,QAAQI,IAAI,CACV,CAAC,eAAe,EAAER,YAAY,2BAA2B,EAAER,qBAAqB,CAAC,CAAC;QAEpFY,QAAQI,IAAI,CACV;IAEJ;AACF;AAKA,OAAO,SAASC;IACd,IAAI,CAAC/B,iBAAiB;QACpB,MAAMgC,SAAS/B,QAAQM,GAAG,CAAC0B,iBAAiB,IAAIhC,QAAQM,GAAG,CAAC2B,cAAc;QAC1E,IAAI,CAACF,QAAQ;YACXN,QAAQC,KAAK,CAAC;YACdD,QAAQC,KAAK,CAAC;YACdD,QAAQC,KAAK,CAAC;YACdD,QAAQC,KAAK,CAAC;YACdD,QAAQC,KAAK,CAAC;YACd,OAAO;QACT;QACA,OAAO;IACT;IACA,OAAO;AACT"}