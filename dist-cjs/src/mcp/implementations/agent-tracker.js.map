{"version":3,"sources":["../../../../src/mcp/implementations/agent-tracker.js"],"sourcesContent":["/**\r\n * Agent Tracker Module\r\n * Tracks spawned agents in memory for real-time status\r\n */\r\n\r\nclass AgentTracker {\r\n  constructor() {\r\n    this.agents = new Map();\r\n    this.swarms = new Map();\r\n    this.tasks = new Map();\r\n  }\r\n\r\n  // Track agent spawn\r\n  trackAgent(agentId, agentData) {\r\n    this.agents.set(agentId, {\r\n      ...agentData,\r\n      createdAt: new Date().toISOString(),\r\n      lastActive: new Date().toISOString(),\r\n    });\r\n    \r\n    // Update swarm agent count\r\n    if (agentData.swarmId && this.swarms.has(agentData.swarmId)) {\r\n      const swarm = this.swarms.get(agentData.swarmId);\r\n      swarm.agentCount = (swarm.agentCount || 0) + 1;\r\n      swarm.activeAgents = (swarm.activeAgents || 0) + 1;\r\n    }\r\n  }\r\n\r\n  // Track swarm creation\r\n  trackSwarm(swarmId, swarmData) {\r\n    this.swarms.set(swarmId, {\r\n      ...swarmData,\r\n      agentCount: 0,\r\n      activeAgents: 0,\r\n      taskCount: 0,\r\n      pendingTasks: 0,\r\n      completedTasks: 0,\r\n      createdAt: new Date().toISOString(),\r\n    });\r\n  }\r\n\r\n  // Track task creation\r\n  trackTask(taskId, taskData) {\r\n    this.tasks.set(taskId, {\r\n      ...taskData,\r\n      createdAt: new Date().toISOString(),\r\n      status: taskData.status || 'pending',\r\n    });\r\n    \r\n    // Update swarm task counts\r\n    if (taskData.swarmId && this.swarms.has(taskData.swarmId)) {\r\n      const swarm = this.swarms.get(taskData.swarmId);\r\n      swarm.taskCount = (swarm.taskCount || 0) + 1;\r\n      if (taskData.status === 'pending') {\r\n        swarm.pendingTasks = (swarm.pendingTasks || 0) + 1;\r\n      }\r\n    }\r\n  }\r\n\r\n  // Get agents for a swarm\r\n  getAgents(swarmId) {\r\n    const agents = [];\r\n    for (const [id, agent] of this.agents) {\r\n      if (!swarmId || agent.swarmId === swarmId) {\r\n        agents.push({ id, ...agent });\r\n      }\r\n    }\r\n    return agents;\r\n  }\r\n  \r\n  // Store task results\r\n  storeTaskResult(taskId, result) {\r\n    if (this.tasks.has(taskId)) {\r\n      const task = this.tasks.get(taskId);\r\n      task.result = result;\r\n      task.completedAt = new Date().toISOString();\r\n      this.updateTaskStatus(taskId, 'completed');\r\n      return true;\r\n    }\r\n    // Store even if task wasn't tracked\r\n    this.tasks.set(taskId, {\r\n      id: taskId,\r\n      result: result,\r\n      status: 'completed',\r\n      completedAt: new Date().toISOString(),\r\n    });\r\n    return true;\r\n  }\r\n  \r\n  // Get task results\r\n  getTaskResult(taskId) {\r\n    const task = this.tasks.get(taskId);\r\n    return task ? task.result : null;\r\n  }\r\n\r\n  // Get swarm status\r\n  getSwarmStatus(swarmId) {\r\n    if (!this.swarms.has(swarmId)) {\r\n      // If not tracked, return with real agent counts\r\n      const agents = this.getAgents(swarmId);\r\n      return {\r\n        swarmId,\r\n        agentCount: agents.length,\r\n        activeAgents: agents.filter(a => a.status === 'active').length,\r\n        taskCount: 0,\r\n        pendingTasks: 0,\r\n        completedTasks: 0,\r\n      };\r\n    }\r\n    return this.swarms.get(swarmId);\r\n  }\r\n\r\n  // Update task status\r\n  updateTaskStatus(taskId, status) {\r\n    if (this.tasks.has(taskId)) {\r\n      const task = this.tasks.get(taskId);\r\n      const oldStatus = task.status;\r\n      task.status = status;\r\n      task.lastUpdated = new Date().toISOString();\r\n      \r\n      // Update swarm counts\r\n      if (task.swarmId && this.swarms.has(task.swarmId)) {\r\n        const swarm = this.swarms.get(task.swarmId);\r\n        \r\n        if (oldStatus === 'pending' && status !== 'pending') {\r\n          swarm.pendingTasks = Math.max(0, (swarm.pendingTasks || 0) - 1);\r\n        }\r\n        if (status === 'completed' && oldStatus !== 'completed') {\r\n          swarm.completedTasks = (swarm.completedTasks || 0) + 1;\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\n// Singleton instance\r\nconst tracker = new AgentTracker();\r\n\r\n// Export for use in MCP tools\r\nif (typeof module !== 'undefined' && module.exports) {\r\n  module.exports = tracker;\r\n}\r\n\r\n// Also make available globally for the MCP server\r\nif (typeof global !== 'undefined') {\r\n  global.agentTracker = tracker;\r\n}"],"names":["AgentTracker","agents","Map","swarms","tasks","trackAgent","agentId","agentData","set","createdAt","Date","toISOString","lastActive","swarmId","has","swarm","get","agentCount","activeAgents","trackSwarm","swarmData","taskCount","pendingTasks","completedTasks","trackTask","taskId","taskData","status","getAgents","id","agent","push","storeTaskResult","result","task","completedAt","updateTaskStatus","getTaskResult","getSwarmStatus","length","filter","a","oldStatus","lastUpdated","Math","max","tracker","module","exports","global","agentTracker"],"mappings":"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"}