{"version":3,"sources":["../../../src/sdk/in-process-mcp.ts"],"sourcesContent":["/**\r\n * Real In-Process MCP - 100% SDK-Powered\r\n * Claude-Flow v2.5-alpha.130+\r\n *\r\n * Uses ONLY Claude Code SDK primitives - TRUE in-process MCP:\r\n * - createSdkMcpServer() (SDK creates in-process server)\r\n * - tool() (SDK defines tools with Zod schemas)\r\n * - No subprocess, stdio, or HTTP transport overhead\r\n *\r\n * VERIFIED: Real in-process MCP servers using actual SDK capabilities\r\n */\r\n\r\nimport {\r\n  createSdkMcpServer,\r\n  tool,\r\n  type McpSdkServerConfigWithInstance,\r\n} from '@anthropic-ai/claude-code';\r\nimport { z } from 'zod';\r\n\r\n/**\r\n * Example 1: Math Operations MCP Server\r\n *\r\n * Simple in-process server with basic math operations\r\n */\r\nexport function createMathMcpServer(): McpSdkServerConfigWithInstance {\r\n  return createSdkMcpServer({\r\n    name: 'math-operations',\r\n    version: '1.0.0',\r\n    tools: [\r\n      // Add two numbers\r\n      tool({\r\n        name: 'add',\r\n        description: 'Add two numbers together',\r\n        parameters: z.object({\r\n          a: z.number().describe('First number'),\r\n          b: z.number().describe('Second number'),\r\n        }),\r\n        execute: async ({ a, b }) => {\r\n          return { result: a + b };\r\n        },\r\n      }),\r\n\r\n      // Multiply two numbers\r\n      tool({\r\n        name: 'multiply',\r\n        description: 'Multiply two numbers',\r\n        parameters: z.object({\r\n          a: z.number().describe('First number'),\r\n          b: z.number().describe('Second number'),\r\n        }),\r\n        execute: async ({ a, b }) => {\r\n          return { result: a * b };\r\n        },\r\n      }),\r\n\r\n      // Calculate factorial\r\n      tool({\r\n        name: 'factorial',\r\n        description: 'Calculate factorial of a number',\r\n        parameters: z.object({\r\n          n: z.number().int().min(0).describe('Number to calculate factorial of'),\r\n        }),\r\n        execute: async ({ n }) => {\r\n          let result = 1;\r\n          for (let i = 2; i <= n; i++) {\r\n            result *= i;\r\n          }\r\n          return { result };\r\n        },\r\n      }),\r\n    ],\r\n  });\r\n}\r\n\r\n/**\r\n * Example 2: Session Management MCP Server\r\n *\r\n * In-process server for managing session state\r\n */\r\nexport function createSessionMcpServer(): McpSdkServerConfigWithInstance {\r\n  // In-process state (no IPC overhead!)\r\n  const sessions = new Map<string, { data: Record<string, any>; created: number }>();\r\n\r\n  return createSdkMcpServer({\r\n    name: 'session-manager',\r\n    version: '1.0.0',\r\n    tools: [\r\n      // Create session\r\n      tool({\r\n        name: 'session_create',\r\n        description: 'Create a new session with initial data',\r\n        parameters: z.object({\r\n          sessionId: z.string().describe('Session identifier'),\r\n          data: z.record(z.any()).optional().describe('Initial session data'),\r\n        }),\r\n        execute: async ({ sessionId, data = {} }) => {\r\n          if (sessions.has(sessionId)) {\r\n            return { error: 'Session already exists' };\r\n          }\r\n\r\n          sessions.set(sessionId, {\r\n            data,\r\n            created: Date.now(),\r\n          });\r\n\r\n          return {\r\n            success: true,\r\n            sessionId,\r\n            created: sessions.get(sessionId)!.created,\r\n          };\r\n        },\r\n      }),\r\n\r\n      // Get session data\r\n      tool({\r\n        name: 'session_get',\r\n        description: 'Get session data by ID',\r\n        parameters: z.object({\r\n          sessionId: z.string().describe('Session identifier'),\r\n        }),\r\n        execute: async ({ sessionId }) => {\r\n          const session = sessions.get(sessionId);\r\n\r\n          if (!session) {\r\n            return { error: 'Session not found' };\r\n          }\r\n\r\n          return {\r\n            sessionId,\r\n            data: session.data,\r\n            created: session.created,\r\n          };\r\n        },\r\n      }),\r\n\r\n      // Update session data\r\n      tool({\r\n        name: 'session_update',\r\n        description: 'Update session data (merges with existing)',\r\n        parameters: z.object({\r\n          sessionId: z.string().describe('Session identifier'),\r\n          data: z.record(z.any()).describe('Data to merge'),\r\n        }),\r\n        execute: async ({ sessionId, data }) => {\r\n          const session = sessions.get(sessionId);\r\n\r\n          if (!session) {\r\n            return { error: 'Session not found' };\r\n          }\r\n\r\n          // Merge data\r\n          session.data = { ...session.data, ...data };\r\n\r\n          return {\r\n            success: true,\r\n            sessionId,\r\n            data: session.data,\r\n          };\r\n        },\r\n      }),\r\n\r\n      // Delete session\r\n      tool({\r\n        name: 'session_delete',\r\n        description: 'Delete a session',\r\n        parameters: z.object({\r\n          sessionId: z.string().describe('Session identifier'),\r\n        }),\r\n        execute: async ({ sessionId }) => {\r\n          const existed = sessions.delete(sessionId);\r\n\r\n          return {\r\n            success: existed,\r\n            sessionId,\r\n          };\r\n        },\r\n      }),\r\n\r\n      // List all sessions\r\n      tool({\r\n        name: 'session_list',\r\n        description: 'List all active sessions',\r\n        parameters: z.object({}),\r\n        execute: async () => {\r\n          const sessionList = Array.from(sessions.entries()).map(([id, session]) => ({\r\n            sessionId: id,\r\n            created: session.created,\r\n            dataKeys: Object.keys(session.data),\r\n          }));\r\n\r\n          return {\r\n            sessions: sessionList,\r\n            count: sessionList.length,\r\n          };\r\n        },\r\n      }),\r\n    ],\r\n  });\r\n}\r\n\r\n/**\r\n * Example 3: Checkpoint Management MCP Server\r\n *\r\n * In-process server integrated with checkpoint manager\r\n */\r\nexport function createCheckpointMcpServer(): McpSdkServerConfigWithInstance {\r\n  // Import checkpoint manager\r\n  const { checkpointManager } = require('./checkpoint-manager');\r\n\r\n  return createSdkMcpServer({\r\n    name: 'checkpoint-manager',\r\n    version: '1.0.0',\r\n    tools: [\r\n      // Create checkpoint\r\n      tool({\r\n        name: 'checkpoint_create',\r\n        description: 'Create a checkpoint for a session',\r\n        parameters: z.object({\r\n          sessionId: z.string().describe('Session identifier'),\r\n          description: z.string().describe('Checkpoint description'),\r\n        }),\r\n        execute: async ({ sessionId, description }) => {\r\n          try {\r\n            const checkpointId = await checkpointManager.createCheckpoint(\r\n              sessionId,\r\n              description\r\n            );\r\n\r\n            return {\r\n              success: true,\r\n              checkpointId,\r\n              description,\r\n            };\r\n          } catch (error) {\r\n            return {\r\n              success: false,\r\n              error: error instanceof Error ? error.message : String(error),\r\n            };\r\n          }\r\n        },\r\n      }),\r\n\r\n      // List checkpoints\r\n      tool({\r\n        name: 'checkpoint_list',\r\n        description: 'List all checkpoints for a session',\r\n        parameters: z.object({\r\n          sessionId: z.string().describe('Session identifier'),\r\n        }),\r\n        execute: async ({ sessionId }) => {\r\n          const checkpoints = checkpointManager.listCheckpoints(sessionId);\r\n\r\n          return {\r\n            sessionId,\r\n            checkpoints: checkpoints.map(c => ({\r\n              id: c.id,\r\n              description: c.description,\r\n              timestamp: c.timestamp,\r\n              messageCount: c.messageCount,\r\n              totalTokens: c.totalTokens,\r\n              filesModified: c.filesModified,\r\n            })),\r\n            count: checkpoints.length,\r\n          };\r\n        },\r\n      }),\r\n\r\n      // Get checkpoint info\r\n      tool({\r\n        name: 'checkpoint_get',\r\n        description: 'Get checkpoint details',\r\n        parameters: z.object({\r\n          checkpointId: z.string().describe('Checkpoint identifier'),\r\n        }),\r\n        execute: async ({ checkpointId }) => {\r\n          const checkpoint = checkpointManager.getCheckpoint(checkpointId);\r\n\r\n          if (!checkpoint) {\r\n            return { error: 'Checkpoint not found' };\r\n          }\r\n\r\n          return {\r\n            checkpoint: {\r\n              id: checkpoint.id,\r\n              sessionId: checkpoint.sessionId,\r\n              description: checkpoint.description,\r\n              timestamp: checkpoint.timestamp,\r\n              messageCount: checkpoint.messageCount,\r\n              totalTokens: checkpoint.totalTokens,\r\n              filesModified: checkpoint.filesModified,\r\n            },\r\n          };\r\n        },\r\n      }),\r\n\r\n      // Delete checkpoint\r\n      tool({\r\n        name: 'checkpoint_delete',\r\n        description: 'Delete a checkpoint',\r\n        parameters: z.object({\r\n          checkpointId: z.string().describe('Checkpoint identifier'),\r\n        }),\r\n        execute: async ({ checkpointId }) => {\r\n          try {\r\n            await checkpointManager.deleteCheckpoint(checkpointId);\r\n\r\n            return {\r\n              success: true,\r\n              checkpointId,\r\n            };\r\n          } catch (error) {\r\n            return {\r\n              success: false,\r\n              error: error instanceof Error ? error.message : String(error),\r\n            };\r\n          }\r\n        },\r\n      }),\r\n\r\n      // Compare checkpoints\r\n      tool({\r\n        name: 'checkpoint_diff',\r\n        description: 'Compare two checkpoints',\r\n        parameters: z.object({\r\n          fromId: z.string().describe('From checkpoint ID'),\r\n          toId: z.string().describe('To checkpoint ID'),\r\n        }),\r\n        execute: async ({ fromId, toId }) => {\r\n          try {\r\n            const diff = checkpointManager.getCheckpointDiff(fromId, toId);\r\n\r\n            return {\r\n              success: true,\r\n              diff,\r\n            };\r\n          } catch (error) {\r\n            return {\r\n              success: false,\r\n              error: error instanceof Error ? error.message : String(error),\r\n            };\r\n          }\r\n        },\r\n      }),\r\n    ],\r\n  });\r\n}\r\n\r\n/**\r\n * Example 4: Query Control MCP Server\r\n *\r\n * In-process server for pause/resume operations\r\n */\r\nexport function createQueryControlMcpServer(): McpSdkServerConfigWithInstance {\r\n  const { queryController } = require('./query-control');\r\n\r\n  return createSdkMcpServer({\r\n    name: 'query-control',\r\n    version: '1.0.0',\r\n    tools: [\r\n      // Request pause\r\n      tool({\r\n        name: 'query_pause_request',\r\n        description: 'Request a query to pause at next safe point',\r\n        parameters: z.object({\r\n          sessionId: z.string().describe('Session identifier'),\r\n        }),\r\n        execute: async ({ sessionId }) => {\r\n          queryController.requestPause(sessionId);\r\n\r\n          return {\r\n            success: true,\r\n            sessionId,\r\n            status: 'pause_requested',\r\n          };\r\n        },\r\n      }),\r\n\r\n      // Cancel pause request\r\n      tool({\r\n        name: 'query_pause_cancel',\r\n        description: 'Cancel a pause request',\r\n        parameters: z.object({\r\n          sessionId: z.string().describe('Session identifier'),\r\n        }),\r\n        execute: async ({ sessionId }) => {\r\n          queryController.cancelPauseRequest(sessionId);\r\n\r\n          return {\r\n            success: true,\r\n            sessionId,\r\n            status: 'pause_cancelled',\r\n          };\r\n        },\r\n      }),\r\n\r\n      // List paused queries\r\n      tool({\r\n        name: 'query_paused_list',\r\n        description: 'List all paused queries',\r\n        parameters: z.object({}),\r\n        execute: async () => {\r\n          const paused = queryController.listPausedQueries();\r\n\r\n          return {\r\n            paused,\r\n            count: paused.length,\r\n          };\r\n        },\r\n      }),\r\n\r\n      // Get paused query state\r\n      tool({\r\n        name: 'query_paused_get',\r\n        description: 'Get paused query state',\r\n        parameters: z.object({\r\n          sessionId: z.string().describe('Session identifier'),\r\n        }),\r\n        execute: async ({ sessionId }) => {\r\n          const state = queryController.getPausedState(sessionId);\r\n\r\n          if (!state) {\r\n            return { error: 'Paused query not found' };\r\n          }\r\n\r\n          return {\r\n            sessionId,\r\n            pausePointMessageId: state.pausePointMessageId,\r\n            pausedAt: state.pausedAt,\r\n            messageCount: state.messages.length,\r\n          };\r\n        },\r\n      }),\r\n\r\n      // Get metrics\r\n      tool({\r\n        name: 'query_metrics',\r\n        description: 'Get query control metrics',\r\n        parameters: z.object({}),\r\n        execute: async () => {\r\n          const metrics = queryController.getMetrics();\r\n\r\n          return {\r\n            metrics: {\r\n              totalPauses: metrics.totalPauses,\r\n              totalResumes: metrics.totalResumes,\r\n              averagePauseDuration: metrics.averagePauseDuration,\r\n              longestPause: metrics.longestPause,\r\n            },\r\n          };\r\n        },\r\n      }),\r\n    ],\r\n  });\r\n}\r\n\r\n/**\r\n * Example Usage:\r\n *\r\n * ```typescript\r\n * import { query } from '@anthropic-ai/claude-code';\r\n * import {\r\n *   createMathMcpServer,\r\n *   createSessionMcpServer,\r\n *   createCheckpointMcpServer,\r\n *   createQueryControlMcpServer,\r\n * } from './in-process-mcp';\r\n *\r\n * // Use in-process MCP servers (no IPC overhead!)\r\n * const result = await query({\r\n *   prompt: 'Calculate 5! and store result in session',\r\n *   options: {\r\n *     mcpServers: {\r\n *       math: createMathMcpServer(),\r\n *       session: createSessionMcpServer(),\r\n *       checkpoint: createCheckpointMcpServer(),\r\n *       queryControl: createQueryControlMcpServer(),\r\n *     },\r\n *   },\r\n * });\r\n * ```\r\n */\r\n\r\n// Export all server factories\r\nexport {\r\n  createMathMcpServer,\r\n  createSessionMcpServer,\r\n  createCheckpointMcpServer,\r\n  createQueryControlMcpServer,\r\n};\r\n"],"names":["createSdkMcpServer","tool","z","createMathMcpServer","name","version","tools","description","parameters","object","a","number","describe","b","execute","result","n","int","min","i","createSessionMcpServer","sessions","Map","sessionId","string","data","record","any","optional","has","error","set","created","Date","now","success","get","session","existed","delete","sessionList","Array","from","entries","map","id","dataKeys","Object","keys","count","length","createCheckpointMcpServer","checkpointManager","require","checkpointId","createCheckpoint","Error","message","String","checkpoints","listCheckpoints","c","timestamp","messageCount","totalTokens","filesModified","checkpoint","getCheckpoint","deleteCheckpoint","fromId","toId","diff","getCheckpointDiff","createQueryControlMcpServer","queryController","requestPause","status","cancelPauseRequest","paused","listPausedQueries","state","getPausedState","pausePointMessageId","pausedAt","messages","metrics","getMetrics","totalPauses","totalResumes","averagePauseDuration","longestPause"],"mappings":"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"}