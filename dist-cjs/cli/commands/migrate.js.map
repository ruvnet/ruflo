{
  "version": 3,
  "sources": ["../../../src/cli/commands/migrate.ts"],
  "sourcesContent": ["/**\n * Migration CLI Command Integration\n */\n\nimport { Command } from 'commander';\nimport { MigrationRunner } from '../../migration/migration-runner.js';\nimport { MigrationAnalyzer } from '../../migration/migration-analyzer.js';\nimport { RollbackManager } from '../../migration/rollback-manager.js';\nimport type { MigrationStrategy } from '../../migration/types.js';\nimport { logger } from '../../migration/logger.js';\nimport * as path from 'path';\nimport chalk from 'chalk';\n\nexport function createMigrateCommand(): Command {\n  const command = new Command('migrate');\n\n  command\n    .description('Migrate existing claude-flow projects to optimized prompts')\n    .option('-p, --path <path>', 'Project path', '.')\n    .option('-s, --strategy <type>', 'Migration strategy: full, selective, merge', 'selective')\n    .option('-b, --backup <dir>', 'Backup directory', '.claude-backup')\n    .option('-f, --force', 'Force migration without prompts')\n    .option('--dry-run', 'Simulate migration without making changes')\n    .option('--preserve-custom', 'Preserve custom commands and configurations')\n    .option('--skip-validation', 'Skip post-migration validation')\n    .option('--analyze-only', 'Only analyze project without migrating')\n    .option('--verbose', 'Show detailed output')\n    .action(async (options) => {\n      try {\n        const projectPath = path.resolve(options.path);\n\n        if (options.analyzeOnly) {\n          await analyzeProject(projectPath, options);\n        } else {\n          await runMigration(projectPath, options);\n        }\n      } catch (error) {\n        logger.error('Migration command failed:', error);\n        process.exit(1);\n      }\n    });\n\n  // Sub-commands\n  command\n    .command('analyze [path]')\n    .description('Analyze project for migration readiness')\n    .option('-d, --detailed', 'Show detailed analysis')\n    .option('-o, --output <file>', 'Output analysis to file')\n    .action(async (projectPath = '.', options) => {\n      await analyzeProject(path.resolve(projectPath), options);\n    });\n\n  command\n    .command('rollback [path]')\n    .description('Rollback to previous configuration')\n    .option('-b, --backup <dir>', 'Backup directory', '.claude-backup')\n    .option('-t, --timestamp <time>', 'Restore from specific timestamp')\n    .option('-f, --force', 'Force rollback without prompts')\n    .option('--list', 'List available backups')\n    .action(async (projectPath = '.', options) => {\n      const { RollbackManager } = await import('../../migration/rollback-manager.js');\n      const rollbackManager = new RollbackManager(path.resolve(projectPath), options.backup);\n\n      if (options.list) {\n        const backups = await rollbackManager.listBackups();\n        rollbackManager.printBackupSummary(backups);\n        return;\n      }\n\n      await rollbackManager.rollback(options.timestamp, !options.force);\n    });\n\n  command\n    .command('validate [path]')\n    .description('Validate migration was successful')\n    .option('-v, --verbose', 'Show detailed validation results')\n    .action(async (projectPath = '.', options) => {\n      const { MigrationRunner } = await import('../../migration/migration-runner.js');\n      const runner = new MigrationRunner({\n        projectPath: path.resolve(projectPath),\n        strategy: 'full',\n      });\n\n      const isValid = await runner.validate(options.verbose);\n      process.exit(isValid ? 0 : 1);\n    });\n\n  command\n    .command('status [path]')\n    .description('Show migration status and available backups')\n    .action(async (projectPath = '.') => {\n      await showMigrationStatus(path.resolve(projectPath));\n    });\n\n  return command;\n}\n\nasync function analyzeProject(projectPath: string, options: any): Promise<void> {\n  logger.info(`Analyzing project at ${projectPath}...`);\n\n  const { MigrationAnalyzer } = await import('../../migration/migration-analyzer.js');\n  const analyzer = new MigrationAnalyzer();\n  const analysis = await analyzer.analyze(projectPath);\n\n  if (options.output) {\n    await analyzer.saveAnalysis(analysis, options.output);\n    logger.success(`Analysis saved to ${options.output}`);\n  }\n\n  analyzer.printAnalysis(analysis, options.detailed || options.verbose);\n}\n\nasync function runMigration(projectPath: string, options: any): Promise<void> {\n  const { MigrationRunner } = await import('../../migration/migration-runner.js');\n  const runner = new MigrationRunner({\n    projectPath,\n    strategy: options.strategy as MigrationStrategy,\n    backupDir: options.backup,\n    force: options.force,\n    dryRun: options.dryRun,\n    preserveCustom: options.preserveCustom,\n    skipValidation: options.skipValidation,\n  });\n\n  const result = await runner.run();\n\n  if (!result.success) {\n    process.exit(1);\n  }\n}\n\nasync function showMigrationStatus(projectPath: string): Promise<void> {\n  console.log(chalk.bold('\\n\uD83D\uDCCA Migration Status'));\n  console.log(chalk.gray('\u2500'.repeat(50)));\n\n  // Project analysis\n  const { MigrationAnalyzer } = await import('../../migration/migration-analyzer.js');\n  const analyzer = new MigrationAnalyzer();\n  const analysis = await analyzer.analyze(projectPath);\n\n  console.log(`\\n${chalk.bold('Project:')} ${projectPath}`);\n  console.log(\n    `${chalk.bold('Status:')} ${analysis.hasOptimizedPrompts ? chalk.green('Migrated') : chalk.yellow('Not Migrated')}`,\n  );\n  console.log(`${chalk.bold('Custom Commands:')} ${analysis.customCommands.length}`);\n  console.log(`${chalk.bold('Conflicts:')} ${analysis.conflictingFiles.length}`);\n\n  // Backup status\n  const { RollbackManager } = await import('../../migration/rollback-manager.js');\n  const rollbackManager = new RollbackManager(projectPath);\n  const backups = await rollbackManager.listBackups();\n\n  console.log(`\\n${chalk.bold('Backups Available:')} ${backups.length}`);\n\n  if (backups.length > 0) {\n    const latestBackup = backups[0];\n    console.log(`${chalk.bold('Latest Backup:')} ${latestBackup.timestamp.toLocaleString()}`);\n  }\n\n  // Recommendations\n  if (!analysis.hasOptimizedPrompts) {\n    console.log(chalk.bold('\\n\uD83D\uDCA1 Recommendations:'));\n    console.log('  \u2022 Run migration analysis: claude-flow migrate analyze');\n    console.log('  \u2022 Start with dry run: claude-flow migrate --dry-run');\n    console.log('  \u2022 Use selective strategy: claude-flow migrate --strategy selective');\n  }\n\n  console.log(chalk.gray('\\n' + '\u2500'.repeat(50)));\n}\n"],
  "mappings": "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",
  "names": ["RollbackManager", "MigrationRunner", "MigrationAnalyzer", "chalk"]
}
