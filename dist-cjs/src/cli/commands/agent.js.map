{"version":3,"sources":["../../../../src/cli/commands/agent.ts"],"sourcesContent":["/**\r\n * Comprehensive Agent management commands with advanced features\r\n */\r\n\r\n// Converted from @cliffy to commander.js for Node.js compatibility\r\nimport { Command } from '../commander-fix.js';\r\nimport Table from 'cli-table3';\r\nimport chalk from 'chalk';\r\nimport inquirer from 'inquirer';\r\nconst { colors } = { colors: chalk }; // Compatibility shim\r\nimport type { AgentProfile } from '../../utils/types.js';\r\nimport { AgentManager } from '../../agents/agent-manager.js';\r\nimport type { MemoryManager } from '../../memory/manager.js';\r\nimport { EventBus } from '../../core/event-bus.js';\r\nimport { Logger } from '../../core/logger.js';\r\nimport { DistributedMemorySystem } from '../../memory/distributed-memory.js';\r\nimport { formatDuration, formatBytes, formatPercentage } from '../../utils/formatters.js';\r\nimport path from 'node:path';\r\nimport fs from 'node:fs/promises';\r\n\r\n// Global agent manager instance\r\nlet agentManager: AgentManager | null = null;\r\n\r\n// Initialize agent manager\r\nasync function initializeAgentManager(): Promise<AgentManager> {\r\n  if (agentManager) return agentManager;\r\n\r\n  const logger = new Logger({ level: 'info', format: 'text', destination: 'console' });\r\n  const eventBus = EventBus.getInstance();\r\n  const memorySystem = new DistributedMemorySystem(\r\n    {}, // Use default config\r\n    logger,\r\n    eventBus,\r\n  );\r\n\r\n  await memorySystem.initialize();\r\n\r\n  agentManager = new AgentManager(\r\n    {\r\n      maxAgents: 100,\r\n      defaultTimeout: 60000,\r\n      heartbeatInterval: 15000,\r\n      healthCheckInterval: 30000,\r\n      autoRestart: true,\r\n      resourceLimits: {\r\n        memory: 1024 * 1024 * 1024, // 1GB\r\n        cpu: 2.0,\r\n        disk: 2 * 1024 * 1024 * 1024, // 2GB\r\n      },\r\n    },\r\n    logger,\r\n    eventBus,\r\n    memorySystem,\r\n  );\r\n\r\n  await agentManager.initialize();\r\n  return agentManager;\r\n}\r\n\r\nexport function createAgentCommand(): Command {\r\n  const agentCommand = new Command('agent')\r\n    .description('Comprehensive Claude-Flow agent management with advanced features')\r\n    .action(() => {\r\n      console.log(chalk.cyan('ðŸ¤– Claude-Flow Agent Management System'));\r\n      console.log('');\r\n      console.log('Available commands:');\r\n      console.log('  spawn    - Create and start new agents with advanced configuration');\r\n      console.log('  list     - Display all agents with status, metrics, and resource usage');\r\n      console.log('  info     - Get detailed information about a specific agent');\r\n      console.log('  terminate - Safely terminate agents with cleanup and state preservation');\r\n      console.log('  pool     - Manage agent pools for scaling and load distribution');\r\n      console.log('  health   - Monitor agent health and performance metrics');\r\n      console.log('  logs     - View agent logs and activity history');\r\n      console.log('');\r\n      console.log('Use --help with any command for detailed options.');\r\n    });\r\n  // List command\r\n  agentCommand\r\n    .command('list')\r\n    .description('Display all agents with comprehensive status and metrics')\r\n    .option('-t, --type <type>', 'Filter by agent type')\r\n    .option('-s, --status <status>', 'Filter by agent status')\r\n    .option('--unhealthy', 'Show only unhealthy agents')\r\n    .option('--json', 'Output in JSON format')\r\n    .option('--detailed', 'Show detailed resource usage and metrics')\r\n    .option('--sort <field>', 'Sort by field (name, type, status, health, workload)', 'name')\r\n    .action(async (options: any) => {\r\n      try {\r\n        const manager = await initializeAgentManager();\r\n        let agents = manager.getAllAgents();\r\n\r\n        // Apply filters\r\n        if (options.type) {\r\n          agents = agents.filter((agent) => agent.type === options.type);\r\n        }\r\n\r\n        if (options.status) {\r\n          agents = agents.filter((agent) => agent.status === options.status);\r\n        }\r\n\r\n        if (options.unhealthy) {\r\n          agents = agents.filter((agent) => agent.health < 0.7);\r\n        }\r\n\r\n        // Sort agents\r\n        agents.sort((a, b) => {\r\n          switch (options.sort) {\r\n            case 'type':\r\n              return a.type.localeCompare(b.type);\r\n            case 'status':\r\n              return a.status.localeCompare(b.status);\r\n            case 'health':\r\n              return b.health - a.health;\r\n            case 'workload':\r\n              return b.workload - a.workload;\r\n            default:\r\n              return a.name.localeCompare(b.name);\r\n          }\r\n        });\r\n\r\n        if (options.json) {\r\n          console.log(JSON.stringify(agents, null, 2));\r\n          return;\r\n        }\r\n\r\n        if (agents.length === 0) {\r\n          console.log(chalk.yellow('No agents found matching the criteria'));\r\n          return;\r\n        }\r\n\r\n        console.log(chalk.cyan(`\\nðŸ¤– Agent Status Report (${agents.length} agents)`));\r\n        console.log('='.repeat(80));\r\n\r\n        if (options.detailed) {\r\n          displayDetailedAgentList(agents, manager);\r\n        } else {\r\n          displayCompactAgentList(agents);\r\n        }\r\n\r\n        // Display system stats\r\n        const stats = manager.getSystemStats();\r\n        console.log('\\n' + chalk.cyan('System Overview:'));\r\n        console.log(\r\n          `Total Agents: ${stats.totalAgents} | Active: ${stats.activeAgents} | Healthy: ${stats.healthyAgents}`,\r\n        );\r\n        console.log(\r\n          `Average Health: ${formatPercentage(stats.averageHealth)} | Pools: ${stats.pools}`,\r\n        );\r\n      } catch (error) {\r\n        console.error(\r\n          chalk.red('Error listing agents:'),\r\n          error instanceof Error ? error.message : String(error),\r\n        );\r\n        process.exit(1);\r\n      }\r\n    });\r\n\r\n  // Spawn command\r\n  agentCommand\r\n    .command('spawn [template]')\r\n    .description('Create and start new agents with advanced configuration options')\r\n    .option('-n, --name <name>', 'Agent name')\r\n    .option('-t, --type <type>', 'Agent type')\r\n    .option('--template <template>', 'Use predefined template')\r\n    .option('--pool <pool>', 'Add to specific pool')\r\n    .option('--autonomy <level>', 'Autonomy level (0-1)', '0.7')\r\n    .option('--max-tasks <max>', 'Maximum concurrent tasks', '5')\r\n    .option('--max-memory <mb>', 'Memory limit in MB', '512')\r\n    .option('--timeout <ms>', 'Task timeout in milliseconds', '300000')\r\n    .option('--interactive', 'Interactive configuration')\r\n    .option('--start', 'Automatically start the agent after creation')\r\n    .option('--config <path>', 'Load configuration from JSON file')\r\n    .action(async (template: string, options: any) => {\r\n      try {\r\n        const manager = await initializeAgentManager();\r\n\r\n        let agentConfig: any = {};\r\n\r\n        // Load from config file if provided\r\n        if (options.config) {\r\n          const configPath = path.resolve(options.config);\r\n          const configData = await fs.readFile(configPath, 'utf-8');\r\n          agentConfig = JSON.parse(configData);\r\n        }\r\n\r\n        // Interactive mode\r\n        if (options.interactive) {\r\n          agentConfig = await interactiveAgentConfiguration(manager);\r\n        } else {\r\n          // Use template or command line options\r\n          const templateName = template || options.template;\r\n          if (!templateName) {\r\n            console.error(\r\n              chalk.red('Error: Template name is required. Use --interactive for guided setup.'),\r\n            );\r\n            return;\r\n          }\r\n\r\n          const templates = manager.getAgentTemplates();\r\n          const selectedTemplate = templates.find((t) =>\r\n            t.name.toLowerCase().includes(templateName.toLowerCase()),\r\n          );\r\n\r\n          if (!selectedTemplate) {\r\n            console.error(chalk.red(`Template '${templateName}' not found.`));\r\n            console.log('Available templates:');\r\n            templates.forEach((t) => console.log(`  - ${t.name} (${t.type})`));\r\n            return;\r\n          }\r\n\r\n          agentConfig = {\r\n            template: selectedTemplate.name,\r\n            name: options.name,\r\n            config: {\r\n              autonomyLevel: parseFloat(options.autonomy),\r\n              maxConcurrentTasks: parseInt(options.maxTasks),\r\n              timeoutThreshold: parseInt(options.timeout),\r\n            },\r\n            environment: {\r\n              maxMemoryUsage: parseInt(options.maxMemory) * 1024 * 1024,\r\n            },\r\n          };\r\n        }\r\n\r\n        console.log(chalk.cyan('\\nðŸš€ Creating new agent...'));\r\n\r\n        // Create the agent\r\n        const agentId = await manager.createAgent(agentConfig.template || 'researcher', {\r\n          name: agentConfig.name,\r\n          config: agentConfig.config,\r\n          environment: agentConfig.environment,\r\n        });\r\n\r\n        console.log(chalk.green(`âœ… Agent created successfully!`));\r\n        console.log(`Agent ID: ${chalk.bold(agentId)}`);\r\n\r\n        // Add to pool if specified\r\n        if (options.pool) {\r\n          const pools = manager.getAllPools();\r\n          const targetPool = pools.find((p) => p.name === options.pool || p.id === options.pool);\r\n          if (targetPool) {\r\n            // Add agent to pool (this would need pool management methods)\r\n            console.log(chalk.blue(`Added to pool: ${targetPool.name}`));\r\n          } else {\r\n            console.log(chalk.yellow(`Warning: Pool '${options.pool}' not found`));\r\n          }\r\n        }\r\n\r\n        // Start agent if requested\r\n        if (options.start) {\r\n          console.log(chalk.cyan('Starting agent...'));\r\n          await manager.startAgent(agentId);\r\n          console.log(chalk.green('âœ… Agent started and ready!'));\r\n        } else {\r\n          console.log(chalk.yellow(`Use 'claude-flow agent start ${agentId}' to start the agent`));\r\n        }\r\n\r\n        // Display agent info\r\n        const agent = manager.getAgent(agentId);\r\n        if (agent) {\r\n          displayAgentSummary(agent);\r\n        }\r\n      } catch (error) {\r\n        console.error(\r\n          chalk.red('Error creating agent:'),\r\n          error instanceof Error ? error.message : String(error),\r\n        );\r\n        process.exit(1);\r\n      }\r\n    });\r\n\r\n  // TODO: Convert remaining commands to commander.js syntax\r\n  // For now, return the basic command structure\r\n  return agentCommand;\r\n}\r\n\r\n// Legacy export for backward compatibility\r\nexport const agentCommand = createAgentCommand();\r\n\r\n// TODO: Complete conversion of remaining commands (terminate, info, start, restart, pool, health)\r\n// Temporarily removing broken code to fix build errors\r\n\r\n// === HELPER FUNCTIONS ===\r\n\r\nasync function interactiveAgentConfiguration(manager: AgentManager): Promise<any> {\r\n  console.log(chalk.cyan('\\nðŸ› ï¸  Interactive Agent Configuration'));\r\n\r\n  const templates = manager.getAgentTemplates();\r\n  const templateChoices = templates.map((t) => ({ name: `${t.name} (${t.type})`, value: t.name }));\r\n\r\n  const answers = await inquirer.prompt([\r\n    {\r\n      type: 'list',\r\n      name: 'template',\r\n      message: 'Select agent template:',\r\n      choices: templateChoices,\r\n    },\r\n    {\r\n      type: 'input',\r\n      name: 'name',\r\n      message: 'Agent name:',\r\n      default: `agent-${Date.now().toString(36)}`,\r\n    },\r\n    {\r\n      type: 'input',\r\n      name: 'autonomyLevel',\r\n      message: 'Autonomy level (0-1):',\r\n      default: '0.7',\r\n      validate: (value) => {\r\n        const num = parseFloat(value);\r\n        return (num >= 0 && num <= 1) || 'Must be between 0 and 1';\r\n      },\r\n    },\r\n    {\r\n      type: 'input',\r\n      name: 'maxTasks',\r\n      message: 'Maximum concurrent tasks:',\r\n      default: '5',\r\n      validate: (value) => {\r\n        const num = parseInt(value);\r\n        return (num > 0 && num <= 20) || 'Must be between 1 and 20';\r\n      },\r\n    },\r\n    {\r\n      type: 'input',\r\n      name: 'maxMemory',\r\n      message: 'Memory limit (MB):',\r\n      default: '512',\r\n      validate: (value) => {\r\n        const num = parseInt(value);\r\n        return (num >= 128 && num <= 4096) || 'Must be between 128 and 4096';\r\n      },\r\n    },\r\n  ]);\r\n\r\n  return {\r\n    template: answers.template,\r\n    name: answers.name,\r\n    config: {\r\n      autonomyLevel: parseFloat(answers.autonomyLevel),\r\n      maxConcurrentTasks: parseInt(answers.maxTasks),\r\n      timeoutThreshold: 300000,\r\n    },\r\n    environment: {\r\n      maxMemoryUsage: parseInt(answers.maxMemory) * 1024 * 1024,\r\n    },\r\n  };\r\n}\r\n\r\nfunction displayCompactAgentList(agents: any[]): void {\r\n  const table = new Table({\r\n    head: ['ID', 'Name', 'Type', 'Status', 'Health', 'Workload', 'Last Activity'],\r\n    colWidths: [10, 20, 15, 12, 10, 10, 20],\r\n  });\r\n\r\n  agents.forEach((agent) => {\r\n    table.push([\r\n      agent.id.id.slice(-8),\r\n      agent.name,\r\n      agent.type,\r\n      getStatusDisplay(agent.status),\r\n      getHealthDisplay(agent.health),\r\n      agent.workload.toString(),\r\n      formatRelativeTime(agent.metrics?.lastActivity || agent.lastHeartbeat),\r\n    ]);\r\n  });\r\n\r\n  console.log(table.toString());\r\n}\r\n\r\nfunction displayDetailedAgentList(agents: any[], manager: AgentManager): void {\r\n  agents.forEach((agent, index) => {\r\n    if (index > 0) console.log('\\n' + '-'.repeat(60));\r\n\r\n    console.log(`\\n${chalk.bold(agent.name)} (${agent.id.id.slice(-8)})`);\r\n    console.log(`Type: ${chalk.blue(agent.type)} | Status: ${getStatusDisplay(agent.status)}`);\r\n    console.log(`Health: ${getHealthDisplay(agent.health)} | Workload: ${agent.workload}`);\r\n\r\n    if (agent.metrics) {\r\n      console.log(\r\n        `Tasks: ${agent.metrics.tasksCompleted} completed, ${agent.metrics.tasksFailed} failed`,\r\n      );\r\n      console.log(`Success Rate: ${formatPercentage(agent.metrics.successRate)}`);\r\n      console.log(\r\n        `CPU: ${formatPercentage(agent.metrics.cpuUsage)} | Memory: ${formatBytes(agent.metrics.memoryUsage)}`,\r\n      );\r\n    }\r\n\r\n    const health = manager.getAgentHealth(agent.id.id);\r\n    if (health && health.issues.length > 0) {\r\n      console.log(chalk.red(`Issues: ${health.issues.length} active`));\r\n    }\r\n  });\r\n}\r\n\r\nfunction displayAgentSummary(agent: any): void {\r\n  console.log('\\n' + chalk.dim('Agent Summary:'));\r\n  console.log(`  Name: ${agent.name}`);\r\n  console.log(`  Type: ${agent.type}`);\r\n  console.log(`  Status: ${getStatusDisplay(agent.status)}`);\r\n  console.log(`  Health: ${getHealthDisplay(agent.health)}`);\r\n}\r\n\r\n// === UTILITY FUNCTIONS ===\r\n\r\nfunction getStatusColor(status: string): any {\r\n  switch (status) {\r\n    case 'idle':\r\n      return chalk.green;\r\n    case 'busy':\r\n      return chalk.blue;\r\n    case 'error':\r\n      return chalk.red;\r\n    case 'offline':\r\n      return chalk.gray;\r\n    case 'initializing':\r\n      return chalk.yellow;\r\n    case 'terminating':\r\n      return chalk.yellow;\r\n    case 'terminated':\r\n      return chalk.gray;\r\n    default:\r\n      return chalk.white;\r\n  }\r\n}\r\n\r\nfunction getStatusDisplay(status: string): string {\r\n  const color = getStatusColor(status);\r\n  return `${color}${status.toUpperCase()}${chalk.reset}`;\r\n}\r\n\r\nfunction getHealthDisplay(health: number): string {\r\n  const percentage = Math.round(health * 100);\r\n  let color = chalk.green;\r\n\r\n  if (health < 0.3) color = chalk.red;\r\n  else if (health < 0.7) color = chalk.yellow;\r\n\r\n  return `${color}${percentage}%${chalk.reset}`;\r\n}\r\n\r\nfunction formatRelativeTime(date: Date): string {\r\n  const now = new Date();\r\n  const diff = now.getTime() - date.getTime();\r\n\r\n  if (diff < 60000) return 'just now';\r\n  if (diff < 3600000) return `${Math.floor(diff / 60000)}m ago`;\r\n  if (diff < 86400000) return `${Math.floor(diff / 3600000)}h ago`;\r\n  return `${Math.floor(diff / 86400000)}d ago`;\r\n}\r\n"],"names":["Command","Table","chalk","inquirer","colors","AgentManager","EventBus","Logger","DistributedMemorySystem","formatBytes","formatPercentage","path","fs","agentManager","initializeAgentManager","logger","level","format","destination","eventBus","getInstance","memorySystem","initialize","maxAgents","defaultTimeout","heartbeatInterval","healthCheckInterval","autoRestart","resourceLimits","memory","cpu","disk","createAgentCommand","agentCommand","description","action","console","log","cyan","command","option","options","manager","agents","getAllAgents","type","filter","agent","status","unhealthy","health","sort","a","b","localeCompare","workload","name","json","JSON","stringify","length","yellow","repeat","detailed","displayDetailedAgentList","displayCompactAgentList","stats","getSystemStats","totalAgents","activeAgents","healthyAgents","averageHealth","pools","error","red","Error","message","String","process","exit","template","agentConfig","config","configPath","resolve","configData","readFile","parse","interactive","interactiveAgentConfiguration","templateName","templates","getAgentTemplates","selectedTemplate","find","t","toLowerCase","includes","forEach","autonomyLevel","parseFloat","autonomy","maxConcurrentTasks","parseInt","maxTasks","timeoutThreshold","timeout","environment","maxMemoryUsage","maxMemory","agentId","createAgent","green","bold","pool","getAllPools","targetPool","p","id","blue","start","startAgent","getAgent","displayAgentSummary","templateChoices","map","value","answers","prompt","choices","default","Date","now","toString","validate","num","table","head","colWidths","push","slice","getStatusDisplay","getHealthDisplay","formatRelativeTime","metrics","lastActivity","lastHeartbeat","index","tasksCompleted","tasksFailed","successRate","cpuUsage","memoryUsage","getAgentHealth","issues","dim","getStatusColor","gray","white","color","toUpperCase","reset","percentage","Math","round","date","diff","getTime","floor"],"mappings":"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"}