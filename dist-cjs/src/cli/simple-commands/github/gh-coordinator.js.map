{"version":3,"sources":["../../../../../src/cli/simple-commands/github/gh-coordinator.js"],"sourcesContent":["#!/usr/bin/env node\r\n/**\r\n * GitHub Coordinator Command\r\n * Provides GitHub workflow orchestration and coordination capabilities\r\n */\r\n\r\nimport { printSuccess, printError, printWarning, printInfo } from '../utils.js';\r\nimport { githubAPI } from './github-api.js';\r\nimport { execSync } from 'child_process';\r\n\r\nclass GitHubCoordinator {\r\n  constructor() {\r\n    this.api = githubAPI;\r\n    this.workflows = new Map();\r\n    this.activeCoordinations = new Map();\r\n  }\r\n\r\n  /**\r\n   * Initialize GitHub coordination\r\n   */\r\n  async initialize(options = {}) {\r\n    printInfo('üöÄ Initializing GitHub Coordinator...');\r\n\r\n    // Authenticate with GitHub\r\n    const authenticated = await this.api.authenticate(options.token);\r\n    if (!authenticated) {\r\n      throw new Error('Failed to authenticate with GitHub');\r\n    }\r\n\r\n    // Check if we're in a git repository\r\n    try {\r\n      const remoteUrl = execSync('git config --get remote.origin.url', { encoding: 'utf8' }).trim();\r\n      const repoMatch = remoteUrl.match(/github\\.com[:/]([^/]+)\\/([^/]+?)(?:\\.git)?$/);\r\n\r\n      if (repoMatch) {\r\n        this.currentRepo = { owner: repoMatch[1], repo: repoMatch[2] };\r\n        printSuccess(`Connected to repository: ${this.currentRepo.owner}/${this.currentRepo.repo}`);\r\n      }\r\n    } catch (error) {\r\n      printWarning('Not in a git repository or no GitHub remote found');\r\n    }\r\n\r\n    // Initialize swarm integration\r\n    await this.initializeSwarmIntegration();\r\n\r\n    printSuccess('‚úÖ GitHub Coordinator initialized successfully');\r\n  }\r\n\r\n  /**\r\n   * Initialize swarm integration for coordination\r\n   */\r\n  async initializeSwarmIntegration() {\r\n    try {\r\n      // Check if ruv-swarm is available\r\n      execSync('npx ruv-swarm --version', { stdio: 'pipe' });\r\n\r\n      // Initialize swarm for GitHub coordination\r\n      const swarmInit = execSync(\r\n        'npx ruv-swarm hook pre-task --description \"GitHub workflow coordination\"',\r\n        { encoding: 'utf8' },\r\n      );\r\n\r\n      if (swarmInit.includes('continue')) {\r\n        printSuccess('üêù Swarm integration initialized for GitHub coordination');\r\n        this.swarmEnabled = true;\r\n      }\r\n    } catch (error) {\r\n      printWarning('Swarm integration not available - continuing without swarm features');\r\n      this.swarmEnabled = false;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Coordinate CI/CD pipeline setup\r\n   */\r\n  async coordinateCIPipeline(options = {}) {\r\n    printInfo('üîÑ Coordinating CI/CD pipeline setup...');\r\n\r\n    if (!this.currentRepo) {\r\n      throw new Error('No GitHub repository context available');\r\n    }\r\n\r\n    const { owner, repo } = this.currentRepo;\r\n    const pipeline = options.pipeline || 'nodejs';\r\n    const autoApprove = options.autoApprove || false;\r\n\r\n    // Create workflow coordination plan\r\n    const coordinationPlan = {\r\n      id: `ci-setup-${Date.now()}`,\r\n      type: 'ci_pipeline_setup',\r\n      repository: `${owner}/${repo}`,\r\n      pipeline,\r\n      steps: [\r\n        'analyze_repository_structure',\r\n        'create_workflow_files',\r\n        'setup_environment_secrets',\r\n        'configure_branch_protection',\r\n        'test_pipeline_execution',\r\n        'setup_notifications',\r\n      ],\r\n      status: 'planning',\r\n    };\r\n\r\n    this.activeCoordinations.set(coordinationPlan.id, coordinationPlan);\r\n\r\n    // Execute coordination with swarm if available\r\n    if (this.swarmEnabled) {\r\n      await this.executeWithSwarm(coordinationPlan);\r\n    } else {\r\n      await this.executeCoordination(coordinationPlan);\r\n    }\r\n\r\n    return coordinationPlan;\r\n  }\r\n\r\n  /**\r\n   * Execute coordination with swarm integration\r\n   */\r\n  async executeWithSwarm(coordinationPlan) {\r\n    printInfo('üêù Executing coordination with swarm...');\r\n\r\n    // Store coordination plan in swarm memory\r\n    const memoryKey = `github-coordination/${coordinationPlan.id}`;\r\n    execSync(\r\n      `npx ruv-swarm hook notification --message \"GitHub Coordination: ${coordinationPlan.type} started\" --telemetry true`,\r\n    );\r\n\r\n    // Execute each step with swarm coordination\r\n    for (const step of coordinationPlan.steps) {\r\n      printInfo(`Executing step: ${step}`);\r\n\r\n      // Pre-step hook\r\n      execSync(`npx ruv-swarm hook pre-task --description \"GitHub step: ${step}\"`);\r\n\r\n      // Execute step\r\n      await this.executeCoordinationStep(coordinationPlan, step);\r\n\r\n      // Post-step hook\r\n      execSync(\r\n        `npx ruv-swarm hook post-edit --file \"github-coordination\" --memory-key \"${memoryKey}/${step}\"`,\r\n      );\r\n    }\r\n\r\n    // Final coordination notification\r\n    execSync(\r\n      `npx ruv-swarm hook notification --message \"GitHub Coordination: ${coordinationPlan.type} completed\" --telemetry true`,\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Execute coordination without swarm\r\n   */\r\n  async executeCoordination(coordinationPlan) {\r\n    printInfo('‚ö° Executing coordination...');\r\n\r\n    for (const step of coordinationPlan.steps) {\r\n      printInfo(`Executing step: ${step}`);\r\n      await this.executeCoordinationStep(coordinationPlan, step);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Execute individual coordination step\r\n   */\r\n  async executeCoordinationStep(coordinationPlan, step) {\r\n    const { owner, repo } = this.currentRepo;\r\n\r\n    switch (step) {\r\n      case 'analyze_repository_structure':\r\n        await this.analyzeRepositoryStructure(owner, repo);\r\n        break;\r\n      case 'create_workflow_files':\r\n        await this.createWorkflowFiles(owner, repo, coordinationPlan.pipeline);\r\n        break;\r\n      case 'setup_environment_secrets':\r\n        await this.setupEnvironmentSecrets(owner, repo);\r\n        break;\r\n      case 'configure_branch_protection':\r\n        await this.configureBranchProtection(owner, repo);\r\n        break;\r\n      case 'test_pipeline_execution':\r\n        await this.testPipelineExecution(owner, repo);\r\n        break;\r\n      case 'setup_notifications':\r\n        await this.setupNotifications(owner, repo);\r\n        break;\r\n      default:\r\n        printWarning(`Unknown coordination step: ${step}`);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Analyze repository structure\r\n   */\r\n  async analyzeRepositoryStructure(owner, repo) {\r\n    printInfo('üìä Analyzing repository structure...');\r\n\r\n    const response = await this.api.getRepository(owner, repo);\r\n    if (!response.success) {\r\n      throw new Error(`Failed to get repository info: ${response.error}`);\r\n    }\r\n\r\n    const repoData = response.data;\r\n    const analysis = {\r\n      language: repoData.language,\r\n      size: repoData.size,\r\n      defaultBranch: repoData.default_branch,\r\n      hasWorkflows: false,\r\n      hasTests: false,\r\n      hasPackageJson: false,\r\n    };\r\n\r\n    // Check for existing workflows\r\n    const workflowsResponse = await this.api.listWorkflows(owner, repo);\r\n    if (workflowsResponse.success) {\r\n      analysis.hasWorkflows = workflowsResponse.data.total_count > 0;\r\n    }\r\n\r\n    // Check for package.json (Node.js projects)\r\n    try {\r\n      const packageResponse = await this.api.request(\r\n        `/repos/${owner}/${repo}/contents/package.json`,\r\n      );\r\n      analysis.hasPackageJson = packageResponse.success;\r\n    } catch (error) {\r\n      // package.json doesn't exist\r\n    }\r\n\r\n    printSuccess(`‚úÖ Repository analysis complete: ${analysis.language} project`);\r\n    return analysis;\r\n  }\r\n\r\n  /**\r\n   * Create workflow files\r\n   */\r\n  async createWorkflowFiles(owner, repo, pipeline) {\r\n    printInfo('üìù Creating workflow files...');\r\n\r\n    const workflowContent = this.generateWorkflowContent(pipeline);\r\n    const workflowPath = `.github/workflows/${pipeline}-ci.yml`;\r\n\r\n    // Create workflow file content\r\n    const createFileData = {\r\n      message: `Add ${pipeline} CI workflow`,\r\n      content: Buffer.from(workflowContent).toString('base64'),\r\n      path: workflowPath,\r\n    };\r\n\r\n    // Check if file exists\r\n    const existingFile = await this.api.request(`/repos/${owner}/${repo}/contents/${workflowPath}`);\r\n    if (existingFile.success) {\r\n      // Update existing file\r\n      createFileData.sha = existingFile.data.sha;\r\n      createFileData.message = `Update ${pipeline} CI workflow`;\r\n    }\r\n\r\n    const response = await this.api.request(`/repos/${owner}/${repo}/contents/${workflowPath}`, {\r\n      method: 'PUT',\r\n      body: createFileData,\r\n    });\r\n\r\n    if (response.success) {\r\n      printSuccess(`‚úÖ Workflow file created: ${workflowPath}`);\r\n    } else {\r\n      throw new Error(`Failed to create workflow file: ${response.error}`);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Generate workflow content based on pipeline type\r\n   */\r\n  generateWorkflowContent(pipeline) {\r\n    const templates = {\r\n      nodejs: `name: Node.js CI\r\n\r\non:\r\n  push:\r\n    branches: [ main, develop ]\r\n  pull_request:\r\n    branches: [ main, develop ]\r\n\r\njobs:\r\n  test:\r\n    runs-on: ubuntu-latest\r\n    \r\n    strategy:\r\n      matrix:\r\n        node-version: [16.x, 18.x, 20.x]\r\n        \r\n    steps:\r\n    - uses: actions/checkout@v3\r\n    \r\n    - name: Use Node.js \\${{ matrix.node-version }}\r\n      uses: actions/setup-node@v3\r\n      with:\r\n        node-version: \\${{ matrix.node-version }}\r\n        cache: 'npm'\r\n        \r\n    - name: Install dependencies\r\n      run: npm ci\r\n      \r\n    - name: Run tests\r\n      run: npm test\r\n      \r\n    - name: Run linter\r\n      run: npm run lint\r\n      \r\n    - name: Build project\r\n      run: npm run build\r\n      \r\n  security:\r\n    runs-on: ubuntu-latest\r\n    steps:\r\n    - uses: actions/checkout@v3\r\n    \r\n    - name: Run security audit\r\n      run: npm audit --audit-level moderate\r\n      \r\n    - name: Check for vulnerabilities\r\n      run: npm audit --audit-level high\r\n`,\r\n\r\n      python: `name: Python CI\r\n\r\non:\r\n  push:\r\n    branches: [ main, develop ]\r\n  pull_request:\r\n    branches: [ main, develop ]\r\n\r\njobs:\r\n  test:\r\n    runs-on: ubuntu-latest\r\n    \r\n    strategy:\r\n      matrix:\r\n        python-version: [3.8, 3.9, 3.10, 3.11]\r\n        \r\n    steps:\r\n    - uses: actions/checkout@v3\r\n    \r\n    - name: Set up Python \\${{ matrix.python-version }}\r\n      uses: actions/setup-python@v4\r\n      with:\r\n        python-version: \\${{ matrix.python-version }}\r\n        \r\n    - name: Install dependencies\r\n      run: |\r\n        python -m pip install --upgrade pip\r\n        pip install pytest pytest-cov\r\n        if [ -f requirements.txt ]; then pip install -r requirements.txt; fi\r\n        \r\n    - name: Run tests\r\n      run: pytest --cov=./ --cov-report=xml\r\n      \r\n    - name: Upload coverage\r\n      uses: codecov/codecov-action@v3\r\n      with:\r\n        file: ./coverage.xml\r\n`,\r\n\r\n      docker: `name: Docker CI\r\n\r\non:\r\n  push:\r\n    branches: [ main, develop ]\r\n  pull_request:\r\n    branches: [ main, develop ]\r\n\r\njobs:\r\n  build:\r\n    runs-on: ubuntu-latest\r\n    \r\n    steps:\r\n    - uses: actions/checkout@v3\r\n    \r\n    - name: Build Docker image\r\n      run: docker build -t app .\r\n      \r\n    - name: Run container tests\r\n      run: docker run --rm app npm test\r\n      \r\n    - name: Security scan\r\n      uses: aquasecurity/trivy-action@master\r\n      with:\r\n        image-ref: 'app'\r\n        format: 'sarif'\r\n        output: 'trivy-results.sarif'\r\n`,\r\n    };\r\n\r\n    return templates[pipeline] || templates.nodejs;\r\n  }\r\n\r\n  /**\r\n   * Setup environment secrets\r\n   */\r\n  async setupEnvironmentSecrets(owner, repo) {\r\n    printInfo('üîê Setting up environment secrets...');\r\n\r\n    const secrets = [\r\n      { name: 'NODE_ENV', description: 'Node.js environment' },\r\n      { name: 'DATABASE_URL', description: 'Database connection string' },\r\n      { name: 'API_KEY', description: 'API authentication key' },\r\n    ];\r\n\r\n    printInfo('Recommended secrets to configure:');\r\n    secrets.forEach((secret) => {\r\n      console.log(`  - ${secret.name}: ${secret.description}`);\r\n    });\r\n\r\n    printWarning('Note: Secrets must be configured manually in GitHub repository settings');\r\n    printSuccess('‚úÖ Environment secrets guidance provided');\r\n  }\r\n\r\n  /**\r\n   * Configure branch protection\r\n   */\r\n  async configureBranchProtection(owner, repo) {\r\n    printInfo('üõ°Ô∏è  Configuring branch protection...');\r\n\r\n    const protectionConfig = {\r\n      required_status_checks: {\r\n        strict: true,\r\n        contexts: ['test'],\r\n      },\r\n      enforce_admins: true,\r\n      required_pull_request_reviews: {\r\n        required_approving_review_count: 1,\r\n        dismiss_stale_reviews: true,\r\n      },\r\n      restrictions: null,\r\n    };\r\n\r\n    const response = await this.api.updateBranchProtection(owner, repo, 'main', protectionConfig);\r\n\r\n    if (response.success) {\r\n      printSuccess('‚úÖ Branch protection configured for main branch');\r\n    } else {\r\n      printWarning(`‚ö†Ô∏è  Failed to configure branch protection: ${response.error}`);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Test pipeline execution\r\n   */\r\n  async testPipelineExecution(owner, repo) {\r\n    printInfo('üß™ Testing pipeline execution...');\r\n\r\n    const workflows = await this.api.listWorkflows(owner, repo);\r\n    if (!workflows.success) {\r\n      printWarning('No workflows found to test');\r\n      return;\r\n    }\r\n\r\n    const recentRuns = await this.api.listWorkflowRuns(owner, repo, { per_page: 5 });\r\n    if (recentRuns.success) {\r\n      printInfo(`Found ${recentRuns.data.total_count} recent workflow runs`);\r\n\r\n      const latestRun = recentRuns.data.workflow_runs[0];\r\n      if (latestRun) {\r\n        printInfo(`Latest run: ${latestRun.conclusion} (${latestRun.status})`);\r\n      }\r\n    }\r\n\r\n    printSuccess('‚úÖ Pipeline execution status checked');\r\n  }\r\n\r\n  /**\r\n   * Setup notifications\r\n   */\r\n  async setupNotifications(owner, repo) {\r\n    printInfo('üì¢ Setting up notifications...');\r\n\r\n    const webhookConfig = {\r\n      name: 'web',\r\n      active: true,\r\n      events: ['push', 'pull_request', 'issues', 'workflow_run'],\r\n      config: {\r\n        url: 'https://your-webhook-url.com/github',\r\n        content_type: 'json',\r\n        insecure_ssl: '0',\r\n      },\r\n    };\r\n\r\n    printInfo('Webhook configuration template:');\r\n    console.log(JSON.stringify(webhookConfig, null, 2));\r\n\r\n    printWarning('Note: Webhook URL must be configured with your actual endpoint');\r\n    printSuccess('‚úÖ Notification setup guidance provided');\r\n  }\r\n\r\n  /**\r\n   * Coordinate release process\r\n   */\r\n  async coordinateRelease(options = {}) {\r\n    printInfo('üöÄ Coordinating release process...');\r\n\r\n    if (!this.currentRepo) {\r\n      throw new Error('No GitHub repository context available');\r\n    }\r\n\r\n    const { owner, repo } = this.currentRepo;\r\n    const version = options.version || 'auto';\r\n    const prerelease = options.prerelease || false;\r\n\r\n    const coordinationPlan = {\r\n      id: `release-${Date.now()}`,\r\n      type: 'release_coordination',\r\n      repository: `${owner}/${repo}`,\r\n      version,\r\n      prerelease,\r\n      steps: [\r\n        'prepare_release_notes',\r\n        'create_release_branch',\r\n        'run_release_tests',\r\n        'create_release_tag',\r\n        'publish_release',\r\n        'notify_stakeholders',\r\n      ],\r\n      status: 'planning',\r\n    };\r\n\r\n    this.activeCoordinations.set(coordinationPlan.id, coordinationPlan);\r\n\r\n    if (this.swarmEnabled) {\r\n      await this.executeWithSwarm(coordinationPlan);\r\n    } else {\r\n      await this.executeCoordination(coordinationPlan);\r\n    }\r\n\r\n    return coordinationPlan;\r\n  }\r\n\r\n  /**\r\n   * Get coordination status\r\n   */\r\n  getCoordinationStatus(coordinationId) {\r\n    return this.activeCoordinations.get(coordinationId) || null;\r\n  }\r\n\r\n  /**\r\n   * List active coordinations\r\n   */\r\n  listActiveCoordinations() {\r\n    return Array.from(this.activeCoordinations.values());\r\n  }\r\n\r\n  /**\r\n   * Cancel coordination\r\n   */\r\n  cancelCoordination(coordinationId) {\r\n    const coordination = this.activeCoordinations.get(coordinationId);\r\n    if (coordination) {\r\n      coordination.status = 'cancelled';\r\n      this.activeCoordinations.delete(coordinationId);\r\n      printSuccess(`‚úÖ Coordination ${coordinationId} cancelled`);\r\n      return true;\r\n    }\r\n    return false;\r\n  }\r\n}\r\n\r\n// Export coordination function\r\nexport async function coordinateGitHubWorkflow(args, flags = {}) {\r\n  const coordinator = new GitHubCoordinator();\r\n\r\n  try {\r\n    await coordinator.initialize(flags);\r\n\r\n    const objective = args.join(' ').trim();\r\n\r\n    if (objective.includes('CI/CD') || objective.includes('pipeline')) {\r\n      return await coordinator.coordinateCIPipeline(flags);\r\n    } else if (objective.includes('release')) {\r\n      return await coordinator.coordinateRelease(flags);\r\n    } else {\r\n      // General coordination\r\n      printInfo(`üéØ Coordinating: ${objective}`);\r\n\r\n      const coordinationPlan = {\r\n        id: `general-${Date.now()}`,\r\n        type: 'general_coordination',\r\n        objective,\r\n        steps: ['analyze_requirements', 'create_action_plan', 'execute_plan'],\r\n        status: 'planning',\r\n      };\r\n\r\n      coordinator.activeCoordinations.set(coordinationPlan.id, coordinationPlan);\r\n\r\n      if (coordinator.swarmEnabled) {\r\n        await coordinator.executeWithSwarm(coordinationPlan);\r\n      } else {\r\n        await coordinator.executeCoordination(coordinationPlan);\r\n      }\r\n\r\n      return coordinationPlan;\r\n    }\r\n  } catch (error) {\r\n    printError(`‚ùå GitHub coordination failed: ${error.message}`);\r\n    throw error;\r\n  }\r\n}\r\n\r\nexport default GitHubCoordinator;\r\n"],"names":["printSuccess","printError","printWarning","printInfo","githubAPI","execSync","GitHubCoordinator","api","workflows","Map","activeCoordinations","initialize","options","authenticated","authenticate","token","Error","remoteUrl","encoding","trim","repoMatch","match","currentRepo","owner","repo","error","initializeSwarmIntegration","stdio","swarmInit","includes","swarmEnabled","coordinateCIPipeline","pipeline","autoApprove","coordinationPlan","id","Date","now","type","repository","steps","status","set","executeWithSwarm","executeCoordination","memoryKey","step","executeCoordinationStep","analyzeRepositoryStructure","createWorkflowFiles","setupEnvironmentSecrets","configureBranchProtection","testPipelineExecution","setupNotifications","response","getRepository","success","repoData","data","analysis","language","size","defaultBranch","default_branch","hasWorkflows","hasTests","hasPackageJson","workflowsResponse","listWorkflows","total_count","packageResponse","request","workflowContent","generateWorkflowContent","workflowPath","createFileData","message","content","Buffer","from","toString","path","existingFile","sha","method","body","templates","nodejs","python","docker","secrets","name","description","forEach","secret","console","log","protectionConfig","required_status_checks","strict","contexts","enforce_admins","required_pull_request_reviews","required_approving_review_count","dismiss_stale_reviews","restrictions","updateBranchProtection","recentRuns","listWorkflowRuns","per_page","latestRun","workflow_runs","conclusion","webhookConfig","active","events","config","url","content_type","insecure_ssl","JSON","stringify","coordinateRelease","version","prerelease","getCoordinationStatus","coordinationId","get","listActiveCoordinations","Array","values","cancelCoordination","coordination","delete","coordinateGitHubWorkflow","args","flags","coordinator","objective","join"],"mappings":"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"}