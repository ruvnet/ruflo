{"version":3,"sources":["../../../../src/cli/simple-commands/verification-integration.js"],"sourcesContent":["/**\r\n * Verification Integration Module\r\n * Connects verification system to actual agent operations and task execution\r\n */\r\n\r\nimport { exec } from 'child_process';\r\nimport { promisify } from 'util';\r\nimport fs from 'fs/promises';\r\nimport path from 'path';\r\nimport crypto from 'crypto';\r\n\r\nconst execAsync = promisify(exec);\r\n\r\n/**\r\n * Verification middleware for task execution\r\n * Intercepts task results and verifies them\r\n */\r\nexport class VerificationMiddleware {\r\n  constructor(verificationSystem) {\r\n    this.verificationSystem = verificationSystem;\r\n    this.enabled = true;\r\n    this.autoRollback = true;\r\n  }\r\n\r\n  /**\r\n   * Wrap task execution with verification\r\n   */\r\n  async executeWithVerification(taskFn, taskId, agentType, context) {\r\n    // Pre-task verification\r\n    const preCheck = await this.preTaskVerification(taskId, context);\r\n    if (!preCheck.passed && this.enabled) {\r\n      console.log(`‚ùå Pre-task verification failed for ${taskId}`);\r\n      return { success: false, reason: 'Pre-task verification failed', preCheck };\r\n    }\r\n\r\n    // Execute the actual task\r\n    let result;\r\n    let error;\r\n    try {\r\n      result = await taskFn();\r\n    } catch (err) {\r\n      error = err;\r\n      result = { success: false, error: err.message };\r\n    }\r\n\r\n    // Post-task verification\r\n    const postCheck = await this.postTaskVerification(taskId, agentType, result, context);\r\n    \r\n    // If verification fails and auto-rollback is enabled\r\n    if (!postCheck.passed && this.autoRollback) {\r\n      await this.rollbackTask(taskId, context);\r\n      return { \r\n        success: false, \r\n        reason: 'Post-task verification failed', \r\n        result,\r\n        verification: postCheck,\r\n        rollback: true \r\n      };\r\n    }\r\n\r\n    return {\r\n      success: postCheck.passed,\r\n      result,\r\n      verification: postCheck\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Pre-task verification checks\r\n   */\r\n  async preTaskVerification(taskId, context) {\r\n    const checks = [];\r\n\r\n    // Check if environment is clean\r\n    if (context.requiresCleanState) {\r\n      const gitStatus = await this.checkGitStatus();\r\n      checks.push({\r\n        name: 'clean-state',\r\n        passed: gitStatus.clean,\r\n        score: gitStatus.clean ? 1.0 : 0.0\r\n      });\r\n    }\r\n\r\n    // Check dependencies\r\n    if (context.dependencies) {\r\n      for (const dep of context.dependencies) {\r\n        const exists = await this.checkDependency(dep);\r\n        checks.push({\r\n          name: `dependency-${dep}`,\r\n          passed: exists,\r\n          score: exists ? 1.0 : 0.0\r\n        });\r\n      }\r\n    }\r\n\r\n    const score = checks.length > 0 \r\n      ? checks.reduce((sum, c) => sum + c.score, 0) / checks.length\r\n      : 1.0;\r\n\r\n    return {\r\n      passed: score >= 0.95,\r\n      score,\r\n      checks,\r\n      timestamp: new Date().toISOString()\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Post-task verification checks\r\n   */\r\n  async postTaskVerification(taskId, agentType, result, context) {\r\n    const checks = [];\r\n\r\n    // Verify based on agent type\r\n    switch (agentType) {\r\n      case 'coder':\r\n        // Check if code compiles\r\n        if (context.language === 'typescript' || context.language === 'javascript') {\r\n          const typecheck = await this.runTypeCheck();\r\n          checks.push({\r\n            name: 'typecheck',\r\n            passed: typecheck.passed,\r\n            score: typecheck.score\r\n          });\r\n        }\r\n\r\n        // Check if tests pass\r\n        if (context.hasTests) {\r\n          const tests = await this.runTests();\r\n          checks.push({\r\n            name: 'tests',\r\n            passed: tests.passed,\r\n            score: tests.score\r\n          });\r\n        }\r\n\r\n        // Check linting\r\n        const lint = await this.runLint();\r\n        checks.push({\r\n          name: 'lint',\r\n          passed: lint.passed,\r\n          score: lint.score\r\n        });\r\n        break;\r\n\r\n      case 'researcher':\r\n        // Verify research output has required sections\r\n        if (result && result.output) {\r\n          const hasFindings = result.output.includes('findings') || result.output.includes('results');\r\n          checks.push({\r\n            name: 'research-completeness',\r\n            passed: hasFindings,\r\n            score: hasFindings ? 1.0 : 0.5\r\n          });\r\n        }\r\n        break;\r\n\r\n      case 'tester':\r\n        // Verify test coverage meets threshold\r\n        if (context.requiresCoverage) {\r\n          const coverage = await this.checkTestCoverage();\r\n          checks.push({\r\n            name: 'coverage',\r\n            passed: coverage.percentage >= 80,\r\n            score: coverage.percentage / 100\r\n          });\r\n        }\r\n        break;\r\n\r\n      case 'architect':\r\n        // Verify architecture decisions are documented\r\n        const hasDocs = await this.checkDocumentation();\r\n        checks.push({\r\n          name: 'documentation',\r\n          passed: hasDocs,\r\n          score: hasDocs ? 1.0 : 0.3\r\n        });\r\n        break;\r\n    }\r\n\r\n    // Check result success claim\r\n    if (result && result.success !== undefined) {\r\n      checks.push({\r\n        name: 'claimed-success',\r\n        passed: result.success,\r\n        score: result.success ? 1.0 : 0.0\r\n      });\r\n    }\r\n\r\n    const score = checks.length > 0\r\n      ? checks.reduce((sum, c) => sum + c.score, 0) / checks.length\r\n      : 0.5;\r\n\r\n    // Store verification result\r\n    await this.verificationSystem.verifyTask(taskId, agentType, {\r\n      success: result?.success,\r\n      checks,\r\n      score\r\n    });\r\n\r\n    return {\r\n      passed: score >= this.verificationSystem.getThreshold(),\r\n      score,\r\n      checks,\r\n      timestamp: new Date().toISOString()\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Rollback task changes\r\n   */\r\n  async rollbackTask(taskId, context) {\r\n    console.log(`üîÑ Rolling back task ${taskId}...`);\r\n    \r\n    try {\r\n      // If we have a git checkpoint, rollback to it\r\n      if (context.gitCheckpoint) {\r\n        await execAsync(`git reset --hard ${context.gitCheckpoint}`);\r\n        console.log(`‚úÖ Rolled back to checkpoint ${context.gitCheckpoint}`);\r\n      } else {\r\n        // Otherwise just reset to last commit\r\n        await execAsync('git reset --hard HEAD');\r\n        console.log(`‚úÖ Rolled back to last commit`);\r\n      }\r\n      return true;\r\n    } catch (error) {\r\n      console.error(`‚ùå Rollback failed: ${error.message}`);\r\n      return false;\r\n    }\r\n  }\r\n\r\n  // Helper methods for actual checks\r\n\r\n  async checkGitStatus() {\r\n    try {\r\n      const { stdout } = await execAsync('git status --porcelain');\r\n      return { clean: stdout.trim() === '' };\r\n    } catch {\r\n      return { clean: false };\r\n    }\r\n  }\r\n\r\n  async checkDependency(dep) {\r\n    try {\r\n      await execAsync(`which ${dep}`);\r\n      return true;\r\n    } catch {\r\n      return false;\r\n    }\r\n  }\r\n\r\n  async runTypeCheck() {\r\n    try {\r\n      const { stdout } = await execAsync('npm run typecheck 2>&1 || true');\r\n      const hasErrors = stdout.toLowerCase().includes('error');\r\n      return {\r\n        passed: !hasErrors,\r\n        score: hasErrors ? 0.5 : 1.0\r\n      };\r\n    } catch {\r\n      return { passed: false, score: 0.3 };\r\n    }\r\n  }\r\n\r\n  async runTests() {\r\n    try {\r\n      const { stdout } = await execAsync('npm test 2>&1 || true');\r\n      const passed = stdout.includes('PASS') || stdout.includes('passing');\r\n      const failed = stdout.includes('FAIL') || stdout.includes('failing');\r\n      \r\n      if (passed && !failed) {\r\n        return { passed: true, score: 1.0 };\r\n      } else if (passed && failed) {\r\n        return { passed: false, score: 0.7 };\r\n      } else {\r\n        return { passed: false, score: 0.3 };\r\n      }\r\n    } catch {\r\n      return { passed: false, score: 0.0 };\r\n    }\r\n  }\r\n\r\n  async runLint() {\r\n    try {\r\n      const { stdout } = await execAsync('npm run lint 2>&1 || true');\r\n      const hasErrors = stdout.toLowerCase().includes('error');\r\n      const hasWarnings = stdout.toLowerCase().includes('warning');\r\n      \r\n      if (!hasErrors && !hasWarnings) {\r\n        return { passed: true, score: 1.0 };\r\n      } else if (!hasErrors && hasWarnings) {\r\n        return { passed: true, score: 0.8 };\r\n      } else {\r\n        return { passed: false, score: 0.5 };\r\n      }\r\n    } catch {\r\n      return { passed: false, score: 0.3 };\r\n    }\r\n  }\r\n\r\n  async checkTestCoverage() {\r\n    try {\r\n      const { stdout } = await execAsync('npm run coverage 2>&1 || true');\r\n      const match = stdout.match(/(\\d+(\\.\\d+)?)\\s*%/);\r\n      const percentage = match ? parseFloat(match[1]) : 0;\r\n      return { percentage };\r\n    } catch {\r\n      return { percentage: 0 };\r\n    }\r\n  }\r\n\r\n  async checkDocumentation() {\r\n    try {\r\n      // Check if common documentation files exist\r\n      const docFiles = ['README.md', 'ARCHITECTURE.md', 'docs/design.md'];\r\n      for (const file of docFiles) {\r\n        try {\r\n          await fs.access(file);\r\n          return true;\r\n        } catch {\r\n          // Continue checking other files\r\n        }\r\n      }\r\n      return false;\r\n    } catch {\r\n      return false;\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * Integration with swarm command\r\n */\r\nexport function integrateWithSwarm(swarmCommand, verificationSystem) {\r\n  const originalExecute = swarmCommand.execute;\r\n  const middleware = new VerificationMiddleware(verificationSystem);\r\n\r\n  swarmCommand.execute = async function(objective, options) {\r\n    // Create checkpoint before swarm execution\r\n    const checkpoint = await createGitCheckpoint();\r\n    \r\n    // Wrap the original execution with verification\r\n    const context = {\r\n      requiresCleanState: !options.allowDirty,\r\n      dependencies: options.dependencies || [],\r\n      language: options.language || 'javascript',\r\n      hasTests: options.runTests !== false,\r\n      requiresCoverage: options.coverage === true,\r\n      gitCheckpoint: checkpoint\r\n    };\r\n\r\n    // Execute with verification\r\n    return await middleware.executeWithVerification(\r\n      () => originalExecute.call(this, objective, options),\r\n      `swarm-${Date.now()}`,\r\n      'swarm',\r\n      context\r\n    );\r\n  };\r\n\r\n  return swarmCommand;\r\n}\r\n\r\n/**\r\n * Integration with non-interactive mode\r\n */\r\nexport function integrateWithNonInteractive(flags, verificationSystem) {\r\n  // Add verification flags to non-interactive mode\r\n  const verificationFlags = {\r\n    ...flags,\r\n    verify: true,\r\n    verificationThreshold: flags.threshold || 0.95,\r\n    autoRollback: flags.rollback !== false\r\n  };\r\n\r\n  // Return a verification wrapper for non-interactive execution\r\n  return {\r\n    flags: verificationFlags,\r\n    preExecute: async (taskId) => {\r\n      await verificationSystem.initialize('strict');\r\n      console.log('‚úÖ Verification enabled for non-interactive mode');\r\n    },\r\n    postExecute: async (taskId, result) => {\r\n      const verification = await verificationSystem.verifyTask(\r\n        taskId,\r\n        'non-interactive',\r\n        result\r\n      );\r\n      \r\n      if (!verification.passed) {\r\n        console.error('‚ùå Verification failed in non-interactive mode');\r\n        process.exit(1);\r\n      }\r\n    }\r\n  };\r\n}\r\n\r\n/**\r\n * Integration with training system\r\n */\r\nexport function integrateWithTraining(trainingSystem, verificationSystem) {\r\n  // Feed verification results to training system\r\n  verificationSystem.onVerification = async (verification) => {\r\n    // Convert verification to training data\r\n    const trainingData = {\r\n      input: {\r\n        taskId: verification.taskId,\r\n        agentType: verification.agentType,\r\n        context: verification.context\r\n      },\r\n      output: {\r\n        success: verification.passed,\r\n        score: verification.score,\r\n        checks: verification.results\r\n      }\r\n    };\r\n\r\n    // Feed to training system\r\n    await trainingSystem.learn(trainingData);\r\n    \r\n    // Update agent model based on performance\r\n    if (verification.agentType) {\r\n      await trainingSystem.updateAgentModel(\r\n        verification.agentType,\r\n        verification.score\r\n      );\r\n    }\r\n  };\r\n\r\n  return verificationSystem;\r\n}\r\n\r\n/**\r\n * Create git checkpoint for rollback\r\n */\r\nasync function createGitCheckpoint() {\r\n  try {\r\n    // Create a temporary commit as checkpoint\r\n    const { stdout } = await execAsync('git rev-parse HEAD');\r\n    return stdout.trim();\r\n  } catch {\r\n    return null;\r\n  }\r\n}\r\n\r\n/**\r\n * Export verification hooks for command integration\r\n */\r\nexport const verificationHooks = {\r\n  beforeTask: async (taskId, context) => {\r\n    // Hook called before task execution\r\n    console.log(`üîç Pre-task verification for ${taskId}`);\r\n  },\r\n  \r\n  afterTask: async (taskId, result, context) => {\r\n    // Hook called after task execution\r\n    console.log(`‚úÖ Post-task verification for ${taskId}`);\r\n  },\r\n  \r\n  onFailure: async (taskId, verification) => {\r\n    // Hook called when verification fails\r\n    console.log(`‚ùå Verification failed for ${taskId}: ${verification.score}`);\r\n  }\r\n};\r\n\r\nexport default {\r\n  VerificationMiddleware,\r\n  integrateWithSwarm,\r\n  integrateWithNonInteractive,\r\n  integrateWithTraining,\r\n  verificationHooks\r\n};"],"names":["exec","promisify","fs","execAsync","VerificationMiddleware","verificationSystem","enabled","autoRollback","executeWithVerification","taskFn","taskId","agentType","context","preCheck","preTaskVerification","passed","console","log","success","reason","result","error","err","message","postCheck","postTaskVerification","rollbackTask","verification","rollback","checks","requiresCleanState","gitStatus","checkGitStatus","push","name","clean","score","dependencies","dep","exists","checkDependency","length","reduce","sum","c","timestamp","Date","toISOString","language","typecheck","runTypeCheck","hasTests","tests","runTests","lint","runLint","output","hasFindings","includes","requiresCoverage","coverage","checkTestCoverage","percentage","hasDocs","checkDocumentation","undefined","verifyTask","getThreshold","gitCheckpoint","stdout","trim","hasErrors","toLowerCase","failed","hasWarnings","match","parseFloat","docFiles","file","access","integrateWithSwarm","swarmCommand","originalExecute","execute","middleware","objective","options","checkpoint","createGitCheckpoint","allowDirty","call","now","integrateWithNonInteractive","flags","verificationFlags","verify","verificationThreshold","threshold","preExecute","initialize","postExecute","process","exit","integrateWithTraining","trainingSystem","onVerification","trainingData","input","results","learn","updateAgentModel","verificationHooks","beforeTask","afterTask","onFailure"],"mappings":"AAKA,SAASA,IAAI,QAAQ,gBAAgB;AACrC,SAASC,SAAS,QAAQ,OAAO;AACjC,OAAOC,QAAQ,cAAc;AAI7B,MAAMC,YAAYF,UAAUD;AAM5B,OAAO,MAAMI;IACX,YAAYC,kBAAkB,CAAE;QAC9B,IAAI,CAACA,kBAAkB,GAAGA;QAC1B,IAAI,CAACC,OAAO,GAAG;QACf,IAAI,CAACC,YAAY,GAAG;IACtB;IAKA,MAAMC,wBAAwBC,MAAM,EAAEC,MAAM,EAAEC,SAAS,EAAEC,OAAO,EAAE;QAEhE,MAAMC,WAAW,MAAM,IAAI,CAACC,mBAAmB,CAACJ,QAAQE;QACxD,IAAI,CAACC,SAASE,MAAM,IAAI,IAAI,CAACT,OAAO,EAAE;YACpCU,QAAQC,GAAG,CAAC,CAAC,mCAAmC,EAAEP,QAAQ;YAC1D,OAAO;gBAAEQ,SAAS;gBAAOC,QAAQ;gBAAgCN;YAAS;QAC5E;QAGA,IAAIO;QACJ,IAAIC;QACJ,IAAI;YACFD,SAAS,MAAMX;QACjB,EAAE,OAAOa,KAAK;YACZD,QAAQC;YACRF,SAAS;gBAAEF,SAAS;gBAAOG,OAAOC,IAAIC,OAAO;YAAC;QAChD;QAGA,MAAMC,YAAY,MAAM,IAAI,CAACC,oBAAoB,CAACf,QAAQC,WAAWS,QAAQR;QAG7E,IAAI,CAACY,UAAUT,MAAM,IAAI,IAAI,CAACR,YAAY,EAAE;YAC1C,MAAM,IAAI,CAACmB,YAAY,CAAChB,QAAQE;YAChC,OAAO;gBACLM,SAAS;gBACTC,QAAQ;gBACRC;gBACAO,cAAcH;gBACdI,UAAU;YACZ;QACF;QAEA,OAAO;YACLV,SAASM,UAAUT,MAAM;YACzBK;YACAO,cAAcH;QAChB;IACF;IAKA,MAAMV,oBAAoBJ,MAAM,EAAEE,OAAO,EAAE;QACzC,MAAMiB,SAAS,EAAE;QAGjB,IAAIjB,QAAQkB,kBAAkB,EAAE;YAC9B,MAAMC,YAAY,MAAM,IAAI,CAACC,cAAc;YAC3CH,OAAOI,IAAI,CAAC;gBACVC,MAAM;gBACNnB,QAAQgB,UAAUI,KAAK;gBACvBC,OAAOL,UAAUI,KAAK,GAAG,MAAM;YACjC;QACF;QAGA,IAAIvB,QAAQyB,YAAY,EAAE;YACxB,KAAK,MAAMC,OAAO1B,QAAQyB,YAAY,CAAE;gBACtC,MAAME,SAAS,MAAM,IAAI,CAACC,eAAe,CAACF;gBAC1CT,OAAOI,IAAI,CAAC;oBACVC,MAAM,CAAC,WAAW,EAAEI,KAAK;oBACzBvB,QAAQwB;oBACRH,OAAOG,SAAS,MAAM;gBACxB;YACF;QACF;QAEA,MAAMH,QAAQP,OAAOY,MAAM,GAAG,IAC1BZ,OAAOa,MAAM,CAAC,CAACC,KAAKC,IAAMD,MAAMC,EAAER,KAAK,EAAE,KAAKP,OAAOY,MAAM,GAC3D;QAEJ,OAAO;YACL1B,QAAQqB,SAAS;YACjBA;YACAP;YACAgB,WAAW,IAAIC,OAAOC,WAAW;QACnC;IACF;IAKA,MAAMtB,qBAAqBf,MAAM,EAAEC,SAAS,EAAES,MAAM,EAAER,OAAO,EAAE;QAC7D,MAAMiB,SAAS,EAAE;QAGjB,OAAQlB;YACN,KAAK;gBAEH,IAAIC,QAAQoC,QAAQ,KAAK,gBAAgBpC,QAAQoC,QAAQ,KAAK,cAAc;oBAC1E,MAAMC,YAAY,MAAM,IAAI,CAACC,YAAY;oBACzCrB,OAAOI,IAAI,CAAC;wBACVC,MAAM;wBACNnB,QAAQkC,UAAUlC,MAAM;wBACxBqB,OAAOa,UAAUb,KAAK;oBACxB;gBACF;gBAGA,IAAIxB,QAAQuC,QAAQ,EAAE;oBACpB,MAAMC,QAAQ,MAAM,IAAI,CAACC,QAAQ;oBACjCxB,OAAOI,IAAI,CAAC;wBACVC,MAAM;wBACNnB,QAAQqC,MAAMrC,MAAM;wBACpBqB,OAAOgB,MAAMhB,KAAK;oBACpB;gBACF;gBAGA,MAAMkB,OAAO,MAAM,IAAI,CAACC,OAAO;gBAC/B1B,OAAOI,IAAI,CAAC;oBACVC,MAAM;oBACNnB,QAAQuC,KAAKvC,MAAM;oBACnBqB,OAAOkB,KAAKlB,KAAK;gBACnB;gBACA;YAEF,KAAK;gBAEH,IAAIhB,UAAUA,OAAOoC,MAAM,EAAE;oBAC3B,MAAMC,cAAcrC,OAAOoC,MAAM,CAACE,QAAQ,CAAC,eAAetC,OAAOoC,MAAM,CAACE,QAAQ,CAAC;oBACjF7B,OAAOI,IAAI,CAAC;wBACVC,MAAM;wBACNnB,QAAQ0C;wBACRrB,OAAOqB,cAAc,MAAM;oBAC7B;gBACF;gBACA;YAEF,KAAK;gBAEH,IAAI7C,QAAQ+C,gBAAgB,EAAE;oBAC5B,MAAMC,WAAW,MAAM,IAAI,CAACC,iBAAiB;oBAC7ChC,OAAOI,IAAI,CAAC;wBACVC,MAAM;wBACNnB,QAAQ6C,SAASE,UAAU,IAAI;wBAC/B1B,OAAOwB,SAASE,UAAU,GAAG;oBAC/B;gBACF;gBACA;YAEF,KAAK;gBAEH,MAAMC,UAAU,MAAM,IAAI,CAACC,kBAAkB;gBAC7CnC,OAAOI,IAAI,CAAC;oBACVC,MAAM;oBACNnB,QAAQgD;oBACR3B,OAAO2B,UAAU,MAAM;gBACzB;gBACA;QACJ;QAGA,IAAI3C,UAAUA,OAAOF,OAAO,KAAK+C,WAAW;YAC1CpC,OAAOI,IAAI,CAAC;gBACVC,MAAM;gBACNnB,QAAQK,OAAOF,OAAO;gBACtBkB,OAAOhB,OAAOF,OAAO,GAAG,MAAM;YAChC;QACF;QAEA,MAAMkB,QAAQP,OAAOY,MAAM,GAAG,IAC1BZ,OAAOa,MAAM,CAAC,CAACC,KAAKC,IAAMD,MAAMC,EAAER,KAAK,EAAE,KAAKP,OAAOY,MAAM,GAC3D;QAGJ,MAAM,IAAI,CAACpC,kBAAkB,CAAC6D,UAAU,CAACxD,QAAQC,WAAW;YAC1DO,SAASE,QAAQF;YACjBW;YACAO;QACF;QAEA,OAAO;YACLrB,QAAQqB,SAAS,IAAI,CAAC/B,kBAAkB,CAAC8D,YAAY;YACrD/B;YACAP;YACAgB,WAAW,IAAIC,OAAOC,WAAW;QACnC;IACF;IAKA,MAAMrB,aAAahB,MAAM,EAAEE,OAAO,EAAE;QAClCI,QAAQC,GAAG,CAAC,CAAC,qBAAqB,EAAEP,OAAO,GAAG,CAAC;QAE/C,IAAI;YAEF,IAAIE,QAAQwD,aAAa,EAAE;gBACzB,MAAMjE,UAAU,CAAC,iBAAiB,EAAES,QAAQwD,aAAa,EAAE;gBAC3DpD,QAAQC,GAAG,CAAC,CAAC,4BAA4B,EAAEL,QAAQwD,aAAa,EAAE;YACpE,OAAO;gBAEL,MAAMjE,UAAU;gBAChBa,QAAQC,GAAG,CAAC,CAAC,4BAA4B,CAAC;YAC5C;YACA,OAAO;QACT,EAAE,OAAOI,OAAO;YACdL,QAAQK,KAAK,CAAC,CAAC,mBAAmB,EAAEA,MAAME,OAAO,EAAE;YACnD,OAAO;QACT;IACF;IAIA,MAAMS,iBAAiB;QACrB,IAAI;YACF,MAAM,EAAEqC,MAAM,EAAE,GAAG,MAAMlE,UAAU;YACnC,OAAO;gBAAEgC,OAAOkC,OAAOC,IAAI,OAAO;YAAG;QACvC,EAAE,OAAM;YACN,OAAO;gBAAEnC,OAAO;YAAM;QACxB;IACF;IAEA,MAAMK,gBAAgBF,GAAG,EAAE;QACzB,IAAI;YACF,MAAMnC,UAAU,CAAC,MAAM,EAAEmC,KAAK;YAC9B,OAAO;QACT,EAAE,OAAM;YACN,OAAO;QACT;IACF;IAEA,MAAMY,eAAe;QACnB,IAAI;YACF,MAAM,EAAEmB,MAAM,EAAE,GAAG,MAAMlE,UAAU;YACnC,MAAMoE,YAAYF,OAAOG,WAAW,GAAGd,QAAQ,CAAC;YAChD,OAAO;gBACL3C,QAAQ,CAACwD;gBACTnC,OAAOmC,YAAY,MAAM;YAC3B;QACF,EAAE,OAAM;YACN,OAAO;gBAAExD,QAAQ;gBAAOqB,OAAO;YAAI;QACrC;IACF;IAEA,MAAMiB,WAAW;QACf,IAAI;YACF,MAAM,EAAEgB,MAAM,EAAE,GAAG,MAAMlE,UAAU;YACnC,MAAMY,SAASsD,OAAOX,QAAQ,CAAC,WAAWW,OAAOX,QAAQ,CAAC;YAC1D,MAAMe,SAASJ,OAAOX,QAAQ,CAAC,WAAWW,OAAOX,QAAQ,CAAC;YAE1D,IAAI3C,UAAU,CAAC0D,QAAQ;gBACrB,OAAO;oBAAE1D,QAAQ;oBAAMqB,OAAO;gBAAI;YACpC,OAAO,IAAIrB,UAAU0D,QAAQ;gBAC3B,OAAO;oBAAE1D,QAAQ;oBAAOqB,OAAO;gBAAI;YACrC,OAAO;gBACL,OAAO;oBAAErB,QAAQ;oBAAOqB,OAAO;gBAAI;YACrC;QACF,EAAE,OAAM;YACN,OAAO;gBAAErB,QAAQ;gBAAOqB,OAAO;YAAI;QACrC;IACF;IAEA,MAAMmB,UAAU;QACd,IAAI;YACF,MAAM,EAAEc,MAAM,EAAE,GAAG,MAAMlE,UAAU;YACnC,MAAMoE,YAAYF,OAAOG,WAAW,GAAGd,QAAQ,CAAC;YAChD,MAAMgB,cAAcL,OAAOG,WAAW,GAAGd,QAAQ,CAAC;YAElD,IAAI,CAACa,aAAa,CAACG,aAAa;gBAC9B,OAAO;oBAAE3D,QAAQ;oBAAMqB,OAAO;gBAAI;YACpC,OAAO,IAAI,CAACmC,aAAaG,aAAa;gBACpC,OAAO;oBAAE3D,QAAQ;oBAAMqB,OAAO;gBAAI;YACpC,OAAO;gBACL,OAAO;oBAAErB,QAAQ;oBAAOqB,OAAO;gBAAI;YACrC;QACF,EAAE,OAAM;YACN,OAAO;gBAAErB,QAAQ;gBAAOqB,OAAO;YAAI;QACrC;IACF;IAEA,MAAMyB,oBAAoB;QACxB,IAAI;YACF,MAAM,EAAEQ,MAAM,EAAE,GAAG,MAAMlE,UAAU;YACnC,MAAMwE,QAAQN,OAAOM,KAAK,CAAC;YAC3B,MAAMb,aAAaa,QAAQC,WAAWD,KAAK,CAAC,EAAE,IAAI;YAClD,OAAO;gBAAEb;YAAW;QACtB,EAAE,OAAM;YACN,OAAO;gBAAEA,YAAY;YAAE;QACzB;IACF;IAEA,MAAME,qBAAqB;QACzB,IAAI;YAEF,MAAMa,WAAW;gBAAC;gBAAa;gBAAmB;aAAiB;YACnE,KAAK,MAAMC,QAAQD,SAAU;gBAC3B,IAAI;oBACF,MAAM3E,GAAG6E,MAAM,CAACD;oBAChB,OAAO;gBACT,EAAE,OAAM,CAER;YACF;YACA,OAAO;QACT,EAAE,OAAM;YACN,OAAO;QACT;IACF;AACF;AAKA,OAAO,SAASE,mBAAmBC,YAAY,EAAE5E,kBAAkB;IACjE,MAAM6E,kBAAkBD,aAAaE,OAAO;IAC5C,MAAMC,aAAa,IAAIhF,uBAAuBC;IAE9C4E,aAAaE,OAAO,GAAG,eAAeE,SAAS,EAAEC,OAAO;QAEtD,MAAMC,aAAa,MAAMC;QAGzB,MAAM5E,UAAU;YACdkB,oBAAoB,CAACwD,QAAQG,UAAU;YACvCpD,cAAciD,QAAQjD,YAAY,IAAI,EAAE;YACxCW,UAAUsC,QAAQtC,QAAQ,IAAI;YAC9BG,UAAUmC,QAAQjC,QAAQ,KAAK;YAC/BM,kBAAkB2B,QAAQ1B,QAAQ,KAAK;YACvCQ,eAAemB;QACjB;QAGA,OAAO,MAAMH,WAAW5E,uBAAuB,CAC7C,IAAM0E,gBAAgBQ,IAAI,CAAC,IAAI,EAAEL,WAAWC,UAC5C,CAAC,MAAM,EAAExC,KAAK6C,GAAG,IAAI,EACrB,SACA/E;IAEJ;IAEA,OAAOqE;AACT;AAKA,OAAO,SAASW,4BAA4BC,KAAK,EAAExF,kBAAkB;IAEnE,MAAMyF,oBAAoB;QACxB,GAAGD,KAAK;QACRE,QAAQ;QACRC,uBAAuBH,MAAMI,SAAS,IAAI;QAC1C1F,cAAcsF,MAAMjE,QAAQ,KAAK;IACnC;IAGA,OAAO;QACLiE,OAAOC;QACPI,YAAY,OAAOxF;YACjB,MAAML,mBAAmB8F,UAAU,CAAC;YACpCnF,QAAQC,GAAG,CAAC;QACd;QACAmF,aAAa,OAAO1F,QAAQU;YAC1B,MAAMO,eAAe,MAAMtB,mBAAmB6D,UAAU,CACtDxD,QACA,mBACAU;YAGF,IAAI,CAACO,aAAaZ,MAAM,EAAE;gBACxBC,QAAQK,KAAK,CAAC;gBACdgF,QAAQC,IAAI,CAAC;YACf;QACF;IACF;AACF;AAKA,OAAO,SAASC,sBAAsBC,cAAc,EAAEnG,kBAAkB;IAEtEA,mBAAmBoG,cAAc,GAAG,OAAO9E;QAEzC,MAAM+E,eAAe;YACnBC,OAAO;gBACLjG,QAAQiB,aAAajB,MAAM;gBAC3BC,WAAWgB,aAAahB,SAAS;gBACjCC,SAASe,aAAaf,OAAO;YAC/B;YACA4C,QAAQ;gBACNtC,SAASS,aAAaZ,MAAM;gBAC5BqB,OAAOT,aAAaS,KAAK;gBACzBP,QAAQF,aAAaiF,OAAO;YAC9B;QACF;QAGA,MAAMJ,eAAeK,KAAK,CAACH;QAG3B,IAAI/E,aAAahB,SAAS,EAAE;YAC1B,MAAM6F,eAAeM,gBAAgB,CACnCnF,aAAahB,SAAS,EACtBgB,aAAaS,KAAK;QAEtB;IACF;IAEA,OAAO/B;AACT;AAKA,eAAemF;IACb,IAAI;QAEF,MAAM,EAAEnB,MAAM,EAAE,GAAG,MAAMlE,UAAU;QACnC,OAAOkE,OAAOC,IAAI;IACpB,EAAE,OAAM;QACN,OAAO;IACT;AACF;AAKA,OAAO,MAAMyC,oBAAoB;IAC/BC,YAAY,OAAOtG,QAAQE;QAEzBI,QAAQC,GAAG,CAAC,CAAC,6BAA6B,EAAEP,QAAQ;IACtD;IAEAuG,WAAW,OAAOvG,QAAQU,QAAQR;QAEhCI,QAAQC,GAAG,CAAC,CAAC,6BAA6B,EAAEP,QAAQ;IACtD;IAEAwG,WAAW,OAAOxG,QAAQiB;QAExBX,QAAQC,GAAG,CAAC,CAAC,0BAA0B,EAAEP,OAAO,EAAE,EAAEiB,aAAaS,KAAK,EAAE;IAC1E;AACF,EAAE;AAEF,eAAe;IACbhC;IACA4E;IACAY;IACAW;IACAQ;AACF,EAAE"}