{"version":3,"sources":["../../../src/cli/index.ts"],"sourcesContent":["#!/usr/bin/env -S deno run --allow-all\r\n/**\r\n * Claude-Flow CLI entry point\r\n * This redirects to simple-cli.ts for remote execution compatibility\r\n */\r\n\r\n// Import and run the simple CLI which doesn't have external dependencies\r\nimport './simple-cli.ts';\r\n// Spinner import removed - not available in current cliffy version\r\nimport { Command } from './commander-fix.js';\r\nimport chalk from 'chalk';\r\nimport { logger } from '../core/logger.js';\r\nimport { configManager } from '../core/config.js';\r\nimport { startCommand } from './commands/start.js';\r\nimport { agentCommand } from './commands/agent.js';\r\nimport { taskCommand } from './commands/task.js';\r\nimport { memoryCommand } from './commands/memory.js';\r\nimport { configCommand } from './commands/config.js';\r\nimport { statusCommand } from './commands/status.js';\r\nimport { monitorCommand } from './commands/monitor.js';\r\nimport { sessionCommand } from './commands/session.js';\r\nimport { workflowCommand } from './commands/workflow.js';\r\nimport { helpCommand } from './commands/help.js';\r\nimport { mcpCommand } from './commands/mcp.js';\r\nimport { formatError, displayBanner, displayVersion } from './formatter.js';\r\nimport { startREPL } from './repl.js';\r\nimport { CompletionGenerator } from './completion.js';\r\nimport { VERSION, BUILD_DATE } from '../core/version.js';\r\n\r\n// Main CLI command\r\nconst cli = new Command()\r\n  .name('claude-flow')\r\n  .version(VERSION)\r\n  .description('Claude-Flow: Advanced AI agent orchestration system for multi-agent coordination')\r\n  // .meta() commented out - not available\r\n  // .meta() commented out - not available\r\n  .option('-c, --config <path>', 'Path to configuration file', './claude-flow.config.json')\r\n  .option('-v, --verbose', 'Enable verbose logging')\r\n  .option('-q, --quiet', 'Suppress non-essential output')\r\n  .option('--log-level <level>', 'Set log level (debug, info, warn, error)', 'info')\r\n  .option('--no-color', 'Disable colored output')\r\n  .option('--json', 'Output in JSON format where applicable')\r\n  .option('--profile <profile>', 'Use named configuration profile')\r\n  .action(async (options: any) => {\r\n    // If no subcommand, show banner and start REPL\r\n    await setupLogging(options);\r\n\r\n    if (!options.quiet) {\r\n      displayBanner(VERSION);\r\n      console.log(chalk.gray('Type \"help\" for available commands or \"exit\" to quit.\\n'));\r\n    }\r\n\r\n    await startREPL(options);\r\n  });\r\n\r\n// Add subcommands\r\n// NOTE: Temporarily disabled due to Cliffy/Commander compatibility issues\r\n// These commands are created with Cliffy but being added to Commander\r\n// cli\r\n//   .addCommand(startCommand)\r\n//   .addCommand(agentCommand)\r\n//   .addCommand(taskCommand)\r\n//   .addCommand(memoryCommand)\r\n//   .addCommand(configCommand)\r\n//   .addCommand(statusCommand)\r\n//   .addCommand(monitorCommand)\r\n//   .addCommand(sessionCommand)\r\n//   .addCommand(workflowCommand)\r\n//   .addCommand(mcpCommand)\r\n//   .addCommand(helpCommand);\r\n\r\n// Add repl command\r\nconst replCommand = new Command('repl')\r\n  .description('Start interactive REPL mode with command completion')\r\n  .option('--no-banner', 'Skip welcome banner')\r\n  .option('--history-file <path>', 'Custom history file path')\r\n  .action(async (options: any) => {\r\n    await setupLogging(options);\r\n    if (options.banner !== false) {\r\n      displayBanner(VERSION);\r\n    }\r\n    await startREPL(options);\r\n  });\r\ncli.addCommand(replCommand);\r\n\r\n// Add version command\r\nconst versionCommand = new Command('version')\r\n  .description('Show detailed version information')\r\n  .option('--short', 'Show version number only')\r\n  .action(async (options: any) => {\r\n    if (options.short) {\r\n      console.log(VERSION);\r\n    } else {\r\n      displayVersion(VERSION, BUILD_DATE);\r\n    }\r\n  });\r\ncli.addCommand(versionCommand);\r\n\r\n// Add completion command\r\nconst completionCommand = new Command('completion')\r\n  .description('Generate shell completion scripts')\r\n  .argument('[shell]', 'Shell type')\r\n  .option('--install', 'Install completion script automatically')\r\n  .action(async (shell: any, options: any) => {\r\n    const generator = new CompletionGenerator();\r\n    await generator.generate(shell || 'detect', options.install === true);\r\n  });\r\ncli.addCommand(completionCommand);\r\n\r\n// Global error handler\r\nasync function handleError(error: unknown, options?: any): Promise<void> {\r\n  const formatted = formatError(error);\r\n\r\n  if (options?.json) {\r\n    console.error(\r\n      JSON.stringify({\r\n        error: true,\r\n        message: formatted,\r\n        timestamp: new Date().toISOString(),\r\n      }),\r\n    );\r\n  } else {\r\n    console.error(chalk.red(chalk.bold('âœ— Error:')), formatted);\r\n  }\r\n\r\n  // Show stack trace in debug mode or verbose\r\n  if (process.env['CLAUDE_FLOW_DEBUG'] === 'true' || options?.verbose) {\r\n    console.error(chalk.gray('\\nStack trace:'));\r\n    console.error(error);\r\n  }\r\n\r\n  // Suggest helpful actions\r\n  if (!options?.quiet) {\r\n    console.error(chalk.gray('\\nTry running with --verbose for more details'));\r\n    console.error(chalk.gray('Or use \"claude-flow help\" to see available commands'));\r\n  }\r\n\r\n  process.exit(1);\r\n}\r\n\r\n// Setup logging and configuration based on CLI options\r\nasync function setupLogging(options: any): Promise<void> {\r\n  // Determine log level\r\n  let logLevel = options.logLevel;\r\n  if (options.verbose) logLevel = 'debug';\r\n  if (options.quiet) logLevel = 'warn';\r\n\r\n  // Configure logger\r\n  await logger.configure({\r\n    level: logLevel as any,\r\n    format: options.json ? 'json' : 'text',\r\n    destination: 'console',\r\n  });\r\n\r\n  // Load configuration\r\n  try {\r\n    if (options.config) {\r\n      await configManager.load(options.config);\r\n    } else {\r\n      // Try to load default config file if it exists\r\n      try {\r\n        await configManager.load('./claude-flow.config.json');\r\n      } catch {\r\n        // Use default config if no file found\r\n        configManager.loadDefault();\r\n      }\r\n    }\r\n\r\n    // Apply profile if specified\r\n    if (options.profile) {\r\n      await configManager.applyProfile(options.profile);\r\n    }\r\n  } catch (error) {\r\n    logger.warn('Failed to load configuration:', (error as Error).message);\r\n    configManager.loadDefault();\r\n  }\r\n}\r\n\r\n// Signal handlers for graceful shutdown\r\nfunction setupSignalHandlers(): void {\r\n  const gracefulShutdown = () => {\r\n    console.log('\\n' + chalk.gray('Gracefully shutting down...'));\r\n    process.exit(0);\r\n  };\r\n\r\n  Deno.addSignalListener('SIGINT', gracefulShutdown);\r\n  Deno.addSignalListener('SIGTERM', gracefulShutdown);\r\n}\r\n\r\n// Main entry point\r\nif (false) {\r\n  // import.meta.main not available\r\n  let globalOptions: any = {};\r\n\r\n  try {\r\n    // Setup signal handlers\r\n    setupSignalHandlers();\r\n\r\n    // Pre-parse global options for error handling\r\n    const args = Deno.args;\r\n    globalOptions = {\r\n      verbose: args.includes('-v') || args.includes('--verbose'),\r\n      quiet: args.includes('-q') || args.includes('--quiet'),\r\n      json: args.includes('--json'),\r\n      noColor: args.includes('--no-color'),\r\n    };\r\n\r\n    // Configure colors based on options\r\n    if (globalOptions.noColor) {\r\n      // colors.setColorEnabled(false);\r\n    }\r\n\r\n    await cli.parse(args);\r\n  } catch (error) {\r\n    await handleError(error, globalOptions);\r\n  }\r\n}\r\n"],"names":["Command","chalk","logger","configManager","formatError","displayBanner","displayVersion","startREPL","CompletionGenerator","VERSION","BUILD_DATE","cli","name","version","description","option","action","options","setupLogging","quiet","console","log","gray","replCommand","banner","addCommand","versionCommand","short","completionCommand","argument","shell","generator","generate","install","handleError","error","formatted","json","JSON","stringify","message","timestamp","Date","toISOString","red","bold","process","env","verbose","exit","logLevel","configure","level","format","destination","config","load","loadDefault","profile","applyProfile","warn","setupSignalHandlers","gracefulShutdown","Deno","addSignalListener","globalOptions","args","includes","noColor","parse"],"mappings":"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"}