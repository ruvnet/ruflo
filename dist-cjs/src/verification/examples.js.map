{"version":3,"sources":["../../../src/verification/examples.ts"],"sourcesContent":["/**\r\n * Security System Integration Examples\r\n * \r\n * Demonstrates how to integrate the security enforcement system\r\n * with existing Claude Flow components and real-world scenarios.\r\n */\r\n\r\nimport { EventEmitter } from 'events';\r\nimport { SecurityEnforcementSystem, createProductionSecuritySystem, createHighSecuritySystem } from './index';\r\nimport { SecurityMiddlewareManager, ThreatIntelligenceMiddleware, IPFilterMiddleware } from './middleware';\r\nimport { PenetrationTestingSuite, LoadTestingSuite, SecurityValidationSuite } from './tests';\r\nimport { VerificationRequest, VerificationResult } from './security';\r\n\r\n// ======================== BASIC INTEGRATION EXAMPLE ========================\r\n\r\nexport class BasicSecurityIntegration {\r\n  private security: SecurityEnforcementSystem;\r\n  private isInitialized = false;\r\n\r\n  constructor() {\r\n    // Create production-ready security system\r\n    this.security = createProductionSecuritySystem();\r\n    \r\n    // Set up event listeners\r\n    this.setupEventHandlers();\r\n  }\r\n\r\n  async initialize(): Promise<void> {\r\n    if (this.isInitialized) return;\r\n\r\n    // Initialize with trusted participants\r\n    const participants = [\r\n      'claude-verification-node-1',\r\n      'claude-verification-node-2',\r\n      'claude-verification-node-3',\r\n      'claude-verification-node-4',\r\n      'claude-verification-node-5'\r\n    ];\r\n\r\n    await this.security.initialize(participants);\r\n\r\n    // Register initial agents\r\n    await this.registerDefaultAgents();\r\n\r\n    this.isInitialized = true;\r\n    console.log('Security system initialized successfully');\r\n  }\r\n\r\n  private async registerDefaultAgents(): Promise<void> {\r\n    const defaultAgents = [\r\n      { id: 'truth-verifier-1', capabilities: ['verify', 'audit'], level: 'HIGH' as const },\r\n      { id: 'truth-verifier-2', capabilities: ['verify', 'sign'], level: 'HIGH' as const },\r\n      { id: 'consensus-node-1', capabilities: ['verify', 'consensus'], level: 'CRITICAL' as const },\r\n      { id: 'monitoring-agent', capabilities: ['audit', 'monitor'], level: 'MEDIUM' as const }\r\n    ];\r\n\r\n    for (const agent of defaultAgents) {\r\n      try {\r\n        await this.security.registerAgent(agent.id, agent.capabilities, agent.level);\r\n        console.log(`Registered agent: ${agent.id}`);\r\n      } catch (error) {\r\n        console.error(`Failed to register agent ${agent.id}:`, error.message);\r\n      }\r\n    }\r\n  }\r\n\r\n  private setupEventHandlers(): void {\r\n    this.security.on('verificationCompleted', (result: VerificationResult) => {\r\n      console.log(`âœ“ Verification completed: ${result.resultId} (confidence: ${result.confidence})`);\r\n    });\r\n\r\n    this.security.on('verificationError', (event: { request: VerificationRequest; error: string }) => {\r\n      console.error(`âœ— Verification failed: ${event.error}`);\r\n    });\r\n\r\n    this.security.on('agentRegistered', (identity) => {\r\n      console.log(`+ Agent registered: ${identity.agentId} (level: ${identity.securityLevel})`);\r\n    });\r\n\r\n    this.security.on('emergencyShutdown', (event) => {\r\n      console.error(`ðŸš¨ EMERGENCY SHUTDOWN: ${event.reason}`);\r\n    });\r\n  }\r\n\r\n  // Process a truth claim with full security\r\n  async verifyTruthClaim(claim: any, agentId: string): Promise<VerificationResult> {\r\n    const request: VerificationRequest = {\r\n      requestId: `req_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`,\r\n      agentId,\r\n      truthClaim: claim,\r\n      timestamp: new Date(),\r\n      nonce: require('crypto').randomBytes(32).toString('hex'),\r\n      signature: 'placeholder-signature' // In real implementation, this would be properly signed\r\n    };\r\n\r\n    return await this.security.processVerificationRequest(request);\r\n  }\r\n\r\n  // Get system status\r\n  getSecurityStatus() {\r\n    return this.security.getSecurityStatus();\r\n  }\r\n\r\n  // Emergency shutdown\r\n  async shutdown(reason: string): Promise<void> {\r\n    await this.security.emergencyShutdown(reason);\r\n    this.isInitialized = false;\r\n  }\r\n}\r\n\r\n// ======================== ADVANCED INTEGRATION WITH MIDDLEWARE ========================\r\n\r\nexport class AdvancedSecurityIntegration {\r\n  private security: SecurityEnforcementSystem;\r\n  private middlewareManager: SecurityMiddlewareManager;\r\n  private threatIntelligence: ThreatIntelligenceMiddleware;\r\n\r\n  constructor() {\r\n    this.security = createHighSecuritySystem();\r\n    this.middlewareManager = new SecurityMiddlewareManager();\r\n    this.threatIntelligence = new ThreatIntelligenceMiddleware();\r\n    \r\n    this.setupAdvancedSecurity();\r\n  }\r\n\r\n  private setupAdvancedSecurity(): void {\r\n    // Register security middleware\r\n    this.middlewareManager.registerMiddleware(this.threatIntelligence);\r\n    this.middlewareManager.registerMiddleware(new IPFilterMiddleware(\r\n      ['127.0.0.1', '10.0.0.0/8'], // Whitelist\r\n      ['192.168.1.100'] // Blacklist\r\n    ));\r\n\r\n    // Integrate middleware with security system\r\n    this.integrateMiddleware();\r\n  }\r\n\r\n  private integrateMiddleware(): void {\r\n    // Override the security system's verification process to include middleware\r\n    const originalProcess = this.security.processVerificationRequest.bind(this.security);\r\n    \r\n    this.security.processVerificationRequest = async (request: VerificationRequest): Promise<VerificationResult> => {\r\n      // Execute before-verification middleware\r\n      await this.middlewareManager.executeBeforeVerification(request);\r\n      \r\n      try {\r\n        // Process with original security system\r\n        const result = await originalProcess(request);\r\n        \r\n        // Execute after-verification middleware\r\n        await this.middlewareManager.executeAfterVerification(result);\r\n        \r\n        return result;\r\n      } catch (error) {\r\n        // Execute error handling middleware\r\n        await this.middlewareManager.executeErrorHandling(error);\r\n        throw error;\r\n      }\r\n    };\r\n  }\r\n\r\n  async initialize(): Promise<void> {\r\n    await this.security.initialize([\r\n      'secure-node-1', 'secure-node-2', 'secure-node-3',\r\n      'secure-node-4', 'secure-node-5', 'secure-node-6',\r\n      'secure-node-7', 'secure-node-8', 'secure-node-9'\r\n    ]);\r\n\r\n    // Register high-security agents\r\n    await this.security.registerAgent('high-security-verifier', ['verify', 'audit', 'sign'], 'CRITICAL');\r\n    \r\n    console.log('Advanced security system initialized');\r\n  }\r\n\r\n  // Add threat indicator dynamically\r\n  addThreatIndicator(indicator: string): void {\r\n    this.threatIntelligence.addThreatIndicator(indicator);\r\n  }\r\n\r\n  // Process high-security verification\r\n  async processHighSecurityVerification(claim: any, agentId: string): Promise<VerificationResult> {\r\n    const request: VerificationRequest = {\r\n      requestId: `hs_req_${Date.now()}`,\r\n      agentId,\r\n      truthClaim: claim,\r\n      timestamp: new Date(),\r\n      nonce: require('crypto').randomBytes(64).toString('hex'), // Larger nonce for high security\r\n      signature: 'high-security-signature'\r\n    };\r\n\r\n    return await this.security.processVerificationRequest(request);\r\n  }\r\n}\r\n\r\n// ======================== CLAUDE FLOW AGENT INTEGRATION ========================\r\n\r\nexport class ClaudeFlowAgentSecurityWrapper {\r\n  private security: SecurityEnforcementSystem;\r\n  private registeredAgents = new Set<string>();\r\n\r\n  constructor(security: SecurityEnforcementSystem) {\r\n    this.security = security;\r\n  }\r\n\r\n  // Secure agent registration for Claude Flow\r\n  async registerClaudeFlowAgent(agentConfig: {\r\n    agentId: string;\r\n    type: string;\r\n    capabilities: string[];\r\n    securityLevel?: 'LOW' | 'MEDIUM' | 'HIGH' | 'CRITICAL';\r\n  }): Promise<void> {\r\n    const securityLevel = agentConfig.securityLevel || 'MEDIUM';\r\n    const capabilities = [...agentConfig.capabilities, 'verify'];\r\n\r\n    await this.security.registerAgent(agentConfig.agentId, capabilities, securityLevel);\r\n    this.registeredAgents.add(agentConfig.agentId);\r\n    \r\n    console.log(`Claude Flow agent secured: ${agentConfig.agentId} (${agentConfig.type})`);\r\n  }\r\n\r\n  // Secure task execution wrapper\r\n  async executeSecureTask(\r\n    agentId: string,\r\n    task: string,\r\n    truthClaim: any\r\n  ): Promise<{\r\n    taskResult: any;\r\n    verificationResult: VerificationResult;\r\n    securityStatus: 'SECURE' | 'SUSPICIOUS' | 'BLOCKED';\r\n  }> {\r\n    if (!this.registeredAgents.has(agentId)) {\r\n      throw new Error(`Agent ${agentId} not registered for secure operations`);\r\n    }\r\n\r\n    try {\r\n      // Process verification first\r\n      const verificationResult = await this.security.processVerificationRequest({\r\n        requestId: `task_${Date.now()}`,\r\n        agentId,\r\n        truthClaim,\r\n        timestamp: new Date(),\r\n        nonce: require('crypto').randomBytes(32).toString('hex'),\r\n        signature: 'task-signature'\r\n      });\r\n\r\n      // Execute task (placeholder)\r\n      const taskResult = await this.simulateTaskExecution(task);\r\n\r\n      return {\r\n        taskResult,\r\n        verificationResult,\r\n        securityStatus: 'SECURE'\r\n      };\r\n    } catch (error) {\r\n      if (error.message.includes('Byzantine') || error.message.includes('rate limit')) {\r\n        return {\r\n          taskResult: null,\r\n          verificationResult: null as any,\r\n          securityStatus: 'BLOCKED'\r\n        };\r\n      }\r\n      \r\n      return {\r\n        taskResult: null,\r\n        verificationResult: null as any,\r\n        securityStatus: 'SUSPICIOUS'\r\n      };\r\n    }\r\n  }\r\n\r\n  private async simulateTaskExecution(task: string): Promise<any> {\r\n    // Simulate task execution\r\n    await new Promise(resolve => setTimeout(resolve, 100));\r\n    return { task, completed: true, timestamp: new Date() };\r\n  }\r\n\r\n  // Get security metrics for agents\r\n  getAgentSecurityMetrics(): Map<string, any> {\r\n    const status = this.security.getSecurityStatus();\r\n    const agentMetrics = new Map();\r\n\r\n    for (const agentId of this.registeredAgents) {\r\n      agentMetrics.set(agentId, {\r\n        reputation: status.metrics.reputationScores.get(agentId) || 100,\r\n        registered: true,\r\n        securityLevel: 'ACTIVE'\r\n      });\r\n    }\r\n\r\n    return agentMetrics;\r\n  }\r\n}\r\n\r\n// ======================== COMPREHENSIVE SECURITY TESTING EXAMPLE ========================\r\n\r\nexport class SecurityTestingExample {\r\n  private security: SecurityEnforcementSystem;\r\n  private penetrationTester: PenetrationTestingSuite;\r\n  private loadTester: LoadTestingSuite;\r\n  private validator: SecurityValidationSuite;\r\n\r\n  constructor() {\r\n    this.security = createProductionSecuritySystem();\r\n    this.penetrationTester = new PenetrationTestingSuite(this.security);\r\n    this.loadTester = new LoadTestingSuite(this.security);\r\n    this.validator = new SecurityValidationSuite(this.security);\r\n  }\r\n\r\n  async runComprehensiveSecurityTest(): Promise<{\r\n    penetrationTestResults: any;\r\n    loadTestResults: any;\r\n    validationResults: any;\r\n    overallAssessment: {\r\n      securityScore: number;\r\n      riskLevel: 'LOW' | 'MEDIUM' | 'HIGH' | 'CRITICAL';\r\n      recommendations: string[];\r\n    };\r\n  }> {\r\n    console.log('ðŸ”’ Starting comprehensive security testing...');\r\n\r\n    // Initialize security system\r\n    await this.security.initialize(['test-node-1', 'test-node-2', 'test-node-3', 'test-node-4', 'test-node-5']);\r\n\r\n    // Run penetration tests\r\n    console.log('ðŸ” Running penetration tests...');\r\n    const penetrationTestResults = await this.penetrationTester.runFullPenetrationTest();\r\n\r\n    // Run load tests\r\n    console.log('âš¡ Running load tests...');\r\n    const loadTestResults = await this.loadTester.runConcurrentLoadTest(10, 50, 30);\r\n\r\n    // Run validation tests\r\n    console.log('âœ… Running validation tests...');\r\n    const validationResults = await this.validator.validateSecuritySystem();\r\n\r\n    // Generate overall assessment\r\n    const overallAssessment = this.generateOverallAssessment(\r\n      penetrationTestResults,\r\n      loadTestResults,\r\n      validationResults\r\n    );\r\n\r\n    console.log('ðŸ Security testing completed');\r\n\r\n    return {\r\n      penetrationTestResults,\r\n      loadTestResults,\r\n      validationResults,\r\n      overallAssessment\r\n    };\r\n  }\r\n\r\n  private generateOverallAssessment(\r\n    pentestResults: any,\r\n    loadResults: any,\r\n    validationResults: any\r\n  ): {\r\n    securityScore: number;\r\n    riskLevel: 'LOW' | 'MEDIUM' | 'HIGH' | 'CRITICAL';\r\n    recommendations: string[];\r\n  } {\r\n    // Calculate weighted security score\r\n    const pentestScore = pentestResults.securityScore * 0.4;\r\n    const loadScore = (loadResults.successfulRequests / loadResults.totalRequests) * 100 * 0.3;\r\n    const validationScore = validationResults.overallHealth ? 100 : 50;\r\n    const validationWeight = 0.3;\r\n\r\n    const securityScore = Math.round(pentestScore + loadScore + (validationScore * validationWeight));\r\n\r\n    // Determine risk level\r\n    let riskLevel: 'LOW' | 'MEDIUM' | 'HIGH' | 'CRITICAL';\r\n    if (securityScore >= 90) riskLevel = 'LOW';\r\n    else if (securityScore >= 75) riskLevel = 'MEDIUM';\r\n    else if (securityScore >= 60) riskLevel = 'HIGH';\r\n    else riskLevel = 'CRITICAL';\r\n\r\n    // Generate recommendations\r\n    const recommendations: string[] = [\r\n      ...pentestResults.recommendations,\r\n      ...validationResults.recommendations\r\n    ];\r\n\r\n    if (loadResults.failedRequests > loadResults.totalRequests * 0.1) {\r\n      recommendations.push('Improve system resilience under load');\r\n    }\r\n\r\n    return { securityScore, riskLevel, recommendations };\r\n  }\r\n}\r\n\r\n// ======================== REAL-WORLD DEPLOYMENT EXAMPLE ========================\r\n\r\nexport class ProductionDeploymentExample {\r\n  private security: SecurityEnforcementSystem;\r\n  private monitoring: EventEmitter;\r\n  private alerting: EventEmitter;\r\n\r\n  constructor() {\r\n    this.security = createProductionSecuritySystem();\r\n    this.monitoring = new EventEmitter();\r\n    this.alerting = new EventEmitter();\r\n    \r\n    this.setupProductionMonitoring();\r\n  }\r\n\r\n  private setupProductionMonitoring(): void {\r\n    // Security event monitoring\r\n    this.security.on('verificationError', (event) => {\r\n      this.monitoring.emit('securityIncident', {\r\n        type: 'VERIFICATION_FAILURE',\r\n        severity: 'HIGH',\r\n        details: event,\r\n        timestamp: new Date()\r\n      });\r\n    });\r\n\r\n    this.security.on('emergencyShutdown', (event) => {\r\n      this.alerting.emit('criticalAlert', {\r\n        type: 'EMERGENCY_SHUTDOWN',\r\n        message: event.reason,\r\n        timestamp: new Date()\r\n      });\r\n    });\r\n\r\n    // Regular health checks\r\n    setInterval(() => {\r\n      this.performHealthCheck();\r\n    }, 60000); // Every minute\r\n  }\r\n\r\n  async deployToProduction(): Promise<void> {\r\n    console.log('ðŸš€ Deploying security system to production...');\r\n\r\n    // Initialize with production nodes\r\n    const productionNodes = [\r\n      'prod-security-node-us-east-1',\r\n      'prod-security-node-us-west-2',\r\n      'prod-security-node-eu-west-1',\r\n      'prod-security-node-ap-southeast-1',\r\n      'prod-security-node-ap-northeast-1'\r\n    ];\r\n\r\n    await this.security.initialize(productionNodes);\r\n\r\n    // Register production agents\r\n    await this.registerProductionAgents();\r\n\r\n    // Start monitoring\r\n    this.startMonitoring();\r\n\r\n    console.log('âœ… Security system deployed to production');\r\n  }\r\n\r\n  private async registerProductionAgents(): Promise<void> {\r\n    const productionAgents = [\r\n      { id: 'primary-verifier', capabilities: ['verify', 'audit', 'sign'], level: 'CRITICAL' as const },\r\n      { id: 'backup-verifier', capabilities: ['verify', 'audit'], level: 'HIGH' as const },\r\n      { id: 'consensus-coordinator', capabilities: ['consensus', 'audit'], level: 'CRITICAL' as const },\r\n      { id: 'security-monitor', capabilities: ['audit', 'monitor'], level: 'HIGH' as const }\r\n    ];\r\n\r\n    for (const agent of productionAgents) {\r\n      await this.security.registerAgent(agent.id, agent.capabilities, agent.level);\r\n    }\r\n  }\r\n\r\n  private startMonitoring(): void {\r\n    console.log('ðŸ“Š Starting production monitoring...');\r\n    \r\n    // Monitor for security incidents\r\n    this.monitoring.on('securityIncident', (incident) => {\r\n      console.warn(`âš ï¸  Security incident: ${incident.type} - ${incident.details.error}`);\r\n      \r\n      // Could integrate with external monitoring systems here\r\n      // e.g., DataDog, New Relic, Prometheus, etc.\r\n    });\r\n\r\n    // Handle critical alerts\r\n    this.alerting.on('criticalAlert', (alert) => {\r\n      console.error(`ðŸš¨ CRITICAL ALERT: ${alert.type} - ${alert.message}`);\r\n      \r\n      // Could integrate with PagerDuty, Slack, etc.\r\n    });\r\n  }\r\n\r\n  private performHealthCheck(): void {\r\n    const status = this.security.getSecurityStatus();\r\n    \r\n    if (!status.systemHealth.consensusCapable) {\r\n      this.alerting.emit('criticalAlert', {\r\n        type: 'CONSENSUS_FAILURE',\r\n        message: 'System cannot achieve consensus',\r\n        timestamp: new Date()\r\n      });\r\n    }\r\n\r\n    if (status.systemHealth.byzantineNodes > 0) {\r\n      this.monitoring.emit('securityIncident', {\r\n        type: 'BYZANTINE_NODES_DETECTED',\r\n        severity: 'HIGH',\r\n        details: { count: status.systemHealth.byzantineNodes },\r\n        timestamp: new Date()\r\n      });\r\n    }\r\n  }\r\n\r\n  // Graceful shutdown for maintenance\r\n  async gracefulShutdown(): Promise<void> {\r\n    console.log('ðŸ”„ Initiating graceful shutdown...');\r\n    \r\n    // Export final security report\r\n    const report = this.security.exportSecurityReport();\r\n    console.log('ðŸ’¾ Security report exported');\r\n    \r\n    // Shutdown security system\r\n    await this.security.emergencyShutdown('Scheduled maintenance');\r\n    \r\n    console.log('âœ… Graceful shutdown completed');\r\n  }\r\n}\r\n\r\n// Export all examples\r\nexport {\r\n  BasicSecurityIntegration,\r\n  AdvancedSecurityIntegration,\r\n  ClaudeFlowAgentSecurityWrapper,\r\n  SecurityTestingExample,\r\n  ProductionDeploymentExample\r\n};\r\n\r\n// Usage examples as comments:\r\n/*\r\n// Basic usage:\r\nconst basicSecurity = new BasicSecurityIntegration();\r\nawait basicSecurity.initialize();\r\nconst result = await basicSecurity.verifyTruthClaim({ statement: \"Test claim\" }, \"agent-1\");\r\n\r\n// Advanced usage with middleware:\r\nconst advancedSecurity = new AdvancedSecurityIntegration();\r\nawait advancedSecurity.initialize();\r\nadvancedSecurity.addThreatIndicator(\"malicious-pattern-x\");\r\n\r\n// Claude Flow integration:\r\nconst wrapper = new ClaudeFlowAgentSecurityWrapper(securitySystem);\r\nawait wrapper.registerClaudeFlowAgent({\r\n  agentId: \"claude-coder-1\",\r\n  type: \"coder\",\r\n  capabilities: [\"code\", \"review\", \"test\"]\r\n});\r\n\r\n// Comprehensive testing:\r\nconst tester = new SecurityTestingExample();\r\nconst results = await tester.runComprehensiveSecurityTest();\r\nconsole.log(\"Security score:\", results.overallAssessment.securityScore);\r\n\r\n// Production deployment:\r\nconst production = new ProductionDeploymentExample();\r\nawait production.deployToProduction();\r\n*/"],"names":["EventEmitter","createProductionSecuritySystem","createHighSecuritySystem","SecurityMiddlewareManager","ThreatIntelligenceMiddleware","IPFilterMiddleware","PenetrationTestingSuite","LoadTestingSuite","SecurityValidationSuite","BasicSecurityIntegration","security","isInitialized","setupEventHandlers","initialize","participants","registerDefaultAgents","console","log","defaultAgents","id","capabilities","level","agent","registerAgent","error","message","on","result","resultId","confidence","event","identity","agentId","securityLevel","reason","verifyTruthClaim","claim","request","requestId","Date","now","Math","random","toString","substr","truthClaim","timestamp","nonce","require","randomBytes","signature","processVerificationRequest","getSecurityStatus","shutdown","emergencyShutdown","AdvancedSecurityIntegration","middlewareManager","threatIntelligence","setupAdvancedSecurity","registerMiddleware","integrateMiddleware","originalProcess","bind","executeBeforeVerification","executeAfterVerification","executeErrorHandling","addThreatIndicator","indicator","processHighSecurityVerification","ClaudeFlowAgentSecurityWrapper","registeredAgents","Set","registerClaudeFlowAgent","agentConfig","add","type","executeSecureTask","task","has","Error","verificationResult","taskResult","simulateTaskExecution","securityStatus","includes","Promise","resolve","setTimeout","completed","getAgentSecurityMetrics","status","agentMetrics","Map","set","reputation","metrics","reputationScores","get","registered","SecurityTestingExample","penetrationTester","loadTester","validator","runComprehensiveSecurityTest","penetrationTestResults","runFullPenetrationTest","loadTestResults","runConcurrentLoadTest","validationResults","validateSecuritySystem","overallAssessment","generateOverallAssessment","pentestResults","loadResults","pentestScore","securityScore","loadScore","successfulRequests","totalRequests","validationScore","overallHealth","validationWeight","round","riskLevel","recommendations","failedRequests","push","ProductionDeploymentExample","monitoring","alerting","setupProductionMonitoring","emit","severity","details","setInterval","performHealthCheck","deployToProduction","productionNodes","registerProductionAgents","startMonitoring","productionAgents","incident","warn","alert","systemHealth","consensusCapable","byzantineNodes","count","gracefulShutdown","report","exportSecurityReport"],"mappings":"AAOA,SAASA,YAAY,QAAQ,SAAS;AACtC,SAAoCC,8BAA8B,EAAEC,wBAAwB,QAAQ,UAAU;AAC9G,SAASC,yBAAyB,EAAEC,4BAA4B,EAAEC,kBAAkB,QAAQ,eAAe;AAC3G,SAASC,uBAAuB,EAAEC,gBAAgB,EAAEC,uBAAuB,QAAQ,UAAU;AAK7F,OAAO,MAAMC;IACHC,SAAoC;IACpCC,gBAAgB,MAAM;IAE9B,aAAc;QAEZ,IAAI,CAACD,QAAQ,GAAGT;QAGhB,IAAI,CAACW,kBAAkB;IACzB;IAEA,MAAMC,aAA4B;QAChC,IAAI,IAAI,CAACF,aAAa,EAAE;QAGxB,MAAMG,eAAe;YACnB;YACA;YACA;YACA;YACA;SACD;QAED,MAAM,IAAI,CAACJ,QAAQ,CAACG,UAAU,CAACC;QAG/B,MAAM,IAAI,CAACC,qBAAqB;QAEhC,IAAI,CAACJ,aAAa,GAAG;QACrBK,QAAQC,GAAG,CAAC;IACd;IAEA,MAAcF,wBAAuC;QACnD,MAAMG,gBAAgB;YACpB;gBAAEC,IAAI;gBAAoBC,cAAc;oBAAC;oBAAU;iBAAQ;gBAAEC,OAAO;YAAgB;YACpF;gBAAEF,IAAI;gBAAoBC,cAAc;oBAAC;oBAAU;iBAAO;gBAAEC,OAAO;YAAgB;YACnF;gBAAEF,IAAI;gBAAoBC,cAAc;oBAAC;oBAAU;iBAAY;gBAAEC,OAAO;YAAoB;YAC5F;gBAAEF,IAAI;gBAAoBC,cAAc;oBAAC;oBAAS;iBAAU;gBAAEC,OAAO;YAAkB;SACxF;QAED,KAAK,MAAMC,SAASJ,cAAe;YACjC,IAAI;gBACF,MAAM,IAAI,CAACR,QAAQ,CAACa,aAAa,CAACD,MAAMH,EAAE,EAAEG,MAAMF,YAAY,EAAEE,MAAMD,KAAK;gBAC3EL,QAAQC,GAAG,CAAC,CAAC,kBAAkB,EAAEK,MAAMH,EAAE,EAAE;YAC7C,EAAE,OAAOK,OAAO;gBACdR,QAAQQ,KAAK,CAAC,CAAC,yBAAyB,EAAEF,MAAMH,EAAE,CAAC,CAAC,CAAC,EAAEK,MAAMC,OAAO;YACtE;QACF;IACF;IAEQb,qBAA2B;QACjC,IAAI,CAACF,QAAQ,CAACgB,EAAE,CAAC,yBAAyB,CAACC;YACzCX,QAAQC,GAAG,CAAC,CAAC,0BAA0B,EAAEU,OAAOC,QAAQ,CAAC,cAAc,EAAED,OAAOE,UAAU,CAAC,CAAC,CAAC;QAC/F;QAEA,IAAI,CAACnB,QAAQ,CAACgB,EAAE,CAAC,qBAAqB,CAACI;YACrCd,QAAQQ,KAAK,CAAC,CAAC,uBAAuB,EAAEM,MAAMN,KAAK,EAAE;QACvD;QAEA,IAAI,CAACd,QAAQ,CAACgB,EAAE,CAAC,mBAAmB,CAACK;YACnCf,QAAQC,GAAG,CAAC,CAAC,oBAAoB,EAAEc,SAASC,OAAO,CAAC,SAAS,EAAED,SAASE,aAAa,CAAC,CAAC,CAAC;QAC1F;QAEA,IAAI,CAACvB,QAAQ,CAACgB,EAAE,CAAC,qBAAqB,CAACI;YACrCd,QAAQQ,KAAK,CAAC,CAAC,uBAAuB,EAAEM,MAAMI,MAAM,EAAE;QACxD;IACF;IAGA,MAAMC,iBAAiBC,KAAU,EAAEJ,OAAe,EAA+B;QAC/E,MAAMK,UAA+B;YACnCC,WAAW,CAAC,IAAI,EAAEC,KAAKC,GAAG,GAAG,CAAC,EAAEC,KAAKC,MAAM,GAAGC,QAAQ,CAAC,IAAIC,MAAM,CAAC,GAAG,IAAI;YACzEZ;YACAa,YAAYT;YACZU,WAAW,IAAIP;YACfQ,OAAOC,QAAQ,UAAUC,WAAW,CAAC,IAAIN,QAAQ,CAAC;YAClDO,WAAW;QACb;QAEA,OAAO,MAAM,IAAI,CAACxC,QAAQ,CAACyC,0BAA0B,CAACd;IACxD;IAGAe,oBAAoB;QAClB,OAAO,IAAI,CAAC1C,QAAQ,CAAC0C,iBAAiB;IACxC;IAGA,MAAMC,SAASnB,MAAc,EAAiB;QAC5C,MAAM,IAAI,CAACxB,QAAQ,CAAC4C,iBAAiB,CAACpB;QACtC,IAAI,CAACvB,aAAa,GAAG;IACvB;AACF;AAIA,OAAO,MAAM4C;IACH7C,SAAoC;IACpC8C,kBAA6C;IAC7CC,mBAAiD;IAEzD,aAAc;QACZ,IAAI,CAAC/C,QAAQ,GAAGR;QAChB,IAAI,CAACsD,iBAAiB,GAAG,IAAIrD;QAC7B,IAAI,CAACsD,kBAAkB,GAAG,IAAIrD;QAE9B,IAAI,CAACsD,qBAAqB;IAC5B;IAEQA,wBAA8B;QAEpC,IAAI,CAACF,iBAAiB,CAACG,kBAAkB,CAAC,IAAI,CAACF,kBAAkB;QACjE,IAAI,CAACD,iBAAiB,CAACG,kBAAkB,CAAC,IAAItD,mBAC5C;YAAC;YAAa;SAAa,EAC3B;YAAC;SAAgB;QAInB,IAAI,CAACuD,mBAAmB;IAC1B;IAEQA,sBAA4B;QAElC,MAAMC,kBAAkB,IAAI,CAACnD,QAAQ,CAACyC,0BAA0B,CAACW,IAAI,CAAC,IAAI,CAACpD,QAAQ;QAEnF,IAAI,CAACA,QAAQ,CAACyC,0BAA0B,GAAG,OAAOd;YAEhD,MAAM,IAAI,CAACmB,iBAAiB,CAACO,yBAAyB,CAAC1B;YAEvD,IAAI;gBAEF,MAAMV,SAAS,MAAMkC,gBAAgBxB;gBAGrC,MAAM,IAAI,CAACmB,iBAAiB,CAACQ,wBAAwB,CAACrC;gBAEtD,OAAOA;YACT,EAAE,OAAOH,OAAO;gBAEd,MAAM,IAAI,CAACgC,iBAAiB,CAACS,oBAAoB,CAACzC;gBAClD,MAAMA;YACR;QACF;IACF;IAEA,MAAMX,aAA4B;QAChC,MAAM,IAAI,CAACH,QAAQ,CAACG,UAAU,CAAC;YAC7B;YAAiB;YAAiB;YAClC;YAAiB;YAAiB;YAClC;YAAiB;YAAiB;SACnC;QAGD,MAAM,IAAI,CAACH,QAAQ,CAACa,aAAa,CAAC,0BAA0B;YAAC;YAAU;YAAS;SAAO,EAAE;QAEzFP,QAAQC,GAAG,CAAC;IACd;IAGAiD,mBAAmBC,SAAiB,EAAQ;QAC1C,IAAI,CAACV,kBAAkB,CAACS,kBAAkB,CAACC;IAC7C;IAGA,MAAMC,gCAAgChC,KAAU,EAAEJ,OAAe,EAA+B;QAC9F,MAAMK,UAA+B;YACnCC,WAAW,CAAC,OAAO,EAAEC,KAAKC,GAAG,IAAI;YACjCR;YACAa,YAAYT;YACZU,WAAW,IAAIP;YACfQ,OAAOC,QAAQ,UAAUC,WAAW,CAAC,IAAIN,QAAQ,CAAC;YAClDO,WAAW;QACb;QAEA,OAAO,MAAM,IAAI,CAACxC,QAAQ,CAACyC,0BAA0B,CAACd;IACxD;AACF;AAIA,OAAO,MAAMgC;IACH3D,SAAoC;IACpC4D,mBAAmB,IAAIC,MAAc;IAE7C,YAAY7D,QAAmC,CAAE;QAC/C,IAAI,CAACA,QAAQ,GAAGA;IAClB;IAGA,MAAM8D,wBAAwBC,WAK7B,EAAiB;QAChB,MAAMxC,gBAAgBwC,YAAYxC,aAAa,IAAI;QACnD,MAAMb,eAAe;eAAIqD,YAAYrD,YAAY;YAAE;SAAS;QAE5D,MAAM,IAAI,CAACV,QAAQ,CAACa,aAAa,CAACkD,YAAYzC,OAAO,EAAEZ,cAAca;QACrE,IAAI,CAACqC,gBAAgB,CAACI,GAAG,CAACD,YAAYzC,OAAO;QAE7ChB,QAAQC,GAAG,CAAC,CAAC,2BAA2B,EAAEwD,YAAYzC,OAAO,CAAC,EAAE,EAAEyC,YAAYE,IAAI,CAAC,CAAC,CAAC;IACvF;IAGA,MAAMC,kBACJ5C,OAAe,EACf6C,IAAY,EACZhC,UAAe,EAKd;QACD,IAAI,CAAC,IAAI,CAACyB,gBAAgB,CAACQ,GAAG,CAAC9C,UAAU;YACvC,MAAM,IAAI+C,MAAM,CAAC,MAAM,EAAE/C,QAAQ,qCAAqC,CAAC;QACzE;QAEA,IAAI;YAEF,MAAMgD,qBAAqB,MAAM,IAAI,CAACtE,QAAQ,CAACyC,0BAA0B,CAAC;gBACxEb,WAAW,CAAC,KAAK,EAAEC,KAAKC,GAAG,IAAI;gBAC/BR;gBACAa;gBACAC,WAAW,IAAIP;gBACfQ,OAAOC,QAAQ,UAAUC,WAAW,CAAC,IAAIN,QAAQ,CAAC;gBAClDO,WAAW;YACb;YAGA,MAAM+B,aAAa,MAAM,IAAI,CAACC,qBAAqB,CAACL;YAEpD,OAAO;gBACLI;gBACAD;gBACAG,gBAAgB;YAClB;QACF,EAAE,OAAO3D,OAAO;YACd,IAAIA,MAAMC,OAAO,CAAC2D,QAAQ,CAAC,gBAAgB5D,MAAMC,OAAO,CAAC2D,QAAQ,CAAC,eAAe;gBAC/E,OAAO;oBACLH,YAAY;oBACZD,oBAAoB;oBACpBG,gBAAgB;gBAClB;YACF;YAEA,OAAO;gBACLF,YAAY;gBACZD,oBAAoB;gBACpBG,gBAAgB;YAClB;QACF;IACF;IAEA,MAAcD,sBAAsBL,IAAY,EAAgB;QAE9D,MAAM,IAAIQ,QAAQC,CAAAA,UAAWC,WAAWD,SAAS;QACjD,OAAO;YAAET;YAAMW,WAAW;YAAM1C,WAAW,IAAIP;QAAO;IACxD;IAGAkD,0BAA4C;QAC1C,MAAMC,SAAS,IAAI,CAAChF,QAAQ,CAAC0C,iBAAiB;QAC9C,MAAMuC,eAAe,IAAIC;QAEzB,KAAK,MAAM5D,WAAW,IAAI,CAACsC,gBAAgB,CAAE;YAC3CqB,aAAaE,GAAG,CAAC7D,SAAS;gBACxB8D,YAAYJ,OAAOK,OAAO,CAACC,gBAAgB,CAACC,GAAG,CAACjE,YAAY;gBAC5DkE,YAAY;gBACZjE,eAAe;YACjB;QACF;QAEA,OAAO0D;IACT;AACF;AAIA,OAAO,MAAMQ;IACHzF,SAAoC;IACpC0F,kBAA2C;IAC3CC,WAA6B;IAC7BC,UAAmC;IAE3C,aAAc;QACZ,IAAI,CAAC5F,QAAQ,GAAGT;QAChB,IAAI,CAACmG,iBAAiB,GAAG,IAAI9F,wBAAwB,IAAI,CAACI,QAAQ;QAClE,IAAI,CAAC2F,UAAU,GAAG,IAAI9F,iBAAiB,IAAI,CAACG,QAAQ;QACpD,IAAI,CAAC4F,SAAS,GAAG,IAAI9F,wBAAwB,IAAI,CAACE,QAAQ;IAC5D;IAEA,MAAM6F,+BASH;QACDvF,QAAQC,GAAG,CAAC;QAGZ,MAAM,IAAI,CAACP,QAAQ,CAACG,UAAU,CAAC;YAAC;YAAe;YAAe;YAAe;YAAe;SAAc;QAG1GG,QAAQC,GAAG,CAAC;QACZ,MAAMuF,yBAAyB,MAAM,IAAI,CAACJ,iBAAiB,CAACK,sBAAsB;QAGlFzF,QAAQC,GAAG,CAAC;QACZ,MAAMyF,kBAAkB,MAAM,IAAI,CAACL,UAAU,CAACM,qBAAqB,CAAC,IAAI,IAAI;QAG5E3F,QAAQC,GAAG,CAAC;QACZ,MAAM2F,oBAAoB,MAAM,IAAI,CAACN,SAAS,CAACO,sBAAsB;QAGrE,MAAMC,oBAAoB,IAAI,CAACC,yBAAyB,CACtDP,wBACAE,iBACAE;QAGF5F,QAAQC,GAAG,CAAC;QAEZ,OAAO;YACLuF;YACAE;YACAE;YACAE;QACF;IACF;IAEQC,0BACNC,cAAmB,EACnBC,WAAgB,EAChBL,iBAAsB,EAKtB;QAEA,MAAMM,eAAeF,eAAeG,aAAa,GAAG;QACpD,MAAMC,YAAY,AAACH,YAAYI,kBAAkB,GAAGJ,YAAYK,aAAa,GAAI,MAAM;QACvF,MAAMC,kBAAkBX,kBAAkBY,aAAa,GAAG,MAAM;QAChE,MAAMC,mBAAmB;QAEzB,MAAMN,gBAAgB1E,KAAKiF,KAAK,CAACR,eAAeE,YAAaG,kBAAkBE;QAG/E,IAAIE;QACJ,IAAIR,iBAAiB,IAAIQ,YAAY;aAChC,IAAIR,iBAAiB,IAAIQ,YAAY;aACrC,IAAIR,iBAAiB,IAAIQ,YAAY;aACrCA,YAAY;QAGjB,MAAMC,kBAA4B;eAC7BZ,eAAeY,eAAe;eAC9BhB,kBAAkBgB,eAAe;SACrC;QAED,IAAIX,YAAYY,cAAc,GAAGZ,YAAYK,aAAa,GAAG,KAAK;YAChEM,gBAAgBE,IAAI,CAAC;QACvB;QAEA,OAAO;YAAEX;YAAeQ;YAAWC;QAAgB;IACrD;AACF;AAIA,OAAO,MAAMG;IACHrH,SAAoC;IACpCsH,WAAyB;IACzBC,SAAuB;IAE/B,aAAc;QACZ,IAAI,CAACvH,QAAQ,GAAGT;QAChB,IAAI,CAAC+H,UAAU,GAAG,IAAIhI;QACtB,IAAI,CAACiI,QAAQ,GAAG,IAAIjI;QAEpB,IAAI,CAACkI,yBAAyB;IAChC;IAEQA,4BAAkC;QAExC,IAAI,CAACxH,QAAQ,CAACgB,EAAE,CAAC,qBAAqB,CAACI;YACrC,IAAI,CAACkG,UAAU,CAACG,IAAI,CAAC,oBAAoB;gBACvCxD,MAAM;gBACNyD,UAAU;gBACVC,SAASvG;gBACTgB,WAAW,IAAIP;YACjB;QACF;QAEA,IAAI,CAAC7B,QAAQ,CAACgB,EAAE,CAAC,qBAAqB,CAACI;YACrC,IAAI,CAACmG,QAAQ,CAACE,IAAI,CAAC,iBAAiB;gBAClCxD,MAAM;gBACNlD,SAASK,MAAMI,MAAM;gBACrBY,WAAW,IAAIP;YACjB;QACF;QAGA+F,YAAY;YACV,IAAI,CAACC,kBAAkB;QACzB,GAAG;IACL;IAEA,MAAMC,qBAAoC;QACxCxH,QAAQC,GAAG,CAAC;QAGZ,MAAMwH,kBAAkB;YACtB;YACA;YACA;YACA;YACA;SACD;QAED,MAAM,IAAI,CAAC/H,QAAQ,CAACG,UAAU,CAAC4H;QAG/B,MAAM,IAAI,CAACC,wBAAwB;QAGnC,IAAI,CAACC,eAAe;QAEpB3H,QAAQC,GAAG,CAAC;IACd;IAEA,MAAcyH,2BAA0C;QACtD,MAAME,mBAAmB;YACvB;gBAAEzH,IAAI;gBAAoBC,cAAc;oBAAC;oBAAU;oBAAS;iBAAO;gBAAEC,OAAO;YAAoB;YAChG;gBAAEF,IAAI;gBAAmBC,cAAc;oBAAC;oBAAU;iBAAQ;gBAAEC,OAAO;YAAgB;YACnF;gBAAEF,IAAI;gBAAyBC,cAAc;oBAAC;oBAAa;iBAAQ;gBAAEC,OAAO;YAAoB;YAChG;gBAAEF,IAAI;gBAAoBC,cAAc;oBAAC;oBAAS;iBAAU;gBAAEC,OAAO;YAAgB;SACtF;QAED,KAAK,MAAMC,SAASsH,iBAAkB;YACpC,MAAM,IAAI,CAAClI,QAAQ,CAACa,aAAa,CAACD,MAAMH,EAAE,EAAEG,MAAMF,YAAY,EAAEE,MAAMD,KAAK;QAC7E;IACF;IAEQsH,kBAAwB;QAC9B3H,QAAQC,GAAG,CAAC;QAGZ,IAAI,CAAC+G,UAAU,CAACtG,EAAE,CAAC,oBAAoB,CAACmH;YACtC7H,QAAQ8H,IAAI,CAAC,CAAC,uBAAuB,EAAED,SAASlE,IAAI,CAAC,GAAG,EAAEkE,SAASR,OAAO,CAAC7G,KAAK,EAAE;QAIpF;QAGA,IAAI,CAACyG,QAAQ,CAACvG,EAAE,CAAC,iBAAiB,CAACqH;YACjC/H,QAAQQ,KAAK,CAAC,CAAC,mBAAmB,EAAEuH,MAAMpE,IAAI,CAAC,GAAG,EAAEoE,MAAMtH,OAAO,EAAE;QAGrE;IACF;IAEQ8G,qBAA2B;QACjC,MAAM7C,SAAS,IAAI,CAAChF,QAAQ,CAAC0C,iBAAiB;QAE9C,IAAI,CAACsC,OAAOsD,YAAY,CAACC,gBAAgB,EAAE;YACzC,IAAI,CAAChB,QAAQ,CAACE,IAAI,CAAC,iBAAiB;gBAClCxD,MAAM;gBACNlD,SAAS;gBACTqB,WAAW,IAAIP;YACjB;QACF;QAEA,IAAImD,OAAOsD,YAAY,CAACE,cAAc,GAAG,GAAG;YAC1C,IAAI,CAAClB,UAAU,CAACG,IAAI,CAAC,oBAAoB;gBACvCxD,MAAM;gBACNyD,UAAU;gBACVC,SAAS;oBAAEc,OAAOzD,OAAOsD,YAAY,CAACE,cAAc;gBAAC;gBACrDpG,WAAW,IAAIP;YACjB;QACF;IACF;IAGA,MAAM6G,mBAAkC;QACtCpI,QAAQC,GAAG,CAAC;QAGZ,MAAMoI,SAAS,IAAI,CAAC3I,QAAQ,CAAC4I,oBAAoB;QACjDtI,QAAQC,GAAG,CAAC;QAGZ,MAAM,IAAI,CAACP,QAAQ,CAAC4C,iBAAiB,CAAC;QAEtCtC,QAAQC,GAAG,CAAC;IACd;AACF;AAGA,SACER,wBAAwB,EACxB8C,2BAA2B,EAC3Bc,8BAA8B,EAC9B8B,sBAAsB,EACtB4B,2BAA2B,GAC3B"}