{"version":3,"sources":["../../../../src/cli/commands/mcp.ts"],"sourcesContent":["/**\r\n * MCP command for Claude-Flow\r\n */\r\n\r\nimport { Command } from '@cliffy/command';\r\nimport chalk from 'chalk';\r\nimport { logger } from '../../core/logger.js';\r\nimport { configManager } from '../../core/config.js';\r\nimport { MCPServer, type IMCPServer } from '../../mcp/server.js';\r\nimport { eventBus } from '../../core/event-bus.js';\r\nimport {\r\n  createMCPServer,\r\n  isMCP2025Available,\r\n  getServerCapabilities,\r\n  type ExtendedMCPConfig,\r\n} from '../../mcp/server-factory.js';\r\nimport type { MCP2025Server } from '../../mcp/server-mcp-2025.js';\r\n\r\nlet mcpServer: IMCPServer | MCP2025Server | null = null;\r\n\r\nexport const mcpCommand = new Command()\r\n  .description('Manage MCP server and tools')\r\n  .action(() => {\r\n    console.log(chalk.yellow('Please specify a subcommand:'));\r\n    console.log('  start   - Start the MCP server');\r\n    console.log('  stop    - Stop the MCP server');\r\n    console.log('  status  - Show MCP server status');\r\n    console.log('  tools   - List available MCP tools');\r\n    console.log('  config  - Show MCP configuration');\r\n    console.log('  restart - Restart the MCP server');\r\n    console.log('  logs    - Show MCP server logs');\r\n  })\r\n  .command(\r\n    'start',\r\n    new Command()\r\n      .description('Start the MCP server')\r\n      .option('-p, --port <port:number>', 'Port for MCP server', { default: 3000 })\r\n      .option('-h, --host <host:string>', 'Host for MCP server', { default: 'localhost' })\r\n      .option('--transport <transport:string>', 'Transport type (stdio, http)', {\r\n        default: 'stdio',\r\n      })\r\n      .option('--mcp2025', 'Enable MCP 2025-11 features (version negotiation, async jobs, etc.)', {\r\n        default: false,\r\n      })\r\n      .option('--no-legacy', 'Disable legacy client support', { default: false })\r\n      .action(async (options: any) => {\r\n        try {\r\n          const config = await configManager.load();\r\n\r\n          // Check if MCP 2025-11 dependencies are available\r\n          const mcp2025Available = isMCP2025Available();\r\n          const enableMCP2025 = options.mcp2025 && mcp2025Available;\r\n\r\n          if (options.mcp2025 && !mcp2025Available) {\r\n            console.log(\r\n              chalk.yellow(\r\n                '‚ö†Ô∏è  MCP 2025-11 dependencies not found. Install with: npm install uuid ajv ajv-formats ajv-errors'\r\n              )\r\n            );\r\n            console.log(chalk.yellow('   Falling back to legacy MCP server...'));\r\n          }\r\n\r\n          // Build extended configuration\r\n          const mcpConfig: ExtendedMCPConfig = {\r\n            ...config.mcp,\r\n            port: options.port,\r\n            host: options.host,\r\n            transport: options.transport,\r\n            features: {\r\n              enableMCP2025,\r\n              supportLegacyClients: options.legacy !== false,\r\n              enableVersionNegotiation: enableMCP2025,\r\n              enableAsyncJobs: enableMCP2025,\r\n              enableRegistryIntegration: false, // Opt-in via env var\r\n              enableSchemaValidation: enableMCP2025,\r\n              enableProgressiveDisclosure: true, // Phase 1 feature (always enabled)\r\n            },\r\n            mcp2025: enableMCP2025\r\n              ? {\r\n                  async: {\r\n                    enabled: true,\r\n                    maxJobs: 100,\r\n                    jobTTL: 3600000,\r\n                  },\r\n                  registry: {\r\n                    enabled: process.env.MCP_REGISTRY_ENABLED === 'true',\r\n                    url: process.env.MCP_REGISTRY_URL,\r\n                    apiKey: process.env.MCP_REGISTRY_API_KEY,\r\n                  },\r\n                  validation: {\r\n                    enabled: true,\r\n                    strictMode: false,\r\n                  },\r\n                }\r\n              : undefined,\r\n          };\r\n\r\n          // Create server using factory\r\n          mcpServer = await createMCPServer(mcpConfig, eventBus, logger, {\r\n            autoDetectFeatures: false, // Use explicit config\r\n          });\r\n\r\n          await mcpServer.start();\r\n\r\n          // Get capabilities\r\n          const capabilities = getServerCapabilities(mcpConfig);\r\n\r\n          console.log(chalk.green(`‚úÖ MCP server started on ${options.host}:${options.port}`));\r\n          console.log(\r\n            chalk.cyan(`üéØ Mode: ${enableMCP2025 ? 'MCP 2025-11 Enhanced' : 'Legacy Compatible'}`)\r\n          );\r\n          console.log(chalk.cyan(`üì° Transport: ${options.transport}`));\r\n\r\n          if (capabilities.length > 0) {\r\n            console.log(chalk.cyan(`‚ú® Capabilities: ${capabilities.join(', ')}`));\r\n          }\r\n\r\n          if (enableMCP2025) {\r\n            console.log(chalk.green('   ‚Ä¢ Version negotiation (YYYY-MM format)'));\r\n            console.log(chalk.green('   ‚Ä¢ Async job support (poll/resume)'));\r\n            console.log(chalk.green('   ‚Ä¢ JSON Schema 1.1 validation'));\r\n            console.log(chalk.green('   ‚Ä¢ Progressive disclosure (98.7% token reduction)'));\r\n          }\r\n\r\n          if (options.transport === 'http') {\r\n            console.log(chalk.cyan(`üìö Server URL: http://${options.host}:${options.port}`));\r\n          }\r\n        } catch (error) {\r\n          console.error(chalk.red(`‚ùå Failed to start MCP server: ${(error as Error).message}`));\r\n          logger.error('MCP server startup failed', { error });\r\n          process.exit(1);\r\n        }\r\n      }),\r\n  )\r\n  .command(\r\n    'stop',\r\n    new Command().description('Stop the MCP server').action(async () => {\r\n      try {\r\n        if (mcpServer) {\r\n          await mcpServer.stop();\r\n          mcpServer = null;\r\n          console.log(chalk.green('‚úÖ MCP server stopped'));\r\n        } else {\r\n          console.log(chalk.yellow('‚ö†Ô∏è  MCP server is not running'));\r\n        }\r\n      } catch (error) {\r\n        console.error(chalk.red(`‚ùå Failed to stop MCP server: ${(error as Error).message}`));\r\n        process.exit(1);\r\n      }\r\n    }),\r\n  )\r\n  .command(\r\n    'status',\r\n    new Command().description('Show MCP server status').action(async () => {\r\n      try {\r\n        const config = await configManager.load();\r\n        const isRunning = mcpServer !== null;\r\n\r\n        console.log(chalk.cyan('MCP Server Status:'));\r\n        console.log(`üåê Status: ${isRunning ? chalk.green('Running') : chalk.red('Stopped')}`);\r\n\r\n        if (isRunning) {\r\n          console.log(`üìç Address: ${config.mcp.host}:${config.mcp.port}`);\r\n          console.log(\r\n            `üîê Authentication: ${config.mcp.auth ? chalk.green('Enabled') : chalk.yellow('Disabled')}`,\r\n          );\r\n          console.log(`üîß Tools: ${chalk.green('Available')}`);\r\n          console.log(`üìä Metrics: ${chalk.green('Collecting')}`);\r\n        } else {\r\n          console.log(chalk.gray('Use \"claude-flow mcp start\" to start the server'));\r\n        }\r\n      } catch (error) {\r\n        console.error(chalk.red(`‚ùå Failed to get MCP status: ${(error as Error).message}`));\r\n      }\r\n    }),\r\n  )\r\n  .command(\r\n    'tools',\r\n    new Command().description('List available MCP tools').action(() => {\r\n      console.log(chalk.cyan('Available MCP Tools:'));\r\n\r\n      console.log('\\nüìä Research Tools:');\r\n      console.log('  ‚Ä¢ web_search - Search the web for information');\r\n      console.log('  ‚Ä¢ web_fetch - Fetch content from URLs');\r\n      console.log('  ‚Ä¢ knowledge_query - Query knowledge base');\r\n\r\n      console.log('\\nüíª Code Tools:');\r\n      console.log('  ‚Ä¢ code_edit - Edit code files');\r\n      console.log('  ‚Ä¢ code_search - Search through codebase');\r\n      console.log('  ‚Ä¢ code_analyze - Analyze code quality');\r\n\r\n      console.log('\\nüñ•Ô∏è  Terminal Tools:');\r\n      console.log('  ‚Ä¢ terminal_execute - Execute shell commands');\r\n      console.log('  ‚Ä¢ terminal_session - Manage terminal sessions');\r\n      console.log('  ‚Ä¢ file_operations - File system operations');\r\n\r\n      console.log('\\nüíæ Memory Tools:');\r\n      console.log('  ‚Ä¢ memory_store - Store information');\r\n      console.log('  ‚Ä¢ memory_query - Query stored information');\r\n      console.log('  ‚Ä¢ memory_index - Index and search content');\r\n    }),\r\n  )\r\n  .command(\r\n    'config',\r\n    new Command().description('Show MCP configuration').action(async () => {\r\n      try {\r\n        const config = await configManager.load();\r\n\r\n        console.log(chalk.cyan('MCP Configuration:'));\r\n        console.log(JSON.stringify(config.mcp, null, 2));\r\n      } catch (error) {\r\n        console.error(chalk.red(`‚ùå Failed to show MCP config: ${(error as Error).message}`));\r\n      }\r\n    }),\r\n  )\r\n  .command(\r\n    'restart',\r\n    new Command().description('Restart the MCP server').action(async () => {\r\n      try {\r\n        console.log(chalk.yellow('üîÑ Stopping MCP server...'));\r\n        if (mcpServer) {\r\n          await mcpServer.stop();\r\n        }\r\n\r\n        console.log(chalk.yellow('üîÑ Starting MCP server...'));\r\n        const config = await configManager.load();\r\n\r\n        // Use factory to create server with same capabilities as before\r\n        mcpServer = await createMCPServer(config.mcp, eventBus, logger, {\r\n          autoDetectFeatures: true, // Auto-detect on restart\r\n        });\r\n        await mcpServer.start();\r\n\r\n        console.log(\r\n          chalk.green(`‚úÖ MCP server restarted on ${config.mcp.host}:${config.mcp.port}`),\r\n        );\r\n      } catch (error) {\r\n        console.error(chalk.red(`‚ùå Failed to restart MCP server: ${(error as Error).message}`));\r\n        process.exit(1);\r\n      }\r\n    }),\r\n  )\r\n  .command(\r\n    'logs',\r\n    new Command()\r\n      .description('Show MCP server logs')\r\n      .option('-n, --lines <lines:number>', 'Number of log lines to show', { default: 50 })\r\n      .action((options: any) => {\r\n        console.log(chalk.cyan(`MCP Server Logs (last ${options.lines} lines):`));\r\n\r\n        // Mock logs since logging system might not be fully implemented\r\n        const logEntries = [\r\n          '2024-01-10 10:00:00 [INFO] MCP server started on localhost:3000',\r\n          '2024-01-10 10:00:01 [INFO] Tools registered: 12',\r\n          '2024-01-10 10:00:02 [INFO] Authentication disabled',\r\n          '2024-01-10 10:01:00 [INFO] Client connected: claude-desktop',\r\n          '2024-01-10 10:01:05 [INFO] Tool called: web_search',\r\n          '2024-01-10 10:01:10 [INFO] Tool response sent successfully',\r\n          '2024-01-10 10:02:00 [INFO] Tool called: terminal_execute',\r\n          '2024-01-10 10:02:05 [INFO] Command executed successfully',\r\n          '2024-01-10 10:03:00 [INFO] Memory operation: store',\r\n          '2024-01-10 10:03:01 [INFO] Data stored in namespace: default',\r\n        ];\r\n\r\n        const startIndex = Math.max(0, logEntries.length - options.lines);\r\n        const displayLogs = logEntries.slice(startIndex);\r\n\r\n        for (const entry of displayLogs) {\r\n          if (entry.includes('[ERROR]')) {\r\n            console.log(chalk.red(entry));\r\n          } else if (entry.includes('[WARN]')) {\r\n            console.log(chalk.yellow(entry));\r\n          } else if (entry.includes('[INFO]')) {\r\n            console.log(chalk.green(entry));\r\n          } else {\r\n            console.log(chalk.gray(entry));\r\n          }\r\n        }\r\n      }),\r\n  );\r\n"],"names":["Command","chalk","logger","configManager","eventBus","createMCPServer","isMCP2025Available","getServerCapabilities","mcpServer","mcpCommand","description","action","console","log","yellow","command","option","default","options","config","load","mcp2025Available","enableMCP2025","mcp2025","mcpConfig","mcp","port","host","transport","features","supportLegacyClients","legacy","enableVersionNegotiation","enableAsyncJobs","enableRegistryIntegration","enableSchemaValidation","enableProgressiveDisclosure","async","enabled","maxJobs","jobTTL","registry","process","env","MCP_REGISTRY_ENABLED","url","MCP_REGISTRY_URL","apiKey","MCP_REGISTRY_API_KEY","validation","strictMode","undefined","autoDetectFeatures","start","capabilities","green","cyan","length","join","error","red","message","exit","stop","isRunning","auth","gray","JSON","stringify","lines","logEntries","startIndex","Math","max","displayLogs","slice","entry","includes"],"mappings":"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"}