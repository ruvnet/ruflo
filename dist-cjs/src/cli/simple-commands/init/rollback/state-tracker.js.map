{"version":3,"sources":["../../../../../../src/cli/simple-commands/init/rollback/state-tracker.js"],"sourcesContent":["import { promises as fs } from 'fs';\r\n// state-tracker.js - Track initialization state and rollback points\r\n\r\nexport class StateTracker {\r\n  constructor(workingDir) {\r\n    this.workingDir = workingDir;\r\n    this.stateFile = `${workingDir}/.claude-flow-state.json`;\r\n  }\r\n\r\n  /**\r\n   * Record a rollback point\r\n   */\r\n  async recordRollbackPoint(type, data) {\r\n    const result = {\r\n      success: true,\r\n      errors: [],\r\n    };\r\n\r\n    try {\r\n      const state = await this.loadState();\r\n\r\n      const rollbackPoint = {\r\n        id: this.generateId(),\r\n        type,\r\n        timestamp: Date.now(),\r\n        data,\r\n        ...data,\r\n      };\r\n\r\n      state.rollbackPoints = state.rollbackPoints || [];\r\n      state.rollbackPoints.push(rollbackPoint);\r\n\r\n      // Keep only the last 10 rollback points\r\n      if (state.rollbackPoints.length > 10) {\r\n        state.rollbackPoints = state.rollbackPoints.slice(-10);\r\n      }\r\n\r\n      await this.saveState(state);\r\n    } catch (error) {\r\n      result.success = false;\r\n      result.errors.push(`Failed to record rollback point: ${error.message}`);\r\n    }\r\n\r\n    return result;\r\n  }\r\n\r\n  /**\r\n   * Create a checkpoint\r\n   */\r\n  async createCheckpoint(phase, data) {\r\n    const result = {\r\n      success: true,\r\n      id: null,\r\n      errors: [],\r\n    };\r\n\r\n    try {\r\n      const state = await this.loadState();\r\n\r\n      const checkpoint = {\r\n        id: this.generateId(),\r\n        phase,\r\n        timestamp: Date.now(),\r\n        data,\r\n        status: 'active',\r\n      };\r\n\r\n      result.id = checkpoint.id;\r\n\r\n      state.checkpoints = state.checkpoints || [];\r\n      state.checkpoints.push(checkpoint);\r\n\r\n      // Keep only the last 20 checkpoints\r\n      if (state.checkpoints.length > 20) {\r\n        state.checkpoints = state.checkpoints.slice(-20);\r\n      }\r\n\r\n      await this.saveState(state);\r\n    } catch (error) {\r\n      result.success = false;\r\n      result.errors.push(`Failed to create checkpoint: ${error.message}`);\r\n    }\r\n\r\n    return result;\r\n  }\r\n\r\n  /**\r\n   * Update a checkpoint\r\n   */\r\n  async updateCheckpoint(checkpointId, updates) {\r\n    const result = {\r\n      success: true,\r\n      errors: [],\r\n    };\r\n\r\n    try {\r\n      const state = await this.loadState();\r\n\r\n      if (state.checkpoints) {\r\n        const checkpoint = state.checkpoints.find((cp) => cp.id === checkpointId);\r\n        if (checkpoint) {\r\n          Object.assign(checkpoint, updates);\r\n          await this.saveState(state);\r\n        } else {\r\n          result.success = false;\r\n          result.errors.push(`Checkpoint not found: ${checkpointId}`);\r\n        }\r\n      }\r\n    } catch (error) {\r\n      result.success = false;\r\n      result.errors.push(`Failed to update checkpoint: ${error.message}`);\r\n    }\r\n\r\n    return result;\r\n  }\r\n\r\n  /**\r\n   * Record a rollback operation\r\n   */\r\n  async recordRollback(targetId, rollbackType, phase = null) {\r\n    const result = {\r\n      success: true,\r\n      errors: [],\r\n    };\r\n\r\n    try {\r\n      const state = await this.loadState();\r\n\r\n      const rollbackRecord = {\r\n        id: this.generateId(),\r\n        targetId,\r\n        rollbackType,\r\n        phase,\r\n        timestamp: Date.now(),\r\n        status: 'completed',\r\n      };\r\n\r\n      state.rollbackHistory = state.rollbackHistory || [];\r\n      state.rollbackHistory.push(rollbackRecord);\r\n\r\n      // Keep only the last 50 rollback records\r\n      if (state.rollbackHistory.length > 50) {\r\n        state.rollbackHistory = state.rollbackHistory.slice(-50);\r\n      }\r\n\r\n      await this.saveState(state);\r\n    } catch (error) {\r\n      result.success = false;\r\n      result.errors.push(`Failed to record rollback: ${error.message}`);\r\n    }\r\n\r\n    return result;\r\n  }\r\n\r\n  /**\r\n   * Get rollback points\r\n   */\r\n  async getRollbackPoints() {\r\n    try {\r\n      const state = await this.loadState();\r\n      return state.rollbackPoints || [];\r\n    } catch {\r\n      return [];\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get checkpoints\r\n   */\r\n  async getCheckpoints() {\r\n    try {\r\n      const state = await this.loadState();\r\n      return state.checkpoints || [];\r\n    } catch {\r\n      return [];\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get rollback history\r\n   */\r\n  async getRollbackHistory() {\r\n    try {\r\n      const state = await this.loadState();\r\n      return state.rollbackHistory || [];\r\n    } catch {\r\n      return [];\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Track file operation\r\n   */\r\n  async trackFileOperation(operation, filePath, metadata = {}) {\r\n    const result = {\r\n      success: true,\r\n      errors: [],\r\n    };\r\n\r\n    try {\r\n      const state = await this.loadState();\r\n\r\n      const fileOp = {\r\n        id: this.generateId(),\r\n        operation, // 'create', 'modify', 'delete'\r\n        filePath,\r\n        timestamp: Date.now(),\r\n        metadata,\r\n      };\r\n\r\n      state.fileOperations = state.fileOperations || [];\r\n      state.fileOperations.push(fileOp);\r\n\r\n      // Keep only the last 100 file operations\r\n      if (state.fileOperations.length > 100) {\r\n        state.fileOperations = state.fileOperations.slice(-100);\r\n      }\r\n\r\n      await this.saveState(state);\r\n    } catch (error) {\r\n      result.success = false;\r\n      result.errors.push(`Failed to track file operation: ${error.message}`);\r\n    }\r\n\r\n    return result;\r\n  }\r\n\r\n  /**\r\n   * Get current initialization phase\r\n   */\r\n  async getCurrentPhase() {\r\n    try {\r\n      const state = await this.loadState();\r\n      return state.currentPhase || 'not-started';\r\n    } catch {\r\n      return 'not-started';\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Set current initialization phase\r\n   */\r\n  async setCurrentPhase(phase) {\r\n    const result = {\r\n      success: true,\r\n      errors: [],\r\n    };\r\n\r\n    try {\r\n      const state = await this.loadState();\r\n      state.currentPhase = phase;\r\n      state.phaseTimestamp = Date.now();\r\n\r\n      // Track phase transitions\r\n      state.phaseHistory = state.phaseHistory || [];\r\n      state.phaseHistory.push({\r\n        phase,\r\n        timestamp: Date.now(),\r\n      });\r\n\r\n      await this.saveState(state);\r\n    } catch (error) {\r\n      result.success = false;\r\n      result.errors.push(`Failed to set phase: ${error.message}`);\r\n    }\r\n\r\n    return result;\r\n  }\r\n\r\n  /**\r\n   * Get initialization statistics\r\n   */\r\n  async getInitializationStats() {\r\n    try {\r\n      const state = await this.loadState();\r\n\r\n      return {\r\n        rollbackPoints: (state.rollbackPoints || []).length,\r\n        checkpoints: (state.checkpoints || []).length,\r\n        rollbackHistory: (state.rollbackHistory || []).length,\r\n        fileOperations: (state.fileOperations || []).length,\r\n        currentPhase: state.currentPhase || 'not-started',\r\n        lastActivity: state.lastActivity || 0,\r\n        phaseHistory: state.phaseHistory || [],\r\n      };\r\n    } catch {\r\n      return {\r\n        rollbackPoints: 0,\r\n        checkpoints: 0,\r\n        rollbackHistory: 0,\r\n        fileOperations: 0,\r\n        currentPhase: 'not-started',\r\n        lastActivity: 0,\r\n        phaseHistory: [],\r\n      };\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Clean up old state data\r\n   */\r\n  async cleanupOldState(daysToKeep = 7) {\r\n    const result = {\r\n      success: true,\r\n      cleaned: 0,\r\n      errors: [],\r\n    };\r\n\r\n    try {\r\n      const state = await this.loadState();\r\n      const cutoffTime = Date.now() - daysToKeep * 24 * 60 * 60 * 1000;\r\n\r\n      let cleaned = 0;\r\n\r\n      // Clean rollback points\r\n      if (state.rollbackPoints) {\r\n        const before = state.rollbackPoints.length;\r\n        state.rollbackPoints = state.rollbackPoints.filter((rp) => rp.timestamp > cutoffTime);\r\n        cleaned += before - state.rollbackPoints.length;\r\n      }\r\n\r\n      // Clean checkpoints\r\n      if (state.checkpoints) {\r\n        const before = state.checkpoints.length;\r\n        state.checkpoints = state.checkpoints.filter((cp) => cp.timestamp > cutoffTime);\r\n        cleaned += before - state.checkpoints.length;\r\n      }\r\n\r\n      // Clean file operations\r\n      if (state.fileOperations) {\r\n        const before = state.fileOperations.length;\r\n        state.fileOperations = state.fileOperations.filter((fo) => fo.timestamp > cutoffTime);\r\n        cleaned += before - state.fileOperations.length;\r\n      }\r\n\r\n      result.cleaned = cleaned;\r\n\r\n      if (cleaned > 0) {\r\n        await this.saveState(state);\r\n      }\r\n    } catch (error) {\r\n      result.success = false;\r\n      result.errors.push(`State cleanup failed: ${error.message}`);\r\n    }\r\n\r\n    return result;\r\n  }\r\n\r\n  /**\r\n   * Validate state tracking system\r\n   */\r\n  async validateStateTracking() {\r\n    const result = {\r\n      success: true,\r\n      errors: [],\r\n      warnings: [],\r\n    };\r\n\r\n    try {\r\n      // Test state file access\r\n      const state = await this.loadState();\r\n\r\n      // Test write access\r\n      state.lastValidation = Date.now();\r\n      await this.saveState(state);\r\n\r\n      // Validate state structure\r\n      const validationResult = this.validateStateStructure(state);\r\n      if (!validationResult.valid) {\r\n        result.warnings.push(...validationResult.issues);\r\n      }\r\n    } catch (error) {\r\n      result.success = false;\r\n      result.errors.push(`State tracking validation failed: ${error.message}`);\r\n    }\r\n\r\n    return result;\r\n  }\r\n\r\n  /**\r\n   * Export state for backup\r\n   */\r\n  async exportState() {\r\n    try {\r\n      const state = await this.loadState();\r\n      return {\r\n        success: true,\r\n        data: state,\r\n        timestamp: Date.now(),\r\n      };\r\n    } catch (error) {\r\n      return {\r\n        success: false,\r\n        error: error.message,\r\n      };\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Import state from backup\r\n   */\r\n  async importState(stateData) {\r\n    const result = {\r\n      success: true,\r\n      errors: [],\r\n    };\r\n\r\n    try {\r\n      if (this.validateStateStructure(stateData).valid) {\r\n        await this.saveState(stateData);\r\n      } else {\r\n        result.success = false;\r\n        result.errors.push('Invalid state data structure');\r\n      }\r\n    } catch (error) {\r\n      result.success = false;\r\n      result.errors.push(`State import failed: ${error.message}`);\r\n    }\r\n\r\n    return result;\r\n  }\r\n\r\n  // Helper methods\r\n\r\n  async loadState() {\r\n    try {\r\n      const content = await fs.readFile(this.stateFile, 'utf8');\r\n      return JSON.parse(content);\r\n    } catch {\r\n      // Return default state if file doesn't exist or is invalid\r\n      return {\r\n        version: '1.0',\r\n        created: Date.now(),\r\n        lastActivity: Date.now(),\r\n        rollbackPoints: [],\r\n        checkpoints: [],\r\n        rollbackHistory: [],\r\n        fileOperations: [],\r\n        currentPhase: 'not-started',\r\n        phaseHistory: [],\r\n      };\r\n    }\r\n  }\r\n\r\n  async saveState(state) {\r\n    state.lastActivity = Date.now();\r\n    state.version = '1.0';\r\n\r\n    await fs.writeFile(this.stateFile, JSON.stringify(state, null, 2, 'utf8'));\r\n  }\r\n\r\n  generateId() {\r\n    return `${Date.now()}-${Math.random().toString(36).substr(2, 9)}`;\r\n  }\r\n\r\n  validateStateStructure(state) {\r\n    const result = {\r\n      valid: true,\r\n      issues: [],\r\n    };\r\n\r\n    if (!state || typeof state !== 'object') {\r\n      result.valid = false;\r\n      result.issues.push('State must be an object');\r\n      return result;\r\n    }\r\n\r\n    // Check required fields\r\n    const requiredFields = ['version', 'created', 'lastActivity'];\r\n    for (const field of requiredFields) {\r\n      if (!(field in state)) {\r\n        result.issues.push(`Missing required field: ${field}`);\r\n      }\r\n    }\r\n\r\n    // Check array fields\r\n    const arrayFields = ['rollbackPoints', 'checkpoints', 'rollbackHistory', 'fileOperations'];\r\n    for (const field of arrayFields) {\r\n      if (field in state && !Array.isArray(state[field])) {\r\n        result.issues.push(`Field ${field} must be an array`);\r\n      }\r\n    }\r\n\r\n    return result;\r\n  }\r\n}\r\n"],"names":["promises","fs","StateTracker","workingDir","stateFile","recordRollbackPoint","type","data","result","success","errors","state","loadState","rollbackPoint","id","generateId","timestamp","Date","now","rollbackPoints","push","length","slice","saveState","error","message","createCheckpoint","phase","checkpoint","status","checkpoints","updateCheckpoint","checkpointId","updates","find","cp","Object","assign","recordRollback","targetId","rollbackType","rollbackRecord","rollbackHistory","getRollbackPoints","getCheckpoints","getRollbackHistory","trackFileOperation","operation","filePath","metadata","fileOp","fileOperations","getCurrentPhase","currentPhase","setCurrentPhase","phaseTimestamp","phaseHistory","getInitializationStats","lastActivity","cleanupOldState","daysToKeep","cleaned","cutoffTime","before","filter","rp","fo","validateStateTracking","warnings","lastValidation","validationResult","validateStateStructure","valid","issues","exportState","importState","stateData","content","readFile","JSON","parse","version","created","writeFile","stringify","Math","random","toString","substr","requiredFields","field","arrayFields","Array","isArray"],"mappings":"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"}