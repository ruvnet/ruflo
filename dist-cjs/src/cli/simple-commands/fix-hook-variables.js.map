{"version":3,"sources":["../../../../src/cli/simple-commands/fix-hook-variables.js"],"sourcesContent":["#!/usr/bin/env node\r\n\r\n/**\r\n * Fix hook variable interpolation in Claude Code settings.json files\r\n * Addresses issue #249 - ${file} and ${command} variables not working\r\n */\r\n\r\nimport fs from 'fs/promises';\r\nimport path from 'path';\r\nimport { existsSync } from 'fs';\r\nimport chalk from 'chalk';\r\nimport { printSuccess, printError, printWarning } from '../utils.js';\r\n\r\n// Known working variable syntaxes based on Claude Code version\r\nconst VARIABLE_SYNTAXES = {\r\n  legacy: {\r\n    pattern: /\\$\\{(\\w+)\\}/g,\r\n    example: '${file}',\r\n    description: 'Legacy syntax (not working in 1.0.51+)',\r\n  },\r\n  environment: {\r\n    pattern: /\\$(\\w+)/g,\r\n    example: '$CLAUDE_FILE',\r\n    description: 'Environment variable syntax (unverified)',\r\n  },\r\n  jq: {\r\n    pattern: null,\r\n    example: 'jq parsing of JSON input',\r\n    description: 'Official Claude Code approach using jq',\r\n  },\r\n  wrapper: {\r\n    pattern: null,\r\n    example: 'Use wrapper script',\r\n    description: 'Wrapper script approach',\r\n  },\r\n};\r\n\r\n// Mapping of our variables to Claude Code environment variables\r\nconst VARIABLE_MAPPINGS = {\r\n  file: ['CLAUDE_EDITED_FILE', 'CLAUDE_FILE', 'EDITED_FILE'],\r\n  command: ['CLAUDE_COMMAND', 'COMMAND', 'CMD'],\r\n  tool: ['CLAUDE_TOOL', 'TOOL_NAME', 'TOOL'],\r\n};\r\n\r\n/**\r\n * Detect which variable syntax works with current Claude Code version\r\n */\r\nasync function detectWorkingSyntax() {\r\n  // Based on official Claude Code documentation and testing,\r\n  // JQ parsing is the recommended approach for Claude Code 1.0.51+\r\n  return 'jq';\r\n}\r\n\r\n/**\r\n * Transform hook command to use working variable syntax\r\n */\r\nfunction transformHookCommand(command, fromSyntax, toSyntax) {\r\n  if (fromSyntax === 'legacy' && toSyntax === 'environment') {\r\n    // Replace ${file} with $CLAUDE_EDITED_FILE\r\n    return command.replace(/\\$\\{(\\w+)\\}/g, (match, varName) => {\r\n      const mappings = VARIABLE_MAPPINGS[varName];\r\n      if (mappings && mappings[0]) {\r\n        return `$${mappings[0]}`;\r\n      }\r\n      return match; // Keep unchanged if no mapping\r\n    });\r\n  }\r\n\r\n  if (fromSyntax === 'legacy' && toSyntax === 'jq') {\r\n    // Transform to use jq parsing of JSON input\r\n    // Extract the actual command and wrap it with jq parsing\r\n    const fileVarMatch = command.match(/\\$\\{file\\}/);\r\n    const commandVarMatch = command.match(/\\$\\{command\\}/);\r\n\r\n    if (fileVarMatch) {\r\n      // Replace ${file} with jq extraction\r\n      const baseCommand = command.replace(/\\$\\{file\\}/g, '{}');\r\n      return `cat | jq -r '.tool_input.file_path // .tool_input.path // \"\"' | xargs -I {} ${baseCommand}`;\r\n    } else if (commandVarMatch) {\r\n      // Replace ${command} with jq extraction\r\n      const baseCommand = command.replace(/\\$\\{command\\}/g, '{}');\r\n      return `cat | jq -r '.tool_input.command // \"\"' | xargs -I {} ${baseCommand}`;\r\n    }\r\n\r\n    // Fallback for other variables\r\n    return `cat | jq -r '.' | xargs -I {} ${command.replace(/\\$\\{(\\w+)\\}/g, '{}')}`;\r\n  }\r\n\r\n  if (toSyntax === 'wrapper') {\r\n    // Generate wrapper script path\r\n    const scriptName = command.includes('post-edit')\r\n      ? 'post-edit-hook.sh'\r\n      : command.includes('pre-edit')\r\n        ? 'pre-edit-hook.sh'\r\n        : 'generic-hook.sh';\r\n    return `.claude/hooks/${scriptName}`;\r\n  }\r\n\r\n  return command;\r\n}\r\n\r\n/**\r\n * Create wrapper scripts for hooks\r\n */\r\nasync function createWrapperScripts(commands) {\r\n  const hooksDir = '.claude/hooks';\r\n  await fs.mkdir(hooksDir, { recursive: true });\r\n\r\n  const wrapperScripts = new Map();\r\n\r\n  for (const command of commands) {\r\n    if (command.includes('post-edit')) {\r\n      const script = `#!/bin/bash\r\n# Post-edit hook wrapper\r\n# Handles variable interpolation for Claude Code hooks\r\n\r\n# Try to get file from various sources\r\nFILE=\"$CLAUDE_EDITED_FILE\"\r\n[ -z \"$FILE\" ] && FILE=\"$CLAUDE_FILE\"\r\n[ -z \"$FILE\" ] && FILE=\"$1\"\r\n\r\nif [ -n \"$FILE\" ]; then\r\n  ${command.replace('${file}', '\"$FILE\"')}\r\nelse\r\n  echo \"Warning: No file information available for hook\" >&2\r\nfi\r\n`;\r\n      await fs.writeFile(path.join(hooksDir, 'post-edit-hook.sh'), script, { mode: 0o755 });\r\n      wrapperScripts.set('post-edit', '.claude/hooks/post-edit-hook.sh');\r\n    }\r\n  }\r\n\r\n  return wrapperScripts;\r\n}\r\n\r\n/**\r\n * Fix hook variables in a settings.json file\r\n */\r\nasync function fixHookVariables(settingsPath, options = {}) {\r\n  const { backup = true, syntax = 'auto' } = options;\r\n\r\n  try {\r\n    // Read settings\r\n    const content = await fs.readFile(settingsPath, 'utf8');\r\n    const settings = JSON.parse(content);\r\n\r\n    if (!settings.hooks) {\r\n      printWarning('No hooks found in settings.json');\r\n      return { success: true, changes: 0 };\r\n    }\r\n\r\n    // Backup if requested\r\n    if (backup) {\r\n      const backupPath = `${settingsPath}.backup-${Date.now()}`;\r\n      await fs.writeFile(backupPath, content);\r\n      console.log(chalk.gray(`  Created backup: ${backupPath}`));\r\n    }\r\n\r\n    // Detect working syntax\r\n    const targetSyntax = syntax === 'auto' ? await detectWorkingSyntax() : syntax;\r\n    console.log(chalk.blue(`  Using ${targetSyntax} syntax`));\r\n\r\n    // Collect all commands that need transformation\r\n    const commands = [];\r\n    let changes = 0;\r\n\r\n    // Transform hooks\r\n    const transformHooks = (hooks) => {\r\n      if (Array.isArray(hooks)) {\r\n        return hooks.map((hook) => {\r\n          if (hook.hooks && Array.isArray(hook.hooks)) {\r\n            hook.hooks = hook.hooks.map((h) => {\r\n              if (h.command && h.command.includes('${')) {\r\n                commands.push(h.command);\r\n                const newCommand = transformHookCommand(h.command, 'legacy', targetSyntax);\r\n                if (newCommand !== h.command) {\r\n                  changes++;\r\n                  return { ...h, command: newCommand };\r\n                }\r\n              }\r\n              return h;\r\n            });\r\n          }\r\n          return hook;\r\n        });\r\n      }\r\n      return hooks;\r\n    };\r\n\r\n    // Process all hook types\r\n    for (const [hookType, hooks] of Object.entries(settings.hooks)) {\r\n      settings.hooks[hookType] = transformHooks(hooks);\r\n    }\r\n\r\n    // Create wrapper scripts if needed\r\n    if (targetSyntax === 'wrapper' && commands.length > 0) {\r\n      console.log(chalk.blue('  Creating wrapper scripts...'));\r\n      const scripts = await createWrapperScripts(commands);\r\n      console.log(chalk.green(`  Created ${scripts.size} wrapper scripts`));\r\n    }\r\n\r\n    // Save updated settings\r\n    await fs.writeFile(settingsPath, JSON.stringify(settings, null, 2));\r\n\r\n    return { success: true, changes };\r\n  } catch (error) {\r\n    return { success: false, error: error.message };\r\n  }\r\n}\r\n\r\n/**\r\n * Find all settings.json files\r\n */\r\nasync function findSettingsFiles() {\r\n  const locations = [\r\n    '.claude/settings.json',\r\n    'settings.json',\r\n    '.vscode/.claude/settings.json',\r\n    path.join(process.env.HOME || '', '.claude', 'settings.json'),\r\n  ];\r\n\r\n  const found = [];\r\n  for (const loc of locations) {\r\n    if (existsSync(loc)) {\r\n      found.push(loc);\r\n    }\r\n  }\r\n\r\n  return found;\r\n}\r\n\r\n/**\r\n * Main command handler\r\n */\r\nexport async function fixHookVariablesCommand(args = [], flags = {}) {\r\n  console.log(chalk.bold('\\nðŸ”§ Fixing Claude Code Hook Variables\\n'));\r\n\r\n  const options = {\r\n    backup: !flags['no-backup'],\r\n    syntax: flags.syntax || 'auto',\r\n    test: flags.test || false,\r\n  };\r\n\r\n  // Find files to fix\r\n  let files = args.length > 0 ? args : await findSettingsFiles();\r\n\r\n  if (files.length === 0) {\r\n    printError('No settings.json files found');\r\n    console.log('\\nSearched locations:');\r\n    console.log('  - .claude/settings.json');\r\n    console.log('  - settings.json');\r\n    console.log('  - .vscode/.claude/settings.json');\r\n    console.log(`  - ${path.join(process.env.HOME || '', '.claude', 'settings.json')}`);\r\n    return;\r\n  }\r\n\r\n  console.log(`Found ${files.length} settings file(s) to process:\\n`);\r\n\r\n  let totalChanges = 0;\r\n  let successCount = 0;\r\n\r\n  for (const file of files) {\r\n    console.log(chalk.cyan(`Processing: ${file}`));\r\n\r\n    const result = await fixHookVariables(file, options);\r\n\r\n    if (result.success) {\r\n      successCount++;\r\n      totalChanges += result.changes;\r\n      console.log(chalk.green(`  âœ… Fixed ${result.changes} hook commands`));\r\n    } else {\r\n      console.log(chalk.red(`  âŒ Error: ${result.error}`));\r\n    }\r\n\r\n    console.log();\r\n  }\r\n\r\n  // Summary\r\n  console.log(chalk.bold('Summary:'));\r\n  console.log(`  Files processed: ${files.length}`);\r\n  console.log(`  Successful: ${successCount}`);\r\n  console.log(`  Total changes: ${totalChanges}`);\r\n\r\n  if (totalChanges > 0) {\r\n    console.log(chalk.yellow('\\nâš ï¸  Important:'));\r\n    console.log('  1. Restart Claude Code for changes to take effect');\r\n    console.log('  2. Test your hooks to ensure they work correctly');\r\n    console.log('  3. Report any issues to: https://github.com/ruvnet/claude-flow/issues');\r\n  }\r\n\r\n  // Test mode\r\n  if (options.test) {\r\n    console.log(chalk.blue('\\nðŸ§ª Test Mode - Creating test hook...'));\r\n    await createTestHook();\r\n  }\r\n}\r\n\r\n/**\r\n * Create a test hook to verify variables work\r\n */\r\nasync function createTestHook() {\r\n  const testSettings = {\r\n    hooks: {\r\n      PostToolUse: [\r\n        {\r\n          matcher: 'Write',\r\n          hooks: [\r\n            {\r\n              type: 'command',\r\n              command:\r\n                'cat | jq -r \\'.tool_input.file_path // .tool_input.path // \"\"\\' | xargs -I {} echo \"Hook test - File: {}\" >> .claude/hook-test.log',\r\n            },\r\n          ],\r\n        },\r\n      ],\r\n    },\r\n  };\r\n\r\n  await fs.mkdir('.claude', { recursive: true });\r\n  await fs.writeFile('.claude/test-settings.json', JSON.stringify(testSettings, null, 2));\r\n\r\n  console.log('Created test configuration at: .claude/test-settings.json');\r\n  console.log('\\nTo test:');\r\n  console.log('  1. Copy .claude/test-settings.json to .claude/settings.json');\r\n  console.log('  2. Open Claude Code');\r\n  console.log('  3. Create or edit any file');\r\n  console.log('  4. Check .claude/hook-test.log for output');\r\n}\r\n\r\n// Export command configuration\r\nexport const fixHookVariablesCommandConfig = {\r\n  description: 'Fix variable interpolation in Claude Code hooks (${file} syntax)',\r\n  usage: 'fix-hook-variables [settings-file...]',\r\n  options: [\r\n    { flag: '--no-backup', description: 'Skip creating backup files' },\r\n    { flag: '--syntax <type>', description: 'Force specific syntax: environment, jq, wrapper' },\r\n    { flag: '--test', description: 'Create test hook configuration' },\r\n  ],\r\n  examples: [\r\n    'claude-flow fix-hook-variables',\r\n    'claude-flow fix-hook-variables .claude/settings.json',\r\n    'claude-flow fix-hook-variables --syntax wrapper',\r\n    'claude-flow fix-hook-variables --test',\r\n  ],\r\n  details: `\r\nFixes the \\${file} and \\${command} variable interpolation issue in Claude Code hooks.\r\n\r\nThis command will:\r\n  â€¢ Detect your Claude Code version\r\n  â€¢ Transform hook commands to use working variable syntax\r\n  â€¢ Create wrapper scripts if needed\r\n  â€¢ Backup original settings files\r\n\r\nAvailable syntaxes:\r\n  â€¢ environment: Use environment variables like $CLAUDE_EDITED_FILE (unverified)\r\n  â€¢ jq: Use official jq JSON parsing approach (recommended)\r\n  â€¢ wrapper: Create wrapper scripts to handle variables\r\n\r\nNote: The 'jq' syntax is based on official Claude Code documentation and is likely\r\nthe most reliable approach for Claude Code 1.0.51+.\r\n\r\nFor more information: https://github.com/ruvnet/claude-flow/issues/249`,\r\n};\r\n"],"names":["fs","path","existsSync","chalk","printError","printWarning","VARIABLE_SYNTAXES","legacy","pattern","example","description","environment","jq","wrapper","VARIABLE_MAPPINGS","file","command","tool","detectWorkingSyntax","transformHookCommand","fromSyntax","toSyntax","replace","match","varName","mappings","fileVarMatch","commandVarMatch","baseCommand","scriptName","includes","createWrapperScripts","commands","hooksDir","mkdir","recursive","wrapperScripts","Map","script","writeFile","join","mode","set","fixHookVariables","settingsPath","options","backup","syntax","content","readFile","settings","JSON","parse","hooks","success","changes","backupPath","Date","now","console","log","gray","targetSyntax","blue","transformHooks","Array","isArray","map","hook","h","push","newCommand","hookType","Object","entries","length","scripts","green","size","stringify","error","message","findSettingsFiles","locations","process","env","HOME","found","loc","fixHookVariablesCommand","args","flags","bold","test","files","totalChanges","successCount","cyan","result","red","yellow","createTestHook","testSettings","PostToolUse","matcher","type","fixHookVariablesCommandConfig","usage","flag","examples","details"],"mappings":"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"}