{"version":3,"sources":["../../../src/migration/migration-analyzer.ts"],"sourcesContent":["/**\r\n * Migration Analyzer - Analyzes existing projects for migration readiness\r\n */\r\n\r\nimport * as fs from 'fs-extra';\r\nimport * as path from 'path';\r\nimport * as crypto from 'crypto';\r\nimport type { MigrationAnalysis, MigrationRisk } from './types.js';\r\nimport { logger } from './logger.js';\r\nimport * as chalk from 'chalk';\r\nimport { glob } from 'glob';\r\n\r\nexport class MigrationAnalyzer {\r\n  private optimizedCommands = [\r\n    'sparc',\r\n    'sparc-architect',\r\n    'sparc-code',\r\n    'sparc-tdd',\r\n    'claude-flow-help',\r\n    'claude-flow-memory',\r\n    'claude-flow-swarm',\r\n  ];\r\n\r\n  async analyze(projectPath: string): Promise<MigrationAnalysis> {\r\n    logger.info(`Analyzing project at ${projectPath}...`);\r\n\r\n    const analysis: MigrationAnalysis = {\r\n      projectPath,\r\n      hasClaudeFolder: false,\r\n      hasOptimizedPrompts: false,\r\n      customCommands: [],\r\n      customConfigurations: {},\r\n      conflictingFiles: [],\r\n      migrationRisks: [],\r\n      recommendations: [],\r\n      timestamp: new Date(),\r\n    };\r\n\r\n    // Check for .claude folder\r\n    const claudePath = path.join(projectPath, '.claude');\r\n    if (await fs.pathExists(claudePath)) {\r\n      analysis.hasClaudeFolder = true;\r\n\r\n      // Analyze existing commands\r\n      await this.analyzeCommands(claudePath, analysis);\r\n\r\n      // Check for optimized prompts\r\n      await this.checkOptimizedPrompts(claudePath, analysis);\r\n\r\n      // Analyze configurations\r\n      await this.analyzeConfigurations(projectPath, analysis);\r\n\r\n      // Detect conflicts\r\n      await this.detectConflicts(projectPath, analysis);\r\n    }\r\n\r\n    // Generate risks and recommendations\r\n    this.assessRisks(analysis);\r\n    this.generateRecommendations(analysis);\r\n\r\n    return analysis;\r\n  }\r\n\r\n  private async analyzeCommands(claudePath: string, analysis: MigrationAnalysis): Promise<void> {\r\n    const commandsPath = path.join(claudePath, 'commands');\r\n\r\n    if (await fs.pathExists(commandsPath)) {\r\n      const files = await glob('**/*.md', { cwd: commandsPath });\r\n\r\n      for (const file of files) {\r\n        const commandName = path.basename(file, '.md');\r\n\r\n        if (!this.optimizedCommands.includes(commandName)) {\r\n          analysis.customCommands.push(commandName);\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  private async checkOptimizedPrompts(\r\n    claudePath: string,\r\n    analysis: MigrationAnalysis,\r\n  ): Promise<void> {\r\n    // Check for key optimized prompt files\r\n    const optimizedFiles = [\r\n      'BATCHTOOLS_GUIDE.md',\r\n      'BATCHTOOLS_BEST_PRACTICES.md',\r\n      'MIGRATION_GUIDE.md',\r\n      'PERFORMANCE_BENCHMARKS.md',\r\n    ];\r\n\r\n    let hasOptimized = 0;\r\n    for (const file of optimizedFiles) {\r\n      if (await fs.pathExists(path.join(claudePath, file))) {\r\n        hasOptimized++;\r\n      }\r\n    }\r\n\r\n    analysis.hasOptimizedPrompts = hasOptimized >= 2;\r\n  }\r\n\r\n  private async analyzeConfigurations(\r\n    projectPath: string,\r\n    analysis: MigrationAnalysis,\r\n  ): Promise<void> {\r\n    // Check for CLAUDE.md\r\n    const claudeMdPath = path.join(projectPath, 'CLAUDE.md');\r\n    if (await fs.pathExists(claudeMdPath)) {\r\n      const content = await fs.readFile(claudeMdPath, 'utf-8');\r\n      analysis.customConfigurations['CLAUDE.md'] = {\r\n        exists: true,\r\n        size: content.length,\r\n        hasCustomContent: !content.includes('SPARC Development Environment'),\r\n      };\r\n    }\r\n\r\n    // Check for .roomodes\r\n    const roomodesPath = path.join(projectPath, '.roomodes');\r\n    if (await fs.pathExists(roomodesPath)) {\r\n      try {\r\n        const roomodes = await fs.readJson(roomodesPath);\r\n        analysis.customConfigurations['.roomodes'] = {\r\n          exists: true,\r\n          modeCount: Object.keys(roomodes).length,\r\n          customModes: Object.keys(roomodes).filter(\r\n            (mode) => !['architect', 'code', 'tdd', 'debug', 'docs-writer'].includes(mode),\r\n          ),\r\n        };\r\n      } catch (error) {\r\n        analysis.migrationRisks.push({\r\n          level: 'medium',\r\n          description: 'Invalid .roomodes file',\r\n          file: roomodesPath,\r\n          mitigation: 'File will be backed up and replaced',\r\n        });\r\n      }\r\n    }\r\n  }\r\n\r\n  private async detectConflicts(projectPath: string, analysis: MigrationAnalysis): Promise<void> {\r\n    // Check for files that might conflict with migration\r\n    const potentialConflicts = [\r\n      '.claude/commands/sparc.md',\r\n      '.claude/BATCHTOOLS_GUIDE.md',\r\n      'memory/memory-store.json',\r\n      'coordination/config.json',\r\n    ];\r\n\r\n    for (const file of potentialConflicts) {\r\n      const filePath = path.join(projectPath, file);\r\n      if (await fs.pathExists(filePath)) {\r\n        const content = await fs.readFile(filePath, 'utf-8');\r\n        const checksum = crypto.createHash('md5').update(content).digest('hex');\r\n\r\n        // Check if it's a custom version\r\n        if (!this.isStandardFile(file, checksum)) {\r\n          analysis.conflictingFiles.push(file);\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  private isStandardFile(file: string, checksum: string): boolean {\r\n    // This would contain checksums of standard files\r\n    // For now, we'll assume all existing files are potentially custom\r\n    return false;\r\n  }\r\n\r\n  private assessRisks(analysis: MigrationAnalysis): void {\r\n    // High risk: Custom commands that might be overwritten\r\n    if (analysis.customCommands.length > 0) {\r\n      analysis.migrationRisks.push({\r\n        level: 'high',\r\n        description: `Found ${analysis.customCommands.length} custom commands that may be affected`,\r\n        mitigation: 'Use --preserve-custom flag or selective migration',\r\n      });\r\n    }\r\n\r\n    // Medium risk: Existing optimized prompts\r\n    if (analysis.hasOptimizedPrompts) {\r\n      analysis.migrationRisks.push({\r\n        level: 'medium',\r\n        description: 'Project already has some optimized prompts',\r\n        mitigation: 'Consider using merge strategy to preserve customizations',\r\n      });\r\n    }\r\n\r\n    // Low risk: No .claude folder\r\n    if (!analysis.hasClaudeFolder) {\r\n      analysis.migrationRisks.push({\r\n        level: 'low',\r\n        description: 'No existing .claude folder found',\r\n        mitigation: 'Fresh installation will be performed',\r\n      });\r\n    }\r\n\r\n    // High risk: Conflicting files\r\n    if (analysis.conflictingFiles.length > 0) {\r\n      analysis.migrationRisks.push({\r\n        level: 'high',\r\n        description: `${analysis.conflictingFiles.length} files may have custom modifications`,\r\n        mitigation: 'Files will be backed up before migration',\r\n      });\r\n    }\r\n  }\r\n\r\n  private generateRecommendations(analysis: MigrationAnalysis): void {\r\n    // Strategy recommendations\r\n    if (analysis.customCommands.length > 0 || analysis.conflictingFiles.length > 0) {\r\n      analysis.recommendations.push(\r\n        'Use \"selective\" or \"merge\" strategy to preserve customizations',\r\n      );\r\n    } else if (!analysis.hasClaudeFolder) {\r\n      analysis.recommendations.push('Use \"full\" strategy for clean installation');\r\n    }\r\n\r\n    // Backup recommendations\r\n    if (analysis.hasClaudeFolder) {\r\n      analysis.recommendations.push(\r\n        'Create a backup before migration (automatic with default settings)',\r\n      );\r\n    }\r\n\r\n    // Custom command recommendations\r\n    if (analysis.customCommands.length > 0) {\r\n      analysis.recommendations.push(\r\n        `Review custom commands: ${analysis.customCommands.join(', ')}`,\r\n      );\r\n    }\r\n\r\n    // Validation recommendations\r\n    if (analysis.migrationRisks.some((r) => r.level === 'high')) {\r\n      analysis.recommendations.push('Run with --dry-run first to preview changes');\r\n    }\r\n  }\r\n\r\n  printAnalysis(analysis: MigrationAnalysis, detailed: boolean = false): void {\r\n    console.log(chalk.bold('\\nðŸ“Š Migration Analysis Report'));\r\n    console.log(chalk.gray('â”€'.repeat(50)));\r\n\r\n    console.log(`\\n${chalk.bold('Project:')} ${analysis.projectPath}`);\r\n    console.log(`${chalk.bold('Timestamp:')} ${analysis.timestamp.toISOString()}`);\r\n\r\n    // Status\r\n    console.log(chalk.bold('\\nðŸ“‹ Current Status:'));\r\n    console.log(\r\n      `  â€¢ .claude folder: ${analysis.hasClaudeFolder ? chalk.green('âœ“') : chalk.red('âœ—')}`,\r\n    );\r\n    console.log(\r\n      `  â€¢ Optimized prompts: ${analysis.hasOptimizedPrompts ? chalk.green('âœ“') : chalk.red('âœ—')}`,\r\n    );\r\n    console.log(\r\n      `  â€¢ Custom commands: ${analysis.customCommands.length > 0 ? chalk.yellow(analysis.customCommands.length) : chalk.green('0')}`,\r\n    );\r\n    console.log(\r\n      `  â€¢ Conflicts: ${analysis.conflictingFiles.length > 0 ? chalk.yellow(analysis.conflictingFiles.length) : chalk.green('0')}`,\r\n    );\r\n\r\n    // Risks\r\n    if (analysis.migrationRisks.length > 0) {\r\n      console.log(chalk.bold('\\nâš ï¸  Migration Risks:'));\r\n      analysis.migrationRisks.forEach((risk) => {\r\n        const icon = risk.level === 'high' ? 'ðŸ”´' : risk.level === 'medium' ? 'ðŸŸ¡' : 'ðŸŸ¢';\r\n        console.log(`  ${icon} ${chalk.bold(risk.level.toUpperCase())}: ${risk.description}`);\r\n        if (risk.mitigation) {\r\n          console.log(`     ${chalk.gray('â†’')} ${chalk.italic(risk.mitigation)}`);\r\n        }\r\n      });\r\n    }\r\n\r\n    // Recommendations\r\n    if (analysis.recommendations.length > 0) {\r\n      console.log(chalk.bold('\\nðŸ’¡ Recommendations:'));\r\n      analysis.recommendations.forEach((rec) => {\r\n        console.log(`  â€¢ ${rec}`);\r\n      });\r\n    }\r\n\r\n    // Detailed information\r\n    if (detailed) {\r\n      if (analysis.customCommands.length > 0) {\r\n        console.log(chalk.bold('\\nðŸ”§ Custom Commands:'));\r\n        analysis.customCommands.forEach((cmd) => {\r\n          console.log(`  â€¢ ${cmd}`);\r\n        });\r\n      }\r\n\r\n      if (analysis.conflictingFiles.length > 0) {\r\n        console.log(chalk.bold('\\nðŸ“ Conflicting Files:'));\r\n        analysis.conflictingFiles.forEach((file) => {\r\n          console.log(`  â€¢ ${file}`);\r\n        });\r\n      }\r\n\r\n      if (Object.keys(analysis.customConfigurations).length > 0) {\r\n        console.log(chalk.bold('\\nâš™ï¸  Configurations:'));\r\n        Object.entries(analysis.customConfigurations).forEach(([file, config]) => {\r\n          console.log(`  â€¢ ${file}: ${JSON.stringify(config, null, 2)}`);\r\n        });\r\n      }\r\n    }\r\n\r\n    console.log(chalk.gray('\\n' + 'â”€'.repeat(50)));\r\n  }\r\n\r\n  async saveAnalysis(analysis: MigrationAnalysis, outputPath: string): Promise<void> {\r\n    await fs.writeJson(outputPath, analysis, { spaces: 2 });\r\n  }\r\n}\r\n"],"names":["fs","path","crypto","logger","chalk","glob","MigrationAnalyzer","optimizedCommands","analyze","projectPath","info","analysis","hasClaudeFolder","hasOptimizedPrompts","customCommands","customConfigurations","conflictingFiles","migrationRisks","recommendations","timestamp","Date","claudePath","join","pathExists","analyzeCommands","checkOptimizedPrompts","analyzeConfigurations","detectConflicts","assessRisks","generateRecommendations","commandsPath","files","cwd","file","commandName","basename","includes","push","optimizedFiles","hasOptimized","claudeMdPath","content","readFile","exists","size","length","hasCustomContent","roomodesPath","roomodes","readJson","modeCount","Object","keys","customModes","filter","mode","error","level","description","mitigation","potentialConflicts","filePath","checksum","createHash","update","digest","isStandardFile","some","r","printAnalysis","detailed","console","log","bold","gray","repeat","toISOString","green","red","yellow","forEach","risk","icon","toUpperCase","italic","rec","cmd","entries","config","JSON","stringify","saveAnalysis","outputPath","writeJson","spaces"],"mappings":"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"}