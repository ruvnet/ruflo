{"version":3,"sources":["../../../src/verification/simple-hooks.ts"],"sourcesContent":["/**\r\n * Simplified Verification Hooks\r\n * \r\n * A simplified version to avoid TypeScript compiler issues\r\n */\r\n\r\nimport { Logger } from '../core/logger.js';\r\nimport { agenticHookManager } from '../services/agentic-flow-hooks/index.js';\r\nimport type {\r\n  AgenticHookContext,\r\n  HookHandlerResult,\r\n  HookRegistration,\r\n  WorkflowHookPayload,\r\n} from '../services/agentic-flow-hooks/types.js';\r\n\r\nconst logger = new Logger({\r\n  level: 'info',\r\n  format: 'text',\r\n  destination: 'console'\r\n}, { prefix: 'SimpleVerificationHooks' });\r\n\r\n// ===== Simple Types =====\r\n\r\nexport interface SimpleVerificationConfig {\r\n  enabled: boolean;\r\n  logLevel: 'info' | 'debug' | 'warn' | 'error';\r\n}\r\n\r\nexport interface SimpleVerificationResult {\r\n  success: boolean;\r\n  message: string;\r\n  details?: any;\r\n}\r\n\r\n// ===== Simple Verification Hook Manager =====\r\n\r\nexport class SimpleVerificationHookManager {\r\n  private config: SimpleVerificationConfig;\r\n\r\n  constructor(config: Partial<SimpleVerificationConfig> = {}) {\r\n    this.config = {\r\n      enabled: true,\r\n      logLevel: 'info',\r\n      ...config\r\n    };\r\n    \r\n    if (this.config.enabled) {\r\n      this.registerSimpleHooks();\r\n    }\r\n  }\r\n\r\n  private registerSimpleHooks(): void {\r\n    // Simple pre-task hook\r\n    const preTaskHook: HookRegistration = {\r\n      id: 'simple-verification-pre-task',\r\n      type: 'workflow-start',\r\n      priority: 100,\r\n      handler: async (payload: WorkflowHookPayload, context: AgenticHookContext): Promise<HookHandlerResult> => {\r\n        logger.info('üîç Pre-task verification starting...');\r\n        \r\n        try {\r\n          const result = await this.runSimpleChecks(payload, context);\r\n          \r\n          if (result.success) {\r\n            logger.info('‚úÖ Pre-task verification passed');\r\n            return {\r\n              continue: true,\r\n              metadata: {\r\n                verificationPassed: true,\r\n                message: result.message\r\n              }\r\n            };\r\n          } else {\r\n            logger.warn('‚ö†Ô∏è Pre-task verification failed:', result.message);\r\n            return {\r\n              continue: true, // Continue with warnings\r\n              metadata: {\r\n                verificationFailed: true,\r\n                message: result.message\r\n              }\r\n            };\r\n          }\r\n        } catch (error) {\r\n          logger.error('‚ùå Pre-task verification error:', error);\r\n          return {\r\n            continue: true,\r\n            metadata: {\r\n              verificationError: true,\r\n              error: (error as Error).message\r\n            }\r\n          };\r\n        }\r\n      }\r\n    };\r\n\r\n    // Simple post-task hook\r\n    const postTaskHook: HookRegistration = {\r\n      id: 'simple-verification-post-task',\r\n      type: 'workflow-complete',\r\n      priority: 90,\r\n      handler: async (payload: WorkflowHookPayload, context: AgenticHookContext): Promise<HookHandlerResult> => {\r\n        logger.info('üîç Post-task verification starting...');\r\n        \r\n        try {\r\n          const result = await this.runSimpleValidation(payload, context);\r\n          \r\n          logger.info(`‚úÖ Post-task verification completed: ${result.message}`);\r\n          return {\r\n            continue: true,\r\n            metadata: {\r\n              validationComplete: true,\r\n              success: result.success,\r\n              message: result.message\r\n            }\r\n          };\r\n        } catch (error) {\r\n          logger.error('‚ùå Post-task verification error:', error);\r\n          return {\r\n            continue: true,\r\n            metadata: {\r\n              validationError: true,\r\n              error: (error as Error).message\r\n            }\r\n          };\r\n        }\r\n      }\r\n    };\r\n\r\n    // Register hooks\r\n    agenticHookManager.register(preTaskHook);\r\n    agenticHookManager.register(postTaskHook);\r\n    \r\n    logger.info('Simple verification hooks registered successfully');\r\n  }\r\n\r\n  private async runSimpleChecks(\r\n    payload: WorkflowHookPayload, \r\n    context: AgenticHookContext\r\n  ): Promise<SimpleVerificationResult> {\r\n    // Simple environment check\r\n    const nodeEnv = process.env.NODE_ENV;\r\n    if (!nodeEnv) {\r\n      return {\r\n        success: false,\r\n        message: 'NODE_ENV environment variable not set',\r\n        details: { missing: ['NODE_ENV'] }\r\n      };\r\n    }\r\n\r\n    // Simple memory check\r\n    const memUsage = process.memoryUsage();\r\n    const heapUsedMB = memUsage.heapUsed / 1024 / 1024;\r\n    if (heapUsedMB > 1000) { // More than 1GB\r\n      return {\r\n        success: false,\r\n        message: `High memory usage detected: ${heapUsedMB.toFixed(2)}MB`,\r\n        details: { memoryUsage: heapUsedMB }\r\n      };\r\n    }\r\n\r\n    return {\r\n      success: true,\r\n      message: 'All pre-task checks passed',\r\n      details: {\r\n        nodeEnv,\r\n        memoryUsage: heapUsedMB\r\n      }\r\n    };\r\n  }\r\n\r\n  private async runSimpleValidation(\r\n    payload: WorkflowHookPayload, \r\n    context: AgenticHookContext\r\n  ): Promise<SimpleVerificationResult> {\r\n    // Simple validation - check if workflow has state\r\n    if (!payload.state || Object.keys(payload.state).length === 0) {\r\n      return {\r\n        success: false,\r\n        message: 'Workflow completed with empty state',\r\n        details: { state: payload.state }\r\n      };\r\n    }\r\n\r\n    // Check for errors in metadata\r\n    if (payload.error) {\r\n      return {\r\n        success: false,\r\n        message: 'Workflow completed with errors',\r\n        details: { error: payload.error }\r\n      };\r\n    }\r\n\r\n    return {\r\n      success: true,\r\n      message: 'Post-task validation passed',\r\n      details: { \r\n        stateKeys: Object.keys(payload.state),\r\n        timestamp: Date.now()\r\n      }\r\n    };\r\n  }\r\n\r\n  public getStatus(): any {\r\n    return {\r\n      enabled: this.config.enabled,\r\n      hooksRegistered: this.config.enabled ? 2 : 0,\r\n      config: this.config\r\n    };\r\n  }\r\n\r\n  public updateConfig(newConfig: Partial<SimpleVerificationConfig>): void {\r\n    this.config = { ...this.config, ...newConfig };\r\n    logger.info('Simple verification configuration updated', this.config);\r\n  }\r\n}\r\n\r\n// Export singleton instance\r\nexport const simpleVerificationHookManager = new SimpleVerificationHookManager();\r\n\r\n// Initialize\r\nlogger.info('Simple verification hooks module initialized');"],"names":["Logger","agenticHookManager","logger","level","format","destination","prefix","SimpleVerificationHookManager","config","enabled","logLevel","registerSimpleHooks","preTaskHook","id","type","priority","handler","payload","context","info","result","runSimpleChecks","success","continue","metadata","verificationPassed","message","warn","verificationFailed","error","verificationError","postTaskHook","runSimpleValidation","validationComplete","validationError","register","nodeEnv","process","env","NODE_ENV","details","missing","memUsage","memoryUsage","heapUsedMB","heapUsed","toFixed","state","Object","keys","length","stateKeys","timestamp","Date","now","getStatus","hooksRegistered","updateConfig","newConfig","simpleVerificationHookManager"],"mappings":"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"}