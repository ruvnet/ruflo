{"version":3,"sources":["../../../src/verification/telemetry.ts"],"sourcesContent":["/**\r\n * Agent Truth Telemetry System\r\n * \r\n * Comprehensive real-time truth metrics collection and agent performance scoring\r\n * with system-wide accuracy tracking and automated alerting capabilities.\r\n * \r\n * Target Metrics: >95% truth accuracy, <10% human intervention\r\n */\r\n\r\nimport { EventEmitter } from 'node:events';\r\nimport type { ILogger } from '../core/logger.js';\r\nimport type { IEventBus } from '../core/event-bus.js';\r\nimport type { DistributedMemorySystem } from '../memory/distributed-memory.js';\r\n\r\n// ========================================================================================\r\n// Core Truth Telemetry Types\r\n// ========================================================================================\r\n\r\nexport interface TruthMetric {\r\n  id: string;\r\n  timestamp: Date;\r\n  agentId: string;\r\n  taskId: string;\r\n  metricType: TruthMetricType;\r\n  value: number;\r\n  confidence: number;\r\n  context: TruthContext;\r\n  validation: ValidationResult;\r\n  metadata: Record<string, any>;\r\n}\r\n\r\nexport interface TruthContext {\r\n  taskType: string;\r\n  complexity: 'low' | 'medium' | 'high' | 'critical';\r\n  domain: string;\r\n  dependencies: string[];\r\n  inputSources: string[];\r\n  outputTargets: string[];\r\n  verificationMethod: 'automated' | 'human' | 'hybrid';\r\n  riskLevel: 'low' | 'medium' | 'high' | 'critical';\r\n}\r\n\r\nexport interface ValidationResult {\r\n  isValid: boolean;\r\n  validationType: 'syntax' | 'logic' | 'semantic' | 'functional' | 'integration';\r\n  score: number; // 0-1\r\n  errors: ValidationError[];\r\n  warnings: ValidationWarning[];\r\n  suggestions: ValidationSuggestion[];\r\n  automatedChecks: AutomatedCheck[];\r\n  humanReview?: HumanReview;\r\n}\r\n\r\nexport interface ValidationError {\r\n  type: string;\r\n  severity: 'low' | 'medium' | 'high' | 'critical';\r\n  message: string;\r\n  location?: string;\r\n  suggestedFix?: string;\r\n  impact: number; // 0-1\r\n}\r\n\r\nexport interface ValidationWarning {\r\n  type: string;\r\n  message: string;\r\n  location?: string;\r\n  recommendation?: string;\r\n}\r\n\r\nexport interface ValidationSuggestion {\r\n  type: string;\r\n  description: string;\r\n  confidenceScore: number;\r\n  potentialImpact: number;\r\n}\r\n\r\nexport interface AutomatedCheck {\r\n  name: string;\r\n  type: 'static' | 'dynamic' | 'integration' | 'performance';\r\n  status: 'passed' | 'failed' | 'warning' | 'skipped';\r\n  details: Record<string, any>;\r\n  executionTime: number;\r\n}\r\n\r\nexport interface HumanReview {\r\n  reviewerId: string;\r\n  timestamp: Date;\r\n  score: number;\r\n  feedback: string;\r\n  timeSpent: number;\r\n  confidence: number;\r\n}\r\n\r\nexport interface AgentTruthScore {\r\n  agentId: string;\r\n  timestamp: Date;\r\n  overallScore: number; // 0-1\r\n  components: {\r\n    accuracy: number;\r\n    reliability: number;\r\n    consistency: number;\r\n    efficiency: number;\r\n    adaptability: number;\r\n  };\r\n  recentPerformance: PerformanceWindow[];\r\n  trends: ScoreTrend[];\r\n  benchmarks: BenchmarkComparison[];\r\n  riskAssessment: RiskAssessment;\r\n}\r\n\r\nexport interface PerformanceWindow {\r\n  period: string;\r\n  startTime: Date;\r\n  endTime: Date;\r\n  metrics: {\r\n    totalTasks: number;\r\n    successfulTasks: number;\r\n    averageAccuracy: number;\r\n    averageConfidence: number;\r\n    humanInterventions: number;\r\n    criticalErrors: number;\r\n  };\r\n}\r\n\r\nexport interface ScoreTrend {\r\n  metric: string;\r\n  direction: 'improving' | 'declining' | 'stable';\r\n  rate: number;\r\n  confidence: number;\r\n  timespan: string;\r\n}\r\n\r\nexport interface BenchmarkComparison {\r\n  category: string;\r\n  agentScore: number;\r\n  benchmarkScore: number;\r\n  percentile: number;\r\n  comparison: 'above' | 'at' | 'below';\r\n}\r\n\r\nexport interface RiskAssessment {\r\n  level: 'low' | 'medium' | 'high' | 'critical';\r\n  factors: RiskFactor[];\r\n  recommendations: string[];\r\n  mitigationStrategies: string[];\r\n}\r\n\r\nexport interface RiskFactor {\r\n  name: string;\r\n  severity: number; // 0-1\r\n  probability: number; // 0-1\r\n  impact: string;\r\n  trend: 'increasing' | 'stable' | 'decreasing';\r\n}\r\n\r\nexport interface SystemTruthMetrics {\r\n  timestamp: Date;\r\n  overallAccuracy: number;\r\n  humanInterventionRate: number;\r\n  systemReliability: number;\r\n  agentCount: number;\r\n  activeAgents: number;\r\n  totalTasks: number;\r\n  verifiedTasks: number;\r\n  criticalFailures: number;\r\n  recoveryTime: number;\r\n  efficiency: number;\r\n  distributionMetrics: DistributionMetrics;\r\n}\r\n\r\nexport interface DistributionMetrics {\r\n  taskDistribution: Record<string, number>;\r\n  accuracyDistribution: Record<string, number>;\r\n  complexityDistribution: Record<string, number>;\r\n  errorTypeDistribution: Record<string, number>;\r\n}\r\n\r\nexport interface TruthAlert {\r\n  id: string;\r\n  timestamp: Date;\r\n  severity: 'info' | 'warning' | 'critical' | 'emergency';\r\n  type: TruthAlertType;\r\n  message: string;\r\n  source: string;\r\n  context: Record<string, any>;\r\n  thresholds: AlertThreshold[];\r\n  actions: AlertAction[];\r\n  escalationPath: EscalationLevel[];\r\n  resolved: boolean;\r\n  resolvedAt?: Date;\r\n  resolvedBy?: string;\r\n}\r\n\r\nexport interface AlertThreshold {\r\n  metric: string;\r\n  operator: 'gt' | 'lt' | 'eq' | 'gte' | 'lte' | 'ne';\r\n  value: number;\r\n  duration: number;\r\n  severity: 'info' | 'warning' | 'critical' | 'emergency';\r\n}\r\n\r\nexport interface AlertAction {\r\n  type: 'notify' | 'escalate' | 'auto-remediate' | 'suspend' | 'restart';\r\n  target: string;\r\n  config: Record<string, any>;\r\n  enabled: boolean;\r\n}\r\n\r\nexport interface EscalationLevel {\r\n  level: number;\r\n  delay: number;\r\n  targets: string[];\r\n  conditions: string[];\r\n}\r\n\r\nexport interface DashboardData {\r\n  timestamp: Date;\r\n  summary: {\r\n    overallHealth: number;\r\n    truthAccuracy: number;\r\n    humanInterventionRate: number;\r\n    systemEfficiency: number;\r\n    alertCount: number;\r\n  };\r\n  charts: {\r\n    accuracyTrend: DataPoint[];\r\n    interventionTrend: DataPoint[];\r\n    agentPerformance: AgentPerformanceChart[];\r\n    errorDistribution: ErrorDistributionChart[];\r\n    systemLoad: SystemLoadChart[];\r\n  };\r\n  tables: {\r\n    topPerformers: AgentRanking[];\r\n    recentAlerts: TruthAlert[];\r\n    criticalIssues: CriticalIssue[];\r\n  };\r\n  insights: SystemInsight[];\r\n}\r\n\r\nexport interface DataPoint {\r\n  timestamp: Date;\r\n  value: number;\r\n  label?: string;\r\n}\r\n\r\nexport interface AgentPerformanceChart {\r\n  agentId: string;\r\n  score: number;\r\n  trend: 'up' | 'down' | 'stable';\r\n  tasks: number;\r\n  accuracy: number;\r\n}\r\n\r\nexport interface ErrorDistributionChart {\r\n  category: string;\r\n  count: number;\r\n  percentage: number;\r\n  severity: string;\r\n}\r\n\r\nexport interface SystemLoadChart {\r\n  timestamp: Date;\r\n  load: number;\r\n  capacity: number;\r\n  utilization: number;\r\n}\r\n\r\nexport interface AgentRanking {\r\n  rank: number;\r\n  agentId: string;\r\n  score: number;\r\n  tasks: number;\r\n  accuracy: number;\r\n  efficiency: number;\r\n}\r\n\r\nexport interface CriticalIssue {\r\n  id: string;\r\n  severity: string;\r\n  description: string;\r\n  affectedAgents: string[];\r\n  impact: string;\r\n  eta: Date;\r\n}\r\n\r\nexport interface SystemInsight {\r\n  type: 'performance' | 'efficiency' | 'quality' | 'risk';\r\n  title: string;\r\n  description: string;\r\n  impact: 'low' | 'medium' | 'high';\r\n  actionable: boolean;\r\n  recommendations: string[];\r\n}\r\n\r\nexport type TruthMetricType = \r\n  | 'accuracy' \r\n  | 'confidence' \r\n  | 'consistency' \r\n  | 'reliability' \r\n  | 'efficiency' \r\n  | 'completeness' \r\n  | 'correctness' \r\n  | 'timeliness'\r\n  | 'innovation'\r\n  | 'adaptability';\r\n\r\nexport type TruthAlertType = \r\n  | 'accuracy_degradation'\r\n  | 'high_intervention_rate'\r\n  | 'system_failure'\r\n  | 'agent_malfunction'\r\n  | 'threshold_violation'\r\n  | 'anomaly_detected'\r\n  | 'performance_degradation'\r\n  | 'quality_decline';\r\n\r\n// ========================================================================================\r\n// Truth Telemetry Configuration\r\n// ========================================================================================\r\n\r\nexport interface TruthTelemetryConfig {\r\n  // Collection settings\r\n  metricsInterval: number;\r\n  batchSize: number;\r\n  bufferSize: number;\r\n  \r\n  // Validation settings\r\n  validationTimeout: number;\r\n  maxValidationRetries: number;\r\n  validationThreshold: number;\r\n  \r\n  // Scoring settings\r\n  scoringInterval: number;\r\n  performanceWindowSize: number;\r\n  trendAnalysisDepth: number;\r\n  \r\n  // Alert settings\r\n  alertEnabled: boolean;\r\n  alertThresholds: {\r\n    accuracyThreshold: number;\r\n    interventionRateThreshold: number;\r\n    systemReliabilityThreshold: number;\r\n    criticalErrorThreshold: number;\r\n  };\r\n  \r\n  // Export settings\r\n  dashboardEnabled: boolean;\r\n  exportInterval: number;\r\n  exportFormat: 'json' | 'csv' | 'prometheus';\r\n  retentionPeriod: number;\r\n  \r\n  // Integration settings\r\n  mcpIntegration: boolean;\r\n  persistenceEnabled: boolean;\r\n  realtimeEnabled: boolean;\r\n  debugMode: boolean;\r\n}\r\n\r\n// ========================================================================================\r\n// Core Truth Telemetry Engine\r\n// ========================================================================================\r\n\r\nexport class TruthTelemetryEngine extends EventEmitter {\r\n  private config: TruthTelemetryConfig;\r\n  private logger: ILogger;\r\n  private eventBus: IEventBus;\r\n  private memory: DistributedMemorySystem;\r\n  \r\n  // Core components\r\n  private metricsCollector: TruthMetricsCollector;\r\n  private agentScorer: AgentTruthScorer;\r\n  private systemTracker: SystemTruthTracker;\r\n  private alertManager: TruthAlertManager;\r\n  private dashboardExporter: DashboardExporter;\r\n  private automatedValidator: AutomatedValidator;\r\n  \r\n  // State management\r\n  private truthMetrics = new Map<string, TruthMetric>();\r\n  private agentScores = new Map<string, AgentTruthScore>();\r\n  private systemMetrics: SystemTruthMetrics;\r\n  private activeAlerts = new Map<string, TruthAlert>();\r\n  private metricsBuffer: TruthMetric[] = [];\r\n  \r\n  // Intervals and timers\r\n  private collectionInterval?: NodeJS.Timeout;\r\n  private scoringInterval?: NodeJS.Timeout;\r\n  private alertInterval?: NodeJS.Timeout;\r\n  private exportInterval?: NodeJS.Timeout;\r\n  \r\n  constructor(\r\n    config: Partial<TruthTelemetryConfig>,\r\n    logger: ILogger,\r\n    eventBus: IEventBus,\r\n    memory: DistributedMemorySystem\r\n  ) {\r\n    super();\r\n    \r\n    this.logger = logger;\r\n    this.eventBus = eventBus;\r\n    this.memory = memory;\r\n    \r\n    this.config = {\r\n      metricsInterval: 5000,\r\n      batchSize: 100,\r\n      bufferSize: 1000,\r\n      validationTimeout: 30000,\r\n      maxValidationRetries: 3,\r\n      validationThreshold: 0.95,\r\n      scoringInterval: 60000,\r\n      performanceWindowSize: 1440, // 24 hours in minutes\r\n      trendAnalysisDepth: 168, // 1 week in hours\r\n      alertEnabled: true,\r\n      alertThresholds: {\r\n        accuracyThreshold: 0.95,\r\n        interventionRateThreshold: 0.10,\r\n        systemReliabilityThreshold: 0.98,\r\n        criticalErrorThreshold: 0.01,\r\n      },\r\n      dashboardEnabled: true,\r\n      exportInterval: 300000, // 5 minutes\r\n      exportFormat: 'json',\r\n      retentionPeriod: 2592000000, // 30 days\r\n      mcpIntegration: true,\r\n      persistenceEnabled: true,\r\n      realtimeEnabled: true,\r\n      debugMode: false,\r\n      ...config,\r\n    };\r\n    \r\n    this.initializeComponents();\r\n    this.initializeSystemMetrics();\r\n    this.setupEventListeners();\r\n  }\r\n  \r\n  private initializeComponents(): void {\r\n    this.metricsCollector = new TruthMetricsCollector(this.config, this.logger);\r\n    this.agentScorer = new AgentTruthScorer(this.config, this.logger);\r\n    this.systemTracker = new SystemTruthTracker(this.config, this.logger);\r\n    this.alertManager = new TruthAlertManager(this.config, this.logger, this.eventBus);\r\n    this.dashboardExporter = new DashboardExporter(this.config, this.logger);\r\n    this.automatedValidator = new AutomatedValidator(this.config, this.logger);\r\n  }\r\n  \r\n  private initializeSystemMetrics(): void {\r\n    this.systemMetrics = {\r\n      timestamp: new Date(),\r\n      overallAccuracy: 0.95,\r\n      humanInterventionRate: 0.05,\r\n      systemReliability: 0.98,\r\n      agentCount: 0,\r\n      activeAgents: 0,\r\n      totalTasks: 0,\r\n      verifiedTasks: 0,\r\n      criticalFailures: 0,\r\n      recoveryTime: 0,\r\n      efficiency: 0.85,\r\n      distributionMetrics: {\r\n        taskDistribution: {},\r\n        accuracyDistribution: {},\r\n        complexityDistribution: {},\r\n        errorTypeDistribution: {},\r\n      },\r\n    };\r\n  }\r\n  \r\n  private setupEventListeners(): void {\r\n    // Agent task events\r\n    this.eventBus.on('agent:task:started', (data) => {\r\n      this.handleTaskStarted(data);\r\n    });\r\n    \r\n    this.eventBus.on('agent:task:completed', (data) => {\r\n      this.handleTaskCompleted(data);\r\n    });\r\n    \r\n    this.eventBus.on('agent:task:failed', (data) => {\r\n      this.handleTaskFailed(data);\r\n    });\r\n    \r\n    // Validation events\r\n    this.eventBus.on('validation:completed', (data) => {\r\n      this.handleValidationCompleted(data);\r\n    });\r\n    \r\n    this.eventBus.on('validation:failed', (data) => {\r\n      this.handleValidationFailed(data);\r\n    });\r\n    \r\n    // Human intervention events\r\n    this.eventBus.on('human:intervention', (data) => {\r\n      this.handleHumanIntervention(data);\r\n    });\r\n    \r\n    // System events\r\n    this.eventBus.on('system:alert', (data) => {\r\n      this.handleSystemAlert(data);\r\n    });\r\n  }\r\n  \r\n  // ========================================================================================\r\n  // Lifecycle Management\r\n  // ========================================================================================\r\n  \r\n  async initialize(): Promise<void> {\r\n    this.logger.info('Initializing Truth Telemetry Engine', {\r\n      config: {\r\n        metricsInterval: this.config.metricsInterval,\r\n        alertEnabled: this.config.alertEnabled,\r\n        dashboardEnabled: this.config.dashboardEnabled,\r\n        mcpIntegration: this.config.mcpIntegration,\r\n      },\r\n    });\r\n    \r\n    // Initialize components\r\n    await this.metricsCollector.initialize();\r\n    await this.agentScorer.initialize();\r\n    await this.systemTracker.initialize();\r\n    await this.alertManager.initialize();\r\n    await this.dashboardExporter.initialize();\r\n    await this.automatedValidator.initialize();\r\n    \r\n    // Start collection intervals\r\n    this.startMetricsCollection();\r\n    this.startAgentScoring();\r\n    this.startAlertMonitoring();\r\n    \r\n    if (this.config.dashboardEnabled) {\r\n      this.startDashboardExport();\r\n    }\r\n    \r\n    // Load historical data if persistence is enabled\r\n    if (this.config.persistenceEnabled) {\r\n      await this.loadHistoricalData();\r\n    }\r\n    \r\n    this.emit('telemetry:initialized');\r\n    this.logger.info('Truth Telemetry Engine initialized successfully');\r\n  }\r\n  \r\n  async shutdown(): Promise<void> {\r\n    this.logger.info('Shutting down Truth Telemetry Engine');\r\n    \r\n    // Stop all intervals\r\n    if (this.collectionInterval) clearInterval(this.collectionInterval);\r\n    if (this.scoringInterval) clearInterval(this.scoringInterval);\r\n    if (this.alertInterval) clearInterval(this.alertInterval);\r\n    if (this.exportInterval) clearInterval(this.exportInterval);\r\n    \r\n    // Flush remaining data\r\n    await this.flushMetricsBuffer();\r\n    \r\n    // Persist current state\r\n    if (this.config.persistenceEnabled) {\r\n      await this.persistCurrentState();\r\n    }\r\n    \r\n    // Shutdown components\r\n    await this.metricsCollector.shutdown();\r\n    await this.agentScorer.shutdown();\r\n    await this.systemTracker.shutdown();\r\n    await this.alertManager.shutdown();\r\n    await this.dashboardExporter.shutdown();\r\n    await this.automatedValidator.shutdown();\r\n    \r\n    this.emit('telemetry:shutdown');\r\n    this.logger.info('Truth Telemetry Engine shutdown complete');\r\n  }\r\n  \r\n  // ========================================================================================\r\n  // Metrics Collection\r\n  // ========================================================================================\r\n  \r\n  private startMetricsCollection(): void {\r\n    this.collectionInterval = setInterval(() => {\r\n      this.collectMetrics();\r\n    }, this.config.metricsInterval);\r\n    \r\n    this.logger.info('Started metrics collection', {\r\n      interval: this.config.metricsInterval,\r\n    });\r\n  }\r\n  \r\n  private async collectMetrics(): Promise<void> {\r\n    try {\r\n      // Process metrics buffer\r\n      await this.processMetricsBuffer();\r\n      \r\n      // Update system metrics\r\n      await this.updateSystemMetrics();\r\n      \r\n      // Clean up old metrics\r\n      this.cleanupOldMetrics();\r\n      \r\n    } catch (error) {\r\n      this.logger.error('Error in metrics collection', error);\r\n    }\r\n  }\r\n  \r\n  private async processMetricsBuffer(): Promise<void> {\r\n    if (this.metricsBuffer.length === 0) return;\r\n    \r\n    const batch = this.metricsBuffer.splice(0, this.config.batchSize);\r\n    \r\n    for (const metric of batch) {\r\n      await this.processMetric(metric);\r\n    }\r\n  }\r\n  \r\n  private async processMetric(metric: TruthMetric): Promise<void> {\r\n    // Store metric\r\n    this.truthMetrics.set(metric.id, metric);\r\n    \r\n    // Update agent scores\r\n    await this.agentScorer.updateAgentMetric(metric);\r\n    \r\n    // Update system tracking\r\n    await this.systemTracker.updateSystemMetric(metric);\r\n    \r\n    // Check for alerts\r\n    if (this.config.alertEnabled) {\r\n      await this.alertManager.checkThresholds(metric);\r\n    }\r\n    \r\n    // Emit event for real-time processing\r\n    if (this.config.realtimeEnabled) {\r\n      this.emit('metric:processed', { metric });\r\n    }\r\n  }\r\n  \r\n  // ========================================================================================\r\n  // Agent Scoring\r\n  // ========================================================================================\r\n  \r\n  private startAgentScoring(): void {\r\n    this.scoringInterval = setInterval(() => {\r\n      this.updateAgentScores();\r\n    }, this.config.scoringInterval);\r\n    \r\n    this.logger.info('Started agent scoring', {\r\n      interval: this.config.scoringInterval,\r\n    });\r\n  }\r\n  \r\n  private async updateAgentScores(): Promise<void> {\r\n    try {\r\n      const agentIds = new Set([\r\n        ...this.agentScores.keys(),\r\n        ...Array.from(this.truthMetrics.values()).map(m => m.agentId),\r\n      ]);\r\n      \r\n      for (const agentId of agentIds) {\r\n        const score = await this.agentScorer.calculateAgentScore(agentId);\r\n        if (score) {\r\n          this.agentScores.set(agentId, score);\r\n          this.emit('agent:score:updated', { agentId, score });\r\n        }\r\n      }\r\n      \r\n    } catch (error) {\r\n      this.logger.error('Error updating agent scores', error);\r\n    }\r\n  }\r\n  \r\n  // ========================================================================================\r\n  // Alert Monitoring\r\n  // ========================================================================================\r\n  \r\n  private startAlertMonitoring(): void {\r\n    this.alertInterval = setInterval(() => {\r\n      this.processAlerts();\r\n    }, 10000); // Check every 10 seconds\r\n    \r\n    this.logger.info('Started alert monitoring');\r\n  }\r\n  \r\n  private async processAlerts(): Promise<void> {\r\n    try {\r\n      // Check system-wide thresholds\r\n      await this.checkSystemThresholds();\r\n      \r\n      // Process active alerts\r\n      await this.processActiveAlerts();\r\n      \r\n      // Clean up resolved alerts\r\n      this.cleanupResolvedAlerts();\r\n      \r\n    } catch (error) {\r\n      this.logger.error('Error processing alerts', error);\r\n    }\r\n  }\r\n  \r\n  private async checkSystemThresholds(): Promise<void> {\r\n    const thresholds = this.config.alertThresholds;\r\n    \r\n    // Check accuracy threshold\r\n    if (this.systemMetrics.overallAccuracy < thresholds.accuracyThreshold) {\r\n      await this.createAlert({\r\n        type: 'accuracy_degradation',\r\n        severity: 'critical',\r\n        message: `System accuracy (${this.systemMetrics.overallAccuracy.toFixed(3)}) below threshold (${thresholds.accuracyThreshold})`,\r\n        context: { accuracy: this.systemMetrics.overallAccuracy },\r\n      });\r\n    }\r\n    \r\n    // Check intervention rate threshold\r\n    if (this.systemMetrics.humanInterventionRate > thresholds.interventionRateThreshold) {\r\n      await this.createAlert({\r\n        type: 'high_intervention_rate',\r\n        severity: 'warning',\r\n        message: `Human intervention rate (${this.systemMetrics.humanInterventionRate.toFixed(3)}) above threshold (${thresholds.interventionRateThreshold})`,\r\n        context: { interventionRate: this.systemMetrics.humanInterventionRate },\r\n      });\r\n    }\r\n    \r\n    // Check system reliability\r\n    if (this.systemMetrics.systemReliability < thresholds.systemReliabilityThreshold) {\r\n      await this.createAlert({\r\n        type: 'system_failure',\r\n        severity: 'critical',\r\n        message: `System reliability (${this.systemMetrics.systemReliability.toFixed(3)}) below threshold (${thresholds.systemReliabilityThreshold})`,\r\n        context: { reliability: this.systemMetrics.systemReliability },\r\n      });\r\n    }\r\n  }\r\n  \r\n  private async createAlert(alertData: Partial<TruthAlert>): Promise<string> {\r\n    const alertId = `alert-${Date.now()}-${Math.random().toString(36).slice(2)}`;\r\n    \r\n    const alert: TruthAlert = {\r\n      id: alertId,\r\n      timestamp: new Date(),\r\n      severity: alertData.severity || 'warning',\r\n      type: alertData.type || 'threshold_violation',\r\n      message: alertData.message || 'Unknown alert',\r\n      source: 'truth-telemetry',\r\n      context: alertData.context || {},\r\n      thresholds: [],\r\n      actions: [],\r\n      escalationPath: [],\r\n      resolved: false,\r\n      ...alertData,\r\n    };\r\n    \r\n    this.activeAlerts.set(alertId, alert);\r\n    \r\n    this.logger.warn('Truth telemetry alert created', {\r\n      alertId,\r\n      type: alert.type,\r\n      severity: alert.severity,\r\n      message: alert.message,\r\n    });\r\n    \r\n    this.emit('alert:created', { alert });\r\n    \r\n    // Execute alert actions\r\n    await this.alertManager.executeAlertActions(alert);\r\n    \r\n    return alertId;\r\n  }\r\n  \r\n  // ========================================================================================\r\n  // Dashboard Export\r\n  // ========================================================================================\r\n  \r\n  private startDashboardExport(): void {\r\n    this.exportInterval = setInterval(() => {\r\n      this.exportDashboardData();\r\n    }, this.config.exportInterval);\r\n    \r\n    this.logger.info('Started dashboard export', {\r\n      interval: this.config.exportInterval,\r\n    });\r\n  }\r\n  \r\n  private async exportDashboardData(): Promise<void> {\r\n    try {\r\n      const dashboardData = await this.generateDashboardData();\r\n      \r\n      // Emit for real-time updates\r\n      this.emit('dashboard:updated', { data: dashboardData });\r\n      \r\n      // Persist if enabled\r\n      if (this.config.persistenceEnabled) {\r\n        await this.persistDashboardData(dashboardData);\r\n      }\r\n      \r\n    } catch (error) {\r\n      this.logger.error('Error exporting dashboard data', error);\r\n    }\r\n  }\r\n  \r\n  private async generateDashboardData(): Promise<DashboardData> {\r\n    return this.dashboardExporter.generateDashboard({\r\n      systemMetrics: this.systemMetrics,\r\n      agentScores: Array.from(this.agentScores.values()),\r\n      truthMetrics: Array.from(this.truthMetrics.values()),\r\n      activeAlerts: Array.from(this.activeAlerts.values()),\r\n    });\r\n  }\r\n  \r\n  // ========================================================================================\r\n  // Event Handlers\r\n  // ========================================================================================\r\n  \r\n  private async handleTaskStarted(data: any): Promise<void> {\r\n    const metric = await this.metricsCollector.createTaskMetric({\r\n      agentId: data.agentId,\r\n      taskId: data.taskId,\r\n      metricType: 'efficiency',\r\n      context: {\r\n        taskType: data.taskType,\r\n        complexity: data.complexity || 'medium',\r\n        domain: data.domain || 'general',\r\n        dependencies: data.dependencies || [],\r\n        inputSources: data.inputSources || [],\r\n        outputTargets: data.outputTargets || [],\r\n        verificationMethod: 'automated',\r\n        riskLevel: data.riskLevel || 'medium',\r\n      },\r\n    });\r\n    \r\n    this.metricsBuffer.push(metric);\r\n  }\r\n  \r\n  private async handleTaskCompleted(data: any): Promise<void> {\r\n    // Validate the completed task\r\n    const validation = await this.automatedValidator.validateTask(data);\r\n    \r\n    const metric = await this.metricsCollector.createTaskMetric({\r\n      agentId: data.agentId,\r\n      taskId: data.taskId,\r\n      metricType: 'accuracy',\r\n      value: validation.score,\r\n      confidence: data.confidence || 0.8,\r\n      validation,\r\n      context: {\r\n        taskType: data.taskType,\r\n        complexity: data.complexity || 'medium',\r\n        domain: data.domain || 'general',\r\n        dependencies: data.dependencies || [],\r\n        inputSources: data.inputSources || [],\r\n        outputTargets: data.outputTargets || [],\r\n        verificationMethod: validation.humanReview ? 'hybrid' : 'automated',\r\n        riskLevel: this.assessRiskLevel(validation),\r\n      },\r\n    });\r\n    \r\n    this.metricsBuffer.push(metric);\r\n  }\r\n  \r\n  private async handleTaskFailed(data: any): Promise<void> {\r\n    const metric = await this.metricsCollector.createTaskMetric({\r\n      agentId: data.agentId,\r\n      taskId: data.taskId,\r\n      metricType: 'reliability',\r\n      value: 0,\r\n      confidence: 1.0,\r\n      validation: {\r\n        isValid: false,\r\n        validationType: 'functional',\r\n        score: 0,\r\n        errors: [{\r\n          type: data.errorType || 'unknown',\r\n          severity: 'high',\r\n          message: data.error || 'Task failed',\r\n          impact: 1.0,\r\n        }],\r\n        warnings: [],\r\n        suggestions: [],\r\n        automatedChecks: [],\r\n      },\r\n      context: {\r\n        taskType: data.taskType,\r\n        complexity: data.complexity || 'medium',\r\n        domain: data.domain || 'general',\r\n        dependencies: data.dependencies || [],\r\n        inputSources: data.inputSources || [],\r\n        outputTargets: data.outputTargets || [],\r\n        verificationMethod: 'automated',\r\n        riskLevel: 'high',\r\n      },\r\n    });\r\n    \r\n    this.metricsBuffer.push(metric);\r\n  }\r\n  \r\n  private async handleValidationCompleted(data: any): Promise<void> {\r\n    // Update existing metric with validation results\r\n    const existingMetric = this.truthMetrics.get(data.taskId);\r\n    if (existingMetric) {\r\n      existingMetric.validation = data.validation;\r\n      existingMetric.value = data.validation.score;\r\n      await this.processMetric(existingMetric);\r\n    }\r\n  }\r\n  \r\n  private async handleValidationFailed(data: any): Promise<void> {\r\n    this.logger.warn('Validation failed', { taskId: data.taskId, error: data.error });\r\n    \r\n    // Create alert for validation failure\r\n    await this.createAlert({\r\n      type: 'threshold_violation',\r\n      severity: 'warning',\r\n      message: `Validation failed for task ${data.taskId}: ${data.error}`,\r\n      context: { taskId: data.taskId, error: data.error },\r\n    });\r\n  }\r\n  \r\n  private async handleHumanIntervention(data: any): Promise<void> {\r\n    // Update intervention rate\r\n    this.systemMetrics.humanInterventionRate = \r\n      this.calculateHumanInterventionRate();\r\n    \r\n    // Create metric for human intervention\r\n    const metric = await this.metricsCollector.createTaskMetric({\r\n      agentId: data.agentId,\r\n      taskId: data.taskId,\r\n      metricType: 'consistency',\r\n      value: 0.5, // Human intervention suggests agent uncertainty\r\n      confidence: 1.0,\r\n      validation: {\r\n        isValid: true,\r\n        validationType: 'semantic',\r\n        score: data.humanReview?.score || 0.8,\r\n        errors: [],\r\n        warnings: [],\r\n        suggestions: [],\r\n        automatedChecks: [],\r\n        humanReview: data.humanReview,\r\n      },\r\n      context: {\r\n        taskType: data.taskType,\r\n        complexity: 'high', // Usually requires intervention for complex tasks\r\n        domain: data.domain || 'general',\r\n        dependencies: data.dependencies || [],\r\n        inputSources: data.inputSources || [],\r\n        outputTargets: data.outputTargets || [],\r\n        verificationMethod: 'human',\r\n        riskLevel: 'medium',\r\n      },\r\n    });\r\n    \r\n    this.metricsBuffer.push(metric);\r\n  }\r\n  \r\n  private async handleSystemAlert(data: any): Promise<void> {\r\n    await this.createAlert({\r\n      type: data.type || 'system_failure',\r\n      severity: data.severity || 'warning',\r\n      message: data.message,\r\n      context: data.context || {},\r\n    });\r\n  }\r\n  \r\n  // ========================================================================================\r\n  // Utility Methods\r\n  // ========================================================================================\r\n  \r\n  private assessRiskLevel(validation: ValidationResult): 'low' | 'medium' | 'high' | 'critical' {\r\n    const criticalErrors = validation.errors.filter(e => e.severity === 'critical');\r\n    const highErrors = validation.errors.filter(e => e.severity === 'high');\r\n    \r\n    if (criticalErrors.length > 0) return 'critical';\r\n    if (highErrors.length > 0 || validation.score < 0.7) return 'high';\r\n    if (validation.score < 0.9) return 'medium';\r\n    return 'low';\r\n  }\r\n  \r\n  private calculateHumanInterventionRate(): number {\r\n    const recentMetrics = Array.from(this.truthMetrics.values())\r\n      .filter(m => m.timestamp > new Date(Date.now() - 3600000)) // Last hour\r\n      .filter(m => m.context.verificationMethod === 'human' || m.context.verificationMethod === 'hybrid');\r\n    \r\n    const totalMetrics = Array.from(this.truthMetrics.values())\r\n      .filter(m => m.timestamp > new Date(Date.now() - 3600000));\r\n    \r\n    return totalMetrics.length > 0 ? recentMetrics.length / totalMetrics.length : 0;\r\n  }\r\n  \r\n  private async updateSystemMetrics(): Promise<void> {\r\n    const allMetrics = Array.from(this.truthMetrics.values());\r\n    const recentMetrics = allMetrics.filter(\r\n      m => m.timestamp > new Date(Date.now() - 3600000) // Last hour\r\n    );\r\n    \r\n    if (recentMetrics.length > 0) {\r\n      this.systemMetrics = {\r\n        ...this.systemMetrics,\r\n        timestamp: new Date(),\r\n        overallAccuracy: recentMetrics.reduce((sum, m) => sum + m.value, 0) / recentMetrics.length,\r\n        humanInterventionRate: this.calculateHumanInterventionRate(),\r\n        totalTasks: allMetrics.length,\r\n        verifiedTasks: allMetrics.filter(m => m.validation.isValid).length,\r\n        agentCount: new Set(allMetrics.map(m => m.agentId)).size,\r\n        activeAgents: new Set(recentMetrics.map(m => m.agentId)).size,\r\n      };\r\n    }\r\n  }\r\n  \r\n  private cleanupOldMetrics(): void {\r\n    const cutoff = new Date(Date.now() - this.config.retentionPeriod);\r\n    \r\n    for (const [id, metric] of this.truthMetrics) {\r\n      if (metric.timestamp < cutoff) {\r\n        this.truthMetrics.delete(id);\r\n      }\r\n    }\r\n  }\r\n  \r\n  private async processActiveAlerts(): Promise<void> {\r\n    for (const [alertId, alert] of this.activeAlerts) {\r\n      if (!alert.resolved) {\r\n        // Check if alert should be escalated\r\n        await this.alertManager.processAlert(alert);\r\n      }\r\n    }\r\n  }\r\n  \r\n  private cleanupResolvedAlerts(): void {\r\n    const cutoff = new Date(Date.now() - 86400000); // 24 hours\r\n    \r\n    for (const [alertId, alert] of this.activeAlerts) {\r\n      if (alert.resolved && alert.resolvedAt && alert.resolvedAt < cutoff) {\r\n        this.activeAlerts.delete(alertId);\r\n      }\r\n    }\r\n  }\r\n  \r\n  private async flushMetricsBuffer(): Promise<void> {\r\n    while (this.metricsBuffer.length > 0) {\r\n      await this.processMetricsBuffer();\r\n    }\r\n  }\r\n  \r\n  private async persistCurrentState(): Promise<void> {\r\n    if (!this.config.mcpIntegration) return;\r\n    \r\n    try {\r\n      const state = {\r\n        timestamp: new Date(),\r\n        systemMetrics: this.systemMetrics,\r\n        agentScores: Array.from(this.agentScores.entries()),\r\n        activeAlerts: Array.from(this.activeAlerts.entries()),\r\n        config: this.config,\r\n      };\r\n      \r\n      await this.memory.store('truth-telemetry:state', state, {\r\n        type: 'truth-telemetry-state',\r\n        partition: 'verification',\r\n      });\r\n      \r\n    } catch (error) {\r\n      this.logger.error('Failed to persist telemetry state', error);\r\n    }\r\n  }\r\n  \r\n  private async loadHistoricalData(): Promise<void> {\r\n    if (!this.config.mcpIntegration) return;\r\n    \r\n    try {\r\n      const state = await this.memory.retrieve('truth-telemetry:state');\r\n      \r\n      if (state && state.data) {\r\n        this.systemMetrics = state.data.systemMetrics || this.systemMetrics;\r\n        \r\n        if (state.data.agentScores) {\r\n          this.agentScores = new Map(state.data.agentScores);\r\n        }\r\n        \r\n        if (state.data.activeAlerts) {\r\n          this.activeAlerts = new Map(state.data.activeAlerts);\r\n        }\r\n        \r\n        this.logger.info('Loaded historical telemetry data');\r\n      }\r\n      \r\n    } catch (error) {\r\n      this.logger.warn('Failed to load historical data', error);\r\n    }\r\n  }\r\n  \r\n  private async persistDashboardData(data: DashboardData): Promise<void> {\r\n    if (!this.config.mcpIntegration) return;\r\n    \r\n    try {\r\n      await this.memory.store('truth-telemetry:dashboard', data, {\r\n        type: 'dashboard-data',\r\n        partition: 'verification',\r\n      });\r\n      \r\n    } catch (error) {\r\n      this.logger.error('Failed to persist dashboard data', error);\r\n    }\r\n  }\r\n  \r\n  // ========================================================================================\r\n  // Public API\r\n  // ========================================================================================\r\n  \r\n  async recordTruthMetric(metric: Omit<TruthMetric, 'id' | 'timestamp'>): Promise<string> {\r\n    const fullMetric: TruthMetric = {\r\n      id: `metric-${Date.now()}-${Math.random().toString(36).slice(2)}`,\r\n      timestamp: new Date(),\r\n      ...metric,\r\n    };\r\n    \r\n    this.metricsBuffer.push(fullMetric);\r\n    \r\n    if (this.config.realtimeEnabled) {\r\n      this.emit('metric:recorded', { metric: fullMetric });\r\n    }\r\n    \r\n    return fullMetric.id;\r\n  }\r\n  \r\n  getSystemMetrics(): SystemTruthMetrics {\r\n    return { ...this.systemMetrics };\r\n  }\r\n  \r\n  getAgentScore(agentId: string): AgentTruthScore | undefined {\r\n    return this.agentScores.get(agentId);\r\n  }\r\n  \r\n  getAllAgentScores(): AgentTruthScore[] {\r\n    return Array.from(this.agentScores.values());\r\n  }\r\n  \r\n  getActiveAlerts(): TruthAlert[] {\r\n    return Array.from(this.activeAlerts.values()).filter(a => !a.resolved);\r\n  }\r\n  \r\n  async resolveAlert(alertId: string, resolvedBy: string): Promise<boolean> {\r\n    const alert = this.activeAlerts.get(alertId);\r\n    if (!alert) return false;\r\n    \r\n    alert.resolved = true;\r\n    alert.resolvedAt = new Date();\r\n    alert.resolvedBy = resolvedBy;\r\n    \r\n    this.emit('alert:resolved', { alert, resolvedBy });\r\n    \r\n    return true;\r\n  }\r\n  \r\n  async getDashboardData(): Promise<DashboardData> {\r\n    return this.generateDashboardData();\r\n  }\r\n  \r\n  getMetrics(filters?: {\r\n    agentId?: string;\r\n    taskId?: string;\r\n    metricType?: TruthMetricType;\r\n    startTime?: Date;\r\n    endTime?: Date;\r\n  }): TruthMetric[] {\r\n    let metrics = Array.from(this.truthMetrics.values());\r\n    \r\n    if (filters) {\r\n      if (filters.agentId) {\r\n        metrics = metrics.filter(m => m.agentId === filters.agentId);\r\n      }\r\n      if (filters.taskId) {\r\n        metrics = metrics.filter(m => m.taskId === filters.taskId);\r\n      }\r\n      if (filters.metricType) {\r\n        metrics = metrics.filter(m => m.metricType === filters.metricType);\r\n      }\r\n      if (filters.startTime) {\r\n        metrics = metrics.filter(m => m.timestamp >= filters.startTime!);\r\n      }\r\n      if (filters.endTime) {\r\n        metrics = metrics.filter(m => m.timestamp <= filters.endTime!);\r\n      }\r\n    }\r\n    \r\n    return metrics;\r\n  }\r\n  \r\n  getTelemetryStatistics(): {\r\n    totalMetrics: number;\r\n    activeAlerts: number;\r\n    agentsTracked: number;\r\n    systemHealth: number;\r\n    lastUpdate: Date;\r\n  } {\r\n    return {\r\n      totalMetrics: this.truthMetrics.size,\r\n      activeAlerts: Array.from(this.activeAlerts.values()).filter(a => !a.resolved).length,\r\n      agentsTracked: this.agentScores.size,\r\n      systemHealth: this.systemMetrics.overallAccuracy * this.systemMetrics.systemReliability,\r\n      lastUpdate: this.systemMetrics.timestamp,\r\n    };\r\n  }\r\n}\r\n\r\n// ========================================================================================\r\n// Supporting Classes (Interfaces for now - implementation in separate files)\r\n// ========================================================================================\r\n\r\nexport class TruthMetricsCollector {\r\n  constructor(\r\n    private config: TruthTelemetryConfig,\r\n    private logger: ILogger\r\n  ) {}\r\n  \r\n  async initialize(): Promise<void> {\r\n    this.logger.info('TruthMetricsCollector initialized');\r\n  }\r\n  \r\n  async shutdown(): Promise<void> {\r\n    this.logger.info('TruthMetricsCollector shutdown');\r\n  }\r\n  \r\n  async createTaskMetric(data: Partial<TruthMetric>): Promise<TruthMetric> {\r\n    return {\r\n      id: `metric-${Date.now()}-${Math.random().toString(36).slice(2)}`,\r\n      timestamp: new Date(),\r\n      agentId: data.agentId || 'unknown',\r\n      taskId: data.taskId || 'unknown',\r\n      metricType: data.metricType || 'accuracy',\r\n      value: data.value || 0,\r\n      confidence: data.confidence || 0.5,\r\n      context: data.context || {\r\n        taskType: 'unknown',\r\n        complexity: 'medium',\r\n        domain: 'general',\r\n        dependencies: [],\r\n        inputSources: [],\r\n        outputTargets: [],\r\n        verificationMethod: 'automated',\r\n        riskLevel: 'medium',\r\n      },\r\n      validation: data.validation || {\r\n        isValid: false,\r\n        validationType: 'functional',\r\n        score: 0,\r\n        errors: [],\r\n        warnings: [],\r\n        suggestions: [],\r\n        automatedChecks: [],\r\n      },\r\n      metadata: data.metadata || {},\r\n    };\r\n  }\r\n}\r\n\r\nexport class AgentTruthScorer {\r\n  constructor(\r\n    private config: TruthTelemetryConfig,\r\n    private logger: ILogger\r\n  ) {}\r\n  \r\n  async initialize(): Promise<void> {\r\n    this.logger.info('AgentTruthScorer initialized');\r\n  }\r\n  \r\n  async shutdown(): Promise<void> {\r\n    this.logger.info('AgentTruthScorer shutdown');\r\n  }\r\n  \r\n  async updateAgentMetric(metric: TruthMetric): Promise<void> {\r\n    // Implementation would update agent-specific metrics\r\n  }\r\n  \r\n  async calculateAgentScore(agentId: string): Promise<AgentTruthScore | null> {\r\n    // Implementation would calculate comprehensive agent score\r\n    return {\r\n      agentId,\r\n      timestamp: new Date(),\r\n      overallScore: 0.85,\r\n      components: {\r\n        accuracy: 0.90,\r\n        reliability: 0.85,\r\n        consistency: 0.88,\r\n        efficiency: 0.82,\r\n        adaptability: 0.80,\r\n      },\r\n      recentPerformance: [],\r\n      trends: [],\r\n      benchmarks: [],\r\n      riskAssessment: {\r\n        level: 'low',\r\n        factors: [],\r\n        recommendations: [],\r\n        mitigationStrategies: [],\r\n      },\r\n    };\r\n  }\r\n}\r\n\r\nexport class SystemTruthTracker {\r\n  constructor(\r\n    private config: TruthTelemetryConfig,\r\n    private logger: ILogger\r\n  ) {}\r\n  \r\n  async initialize(): Promise<void> {\r\n    this.logger.info('SystemTruthTracker initialized');\r\n  }\r\n  \r\n  async shutdown(): Promise<void> {\r\n    this.logger.info('SystemTruthTracker shutdown');\r\n  }\r\n  \r\n  async updateSystemMetric(metric: TruthMetric): Promise<void> {\r\n    // Implementation would update system-wide metrics\r\n  }\r\n}\r\n\r\nexport class TruthAlertManager {\r\n  constructor(\r\n    private config: TruthTelemetryConfig,\r\n    private logger: ILogger,\r\n    private eventBus: IEventBus\r\n  ) {}\r\n  \r\n  async initialize(): Promise<void> {\r\n    this.logger.info('TruthAlertManager initialized');\r\n  }\r\n  \r\n  async shutdown(): Promise<void> {\r\n    this.logger.info('TruthAlertManager shutdown');\r\n  }\r\n  \r\n  async checkThresholds(metric: TruthMetric): Promise<void> {\r\n    // Implementation would check metric against thresholds\r\n  }\r\n  \r\n  async executeAlertActions(alert: TruthAlert): Promise<void> {\r\n    // Implementation would execute configured alert actions\r\n  }\r\n  \r\n  async processAlert(alert: TruthAlert): Promise<void> {\r\n    // Implementation would process escalation and resolution\r\n  }\r\n}\r\n\r\nexport class DashboardExporter {\r\n  constructor(\r\n    private config: TruthTelemetryConfig,\r\n    private logger: ILogger\r\n  ) {}\r\n  \r\n  async initialize(): Promise<void> {\r\n    this.logger.info('DashboardExporter initialized');\r\n  }\r\n  \r\n  async shutdown(): Promise<void> {\r\n    this.logger.info('DashboardExporter shutdown');\r\n  }\r\n  \r\n  async generateDashboard(data: {\r\n    systemMetrics: SystemTruthMetrics;\r\n    agentScores: AgentTruthScore[];\r\n    truthMetrics: TruthMetric[];\r\n    activeAlerts: TruthAlert[];\r\n  }): Promise<DashboardData> {\r\n    // Implementation would generate comprehensive dashboard\r\n    return {\r\n      timestamp: new Date(),\r\n      summary: {\r\n        overallHealth: 0.95,\r\n        truthAccuracy: data.systemMetrics.overallAccuracy,\r\n        humanInterventionRate: data.systemMetrics.humanInterventionRate,\r\n        systemEfficiency: data.systemMetrics.efficiency,\r\n        alertCount: data.activeAlerts.length,\r\n      },\r\n      charts: {\r\n        accuracyTrend: [],\r\n        interventionTrend: [],\r\n        agentPerformance: [],\r\n        errorDistribution: [],\r\n        systemLoad: [],\r\n      },\r\n      tables: {\r\n        topPerformers: [],\r\n        recentAlerts: data.activeAlerts.slice(-10),\r\n        criticalIssues: [],\r\n      },\r\n      insights: [],\r\n    };\r\n  }\r\n}\r\n\r\nexport class AutomatedValidator {\r\n  constructor(\r\n    private config: TruthTelemetryConfig,\r\n    private logger: ILogger\r\n  ) {}\r\n  \r\n  async initialize(): Promise<void> {\r\n    this.logger.info('AutomatedValidator initialized');\r\n  }\r\n  \r\n  async shutdown(): Promise<void> {\r\n    this.logger.info('AutomatedValidator shutdown');\r\n  }\r\n  \r\n  async validateTask(taskData: any): Promise<ValidationResult> {\r\n    // Implementation would perform comprehensive validation\r\n    return {\r\n      isValid: true,\r\n      validationType: 'functional',\r\n      score: 0.9,\r\n      errors: [],\r\n      warnings: [],\r\n      suggestions: [],\r\n      automatedChecks: [\r\n        {\r\n          name: 'syntax_check',\r\n          type: 'static',\r\n          status: 'passed',\r\n          details: {},\r\n          executionTime: 150,\r\n        },\r\n      ],\r\n    };\r\n  }\r\n}\r\n\r\nexport default TruthTelemetryEngine;"],"names":["EventEmitter","TruthTelemetryEngine","config","logger","eventBus","memory","metricsCollector","agentScorer","systemTracker","alertManager","dashboardExporter","automatedValidator","truthMetrics","Map","agentScores","systemMetrics","activeAlerts","metricsBuffer","collectionInterval","scoringInterval","alertInterval","exportInterval","metricsInterval","batchSize","bufferSize","validationTimeout","maxValidationRetries","validationThreshold","performanceWindowSize","trendAnalysisDepth","alertEnabled","alertThresholds","accuracyThreshold","interventionRateThreshold","systemReliabilityThreshold","criticalErrorThreshold","dashboardEnabled","exportFormat","retentionPeriod","mcpIntegration","persistenceEnabled","realtimeEnabled","debugMode","initializeComponents","initializeSystemMetrics","setupEventListeners","TruthMetricsCollector","AgentTruthScorer","SystemTruthTracker","TruthAlertManager","DashboardExporter","AutomatedValidator","timestamp","Date","overallAccuracy","humanInterventionRate","systemReliability","agentCount","activeAgents","totalTasks","verifiedTasks","criticalFailures","recoveryTime","efficiency","distributionMetrics","taskDistribution","accuracyDistribution","complexityDistribution","errorTypeDistribution","on","data","handleTaskStarted","handleTaskCompleted","handleTaskFailed","handleValidationCompleted","handleValidationFailed","handleHumanIntervention","handleSystemAlert","initialize","info","startMetricsCollection","startAgentScoring","startAlertMonitoring","startDashboardExport","loadHistoricalData","emit","shutdown","clearInterval","flushMetricsBuffer","persistCurrentState","setInterval","collectMetrics","interval","processMetricsBuffer","updateSystemMetrics","cleanupOldMetrics","error","length","batch","splice","metric","processMetric","set","id","updateAgentMetric","updateSystemMetric","checkThresholds","updateAgentScores","agentIds","Set","keys","Array","from","values","map","m","agentId","score","calculateAgentScore","processAlerts","checkSystemThresholds","processActiveAlerts","cleanupResolvedAlerts","thresholds","createAlert","type","severity","message","toFixed","context","accuracy","interventionRate","reliability","alertData","alertId","now","Math","random","toString","slice","alert","source","actions","escalationPath","resolved","warn","executeAlertActions","exportDashboardData","dashboardData","generateDashboardData","persistDashboardData","generateDashboard","createTaskMetric","taskId","metricType","taskType","complexity","domain","dependencies","inputSources","outputTargets","verificationMethod","riskLevel","push","validation","validateTask","value","confidence","humanReview","assessRiskLevel","isValid","validationType","errors","errorType","impact","warnings","suggestions","automatedChecks","existingMetric","get","calculateHumanInterventionRate","criticalErrors","filter","e","highErrors","recentMetrics","totalMetrics","allMetrics","reduce","sum","size","cutoff","delete","processAlert","resolvedAt","state","entries","store","partition","retrieve","recordTruthMetric","fullMetric","getSystemMetrics","getAgentScore","getAllAgentScores","getActiveAlerts","a","resolveAlert","resolvedBy","getDashboardData","getMetrics","filters","metrics","startTime","endTime","getTelemetryStatistics","agentsTracked","systemHealth","lastUpdate","metadata","overallScore","components","consistency","adaptability","recentPerformance","trends","benchmarks","riskAssessment","level","factors","recommendations","mitigationStrategies","summary","overallHealth","truthAccuracy","systemEfficiency","alertCount","charts","accuracyTrend","interventionTrend","agentPerformance","errorDistribution","systemLoad","tables","topPerformers","recentAlerts","criticalIssues","insights","taskData","name","status","details","executionTime"],"mappings":"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"}