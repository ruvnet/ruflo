{"version":3,"sources":["../../../../src/cli/simple-commands/stream-chain-real.js"],"sourcesContent":["#!/usr/bin/env node\r\n/**\r\n * Stream Chain Command - Real Claude CLI stream-json chaining\r\n * Based on docs/stream-chaining.md specification\r\n */\r\n\r\nimport { spawn, execSync } from 'child_process';\r\nimport { Readable, PassThrough } from 'stream';\r\n\r\n/**\r\n * Check if claude CLI is available\r\n */\r\nfunction checkClaudeAvailable() {\r\n  try {\r\n    execSync('which claude', { stdio: 'ignore' });\r\n    return true;\r\n  } catch {\r\n    return false;\r\n  }\r\n}\r\n\r\n/**\r\n * Execute a chain of Claude instances with proper stream-json piping\r\n */\r\nasync function executeStreamChain(prompts, flags = {}) {\r\n  if (!checkClaudeAvailable()) {\r\n    console.error('‚ùå Error: Claude CLI is required for stream chaining');\r\n    console.log('   Install: npm install -g @anthropic-ai/claude-cli');\r\n    console.log('   Or use Claude Code: https://docs.anthropic.com/claude/docs/claude-cli');\r\n    return;\r\n  }\r\n\r\n  console.log('üîó Starting Real Stream Chain');\r\n  console.log('‚îÅ'.repeat(50));\r\n  console.log(`üìù Chain length: ${prompts.length} steps`);\r\n  console.log('');\r\n\r\n  const results = [];\r\n  let previousOutput = null;\r\n  \r\n  for (let i = 0; i < prompts.length; i++) {\r\n    const prompt = prompts[i];\r\n    const isFirst = i === 0;\r\n    const isLast = i === prompts.length - 1;\r\n    \r\n    console.log(`\\nüîÑ Step ${i + 1}/${prompts.length}: ${prompt.slice(0, 50)}...`);\r\n    \r\n    try {\r\n      const result = await executeSingleStep(\r\n        prompt, \r\n        previousOutput, \r\n        isFirst, \r\n        isLast, \r\n        flags\r\n      );\r\n      \r\n      results.push({\r\n        step: i + 1,\r\n        prompt: prompt.slice(0, 50),\r\n        success: result.success,\r\n        duration: result.duration\r\n      });\r\n      \r\n      if (!result.success) {\r\n        console.error(`‚ùå Step ${i + 1} failed`);\r\n        break;\r\n      }\r\n      \r\n      console.log(`‚úÖ Step ${i + 1} completed (${result.duration}ms)`);\r\n      \r\n      // Store output for next step (only if not last)\r\n      if (!isLast) {\r\n        previousOutput = result.output;\r\n      }\r\n      \r\n      // Show verbose output if requested\r\n      if (flags.verbose && result.output) {\r\n        const preview = result.output.slice(0, 200);\r\n        console.log(`   Output preview: ${preview}...`);\r\n      }\r\n      \r\n    } catch (error) {\r\n      console.error(`‚ùå Step ${i + 1} error:`, error.message);\r\n      results.push({\r\n        step: i + 1,\r\n        prompt: prompt.slice(0, 50),\r\n        success: false,\r\n        duration: 0\r\n      });\r\n      break;\r\n    }\r\n  }\r\n  \r\n  // Summary\r\n  console.log('\\n' + '‚ïê'.repeat(50));\r\n  console.log('üìä Stream Chain Summary');\r\n  console.log('‚ïê'.repeat(50));\r\n  \r\n  for (const result of results) {\r\n    const status = result.success ? '‚úÖ' : '‚ùå';\r\n    console.log(`${status} Step ${result.step}: ${result.prompt}... (${result.duration}ms)`);\r\n  }\r\n  \r\n  const totalTime = results.reduce((sum, r) => sum + r.duration, 0);\r\n  const successCount = results.filter(r => r.success).length;\r\n  \r\n  console.log(`\\n‚è±Ô∏è  Total execution time: ${totalTime}ms`);\r\n  console.log(`üìà Success rate: ${successCount}/${results.length} steps`);\r\n}\r\n\r\n/**\r\n * Execute a single step in the chain\r\n */\r\nasync function executeSingleStep(prompt, inputStream, isFirst, isLast, flags) {\r\n  return new Promise((resolve, reject) => {\r\n    const startTime = Date.now();\r\n    const timeout = (flags.timeout || 30) * 1000;\r\n    \r\n    // Build args based on position in chain\r\n    const args = ['-p'];\r\n    \r\n    // First step: only output stream-json\r\n    // Middle steps: both input and output stream-json\r\n    // Last step: only input stream-json (if not first)\r\n    \r\n    if (!isFirst && inputStream) {\r\n      args.push('--input-format', 'stream-json');\r\n    }\r\n    \r\n    if (!isLast) {\r\n      args.push('--output-format', 'stream-json');\r\n      if (flags.verbose) {\r\n        args.push('--verbose');\r\n      }\r\n    }\r\n    \r\n    args.push(prompt);\r\n    \r\n    console.log(`   Executing: claude ${args.join(' ')}`);\r\n    \r\n    // Spawn the Claude process\r\n    const claudeProcess = spawn('claude', args, {\r\n      stdio: ['pipe', 'pipe', 'pipe'],\r\n      env: process.env\r\n    });\r\n    \r\n    let output = '';\r\n    let stderr = '';\r\n    let processCompleted = false;\r\n    \r\n    // If we have input from previous step, pipe it\r\n    if (!isFirst && inputStream) {\r\n      console.log('   üîó Piping input from previous step...');\r\n      \r\n      // Create a readable stream from the input string\r\n      const inputReadable = Readable.from(inputStream);\r\n      inputReadable.pipe(claudeProcess.stdin);\r\n      \r\n      // Handle pipe errors\r\n      inputReadable.on('error', (error) => {\r\n        console.error('   Input pipe error:', error.message);\r\n      });\r\n    } else {\r\n      // Close stdin if no input\r\n      claudeProcess.stdin.end();\r\n    }\r\n    \r\n    // Capture output\r\n    claudeProcess.stdout.on('data', (data) => {\r\n      output += data.toString();\r\n      \r\n      // Show progress dots in verbose mode\r\n      if (flags.verbose && !processCompleted) {\r\n        process.stdout.write('.');\r\n      }\r\n    });\r\n    \r\n    // Capture errors\r\n    claudeProcess.stderr.on('data', (data) => {\r\n      stderr += data.toString();\r\n    });\r\n    \r\n    // Handle process completion\r\n    claudeProcess.on('close', (code) => {\r\n      if (processCompleted) return;\r\n      processCompleted = true;\r\n      \r\n      const duration = Date.now() - startTime;\r\n      \r\n      if (flags.verbose) {\r\n        console.log(''); // New line after progress dots\r\n      }\r\n      \r\n      if (code !== 0) {\r\n        console.error(`   Process exited with code ${code}`);\r\n        if (stderr) {\r\n          console.error(`   stderr: ${stderr.slice(0, 200)}`);\r\n        }\r\n        \r\n        resolve({\r\n          success: false,\r\n          duration,\r\n          output: null,\r\n          error: stderr || `Process exited with code ${code}`\r\n        });\r\n        return;\r\n      }\r\n      \r\n      resolve({\r\n        success: true,\r\n        duration,\r\n        output: output.trim(),\r\n        error: null\r\n      });\r\n    });\r\n    \r\n    // Handle process errors\r\n    claudeProcess.on('error', (error) => {\r\n      if (processCompleted) return;\r\n      processCompleted = true;\r\n      \r\n      console.error('   Process error:', error.message);\r\n      reject(error);\r\n    });\r\n    \r\n    // Set timeout\r\n    const timeoutId = setTimeout(() => {\r\n      if (processCompleted) return;\r\n      processCompleted = true;\r\n      \r\n      console.log('   ‚è±Ô∏è  Timeout reached, terminating...');\r\n      claudeProcess.kill('SIGTERM');\r\n      \r\n      resolve({\r\n        success: false,\r\n        duration: timeout,\r\n        output: null,\r\n        error: 'Process timed out'\r\n      });\r\n    }, timeout);\r\n    \r\n    // Clear timeout when process completes\r\n    claudeProcess.on('exit', () => {\r\n      clearTimeout(timeoutId);\r\n    });\r\n  });\r\n}\r\n\r\n/**\r\n * Main stream chain command\r\n */\r\nexport async function streamChainCommand(args, flags) {\r\n  const subcommand = args[0] || 'help';\r\n  \r\n  switch (subcommand) {\r\n    case 'help':\r\n      showHelp();\r\n      break;\r\n      \r\n    case 'demo':\r\n      await runDemo(flags);\r\n      break;\r\n      \r\n    case 'run':\r\n      await runCustomChain(args.slice(1), flags);\r\n      break;\r\n      \r\n    case 'test':\r\n      await testStreamConnection(flags);\r\n      break;\r\n      \r\n    case 'pipeline':\r\n      await runPipeline(args.slice(1), flags);\r\n      break;\r\n      \r\n    default:\r\n      console.error(`‚ùå Unknown subcommand: ${subcommand}`);\r\n      console.log('Use \"stream-chain help\" for usage information');\r\n  }\r\n}\r\n\r\n/**\r\n * Show help information\r\n */\r\nfunction showHelp() {\r\n  console.log(`\r\nüîó Real Stream Chain Command - Claude CLI Stream-JSON Chaining\r\n\r\nDESCRIPTION\r\n    Connect multiple Claude instances using stream-json format for\r\n    real multi-agent workflows with full context preservation.\r\n\r\nUSAGE\r\n    stream-chain <subcommand> [options]\r\n\r\nSUBCOMMANDS\r\n    run <prompt1> <prompt2> [...]  Execute custom chain (min 2 prompts)\r\n    demo                           Run 3-step demonstration\r\n    pipeline <type>                Execute predefined pipeline\r\n    test                          Test stream connection\r\n    help                          Show this help\r\n\r\nPIPELINE TYPES\r\n    analysis    Code analysis pipeline\r\n    refactor    Refactoring workflow\r\n    test        Test generation\r\n    optimize    Performance optimization\r\n\r\nOPTIONS\r\n    --verbose            Show detailed output\r\n    --timeout <seconds>  Timeout per step (default: 30)\r\n\r\nEXAMPLES\r\n    stream-chain run \"Analyze code\" \"Suggest improvements\" \"Apply changes\"\r\n    stream-chain demo --verbose\r\n    stream-chain pipeline analysis --timeout 60\r\n    stream-chain test\r\n\r\nSTREAM-JSON FORMAT\r\n    Each step communicates via newline-delimited JSON:\r\n    {\"type\":\"init\",\"session_id\":\"abc123\"}\r\n    {\"type\":\"message\",\"role\":\"assistant\",\"content\":[...]}\r\n    {\"type\":\"tool_use\",\"name\":\"Bash\",\"input\":{...}}\r\n    {\"type\":\"result\",\"status\":\"success\"}\r\n\r\nFor more: docs/stream-chaining.md\r\n  `);\r\n}\r\n\r\n/**\r\n * Run demonstration\r\n */\r\nasync function runDemo(flags) {\r\n  console.log('üé≠ Running Stream Chain Demo');\r\n  console.log('‚îÅ'.repeat(50));\r\n  console.log('This demonstrates a real 3-step chain with context preservation\\n');\r\n  \r\n  const prompts = [\r\n    \"Generate a simple Python function to calculate factorial\",\r\n    \"Review the code and suggest improvements for efficiency\",\r\n    \"Apply the improvements and create the final optimized version\"\r\n  ];\r\n  \r\n  await executeStreamChain(prompts, flags);\r\n}\r\n\r\n/**\r\n * Run custom chain\r\n */\r\nasync function runCustomChain(prompts, flags) {\r\n  if (prompts.length < 2) {\r\n    console.error('‚ùå Error: Need at least 2 prompts for chaining');\r\n    console.log('Usage: stream-chain run \"prompt1\" \"prompt2\" [...]');\r\n    return;\r\n  }\r\n  \r\n  await executeStreamChain(prompts, flags);\r\n}\r\n\r\n/**\r\n * Test stream connection\r\n */\r\nasync function testStreamConnection(flags) {\r\n  console.log('üß™ Testing Stream Connection');\r\n  console.log('‚îÅ'.repeat(50));\r\n  \r\n  const testPrompts = [\r\n    \"Say 'Stream test step 1 complete'\",\r\n    \"Acknowledge the previous message and say 'Stream test step 2 complete'\"\r\n  ];\r\n  \r\n  await executeStreamChain(testPrompts, { ...flags, verbose: true });\r\n}\r\n\r\n/**\r\n * Run predefined pipeline\r\n */\r\nasync function runPipeline(args, flags) {\r\n  const pipelineType = args[0] || 'analysis';\r\n  \r\n  const pipelines = {\r\n    analysis: [\r\n      \"Analyze the current directory structure and identify key components\",\r\n      \"Based on the analysis, identify potential improvements\",\r\n      \"Create a detailed report with actionable recommendations\"\r\n    ],\r\n    refactor: [\r\n      \"Identify code that needs refactoring in the current project\",\r\n      \"Create a refactoring plan with priorities\",\r\n      \"Generate refactored code examples for the top priorities\"\r\n    ],\r\n    test: [\r\n      \"Analyze code coverage and identify untested areas\",\r\n      \"Design comprehensive test cases for critical functions\",\r\n      \"Generate unit test implementations\"\r\n    ],\r\n    optimize: [\r\n      \"Profile the codebase for performance bottlenecks\",\r\n      \"Identify optimization opportunities\",\r\n      \"Provide optimized implementations\"\r\n    ]\r\n  };\r\n  \r\n  const pipeline = pipelines[pipelineType];\r\n  if (!pipeline) {\r\n    console.error(`‚ùå Unknown pipeline: ${pipelineType}`);\r\n    console.log('Available pipelines:', Object.keys(pipelines).join(', '));\r\n    return;\r\n  }\r\n  \r\n  console.log(`üöÄ Running ${pipelineType} pipeline`);\r\n  await executeStreamChain(pipeline, flags);\r\n}\r\n\r\nexport default streamChainCommand;"],"names":["spawn","execSync","Readable","checkClaudeAvailable","stdio","executeStreamChain","prompts","flags","console","error","log","repeat","length","results","previousOutput","i","prompt","isFirst","isLast","slice","result","executeSingleStep","push","step","success","duration","output","verbose","preview","message","status","totalTime","reduce","sum","r","successCount","filter","inputStream","Promise","resolve","reject","startTime","Date","now","timeout","args","join","claudeProcess","env","process","stderr","processCompleted","inputReadable","from","pipe","stdin","on","end","stdout","data","toString","write","code","trim","timeoutId","setTimeout","kill","clearTimeout","streamChainCommand","subcommand","showHelp","runDemo","runCustomChain","testStreamConnection","runPipeline","testPrompts","pipelineType","pipelines","analysis","refactor","test","optimize","pipeline","Object","keys"],"mappings":"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"}