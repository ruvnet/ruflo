{"version":3,"sources":["../../../src/monitoring/diagnostics.ts"],"sourcesContent":["/**\r\n * Diagnostic Tools for Claude Flow v2.0.0\r\n */\r\n\r\nimport { EventBus } from '../core/event-bus.js';\r\nimport { Logger } from '../core/logger.js';\r\nimport { SystemIntegration } from '../integration/system-integration.js';\r\nimport { HealthCheckManager } from './health-check.js';\r\nimport type { SystemHealth, SystemMetrics, ComponentStatus } from '../integration/types.js';\r\nimport { getErrorMessage } from '../utils/error-handler.js';\r\nimport { promises as fs } from 'fs';\r\nimport path from 'path';\r\n\r\nexport interface DiagnosticReport {\r\n  timestamp: number;\r\n  systemHealth: SystemHealth;\r\n  metrics: SystemMetrics | null;\r\n  components: ComponentDiagnostic[];\r\n  performance: PerformanceDiagnostic;\r\n  recommendations: string[];\r\n  severity: 'low' | 'medium' | 'high' | 'critical';\r\n}\r\n\r\nexport interface ComponentDiagnostic {\r\n  name: string;\r\n  status: 'healthy' | 'warning' | 'unhealthy';\r\n  version?: string;\r\n  uptime: number;\r\n  lastError?: string;\r\n  metrics?: Record<string, any>;\r\n  issues: DiagnosticIssue[];\r\n}\r\n\r\nexport interface DiagnosticIssue {\r\n  type: string;\r\n  severity: 'low' | 'medium' | 'high' | 'critical';\r\n  message: string;\r\n  recommendation?: string;\r\n  data?: any;\r\n}\r\n\r\nexport interface PerformanceDiagnostic {\r\n  averageResponseTime: number;\r\n  throughput: number;\r\n  errorRate: number;\r\n  memoryLeaks: boolean;\r\n  bottlenecks: string[];\r\n  optimization: string[];\r\n}\r\n\r\nexport interface DiagnosticConfig {\r\n  enableDetailedAnalysis?: boolean;\r\n  includePerformanceMetrics?: boolean;\r\n  generateRecommendations?: boolean;\r\n  exportFormat?: 'json' | 'html' | 'text';\r\n  outputPath?: string;\r\n}\r\n\r\nexport class DiagnosticManager {\r\n  private eventBus: EventBus;\r\n  private logger: Logger;\r\n  private systemIntegration: SystemIntegration;\r\n  private healthCheckManager: HealthCheckManager;\r\n  private performanceHistory: Map<string, number[]> = new Map();\r\n  private errorHistory: Map<string, any[]> = new Map();\r\n\r\n  constructor(eventBus: EventBus, logger: Logger, healthCheckManager?: HealthCheckManager) {\r\n    this.eventBus = eventBus;\r\n    this.logger = logger;\r\n    this.systemIntegration = SystemIntegration.getInstance();\r\n    this.healthCheckManager = healthCheckManager || new HealthCheckManager(eventBus, logger);\r\n\r\n    this.setupEventHandlers();\r\n  }\r\n\r\n  /**\r\n   * Generate comprehensive diagnostic report\r\n   */\r\n  async generateDiagnosticReport(config: DiagnosticConfig = {}): Promise<DiagnosticReport> {\r\n    this.logger.info('Generating comprehensive diagnostic report');\r\n\r\n    const startTime = Date.now();\r\n\r\n    try {\r\n      // Get system health\r\n      const systemHealth = await this.systemIntegration.getSystemHealth();\r\n\r\n      // Get current metrics\r\n      const metrics = this.healthCheckManager.getCurrentMetrics();\r\n\r\n      // Analyze components\r\n      const components = await this.analyzeComponents(config);\r\n\r\n      // Analyze performance\r\n      const performance = await this.analyzePerformance(config);\r\n\r\n      // Generate recommendations\r\n      const recommendations =\r\n        config.generateRecommendations !== false\r\n          ? this.generateRecommendations(systemHealth, performance, components)\r\n          : [];\r\n\r\n      // Determine overall severity\r\n      const severity = this.calculateSeverity(systemHealth, components);\r\n\r\n      const report: DiagnosticReport = {\r\n        timestamp: Date.now(),\r\n        systemHealth,\r\n        metrics,\r\n        components,\r\n        performance,\r\n        recommendations,\r\n        severity,\r\n      };\r\n\r\n      // Export report if requested\r\n      if (config.outputPath) {\r\n        await this.exportReport(report, config);\r\n      }\r\n\r\n      const duration = Date.now() - startTime;\r\n      this.logger.info(`Diagnostic report generated in ${duration}ms`);\r\n\r\n      this.eventBus.emit('diagnostics:report:generated', {\r\n        report,\r\n        duration,\r\n        timestamp: Date.now(),\r\n      });\r\n\r\n      return report;\r\n    } catch (error) {\r\n      this.logger.error('Failed to generate diagnostic report:', getErrorMessage(error));\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Analyze individual components\r\n   */\r\n  private async analyzeComponents(config: DiagnosticConfig): Promise<ComponentDiagnostic[]> {\r\n    const componentNames = [\r\n      'orchestrator',\r\n      'configManager',\r\n      'memoryManager',\r\n      'agentManager',\r\n      'swarmCoordinator',\r\n      'taskEngine',\r\n      'monitor',\r\n      'mcpServer',\r\n    ];\r\n\r\n    const diagnostics = await Promise.all(\r\n      componentNames.map((name) => this.analyzeComponent(name, config)),\r\n    );\r\n\r\n    return diagnostics.filter((d) => d !== null) as ComponentDiagnostic[];\r\n  }\r\n\r\n  /**\r\n   * Analyze individual component\r\n   */\r\n  private async analyzeComponent(\r\n    componentName: string,\r\n    config: DiagnosticConfig,\r\n  ): Promise<ComponentDiagnostic | null> {\r\n    try {\r\n      const component = this.systemIntegration.getComponent(componentName);\r\n\r\n      if (!component) {\r\n        return {\r\n          name: componentName,\r\n          status: 'unhealthy',\r\n          uptime: 0,\r\n          issues: [\r\n            {\r\n              type: 'missing_component',\r\n              severity: 'critical',\r\n              message: 'Component is not available',\r\n              recommendation: 'Check component initialization',\r\n            },\r\n          ],\r\n        };\r\n      }\r\n\r\n      const issues: DiagnosticIssue[] = [];\r\n      let status: 'healthy' | 'warning' | 'unhealthy' = 'healthy';\r\n\r\n      // Check component health history\r\n      const healthHistory = this.healthCheckManager.getHealthHistory(componentName);\r\n      const recentChecks = healthHistory.slice(-10); // Last 10 checks\r\n      const failureRate =\r\n        recentChecks.filter((check) => !check.healthy).length / recentChecks.length;\r\n\r\n      if (failureRate > 0.5) {\r\n        status = 'unhealthy';\r\n        issues.push({\r\n          type: 'high_failure_rate',\r\n          severity: 'high',\r\n          message: `High failure rate: ${(failureRate * 100).toFixed(1)}%`,\r\n          recommendation: 'Investigate component stability',\r\n        });\r\n      } else if (failureRate > 0.2) {\r\n        status = 'warning';\r\n        issues.push({\r\n          type: 'moderate_failure_rate',\r\n          severity: 'medium',\r\n          message: `Moderate failure rate: ${(failureRate * 100).toFixed(1)}%`,\r\n          recommendation: 'Monitor component health',\r\n        });\r\n      }\r\n\r\n      // Check for performance issues\r\n      if (config.includePerformanceMetrics !== false) {\r\n        const performanceIssues = this.analyzeComponentPerformance(componentName);\r\n        issues.push(...performanceIssues);\r\n      }\r\n\r\n      // Check for memory leaks\r\n      const memoryIssues = this.checkMemoryLeaks(componentName);\r\n      issues.push(...memoryIssues);\r\n\r\n      // Get component metrics\r\n      let componentMetrics: Record<string, any> = {};\r\n      if (typeof component.getMetrics === 'function') {\r\n        componentMetrics = await component.getMetrics();\r\n      }\r\n\r\n      // Get last error\r\n      const lastError = this.getLastError(componentName);\r\n\r\n      return {\r\n        name: componentName,\r\n        status,\r\n        uptime: this.getComponentUptime(componentName),\r\n        lastError,\r\n        metrics: componentMetrics,\r\n        issues,\r\n      };\r\n    } catch (error) {\r\n      return {\r\n        name: componentName,\r\n        status: 'unhealthy',\r\n        uptime: 0,\r\n        lastError: getErrorMessage(error),\r\n        issues: [\r\n          {\r\n            type: 'analysis_error',\r\n            severity: 'medium',\r\n            message: `Failed to analyze component: ${getErrorMessage(error)}`,\r\n            recommendation: 'Check component accessibility',\r\n          },\r\n        ],\r\n      };\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Analyze system performance\r\n   */\r\n  private async analyzePerformance(config: DiagnosticConfig): Promise<PerformanceDiagnostic> {\r\n    const metrics = this.healthCheckManager.getCurrentMetrics();\r\n    const bottlenecks: string[] = [];\r\n    const optimization: string[] = [];\r\n\r\n    // Calculate averages from history\r\n    const responseTimeHistory = this.performanceHistory.get('responseTime') || [];\r\n    const averageResponseTime =\r\n      responseTimeHistory.length > 0\r\n        ? responseTimeHistory.reduce((sum, time) => sum + time, 0) / responseTimeHistory.length\r\n        : 0;\r\n\r\n    // Calculate throughput\r\n    const throughput = this.calculateThroughput();\r\n\r\n    // Calculate error rate\r\n    const errorRate = this.calculateErrorRate();\r\n\r\n    // Check for memory leaks\r\n    const memoryLeaks = this.detectMemoryLeaks();\r\n\r\n    // Identify bottlenecks\r\n    if (metrics) {\r\n      if (metrics.cpu > 80) {\r\n        bottlenecks.push('High CPU usage');\r\n        optimization.push('Consider distributing load across more workers');\r\n      }\r\n\r\n      if (metrics.memory > 80) {\r\n        bottlenecks.push('High memory usage');\r\n        optimization.push('Implement memory optimization strategies');\r\n      }\r\n\r\n      if (metrics.queuedTasks > metrics.activeTasks * 2) {\r\n        bottlenecks.push('Task queue buildup');\r\n        optimization.push('Increase task processing capacity');\r\n      }\r\n\r\n      if (errorRate > 0.05) {\r\n        bottlenecks.push('High error rate');\r\n        optimization.push('Investigate and fix recurring errors');\r\n      }\r\n    }\r\n\r\n    if (averageResponseTime > 1000) {\r\n      bottlenecks.push('Slow response times');\r\n      optimization.push('Optimize critical path operations');\r\n    }\r\n\r\n    return {\r\n      averageResponseTime,\r\n      throughput,\r\n      errorRate,\r\n      memoryLeaks,\r\n      bottlenecks,\r\n      optimization,\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Generate recommendations based on analysis\r\n   */\r\n  private generateRecommendations(\r\n    health: SystemHealth,\r\n    performance: PerformanceDiagnostic,\r\n    components: ComponentDiagnostic[],\r\n  ): string[] {\r\n    const recommendations: string[] = [];\r\n\r\n    // System-level recommendations\r\n    if (health.overall === 'unhealthy') {\r\n      recommendations.push('System health is compromised - immediate attention required');\r\n    } else if (health.overall === 'warning') {\r\n      recommendations.push('System showing warning signs - proactive maintenance recommended');\r\n    }\r\n\r\n    // Performance recommendations\r\n    if (performance.averageResponseTime > 1000) {\r\n      recommendations.push('Response times are slow - consider performance optimization');\r\n    }\r\n\r\n    if (performance.errorRate > 0.05) {\r\n      recommendations.push('Error rate is high - investigate error sources');\r\n    }\r\n\r\n    if (performance.memoryLeaks) {\r\n      recommendations.push('Memory leaks detected - review memory management');\r\n    }\r\n\r\n    // Component-specific recommendations\r\n    const unhealthyComponents = components.filter((c) => c.status === 'unhealthy');\r\n    if (unhealthyComponents.length > 0) {\r\n      recommendations.push(\r\n        `${unhealthyComponents.length} component(s) unhealthy - restart or investigate`,\r\n      );\r\n    }\r\n\r\n    const highFailureComponents = components.filter((c) =>\r\n      c.issues.some((issue) => issue.type === 'high_failure_rate'),\r\n    );\r\n    if (highFailureComponents.length > 0) {\r\n      recommendations.push('Some components have high failure rates - check logs and dependencies');\r\n    }\r\n\r\n    // Add performance optimizations\r\n    recommendations.push(...performance.optimization);\r\n\r\n    // General recommendations\r\n    if (recommendations.length === 0) {\r\n      recommendations.push('System appears healthy - continue regular monitoring');\r\n    }\r\n\r\n    return recommendations;\r\n  }\r\n\r\n  /**\r\n   * Calculate overall severity\r\n   */\r\n  private calculateSeverity(\r\n    health: SystemHealth,\r\n    components: ComponentDiagnostic[],\r\n  ): 'low' | 'medium' | 'high' | 'critical' {\r\n    if (health.overall === 'unhealthy') {\r\n      return 'critical';\r\n    }\r\n\r\n    const criticalIssues = components.reduce(\r\n      (count, component) =>\r\n        count + component.issues.filter((issue) => issue.severity === 'critical').length,\r\n      0,\r\n    );\r\n\r\n    const highIssues = components.reduce(\r\n      (count, component) =>\r\n        count + component.issues.filter((issue) => issue.severity === 'high').length,\r\n      0,\r\n    );\r\n\r\n    if (criticalIssues > 0) {\r\n      return 'critical';\r\n    }\r\n\r\n    if (highIssues > 2) {\r\n      return 'high';\r\n    }\r\n\r\n    if (health.overall === 'warning' || highIssues > 0) {\r\n      return 'medium';\r\n    }\r\n\r\n    return 'low';\r\n  }\r\n\r\n  /**\r\n   * Export diagnostic report\r\n   */\r\n  private async exportReport(report: DiagnosticReport, config: DiagnosticConfig): Promise<void> {\r\n    const format = config.exportFormat || 'json';\r\n    const outputPath = config.outputPath!;\r\n\r\n    try {\r\n      let content: string;\r\n\r\n      switch (format) {\r\n        case 'json':\r\n          content = JSON.stringify(report, null, 2);\r\n          break;\r\n        case 'html':\r\n          content = this.generateHtmlReport(report);\r\n          break;\r\n        case 'text':\r\n          content = this.generateTextReport(report);\r\n          break;\r\n        default:\r\n          throw new Error(`Unsupported export format: ${format}`);\r\n      }\r\n\r\n      await fs.writeFile(outputPath, content, 'utf8');\r\n      this.logger.info(`Diagnostic report exported to: ${outputPath}`);\r\n    } catch (error) {\r\n      this.logger.error('Failed to export report:', getErrorMessage(error));\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Generate HTML report\r\n   */\r\n  private generateHtmlReport(report: DiagnosticReport): string {\r\n    const timestamp = new Date(report.timestamp).toISOString();\r\n    const severityColor = {\r\n      low: '#28a745',\r\n      medium: '#ffc107',\r\n      high: '#fd7e14',\r\n      critical: '#dc3545',\r\n    }[report.severity];\r\n\r\n    return `\r\n<!DOCTYPE html>\r\n<html>\r\n<head>\r\n    <title>Claude Flow v2.0.0 Diagnostic Report</title>\r\n    <style>\r\n        body { font-family: Arial, sans-serif; margin: 40px; }\r\n        .header { border-bottom: 2px solid #ccc; padding-bottom: 20px; }\r\n        .severity { color: ${severityColor}; font-weight: bold; }\r\n        .section { margin: 20px 0; }\r\n        .component { margin: 10px 0; padding: 10px; border: 1px solid #ddd; }\r\n        .healthy { border-left: 4px solid #28a745; }\r\n        .warning { border-left: 4px solid #ffc107; }\r\n        .unhealthy { border-left: 4px solid #dc3545; }\r\n        .issue { margin: 5px 0; padding: 5px; background: #f8f9fa; }\r\n        .critical { background: #f8d7da; }\r\n        .high { background: #fff3cd; }\r\n        .medium { background: #cce5ff; }\r\n        .low { background: #d1ecf1; }\r\n    </style>\r\n</head>\r\n<body>\r\n    <div class=\"header\">\r\n        <h1>Claude Flow v2.0.0 Diagnostic Report</h1>\r\n        <p><strong>Generated:</strong> ${timestamp}</p>\r\n        <p><strong>Severity:</strong> <span class=\"severity\">${report.severity.toUpperCase()}</span></p>\r\n    </div>\r\n\r\n    <div class=\"section\">\r\n        <h2>System Health</h2>\r\n        <p><strong>Overall Status:</strong> ${report.systemHealth.overall}</p>\r\n        <p><strong>Total Components:</strong> ${report.systemHealth.metrics.totalComponents}</p>\r\n        <p><strong>Healthy:</strong> ${report.systemHealth.metrics.healthyComponents}</p>\r\n        <p><strong>Unhealthy:</strong> ${report.systemHealth.metrics.unhealthyComponents}</p>\r\n        <p><strong>Uptime:</strong> ${(report.systemHealth.metrics.uptime / 1000 / 60).toFixed(1)} minutes</p>\r\n    </div>\r\n\r\n    <div class=\"section\">\r\n        <h2>Components</h2>\r\n        ${report.components\r\n          .map(\r\n            (component) => `\r\n            <div class=\"component ${component.status}\">\r\n                <h3>${component.name}</h3>\r\n                <p><strong>Status:</strong> ${component.status}</p>\r\n                <p><strong>Uptime:</strong> ${(component.uptime / 1000 / 60).toFixed(1)} minutes</p>\r\n                ${component.lastError ? `<p><strong>Last Error:</strong> ${component.lastError}</p>` : ''}\r\n                ${\r\n                  component.issues.length > 0\r\n                    ? `\r\n                    <h4>Issues:</h4>\r\n                    ${component.issues\r\n                      .map(\r\n                        (issue) => `\r\n                        <div class=\"issue ${issue.severity}\">\r\n                            <strong>${issue.type}:</strong> ${issue.message}\r\n                            ${issue.recommendation ? `<br><em>Recommendation: ${issue.recommendation}</em>` : ''}\r\n                        </div>\r\n                    `,\r\n                      )\r\n                      .join('')}\r\n                `\r\n                    : '<p>No issues detected</p>'\r\n                }\r\n            </div>\r\n        `,\r\n          )\r\n          .join('')}\r\n    </div>\r\n\r\n    <div class=\"section\">\r\n        <h2>Performance</h2>\r\n        <p><strong>Average Response Time:</strong> ${report.performance.averageResponseTime.toFixed(2)}ms</p>\r\n        <p><strong>Throughput:</strong> ${report.performance.throughput.toFixed(2)} ops/sec</p>\r\n        <p><strong>Error Rate:</strong> ${(report.performance.errorRate * 100).toFixed(2)}%</p>\r\n        <p><strong>Memory Leaks:</strong> ${report.performance.memoryLeaks ? 'Detected' : 'None detected'}</p>\r\n        \r\n        ${\r\n          report.performance.bottlenecks.length > 0\r\n            ? `\r\n            <h3>Bottlenecks:</h3>\r\n            <ul>${report.performance.bottlenecks.map((b) => `<li>${b}</li>`).join('')}</ul>\r\n        `\r\n            : ''\r\n        }\r\n    </div>\r\n\r\n    <div class=\"section\">\r\n        <h2>Recommendations</h2>\r\n        <ol>\r\n            ${report.recommendations.map((rec) => `<li>${rec}</li>`).join('')}\r\n        </ol>\r\n    </div>\r\n</body>\r\n</html>`;\r\n  }\r\n\r\n  /**\r\n   * Generate text report\r\n   */\r\n  private generateTextReport(report: DiagnosticReport): string {\r\n    const timestamp = new Date(report.timestamp).toISOString();\r\n\r\n    let text = `\r\nCLAUDE FLOW v2.0.0 DIAGNOSTIC REPORT\r\n=====================================\r\n\r\nGenerated: ${timestamp}\r\nSeverity: ${report.severity.toUpperCase()}\r\n\r\nSYSTEM HEALTH\r\n-------------\r\nOverall Status: ${report.systemHealth.overall}\r\nTotal Components: ${report.systemHealth.metrics.totalComponents}\r\nHealthy: ${report.systemHealth.metrics.healthyComponents}\r\nUnhealthy: ${report.systemHealth.metrics.unhealthyComponents}\r\nUptime: ${(report.systemHealth.metrics.uptime / 1000 / 60).toFixed(1)} minutes\r\n\r\nCOMPONENTS\r\n----------\r\n`;\r\n\r\n    report.components.forEach((component) => {\r\n      text += `\r\n${component.name}\r\n  Status: ${component.status}\r\n  Uptime: ${(component.uptime / 1000 / 60).toFixed(1)} minutes\r\n`;\r\n      if (component.lastError) {\r\n        text += `  Last Error: ${component.lastError}\\n`;\r\n      }\r\n\r\n      if (component.issues.length > 0) {\r\n        text += `  Issues:\\n`;\r\n        component.issues.forEach((issue) => {\r\n          text += `    - ${issue.type}: ${issue.message}\\n`;\r\n          if (issue.recommendation) {\r\n            text += `      Recommendation: ${issue.recommendation}\\n`;\r\n          }\r\n        });\r\n      }\r\n    });\r\n\r\n    text += `\r\nPERFORMANCE\r\n-----------\r\nAverage Response Time: ${report.performance.averageResponseTime.toFixed(2)}ms\r\nThroughput: ${report.performance.throughput.toFixed(2)} ops/sec\r\nError Rate: ${(report.performance.errorRate * 100).toFixed(2)}%\r\nMemory Leaks: ${report.performance.memoryLeaks ? 'Detected' : 'None detected'}\r\n`;\r\n\r\n    if (report.performance.bottlenecks.length > 0) {\r\n      text += `\\nBottlenecks:\\n`;\r\n      report.performance.bottlenecks.forEach((bottleneck) => {\r\n        text += `  - ${bottleneck}\\n`;\r\n      });\r\n    }\r\n\r\n    text += `\r\nRECOMMENDATIONS\r\n---------------\r\n`;\r\n    report.recommendations.forEach((rec, index) => {\r\n      text += `${index + 1}. ${rec}\\n`;\r\n    });\r\n\r\n    return text;\r\n  }\r\n\r\n  // Helper methods for analysis\r\n  private analyzeComponentPerformance(componentName: string): DiagnosticIssue[] {\r\n    // Placeholder implementation\r\n    return [];\r\n  }\r\n\r\n  private checkMemoryLeaks(componentName: string): DiagnosticIssue[] {\r\n    // Placeholder implementation\r\n    return [];\r\n  }\r\n\r\n  private getLastError(componentName: string): string | undefined {\r\n    const errors = this.errorHistory.get(componentName);\r\n    return errors && errors.length > 0 ? errors[errors.length - 1]?.message : undefined;\r\n  }\r\n\r\n  private getComponentUptime(componentName: string): number {\r\n    // Placeholder implementation\r\n    return process.uptime() * 1000;\r\n  }\r\n\r\n  private calculateThroughput(): number {\r\n    // Placeholder implementation\r\n    return 100; // ops/sec\r\n  }\r\n\r\n  private calculateErrorRate(): number {\r\n    // Placeholder implementation\r\n    return 0.01; // 1%\r\n  }\r\n\r\n  private detectMemoryLeaks(): boolean {\r\n    // Placeholder implementation\r\n    return false;\r\n  }\r\n\r\n  private setupEventHandlers(): void {\r\n    // Track performance metrics\r\n    this.eventBus.on('performance:metric', (metric) => {\r\n      if (!this.performanceHistory.has(metric.name)) {\r\n        this.performanceHistory.set(metric.name, []);\r\n      }\r\n\r\n      const history = this.performanceHistory.get(metric.name)!;\r\n      history.push(metric.value);\r\n\r\n      // Keep only last 100 measurements\r\n      if (history.length > 100) {\r\n        history.shift();\r\n      }\r\n    });\r\n\r\n    // Track errors\r\n    this.eventBus.on('system:error', (error) => {\r\n      const component = error.component || 'system';\r\n\r\n      if (!this.errorHistory.has(component)) {\r\n        this.errorHistory.set(component, []);\r\n      }\r\n\r\n      const history = this.errorHistory.get(component)!;\r\n      history.push({\r\n        message: error.message || error.error,\r\n        timestamp: Date.now(),\r\n        stack: error.stack,\r\n      });\r\n\r\n      // Keep only last 50 errors per component\r\n      if (history.length > 50) {\r\n        history.shift();\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Run quick diagnostic check\r\n   */\r\n  async quickDiagnostic(): Promise<{\r\n    status: string;\r\n    issues: number;\r\n    recommendations: string[];\r\n  }> {\r\n    const health = await this.systemIntegration.getSystemHealth();\r\n    const components = await this.analyzeComponents({ enableDetailedAnalysis: false });\r\n\r\n    const issues = components.reduce((count, comp) => count + comp.issues.length, 0);\r\n    const recommendations = this.generateRecommendations(\r\n      health,\r\n      {\r\n        averageResponseTime: 0,\r\n        throughput: 0,\r\n        errorRate: 0,\r\n        memoryLeaks: false,\r\n        bottlenecks: [],\r\n        optimization: [],\r\n      },\r\n      components,\r\n    ).slice(0, 3); // Top 3 recommendations\r\n\r\n    return {\r\n      status: health.overall,\r\n      issues,\r\n      recommendations,\r\n    };\r\n  }\r\n}\r\n"],"names":["SystemIntegration","HealthCheckManager","getErrorMessage","promises","fs","DiagnosticManager","eventBus","logger","systemIntegration","healthCheckManager","performanceHistory","Map","errorHistory","getInstance","setupEventHandlers","generateDiagnosticReport","config","info","startTime","Date","now","systemHealth","getSystemHealth","metrics","getCurrentMetrics","components","analyzeComponents","performance","analyzePerformance","recommendations","generateRecommendations","severity","calculateSeverity","report","timestamp","outputPath","exportReport","duration","emit","error","componentNames","diagnostics","Promise","all","map","name","analyzeComponent","filter","d","componentName","component","getComponent","status","uptime","issues","type","message","recommendation","healthHistory","getHealthHistory","recentChecks","slice","failureRate","check","healthy","length","push","toFixed","includePerformanceMetrics","performanceIssues","analyzeComponentPerformance","memoryIssues","checkMemoryLeaks","componentMetrics","getMetrics","lastError","getLastError","getComponentUptime","bottlenecks","optimization","responseTimeHistory","get","averageResponseTime","reduce","sum","time","throughput","calculateThroughput","errorRate","calculateErrorRate","memoryLeaks","detectMemoryLeaks","cpu","memory","queuedTasks","activeTasks","health","overall","unhealthyComponents","c","highFailureComponents","some","issue","criticalIssues","count","highIssues","format","exportFormat","content","JSON","stringify","generateHtmlReport","generateTextReport","Error","writeFile","toISOString","severityColor","low","medium","high","critical","toUpperCase","totalComponents","healthyComponents","join","b","rec","text","forEach","bottleneck","index","errors","undefined","process","on","metric","has","set","history","value","shift","stack","quickDiagnostic","enableDetailedAnalysis","comp"],"mappings":"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"}