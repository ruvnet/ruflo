{"version":3,"sources":["../../../../src/cli/simple-commands/tool-execution-framework.js"],"sourcesContent":["/**\r\n * Tool Execution Framework\r\n * Provides unified interface for executing all Claude-Flow MCP tools\r\n * Handles progress tracking, cancellation, and result formatting\r\n */\r\n\r\nimport MCPIntegrationLayer from './mcp-integration-layer.js';\r\n\r\nexport class ToolExecutionFramework {\r\n  constructor(ui) {\r\n    this.ui = ui;\r\n    this.mcpLayer = new MCPIntegrationLayer(ui);\r\n    this.executionQueue = [];\r\n    this.maxConcurrentExecutions = 5;\r\n    this.currentExecutions = 0;\r\n    this.resultFormatters = new Map();\r\n\r\n    this.initializeFormatters();\r\n  }\r\n\r\n  /**\r\n   * Initialize result formatters for different tool types\r\n   */\r\n  initializeFormatters() {\r\n    // Swarm tools formatters\r\n    this.resultFormatters.set('swarm_init', (result) => ({\r\n      title: 'Swarm Initialized',\r\n      summary: `${result.topology} topology with ${result.maxAgents} max agents`,\r\n      details: [\r\n        `Swarm ID: ${result.swarmId}`,\r\n        `Strategy: ${result.strategy}`,\r\n        `Status: ${result.status}`,\r\n      ],\r\n      status: result.success ? 'success' : 'error',\r\n    }));\r\n\r\n    this.resultFormatters.set('neural_train', (result) => ({\r\n      title: 'Neural Training Complete',\r\n      summary: `${result.pattern_type} model trained with ${result.accuracy.toFixed(2)} accuracy`,\r\n      details: [\r\n        `Model ID: ${result.modelId}`,\r\n        `Epochs: ${result.epochs}`,\r\n        `Training time: ${result.training_time.toFixed(1)}s`,\r\n        `Accuracy: ${(result.accuracy * 100).toFixed(1)}%`,\r\n      ],\r\n      status: result.success ? 'success' : 'error',\r\n      metrics: {\r\n        accuracy: result.accuracy,\r\n        epochs: result.epochs,\r\n        time: result.training_time,\r\n      },\r\n    }));\r\n\r\n    this.resultFormatters.set('performance_report', (result) => ({\r\n      title: 'Performance Report',\r\n      summary: `${result.timeframe} analysis - ${result.metrics.success_rate.toFixed(1)}% success rate`,\r\n      details: [\r\n        `Tasks executed: ${result.metrics.tasks_executed}`,\r\n        `Average execution time: ${result.metrics.avg_execution_time.toFixed(1)}s`,\r\n        `Agents spawned: ${result.metrics.agents_spawned}`,\r\n        `Memory efficiency: ${(result.metrics.memory_efficiency * 100).toFixed(1)}%`,\r\n      ],\r\n      status: 'success',\r\n      charts: {\r\n        successRate: result.metrics.success_rate,\r\n        memoryEfficiency: result.metrics.memory_efficiency,\r\n      },\r\n    }));\r\n\r\n    this.resultFormatters.set('memory_usage', (result) => ({\r\n      title: 'Memory Operation',\r\n      summary: `${result.action} operation on key \"${result.key}\"`,\r\n      details: [\r\n        `Namespace: ${result.namespace}`,\r\n        `Action: ${result.action}`,\r\n        `Status: ${result.action === 'store' ? 'Stored' : 'Retrieved'}`,\r\n      ],\r\n      status: result.success ? 'success' : 'error',\r\n    }));\r\n\r\n    // Default formatter for unknown tools\r\n    this.resultFormatters.set('default', (result) => ({\r\n      title: `Tool: ${result.tool || 'Unknown'}`,\r\n      summary: result.message || 'Tool executed successfully',\r\n      details: Object.entries(result).map(\r\n        ([key, value]) => `${key}: ${typeof value === 'object' ? JSON.stringify(value) : value}`,\r\n      ),\r\n      status: result.success ? 'success' : 'error',\r\n    }));\r\n  }\r\n\r\n  /**\r\n   * Execute a single tool with comprehensive tracking\r\n   */\r\n  async executeTool(toolName, parameters = {}, options = {}) {\r\n    try {\r\n      // Validate tool exists\r\n      if (!this.isToolAvailable(toolName)) {\r\n        throw new Error(`Tool \"${toolName}\" is not available`);\r\n      }\r\n\r\n      // Create execution context\r\n      const execution = {\r\n        id: `exec_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`,\r\n        toolName,\r\n        parameters,\r\n        options,\r\n        startTime: Date.now(),\r\n        status: 'queued',\r\n        progress: 0,\r\n      };\r\n\r\n      // Add to queue or execute immediately\r\n      if (this.currentExecutions >= this.maxConcurrentExecutions) {\r\n        this.executionQueue.push(execution);\r\n        this.ui.addLog('info', `Tool ${toolName} queued (${this.executionQueue.length} in queue)`);\r\n      } else {\r\n        await this.executeToolDirect(execution);\r\n      }\r\n\r\n      return execution;\r\n    } catch (error) {\r\n      this.ui.addLog('error', `Failed to execute ${toolName}: ${error.message}`);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Execute tool directly\r\n   */\r\n  async executeToolDirect(execution) {\r\n    this.currentExecutions++;\r\n    execution.status = 'running';\r\n    execution.startTime = Date.now();\r\n\r\n    try {\r\n      this.ui.addLog('info', `Executing ${execution.toolName}...`);\r\n\r\n      // Execute via MCP layer\r\n      const result = await this.mcpLayer.executeTool(\r\n        execution.toolName,\r\n        execution.parameters,\r\n        execution.options,\r\n      );\r\n\r\n      // Format result\r\n      const formattedResult = this.formatResult(execution.toolName, result.result);\r\n\r\n      // Update execution\r\n      execution.status = 'completed';\r\n      execution.endTime = Date.now();\r\n      execution.duration = execution.endTime - execution.startTime;\r\n      execution.result = formattedResult;\r\n\r\n      // Log success\r\n      this.ui.addLog('success', `${execution.toolName} completed in ${execution.duration}ms`);\r\n\r\n      // Process queue\r\n      this.processQueue();\r\n\r\n      return execution;\r\n    } catch (error) {\r\n      execution.status = 'failed';\r\n      execution.endTime = Date.now();\r\n      execution.error = error.message;\r\n\r\n      this.ui.addLog('error', `${execution.toolName} failed: ${error.message}`);\r\n\r\n      // Process queue\r\n      this.processQueue();\r\n\r\n      throw error;\r\n    } finally {\r\n      this.currentExecutions--;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Process execution queue\r\n   */\r\n  async processQueue() {\r\n    if (this.executionQueue.length > 0 && this.currentExecutions < this.maxConcurrentExecutions) {\r\n      const nextExecution = this.executionQueue.shift();\r\n      await this.executeToolDirect(nextExecution);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Execute multiple tools in batch\r\n   */\r\n  async executeToolsBatch(toolExecutions, options = {}) {\r\n    const batchId = `batch_${Date.now()}`;\r\n    const results = [];\r\n\r\n    this.ui.addLog('info', `Starting batch execution: ${toolExecutions.length} tools`);\r\n\r\n    try {\r\n      if (options.parallel) {\r\n        // Execute in parallel\r\n        const promises = toolExecutions.map(({ toolName, parameters, toolOptions }) =>\r\n          this.executeTool(toolName, parameters, toolOptions),\r\n        );\r\n\r\n        const settled = await Promise.allSettled(promises);\r\n\r\n        settled.forEach((result, index) => {\r\n          if (result.status === 'fulfilled') {\r\n            results.push({ success: true, execution: result.value });\r\n          } else {\r\n            results.push({\r\n              success: false,\r\n              error: result.reason.message,\r\n              toolName: toolExecutions[index].toolName,\r\n            });\r\n          }\r\n        });\r\n      } else {\r\n        // Execute sequentially\r\n        for (let i = 0; i < toolExecutions.length; i++) {\r\n          const { toolName, parameters, toolOptions } = toolExecutions[i];\r\n\r\n          try {\r\n            const execution = await this.executeTool(toolName, parameters, toolOptions);\r\n            results.push({ success: true, execution });\r\n\r\n            // Report progress\r\n            if (options.progressCallback) {\r\n              options.progressCallback({\r\n                completed: i + 1,\r\n                total: toolExecutions.length,\r\n                progress: ((i + 1) / toolExecutions.length) * 100,\r\n                currentTool: toolName,\r\n              });\r\n            }\r\n          } catch (error) {\r\n            results.push({\r\n              success: false,\r\n              error: error.message,\r\n              toolName,\r\n            });\r\n\r\n            // Stop on first error if configured\r\n            if (options.stopOnError) {\r\n              break;\r\n            }\r\n          }\r\n        }\r\n      }\r\n\r\n      const successful = results.filter((r) => r.success).length;\r\n      this.ui.addLog(\r\n        'success',\r\n        `Batch ${batchId} completed: ${successful}/${results.length} successful`,\r\n      );\r\n\r\n      return {\r\n        batchId,\r\n        results,\r\n        summary: {\r\n          total: results.length,\r\n          successful,\r\n          failed: results.length - successful,\r\n        },\r\n      };\r\n    } catch (error) {\r\n      this.ui.addLog('error', `Batch ${batchId} failed: ${error.message}`);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Execute workflow (sequence of dependent tools)\r\n   */\r\n  async executeWorkflow(workflow, options = {}) {\r\n    const workflowId = `workflow_${Date.now()}`;\r\n    const context = {}; // Shared context between steps\r\n    const results = [];\r\n\r\n    this.ui.addLog('info', `Starting workflow: ${workflow.name || workflowId}`);\r\n\r\n    try {\r\n      for (let i = 0; i < workflow.steps.length; i++) {\r\n        const step = workflow.steps[i];\r\n\r\n        // Resolve parameters using context\r\n        const resolvedParameters = this.resolveParameters(step.parameters, context);\r\n\r\n        // Execute step\r\n        const execution = await this.executeTool(step.toolName, resolvedParameters, step.options);\r\n\r\n        // Update context with results\r\n        if (step.outputVariable && execution.result) {\r\n          context[step.outputVariable] = execution.result;\r\n        }\r\n\r\n        results.push(execution);\r\n\r\n        // Check for step failure\r\n        if (execution.status === 'failed' && step.required !== false) {\r\n          throw new Error(`Required step ${step.toolName} failed: ${execution.error}`);\r\n        }\r\n\r\n        // Report progress\r\n        if (options.progressCallback) {\r\n          options.progressCallback({\r\n            completed: i + 1,\r\n            total: workflow.steps.length,\r\n            progress: ((i + 1) / workflow.steps.length) * 100,\r\n            currentStep: step.toolName,\r\n          });\r\n        }\r\n      }\r\n\r\n      this.ui.addLog('success', `Workflow ${workflowId} completed successfully`);\r\n\r\n      return {\r\n        workflowId,\r\n        results,\r\n        context,\r\n        summary: {\r\n          totalSteps: workflow.steps.length,\r\n          completedSteps: results.filter((r) => r.status === 'completed').length,\r\n          failedSteps: results.filter((r) => r.status === 'failed').length,\r\n        },\r\n      };\r\n    } catch (error) {\r\n      this.ui.addLog('error', `Workflow ${workflowId} failed: ${error.message}`);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Resolve parameters using context variables\r\n   */\r\n  resolveParameters(parameters, context) {\r\n    if (typeof parameters !== 'object' || parameters === null) {\r\n      return parameters;\r\n    }\r\n\r\n    const resolved = {};\r\n\r\n    for (const [key, value] of Object.entries(parameters)) {\r\n      if (typeof value === 'string' && value.startsWith('$')) {\r\n        // Context variable reference\r\n        const varName = value.substring(1);\r\n        resolved[key] = context[varName] || value;\r\n      } else if (typeof value === 'object') {\r\n        resolved[key] = this.resolveParameters(value, context);\r\n      } else {\r\n        resolved[key] = value;\r\n      }\r\n    }\r\n\r\n    return resolved;\r\n  }\r\n\r\n  /**\r\n   * Format tool result for display\r\n   */\r\n  formatResult(toolName, result) {\r\n    const formatter = this.resultFormatters.get(toolName) || this.resultFormatters.get('default');\r\n    return formatter(result);\r\n  }\r\n\r\n  /**\r\n   * Check if tool is available\r\n   */\r\n  isToolAvailable(toolName) {\r\n    const allTools = Object.values(this.mcpLayer.toolCategories).flat();\r\n    return allTools.includes(toolName);\r\n  }\r\n\r\n  /**\r\n   * Get tools by category\r\n   */\r\n  getToolsByCategory(category) {\r\n    return this.mcpLayer.getToolsByCategory(category);\r\n  }\r\n\r\n  /**\r\n   * Get all available categories\r\n   */\r\n  getCategories() {\r\n    return this.mcpLayer.getToolCategories();\r\n  }\r\n\r\n  /**\r\n   * Get execution status\r\n   */\r\n  getExecutionStatus() {\r\n    return {\r\n      currentExecutions: this.currentExecutions,\r\n      queuedExecutions: this.executionQueue.length,\r\n      maxConcurrent: this.maxConcurrentExecutions,\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Cancel execution\r\n   */\r\n  async cancelExecution(executionId) {\r\n    // Try to remove from queue first\r\n    const queueIndex = this.executionQueue.findIndex((e) => e.id === executionId);\r\n    if (queueIndex !== -1) {\r\n      this.executionQueue.splice(queueIndex, 1);\r\n      this.ui.addLog('info', `Cancelled queued execution ${executionId}`);\r\n      return true;\r\n    }\r\n\r\n    // Cancel running execution via MCP layer\r\n    return await this.mcpLayer.cancelExecution(executionId);\r\n  }\r\n\r\n  /**\r\n   * Get predefined workflows\r\n   */\r\n  getPredefinedWorkflows() {\r\n    return {\r\n      neural_training_pipeline: {\r\n        name: 'Neural Training Pipeline',\r\n        description: 'Complete neural network training with evaluation',\r\n        steps: [\r\n          {\r\n            toolName: 'neural_train',\r\n            parameters: {\r\n              pattern_type: 'coordination',\r\n              epochs: 100,\r\n              training_data: 'recent_swarm_data',\r\n            },\r\n            outputVariable: 'trainedModel',\r\n            required: true,\r\n          },\r\n          {\r\n            toolName: 'neural_predict',\r\n            parameters: {\r\n              modelId: '$trainedModel.modelId',\r\n              input: 'test_coordination_scenario',\r\n            },\r\n            outputVariable: 'prediction',\r\n            required: true,\r\n          },\r\n          {\r\n            toolName: 'neural_explain',\r\n            parameters: {\r\n              modelId: '$trainedModel.modelId',\r\n              prediction: '$prediction',\r\n            },\r\n            required: false,\r\n          },\r\n        ],\r\n      },\r\n\r\n      swarm_deployment: {\r\n        name: 'Swarm Deployment',\r\n        description: 'Initialize and deploy a complete swarm',\r\n        steps: [\r\n          {\r\n            toolName: 'swarm_init',\r\n            parameters: {\r\n              topology: 'hierarchical',\r\n              maxAgents: 8,\r\n              strategy: 'adaptive',\r\n            },\r\n            outputVariable: 'swarm',\r\n            required: true,\r\n          },\r\n          {\r\n            toolName: 'agent_spawn',\r\n            parameters: {\r\n              type: 'coordinator',\r\n              swarmId: '$swarm.swarmId',\r\n            },\r\n            required: true,\r\n          },\r\n          {\r\n            toolName: 'agent_spawn',\r\n            parameters: {\r\n              type: 'researcher',\r\n              swarmId: '$swarm.swarmId',\r\n            },\r\n            required: true,\r\n          },\r\n          {\r\n            toolName: 'swarm_monitor',\r\n            parameters: {\r\n              swarmId: '$swarm.swarmId',\r\n              interval: 5000,\r\n            },\r\n            required: false,\r\n          },\r\n        ],\r\n      },\r\n\r\n      performance_analysis: {\r\n        name: 'Performance Analysis',\r\n        description: 'Comprehensive system performance analysis',\r\n        steps: [\r\n          {\r\n            toolName: 'performance_report',\r\n            parameters: {\r\n              timeframe: '24h',\r\n              format: 'detailed',\r\n            },\r\n            outputVariable: 'report',\r\n            required: true,\r\n          },\r\n          {\r\n            toolName: 'bottleneck_analyze',\r\n            parameters: {\r\n              component: 'system',\r\n            },\r\n            outputVariable: 'bottlenecks',\r\n            required: true,\r\n          },\r\n          {\r\n            toolName: 'trend_analysis',\r\n            parameters: {\r\n              metric: 'performance',\r\n              period: '7d',\r\n            },\r\n            required: false,\r\n          },\r\n        ],\r\n      },\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Execute predefined workflow\r\n   */\r\n  async executePredefinedWorkflow(workflowName, options = {}) {\r\n    const workflows = this.getPredefinedWorkflows();\r\n    const workflow = workflows[workflowName];\r\n\r\n    if (!workflow) {\r\n      throw new Error(`Unknown workflow: ${workflowName}`);\r\n    }\r\n\r\n    return await this.executeWorkflow(workflow, options);\r\n  }\r\n\r\n  /**\r\n   * Get comprehensive status\r\n   */\r\n  getStatus() {\r\n    return {\r\n      ...this.getExecutionStatus(),\r\n      mcpStatus: this.mcpLayer.getStatus(),\r\n      availableTools: Object.values(this.mcpLayer.toolCategories).flat().length,\r\n      availableWorkflows: Object.keys(this.getPredefinedWorkflows()).length,\r\n    };\r\n  }\r\n}\r\n\r\nexport default ToolExecutionFramework;\r\n"],"names":["MCPIntegrationLayer","ToolExecutionFramework","ui","mcpLayer","executionQueue","maxConcurrentExecutions","currentExecutions","resultFormatters","Map","initializeFormatters","set","result","title","summary","topology","maxAgents","details","swarmId","strategy","status","success","pattern_type","accuracy","toFixed","modelId","epochs","training_time","metrics","time","timeframe","success_rate","tasks_executed","avg_execution_time","agents_spawned","memory_efficiency","charts","successRate","memoryEfficiency","action","key","namespace","tool","message","Object","entries","map","value","JSON","stringify","executeTool","toolName","parameters","options","isToolAvailable","Error","execution","id","Date","now","Math","random","toString","substr","startTime","progress","push","addLog","length","executeToolDirect","error","formattedResult","formatResult","endTime","duration","processQueue","nextExecution","shift","executeToolsBatch","toolExecutions","batchId","results","parallel","promises","toolOptions","settled","Promise","allSettled","forEach","index","reason","i","progressCallback","completed","total","currentTool","stopOnError","successful","filter","r","failed","executeWorkflow","workflow","workflowId","context","name","steps","step","resolvedParameters","resolveParameters","outputVariable","required","currentStep","totalSteps","completedSteps","failedSteps","resolved","startsWith","varName","substring","formatter","get","allTools","values","toolCategories","flat","includes","getToolsByCategory","category","getCategories","getToolCategories","getExecutionStatus","queuedExecutions","maxConcurrent","cancelExecution","executionId","queueIndex","findIndex","e","splice","getPredefinedWorkflows","neural_training_pipeline","description","training_data","input","prediction","swarm_deployment","type","interval","performance_analysis","format","component","metric","period","executePredefinedWorkflow","workflowName","workflows","getStatus","mcpStatus","availableTools","availableWorkflows","keys"],"mappings":"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"}