{"version":3,"sources":["../../../src/migration/progress-reporter.ts"],"sourcesContent":["/**\r\n * Progress Reporter - Provides visual feedback during migration\r\n */\r\n\r\nimport * as chalk from 'chalk';\r\nimport type { MigrationProgress } from './types.js';\r\n\r\nexport class ProgressReporter {\r\n  private progress: MigrationProgress;\r\n  private startTime: Date;\r\n  private spinner: string[] = ['â ‹', 'â ™', 'â ¹', 'â ¸', 'â ¼', 'â ´', 'â ¦', 'â §', 'â ‡', 'â '];\r\n  private spinnerIndex: number = 0;\r\n  private intervalId: NodeJS.Timeout | null = null;\r\n\r\n  constructor() {\r\n    this.progress = {\r\n      total: 0,\r\n      completed: 0,\r\n      current: '',\r\n      phase: 'analyzing',\r\n      errors: 0,\r\n      warnings: 0,\r\n    };\r\n    this.startTime = new Date();\r\n  }\r\n\r\n  start(phase: MigrationProgress['phase'], message: string): void {\r\n    this.progress.phase = phase;\r\n    this.progress.current = message;\r\n    this.startTime = new Date();\r\n\r\n    console.log(chalk.bold(`\\nðŸš€ Starting ${phase}...`));\r\n    this.startSpinner();\r\n  }\r\n\r\n  update(\r\n    phase: MigrationProgress['phase'],\r\n    message: string,\r\n    completed?: number,\r\n    total?: number,\r\n  ): void {\r\n    this.progress.phase = phase;\r\n    this.progress.current = message;\r\n\r\n    if (completed !== undefined) {\r\n      this.progress.completed = completed;\r\n    }\r\n\r\n    if (total !== undefined) {\r\n      this.progress.total = total;\r\n    }\r\n\r\n    this.updateDisplay();\r\n  }\r\n\r\n  complete(message: string): void {\r\n    this.stopSpinner();\r\n\r\n    const duration = new Date().getTime() - this.startTime.getTime();\r\n    const seconds = (duration / 1000).toFixed(2);\r\n\r\n    console.log(chalk.green(`\\nâœ… ${message}`));\r\n    console.log(chalk.gray(`   Completed in ${seconds}s`));\r\n\r\n    if (this.progress.warnings > 0) {\r\n      console.log(chalk.yellow(`   ${this.progress.warnings} warnings`));\r\n    }\r\n\r\n    if (this.progress.errors > 0) {\r\n      console.log(chalk.red(`   ${this.progress.errors} errors`));\r\n    }\r\n  }\r\n\r\n  error(message: string): void {\r\n    this.stopSpinner();\r\n    console.log(chalk.red(`\\nâŒ ${message}`));\r\n    this.progress.errors++;\r\n  }\r\n\r\n  warning(message: string): void {\r\n    console.log(chalk.yellow(`âš ï¸  ${message}`));\r\n    this.progress.warnings++;\r\n  }\r\n\r\n  info(message: string): void {\r\n    console.log(chalk.blue(`â„¹ï¸  ${message}`));\r\n  }\r\n\r\n  private startSpinner(): void {\r\n    this.intervalId = setInterval(() => {\r\n      this.spinnerIndex = (this.spinnerIndex + 1) % this.spinner.length;\r\n      this.updateDisplay();\r\n    }, 100);\r\n  }\r\n\r\n  private stopSpinner(): void {\r\n    if (this.intervalId) {\r\n      clearInterval(this.intervalId);\r\n      this.intervalId = null;\r\n    }\r\n    // Clear the spinner line\r\n    process.stdout.write('\\r\\x1b[K');\r\n  }\r\n\r\n  private updateDisplay(): void {\r\n    const spinner = this.spinner[this.spinnerIndex];\r\n    const phase = this.getPhaseDisplay();\r\n    const progress = this.getProgressDisplay();\r\n\r\n    const message = `${spinner} ${phase} ${progress} ${this.progress.current}`;\r\n\r\n    // Clear line and write new message\r\n    process.stdout.write('\\r\\x1b[K' + message);\r\n  }\r\n\r\n  private getPhaseDisplay(): string {\r\n    const phases = {\r\n      analyzing: chalk.blue('ðŸ“Š Analyzing'),\r\n      'backing-up': chalk.yellow('ðŸ’¾ Backing up'),\r\n      migrating: chalk.green('ðŸ”„ Migrating'),\r\n      validating: chalk.cyan('âœ… Validating'),\r\n      complete: chalk.green('âœ… Complete'),\r\n    };\r\n\r\n    return phases[this.progress.phase] || chalk.gray('â³ Processing');\r\n  }\r\n\r\n  private getProgressDisplay(): string {\r\n    if (this.progress.total > 0) {\r\n      const percentage = Math.round((this.progress.completed / this.progress.total) * 100);\r\n      const progressBar = this.createProgressBar(percentage);\r\n      return `${progressBar} ${this.progress.completed}/${this.progress.total} (${percentage}%)`;\r\n    }\r\n    return '';\r\n  }\r\n\r\n  private createProgressBar(percentage: number, width: number = 20): string {\r\n    const filled = Math.round((percentage / 100) * width);\r\n    const empty = width - filled;\r\n\r\n    const filledBar = 'â–ˆ'.repeat(filled);\r\n    const emptyBar = 'â–‘'.repeat(empty);\r\n\r\n    return chalk.green(filledBar) + chalk.gray(emptyBar);\r\n  }\r\n\r\n  setTotal(total: number): void {\r\n    this.progress.total = total;\r\n  }\r\n\r\n  increment(message?: string): void {\r\n    this.progress.completed++;\r\n    if (message) {\r\n      this.progress.current = message;\r\n    }\r\n    this.updateDisplay();\r\n  }\r\n\r\n  getProgress(): MigrationProgress {\r\n    return { ...this.progress };\r\n  }\r\n}\r\n"],"names":["chalk","ProgressReporter","progress","startTime","spinner","spinnerIndex","intervalId","total","completed","current","phase","errors","warnings","Date","start","message","console","log","bold","startSpinner","update","undefined","updateDisplay","complete","stopSpinner","duration","getTime","seconds","toFixed","green","gray","yellow","red","error","warning","info","blue","setInterval","length","clearInterval","process","stdout","write","getPhaseDisplay","getProgressDisplay","phases","analyzing","migrating","validating","cyan","percentage","Math","round","progressBar","createProgressBar","width","filled","empty","filledBar","repeat","emptyBar","setTotal","increment","getProgress"],"mappings":"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"}