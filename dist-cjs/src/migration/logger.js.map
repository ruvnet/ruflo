{"version":3,"sources":["../../../src/migration/logger.ts"],"sourcesContent":["import * as process from 'node:process';\r\n/**\r\n * Migration Logger - Structured logging for migration operations\r\n */\r\n\r\nimport * as fs from 'fs-extra';\r\nimport * as path from 'path';\r\nimport * as chalk from 'chalk';\r\n\r\nexport interface LogEntry {\r\n  timestamp: Date;\r\n  level: 'info' | 'warn' | 'error' | 'success' | 'debug';\r\n  message: string;\r\n  context?: any;\r\n  stack?: string;\r\n}\r\n\r\nexport class MigrationLogger {\r\n  private logFile?: string;\r\n  private entries: LogEntry[] = [];\r\n\r\n  constructor(logFile?: string) {\r\n    this.logFile = logFile;\r\n  }\r\n\r\n  info(message: string, context?: any): void {\r\n    this.log('info', message, context);\r\n    console.log(chalk.blue(`‚ÑπÔ∏è  ${message}`));\r\n  }\r\n\r\n  warn(message: string, context?: any): void {\r\n    this.log('warn', message, context);\r\n    console.log(chalk.yellow(`‚ö†Ô∏è  ${message}`));\r\n  }\r\n\r\n  error(message: string, error?: Error | any, context?: any): void {\r\n    this.log('error', message, context, error?.stack);\r\n    console.log(chalk.red(`‚ùå ${message}`));\r\n    if (error && (error instanceof Error ? error.message : String(error)) !== message) {\r\n      console.log(chalk.red(`   ${error instanceof Error ? error.message : String(error)}`));\r\n    }\r\n  }\r\n\r\n  success(message: string, context?: any): void {\r\n    this.log('success', message, context);\r\n    console.log(chalk.green(`‚úÖ ${message}`));\r\n  }\r\n\r\n  debug(message: string, context?: any): void {\r\n    if (process.env.DEBUG === 'true' || process.env.NODE_ENV === 'development') {\r\n      this.log('debug', message, context);\r\n      console.log(chalk.gray(`üîç ${message}`));\r\n    }\r\n  }\r\n\r\n  private log(level: LogEntry['level'], message: string, context?: any, stack?: string): void {\r\n    const entry: LogEntry = {\r\n      timestamp: new Date(),\r\n      level,\r\n      message,\r\n      context,\r\n      stack,\r\n    };\r\n\r\n    this.entries.push(entry);\r\n\r\n    if (this.logFile) {\r\n      this.writeToFile(entry);\r\n    }\r\n  }\r\n\r\n  private async writeToFile(entry: LogEntry): Promise<void> {\r\n    if (!this.logFile) return;\r\n\r\n    try {\r\n      const logDir = path.dirname(this.logFile);\r\n      await fs.ensureDir(logDir);\r\n\r\n      const logLine = JSON.stringify(entry) + '\\n';\r\n      await fs.appendFile(this.logFile, logLine);\r\n    } catch (error) {\r\n      // Prevent recursive logging\r\n      console.error(\r\n        'Failed to write to log file:',\r\n        error instanceof Error ? error.message : String(error),\r\n      );\r\n    }\r\n  }\r\n\r\n  async saveToFile(filePath: string): Promise<void> {\r\n    await fs.ensureDir(path.dirname(filePath));\r\n    await fs.writeJson(filePath, this.entries, { spaces: 2 });\r\n  }\r\n\r\n  getEntries(): LogEntry[] {\r\n    return [...this.entries];\r\n  }\r\n\r\n  getEntriesByLevel(level: LogEntry['level']): LogEntry[] {\r\n    return this.entries.filter((entry) => entry.level === level);\r\n  }\r\n\r\n  clear(): void {\r\n    this.entries = [];\r\n  }\r\n\r\n  printSummary(): void {\r\n    const summary = {\r\n      total: this.entries.length,\r\n      info: this.getEntriesByLevel('info').length,\r\n      warn: this.getEntriesByLevel('warn').length,\r\n      error: this.getEntriesByLevel('error').length,\r\n      success: this.getEntriesByLevel('success').length,\r\n      debug: this.getEntriesByLevel('debug').length,\r\n    };\r\n\r\n    console.log(chalk.bold('\\nüìä Migration Log Summary'));\r\n    console.log(chalk.gray('‚îÄ'.repeat(30)));\r\n    console.log(`Total entries: ${summary.total}`);\r\n    console.log(`${chalk.blue('Info:')} ${summary.info}`);\r\n    console.log(`${chalk.green('Success:')} ${summary.success}`);\r\n    console.log(`${chalk.yellow('Warnings:')} ${summary.warn}`);\r\n    console.log(`${chalk.red('Errors:')} ${summary.error}`);\r\n    if (summary.debug > 0) {\r\n      console.log(`${chalk.gray('Debug:')} ${summary.debug}`);\r\n    }\r\n    console.log(chalk.gray('‚îÄ'.repeat(30)));\r\n  }\r\n}\r\n\r\n// Global logger instance\r\nexport const logger = new MigrationLogger();\r\n\r\n// Set log file if in production\r\nif (process.env.NODE_ENV === 'production') {\r\n  const logFile = path.join(process.cwd(), 'logs', 'migration.log');\r\n  logger['logFile'] = logFile;\r\n}\r\n"],"names":["process","fs","path","chalk","MigrationLogger","logFile","entries","info","message","context","log","console","blue","warn","yellow","error","stack","red","Error","String","success","green","debug","env","DEBUG","NODE_ENV","gray","level","entry","timestamp","Date","push","writeToFile","logDir","dirname","ensureDir","logLine","JSON","stringify","appendFile","saveToFile","filePath","writeJson","spaces","getEntries","getEntriesByLevel","filter","clear","printSummary","summary","total","length","bold","repeat","logger","join","cwd"],"mappings":"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"}