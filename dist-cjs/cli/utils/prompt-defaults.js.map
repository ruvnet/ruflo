{
  "version": 3,
  "sources": ["../../../src/cli/utils/prompt-defaults.ts"],
  "sourcesContent": ["/**\n * Prompt Defaults System for Non-Interactive Mode\n *\n * This module provides a system for supplying default values\n * to prompts when running in non-interactive mode.\n */\n\nimport { existsSync, readFileSync, writeFileSync } from 'node:fs';\nimport { join } from 'node:path';\nimport { homedir } from 'node:os';\n\nexport interface PromptDefault {\n  id: string;\n  type: 'text' | 'confirm' | 'select' | 'multiselect' | 'number';\n  pattern?: RegExp | string;\n  defaultValue: any;\n  description?: string;\n}\n\nexport interface PromptDefaultsConfig {\n  global?: PromptDefault[];\n  command?: {\n    [command: string]: PromptDefault[];\n  };\n  environment?: {\n    [env: string]: PromptDefault[];\n  };\n}\n\nexport class PromptDefaultsManager {\n  private config: PromptDefaultsConfig = {};\n  private configPath: string;\n  private environmentDefaults: Map<string, any> = new Map();\n\n  constructor(configPath?: string) {\n    this.configPath = configPath || join(homedir(), '.claude-flow', 'prompt-defaults.json');\n    this.loadConfig();\n    this.loadEnvironmentDefaults();\n  }\n\n  /**\n   * Load configuration from file\n   */\n  private loadConfig(): void {\n    try {\n      if (existsSync(this.configPath)) {\n        const content = readFileSync(this.configPath, 'utf-8');\n        this.config = JSON.parse(content);\n      }\n    } catch (error) {\n      // Silently fail, use empty config\n      this.config = {};\n    }\n  }\n\n  /**\n   * Save configuration to file\n   */\n  private saveConfig(): void {\n    try {\n      const dir = join(this.configPath, '..');\n      if (!existsSync(dir)) {\n        require('fs').mkdirSync(dir, { recursive: true });\n      }\n      writeFileSync(this.configPath, JSON.stringify(this.config, null, 2));\n    } catch (error) {\n      // Silently fail\n    }\n  }\n\n  /**\n   * Load defaults from environment variables\n   */\n  private loadEnvironmentDefaults(): void {\n    const env = process.env;\n\n    // Common defaults from environment\n    if (env.CLAUDE_AUTO_APPROVE === '1' || env.CLAUDE_AUTO_APPROVE === 'true') {\n      this.environmentDefaults.set('confirm:*', true);\n    }\n\n    if (env.CLAUDE_DEFAULT_MODEL) {\n      this.environmentDefaults.set('select:model', env.CLAUDE_DEFAULT_MODEL);\n    }\n\n    if (env.CLAUDE_DEFAULT_REGION) {\n      this.environmentDefaults.set('select:region', env.CLAUDE_DEFAULT_REGION);\n    }\n\n    // Parse CLAUDE_PROMPT_DEFAULTS if set\n    if (env.CLAUDE_PROMPT_DEFAULTS) {\n      try {\n        const defaults = JSON.parse(env.CLAUDE_PROMPT_DEFAULTS);\n        Object.entries(defaults).forEach(([key, value]) => {\n          this.environmentDefaults.set(key, value);\n        });\n      } catch (error) {\n        // Invalid JSON, ignore\n      }\n    }\n  }\n\n  /**\n   * Get default value for a prompt\n   */\n  getDefault(promptId: string, command?: string, promptType?: string): any {\n    // Check environment defaults first (highest priority)\n    const envKey = `${promptType || 'text'}:${promptId}`;\n    if (this.environmentDefaults.has(envKey)) {\n      return this.environmentDefaults.get(envKey);\n    }\n\n    // Check wildcard environment defaults\n    const wildcardKey = `${promptType || 'text'}:*`;\n    if (this.environmentDefaults.has(wildcardKey)) {\n      return this.environmentDefaults.get(wildcardKey);\n    }\n\n    // Check command-specific defaults\n    if (command && this.config.command?.[command]) {\n      const commandDefault = this.config.command[command].find(\n        (d) => d.id === promptId || (d.pattern && this.matchPattern(promptId, d.pattern)),\n      );\n      if (commandDefault) {\n        return commandDefault.defaultValue;\n      }\n    }\n\n    // Check environment-specific defaults\n    const currentEnv = process.env.NODE_ENV || 'development';\n    if (this.config.environment?.[currentEnv]) {\n      const envDefault = this.config.environment[currentEnv].find(\n        (d) => d.id === promptId || (d.pattern && this.matchPattern(promptId, d.pattern)),\n      );\n      if (envDefault) {\n        return envDefault.defaultValue;\n      }\n    }\n\n    // Check global defaults\n    if (this.config.global) {\n      const globalDefault = this.config.global.find(\n        (d) => d.id === promptId || (d.pattern && this.matchPattern(promptId, d.pattern)),\n      );\n      if (globalDefault) {\n        return globalDefault.defaultValue;\n      }\n    }\n\n    // Return undefined if no default found\n    return undefined;\n  }\n\n  /**\n   * Set a default value\n   */\n  setDefault(\n    promptId: string,\n    defaultValue: any,\n    options: {\n      command?: string;\n      type?: string;\n      pattern?: string | RegExp;\n      description?: string;\n      scope?: 'global' | 'command' | 'environment';\n    } = {},\n  ): void {\n    const defaultEntry: PromptDefault = {\n      id: promptId,\n      type: (options.type as any) || 'text',\n      defaultValue,\n      description: options.description,\n      pattern: options.pattern,\n    };\n\n    const scope = options.scope || 'global';\n\n    if (scope === 'command' && options.command) {\n      if (!this.config.command) {\n        this.config.command = {};\n      }\n      if (!this.config.command[options.command]) {\n        this.config.command[options.command] = [];\n      }\n      this.config.command[options.command].push(defaultEntry);\n    } else if (scope === 'environment') {\n      const currentEnv = process.env.NODE_ENV || 'development';\n      if (!this.config.environment) {\n        this.config.environment = {};\n      }\n      if (!this.config.environment[currentEnv]) {\n        this.config.environment[currentEnv] = [];\n      }\n      this.config.environment[currentEnv].push(defaultEntry);\n    } else {\n      if (!this.config.global) {\n        this.config.global = [];\n      }\n      this.config.global.push(defaultEntry);\n    }\n\n    this.saveConfig();\n  }\n\n  /**\n   * Get common defaults for non-interactive mode\n   */\n  getNonInteractiveDefaults(): Record<string, any> {\n    return {\n      // Confirmation prompts\n      'confirm:continue': true,\n      'confirm:overwrite': true,\n      'confirm:delete': false, // Safety: don't auto-confirm deletes\n      'confirm:deploy': false, // Safety: don't auto-confirm deploys\n\n      // Selection prompts\n      'select:model': 'claude-3-opus-20240229',\n      'select:region': 'us-east-1',\n      'select:topology': 'hierarchical',\n      'select:strategy': 'auto',\n\n      // Text prompts\n      'text:projectName': 'claude-flow-project',\n      'text:description': 'Claude Flow AI Project',\n\n      // Number prompts\n      'number:maxAgents': 4,\n      'number:timeout': 30000,\n      'number:port': 3000,\n    };\n  }\n\n  /**\n   * Apply non-interactive defaults if needed\n   */\n  applyNonInteractiveDefaults(isNonInteractive: boolean): void {\n    if (!isNonInteractive) return;\n\n    const defaults = this.getNonInteractiveDefaults();\n    Object.entries(defaults).forEach(([key, value]) => {\n      if (!this.environmentDefaults.has(key)) {\n        this.environmentDefaults.set(key, value);\n      }\n    });\n  }\n\n  /**\n   * Match a pattern against a prompt ID\n   */\n  private matchPattern(promptId: string, pattern: string | RegExp): boolean {\n    if (typeof pattern === 'string') {\n      // Simple wildcard matching\n      const regex = new RegExp(pattern.replace(/\\*/g, '.*'));\n      return regex.test(promptId);\n    } else {\n      return pattern.test(promptId);\n    }\n  }\n\n  /**\n   * Export current configuration\n   */\n  exportConfig(): PromptDefaultsConfig {\n    return JSON.parse(JSON.stringify(this.config));\n  }\n\n  /**\n   * Import configuration\n   */\n  importConfig(config: PromptDefaultsConfig): void {\n    this.config = JSON.parse(JSON.stringify(config));\n    this.saveConfig();\n  }\n\n  /**\n   * Clear all defaults\n   */\n  clearDefaults(scope?: 'global' | 'command' | 'environment', target?: string): void {\n    if (scope === 'command' && target && this.config.command) {\n      delete this.config.command[target];\n    } else if (scope === 'environment' && target && this.config.environment) {\n      delete this.config.environment[target];\n    } else if (scope === 'global' || !scope) {\n      this.config.global = [];\n    }\n\n    this.saveConfig();\n  }\n}\n\n// Singleton instance\nlet instance: PromptDefaultsManager | null = null;\n\nexport function getPromptDefaultsManager(configPath?: string): PromptDefaultsManager {\n  if (!instance) {\n    instance = new PromptDefaultsManager(configPath);\n  }\n  return instance;\n}\n\n// Convenience function for getting defaults\nexport function getPromptDefault(promptId: string, command?: string, promptType?: string): any {\n  return getPromptDefaultsManager().getDefault(promptId, command, promptType);\n}\n\n// Apply non-interactive defaults based on environment\nexport function applyNonInteractiveDefaults(flags: any): void {\n  const manager = getPromptDefaultsManager();\n  const isNonInteractive =\n    flags.nonInteractive || flags['non-interactive'] || flags.ci || !process.stdout.isTTY;\n  manager.applyNonInteractiveDefaults(isNonInteractive);\n}\n"],
  "mappings": "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",
  "names": []
}
