{"version":3,"sources":["../../../src/execution/provider-manager.ts"],"sourcesContent":["/**\r\n * Provider Manager - Handles multi-provider configuration and selection\r\n */\r\n\r\nimport fs from 'fs-extra';\r\nimport path from 'path';\r\nimport os from 'os';\r\n\r\nexport interface ProviderConfig {\r\n  name: 'anthropic' | 'openrouter' | 'onnx' | 'gemini';\r\n  model?: string;\r\n  apiKey?: string;\r\n  enabled: boolean;\r\n  priority?: 'cost' | 'quality' | 'speed' | 'privacy';\r\n}\r\n\r\nexport interface ExecutionConfig {\r\n  defaultProvider: string;\r\n  providers: Record<string, ProviderConfig>;\r\n  optimization?: {\r\n    strategy: 'balanced' | 'cost' | 'quality' | 'speed' | 'privacy';\r\n    maxCostPerTask?: number;\r\n  };\r\n}\r\n\r\nexport class ProviderManager {\r\n  private config: ExecutionConfig;\r\n  private configPath: string;\r\n\r\n  constructor() {\r\n    this.configPath = path.join(os.homedir(), '.claude', 'settings.json');\r\n    this.config = this.loadConfig();\r\n  }\r\n\r\n  /**\r\n   * Get default provider\r\n   */\r\n  getDefaultProvider(): string {\r\n    return this.config.defaultProvider || 'anthropic';\r\n  }\r\n\r\n  /**\r\n   * Get provider configuration\r\n   */\r\n  getProviderConfig(provider: string): ProviderConfig | null {\r\n    return this.config.providers?.[provider] || null;\r\n  }\r\n\r\n  /**\r\n   * Set default provider\r\n   */\r\n  async setDefaultProvider(provider: string): Promise<void> {\r\n    this.config.defaultProvider = provider;\r\n    await this.saveConfig();\r\n  }\r\n\r\n  /**\r\n   * Configure a provider\r\n   */\r\n  async configureProvider(\r\n    provider: string,\r\n    config: Partial<ProviderConfig>\r\n  ): Promise<void> {\r\n    if (!this.config.providers) {\r\n      this.config.providers = {};\r\n    }\r\n\r\n    this.config.providers[provider] = {\r\n      ...this.config.providers[provider],\r\n      name: provider as any,\r\n      ...config,\r\n    };\r\n\r\n    await this.saveConfig();\r\n  }\r\n\r\n  /**\r\n   * List available providers\r\n   */\r\n  listProviders(): ProviderConfig[] {\r\n    if (!this.config.providers) {\r\n      return this.getDefaultProviders();\r\n    }\r\n\r\n    return Object.values(this.config.providers);\r\n  }\r\n\r\n  /**\r\n   * Get optimization strategy\r\n   */\r\n  getOptimizationStrategy(): string {\r\n    return this.config.optimization?.strategy || 'balanced';\r\n  }\r\n\r\n  /**\r\n   * Load configuration from file\r\n   */\r\n  private loadConfig(): ExecutionConfig {\r\n    try {\r\n      if (fs.existsSync(this.configPath)) {\r\n        const data = fs.readFileSync(this.configPath, 'utf-8');\r\n        const settings = JSON.parse(data);\r\n        return settings['claude-flow']?.execution || this.getDefaultConfig();\r\n      }\r\n    } catch (error) {\r\n      console.warn('Failed to load provider config, using defaults');\r\n    }\r\n\r\n    return this.getDefaultConfig();\r\n  }\r\n\r\n  /**\r\n   * Save configuration to file\r\n   */\r\n  private async saveConfig(): Promise<void> {\r\n    try {\r\n      await fs.ensureDir(path.dirname(this.configPath));\r\n\r\n      let settings: any = {};\r\n      if (await fs.pathExists(this.configPath)) {\r\n        const data = await fs.readFile(this.configPath, 'utf-8');\r\n        settings = JSON.parse(data);\r\n      }\r\n\r\n      if (!settings['claude-flow']) {\r\n        settings['claude-flow'] = {};\r\n      }\r\n\r\n      settings['claude-flow'].execution = this.config;\r\n\r\n      await fs.writeFile(\r\n        this.configPath,\r\n        JSON.stringify(settings, null, 2),\r\n        'utf-8'\r\n      );\r\n    } catch (error: any) {\r\n      console.error('Failed to save provider config:', error.message);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get default configuration\r\n   */\r\n  private getDefaultConfig(): ExecutionConfig {\r\n    return {\r\n      defaultProvider: 'anthropic',\r\n      providers: {\r\n        anthropic: {\r\n          name: 'anthropic',\r\n          model: 'claude-sonnet-4-5-20250929',\r\n          enabled: true,\r\n          priority: 'quality',\r\n        },\r\n        openrouter: {\r\n          name: 'openrouter',\r\n          model: 'meta-llama/llama-3.1-8b-instruct',\r\n          enabled: true,\r\n          priority: 'cost',\r\n        },\r\n        onnx: {\r\n          name: 'onnx',\r\n          model: 'Xenova/gpt2',\r\n          enabled: true,\r\n          priority: 'privacy',\r\n        },\r\n        gemini: {\r\n          name: 'gemini',\r\n          enabled: true,\r\n          priority: 'cost',\r\n        },\r\n      },\r\n      optimization: {\r\n        strategy: 'balanced',\r\n        maxCostPerTask: 0.5,\r\n      },\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Get default providers list\r\n   */\r\n  private getDefaultProviders(): ProviderConfig[] {\r\n    return Object.values(this.getDefaultConfig().providers);\r\n  }\r\n}\r\n\r\nexport default ProviderManager;\r\n"],"names":["fs","path","os","ProviderManager","config","configPath","join","homedir","loadConfig","getDefaultProvider","defaultProvider","getProviderConfig","provider","providers","setDefaultProvider","saveConfig","configureProvider","name","listProviders","getDefaultProviders","Object","values","getOptimizationStrategy","optimization","strategy","existsSync","data","readFileSync","settings","JSON","parse","execution","getDefaultConfig","error","console","warn","ensureDir","dirname","pathExists","readFile","writeFile","stringify","message","anthropic","model","enabled","priority","openrouter","onnx","gemini","maxCostPerTask"],"mappings":"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"}