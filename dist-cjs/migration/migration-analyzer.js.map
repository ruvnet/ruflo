{
  "version": 3,
  "sources": ["../../src/migration/migration-analyzer.ts"],
  "sourcesContent": ["/**\n * Migration Analyzer - Analyzes existing projects for migration readiness\n */\n\nimport * as fs from 'fs-extra';\nimport * as path from 'path';\nimport * as crypto from 'crypto';\nimport type { MigrationAnalysis, MigrationRisk } from './types.js';\nimport { logger } from './logger.js';\nimport * as chalk from 'chalk';\nimport { glob } from 'glob';\n\nexport class MigrationAnalyzer {\n  private optimizedCommands = [\n    'sparc',\n    'sparc-architect',\n    'sparc-code',\n    'sparc-tdd',\n    'claude-flow-help',\n    'claude-flow-memory',\n    'claude-flow-swarm',\n  ];\n\n  async analyze(projectPath: string): Promise<MigrationAnalysis> {\n    logger.info(`Analyzing project at ${projectPath}...`);\n\n    const analysis: MigrationAnalysis = {\n      projectPath,\n      hasClaudeFolder: false,\n      hasOptimizedPrompts: false,\n      customCommands: [],\n      customConfigurations: {},\n      conflictingFiles: [],\n      migrationRisks: [],\n      recommendations: [],\n      timestamp: new Date(),\n    };\n\n    // Check for .claude folder\n    const claudePath = path.join(projectPath, '.claude');\n    if (await fs.pathExists(claudePath)) {\n      analysis.hasClaudeFolder = true;\n\n      // Analyze existing commands\n      await this.analyzeCommands(claudePath, analysis);\n\n      // Check for optimized prompts\n      await this.checkOptimizedPrompts(claudePath, analysis);\n\n      // Analyze configurations\n      await this.analyzeConfigurations(projectPath, analysis);\n\n      // Detect conflicts\n      await this.detectConflicts(projectPath, analysis);\n    }\n\n    // Generate risks and recommendations\n    this.assessRisks(analysis);\n    this.generateRecommendations(analysis);\n\n    return analysis;\n  }\n\n  private async analyzeCommands(claudePath: string, analysis: MigrationAnalysis): Promise<void> {\n    const commandsPath = path.join(claudePath, 'commands');\n\n    if (await fs.pathExists(commandsPath)) {\n      const files = await glob('**/*.md', { cwd: commandsPath });\n\n      for (const file of files) {\n        const commandName = path.basename(file, '.md');\n\n        if (!this.optimizedCommands.includes(commandName)) {\n          analysis.customCommands.push(commandName);\n        }\n      }\n    }\n  }\n\n  private async checkOptimizedPrompts(\n    claudePath: string,\n    analysis: MigrationAnalysis,\n  ): Promise<void> {\n    // Check for key optimized prompt files\n    const optimizedFiles = [\n      'BATCHTOOLS_GUIDE.md',\n      'BATCHTOOLS_BEST_PRACTICES.md',\n      'MIGRATION_GUIDE.md',\n      'PERFORMANCE_BENCHMARKS.md',\n    ];\n\n    let hasOptimized = 0;\n    for (const file of optimizedFiles) {\n      if (await fs.pathExists(path.join(claudePath, file))) {\n        hasOptimized++;\n      }\n    }\n\n    analysis.hasOptimizedPrompts = hasOptimized >= 2;\n  }\n\n  private async analyzeConfigurations(\n    projectPath: string,\n    analysis: MigrationAnalysis,\n  ): Promise<void> {\n    // Check for CLAUDE.md\n    const claudeMdPath = path.join(projectPath, 'CLAUDE.md');\n    if (await fs.pathExists(claudeMdPath)) {\n      const content = await fs.readFile(claudeMdPath, 'utf-8');\n      analysis.customConfigurations['CLAUDE.md'] = {\n        exists: true,\n        size: content.length,\n        hasCustomContent: !content.includes('SPARC Development Environment'),\n      };\n    }\n\n    // Check for .roomodes\n    const roomodesPath = path.join(projectPath, '.roomodes');\n    if (await fs.pathExists(roomodesPath)) {\n      try {\n        const roomodes = await fs.readJson(roomodesPath);\n        analysis.customConfigurations['.roomodes'] = {\n          exists: true,\n          modeCount: Object.keys(roomodes).length,\n          customModes: Object.keys(roomodes).filter(\n            (mode) => !['architect', 'code', 'tdd', 'debug', 'docs-writer'].includes(mode),\n          ),\n        };\n      } catch (error) {\n        analysis.migrationRisks.push({\n          level: 'medium',\n          description: 'Invalid .roomodes file',\n          file: roomodesPath,\n          mitigation: 'File will be backed up and replaced',\n        });\n      }\n    }\n  }\n\n  private async detectConflicts(projectPath: string, analysis: MigrationAnalysis): Promise<void> {\n    // Check for files that might conflict with migration\n    const potentialConflicts = [\n      '.claude/commands/sparc.md',\n      '.claude/BATCHTOOLS_GUIDE.md',\n      'memory/memory-store.json',\n      'coordination/config.json',\n    ];\n\n    for (const file of potentialConflicts) {\n      const filePath = path.join(projectPath, file);\n      if (await fs.pathExists(filePath)) {\n        const content = await fs.readFile(filePath, 'utf-8');\n        const checksum = crypto.createHash('md5').update(content).digest('hex');\n\n        // Check if it's a custom version\n        if (!this.isStandardFile(file, checksum)) {\n          analysis.conflictingFiles.push(file);\n        }\n      }\n    }\n  }\n\n  private isStandardFile(file: string, checksum: string): boolean {\n    // This would contain checksums of standard files\n    // For now, we'll assume all existing files are potentially custom\n    return false;\n  }\n\n  private assessRisks(analysis: MigrationAnalysis): void {\n    // High risk: Custom commands that might be overwritten\n    if (analysis.customCommands.length > 0) {\n      analysis.migrationRisks.push({\n        level: 'high',\n        description: `Found ${analysis.customCommands.length} custom commands that may be affected`,\n        mitigation: 'Use --preserve-custom flag or selective migration',\n      });\n    }\n\n    // Medium risk: Existing optimized prompts\n    if (analysis.hasOptimizedPrompts) {\n      analysis.migrationRisks.push({\n        level: 'medium',\n        description: 'Project already has some optimized prompts',\n        mitigation: 'Consider using merge strategy to preserve customizations',\n      });\n    }\n\n    // Low risk: No .claude folder\n    if (!analysis.hasClaudeFolder) {\n      analysis.migrationRisks.push({\n        level: 'low',\n        description: 'No existing .claude folder found',\n        mitigation: 'Fresh installation will be performed',\n      });\n    }\n\n    // High risk: Conflicting files\n    if (analysis.conflictingFiles.length > 0) {\n      analysis.migrationRisks.push({\n        level: 'high',\n        description: `${analysis.conflictingFiles.length} files may have custom modifications`,\n        mitigation: 'Files will be backed up before migration',\n      });\n    }\n  }\n\n  private generateRecommendations(analysis: MigrationAnalysis): void {\n    // Strategy recommendations\n    if (analysis.customCommands.length > 0 || analysis.conflictingFiles.length > 0) {\n      analysis.recommendations.push(\n        'Use \"selective\" or \"merge\" strategy to preserve customizations',\n      );\n    } else if (!analysis.hasClaudeFolder) {\n      analysis.recommendations.push('Use \"full\" strategy for clean installation');\n    }\n\n    // Backup recommendations\n    if (analysis.hasClaudeFolder) {\n      analysis.recommendations.push(\n        'Create a backup before migration (automatic with default settings)',\n      );\n    }\n\n    // Custom command recommendations\n    if (analysis.customCommands.length > 0) {\n      analysis.recommendations.push(\n        `Review custom commands: ${analysis.customCommands.join(', ')}`,\n      );\n    }\n\n    // Validation recommendations\n    if (analysis.migrationRisks.some((r) => r.level === 'high')) {\n      analysis.recommendations.push('Run with --dry-run first to preview changes');\n    }\n  }\n\n  printAnalysis(analysis: MigrationAnalysis, detailed: boolean = false): void {\n    console.log(chalk.bold('\\n\uD83D\uDCCA Migration Analysis Report'));\n    console.log(chalk.gray('\u2500'.repeat(50)));\n\n    console.log(`\\n${chalk.bold('Project:')} ${analysis.projectPath}`);\n    console.log(`${chalk.bold('Timestamp:')} ${analysis.timestamp.toISOString()}`);\n\n    // Status\n    console.log(chalk.bold('\\n\uD83D\uDCCB Current Status:'));\n    console.log(\n      `  \u2022 .claude folder: ${analysis.hasClaudeFolder ? chalk.green('\u2713') : chalk.red('\u2717')}`,\n    );\n    console.log(\n      `  \u2022 Optimized prompts: ${analysis.hasOptimizedPrompts ? chalk.green('\u2713') : chalk.red('\u2717')}`,\n    );\n    console.log(\n      `  \u2022 Custom commands: ${analysis.customCommands.length > 0 ? chalk.yellow(analysis.customCommands.length) : chalk.green('0')}`,\n    );\n    console.log(\n      `  \u2022 Conflicts: ${analysis.conflictingFiles.length > 0 ? chalk.yellow(analysis.conflictingFiles.length) : chalk.green('0')}`,\n    );\n\n    // Risks\n    if (analysis.migrationRisks.length > 0) {\n      console.log(chalk.bold('\\n\u26A0\uFE0F  Migration Risks:'));\n      analysis.migrationRisks.forEach((risk) => {\n        const icon = risk.level === 'high' ? '\uD83D\uDD34' : risk.level === 'medium' ? '\uD83D\uDFE1' : '\uD83D\uDFE2';\n        console.log(`  ${icon} ${chalk.bold(risk.level.toUpperCase())}: ${risk.description}`);\n        if (risk.mitigation) {\n          console.log(`     ${chalk.gray('\u2192')} ${chalk.italic(risk.mitigation)}`);\n        }\n      });\n    }\n\n    // Recommendations\n    if (analysis.recommendations.length > 0) {\n      console.log(chalk.bold('\\n\uD83D\uDCA1 Recommendations:'));\n      analysis.recommendations.forEach((rec) => {\n        console.log(`  \u2022 ${rec}`);\n      });\n    }\n\n    // Detailed information\n    if (detailed) {\n      if (analysis.customCommands.length > 0) {\n        console.log(chalk.bold('\\n\uD83D\uDD27 Custom Commands:'));\n        analysis.customCommands.forEach((cmd) => {\n          console.log(`  \u2022 ${cmd}`);\n        });\n      }\n\n      if (analysis.conflictingFiles.length > 0) {\n        console.log(chalk.bold('\\n\uD83D\uDCC1 Conflicting Files:'));\n        analysis.conflictingFiles.forEach((file) => {\n          console.log(`  \u2022 ${file}`);\n        });\n      }\n\n      if (Object.keys(analysis.customConfigurations).length > 0) {\n        console.log(chalk.bold('\\n\u2699\uFE0F  Configurations:'));\n        Object.entries(analysis.customConfigurations).forEach(([file, config]) => {\n          console.log(`  \u2022 ${file}: ${JSON.stringify(config, null, 2)}`);\n        });\n      }\n    }\n\n    console.log(chalk.gray('\\n' + '\u2500'.repeat(50)));\n  }\n\n  async saveAnalysis(analysis: MigrationAnalysis, outputPath: string): Promise<void> {\n    await fs.writeJson(outputPath, analysis, { spaces: 2 });\n  }\n}\n"],
  "mappings": "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",
  "names": []
}
