{"version":3,"sources":["../../../src/agents/agent-manager.ts"],"sourcesContent":["/**\r\n * Comprehensive agent management system\r\n */\r\n\r\nimport { EventEmitter } from 'node:events';\r\nimport { spawn, ChildProcess } from 'node:child_process';\r\nimport type { ILogger } from '../core/logger.js';\r\nimport type { IEventBus } from '../core/event-bus.js';\r\nimport type {\r\n  AgentId,\r\n  AgentType,\r\n  AgentStatus,\r\n  AgentState,\r\n  AgentCapabilities,\r\n  AgentConfig,\r\n  AgentEnvironment,\r\n  AgentMetrics,\r\n  AgentError,\r\n} from '../swarm/types.js';\r\nimport type { DistributedMemorySystem } from '../memory/distributed-memory.js';\r\nimport { generateId } from '../utils/helpers.js';\r\n\r\nexport interface AgentManagerConfig {\r\n  maxAgents: number;\r\n  defaultTimeout: number;\r\n  heartbeatInterval: number;\r\n  healthCheckInterval: number;\r\n  autoRestart: boolean;\r\n  resourceLimits: {\r\n    memory: number;\r\n    cpu: number;\r\n    disk: number;\r\n  };\r\n  agentDefaults: {\r\n    autonomyLevel: number;\r\n    learningEnabled: boolean;\r\n    adaptationEnabled: boolean;\r\n  };\r\n  environmentDefaults: {\r\n    runtime: 'deno' | 'node' | 'claude' | 'browser';\r\n    workingDirectory: string;\r\n    tempDirectory: string;\r\n    logDirectory: string;\r\n  };\r\n}\r\n\r\nexport interface AgentTemplate {\r\n  name: string;\r\n  type: AgentType;\r\n  capabilities: AgentCapabilities;\r\n  config: Partial<AgentConfig>;\r\n  environment: Partial<AgentEnvironment>;\r\n  startupScript?: string;\r\n  dependencies?: string[];\r\n}\r\n\r\nexport interface AgentCluster {\r\n  id: string;\r\n  name: string;\r\n  agents: AgentId[];\r\n  coordinator: AgentId;\r\n  strategy: 'round-robin' | 'load-based' | 'capability-based';\r\n  maxSize: number;\r\n  autoScale: boolean;\r\n}\r\n\r\nexport interface AgentPool {\r\n  id: string;\r\n  name: string;\r\n  type: AgentType;\r\n  minSize: number;\r\n  maxSize: number;\r\n  currentSize: number;\r\n  availableAgents: AgentId[];\r\n  busyAgents: AgentId[];\r\n  template: AgentTemplate;\r\n  autoScale: boolean;\r\n  scaleUpThreshold: number;\r\n  scaleDownThreshold: number;\r\n}\r\n\r\nexport interface ScalingPolicy {\r\n  name: string;\r\n  enabled: boolean;\r\n  rules: ScalingRule[];\r\n  cooldownPeriod: number;\r\n  maxScaleOperations: number;\r\n}\r\n\r\nexport interface ScalingRule {\r\n  metric: string;\r\n  threshold: number;\r\n  comparison: 'gt' | 'lt' | 'eq' | 'gte' | 'lte';\r\n  action: 'scale-up' | 'scale-down';\r\n  amount: number;\r\n  conditions?: string[];\r\n}\r\n\r\nexport interface AgentHealth {\r\n  agentId: string;\r\n  overall: number; // 0-1 health score\r\n  components: {\r\n    responsiveness: number;\r\n    performance: number;\r\n    reliability: number;\r\n    resourceUsage: number;\r\n  };\r\n  issues: HealthIssue[];\r\n  lastCheck: Date;\r\n  trend: 'improving' | 'stable' | 'degrading';\r\n}\r\n\r\nexport interface HealthIssue {\r\n  type: 'performance' | 'reliability' | 'resource' | 'communication';\r\n  severity: 'low' | 'medium' | 'high' | 'critical';\r\n  message: string;\r\n  timestamp: Date;\r\n  resolved: boolean;\r\n  recommendedAction?: string;\r\n}\r\n\r\n/**\r\n * Comprehensive agent lifecycle and resource management\r\n */\r\nexport class AgentManager extends EventEmitter {\r\n  private logger: ILogger;\r\n  private eventBus: IEventBus;\r\n  private memory: DistributedMemorySystem;\r\n  private config: AgentManagerConfig;\r\n\r\n  // Agent tracking\r\n  private agents = new Map<string, AgentState>();\r\n  private processes = new Map<string, ChildProcess>();\r\n  private templates = new Map<string, AgentTemplate>();\r\n  private clusters = new Map<string, AgentCluster>();\r\n  private pools = new Map<string, AgentPool>();\r\n\r\n  // Health monitoring\r\n  private healthChecks = new Map<string, AgentHealth>();\r\n  private healthInterval?: NodeJS.Timeout;\r\n  private heartbeatInterval?: NodeJS.Timeout;\r\n\r\n  // Scaling and policies\r\n  private scalingPolicies = new Map<string, ScalingPolicy>();\r\n  private scalingOperations = new Map<string, { timestamp: Date; type: string }>();\r\n\r\n  // Resource tracking\r\n  private resourceUsage = new Map<string, { cpu: number; memory: number; disk: number }>();\r\n  private performanceHistory = new Map<string, Array<{ timestamp: Date; metrics: AgentMetrics }>>();\r\n\r\n  constructor(\r\n    config: Partial<AgentManagerConfig>,\r\n    logger: ILogger,\r\n    eventBus: IEventBus,\r\n    memory: DistributedMemorySystem,\r\n  ) {\r\n    super();\r\n    this.logger = logger;\r\n    this.eventBus = eventBus;\r\n    this.memory = memory;\r\n\r\n    this.config = {\r\n      maxAgents: 50,\r\n      defaultTimeout: 30000,\r\n      heartbeatInterval: 10000,\r\n      healthCheckInterval: 30000,\r\n      autoRestart: true,\r\n      resourceLimits: {\r\n        memory: 512 * 1024 * 1024, // 512MB\r\n        cpu: 1.0,\r\n        disk: 1024 * 1024 * 1024, // 1GB\r\n      },\r\n      agentDefaults: {\r\n        autonomyLevel: 0.7,\r\n        learningEnabled: true,\r\n        adaptationEnabled: true,\r\n      },\r\n      environmentDefaults: {\r\n        runtime: 'deno',\r\n        workingDirectory: './agents',\r\n        tempDirectory: './tmp',\r\n        logDirectory: './logs',\r\n      },\r\n      ...config,\r\n    };\r\n\r\n    this.setupEventHandlers();\r\n    this.initializeDefaultTemplates();\r\n  }\r\n\r\n  private setupEventHandlers(): void {\r\n    this.eventBus.on('agent:heartbeat', (data: unknown) => {\r\n      const heartbeatData = data as { agentId: string; timestamp: Date; metrics?: AgentMetrics };\r\n      this.handleHeartbeat(heartbeatData);\r\n    });\r\n\r\n    this.eventBus.on('agent:error', (data: unknown) => {\r\n      const errorData = data as { agentId: string; error: AgentError };\r\n      this.handleAgentError(errorData);\r\n    });\r\n\r\n    this.eventBus.on('task:assigned', (data: unknown) => {\r\n      const taskData = data as { agentId: string };\r\n      this.updateAgentWorkload(taskData.agentId, 1);\r\n    });\r\n\r\n    this.eventBus.on('task:completed', (data: unknown) => {\r\n      const completedData = data as { agentId: string; metrics?: AgentMetrics };\r\n      this.updateAgentWorkload(completedData.agentId, -1);\r\n      if (completedData.metrics) {\r\n        this.updateAgentMetrics(completedData.agentId, completedData.metrics);\r\n      }\r\n    });\r\n\r\n    this.eventBus.on('resource:usage', (data: unknown) => {\r\n      const resourceData = data as {\r\n        agentId: string;\r\n        usage: { cpu: number; memory: number; disk: number };\r\n      };\r\n      this.updateResourceUsage(resourceData.agentId, resourceData.usage);\r\n    });\r\n  }\r\n\r\n  private initializeDefaultTemplates(): void {\r\n    // Research agent template\r\n    this.templates.set('researcher', {\r\n      name: 'Research Agent',\r\n      type: 'researcher',\r\n      capabilities: {\r\n        codeGeneration: false,\r\n        codeReview: false,\r\n        testing: false,\r\n        documentation: true,\r\n        research: true,\r\n        analysis: true,\r\n        webSearch: true,\r\n        apiIntegration: true,\r\n        fileSystem: true,\r\n        terminalAccess: false,\r\n        languages: [],\r\n        frameworks: [],\r\n        domains: ['research', 'analysis', 'information-gathering'],\r\n        tools: ['web-search', 'document-analysis', 'data-extraction'],\r\n        maxConcurrentTasks: 5,\r\n        maxMemoryUsage: 256 * 1024 * 1024,\r\n        maxExecutionTime: 600000,\r\n        reliability: 0.9,\r\n        speed: 0.8,\r\n        quality: 0.9,\r\n      },\r\n      config: {\r\n        autonomyLevel: 0.8,\r\n        learningEnabled: true,\r\n        adaptationEnabled: true,\r\n        maxTasksPerHour: 20,\r\n        maxConcurrentTasks: 5,\r\n        timeoutThreshold: 600000,\r\n        reportingInterval: 30000,\r\n        heartbeatInterval: 10000,\r\n        permissions: ['web-access', 'file-read'],\r\n        trustedAgents: [],\r\n        expertise: { research: 0.9, analysis: 0.8, documentation: 0.7 },\r\n        preferences: { verbose: true, detailed: true },\r\n      },\r\n      environment: {\r\n        runtime: 'deno',\r\n        version: '1.40.0',\r\n        workingDirectory: './agents/researcher',\r\n        tempDirectory: './tmp/researcher',\r\n        logDirectory: './logs/researcher',\r\n        apiEndpoints: {},\r\n        credentials: {},\r\n        availableTools: ['web-search', 'document-reader', 'data-extractor'],\r\n        toolConfigs: {},\r\n      },\r\n      startupScript: './scripts/start-researcher.ts',\r\n    });\r\n\r\n    // Developer agent template\r\n    this.templates.set('coder', {\r\n      name: 'Developer Agent',\r\n      type: 'coder',\r\n      capabilities: {\r\n        codeGeneration: true,\r\n        codeReview: true,\r\n        testing: true,\r\n        documentation: true,\r\n        research: false,\r\n        analysis: true,\r\n        webSearch: false,\r\n        apiIntegration: true,\r\n        fileSystem: true,\r\n        terminalAccess: true,\r\n        languages: ['typescript', 'javascript', 'python', 'rust'],\r\n        frameworks: ['deno', 'node', 'react', 'svelte'],\r\n        domains: ['web-development', 'backend', 'api-design'],\r\n        tools: ['git', 'editor', 'debugger', 'linter', 'formatter'],\r\n        maxConcurrentTasks: 3,\r\n        maxMemoryUsage: 512 * 1024 * 1024,\r\n        maxExecutionTime: 1200000,\r\n        reliability: 0.95,\r\n        speed: 0.7,\r\n        quality: 0.95,\r\n      },\r\n      config: {\r\n        autonomyLevel: 0.6,\r\n        learningEnabled: true,\r\n        adaptationEnabled: true,\r\n        maxTasksPerHour: 10,\r\n        maxConcurrentTasks: 3,\r\n        timeoutThreshold: 1200000,\r\n        reportingInterval: 60000,\r\n        heartbeatInterval: 15000,\r\n        permissions: ['file-read', 'file-write', 'terminal-access', 'git-access'],\r\n        trustedAgents: [],\r\n        expertise: { coding: 0.95, testing: 0.8, debugging: 0.9 },\r\n        preferences: { codeStyle: 'functional', testFramework: 'deno-test' },\r\n      },\r\n      environment: {\r\n        runtime: 'deno',\r\n        version: '1.40.0',\r\n        workingDirectory: './agents/developer',\r\n        tempDirectory: './tmp/developer',\r\n        logDirectory: './logs/developer',\r\n        apiEndpoints: {},\r\n        credentials: {},\r\n        availableTools: ['git', 'deno', 'editor', 'debugger'],\r\n        toolConfigs: {},\r\n      },\r\n      startupScript: './scripts/start-developer.ts',\r\n    });\r\n\r\n    // Add more templates...\r\n    this.initializeSpecializedTemplates();\r\n  }\r\n\r\n  private initializeSpecializedTemplates(): void {\r\n    // Analyzer template\r\n    this.templates.set('analyst', {\r\n      name: 'Analyzer Agent',\r\n      type: 'analyst',\r\n      capabilities: {\r\n        codeGeneration: false,\r\n        codeReview: true,\r\n        testing: false,\r\n        documentation: true,\r\n        research: false,\r\n        analysis: true,\r\n        webSearch: false,\r\n        apiIntegration: true,\r\n        fileSystem: true,\r\n        terminalAccess: false,\r\n        languages: ['python', 'r', 'sql'],\r\n        frameworks: ['pandas', 'numpy', 'matplotlib'],\r\n        domains: ['data-analysis', 'statistics', 'visualization'],\r\n        tools: ['data-processor', 'chart-generator', 'statistical-analyzer'],\r\n        maxConcurrentTasks: 4,\r\n        maxMemoryUsage: 1024 * 1024 * 1024,\r\n        maxExecutionTime: 900000,\r\n        reliability: 0.9,\r\n        speed: 0.75,\r\n        quality: 0.9,\r\n      },\r\n      config: {\r\n        autonomyLevel: 0.7,\r\n        learningEnabled: true,\r\n        adaptationEnabled: true,\r\n        maxTasksPerHour: 15,\r\n        maxConcurrentTasks: 4,\r\n        timeoutThreshold: 900000,\r\n        reportingInterval: 45000,\r\n        heartbeatInterval: 12000,\r\n        permissions: ['file-read', 'data-access'],\r\n        trustedAgents: [],\r\n        expertise: { analysis: 0.95, visualization: 0.8, statistics: 0.85 },\r\n        preferences: { outputFormat: 'detailed', includeCharts: true },\r\n      },\r\n      environment: {\r\n        runtime: 'deno',\r\n        version: '1.40.0',\r\n        workingDirectory: './agents/analyzer',\r\n        tempDirectory: './tmp/analyzer',\r\n        logDirectory: './logs/analyzer',\r\n        apiEndpoints: {},\r\n        credentials: {},\r\n        availableTools: ['data-processor', 'chart-gen', 'stats-calc'],\r\n        toolConfigs: {},\r\n      },\r\n      startupScript: './scripts/start-analyzer.ts',\r\n    });\r\n\r\n    // Requirements Engineer Agent Template\r\n    this.templates.set('requirements-engineer', {\r\n      name: 'Requirements Engineer Agent',\r\n      type: 'requirements-engineer',\r\n      capabilities: {\r\n        codeGeneration: false,\r\n        codeReview: false,\r\n        testing: false,\r\n        documentation: true,\r\n        research: true,\r\n        analysis: true,\r\n        webSearch: true,\r\n        apiIntegration: false,\r\n        fileSystem: true,\r\n        terminalAccess: false,\r\n        languages: [],\r\n        frameworks: [],\r\n        domains: ['requirements-engineering', 'user-stories', 'ears-notation'],\r\n        tools: ['document-writer', 'nlp-processor', 'web-search'],\r\n        maxConcurrentTasks: 2,\r\n        maxMemoryUsage: 256 * 1024 * 1024,\r\n        maxExecutionTime: 300000,\r\n        reliability: 0.95,\r\n        speed: 0.8,\r\n        quality: 0.95,\r\n      },\r\n      config: {\r\n        autonomyLevel: 0.8,\r\n        learningEnabled: true,\r\n        adaptationEnabled: true,\r\n        maxTasksPerHour: 10,\r\n        maxConcurrentTasks: 2,\r\n        timeoutThreshold: 300000,\r\n        reportingInterval: 30000,\r\n        heartbeatInterval: 10000,\r\n        permissions: ['file-read', 'file-write'],\r\n        trustedAgents: [],\r\n        expertise: { requirements: 0.95, documentation: 0.9, analysis: 0.8 },\r\n        preferences: { format: 'markdown', style: 'formal' },\r\n      },\r\n      environment: {\r\n        runtime: 'deno',\r\n        version: '1.40.0',\r\n        workingDirectory: './agents/requirements-engineer',\r\n        tempDirectory: './tmp/requirements-engineer',\r\n        logDirectory: './logs/requirements-engineer',\r\n        apiEndpoints: {},\r\n        credentials: {},\r\n        availableTools: ['document-writer', 'nlp-processor'],\r\n        toolConfigs: {},\r\n      },\r\n      startupScript: './scripts/start-requirements-engineer.ts',\r\n    });\r\n\r\n    // Design Architect Agent Template\r\n    this.templates.set('design-architect', {\r\n      name: 'Design Architect Agent',\r\n      type: 'design-architect',\r\n      capabilities: {\r\n        codeGeneration: false,\r\n        codeReview: true,\r\n        testing: false,\r\n        documentation: true,\r\n        research: true,\r\n        analysis: true,\r\n        webSearch: false,\r\n        apiIntegration: true,\r\n        fileSystem: true,\r\n        terminalAccess: false,\r\n        languages: ['typescript', 'javascript', 'python'],\r\n        frameworks: [],\r\n        domains: ['software-architecture', 'system-design', 'data-modeling'],\r\n        tools: ['diagram-generator', 'code-analyzer', 'api-designer'],\r\n        maxConcurrentTasks: 1,\r\n        maxMemoryUsage: 512 * 1024 * 1024,\r\n        maxExecutionTime: 600000,\r\n        reliability: 0.9,\r\n        speed: 0.7,\r\n        quality: 0.95,\r\n      },\r\n      config: {\r\n        autonomyLevel: 0.7,\r\n        learningEnabled: true,\r\n        adaptationEnabled: true,\r\n        maxTasksPerHour: 5,\r\n        maxConcurrentTasks: 1,\r\n        timeoutThreshold: 600000,\r\n        reportingInterval: 60000,\r\n        heartbeatInterval: 15000,\r\n        permissions: ['file-read', 'file-write'],\r\n        trustedAgents: [],\r\n        expertise: { architecture: 0.95, design: 0.9, modeling: 0.85 },\r\n        preferences: { diagramFormat: 'mermaid', detailLevel: 'high' },\r\n      },\r\n      environment: {\r\n        runtime: 'deno',\r\n        version: '1.40.0',\r\n        workingDirectory: './agents/design-architect',\r\n        tempDirectory: './tmp/design-architect',\r\n        logDirectory: './logs/design-architect',\r\n        apiEndpoints: {},\r\n        credentials: {},\r\n        availableTools: ['diagram-gen', 'code-analyzer'],\r\n        toolConfigs: {},\r\n      },\r\n      startupScript: './scripts/start-design-architect.ts',\r\n    });\r\n\r\n    // Task Planner Agent Template\r\n    this.templates.set('task-planner', {\r\n      name: 'Task Planner Agent',\r\n      type: 'task-planner',\r\n      capabilities: {\r\n        codeGeneration: false,\r\n        codeReview: false,\r\n        testing: false,\r\n        documentation: true,\r\n        research: false,\r\n        analysis: true,\r\n        webSearch: false,\r\n        apiIntegration: false,\r\n        fileSystem: true,\r\n        terminalAccess: false,\r\n        languages: [],\r\n        frameworks: [],\r\n        domains: ['project-management', 'task-breakdown', 'agile-planning'],\r\n        tools: ['task-scheduler', 'dependency-analyzer'],\r\n        maxConcurrentTasks: 3,\r\n        maxMemoryUsage: 256 * 1024 * 1024,\r\n        maxExecutionTime: 300000,\r\n        reliability: 0.95,\r\n        speed: 0.85,\r\n        quality: 0.9,\r\n      },\r\n      config: {\r\n        autonomyLevel: 0.8,\r\n        learningEnabled: true,\r\n        adaptationEnabled: true,\r\n        maxTasksPerHour: 20,\r\n        maxConcurrentTasks: 3,\r\n        timeoutThreshold: 300000,\r\n        reportingInterval: 30000,\r\n        heartbeatInterval: 10000,\r\n        permissions: ['file-read', 'file-write'],\r\n        trustedAgents: [],\r\n        expertise: { planning: 0.95, 'task-management': 0.9, optimization: 0.8 },\r\n        preferences: { outputFormat: 'markdown-checkbox', granularity: 'fine' },\r\n      },\r\n      environment: {\r\n        runtime: 'deno',\r\n        version: '1.40.0',\r\n        workingDirectory: './agents/task-planner',\r\n        tempDirectory: './tmp/task-planner',\r\n        logDirectory: './logs/task-planner',\r\n        apiEndpoints: {},\r\n        credentials: {},\r\n        availableTools: ['task-scheduler', 'dependency-analyzer'],\r\n        toolConfigs: {},\r\n      },\r\n      startupScript: './scripts/start-task-planner.ts',\r\n    });\r\n\r\n    // Developer Agent Template (already exists, but ensure it's aligned)\r\n    this.templates.set('developer', {\r\n      name: 'Developer Agent',\r\n      type: 'developer',\r\n      capabilities: {\r\n        codeGeneration: true,\r\n        codeReview: true,\r\n        testing: true,\r\n        documentation: true,\r\n        research: false,\r\n        analysis: true,\r\n        webSearch: false,\r\n        apiIntegration: true,\r\n        fileSystem: true,\r\n        terminalAccess: true,\r\n        languages: ['typescript', 'javascript', 'python', 'rust'],\r\n        frameworks: ['deno', 'node', 'react', 'svelte'],\r\n        domains: ['web-development', 'backend', 'api-design'],\r\n        tools: ['git', 'editor', 'debugger', 'linter', 'formatter'],\r\n        maxConcurrentTasks: 3,\r\n        maxMemoryUsage: 512 * 1024 * 1024,\r\n        maxExecutionTime: 1200000,\r\n        reliability: 0.95,\r\n        speed: 0.7,\r\n        quality: 0.95,\r\n      },\r\n      config: {\r\n        autonomyLevel: 0.6,\r\n        learningEnabled: true,\r\n        adaptationEnabled: true,\r\n        maxTasksPerHour: 10,\r\n        maxConcurrentTasks: 3,\r\n        timeoutThreshold: 1200000,\r\n        reportingInterval: 60000,\r\n        heartbeatInterval: 15000,\r\n        permissions: ['file-read', 'file-write', 'terminal-access', 'git-access'],\r\n        trustedAgents: [],\r\n        expertise: { coding: 0.95, testing: 0.8, debugging: 0.9 },\r\n        preferences: { codeStyle: 'functional', testFramework: 'deno-test' },\r\n      },\r\n      environment: {\r\n        runtime: 'deno',\r\n        version: '1.40.0',\r\n        workingDirectory: './agents/developer',\r\n        tempDirectory: './tmp/developer',\r\n        logDirectory: './logs/developer',\r\n        apiEndpoints: {},\r\n        credentials: {},\r\n        availableTools: ['git', 'deno', 'editor', 'debugger'],\r\n        toolConfigs: {},\r\n      },\r\n      startupScript: './scripts/start-developer.ts',\r\n    });\r\n\r\n    // System Architect Agent Template  \r\n    this.templates.set('system-architect', {\r\n      name: 'System Architect Agent',\r\n      type: 'system-architect',\r\n      capabilities: {\r\n        codeGeneration: false,\r\n        codeReview: true,\r\n        testing: false,\r\n        documentation: true,\r\n        research: true,\r\n        analysis: true,\r\n        webSearch: false,\r\n        apiIntegration: true,\r\n        fileSystem: true,\r\n        terminalAccess: false,\r\n        languages: ['typescript', 'javascript', 'python'],\r\n        frameworks: ['microservices', 'distributed-systems'],\r\n        domains: ['system-architecture', 'scalability', 'performance', 'distributed-systems'],\r\n        tools: ['architecture-analyzer', 'system-modeler', 'performance-analyzer'],\r\n        maxConcurrentTasks: 1,\r\n        maxMemoryUsage: 512 * 1024 * 1024,\r\n        maxExecutionTime: 900000,\r\n        reliability: 0.95,\r\n        speed: 0.7,\r\n        quality: 0.95,\r\n      },\r\n      config: {\r\n        autonomyLevel: 0.8,\r\n        learningEnabled: true,\r\n        adaptationEnabled: true,\r\n        maxTasksPerHour: 5,\r\n        maxConcurrentTasks: 1,\r\n        timeoutThreshold: 900000,\r\n        reportingInterval: 60000,\r\n        heartbeatInterval: 15000,\r\n        permissions: ['file-read', 'file-write'],\r\n        trustedAgents: [],\r\n        expertise: { 'system-architecture': 0.95, scalability: 0.9, performance: 0.85 },\r\n        preferences: { scope: 'system-wide', focusArea: 'architecture' },\r\n      },\r\n      environment: {\r\n        runtime: 'deno',\r\n        version: '1.40.0',\r\n        workingDirectory: './agents/system-architect',\r\n        tempDirectory: './tmp/system-architect',\r\n        logDirectory: './logs/system-architect',\r\n        apiEndpoints: {},\r\n        credentials: {},\r\n        availableTools: ['architecture-analyzer', 'system-modeler'],\r\n        toolConfigs: {},\r\n      },\r\n      startupScript: './scripts/start-system-architect.ts',\r\n    });\r\n\r\n    // Tester Agent Template\r\n    this.templates.set('tester', {\r\n      name: 'Testing Agent',\r\n      type: 'tester',\r\n      capabilities: {\r\n        codeGeneration: false,\r\n        codeReview: true,\r\n        testing: true,\r\n        documentation: true,\r\n        research: false,\r\n        analysis: true,\r\n        webSearch: false,\r\n        apiIntegration: true,\r\n        fileSystem: true,\r\n        terminalAccess: true,\r\n        languages: ['typescript', 'javascript', 'python'],\r\n        frameworks: ['deno-test', 'jest', 'vitest', 'cypress'],\r\n        domains: ['testing', 'quality-assurance', 'test-automation'],\r\n        tools: ['test-runner', 'coverage-analyzer', 'test-generator'],\r\n        maxConcurrentTasks: 3,\r\n        maxMemoryUsage: 256 * 1024 * 1024,\r\n        maxExecutionTime: 600000,\r\n        reliability: 0.9,\r\n        speed: 0.8,\r\n        quality: 0.9,\r\n      },\r\n      config: {\r\n        autonomyLevel: 0.7,\r\n        learningEnabled: true,\r\n        adaptationEnabled: true,\r\n        maxTasksPerHour: 15,\r\n        maxConcurrentTasks: 3,\r\n        timeoutThreshold: 600000,\r\n        reportingInterval: 45000,\r\n        heartbeatInterval: 12000,\r\n        permissions: ['file-read', 'file-write', 'terminal-access'],\r\n        trustedAgents: [],\r\n        expertise: { testing: 0.9, 'quality-assurance': 0.85, automation: 0.8 },\r\n        preferences: { testFramework: 'deno-test', coverage: 'comprehensive' },\r\n      },\r\n      environment: {\r\n        runtime: 'deno',\r\n        version: '1.40.0',\r\n        workingDirectory: './agents/tester',\r\n        tempDirectory: './tmp/tester',\r\n        logDirectory: './logs/tester',\r\n        apiEndpoints: {},\r\n        credentials: {},\r\n        availableTools: ['test-runner', 'coverage-tool', 'test-gen'],\r\n        toolConfigs: {},\r\n      },\r\n      startupScript: './scripts/start-tester.ts',\r\n    });\r\n\r\n    // Code Reviewer Agent Template\r\n    this.templates.set('reviewer', {\r\n      name: 'Code Review Agent',\r\n      type: 'reviewer',\r\n      capabilities: {\r\n        codeGeneration: false,\r\n        codeReview: true,\r\n        testing: false,\r\n        documentation: true,\r\n        research: false,\r\n        analysis: true,\r\n        webSearch: false,\r\n        apiIntegration: false,\r\n        fileSystem: true,\r\n        terminalAccess: false,\r\n        languages: ['typescript', 'javascript', 'python', 'rust'],\r\n        frameworks: ['static-analysis', 'code-quality'],\r\n        domains: ['code-review', 'quality-assurance', 'best-practices'],\r\n        tools: ['static-analyzer', 'code-quality-checker', 'security-scanner'],\r\n        maxConcurrentTasks: 2,\r\n        maxMemoryUsage: 256 * 1024 * 1024,\r\n        maxExecutionTime: 450000,\r\n        reliability: 0.95,\r\n        speed: 0.8,\r\n        quality: 0.95,\r\n      },\r\n      config: {\r\n        autonomyLevel: 0.8,\r\n        learningEnabled: true,\r\n        adaptationEnabled: true,\r\n        maxTasksPerHour: 12,\r\n        maxConcurrentTasks: 2,\r\n        timeoutThreshold: 450000,\r\n        reportingInterval: 30000,\r\n        heartbeatInterval: 10000,\r\n        permissions: ['file-read'],\r\n        trustedAgents: [],\r\n        expertise: { 'code-review': 0.95, 'quality-assurance': 0.9, security: 0.8 },\r\n        preferences: { style: 'thorough', focus: 'quality-and-security' },\r\n      },\r\n      environment: {\r\n        runtime: 'deno',\r\n        version: '1.40.0',\r\n        workingDirectory: './agents/reviewer',\r\n        tempDirectory: './tmp/reviewer',\r\n        logDirectory: './logs/reviewer',\r\n        apiEndpoints: {},\r\n        credentials: {},\r\n        availableTools: ['static-analyzer', 'quality-checker'],\r\n        toolConfigs: {},\r\n      },\r\n      startupScript: './scripts/start-reviewer.ts',\r\n    });\r\n\r\n    // Steering Author Agent Template\r\n    this.templates.set('steering-author', {\r\n      name: 'Steering Author Agent',\r\n      type: 'steering-author',\r\n      capabilities: {\r\n        codeGeneration: false,\r\n        codeReview: true,\r\n        testing: false,\r\n        documentation: true,\r\n        research: true,\r\n        analysis: true,\r\n        webSearch: false,\r\n        apiIntegration: false,\r\n        fileSystem: true,\r\n        terminalAccess: false,\r\n        languages: [],\r\n        frameworks: [],\r\n        domains: ['documentation', 'knowledge-management', 'governance'],\r\n        tools: ['document-writer', 'content-analyzer'],\r\n        maxConcurrentTasks: 1,\r\n        maxMemoryUsage: 256 * 1024 * 1024,\r\n        maxExecutionTime: 300000,\r\n        reliability: 0.95,\r\n        speed: 0.7,\r\n        quality: 0.98,\r\n      },\r\n      config: {\r\n        autonomyLevel: 0.7,\r\n        learningEnabled: true,\r\n        adaptationEnabled: true,\r\n        maxTasksPerHour: 5,\r\n        maxConcurrentTasks: 1,\r\n        timeoutThreshold: 300000,\r\n        reportingInterval: 30000,\r\n        heartbeatInterval: 10000,\r\n        permissions: ['file-read', 'file-write'],\r\n        trustedAgents: [],\r\n        expertise: { documentation: 0.98, governance: 0.9, 'content-creation': 0.85 },\r\n        preferences: { style: 'concise', tone: 'formal' },\r\n      },\r\n      environment: {\r\n        runtime: 'deno',\r\n        version: '1.40.0',\r\n        workingDirectory: './agents/steering-author',\r\n        tempDirectory: './tmp/steering-author',\r\n        logDirectory: './logs/steering-author',\r\n        apiEndpoints: {},\r\n        credentials: {},\r\n        availableTools: ['document-writer', 'content-analyzer'],\r\n        toolConfigs: {},\r\n      },\r\n      startupScript: './scripts/start-steering-author.ts',\r\n    });\r\n  }\r\n\r\n  async initialize(): Promise<void> {\r\n    this.logger.info('Initializing agent manager', {\r\n      maxAgents: this.config.maxAgents,\r\n      templates: this.templates.size,\r\n    });\r\n\r\n    // Start health monitoring\r\n    this.startHealthMonitoring();\r\n\r\n    // Start heartbeat monitoring\r\n    this.startHeartbeatMonitoring();\r\n\r\n    // Initialize default scaling policies\r\n    this.initializeScalingPolicies();\r\n\r\n    this.emit('agent-manager:initialized');\r\n  }\r\n\r\n  async shutdown(): Promise<void> {\r\n    this.logger.info('Shutting down agent manager');\r\n\r\n    // Stop monitoring\r\n    if (this.healthInterval) clearInterval(this.healthInterval);\r\n    if (this.heartbeatInterval) clearInterval(this.heartbeatInterval);\r\n\r\n    // Gracefully shutdown all agents\r\n    const shutdownPromises = Array.from(this.agents.keys()).map((agentId) =>\r\n      this.stopAgent(agentId, 'shutdown'),\r\n    );\r\n\r\n    await Promise.all(shutdownPromises);\r\n\r\n    this.emit('agent-manager:shutdown');\r\n  }\r\n\r\n  // === AGENT LIFECYCLE ===\r\n\r\n  async createAgent(\r\n    templateName: string,\r\n    overrides: {\r\n      name?: string;\r\n      config?: Partial<AgentConfig>;\r\n      environment?: Partial<AgentEnvironment>;\r\n    } = {},\r\n  ): Promise<string> {\r\n    if (this.agents.size >= this.config.maxAgents) {\r\n      throw new Error('Maximum agent limit reached');\r\n    }\r\n\r\n    const template = this.templates.get(templateName);\r\n    if (!template) {\r\n      throw new Error(`Template ${templateName} not found`);\r\n    }\r\n\r\n    const agentId = generateId('agent');\r\n    const swarmId = 'default'; // Could be parameterized\r\n\r\n    const agent: AgentState = {\r\n      id: { id: agentId, swarmId, type: template.type, instance: 1 },\r\n      name: overrides.name || `${template.name}-${agentId.slice(-8)}`,\r\n      type: template.type,\r\n      status: 'initializing',\r\n      capabilities: { ...template.capabilities },\r\n      metrics: this.createDefaultMetrics(),\r\n      workload: 0,\r\n      health: 1.0,\r\n      config: {\r\n        autonomyLevel: template.config.autonomyLevel ?? this.config.agentDefaults.autonomyLevel,\r\n        learningEnabled:\r\n          template.config.learningEnabled ?? this.config.agentDefaults.learningEnabled,\r\n        adaptationEnabled:\r\n          template.config.adaptationEnabled ?? this.config.agentDefaults.adaptationEnabled,\r\n        maxTasksPerHour: template.config.maxTasksPerHour ?? 10,\r\n        maxConcurrentTasks: template.config.maxConcurrentTasks ?? 3,\r\n        timeoutThreshold: template.config.timeoutThreshold ?? 300000,\r\n        reportingInterval: template.config.reportingInterval ?? 30000,\r\n        heartbeatInterval: template.config.heartbeatInterval ?? 10000,\r\n        permissions: template.config.permissions ?? [],\r\n        trustedAgents: template.config.trustedAgents ?? [],\r\n        expertise: template.config.expertise ?? {},\r\n        preferences: template.config.preferences ?? {},\r\n        ...overrides.config,\r\n      },\r\n      environment: {\r\n        runtime: template.environment.runtime ?? this.config.environmentDefaults.runtime,\r\n        version: template.environment.version ?? '1.40.0',\r\n        workingDirectory:\r\n          template.environment.workingDirectory ?? this.config.environmentDefaults.workingDirectory,\r\n        tempDirectory:\r\n          template.environment.tempDirectory ?? this.config.environmentDefaults.tempDirectory,\r\n        logDirectory:\r\n          template.environment.logDirectory ?? this.config.environmentDefaults.logDirectory,\r\n        apiEndpoints: template.environment.apiEndpoints ?? {},\r\n        credentials: template.environment.credentials ?? {},\r\n        availableTools: template.environment.availableTools ?? [],\r\n        toolConfigs: template.environment.toolConfigs ?? {},\r\n        ...overrides.environment,\r\n      },\r\n      endpoints: [],\r\n      lastHeartbeat: new Date(),\r\n      taskHistory: [],\r\n      errorHistory: [],\r\n      childAgents: [],\r\n      collaborators: [],\r\n    };\r\n\r\n    this.agents.set(agentId, agent);\r\n    this.healthChecks.set(agentId, this.createDefaultHealth(agentId));\r\n\r\n    this.logger.info('Created agent', {\r\n      agentId,\r\n      name: agent.name,\r\n      type: agent.type,\r\n      template: templateName,\r\n    });\r\n\r\n    this.emit('agent:created', { agent });\r\n\r\n    // Store in memory for persistence\r\n    await this.memory.store(`agent:${agentId}`, agent, {\r\n      type: 'agent-state',\r\n      tags: [agent.type, 'active'],\r\n      partition: 'state',\r\n    });\r\n\r\n    return agentId;\r\n  }\r\n\r\n  async startAgent(agentId: string): Promise<void> {\r\n    const agent = this.agents.get(agentId);\r\n    if (!agent) {\r\n      throw new Error(`Agent ${agentId} not found`);\r\n    }\r\n\r\n    if (agent.status !== 'initializing' && agent.status !== 'offline') {\r\n      throw new Error(`Agent ${agentId} cannot be started from status ${agent.status}`);\r\n    }\r\n\r\n    try {\r\n      agent.status = 'initializing';\r\n      this.updateAgentStatus(agentId, 'initializing');\r\n\r\n      // Spawn agent process\r\n      const process = await this.spawnAgentProcess(agent);\r\n      this.processes.set(agentId, process);\r\n\r\n      // Wait for agent to signal ready\r\n      await this.waitForAgentReady(agentId, this.config.defaultTimeout);\r\n\r\n      agent.status = 'idle';\r\n      this.updateAgentStatus(agentId, 'idle');\r\n\r\n      this.logger.info('Started agent', { agentId, name: agent.name });\r\n      this.emit('agent:started', { agent });\r\n    } catch (error) {\r\n      const errorMessage = error instanceof Error ? error.message : String(error);\r\n      agent.status = 'error';\r\n      this.addAgentError(agentId, {\r\n        timestamp: new Date(),\r\n        type: 'startup_failed',\r\n        message: errorMessage,\r\n        context: { agentId },\r\n        severity: 'critical',\r\n        resolved: false,\r\n      });\r\n\r\n      this.logger.error('Failed to start agent', { agentId, error });\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  async stopAgent(agentId: string, reason: string = 'user_request'): Promise<void> {\r\n    const agent = this.agents.get(agentId);\r\n    if (!agent) {\r\n      throw new Error(`Agent ${agentId} not found`);\r\n    }\r\n\r\n    if (agent.status === 'offline' || agent.status === 'terminated') {\r\n      return; // Already stopped\r\n    }\r\n\r\n    try {\r\n      agent.status = 'terminating';\r\n      this.updateAgentStatus(agentId, 'terminating');\r\n\r\n      // Send graceful shutdown signal\r\n      const process = this.processes.get(agentId);\r\n      if (process && !process.killed) {\r\n        process.kill('SIGTERM');\r\n\r\n        // Force kill after timeout\r\n        setTimeout(() => {\r\n          if (process && !process.killed) {\r\n            process.kill('SIGKILL');\r\n          }\r\n        }, this.config.defaultTimeout);\r\n      }\r\n\r\n      // Wait for process to exit\r\n      await this.waitForProcessExit(agentId, this.config.defaultTimeout);\r\n\r\n      agent.status = 'terminated';\r\n      this.updateAgentStatus(agentId, 'terminated');\r\n\r\n      // Cleanup\r\n      this.processes.delete(agentId);\r\n\r\n      this.logger.info('Stopped agent', { agentId, reason });\r\n      this.emit('agent:stopped', { agent, reason });\r\n    } catch (error) {\r\n      this.logger.error('Failed to stop agent gracefully', { agentId, error });\r\n      // Force cleanup\r\n      this.processes.delete(agentId);\r\n      agent.status = 'terminated';\r\n    }\r\n  }\r\n\r\n  async restartAgent(agentId: string, reason: string = 'restart_requested'): Promise<void> {\r\n    this.logger.info('Restarting agent', { agentId, reason });\r\n\r\n    await this.stopAgent(agentId, `restart:${reason}`);\r\n    await this.startAgent(agentId);\r\n\r\n    this.emit('agent:restarted', { agentId, reason });\r\n  }\r\n\r\n  async removeAgent(agentId: string): Promise<void> {\r\n    const agent = this.agents.get(agentId);\r\n    if (!agent) {\r\n      throw new Error(`Agent ${agentId} not found`);\r\n    }\r\n\r\n    // Stop agent if running\r\n    if (agent.status !== 'terminated' && agent.status !== 'offline') {\r\n      await this.stopAgent(agentId, 'removal');\r\n    }\r\n\r\n    // Remove from all data structures\r\n    this.agents.delete(agentId);\r\n    this.healthChecks.delete(agentId);\r\n    this.resourceUsage.delete(agentId);\r\n    this.performanceHistory.delete(agentId);\r\n\r\n    // Remove from pools and clusters\r\n    this.removeAgentFromPoolsAndClusters(agentId);\r\n\r\n    // Remove from memory\r\n    await this.memory.deleteEntry(`agent:${agentId}`);\r\n\r\n    this.logger.info('Removed agent', { agentId });\r\n    this.emit('agent:removed', { agentId });\r\n  }\r\n\r\n  // === AGENT POOLS ===\r\n\r\n  async createAgentPool(\r\n    name: string,\r\n    templateName: string,\r\n    config: {\r\n      minSize: number;\r\n      maxSize: number;\r\n      autoScale?: boolean;\r\n      scaleUpThreshold?: number;\r\n      scaleDownThreshold?: number;\r\n    },\r\n  ): Promise<string> {\r\n    const template = this.templates.get(templateName);\r\n    if (!template) {\r\n      throw new Error(`Template ${templateName} not found`);\r\n    }\r\n\r\n    const poolId = generateId('pool');\r\n    const pool: AgentPool = {\r\n      id: poolId,\r\n      name,\r\n      type: template.type,\r\n      minSize: config.minSize,\r\n      maxSize: config.maxSize,\r\n      currentSize: 0,\r\n      availableAgents: [],\r\n      busyAgents: [],\r\n      template,\r\n      autoScale: config.autoScale || false,\r\n      scaleUpThreshold: config.scaleUpThreshold || 0.8,\r\n      scaleDownThreshold: config.scaleDownThreshold || 0.3,\r\n    };\r\n\r\n    this.pools.set(poolId, pool);\r\n\r\n    // Create minimum agents\r\n    for (let i = 0; i < config.minSize; i++) {\r\n      const agentId = await this.createAgent(templateName, {\r\n        name: `${name}-${i + 1}`,\r\n      });\r\n      await this.startAgent(agentId);\r\n      pool.availableAgents.push({\r\n        id: agentId,\r\n        swarmId: 'default',\r\n        type: template.type,\r\n        instance: i + 1,\r\n      });\r\n      pool.currentSize++;\r\n    }\r\n\r\n    this.logger.info('Created agent pool', { poolId, name, minSize: config.minSize });\r\n    this.emit('pool:created', { pool });\r\n\r\n    return poolId;\r\n  }\r\n\r\n  async scalePool(poolId: string, targetSize: number): Promise<void> {\r\n    const pool = this.pools.get(poolId);\r\n    if (!pool) {\r\n      throw new Error(`Pool ${poolId} not found`);\r\n    }\r\n\r\n    if (targetSize < pool.minSize || targetSize > pool.maxSize) {\r\n      throw new Error(\r\n        `Target size ${targetSize} outside pool limits [${pool.minSize}, ${pool.maxSize}]`,\r\n      );\r\n    }\r\n\r\n    const currentSize = pool.currentSize;\r\n    const delta = targetSize - currentSize;\r\n\r\n    if (delta > 0) {\r\n      // Scale up\r\n      for (let i = 0; i < delta; i++) {\r\n        const agentId = await this.createAgent(pool.template.name, {\r\n          name: `${pool.name}-${currentSize + i + 1}`,\r\n        });\r\n        await this.startAgent(agentId);\r\n        pool.availableAgents.push({\r\n          id: agentId,\r\n          swarmId: 'default',\r\n          type: pool.type,\r\n          instance: currentSize + i + 1,\r\n        });\r\n      }\r\n    } else if (delta < 0) {\r\n      // Scale down\r\n      const agentsToRemove = pool.availableAgents.slice(0, Math.abs(delta));\r\n      for (const agentId of agentsToRemove) {\r\n        await this.removeAgent(agentId.id);\r\n        pool.availableAgents = pool.availableAgents.filter((a) => a.id !== agentId.id);\r\n      }\r\n    }\r\n\r\n    pool.currentSize = targetSize;\r\n\r\n    this.logger.info('Scaled pool', { poolId, fromSize: currentSize, toSize: targetSize });\r\n    this.emit('pool:scaled', { pool, fromSize: currentSize, toSize: targetSize });\r\n  }\r\n\r\n  // === HEALTH MONITORING ===\r\n\r\n  private startHealthMonitoring(): void {\r\n    this.healthInterval = setInterval(() => {\r\n      this.performHealthChecks();\r\n    }, this.config.healthCheckInterval);\r\n\r\n    this.logger.info('Started health monitoring', {\r\n      interval: this.config.healthCheckInterval,\r\n    });\r\n  }\r\n\r\n  private startHeartbeatMonitoring(): void {\r\n    this.heartbeatInterval = setInterval(() => {\r\n      this.checkHeartbeats();\r\n    }, this.config.heartbeatInterval);\r\n\r\n    this.logger.info('Started heartbeat monitoring', {\r\n      interval: this.config.heartbeatInterval,\r\n    });\r\n  }\r\n\r\n  private async performHealthChecks(): Promise<void> {\r\n    const healthPromises = Array.from(this.agents.keys()).map((agentId) =>\r\n      this.checkAgentHealth(agentId),\r\n    );\r\n\r\n    await Promise.allSettled(healthPromises);\r\n  }\r\n\r\n  private async checkAgentHealth(agentId: string): Promise<void> {\r\n    const agent = this.agents.get(agentId);\r\n    if (!agent) return;\r\n\r\n    const health = this.healthChecks.get(agentId);\r\n    if (!health) return;\r\n    const now = new Date();\r\n\r\n    try {\r\n      // Check responsiveness\r\n      const responsiveness = await this.checkResponsiveness(agentId);\r\n      health.components.responsiveness = responsiveness;\r\n\r\n      // Check performance\r\n      const performance = this.calculatePerformanceScore(agentId);\r\n      health.components.performance = performance;\r\n\r\n      // Check reliability\r\n      const reliability = this.calculateReliabilityScore(agentId);\r\n      health.components.reliability = reliability;\r\n\r\n      // Check resource usage\r\n      const resourceScore = this.calculateResourceScore(agentId);\r\n      health.components.resourceUsage = resourceScore;\r\n\r\n      // Calculate overall health\r\n      const overall = (responsiveness + performance + reliability + resourceScore) / 4;\r\n      health.overall = overall;\r\n      health.lastCheck = now;\r\n\r\n      // Update agent health\r\n      agent.health = overall;\r\n\r\n      // Check for issues\r\n      this.detectHealthIssues(agentId, health);\r\n\r\n      // Auto-restart if critically unhealthy\r\n      if (overall < 0.3 && this.config.autoRestart) {\r\n        this.logger.warn('Agent critically unhealthy, restarting', { agentId, health: overall });\r\n        await this.restartAgent(agentId, 'health_critical');\r\n      }\r\n    } catch (error) {\r\n      this.logger.error('Health check failed', { agentId, error });\r\n      health.overall = 0;\r\n      health.lastCheck = now;\r\n    }\r\n  }\r\n\r\n  private async checkResponsiveness(agentId: string): Promise<number> {\r\n    // Send ping and measure response time\r\n\r\n    try {\r\n      // This would send an actual ping to the agent\r\n      // For now, simulate based on last heartbeat\r\n      const agent = this.agents.get(agentId);\r\n      if (!agent) return 0;\r\n      const timeSinceHeartbeat = Date.now() - agent.lastHeartbeat.getTime();\r\n\r\n      if (timeSinceHeartbeat > this.config.heartbeatInterval * 3) {\r\n        return 0; // Unresponsive\r\n      } else if (timeSinceHeartbeat > this.config.heartbeatInterval * 2) {\r\n        return 0.5; // Slow\r\n      } else {\r\n        return 1.0; // Responsive\r\n      }\r\n    } catch (error) {\r\n      return 0; // Failed to respond\r\n    }\r\n  }\r\n\r\n  private calculatePerformanceScore(agentId: string): number {\r\n    const history = this.performanceHistory.get(agentId) || [];\r\n    if (history.length === 0) return 1.0;\r\n\r\n    // Calculate average task completion time vs expected\r\n    const recent = history.slice(-10); // Last 10 entries\r\n    const avgTime =\r\n      recent.reduce((sum, entry) => sum + entry.metrics.averageExecutionTime, 0) / recent.length;\r\n\r\n    // Normalize based on expected performance (simplified)\r\n    const expectedTime = 60000; // 1 minute baseline\r\n    return Math.max(0, Math.min(1, expectedTime / avgTime));\r\n  }\r\n\r\n  private calculateReliabilityScore(agentId: string): number {\r\n    const agent = this.agents.get(agentId);\r\n    if (!agent) return 0;\r\n    const totalTasks = agent.metrics.tasksCompleted + agent.metrics.tasksFailed;\r\n\r\n    if (totalTasks === 0) return 1.0;\r\n\r\n    return agent.metrics.tasksCompleted / totalTasks;\r\n  }\r\n\r\n  private calculateResourceScore(agentId: string): number {\r\n    const usage = this.resourceUsage.get(agentId);\r\n    if (!usage) return 1.0;\r\n\r\n    const limits = this.config.resourceLimits;\r\n    const memoryScore = 1 - usage.memory / limits.memory;\r\n    const cpuScore = 1 - usage.cpu / limits.cpu;\r\n    const diskScore = 1 - usage.disk / limits.disk;\r\n\r\n    return Math.max(0, (memoryScore + cpuScore + diskScore) / 3);\r\n  }\r\n\r\n  private detectHealthIssues(agentId: string, health: AgentHealth): void {\r\n    const issues: HealthIssue[] = [];\r\n\r\n    if (health.components.responsiveness < 0.5) {\r\n      issues.push({\r\n        type: 'communication',\r\n        severity: health.components.responsiveness < 0.2 ? 'critical' : 'high',\r\n        message: 'Agent is not responding to heartbeats',\r\n        timestamp: new Date(),\r\n        resolved: false,\r\n        recommendedAction: 'Restart agent or check network connectivity',\r\n      });\r\n    }\r\n\r\n    if (health.components.performance < 0.6) {\r\n      issues.push({\r\n        type: 'performance',\r\n        severity: health.components.performance < 0.3 ? 'high' : 'medium',\r\n        message: 'Agent performance is below expected levels',\r\n        timestamp: new Date(),\r\n        resolved: false,\r\n        recommendedAction: 'Check resource allocation or agent configuration',\r\n      });\r\n    }\r\n\r\n    if (health.components.resourceUsage < 0.4) {\r\n      issues.push({\r\n        type: 'resource',\r\n        severity: health.components.resourceUsage < 0.2 ? 'critical' : 'high',\r\n        message: 'Agent resource usage is critically high',\r\n        timestamp: new Date(),\r\n        resolved: false,\r\n        recommendedAction: 'Increase resource limits or reduce workload',\r\n      });\r\n    }\r\n\r\n    health.issues = issues;\r\n  }\r\n\r\n  private checkHeartbeats(): void {\r\n    const now = Date.now();\r\n    const timeout = this.config.heartbeatInterval * 3;\r\n\r\n    for (const [agentId, agent] of Array.from(this.agents.entries())) {\r\n      const timeSinceHeartbeat = now - agent.lastHeartbeat.getTime();\r\n\r\n      if (\r\n        timeSinceHeartbeat > timeout &&\r\n        agent.status !== 'offline' &&\r\n        agent.status !== 'terminated'\r\n      ) {\r\n        this.logger.warn('Agent heartbeat timeout', { agentId, timeSinceHeartbeat });\r\n\r\n        agent.status = 'error';\r\n        this.addAgentError(agentId, {\r\n          timestamp: new Date(),\r\n          type: 'heartbeat_timeout',\r\n          message: 'Agent failed to send heartbeat within timeout period',\r\n          context: { timeout, timeSinceHeartbeat },\r\n          severity: 'high',\r\n          resolved: false,\r\n        });\r\n\r\n        this.emit('agent:heartbeat-timeout', { agentId, timeSinceHeartbeat });\r\n\r\n        // Auto-restart if enabled\r\n        if (this.config.autoRestart) {\r\n          this.restartAgent(agentId, 'heartbeat_timeout').catch((error) => {\r\n            this.logger.error('Failed to auto-restart agent', { agentId, error });\r\n          });\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  // === UTILITY METHODS ===\r\n\r\n  private async spawnAgentProcess(agent: AgentState): Promise<ChildProcess> {\r\n    const env: NodeJS.ProcessEnv = {\r\n      ...process.env,\r\n      AGENT_ID: agent.id.id,\r\n      AGENT_TYPE: agent.type,\r\n      AGENT_NAME: agent.name,\r\n      WORKING_DIR: agent.environment.workingDirectory,\r\n      LOG_DIR: agent.environment.logDirectory,\r\n    };\r\n\r\n    const args = [\r\n      'run',\r\n      '--allow-all',\r\n      agent.environment.availableTools[0] || './agents/generic-agent.ts',\r\n      '--config',\r\n      JSON.stringify(agent.config),\r\n    ];\r\n\r\n    const childProcess = spawn(agent.environment.runtime, args, {\r\n      env,\r\n      stdio: ['pipe', 'pipe', 'pipe'],\r\n      cwd: agent.environment.workingDirectory,\r\n    });\r\n\r\n    // Handle process events\r\n    childProcess.on('exit', (code: number | null) => {\r\n      this.handleProcessExit(agent.id.id, code);\r\n    });\r\n\r\n    childProcess.on('error', (error: Error) => {\r\n      this.handleProcessError(agent.id.id, error);\r\n    });\r\n\r\n    return childProcess;\r\n  }\r\n\r\n  private async waitForAgentReady(agentId: string, timeout: number): Promise<void> {\r\n    return new Promise((resolve, reject) => {\r\n      const timer = setTimeout(() => {\r\n        reject(new Error(`Agent ${agentId} startup timeout`));\r\n      }, timeout);\r\n\r\n      const handler = (data: unknown) => {\r\n        const readyData = data as { agentId: string };\r\n        if (readyData.agentId === agentId) {\r\n          clearTimeout(timer);\r\n          this.eventBus.off('agent:ready', handler);\r\n          resolve();\r\n        }\r\n      };\r\n\r\n      this.eventBus.on('agent:ready', handler);\r\n    });\r\n  }\r\n\r\n  private async waitForProcessExit(agentId: string, timeout: number): Promise<void> {\r\n    return new Promise((resolve) => {\r\n      const process = this.processes.get(agentId);\r\n      if (!process || process.killed) {\r\n        resolve();\r\n        return;\r\n      }\r\n\r\n      const timer = setTimeout(() => {\r\n        resolve(); // Timeout, continue anyway\r\n      }, timeout);\r\n\r\n      process.on('exit', () => {\r\n        clearTimeout(timer);\r\n        resolve();\r\n      });\r\n    });\r\n  }\r\n\r\n  private handleProcessExit(agentId: string, code: number | null): void {\r\n    const agent = this.agents.get(agentId);\r\n    if (!agent) return;\r\n\r\n    this.logger.info('Agent process exited', { agentId, exitCode: code });\r\n\r\n    if (code !== 0 && code !== null) {\r\n      this.addAgentError(agentId, {\r\n        timestamp: new Date(),\r\n        type: 'process_exit',\r\n        message: `Agent process exited with code ${code}`,\r\n        context: { exitCode: code },\r\n        severity: 'high',\r\n        resolved: false,\r\n      });\r\n    }\r\n\r\n    agent.status = 'offline';\r\n    this.emit('agent:process-exit', { agentId, exitCode: code });\r\n  }\r\n\r\n  private handleProcessError(agentId: string, error: Error): void {\r\n    this.logger.error('Agent process error', { agentId, error });\r\n\r\n    this.addAgentError(agentId, {\r\n      timestamp: new Date(),\r\n      type: 'process_error',\r\n      message: error instanceof Error ? error.message : String(error),\r\n      context: { error: error.toString() },\r\n      severity: 'critical',\r\n      resolved: false,\r\n    });\r\n\r\n    this.emit('agent:process-error', { agentId, error });\r\n  }\r\n\r\n  private handleHeartbeat(data: {\r\n    agentId: string;\r\n    timestamp: Date;\r\n    metrics?: AgentMetrics;\r\n  }): void {\r\n    const agent = this.agents.get(data.agentId);\r\n    if (!agent) return;\r\n\r\n    agent.lastHeartbeat = data.timestamp;\r\n\r\n    if (data.metrics) {\r\n      this.updateAgentMetrics(data.agentId, data.metrics);\r\n    }\r\n\r\n    // Update health if agent was previously unresponsive\r\n    if (agent.status === 'error') {\r\n      agent.status = 'idle';\r\n      this.updateAgentStatus(data.agentId, 'idle');\r\n    }\r\n  }\r\n\r\n  private handleAgentError(data: { agentId: string; error: AgentError }): void {\r\n    this.addAgentError(data.agentId, data.error);\r\n\r\n    const agent = this.agents.get(data.agentId);\r\n    if (agent && data.error.severity === 'critical') {\r\n      agent.status = 'error';\r\n      this.updateAgentStatus(data.agentId, 'error');\r\n    }\r\n  }\r\n\r\n  private updateAgentStatus(agentId: string, status: AgentStatus): void {\r\n    const agent = this.agents.get(agentId);\r\n    if (!agent) return;\r\n\r\n    const oldStatus = agent.status;\r\n    agent.status = status;\r\n\r\n    this.emit('agent:status-changed', { agentId, from: oldStatus, to: status });\r\n  }\r\n\r\n  private updateAgentWorkload(agentId: string, delta: number): void {\r\n    const agent = this.agents.get(agentId);\r\n    if (!agent) return;\r\n\r\n    agent.workload = Math.max(0, agent.workload + delta);\r\n  }\r\n\r\n  private updateAgentMetrics(agentId: string, metrics: AgentMetrics): void {\r\n    const agent = this.agents.get(agentId);\r\n    if (!agent) return;\r\n\r\n    agent.metrics = { ...agent.metrics, ...metrics };\r\n\r\n    // Store performance history\r\n    const history = this.performanceHistory.get(agentId) || [];\r\n    history.push({ timestamp: new Date(), metrics: { ...metrics } });\r\n\r\n    // Keep only last 100 entries\r\n    if (history.length > 100) {\r\n      history.shift();\r\n    }\r\n\r\n    this.performanceHistory.set(agentId, history);\r\n  }\r\n\r\n  private updateResourceUsage(\r\n    agentId: string,\r\n    usage: { cpu: number; memory: number; disk: number },\r\n  ): void {\r\n    this.resourceUsage.set(agentId, usage);\r\n  }\r\n\r\n  private addAgentError(agentId: string, error: AgentError): void {\r\n    const agent = this.agents.get(agentId);\r\n    if (!agent) return;\r\n\r\n    agent.errorHistory.push(error);\r\n\r\n    // Keep only last 50 errors\r\n    if (agent.errorHistory.length > 50) {\r\n      agent.errorHistory.shift();\r\n    }\r\n  }\r\n\r\n  private createDefaultMetrics(): AgentMetrics {\r\n    return {\r\n      tasksCompleted: 0,\r\n      tasksFailed: 0,\r\n      averageExecutionTime: 0,\r\n      successRate: 1.0,\r\n      cpuUsage: 0,\r\n      memoryUsage: 0,\r\n      diskUsage: 0,\r\n      networkUsage: 0,\r\n      codeQuality: 0.8,\r\n      testCoverage: 0,\r\n      bugRate: 0,\r\n      userSatisfaction: 0.8,\r\n      totalUptime: 0,\r\n      lastActivity: new Date(),\r\n      responseTime: 0,\r\n    };\r\n  }\r\n\r\n  private createDefaultHealth(agentId: string): AgentHealth {\r\n    return {\r\n      agentId,\r\n      overall: 1.0,\r\n      components: {\r\n        responsiveness: 1.0,\r\n        performance: 1.0,\r\n        reliability: 1.0,\r\n        resourceUsage: 1.0,\r\n      },\r\n      issues: [],\r\n      lastCheck: new Date(),\r\n      trend: 'stable',\r\n    };\r\n  }\r\n\r\n  private removeAgentFromPoolsAndClusters(agentId: string): void {\r\n    // Remove from pools\r\n    for (const pool of Array.from(this.pools.values())) {\r\n      pool.availableAgents = pool.availableAgents.filter((a) => a.id !== agentId);\r\n      pool.busyAgents = pool.busyAgents.filter((a) => a.id !== agentId);\r\n      pool.currentSize = pool.availableAgents.length + pool.busyAgents.length;\r\n    }\r\n\r\n    // Remove from clusters\r\n    for (const cluster of Array.from(this.clusters.values())) {\r\n      cluster.agents = cluster.agents.filter((a) => a.id !== agentId);\r\n    }\r\n  }\r\n\r\n  private initializeScalingPolicies(): void {\r\n    // Default auto-scaling policy\r\n    const defaultPolicy: ScalingPolicy = {\r\n      name: 'default-autoscale',\r\n      enabled: true,\r\n      cooldownPeriod: 300000, // 5 minutes\r\n      maxScaleOperations: 10,\r\n      rules: [\r\n        {\r\n          metric: 'pool-utilization',\r\n          threshold: 0.8,\r\n          comparison: 'gt',\r\n          action: 'scale-up',\r\n          amount: 1,\r\n        },\r\n        {\r\n          metric: 'pool-utilization',\r\n          threshold: 0.3,\r\n          comparison: 'lt',\r\n          action: 'scale-down',\r\n          amount: 1,\r\n        },\r\n      ],\r\n    };\r\n\r\n    this.scalingPolicies.set('default', defaultPolicy);\r\n  }\r\n\r\n  // === PUBLIC API ===\r\n\r\n  getAgent(agentId: string): AgentState | undefined {\r\n    return this.agents.get(agentId);\r\n  }\r\n\r\n  getAllAgents(): AgentState[] {\r\n    return Array.from(this.agents.values());\r\n  }\r\n\r\n  getAgentsByType(type: AgentType): AgentState[] {\r\n    return Array.from(this.agents.values()).filter((agent) => agent.type === type);\r\n  }\r\n\r\n  getAgentsByStatus(status: AgentStatus): AgentState[] {\r\n    return Array.from(this.agents.values()).filter((agent) => agent.status === status);\r\n  }\r\n\r\n  getAgentHealth(agentId: string): AgentHealth | undefined {\r\n    return this.healthChecks.get(agentId);\r\n  }\r\n\r\n  getPool(poolId: string): AgentPool | undefined {\r\n    return this.pools.get(poolId);\r\n  }\r\n\r\n  getAllPools(): AgentPool[] {\r\n    return Array.from(this.pools.values());\r\n  }\r\n\r\n  getAgentTemplates(): AgentTemplate[] {\r\n    return Array.from(this.templates.values());\r\n  }\r\n\r\n  getSystemStats(): {\r\n    totalAgents: number;\r\n    activeAgents: number;\r\n    healthyAgents: number;\r\n    pools: number;\r\n    clusters: number;\r\n    averageHealth: number;\r\n    resourceUtilization: { cpu: number; memory: number; disk: number };\r\n  } {\r\n    const agents = Array.from(this.agents.values());\r\n    const healthChecks = Array.from(this.healthChecks.values());\r\n\r\n    const healthyAgents = healthChecks.filter((h) => h.overall > 0.7).length;\r\n    const averageHealth =\r\n      healthChecks.reduce((sum, h) => sum + h.overall, 0) / healthChecks.length || 1;\r\n\r\n    const resourceUsages = Array.from(this.resourceUsage.values());\r\n    const avgCpu = resourceUsages.reduce((sum, r) => sum + r.cpu, 0) / resourceUsages.length || 0;\r\n    const avgMemory =\r\n      resourceUsages.reduce((sum, r) => sum + r.memory, 0) / resourceUsages.length || 0;\r\n    const avgDisk = resourceUsages.reduce((sum, r) => sum + r.disk, 0) / resourceUsages.length || 0;\r\n\r\n    return {\r\n      totalAgents: agents.length,\r\n      activeAgents: agents.filter((a) => a.status === 'idle' || a.status === 'busy').length,\r\n      healthyAgents,\r\n      pools: this.pools.size,\r\n      clusters: this.clusters.size,\r\n      averageHealth,\r\n      resourceUtilization: {\r\n        cpu: avgCpu,\r\n        memory: avgMemory,\r\n        disk: avgDisk,\r\n      },\r\n    };\r\n  }\r\n}\r\n"],"names":["EventEmitter","spawn","generateId","AgentManager","logger","eventBus","memory","config","agents","Map","processes","templates","clusters","pools","healthChecks","healthInterval","heartbeatInterval","scalingPolicies","scalingOperations","resourceUsage","performanceHistory","maxAgents","defaultTimeout","healthCheckInterval","autoRestart","resourceLimits","cpu","disk","agentDefaults","autonomyLevel","learningEnabled","adaptationEnabled","environmentDefaults","runtime","workingDirectory","tempDirectory","logDirectory","setupEventHandlers","initializeDefaultTemplates","on","data","heartbeatData","handleHeartbeat","errorData","handleAgentError","taskData","updateAgentWorkload","agentId","completedData","metrics","updateAgentMetrics","resourceData","updateResourceUsage","usage","set","name","type","capabilities","codeGeneration","codeReview","testing","documentation","research","analysis","webSearch","apiIntegration","fileSystem","terminalAccess","languages","frameworks","domains","tools","maxConcurrentTasks","maxMemoryUsage","maxExecutionTime","reliability","speed","quality","maxTasksPerHour","timeoutThreshold","reportingInterval","permissions","trustedAgents","expertise","preferences","verbose","detailed","environment","version","apiEndpoints","credentials","availableTools","toolConfigs","startupScript","coding","debugging","codeStyle","testFramework","initializeSpecializedTemplates","visualization","statistics","outputFormat","includeCharts","requirements","format","style","architecture","design","modeling","diagramFormat","detailLevel","planning","optimization","granularity","scalability","performance","scope","focusArea","automation","coverage","security","focus","governance","tone","initialize","info","size","startHealthMonitoring","startHeartbeatMonitoring","initializeScalingPolicies","emit","shutdown","clearInterval","shutdownPromises","Array","from","keys","map","stopAgent","Promise","all","createAgent","templateName","overrides","Error","template","get","swarmId","agent","id","instance","slice","status","createDefaultMetrics","workload","health","endpoints","lastHeartbeat","Date","taskHistory","errorHistory","childAgents","collaborators","createDefaultHealth","store","tags","partition","startAgent","updateAgentStatus","process","spawnAgentProcess","waitForAgentReady","error","errorMessage","message","String","addAgentError","timestamp","context","severity","resolved","reason","killed","kill","setTimeout","waitForProcessExit","delete","restartAgent","removeAgent","removeAgentFromPoolsAndClusters","deleteEntry","createAgentPool","poolId","pool","minSize","maxSize","currentSize","availableAgents","busyAgents","autoScale","scaleUpThreshold","scaleDownThreshold","i","push","scalePool","targetSize","delta","agentsToRemove","Math","abs","filter","a","fromSize","toSize","setInterval","performHealthChecks","interval","checkHeartbeats","healthPromises","checkAgentHealth","allSettled","now","responsiveness","checkResponsiveness","components","calculatePerformanceScore","calculateReliabilityScore","resourceScore","calculateResourceScore","overall","lastCheck","detectHealthIssues","warn","timeSinceHeartbeat","getTime","history","length","recent","avgTime","reduce","sum","entry","averageExecutionTime","expectedTime","max","min","totalTasks","tasksCompleted","tasksFailed","limits","memoryScore","cpuScore","diskScore","issues","recommendedAction","timeout","entries","catch","env","AGENT_ID","AGENT_TYPE","AGENT_NAME","WORKING_DIR","LOG_DIR","args","JSON","stringify","childProcess","stdio","cwd","code","handleProcessExit","handleProcessError","resolve","reject","timer","handler","readyData","clearTimeout","off","exitCode","toString","oldStatus","to","shift","successRate","cpuUsage","memoryUsage","diskUsage","networkUsage","codeQuality","testCoverage","bugRate","userSatisfaction","totalUptime","lastActivity","responseTime","trend","values","cluster","defaultPolicy","enabled","cooldownPeriod","maxScaleOperations","rules","metric","threshold","comparison","action","amount","getAgent","getAllAgents","getAgentsByType","getAgentsByStatus","getAgentHealth","getPool","getAllPools","getAgentTemplates","getSystemStats","healthyAgents","h","averageHealth","resourceUsages","avgCpu","r","avgMemory","avgDisk","totalAgents","activeAgents","resourceUtilization"],"mappings":"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"}