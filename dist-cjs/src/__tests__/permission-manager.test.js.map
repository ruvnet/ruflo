{"version":3,"sources":["../../../src/__tests__/permission-manager.test.ts"],"sourcesContent":["/**\r\n * Permission Manager Tests\r\n *\r\n * Comprehensive test suite for 4-level hierarchical permission system\r\n */\r\n\r\nimport { describe, it, expect, beforeEach, afterEach } from '@jest/globals';\r\nimport { tmpdir } from 'os';\r\nimport { join } from 'path';\r\nimport { mkdir, rm, writeFile } from 'fs/promises';\r\nimport {\r\n  PermissionManager,\r\n  createPermissionManager,\r\n  permissionManager,\r\n} from '../permissions/permission-manager.js';\r\nimport type {\r\n  PermissionLevel,\r\n  PermissionQuery,\r\n  PermissionConfig,\r\n} from '../permissions/permission-manager.js';\r\n\r\n// ===== Test Helpers =====\r\n\r\nasync function createTestDirectory(): Promise<string> {\r\n  const testDir = join(tmpdir(), `perm-test-${Date.now()}`);\r\n  await mkdir(testDir, { recursive: true });\r\n  await mkdir(join(testDir, '.claude-flow'), { recursive: true });\r\n  return testDir;\r\n}\r\n\r\nasync function cleanupTestDirectory(dir: string): Promise<void> {\r\n  try {\r\n    await rm(dir, { recursive: true, force: true });\r\n  } catch (error) {\r\n    // Ignore cleanup errors\r\n  }\r\n}\r\n\r\nfunction createMockQuery(overrides?: Partial<PermissionQuery>): PermissionQuery {\r\n  return {\r\n    toolName: 'test-tool',\r\n    toolInput: {},\r\n    context: {\r\n      sessionId: 'test-session',\r\n      workingDir: '/test',\r\n    },\r\n    ...overrides,\r\n  };\r\n}\r\n\r\n// ===== Tests =====\r\n\r\ndescribe('PermissionManager', () => {\r\n  let manager: PermissionManager;\r\n  let testDir: string;\r\n\r\n  beforeEach(async () => {\r\n    testDir = await createTestDirectory();\r\n\r\n    manager = new PermissionManager({\r\n      cacheEnabled: true,\r\n      cacheTTL: 60000,\r\n      userConfigPath: join(testDir, 'user.json'),\r\n      projectConfigPath: join(testDir, '.claude-flow', 'permissions.json'),\r\n      localConfigPath: join(testDir, '.permissions.json'),\r\n    });\r\n\r\n    await manager.initialize();\r\n  });\r\n\r\n  afterEach(async () => {\r\n    manager.clearCache();\r\n    await cleanupTestDirectory(testDir);\r\n  });\r\n\r\n  describe('Initialization', () => {\r\n    it('should initialize with default configs', async () => {\r\n      const userConfig = manager.getConfig('user');\r\n      const projectConfig = manager.getConfig('project');\r\n      const localConfig = manager.getConfig('local');\r\n      const sessionConfig = manager.getConfig('session');\r\n\r\n      expect(userConfig).toBeDefined();\r\n      expect(projectConfig).toBeDefined();\r\n      expect(localConfig).toBeDefined();\r\n      expect(sessionConfig).toBeDefined();\r\n    });\r\n\r\n    it('should create default configs when files do not exist', async () => {\r\n      const config = manager.getConfig('user');\r\n\r\n      expect(config?.mode).toBe('default');\r\n      expect(config?.rules).toEqual([]);\r\n      expect(config?.allowedDirectories).toEqual([]);\r\n    });\r\n  });\r\n\r\n  describe('Permission Resolution', () => {\r\n    it('should resolve permission from session level', async () => {\r\n      await manager.updatePermissions('session', {\r\n        type: 'addRules',\r\n        rules: [{ toolName: 'test-tool' }],\r\n        behavior: 'allow',\r\n        destination: 'session',\r\n      });\r\n\r\n      const query = createMockQuery({ toolName: 'test-tool' });\r\n      const resolution = await manager.resolvePermission(query);\r\n\r\n      expect(resolution.behavior).toBe('allow');\r\n      expect(resolution.level).toBe('session');\r\n    });\r\n\r\n    it('should fallback to project level', async () => {\r\n      await manager.updatePermissions('project', {\r\n        type: 'addRules',\r\n        rules: [{ toolName: 'test-tool' }],\r\n        behavior: 'allow',\r\n        destination: 'projectSettings',\r\n      });\r\n\r\n      const query = createMockQuery({ toolName: 'test-tool' });\r\n      const resolution = await manager.resolvePermission(query);\r\n\r\n      expect(resolution.behavior).toBe('allow');\r\n      expect(resolution.level).toBe('project');\r\n    });\r\n\r\n    it('should fallback through entire chain', async () => {\r\n      await manager.updatePermissions('user', {\r\n        type: 'addRules',\r\n        rules: [{ toolName: 'test-tool' }],\r\n        behavior: 'deny',\r\n        destination: 'userSettings',\r\n      });\r\n\r\n      const query = createMockQuery({ toolName: 'test-tool' });\r\n      const resolution = await manager.resolvePermission(query);\r\n\r\n      expect(resolution.behavior).toBe('deny');\r\n      expect(resolution.level).toBe('user');\r\n      expect(resolution.fallbackChain).toContain('user');\r\n    });\r\n\r\n    it('should return ask when no rule found', async () => {\r\n      const query = createMockQuery({ toolName: 'unknown-tool' });\r\n      const resolution = await manager.resolvePermission(query);\r\n\r\n      expect(resolution.behavior).toBe('ask');\r\n    });\r\n\r\n    it('should respect priority within same level', async () => {\r\n      const sessionConfig = manager.getConfig('session');\r\n      if (sessionConfig) {\r\n        sessionConfig.rules.push(\r\n          {\r\n            toolName: 'test-tool',\r\n            behavior: 'deny',\r\n            scope: 'session',\r\n            priority: 50,\r\n            timestamp: Date.now(),\r\n          },\r\n          {\r\n            toolName: 'test-tool',\r\n            behavior: 'allow',\r\n            scope: 'session',\r\n            priority: 100,\r\n            timestamp: Date.now(),\r\n          }\r\n        );\r\n      }\r\n\r\n      const query = createMockQuery({ toolName: 'test-tool' });\r\n      const resolution = await manager.resolvePermission(query);\r\n\r\n      expect(resolution.behavior).toBe('allow'); // Higher priority wins\r\n    });\r\n  });\r\n\r\n  describe('Permission Updates', () => {\r\n    it('should add rules', async () => {\r\n      await manager.updatePermissions('session', {\r\n        type: 'addRules',\r\n        rules: [\r\n          { toolName: 'tool-1' },\r\n          { toolName: 'tool-2' },\r\n        ],\r\n        behavior: 'allow',\r\n        destination: 'session',\r\n      });\r\n\r\n      const config = manager.getConfig('session');\r\n      expect(config?.rules).toHaveLength(2);\r\n    });\r\n\r\n    it('should replace rules', async () => {\r\n      // Add initial rules\r\n      await manager.updatePermissions('session', {\r\n        type: 'addRules',\r\n        rules: [\r\n          { toolName: 'tool-1' },\r\n          { toolName: 'tool-2' },\r\n        ],\r\n        behavior: 'allow',\r\n        destination: 'session',\r\n      });\r\n\r\n      // Replace with new rules\r\n      await manager.updatePermissions('session', {\r\n        type: 'replaceRules',\r\n        rules: [{ toolName: 'tool-3' }],\r\n        behavior: 'deny',\r\n        destination: 'session',\r\n      });\r\n\r\n      const config = manager.getConfig('session');\r\n      expect(config?.rules).toHaveLength(1);\r\n      expect(config?.rules[0].toolName).toBe('tool-3');\r\n    });\r\n\r\n    it('should remove rules', async () => {\r\n      // Add rules\r\n      await manager.updatePermissions('session', {\r\n        type: 'addRules',\r\n        rules: [\r\n          { toolName: 'tool-1' },\r\n          { toolName: 'tool-2' },\r\n        ],\r\n        behavior: 'allow',\r\n        destination: 'session',\r\n      });\r\n\r\n      // Remove one rule\r\n      await manager.updatePermissions('session', {\r\n        type: 'removeRules',\r\n        rules: [{ toolName: 'tool-1' }],\r\n        behavior: 'allow',\r\n        destination: 'session',\r\n      });\r\n\r\n      const config = manager.getConfig('session');\r\n      expect(config?.rules).toHaveLength(1);\r\n      expect(config?.rules[0].toolName).toBe('tool-2');\r\n    });\r\n\r\n    it('should set mode', async () => {\r\n      await manager.updatePermissions('session', {\r\n        type: 'setMode',\r\n        mode: 'bypassPermissions',\r\n        destination: 'session',\r\n      });\r\n\r\n      const config = manager.getConfig('session');\r\n      expect(config?.mode).toBe('bypassPermissions');\r\n    });\r\n\r\n    it('should add directories', async () => {\r\n      await manager.updatePermissions('session', {\r\n        type: 'addDirectories',\r\n        directories: ['/test/dir1', '/test/dir2'],\r\n        destination: 'session',\r\n      });\r\n\r\n      const config = manager.getConfig('session');\r\n      expect(config?.allowedDirectories).toContain('/test/dir1');\r\n      expect(config?.allowedDirectories).toContain('/test/dir2');\r\n    });\r\n\r\n    it('should remove directories', async () => {\r\n      // Add directories\r\n      await manager.updatePermissions('session', {\r\n        type: 'addDirectories',\r\n        directories: ['/test/dir1', '/test/dir2'],\r\n        destination: 'session',\r\n      });\r\n\r\n      // Remove one\r\n      await manager.updatePermissions('session', {\r\n        type: 'removeDirectories',\r\n        directories: ['/test/dir1'],\r\n        destination: 'session',\r\n      });\r\n\r\n      const config = manager.getConfig('session');\r\n      expect(config?.allowedDirectories).not.toContain('/test/dir1');\r\n      expect(config?.allowedDirectories).toContain('/test/dir2');\r\n    });\r\n\r\n    it('should clear cache on updates', async () => {\r\n      const query = createMockQuery({ toolName: 'test-tool' });\r\n\r\n      // Create cached entry\r\n      await manager.resolvePermission(query);\r\n      expect(manager.getCacheStats().size).toBeGreaterThan(0);\r\n\r\n      // Update should clear cache\r\n      await manager.updatePermissions('session', {\r\n        type: 'addRules',\r\n        rules: [{ toolName: 'test-tool' }],\r\n        behavior: 'allow',\r\n        destination: 'session',\r\n      });\r\n\r\n      expect(manager.getCacheStats().size).toBe(0);\r\n    });\r\n  });\r\n\r\n  describe('Caching', () => {\r\n    it('should cache permission resolutions', async () => {\r\n      const query = createMockQuery({ toolName: 'test-tool' });\r\n\r\n      // First resolution\r\n      const resolution1 = await manager.resolvePermission(query);\r\n      expect(resolution1.cached).toBe(false);\r\n\r\n      // Second resolution should be cached\r\n      const resolution2 = await manager.resolvePermission(query);\r\n      expect(resolution2.cached).toBe(true);\r\n      expect(resolution2.behavior).toBe(resolution1.behavior);\r\n    });\r\n\r\n    it('should provide cache statistics', async () => {\r\n      const query1 = createMockQuery({ toolName: 'tool-1' });\r\n      const query2 = createMockQuery({ toolName: 'tool-2' });\r\n\r\n      await manager.resolvePermission(query1);\r\n      await manager.resolvePermission(query2);\r\n\r\n      const stats = manager.getCacheStats();\r\n      expect(stats.size).toBe(2);\r\n    });\r\n\r\n    it('should prune expired entries', async () => {\r\n      const shortTTLManager = new PermissionManager({\r\n        cacheEnabled: true,\r\n        cacheTTL: 100, // 100ms\r\n        userConfigPath: join(testDir, 'user2.json'),\r\n      });\r\n\r\n      await shortTTLManager.initialize();\r\n\r\n      const query = createMockQuery({ toolName: 'test-tool' });\r\n      await shortTTLManager.resolvePermission(query);\r\n\r\n      // Wait for expiration\r\n      await new Promise(resolve => setTimeout(resolve, 150));\r\n\r\n      const pruned = shortTTLManager.pruneCache();\r\n      expect(pruned).toBeGreaterThan(0);\r\n    });\r\n  });\r\n\r\n  describe('Rule Matching', () => {\r\n    it('should match exact tool names', async () => {\r\n      await manager.updatePermissions('session', {\r\n        type: 'addRules',\r\n        rules: [{ toolName: 'exact-match' }],\r\n        behavior: 'allow',\r\n        destination: 'session',\r\n      });\r\n\r\n      const query = createMockQuery({ toolName: 'exact-match' });\r\n      const resolution = await manager.resolvePermission(query);\r\n\r\n      expect(resolution.behavior).toBe('allow');\r\n    });\r\n\r\n    it('should match wildcard rules', async () => {\r\n      await manager.updatePermissions('session', {\r\n        type: 'addRules',\r\n        rules: [{ toolName: '*' }],\r\n        behavior: 'allow',\r\n        destination: 'session',\r\n      });\r\n\r\n      const query = createMockQuery({ toolName: 'any-tool' });\r\n      const resolution = await manager.resolvePermission(query);\r\n\r\n      expect(resolution.behavior).toBe('allow');\r\n    });\r\n\r\n    it('should match pattern-based rules', async () => {\r\n      await manager.updatePermissions('session', {\r\n        type: 'addRules',\r\n        rules: [{ toolName: 'test-*' }],\r\n        behavior: 'allow',\r\n        destination: 'session',\r\n      });\r\n\r\n      const query = createMockQuery({ toolName: 'test-something' });\r\n      const resolution = await manager.resolvePermission(query);\r\n\r\n      expect(resolution.behavior).toBe('allow');\r\n    });\r\n  });\r\n\r\n  describe('Bypass Mode', () => {\r\n    it('should bypass all rules when mode is bypassPermissions', async () => {\r\n      await manager.updatePermissions('session', {\r\n        type: 'setMode',\r\n        mode: 'bypassPermissions',\r\n        destination: 'session',\r\n      });\r\n\r\n      const query = createMockQuery({ toolName: 'any-tool' });\r\n      const resolution = await manager.resolvePermission(query);\r\n\r\n      expect(resolution.behavior).toBe('allow');\r\n    });\r\n  });\r\n\r\n  describe('Performance', () => {\r\n    it('should resolve permissions quickly', async () => {\r\n      await manager.updatePermissions('session', {\r\n        type: 'addRules',\r\n        rules: [{ toolName: 'test-tool' }],\r\n        behavior: 'allow',\r\n        destination: 'session',\r\n      });\r\n\r\n      const query = createMockQuery({ toolName: 'test-tool' });\r\n      const resolution = await manager.resolvePermission(query);\r\n\r\n      expect(resolution.resolutionTime).toBeLessThan(10); // Less than 10ms\r\n    });\r\n\r\n    it('should be faster with cache', async () => {\r\n      await manager.updatePermissions('session', {\r\n        type: 'addRules',\r\n        rules: [{ toolName: 'test-tool' }],\r\n        behavior: 'allow',\r\n        destination: 'session',\r\n      });\r\n\r\n      const query = createMockQuery({ toolName: 'test-tool' });\r\n\r\n      // First resolution (no cache)\r\n      const resolution1 = await manager.resolvePermission(query);\r\n      const time1 = resolution1.resolutionTime;\r\n\r\n      // Second resolution (cached)\r\n      const resolution2 = await manager.resolvePermission(query);\r\n      const time2 = resolution2.resolutionTime;\r\n\r\n      expect(time2).toBeLessThanOrEqual(time1);\r\n      expect(resolution2.cached).toBe(true);\r\n    });\r\n  });\r\n});\r\n\r\ndescribe('Factory Function', () => {\r\n  it('should create permission manager with defaults', () => {\r\n    const manager = createPermissionManager();\r\n\r\n    expect(manager).toBeInstanceOf(PermissionManager);\r\n  });\r\n\r\n  it('should create permission manager with custom options', () => {\r\n    const manager = createPermissionManager({\r\n      workingDir: '/test/dir',\r\n      cacheEnabled: false,\r\n      cacheTTL: 10000,\r\n    });\r\n\r\n    expect(manager).toBeInstanceOf(PermissionManager);\r\n  });\r\n});\r\n\r\ndescribe('Singleton Instance', () => {\r\n  it('should export singleton instance', () => {\r\n    expect(permissionManager).toBeInstanceOf(PermissionManager);\r\n  });\r\n\r\n  it('should maintain state across calls', async () => {\r\n    await permissionManager.updatePermissions('session', {\r\n      type: 'addRules',\r\n      rules: [{ toolName: 'singleton-test' }],\r\n      behavior: 'allow',\r\n      destination: 'session',\r\n    });\r\n\r\n    const config = permissionManager.getConfig('session');\r\n    expect(config?.rules.some(r => r.toolName === 'singleton-test')).toBe(true);\r\n  });\r\n});"],"names":["describe","it","expect","beforeEach","afterEach","tmpdir","join","mkdir","rm","PermissionManager","createPermissionManager","permissionManager","createTestDirectory","testDir","Date","now","recursive","cleanupTestDirectory","dir","force","error","createMockQuery","overrides","toolName","toolInput","context","sessionId","workingDir","manager","cacheEnabled","cacheTTL","userConfigPath","projectConfigPath","localConfigPath","initialize","clearCache","userConfig","getConfig","projectConfig","localConfig","sessionConfig","toBeDefined","config","mode","toBe","rules","toEqual","allowedDirectories","updatePermissions","type","behavior","destination","query","resolution","resolvePermission","level","fallbackChain","toContain","push","scope","priority","timestamp","toHaveLength","directories","not","getCacheStats","size","toBeGreaterThan","resolution1","cached","resolution2","query1","query2","stats","shortTTLManager","Promise","resolve","setTimeout","pruned","pruneCache","resolutionTime","toBeLessThan","time1","time2","toBeLessThanOrEqual","toBeInstanceOf","some","r"],"mappings":"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"}