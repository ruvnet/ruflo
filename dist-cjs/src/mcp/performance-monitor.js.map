{"version":3,"sources":["../../../src/mcp/performance-monitor.ts"],"sourcesContent":["/**\r\n * MCP Performance Monitoring and Optimization\r\n */\r\n\r\nimport { EventEmitter } from 'node:events';\r\nimport { performance } from 'node:perf_hooks';\r\nimport type { ILogger } from '../core/logger.js';\r\nimport type { MCPSession, MCPRequest, MCPResponse, MCPMetrics } from '../utils/types.js';\r\n\r\nexport interface PerformanceMetrics {\r\n  requestCount: number;\r\n  averageResponseTime: number;\r\n  minResponseTime: number;\r\n  maxResponseTime: number;\r\n  p50ResponseTime: number;\r\n  p95ResponseTime: number;\r\n  p99ResponseTime: number;\r\n  errorRate: number;\r\n  throughput: number; // requests per second\r\n  activeConnections: number;\r\n  memoryUsage: {\r\n    heapUsed: number;\r\n    heapTotal: number;\r\n    external: number;\r\n    rss: number;\r\n  };\r\n  cpuUsage: {\r\n    user: number;\r\n    system: number;\r\n  };\r\n  timestamp: Date;\r\n}\r\n\r\nexport interface RequestMetrics {\r\n  id: string;\r\n  method: string;\r\n  sessionId: string;\r\n  startTime: number;\r\n  endTime?: number;\r\n  duration?: number;\r\n  success?: boolean;\r\n  error?: string;\r\n  requestSize?: number;\r\n  responseSize?: number;\r\n}\r\n\r\nexport interface AlertRule {\r\n  id: string;\r\n  name: string;\r\n  metric: string;\r\n  operator: 'gt' | 'lt' | 'eq' | 'gte' | 'lte';\r\n  threshold: number;\r\n  duration: number; // milliseconds\r\n  enabled: boolean;\r\n  severity: 'low' | 'medium' | 'high' | 'critical';\r\n  actions: string[];\r\n}\r\n\r\nexport interface Alert {\r\n  id: string;\r\n  ruleId: string;\r\n  ruleName: string;\r\n  severity: 'low' | 'medium' | 'high' | 'critical';\r\n  message: string;\r\n  triggeredAt: Date;\r\n  resolvedAt?: Date;\r\n  currentValue: number;\r\n  threshold: number;\r\n  metadata?: Record<string, unknown>;\r\n}\r\n\r\nexport interface OptimizationSuggestion {\r\n  id: string;\r\n  type: 'performance' | 'memory' | 'throughput' | 'latency';\r\n  priority: 'low' | 'medium' | 'high';\r\n  title: string;\r\n  description: string;\r\n  impact: string;\r\n  implementation: string;\r\n  estimatedImprovement: string;\r\n  detectedAt: Date;\r\n  metrics: Record<string, number>;\r\n}\r\n\r\n/**\r\n * MCP Performance Monitor\r\n * Provides comprehensive performance monitoring, alerting, and optimization suggestions\r\n */\r\nexport class MCPPerformanceMonitor extends EventEmitter {\r\n  private requestMetrics = new Map<string, RequestMetrics>();\r\n  private historicalMetrics: PerformanceMetrics[] = [];\r\n  private responseTimes: number[] = [];\r\n  private alertRules = new Map<string, AlertRule>();\r\n  private activeAlerts = new Map<string, Alert>();\r\n  private optimizationSuggestions: OptimizationSuggestion[] = [];\r\n\r\n  private metricsTimer?: NodeJS.Timeout;\r\n  private alertCheckTimer?: NodeJS.Timeout;\r\n  private cleanupTimer?: NodeJS.Timeout;\r\n\r\n  private readonly config = {\r\n    metricsInterval: 10000, // 10 seconds\r\n    alertCheckInterval: 5000, // 5 seconds\r\n    maxHistorySize: 1000,\r\n    maxResponseTimeHistory: 10000,\r\n    cleanupInterval: 300000, // 5 minutes\r\n    requestTimeout: 30000, // 30 seconds\r\n  };\r\n\r\n  constructor(private logger: ILogger) {\r\n    super();\r\n    this.setupDefaultAlertRules();\r\n    this.startMonitoring();\r\n  }\r\n\r\n  /**\r\n   * Record the start of a request\r\n   */\r\n  recordRequestStart(request: MCPRequest, session: MCPSession): string {\r\n    const requestId = `${request.id}_${Date.now()}`;\r\n    const metrics: RequestMetrics = {\r\n      id: requestId,\r\n      method: request.method,\r\n      sessionId: session.id,\r\n      startTime: performance.now(),\r\n      requestSize: this.calculateRequestSize(request),\r\n    };\r\n\r\n    this.requestMetrics.set(requestId, metrics);\r\n\r\n    this.logger.debug('Request started', {\r\n      requestId,\r\n      method: request.method,\r\n      sessionId: session.id,\r\n    });\r\n\r\n    return requestId;\r\n  }\r\n\r\n  /**\r\n   * Record the completion of a request\r\n   */\r\n  recordRequestEnd(requestId: string, response?: MCPResponse, error?: Error): void {\r\n    const metrics = this.requestMetrics.get(requestId);\r\n    if (!metrics) {\r\n      this.logger.warn('Request metrics not found', { requestId });\r\n      return;\r\n    }\r\n\r\n    const endTime = performance.now();\r\n    const duration = endTime - metrics.startTime;\r\n\r\n    metrics.endTime = endTime;\r\n    metrics.duration = duration;\r\n    metrics.success = !error;\r\n    metrics.error = error?.message;\r\n    metrics.responseSize = response ? this.calculateResponseSize(response) : 0;\r\n\r\n    // Add to response time history\r\n    this.responseTimes.push(duration);\r\n    if (this.responseTimes.length > this.config.maxResponseTimeHistory) {\r\n      this.responseTimes.shift();\r\n    }\r\n\r\n    this.logger.debug('Request completed', {\r\n      requestId,\r\n      duration,\r\n      success: metrics.success,\r\n      error: metrics.error,\r\n    });\r\n\r\n    this.emit('requestCompleted', metrics);\r\n\r\n    // Remove from active metrics after some time\r\n    setTimeout(() => {\r\n      this.requestMetrics.delete(requestId);\r\n    }, 60000); // Keep for 1 minute\r\n  }\r\n\r\n  /**\r\n   * Get current performance metrics\r\n   */\r\n  getCurrentMetrics(): PerformanceMetrics {\r\n    const now = Date.now();\r\n    const completedRequests = Array.from(this.requestMetrics.values()).filter(\r\n      (m) => m.endTime !== undefined,\r\n    );\r\n\r\n    const successfulRequests = completedRequests.filter((m) => m.success);\r\n    const errorRate =\r\n      completedRequests.length > 0\r\n        ? ((completedRequests.length - successfulRequests.length) / completedRequests.length) * 100\r\n        : 0;\r\n\r\n    // Calculate response time percentiles\r\n    const sortedTimes = [...this.responseTimes].sort((a, b) => a - b);\r\n    const p50 = this.getPercentile(sortedTimes, 0.5);\r\n    const p95 = this.getPercentile(sortedTimes, 0.95);\r\n    const p99 = this.getPercentile(sortedTimes, 0.99);\r\n\r\n    // Calculate throughput (requests per second over last minute)\r\n    const oneMinuteAgo = now - 60000;\r\n    const recentRequests = completedRequests.filter(\r\n      (m) => m.endTime && m.startTime + oneMinuteAgo > 0,\r\n    );\r\n    const throughput = recentRequests.length / 60;\r\n\r\n    const memUsage = process.memoryUsage();\r\n    const cpuUsage = process.cpuUsage();\r\n\r\n    const metrics: PerformanceMetrics = {\r\n      requestCount: completedRequests.length,\r\n      averageResponseTime:\r\n        this.responseTimes.length > 0\r\n          ? this.responseTimes.reduce((a, b) => a + b, 0) / this.responseTimes.length\r\n          : 0,\r\n      minResponseTime: sortedTimes.length > 0 ? sortedTimes[0] : 0,\r\n      maxResponseTime: sortedTimes.length > 0 ? sortedTimes[sortedTimes.length - 1] : 0,\r\n      p50ResponseTime: p50,\r\n      p95ResponseTime: p95,\r\n      p99ResponseTime: p99,\r\n      errorRate,\r\n      throughput,\r\n      activeConnections: this.requestMetrics.size,\r\n      memoryUsage: {\r\n        heapUsed: memUsage.heapUsed,\r\n        heapTotal: memUsage.heapTotal,\r\n        external: memUsage.external,\r\n        rss: memUsage.rss,\r\n      },\r\n      cpuUsage: {\r\n        user: cpuUsage.user / 1000000, // Convert to seconds\r\n        system: cpuUsage.system / 1000000,\r\n      },\r\n      timestamp: new Date(),\r\n    };\r\n\r\n    return metrics;\r\n  }\r\n\r\n  /**\r\n   * Get historical metrics\r\n   */\r\n  getHistoricalMetrics(limit?: number): PerformanceMetrics[] {\r\n    return limit ? this.historicalMetrics.slice(-limit) : [...this.historicalMetrics];\r\n  }\r\n\r\n  /**\r\n   * Add custom alert rule\r\n   */\r\n  addAlertRule(rule: AlertRule): void {\r\n    this.alertRules.set(rule.id, rule);\r\n    this.logger.info('Alert rule added', {\r\n      id: rule.id,\r\n      name: rule.name,\r\n      metric: rule.metric,\r\n      threshold: rule.threshold,\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Remove alert rule\r\n   */\r\n  removeAlertRule(ruleId: string): void {\r\n    this.alertRules.delete(ruleId);\r\n\r\n    // Resolve any active alerts for this rule\r\n    for (const [alertId, alert] of this.activeAlerts.entries()) {\r\n      if (alert.ruleId === ruleId) {\r\n        this.resolveAlert(alertId);\r\n      }\r\n    }\r\n\r\n    this.logger.info('Alert rule removed', { ruleId });\r\n  }\r\n\r\n  /**\r\n   * Get active alerts\r\n   */\r\n  getActiveAlerts(): Alert[] {\r\n    return Array.from(this.activeAlerts.values());\r\n  }\r\n\r\n  /**\r\n   * Get optimization suggestions\r\n   */\r\n  getOptimizationSuggestions(): OptimizationSuggestion[] {\r\n    return [...this.optimizationSuggestions];\r\n  }\r\n\r\n  /**\r\n   * Get performance summary\r\n   */\r\n  getPerformanceSummary(): {\r\n    current: PerformanceMetrics;\r\n    trends: {\r\n      responseTime: 'improving' | 'degrading' | 'stable';\r\n      throughput: 'improving' | 'degrading' | 'stable';\r\n      errorRate: 'improving' | 'degrading' | 'stable';\r\n    };\r\n    alerts: number;\r\n    suggestions: number;\r\n  } {\r\n    const current = this.getCurrentMetrics();\r\n    const trends = this.calculateTrends();\r\n\r\n    return {\r\n      current,\r\n      trends,\r\n      alerts: this.activeAlerts.size,\r\n      suggestions: this.optimizationSuggestions.length,\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Resolve an alert\r\n   */\r\n  resolveAlert(alertId: string): void {\r\n    const alert = this.activeAlerts.get(alertId);\r\n    if (alert) {\r\n      alert.resolvedAt = new Date();\r\n      this.activeAlerts.delete(alertId);\r\n\r\n      this.logger.info('Alert resolved', {\r\n        alertId,\r\n        ruleName: alert.ruleName,\r\n        duration: alert.resolvedAt.getTime() - alert.triggeredAt.getTime(),\r\n      });\r\n\r\n      this.emit('alertResolved', alert);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Clear all optimization suggestions\r\n   */\r\n  clearOptimizationSuggestions(): void {\r\n    this.optimizationSuggestions = [];\r\n    this.logger.info('Optimization suggestions cleared');\r\n  }\r\n\r\n  /**\r\n   * Stop monitoring\r\n   */\r\n  stop(): void {\r\n    if (this.metricsTimer) {\r\n      clearInterval(this.metricsTimer);\r\n      this.metricsTimer = undefined;\r\n    }\r\n\r\n    if (this.alertCheckTimer) {\r\n      clearInterval(this.alertCheckTimer);\r\n      this.alertCheckTimer = undefined;\r\n    }\r\n\r\n    if (this.cleanupTimer) {\r\n      clearInterval(this.cleanupTimer);\r\n      this.cleanupTimer = undefined;\r\n    }\r\n\r\n    this.logger.info('Performance monitoring stopped');\r\n  }\r\n\r\n  private startMonitoring(): void {\r\n    // Collect metrics periodically\r\n    this.metricsTimer = setInterval(() => {\r\n      const metrics = this.getCurrentMetrics();\r\n      this.historicalMetrics.push(metrics);\r\n\r\n      // Keep only recent history\r\n      if (this.historicalMetrics.length > this.config.maxHistorySize) {\r\n        this.historicalMetrics.shift();\r\n      }\r\n\r\n      this.emit('metricsCollected', metrics);\r\n    }, this.config.metricsInterval);\r\n\r\n    // Check alerts periodically\r\n    this.alertCheckTimer = setInterval(() => {\r\n      this.checkAlerts();\r\n    }, this.config.alertCheckInterval);\r\n\r\n    // Cleanup old data\r\n    this.cleanupTimer = setInterval(() => {\r\n      this.cleanup();\r\n      this.generateOptimizationSuggestions();\r\n    }, this.config.cleanupInterval);\r\n\r\n    this.logger.info('Performance monitoring started');\r\n  }\r\n\r\n  private setupDefaultAlertRules(): void {\r\n    const defaultRules: AlertRule[] = [\r\n      {\r\n        id: 'high_response_time',\r\n        name: 'High Response Time',\r\n        metric: 'averageResponseTime',\r\n        operator: 'gt',\r\n        threshold: 5000, // 5 seconds\r\n        duration: 30000, // 30 seconds\r\n        enabled: true,\r\n        severity: 'medium',\r\n        actions: ['log', 'notify'],\r\n      },\r\n      {\r\n        id: 'high_error_rate',\r\n        name: 'High Error Rate',\r\n        metric: 'errorRate',\r\n        operator: 'gt',\r\n        threshold: 10, // 10%\r\n        duration: 60000, // 1 minute\r\n        enabled: true,\r\n        severity: 'high',\r\n        actions: ['log', 'notify', 'alert'],\r\n      },\r\n      {\r\n        id: 'low_throughput',\r\n        name: 'Low Throughput',\r\n        metric: 'throughput',\r\n        operator: 'lt',\r\n        threshold: 1, // 1 request per second\r\n        duration: 120000, // 2 minutes\r\n        enabled: true,\r\n        severity: 'medium',\r\n        actions: ['log', 'notify'],\r\n      },\r\n      {\r\n        id: 'high_memory_usage',\r\n        name: 'High Memory Usage',\r\n        metric: 'memoryUsage.heapUsed',\r\n        operator: 'gt',\r\n        threshold: 1024 * 1024 * 1024, // 1GB\r\n        duration: 300000, // 5 minutes\r\n        enabled: true,\r\n        severity: 'high',\r\n        actions: ['log', 'notify', 'alert'],\r\n      },\r\n    ];\r\n\r\n    for (const rule of defaultRules) {\r\n      this.alertRules.set(rule.id, rule);\r\n    }\r\n  }\r\n\r\n  private checkAlerts(): void {\r\n    const metrics = this.getCurrentMetrics();\r\n\r\n    for (const rule of this.alertRules.values()) {\r\n      if (!rule.enabled) continue;\r\n\r\n      const value = this.getMetricValue(metrics, rule.metric);\r\n      const triggered = this.evaluateCondition(value, rule.operator, rule.threshold);\r\n\r\n      const existingAlert = Array.from(this.activeAlerts.values()).find(\r\n        (a) => a.ruleId === rule.id && !a.resolvedAt,\r\n      );\r\n\r\n      if (triggered && !existingAlert) {\r\n        // Create new alert\r\n        const alert: Alert = {\r\n          id: `alert_${rule.id}_${Date.now()}`,\r\n          ruleId: rule.id,\r\n          ruleName: rule.name,\r\n          severity: rule.severity,\r\n          message: `${rule.name}: ${rule.metric} is ${value} (threshold: ${rule.threshold})`,\r\n          triggeredAt: new Date(),\r\n          currentValue: value,\r\n          threshold: rule.threshold,\r\n        };\r\n\r\n        this.activeAlerts.set(alert.id, alert);\r\n\r\n        this.logger.warn('Alert triggered', {\r\n          alertId: alert.id,\r\n          ruleName: rule.name,\r\n          metric: rule.metric,\r\n          value,\r\n          threshold: rule.threshold,\r\n        });\r\n\r\n        this.emit('alertTriggered', alert);\r\n      } else if (!triggered && existingAlert) {\r\n        // Resolve existing alert\r\n        this.resolveAlert(existingAlert.id);\r\n      }\r\n    }\r\n  }\r\n\r\n  private getMetricValue(metrics: PerformanceMetrics, path: string): number {\r\n    const parts = path.split('.');\r\n    let value: any = metrics;\r\n\r\n    for (const part of parts) {\r\n      value = value?.[part];\r\n      if (value === undefined) break;\r\n    }\r\n\r\n    return typeof value === 'number' ? value : 0;\r\n  }\r\n\r\n  private evaluateCondition(value: number, operator: string, threshold: number): boolean {\r\n    switch (operator) {\r\n      case 'gt':\r\n        return value > threshold;\r\n      case 'gte':\r\n        return value >= threshold;\r\n      case 'lt':\r\n        return value < threshold;\r\n      case 'lte':\r\n        return value <= threshold;\r\n      case 'eq':\r\n        return value === threshold;\r\n      default:\r\n        return false;\r\n    }\r\n  }\r\n\r\n  private getPercentile(sortedArray: number[], percentile: number): number {\r\n    if (sortedArray.length === 0) return 0;\r\n\r\n    const index = Math.ceil(sortedArray.length * percentile) - 1;\r\n    return sortedArray[Math.max(0, Math.min(index, sortedArray.length - 1))];\r\n  }\r\n\r\n  private calculateTrends(): {\r\n    responseTime: 'improving' | 'degrading' | 'stable';\r\n    throughput: 'improving' | 'degrading' | 'stable';\r\n    errorRate: 'improving' | 'degrading' | 'stable';\r\n  } {\r\n    const recentMetrics = this.historicalMetrics.slice(-10); // Last 10 data points\r\n\r\n    if (recentMetrics.length < 2) {\r\n      return {\r\n        responseTime: 'stable',\r\n        throughput: 'stable',\r\n        errorRate: 'stable',\r\n      };\r\n    }\r\n\r\n    const first = recentMetrics[0];\r\n    const last = recentMetrics[recentMetrics.length - 1];\r\n\r\n    return {\r\n      responseTime: this.getTrend(first.averageResponseTime, last.averageResponseTime, true),\r\n      throughput: this.getTrend(first.throughput, last.throughput, false),\r\n      errorRate: this.getTrend(first.errorRate, last.errorRate, true),\r\n    };\r\n  }\r\n\r\n  private getTrend(\r\n    oldValue: number,\r\n    newValue: number,\r\n    lowerIsBetter: boolean,\r\n  ): 'improving' | 'degrading' | 'stable' {\r\n    const change = (newValue - oldValue) / oldValue;\r\n    const threshold = 0.1; // 10% change threshold\r\n\r\n    if (Math.abs(change) < threshold) {\r\n      return 'stable';\r\n    }\r\n\r\n    const improving = lowerIsBetter ? change < 0 : change > 0;\r\n    return improving ? 'improving' : 'degrading';\r\n  }\r\n\r\n  private generateOptimizationSuggestions(): void {\r\n    const metrics = this.getCurrentMetrics();\r\n    const suggestions: OptimizationSuggestion[] = [];\r\n\r\n    // High response time suggestion\r\n    if (metrics.averageResponseTime > 2000) {\r\n      suggestions.push({\r\n        id: `opt_response_time_${Date.now()}`,\r\n        type: 'performance',\r\n        priority: 'high',\r\n        title: 'Optimize Response Time',\r\n        description: 'Average response time is above 2 seconds',\r\n        impact: 'Improve user experience and system throughput',\r\n        implementation:\r\n          'Consider implementing caching, optimizing database queries, or adding connection pooling',\r\n        estimatedImprovement: '30-50% response time reduction',\r\n        detectedAt: new Date(),\r\n        metrics: { averageResponseTime: metrics.averageResponseTime },\r\n      });\r\n    }\r\n\r\n    // High memory usage suggestion\r\n    if (metrics.memoryUsage.heapUsed > 512 * 1024 * 1024) {\r\n      // 512MB\r\n      suggestions.push({\r\n        id: `opt_memory_${Date.now()}`,\r\n        type: 'memory',\r\n        priority: 'medium',\r\n        title: 'Optimize Memory Usage',\r\n        description: 'Heap memory usage is high',\r\n        impact: 'Prevent memory leaks and improve stability',\r\n        implementation:\r\n          'Review memory usage patterns, implement object pooling, or add garbage collection tuning',\r\n        estimatedImprovement: '20-30% memory reduction',\r\n        detectedAt: new Date(),\r\n        metrics: { heapUsed: metrics.memoryUsage.heapUsed },\r\n      });\r\n    }\r\n\r\n    // Low throughput suggestion\r\n    if (metrics.throughput < 5 && metrics.requestCount > 100) {\r\n      suggestions.push({\r\n        id: `opt_throughput_${Date.now()}`,\r\n        type: 'throughput',\r\n        priority: 'medium',\r\n        title: 'Improve Throughput',\r\n        description: 'Request throughput is below optimal levels',\r\n        impact: 'Handle more concurrent requests efficiently',\r\n        implementation: 'Consider horizontal scaling, load balancing, or request batching',\r\n        estimatedImprovement: '2-3x throughput increase',\r\n        detectedAt: new Date(),\r\n        metrics: { throughput: metrics.throughput },\r\n      });\r\n    }\r\n\r\n    // Add only new suggestions\r\n    for (const suggestion of suggestions) {\r\n      const exists = this.optimizationSuggestions.some(\r\n        (s) => s.type === suggestion.type && s.title === suggestion.title,\r\n      );\r\n\r\n      if (!exists) {\r\n        this.optimizationSuggestions.push(suggestion);\r\n        this.emit('optimizationSuggestion', suggestion);\r\n      }\r\n    }\r\n\r\n    // Keep only recent suggestions (last 24 hours)\r\n    const dayAgo = new Date(Date.now() - 24 * 60 * 60 * 1000);\r\n    this.optimizationSuggestions = this.optimizationSuggestions.filter(\r\n      (s) => s.detectedAt > dayAgo,\r\n    );\r\n  }\r\n\r\n  private cleanup(): void {\r\n    const now = Date.now();\r\n\r\n    // Clean up old request metrics\r\n    for (const [id, metrics] of this.requestMetrics.entries()) {\r\n      if (now - metrics.startTime > this.config.requestTimeout) {\r\n        this.requestMetrics.delete(id);\r\n      }\r\n    }\r\n\r\n    // Clean up old response times\r\n    if (this.responseTimes.length > this.config.maxResponseTimeHistory) {\r\n      this.responseTimes = this.responseTimes.slice(-this.config.maxResponseTimeHistory);\r\n    }\r\n  }\r\n\r\n  private calculateRequestSize(request: MCPRequest): number {\r\n    return JSON.stringify(request).length;\r\n  }\r\n\r\n  private calculateResponseSize(response: MCPResponse): number {\r\n    return JSON.stringify(response).length;\r\n  }\r\n}\r\n"],"names":["EventEmitter","performance","MCPPerformanceMonitor","requestMetrics","Map","historicalMetrics","responseTimes","alertRules","activeAlerts","optimizationSuggestions","metricsTimer","alertCheckTimer","cleanupTimer","config","metricsInterval","alertCheckInterval","maxHistorySize","maxResponseTimeHistory","cleanupInterval","requestTimeout","logger","setupDefaultAlertRules","startMonitoring","recordRequestStart","request","session","requestId","id","Date","now","metrics","method","sessionId","startTime","requestSize","calculateRequestSize","set","debug","recordRequestEnd","response","error","get","warn","endTime","duration","success","message","responseSize","calculateResponseSize","push","length","shift","emit","setTimeout","delete","getCurrentMetrics","completedRequests","Array","from","values","filter","m","undefined","successfulRequests","errorRate","sortedTimes","sort","a","b","p50","getPercentile","p95","p99","oneMinuteAgo","recentRequests","throughput","memUsage","process","memoryUsage","cpuUsage","requestCount","averageResponseTime","reduce","minResponseTime","maxResponseTime","p50ResponseTime","p95ResponseTime","p99ResponseTime","activeConnections","size","heapUsed","heapTotal","external","rss","user","system","timestamp","getHistoricalMetrics","limit","slice","addAlertRule","rule","info","name","metric","threshold","removeAlertRule","ruleId","alertId","alert","entries","resolveAlert","getActiveAlerts","getOptimizationSuggestions","getPerformanceSummary","current","trends","calculateTrends","alerts","suggestions","resolvedAt","ruleName","getTime","triggeredAt","clearOptimizationSuggestions","stop","clearInterval","setInterval","checkAlerts","cleanup","generateOptimizationSuggestions","defaultRules","operator","enabled","severity","actions","value","getMetricValue","triggered","evaluateCondition","existingAlert","find","currentValue","path","parts","split","part","sortedArray","percentile","index","Math","ceil","max","min","recentMetrics","responseTime","first","last","getTrend","oldValue","newValue","lowerIsBetter","change","abs","improving","type","priority","title","description","impact","implementation","estimatedImprovement","detectedAt","suggestion","exists","some","s","dayAgo","JSON","stringify"],"mappings":"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"}