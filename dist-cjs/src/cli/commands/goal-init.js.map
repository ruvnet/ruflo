{"version":3,"sources":["../../../../src/cli/commands/goal-init.ts"],"sourcesContent":["#!/usr/bin/env node\r\nimport { promises as fs } from 'fs';\r\nimport path from 'path';\r\nimport { fileURLToPath } from 'url';\r\nimport chalk from 'chalk';\r\nimport { logger } from '../../monitoring/logger.js';\r\n\r\nconst __filename = fileURLToPath(import.meta.url);\r\nconst __dirname = path.dirname(__filename);\r\n\r\ninterface InitOptions {\r\n  force?: boolean;\r\n  targetDir?: string;\r\n}\r\n\r\nexport class GoalInitCommand {\r\n  private readonly sourcePath = path.resolve(__dirname, '../../../.claude/agents/goal');\r\n  \r\n  async execute(options: InitOptions = {}): Promise<void> {\r\n    const targetDir = options.targetDir || '.claude/agents/goal';\r\n    const absoluteTarget = path.resolve(process.cwd(), targetDir);\r\n    \r\n    logger.info(chalk.magenta('üéØ Initializing Claude Flow Goal Module...'));\r\n    \r\n    try {\r\n      // Check if target exists\r\n      const exists = await this.checkExists(absoluteTarget);\r\n      \r\n      if (exists && !options.force) {\r\n        logger.warn(chalk.yellow('‚ö†Ô∏è  Goal module already exists. Use --force to overwrite.'));\r\n        const prompt = await this.confirmOverwrite();\r\n        if (!prompt) {\r\n          logger.info(chalk.gray('Installation cancelled.'));\r\n          return;\r\n        }\r\n      }\r\n      \r\n      // Create target directory\r\n      await fs.mkdir(absoluteTarget, { recursive: true });\r\n      \r\n      // Copy goal agent files\r\n      await this.copyGoalFiles(absoluteTarget);\r\n      \r\n      // Initialize configuration\r\n      await this.initializeConfig(absoluteTarget);\r\n      \r\n      // Verify installation\r\n      const verified = await this.verifyInstallation(absoluteTarget);\r\n      \r\n      if (verified) {\r\n        logger.success(chalk.green('‚úÖ Goal module initialized successfully!'));\r\n        this.printUsage();\r\n      } else {\r\n        throw new Error('Installation verification failed');\r\n      }\r\n      \r\n    } catch (error) {\r\n      logger.error(chalk.red('‚ùå Failed to initialize goal module:'), error);\r\n      throw error;\r\n    }\r\n  }\r\n  \r\n  private async checkExists(targetPath: string): Promise<boolean> {\r\n    try {\r\n      await fs.access(targetPath);\r\n      return true;\r\n    } catch {\r\n      return false;\r\n    }\r\n  }\r\n  \r\n  private async confirmOverwrite(): Promise<boolean> {\r\n    // In a real implementation, this would use inquirer or similar\r\n    // For now, we'll return false to be safe\r\n    console.log(chalk.yellow('Would you like to overwrite? (y/N)'));\r\n    return false;\r\n  }\r\n  \r\n  private async copyGoalFiles(targetDir: string): Promise<void> {\r\n    // Copy goal-planner agent\r\n    const plannerSource = path.join(this.sourcePath, 'goal-planner.md');\r\n    const plannerTarget = path.join(targetDir, 'goal-planner.md');\r\n    \r\n    // Check if source exists in package\r\n    try {\r\n      // First try to copy from local installation\r\n      await fs.copyFile(plannerSource, plannerTarget);\r\n      logger.info(chalk.gray('  ‚Ä¢ Copied goal-planner.md'));\r\n    } catch (error) {\r\n      // If not found locally, create from embedded template\r\n      await this.createPlannerTemplate(plannerTarget);\r\n      logger.info(chalk.gray('  ‚Ä¢ Created goal-planner.md from template'));\r\n    }\r\n    \r\n    // Create additional goal agents if needed\r\n    await this.createGoalAgents(targetDir);\r\n  }\r\n  \r\n  private async createPlannerTemplate(targetPath: string): Promise<void> {\r\n    const template = `---\r\nname: goal-planner\r\ndescription: \"Goal-Oriented Action Planning (GOAP) specialist\"\r\ncolor: purple\r\n---\r\n\r\n# Goal-Oriented Action Planning Agent\r\n\r\nUses gaming AI techniques to create intelligent plans for achieving complex objectives.\r\n\r\n## Core Capabilities\r\n- Dynamic planning with A* search algorithms\r\n- Precondition analysis and effect prediction\r\n- Adaptive replanning based on execution results\r\n- Mixed execution (LLM + deterministic code)\r\n- Tool group management\r\n\r\n## Planning Methodology\r\n1. **State Assessment**: Analyze current vs goal state\r\n2. **Action Analysis**: Inventory available actions\r\n3. **Plan Generation**: A* pathfinding for optimal sequences\r\n4. **Execution Monitoring**: OODA loop (Observe-Orient-Decide-Act)\r\n5. **Dynamic Replanning**: Adapt to changing conditions\r\n\r\n## Usage\r\n\\`\\`\\`bash\r\n# Initialize goal planning\r\nnpx claude-flow goal plan --objective \"deploy application\"\r\n\r\n# Execute plan\r\nnpx claude-flow goal execute --plan deployment-plan\r\n\\`\\`\\`\r\n`;\r\n    await fs.writeFile(targetPath, template);\r\n  }\r\n  \r\n  private async createGoalAgents(targetDir: string): Promise<void> {\r\n    // Create additional goal-oriented agents\r\n    const agents = [\r\n      {\r\n        name: 'goal-executor.md',\r\n        content: this.getExecutorTemplate()\r\n      },\r\n      {\r\n        name: 'goal-monitor.md',\r\n        content: this.getMonitorTemplate()\r\n      },\r\n      {\r\n        name: 'goal-optimizer.md',\r\n        content: this.getOptimizerTemplate()\r\n      }\r\n    ];\r\n    \r\n    for (const agent of agents) {\r\n      const targetPath = path.join(targetDir, agent.name);\r\n      await fs.writeFile(targetPath, agent.content);\r\n      logger.info(chalk.gray(`  ‚Ä¢ Created ${agent.name}`));\r\n    }\r\n  }\r\n  \r\n  private getExecutorTemplate(): string {\r\n    return `---\r\nname: goal-executor\r\ndescription: \"Executes goal-oriented action plans\"\r\ncolor: green\r\n---\r\n\r\n# Goal Executor Agent\r\n\r\nResponsible for executing action plans generated by the goal-planner.\r\n\r\n## Features\r\n- Sequential and parallel action execution\r\n- Precondition verification\r\n- Effect validation\r\n- Rollback on failure\r\n`;\r\n  }\r\n  \r\n  private getMonitorTemplate(): string {\r\n    return `---\r\nname: goal-monitor\r\ndescription: \"Monitors goal progress and triggers replanning\"\r\ncolor: yellow\r\n---\r\n\r\n# Goal Monitor Agent\r\n\r\nTracks plan execution and identifies when replanning is needed.\r\n\r\n## Features\r\n- Real-time progress tracking\r\n- Deviation detection\r\n- Performance metrics\r\n- Replanning triggers\r\n`;\r\n  }\r\n  \r\n  private getOptimizerTemplate(): string {\r\n    return `---\r\nname: goal-optimizer\r\ndescription: \"Optimizes action plans for efficiency\"\r\ncolor: blue\r\n---\r\n\r\n# Goal Optimizer Agent\r\n\r\nOptimizes action sequences for cost, time, and resource efficiency.\r\n\r\n## Features\r\n- Cost minimization\r\n- Parallel execution identification\r\n- Resource allocation\r\n- Plan compression\r\n`;\r\n  }\r\n  \r\n  private async initializeConfig(targetDir: string): Promise<void> {\r\n    const config = {\r\n      version: '1.0.0',\r\n      goal: {\r\n        enabled: true,\r\n        algorithm: 'astar',\r\n        maxPlanDepth: 100,\r\n        replanning: {\r\n          enabled: true,\r\n          threshold: 0.3,\r\n          maxRetries: 3\r\n        },\r\n        execution: {\r\n          mode: 'mixed',  // mixed, llm, code\r\n          parallel: true,\r\n          monitoring: true\r\n        }\r\n      },\r\n      agents: [\r\n        'goal-planner',\r\n        'goal-executor',\r\n        'goal-monitor',\r\n        'goal-optimizer'\r\n      ]\r\n    };\r\n    \r\n    const configPath = path.join(targetDir, 'config.json');\r\n    await fs.writeFile(configPath, JSON.stringify(config, null, 2));\r\n    logger.info(chalk.gray('  ‚Ä¢ Created goal config.json'));\r\n  }\r\n  \r\n  private async verifyInstallation(targetDir: string): Promise<boolean> {\r\n    const requiredFiles = [\r\n      'goal-planner.md',\r\n      'goal-executor.md',\r\n      'goal-monitor.md',\r\n      'goal-optimizer.md',\r\n      'config.json'\r\n    ];\r\n    \r\n    for (const file of requiredFiles) {\r\n      const filePath = path.join(targetDir, file);\r\n      const exists = await this.checkExists(filePath);\r\n      if (!exists) {\r\n        logger.error(chalk.red(`  ‚úó Missing required file: ${file}`));\r\n        return false;\r\n      }\r\n      logger.info(chalk.gray(`  ‚úì Verified ${file}`));\r\n    }\r\n    \r\n    return true;\r\n  }\r\n  \r\n  private printUsage(): void {\r\n    console.log('\\n' + chalk.magenta('üìö Usage:'));\r\n    console.log(chalk.gray('  npx claude-flow goal plan --objective \"your goal\"'));\r\n    console.log(chalk.gray('  npx claude-flow goal execute --plan plan-id'));\r\n    console.log(chalk.gray('  @agent-goal-planner \"Create deployment plan\"'));\r\n    console.log('\\n' + chalk.magenta('üîó Documentation:'));\r\n    console.log(chalk.gray('  https://github.com/ruvnet/claude-flow'));\r\n  }\r\n}\r\n\r\n// CLI execution\r\nif (import.meta.url === `file://${process.argv[1]}`) {\r\n  const command = new GoalInitCommand();\r\n  const options: InitOptions = {};\r\n  \r\n  if (process.argv.includes('--force')) {\r\n    options.force = true;\r\n  }\r\n  \r\n  const targetIndex = process.argv.indexOf('--target');\r\n  if (targetIndex !== -1 && process.argv[targetIndex + 1]) {\r\n    options.targetDir = process.argv[targetIndex + 1];\r\n  }\r\n  \r\n  command.execute(options).catch(process.exit);\r\n}\r\n\r\nexport default GoalInitCommand;"],"names":["promises","fs","path","fileURLToPath","chalk","logger","__filename","url","__dirname","dirname","GoalInitCommand","sourcePath","resolve","execute","options","targetDir","absoluteTarget","process","cwd","info","magenta","exists","checkExists","force","warn","yellow","prompt","confirmOverwrite","gray","mkdir","recursive","copyGoalFiles","initializeConfig","verified","verifyInstallation","success","green","printUsage","Error","error","red","targetPath","access","console","log","plannerSource","join","plannerTarget","copyFile","createPlannerTemplate","createGoalAgents","template","writeFile","agents","name","content","getExecutorTemplate","getMonitorTemplate","getOptimizerTemplate","agent","config","version","goal","enabled","algorithm","maxPlanDepth","replanning","threshold","maxRetries","execution","mode","parallel","monitoring","configPath","JSON","stringify","requiredFiles","file","filePath","argv","command","includes","targetIndex","indexOf","catch","exit"],"mappings":"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"}