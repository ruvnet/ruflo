{"version":3,"sources":["../../../src/cli/node-compat.js"],"sourcesContent":["/**\r\n * Node.js compatibility layer for Deno APIs\r\n * This module provides Node.js equivalents for Deno-specific APIs\r\n */\r\n\r\nimport { readdir, stat, mkdir, readFile, writeFile, unlink, rmdir } from 'fs/promises';\r\nimport { existsSync } from 'fs';\r\nimport { fileURLToPath } from 'url';\r\nimport { dirname, join, normalize } from 'path';\r\nimport process from 'process';\r\nimport { spawn } from 'child_process';\r\n\r\n// Process arguments (remove first two: node executable and script path)\r\nexport const args = process.argv.slice(2);\r\n\r\n// Current working directory\r\nexport const cwd = () => process.cwd();\r\n\r\n// File system operations\r\nexport const readDir = async (path) => {\r\n  const entries = await readdir(path, { withFileTypes: true });\r\n  return entries.map((entry) => ({\r\n    name: entry.name,\r\n    isFile: entry.isFile(),\r\n    isDirectory: entry.isDirectory(),\r\n    isSymlink: entry.isSymbolicLink(),\r\n  }));\r\n};\r\n\r\nexport const statFile = async (path) => {\r\n  const stats = await stat(path);\r\n  return {\r\n    isFile: stats.isFile(),\r\n    isDirectory: stats.isDirectory(),\r\n    size: stats.size,\r\n    mtime: stats.mtime,\r\n    atime: stats.atime,\r\n    birthtime: stats.birthtime,\r\n  };\r\n};\r\n\r\nexport const readTextFile = async (path) => {\r\n  return await readFile(path, 'utf-8');\r\n};\r\n\r\nexport const writeTextFile = async (path, content) => {\r\n  await writeFile(path, content, 'utf-8');\r\n};\r\n\r\nexport const remove = async (path) => {\r\n  const stats = await stat(path);\r\n  if (stats.isDirectory()) {\r\n    await rmdir(path, { recursive: true });\r\n  } else {\r\n    await unlink(path);\r\n  }\r\n};\r\n\r\nexport const mkdirSync = (path, options = {}) => {\r\n  const fs = require('fs');\r\n  fs.mkdirSync(path, { recursive: options.recursive });\r\n};\r\n\r\nexport const mkdirAsync = async (path, options = {}) => {\r\n  await mkdir(path, { recursive: options.recursive });\r\n};\r\n\r\n// Process operations\r\nexport const pid = process.pid;\r\n\r\nexport const kill = (pid, signal = 'SIGTERM') => {\r\n  process.kill(pid, signal);\r\n};\r\n\r\nexport const exit = (code = 0) => {\r\n  process.exit(code);\r\n};\r\n\r\nexport const execPath = () => process.execPath;\r\n\r\n// stdin/stdout/stderr support\r\nexport const stdin = {\r\n  read: async (buffer) => {\r\n    return new Promise((resolve) => {\r\n      if (process.stdin.isTTY) {\r\n        process.stdin.setRawMode(true);\r\n      }\r\n      process.stdin.resume();\r\n      process.stdin.once('data', (data) => {\r\n        const bytes = Math.min(data.length, buffer.length);\r\n        for (let i = 0; i < bytes; i++) {\r\n          buffer[i] = data[i];\r\n        }\r\n        if (process.stdin.isTTY) {\r\n          process.stdin.setRawMode(false);\r\n        }\r\n        process.stdin.pause();\r\n        resolve(bytes);\r\n      });\r\n    });\r\n  },\r\n};\r\n\r\nexport const stdout = {\r\n  write: async (data) => {\r\n    return new Promise((resolve, reject) => {\r\n      process.stdout.write(data, (err) => {\r\n        if (err) reject(err);\r\n        else resolve(data.length);\r\n      });\r\n    });\r\n  },\r\n};\r\n\r\nexport const stderr = {\r\n  write: async (data) => {\r\n    return new Promise((resolve, reject) => {\r\n      process.stderr.write(data, (err) => {\r\n        if (err) reject(err);\r\n        else resolve(data.length);\r\n      });\r\n    });\r\n  },\r\n};\r\n\r\n// Deno.errors compatibility\r\nexport const errors = {\r\n  NotFound: class NotFound extends Error {\r\n    constructor(message) {\r\n      super(message);\r\n      this.name = 'NotFound';\r\n    }\r\n  },\r\n  AlreadyExists: class AlreadyExists extends Error {\r\n    constructor(message) {\r\n      super(message);\r\n      this.name = 'AlreadyExists';\r\n    }\r\n  },\r\n  PermissionDenied: class PermissionDenied extends Error {\r\n    constructor(message) {\r\n      super(message);\r\n      this.name = 'PermissionDenied';\r\n    }\r\n  },\r\n};\r\n\r\n// import.meta compatibility\r\nexport const getImportMetaUrl = () => {\r\n  // This will be replaced by the actual import.meta.url in each file\r\n  return import.meta.url;\r\n};\r\n\r\nexport const getDirname = (importMetaUrl) => {\r\n  const __filename = fileURLToPath(importMetaUrl);\r\n  return dirname(__filename);\r\n};\r\n\r\nexport const getFilename = (importMetaUrl) => {\r\n  return fileURLToPath(importMetaUrl);\r\n};\r\n\r\n// Check if this is the main module (Node.js equivalent of import.meta.main)\r\nexport const isMainModule = (importMetaUrl) => {\r\n  const __filename = fileURLToPath(importMetaUrl);\r\n  return normalize(process.argv[1]) === normalize(__filename);\r\n};\r\n\r\n// Helper to check file existence\r\nexport { existsSync };\r\n\r\n// Build information (Node.js equivalent of Deno.build)\r\nexport const build = {\r\n  os:\r\n    process.platform === 'win32'\r\n      ? 'windows'\r\n      : process.platform === 'darwin'\r\n        ? 'darwin'\r\n        : process.platform === 'linux'\r\n          ? 'linux'\r\n          : process.platform,\r\n  arch: process.arch,\r\n  target: `${process.arch}-${process.platform}`,\r\n};\r\n\r\n// Environment variables support\r\nexport const env = {\r\n  get: (key) => process.env[key],\r\n  set: (key, value) => {\r\n    process.env[key] = value;\r\n  },\r\n  toObject: () => ({ ...process.env }),\r\n};\r\n\r\n// Deno.Command compatibility\r\nexport class Command {\r\n  constructor(command, options = {}) {\r\n    this.command = command;\r\n    this.options = options;\r\n  }\r\n\r\n  async output() {\r\n    return new Promise((resolve, reject) => {\r\n      const child = spawn(this.command, this.options.args || [], {\r\n        cwd: this.options.cwd,\r\n        env: this.options.env,\r\n        stdio: ['pipe', 'pipe', 'pipe'],\r\n      });\r\n\r\n      let stdout = [];\r\n      let stderr = [];\r\n\r\n      child.stdout.on('data', (data) => {\r\n        stdout.push(data);\r\n      });\r\n\r\n      child.stderr.on('data', (data) => {\r\n        stderr.push(data);\r\n      });\r\n\r\n      child.on('close', (code) => {\r\n        resolve({\r\n          code,\r\n          success: code === 0,\r\n          stdout: Buffer.concat(stdout),\r\n          stderr: Buffer.concat(stderr),\r\n        });\r\n      });\r\n\r\n      child.on('error', (err) => {\r\n        reject(err);\r\n      });\r\n    });\r\n  }\r\n\r\n  spawn() {\r\n    const child = spawn(this.command, this.options.args || [], {\r\n      cwd: this.options.cwd,\r\n      env: this.options.env,\r\n      stdio: this.options.stdio || 'inherit',\r\n    });\r\n\r\n    return {\r\n      status: new Promise((resolve) => {\r\n        child.on('close', (code) => {\r\n          resolve({ code, success: code === 0 });\r\n        });\r\n      }),\r\n      stdout: child.stdout,\r\n      stderr: child.stderr,\r\n      kill: (signal) => child.kill(signal),\r\n    };\r\n  }\r\n}\r\n\r\n// Legacy exports for compatibility - to be removed\r\n// These functions are now available as direct imports\r\n\r\n// NOTE: Deno export has been removed in alpha.79\r\n// All Deno APIs have been replaced with native Node.js equivalents\r\n"],"names":["readdir","stat","mkdir","readFile","writeFile","unlink","rmdir","existsSync","fileURLToPath","dirname","normalize","process","spawn","args","argv","slice","cwd","readDir","path","entries","withFileTypes","map","entry","name","isFile","isDirectory","isSymlink","isSymbolicLink","statFile","stats","size","mtime","atime","birthtime","readTextFile","writeTextFile","content","remove","recursive","mkdirSync","options","fs","require","mkdirAsync","pid","kill","signal","exit","code","execPath","stdin","read","buffer","Promise","resolve","isTTY","setRawMode","resume","once","data","bytes","Math","min","length","i","pause","stdout","write","reject","err","stderr","errors","NotFound","Error","message","AlreadyExists","PermissionDenied","getImportMetaUrl","url","getDirname","importMetaUrl","__filename","getFilename","isMainModule","build","os","platform","arch","target","env","get","key","set","value","toObject","Command","command","output","child","stdio","on","push","success","Buffer","concat","status"],"mappings":"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"}