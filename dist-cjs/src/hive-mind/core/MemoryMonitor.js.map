{"version":3,"sources":["../../../../src/hive-mind/core/MemoryMonitor.ts"],"sourcesContent":["/**\r\n * Memory Monitor and Optimization System\r\n *\r\n * Provides real-time monitoring, analysis, and optimization\r\n * recommendations for the Hive Mind memory subsystem.\r\n */\r\n\r\nimport { EventEmitter } from 'events';\r\nimport { performance } from 'perf_hooks';\r\nimport { Memory } from './Memory.js';\r\nimport { DatabaseManager } from './DatabaseManager.js';\r\n\r\ninterface MemoryAlert {\r\n  level: 'info' | 'warning' | 'critical';\r\n  type: string;\r\n  message: string;\r\n  value: number;\r\n  threshold: number;\r\n  timestamp: Date;\r\n  recommendations: string[];\r\n}\r\n\r\ninterface OptimizationSuggestion {\r\n  type: 'cache' | 'database' | 'pool' | 'compression' | 'cleanup';\r\n  priority: 'low' | 'medium' | 'high' | 'critical';\r\n  title: string;\r\n  description: string;\r\n  estimatedImpact: string;\r\n  implementation: string;\r\n  effort: 'minimal' | 'moderate' | 'significant';\r\n}\r\n\r\ninterface MemoryHealthReport {\r\n  overall: {\r\n    score: number;\r\n    status: 'excellent' | 'good' | 'fair' | 'poor' | 'critical';\r\n    summary: string;\r\n  };\r\n  metrics: {\r\n    cacheHitRate: number;\r\n    avgQueryTime: number;\r\n    memoryUtilization: number;\r\n    compressionRatio: number;\r\n    poolEfficiency: number;\r\n  };\r\n  alerts: MemoryAlert[];\r\n  suggestions: OptimizationSuggestion[];\r\n  trends: {\r\n    performance: 'improving' | 'stable' | 'degrading';\r\n    memoryUsage: 'increasing' | 'stable' | 'decreasing';\r\n    cacheEfficiency: 'improving' | 'stable' | 'degrading';\r\n  };\r\n}\r\n\r\nexport class MemoryMonitor extends EventEmitter {\r\n  private memory: Memory;\r\n  private db: DatabaseManager;\r\n  private isActive = false;\r\n  private monitoringTimers: NodeJS.Timeout[] = [];\r\n  private historicalData: Map<string, number[]> = new Map();\r\n  private alertThresholds = {\r\n    cacheHitRate: { warning: 50, critical: 30 },\r\n    avgQueryTime: { warning: 100, critical: 500 },\r\n    memoryUtilization: { warning: 80, critical: 95 },\r\n    poolReuseRate: { warning: 30, critical: 10 },\r\n  };\r\n  private alerts: MemoryAlert[] = [];\r\n  private maxHistorySize = 1000;\r\n\r\n  constructor(memory: Memory, db: DatabaseManager) {\r\n    super();\r\n    this.memory = memory;\r\n    this.db = db;\r\n  }\r\n\r\n  /**\r\n   * Start memory monitoring\r\n   */\r\n  async start(): Promise<void> {\r\n    if (this.isActive) return;\r\n\r\n    this.isActive = true;\r\n\r\n    // Real-time monitoring (every 10 seconds)\r\n    const realtimeTimer = setInterval(() => {\r\n      this.collectMetrics();\r\n    }, 10000);\r\n\r\n    // Health analysis (every minute)\r\n    const healthTimer = setInterval(() => {\r\n      this.analyzeHealth();\r\n    }, 60000);\r\n\r\n    // Trend analysis (every 5 minutes)\r\n    const trendTimer = setInterval(() => {\r\n      this.analyzeTrends();\r\n    }, 300000);\r\n\r\n    // Optimization suggestions (every 15 minutes)\r\n    const optimizationTimer = setInterval(() => {\r\n      this.generateOptimizationSuggestions();\r\n    }, 900000);\r\n\r\n    // Alert cleanup (every hour)\r\n    const cleanupTimer = setInterval(() => {\r\n      this.cleanupOldAlerts();\r\n    }, 3600000);\r\n\r\n    this.monitoringTimers.push(\r\n      realtimeTimer,\r\n      healthTimer,\r\n      trendTimer,\r\n      optimizationTimer,\r\n      cleanupTimer,\r\n    );\r\n\r\n    // Initial baseline collection\r\n    await this.establishBaseline();\r\n\r\n    this.emit('monitoring:started');\r\n  }\r\n\r\n  /**\r\n   * Stop memory monitoring\r\n   */\r\n  stop(): void {\r\n    this.isActive = false;\r\n\r\n    this.monitoringTimers.forEach((timer) => clearInterval(timer));\r\n    this.monitoringTimers.length = 0;\r\n\r\n    this.emit('monitoring:stopped');\r\n  }\r\n\r\n  /**\r\n   * Collect real-time metrics\r\n   */\r\n  private async collectMetrics(): Promise<void> {\r\n    if (!this.isActive) return;\r\n\r\n    try {\r\n      const startTime = performance.now();\r\n\r\n      // Get memory analytics\r\n      const memoryAnalytics = this.memory.getAdvancedAnalytics();\r\n      const dbAnalytics = this.db.getDatabaseAnalytics();\r\n\r\n      // Extract key metrics\r\n      const metrics = {\r\n        cacheHitRate: memoryAnalytics.cache.hitRate || 0,\r\n        avgQueryTime: dbAnalytics.performance.query_execution?.avg || 0,\r\n        memoryUtilization: memoryAnalytics.cache.utilizationPercent || 0,\r\n        poolEfficiency: this.calculatePoolEfficiency(memoryAnalytics.pools),\r\n        dbFragmentation: dbAnalytics.fragmentation || 0,\r\n        activeConnections: 1, // Simplified for now\r\n        timestamp: Date.now(),\r\n      };\r\n\r\n      // Store historical data\r\n      this.storeHistoricalData(metrics);\r\n\r\n      // Check for alerts\r\n      this.checkAlerts(metrics);\r\n\r\n      const duration = performance.now() - startTime;\r\n      this.emit('metrics:collected', { metrics, duration });\r\n    } catch (error) {\r\n      this.emit('error', error);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Establish performance baseline\r\n   */\r\n  private async establishBaseline(): Promise<void> {\r\n    const samples = [];\r\n\r\n    for (let i = 0; i < 10; i++) {\r\n      await this.collectMetrics();\r\n      await new Promise((resolve) => setTimeout(resolve, 1000));\r\n    }\r\n\r\n    this.emit('baseline:established', { samples: samples.length });\r\n  }\r\n\r\n  /**\r\n   * Store historical performance data\r\n   */\r\n  private storeHistoricalData(metrics: any): void {\r\n    for (const [key, value] of Object.entries(metrics)) {\r\n      if (typeof value === 'number') {\r\n        if (!this.historicalData.has(key)) {\r\n          this.historicalData.set(key, []);\r\n        }\r\n\r\n        const history = this.historicalData.get(key)!;\r\n        history.push(value);\r\n\r\n        // Limit history size\r\n        if (history.length > this.maxHistorySize) {\r\n          history.shift();\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Check metrics against alert thresholds\r\n   */\r\n  private checkAlerts(metrics: any): void {\r\n    const newAlerts: MemoryAlert[] = [];\r\n\r\n    // Cache hit rate alerts\r\n    const cacheHitRate = metrics.cacheHitRate;\r\n    if (cacheHitRate < this.alertThresholds.cacheHitRate.critical) {\r\n      newAlerts.push({\r\n        level: 'critical',\r\n        type: 'cache_performance',\r\n        message: `Cache hit rate critically low: ${cacheHitRate.toFixed(1)}%`,\r\n        value: cacheHitRate,\r\n        threshold: this.alertThresholds.cacheHitRate.critical,\r\n        timestamp: new Date(),\r\n        recommendations: [\r\n          'Increase cache size immediately',\r\n          'Review access patterns',\r\n          'Consider cache warming strategies',\r\n        ],\r\n      });\r\n    } else if (cacheHitRate < this.alertThresholds.cacheHitRate.warning) {\r\n      newAlerts.push({\r\n        level: 'warning',\r\n        type: 'cache_performance',\r\n        message: `Cache hit rate below optimal: ${cacheHitRate.toFixed(1)}%`,\r\n        value: cacheHitRate,\r\n        threshold: this.alertThresholds.cacheHitRate.warning,\r\n        timestamp: new Date(),\r\n        recommendations: [\r\n          'Monitor cache patterns',\r\n          'Consider increasing cache size',\r\n          'Review cache eviction policy',\r\n        ],\r\n      });\r\n    }\r\n\r\n    // Query performance alerts\r\n    const avgQueryTime = metrics.avgQueryTime;\r\n    if (avgQueryTime > this.alertThresholds.avgQueryTime.critical) {\r\n      newAlerts.push({\r\n        level: 'critical',\r\n        type: 'query_performance',\r\n        message: `Query performance critically slow: ${avgQueryTime.toFixed(1)}ms`,\r\n        value: avgQueryTime,\r\n        threshold: this.alertThresholds.avgQueryTime.critical,\r\n        timestamp: new Date(),\r\n        recommendations: [\r\n          'Immediate database optimization required',\r\n          'Review query plans and indexes',\r\n          'Consider query result caching',\r\n        ],\r\n      });\r\n    } else if (avgQueryTime > this.alertThresholds.avgQueryTime.warning) {\r\n      newAlerts.push({\r\n        level: 'warning',\r\n        type: 'query_performance',\r\n        message: `Query performance degraded: ${avgQueryTime.toFixed(1)}ms`,\r\n        value: avgQueryTime,\r\n        threshold: this.alertThresholds.avgQueryTime.warning,\r\n        timestamp: new Date(),\r\n        recommendations: [\r\n          'Monitor query performance trends',\r\n          'Consider database maintenance',\r\n          'Review recent schema changes',\r\n        ],\r\n      });\r\n    }\r\n\r\n    // Memory utilization alerts\r\n    const memoryUtilization = metrics.memoryUtilization;\r\n    if (memoryUtilization > this.alertThresholds.memoryUtilization.critical) {\r\n      newAlerts.push({\r\n        level: 'critical',\r\n        type: 'memory_utilization',\r\n        message: `Memory utilization critical: ${memoryUtilization.toFixed(1)}%`,\r\n        value: memoryUtilization,\r\n        threshold: this.alertThresholds.memoryUtilization.critical,\r\n        timestamp: new Date(),\r\n        recommendations: [\r\n          'Immediate memory cleanup required',\r\n          'Increase memory limits',\r\n          'Enable aggressive garbage collection',\r\n        ],\r\n      });\r\n    } else if (memoryUtilization > this.alertThresholds.memoryUtilization.warning) {\r\n      newAlerts.push({\r\n        level: 'warning',\r\n        type: 'memory_utilization',\r\n        message: `Memory utilization high: ${memoryUtilization.toFixed(1)}%`,\r\n        value: memoryUtilization,\r\n        threshold: this.alertThresholds.memoryUtilization.warning,\r\n        timestamp: new Date(),\r\n        recommendations: [\r\n          'Monitor memory usage trends',\r\n          'Consider memory optimization',\r\n          'Review cache sizes',\r\n        ],\r\n      });\r\n    }\r\n\r\n    // Add new alerts and emit events\r\n    if (newAlerts.length > 0) {\r\n      this.alerts.push(...newAlerts);\r\n      newAlerts.forEach((alert) => {\r\n        this.emit('alert', alert);\r\n      });\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Analyze overall system health\r\n   */\r\n  private async analyzeHealth(): Promise<void> {\r\n    const memoryHealth = await this.memory.healthCheck();\r\n    const dbHealth = await this.db.healthCheck();\r\n    const analytics = this.memory.getAdvancedAnalytics();\r\n\r\n    const healthReport: MemoryHealthReport = {\r\n      overall: {\r\n        score: this.calculateOverallScore(memoryHealth, dbHealth, analytics),\r\n        status: 'good',\r\n        summary: '',\r\n      },\r\n      metrics: {\r\n        cacheHitRate: analytics.cache.hitRate || 0,\r\n        avgQueryTime: this.getAverageFromHistory('avgQueryTime'),\r\n        memoryUtilization: analytics.cache.utilizationPercent || 0,\r\n        compressionRatio: 0.7, // Simplified\r\n        poolEfficiency: this.calculatePoolEfficiency(analytics.pools),\r\n      },\r\n      alerts: this.getActiveAlerts(),\r\n      suggestions: this.generateHealthSuggestions(analytics),\r\n      trends: this.calculateTrends(),\r\n    };\r\n\r\n    // Determine status\r\n    if (healthReport.overall.score >= 90) {\r\n      healthReport.overall.status = 'excellent';\r\n    } else if (healthReport.overall.score >= 75) {\r\n      healthReport.overall.status = 'good';\r\n    } else if (healthReport.overall.score >= 60) {\r\n      healthReport.overall.status = 'fair';\r\n    } else if (healthReport.overall.score >= 40) {\r\n      healthReport.overall.status = 'poor';\r\n    } else {\r\n      healthReport.overall.status = 'critical';\r\n    }\r\n\r\n    // Generate summary\r\n    healthReport.overall.summary = this.generateHealthSummary(healthReport);\r\n\r\n    this.emit('health:analyzed', healthReport);\r\n  }\r\n\r\n  /**\r\n   * Generate optimization suggestions\r\n   */\r\n  private generateOptimizationSuggestions(): void {\r\n    const analytics = this.memory.getAdvancedAnalytics();\r\n    const suggestions: OptimizationSuggestion[] = [];\r\n\r\n    // Cache optimization suggestions\r\n    if ((analytics.cache.hitRate || 0) < 70) {\r\n      suggestions.push({\r\n        type: 'cache',\r\n        priority: 'high',\r\n        title: 'Optimize Cache Configuration',\r\n        description: 'Cache hit rate is below optimal threshold',\r\n        estimatedImpact: 'Reduce database queries by 20-40%',\r\n        implementation: 'Increase cache size and adjust eviction policy',\r\n        effort: 'minimal',\r\n      });\r\n    }\r\n\r\n    // Database optimization suggestions\r\n    const avgQueryTime = this.getAverageFromHistory('avgQueryTime');\r\n    if (avgQueryTime > 50) {\r\n      suggestions.push({\r\n        type: 'database',\r\n        priority: 'medium',\r\n        title: 'Database Performance Tuning',\r\n        description: 'Query execution times are above optimal range',\r\n        estimatedImpact: 'Improve query performance by 30-50%',\r\n        implementation: 'Add indexes, optimize queries, run ANALYZE',\r\n        effort: 'moderate',\r\n      });\r\n    }\r\n\r\n    // Pool optimization suggestions\r\n    const poolEfficiency = this.calculatePoolEfficiency(analytics.pools);\r\n    if (poolEfficiency < 50) {\r\n      suggestions.push({\r\n        type: 'pool',\r\n        priority: 'low',\r\n        title: 'Object Pool Optimization',\r\n        description: 'Object pools have low reuse rates',\r\n        estimatedImpact: 'Reduce garbage collection pressure',\r\n        implementation: 'Increase pool sizes and improve object lifecycle',\r\n        effort: 'minimal',\r\n      });\r\n    }\r\n\r\n    this.emit('suggestions:generated', suggestions);\r\n  }\r\n\r\n  /**\r\n   * Calculate pool efficiency\r\n   */\r\n  private calculatePoolEfficiency(pools: any): number {\r\n    if (!pools) return 0;\r\n\r\n    const efficiencies = Object.values(pools).map((pool: any) => pool.reuseRate || 0);\r\n    return efficiencies.length > 0\r\n      ? efficiencies.reduce((a, b) => a + b, 0) / efficiencies.length\r\n      : 0;\r\n  }\r\n\r\n  /**\r\n   * Get average value from historical data\r\n   */\r\n  private getAverageFromHistory(metric: string): number {\r\n    const history = this.historicalData.get(metric);\r\n    if (!history || history.length === 0) return 0;\r\n\r\n    return history.reduce((a, b) => a + b, 0) / history.length;\r\n  }\r\n\r\n  /**\r\n   * Calculate overall health score\r\n   */\r\n  private calculateOverallScore(memoryHealth: any, dbHealth: any, analytics: any): number {\r\n    let score = 100;\r\n\r\n    // Cache performance impact (30%)\r\n    const cacheHitRate = analytics.cache.hitRate || 0;\r\n    score -= Math.max(0, (70 - cacheHitRate) * 0.3);\r\n\r\n    // Query performance impact (25%)\r\n    const avgQueryTime = this.getAverageFromHistory('avgQueryTime');\r\n    if (avgQueryTime > 50) {\r\n      score -= Math.min(25, (avgQueryTime - 50) * 0.5);\r\n    }\r\n\r\n    // Memory utilization impact (20%)\r\n    const memoryUtil = analytics.cache.utilizationPercent || 0;\r\n    if (memoryUtil > 80) {\r\n      score -= (memoryUtil - 80) * 0.5;\r\n    }\r\n\r\n    // Active alerts impact (15%)\r\n    const criticalAlerts = this.alerts.filter((a) => a.level === 'critical').length;\r\n    const warningAlerts = this.alerts.filter((a) => a.level === 'warning').length;\r\n    score -= criticalAlerts * 10 + warningAlerts * 5;\r\n\r\n    // Pool efficiency impact (10%)\r\n    const poolEff = this.calculatePoolEfficiency(analytics.pools);\r\n    score -= Math.max(0, (50 - poolEff) * 0.2);\r\n\r\n    return Math.max(0, Math.min(100, score));\r\n  }\r\n\r\n  /**\r\n   * Get active alerts (within last hour)\r\n   */\r\n  private getActiveAlerts(): MemoryAlert[] {\r\n    const oneHourAgo = Date.now() - 3600000;\r\n    return this.alerts.filter((alert) => alert.timestamp.getTime() > oneHourAgo);\r\n  }\r\n\r\n  /**\r\n   * Generate health-based suggestions\r\n   */\r\n  private generateHealthSuggestions(analytics: any): OptimizationSuggestion[] {\r\n    const suggestions: OptimizationSuggestion[] = [];\r\n\r\n    // Add specific suggestions based on current state\r\n    if ((analytics.cache.utilizationPercent || 0) > 90) {\r\n      suggestions.push({\r\n        type: 'cache',\r\n        priority: 'critical',\r\n        title: 'Immediate Cache Memory Relief',\r\n        description: 'Cache memory utilization is critically high',\r\n        estimatedImpact: 'Prevent system instability',\r\n        implementation: 'Increase cache memory limit or enable aggressive cleanup',\r\n        effort: 'minimal',\r\n      });\r\n    }\r\n\r\n    return suggestions;\r\n  }\r\n\r\n  /**\r\n   * Calculate performance trends\r\n   */\r\n  private calculateTrends(): any {\r\n    const trends = {\r\n      performance: 'stable' as 'improving' | 'stable' | 'degrading',\r\n      memoryUsage: 'stable' as 'increasing' | 'stable' | 'decreasing',\r\n      cacheEfficiency: 'stable' as 'improving' | 'stable' | 'degrading',\r\n    };\r\n\r\n    // Analyze query time trend\r\n    const queryTimes = this.historicalData.get('avgQueryTime') || [];\r\n    if (queryTimes.length >= 10) {\r\n      const recent = queryTimes.slice(-5);\r\n      const older = queryTimes.slice(-10, -5);\r\n      const recentAvg = recent.reduce((a, b) => a + b, 0) / recent.length;\r\n      const olderAvg = older.reduce((a, b) => a + b, 0) / older.length;\r\n\r\n      if (recentAvg < olderAvg * 0.9) {\r\n        trends.performance = 'improving';\r\n      } else if (recentAvg > olderAvg * 1.1) {\r\n        trends.performance = 'degrading';\r\n      }\r\n    }\r\n\r\n    // Analyze memory usage trend\r\n    const memoryUsage = this.historicalData.get('memoryUtilization') || [];\r\n    if (memoryUsage.length >= 10) {\r\n      const recent = memoryUsage.slice(-5);\r\n      const older = memoryUsage.slice(-10, -5);\r\n      const recentAvg = recent.reduce((a, b) => a + b, 0) / recent.length;\r\n      const olderAvg = older.reduce((a, b) => a + b, 0) / older.length;\r\n\r\n      if (recentAvg > olderAvg * 1.05) {\r\n        trends.memoryUsage = 'increasing';\r\n      } else if (recentAvg < olderAvg * 0.95) {\r\n        trends.memoryUsage = 'decreasing';\r\n      }\r\n    }\r\n\r\n    // Analyze cache efficiency trend\r\n    const cacheHitRates = this.historicalData.get('cacheHitRate') || [];\r\n    if (cacheHitRates.length >= 10) {\r\n      const recent = cacheHitRates.slice(-5);\r\n      const older = cacheHitRates.slice(-10, -5);\r\n      const recentAvg = recent.reduce((a, b) => a + b, 0) / recent.length;\r\n      const olderAvg = older.reduce((a, b) => a + b, 0) / older.length;\r\n\r\n      if (recentAvg > olderAvg * 1.05) {\r\n        trends.cacheEfficiency = 'improving';\r\n      } else if (recentAvg < olderAvg * 0.95) {\r\n        trends.cacheEfficiency = 'degrading';\r\n      }\r\n    }\r\n\r\n    return trends;\r\n  }\r\n\r\n  /**\r\n   * Analyze trends over time\r\n   */\r\n  private analyzeTrends(): void {\r\n    const trends = this.calculateTrends();\r\n    this.emit('trends:analyzed', trends);\r\n  }\r\n\r\n  /**\r\n   * Generate health summary\r\n   */\r\n  private generateHealthSummary(report: MemoryHealthReport): string {\r\n    const { overall, metrics, alerts } = report;\r\n\r\n    if (overall.status === 'excellent') {\r\n      return 'All memory systems are operating at peak efficiency with optimal performance metrics.';\r\n    } else if (overall.status === 'good') {\r\n      return 'Memory systems are performing well with minor optimization opportunities.';\r\n    } else if (overall.status === 'fair') {\r\n      return `Memory performance is acceptable but ${alerts.length} issue(s) need attention.`;\r\n    } else if (overall.status === 'poor') {\r\n      return `Memory systems require optimization. Cache hit rate: ${metrics.cacheHitRate.toFixed(1)}%, Avg query time: ${metrics.avgQueryTime.toFixed(1)}ms.`;\r\n    } else {\r\n      return `Critical memory issues detected. Immediate intervention required. ${alerts.filter((a) => a.level === 'critical').length} critical alert(s) active.`;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Clean up old alerts\r\n   */\r\n  private cleanupOldAlerts(): void {\r\n    const cutoff = Date.now() - 86400000; // 24 hours\r\n    const initialCount = this.alerts.length;\r\n\r\n    this.alerts = this.alerts.filter((alert) => alert.timestamp.getTime() > cutoff);\r\n\r\n    const cleaned = initialCount - this.alerts.length;\r\n    if (cleaned > 0) {\r\n      this.emit('alerts:cleaned', { cleaned });\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get current monitoring status\r\n   */\r\n  getStatus() {\r\n    return {\r\n      isActive: this.isActive,\r\n      alertCount: this.alerts.length,\r\n      criticalAlerts: this.alerts.filter((a) => a.level === 'critical').length,\r\n      warningAlerts: this.alerts.filter((a) => a.level === 'warning').length,\r\n      historicalDataPoints: Array.from(this.historicalData.entries()).map(([key, values]) => ({\r\n        metric: key,\r\n        samples: values.length,\r\n      })),\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Get detailed memory report\r\n   */\r\n  async generateDetailedReport(): Promise<MemoryHealthReport> {\r\n    const memoryHealth = await this.memory.healthCheck();\r\n    const dbHealth = await this.db.healthCheck();\r\n    const analytics = this.memory.getAdvancedAnalytics();\r\n\r\n    return {\r\n      overall: {\r\n        score: this.calculateOverallScore(memoryHealth, dbHealth, analytics),\r\n        status: 'good',\r\n        summary: '',\r\n      },\r\n      metrics: {\r\n        cacheHitRate: analytics.cache.hitRate || 0,\r\n        avgQueryTime: this.getAverageFromHistory('avgQueryTime'),\r\n        memoryUtilization: analytics.cache.utilizationPercent || 0,\r\n        compressionRatio: 0.7,\r\n        poolEfficiency: this.calculatePoolEfficiency(analytics.pools),\r\n      },\r\n      alerts: this.getActiveAlerts(),\r\n      suggestions: this.generateHealthSuggestions(analytics),\r\n      trends: this.calculateTrends(),\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Export monitoring data for analysis\r\n   */\r\n  exportData() {\r\n    return {\r\n      historicalData: Object.fromEntries(this.historicalData),\r\n      alerts: this.alerts,\r\n      thresholds: this.alertThresholds,\r\n      status: this.getStatus(),\r\n    };\r\n  }\r\n}\r\n"],"names":["EventEmitter","performance","MemoryMonitor","memory","db","isActive","monitoringTimers","historicalData","Map","alertThresholds","cacheHitRate","warning","critical","avgQueryTime","memoryUtilization","poolReuseRate","alerts","maxHistorySize","start","realtimeTimer","setInterval","collectMetrics","healthTimer","analyzeHealth","trendTimer","analyzeTrends","optimizationTimer","generateOptimizationSuggestions","cleanupTimer","cleanupOldAlerts","push","establishBaseline","emit","stop","forEach","timer","clearInterval","length","startTime","now","memoryAnalytics","getAdvancedAnalytics","dbAnalytics","getDatabaseAnalytics","metrics","cache","hitRate","query_execution","avg","utilizationPercent","poolEfficiency","calculatePoolEfficiency","pools","dbFragmentation","fragmentation","activeConnections","timestamp","Date","storeHistoricalData","checkAlerts","duration","error","samples","i","Promise","resolve","setTimeout","key","value","Object","entries","has","set","history","get","shift","newAlerts","level","type","message","toFixed","threshold","recommendations","alert","memoryHealth","healthCheck","dbHealth","analytics","healthReport","overall","score","calculateOverallScore","status","summary","getAverageFromHistory","compressionRatio","getActiveAlerts","suggestions","generateHealthSuggestions","trends","calculateTrends","generateHealthSummary","priority","title","description","estimatedImpact","implementation","effort","efficiencies","values","map","pool","reuseRate","reduce","a","b","metric","Math","max","min","memoryUtil","criticalAlerts","filter","warningAlerts","poolEff","oneHourAgo","getTime","memoryUsage","cacheEfficiency","queryTimes","recent","slice","older","recentAvg","olderAvg","cacheHitRates","report","cutoff","initialCount","cleaned","getStatus","alertCount","historicalDataPoints","Array","from","generateDetailedReport","exportData","fromEntries","thresholds"],"mappings":"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"}