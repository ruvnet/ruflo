{"version":3,"sources":["../../../../../src/cli/simple-commands/init/hive-mind-init.js"],"sourcesContent":["/**\r\n * Hive Mind Initialization Module for Claude Flow v2.0.0\r\n * Provides comprehensive hive-mind system setup for the init process\r\n */\r\n\r\nimport { promises as fs } from 'fs';\r\nimport { existsSync } from 'fs';\r\nimport path from 'path';\r\nimport { printSuccess, printError, printWarning } from '../../utils.js';\r\n\r\n/**\r\n * Default hive-mind configuration\r\n */\r\nexport const DEFAULT_HIVE_CONFIG = {\r\n  version: '2.0.0',\r\n  initialized: new Date().toISOString(),\r\n  system: {\r\n    enabled: true,\r\n    autoStart: false,\r\n    maxRetries: 3,\r\n    healthCheckInterval: 30000,\r\n  },\r\n  queen: {\r\n    type: 'strategic',\r\n    name: 'Queen-Genesis',\r\n    capabilities: [\r\n      'task-decomposition',\r\n      'consensus-building',\r\n      'resource-allocation',\r\n      'quality-assessment',\r\n      'conflict-resolution'\r\n    ],\r\n    decisionThreshold: 0.75,\r\n    adaptiveLearning: true,\r\n  },\r\n  workers: {\r\n    maxWorkers: 8,\r\n    defaultCapabilities: [\r\n      'code-analysis',\r\n      'implementation',\r\n      'testing',\r\n      'documentation'\r\n    ],\r\n    autoScale: true,\r\n    scaleThreshold: 0.8,\r\n    specializedRoles: [\r\n      'architect',\r\n      'researcher',\r\n      'implementer',\r\n      'tester',\r\n      'reviewer'\r\n    ],\r\n  },\r\n  consensus: {\r\n    algorithm: 'weighted-majority',\r\n    minimumParticipants: 3,\r\n    timeoutMs: 30000,\r\n    requiredConsensus: 0.67,\r\n    votingMethods: ['majority', 'weighted', 'unanimous', 'quorum'],\r\n  },\r\n  memory: {\r\n    enabled: true,\r\n    size: 100,\r\n    persistenceMode: 'database',\r\n    sharedMemoryNamespace: 'hive-collective',\r\n    retentionDays: 30,\r\n    compressionEnabled: true,\r\n    encryptionEnabled: false,\r\n  },\r\n  communication: {\r\n    protocol: 'secure-messaging',\r\n    encryption: false,\r\n    messageQueue: {\r\n      maxSize: 1000,\r\n      priorityLevels: 5,\r\n      batchProcessing: true,\r\n    },\r\n    channels: [\r\n      'task-coordination',\r\n      'knowledge-sharing',\r\n      'consensus-voting',\r\n      'error-reporting',\r\n      'performance-metrics'\r\n    ],\r\n  },\r\n  integration: {\r\n    mcpTools: {\r\n      enabled: true,\r\n      parallel: true,\r\n      timeout: 60000,\r\n      fallbackMode: 'sequential',\r\n    },\r\n    claudeCode: {\r\n      enabled: true,\r\n      autoSpawn: true,\r\n      coordination: true,\r\n      sharedContext: true,\r\n    },\r\n    github: {\r\n      enabled: false,\r\n      autoCommit: false,\r\n      branchStrategy: 'feature',\r\n    },\r\n  },\r\n  monitoring: {\r\n    enabled: true,\r\n    metricsCollection: true,\r\n    performanceTracking: true,\r\n    healthChecks: true,\r\n    alerting: {\r\n      enabled: false,\r\n      thresholds: {\r\n        errorRate: 0.1,\r\n        responseTime: 5000,\r\n        consensusFailures: 3,\r\n      },\r\n    },\r\n  },\r\n};\r\n\r\n/**\r\n * Database schema for hive-mind system\r\n */\r\nexport const HIVE_DB_SCHEMA = {\r\n  swarms: `\r\n    CREATE TABLE IF NOT EXISTS swarms (\r\n      id TEXT PRIMARY KEY,\r\n      name TEXT NOT NULL,\r\n      objective TEXT,\r\n      status TEXT DEFAULT 'active',\r\n      queen_type TEXT DEFAULT 'strategic',\r\n      topology TEXT DEFAULT 'hierarchical',\r\n      max_agents INTEGER DEFAULT 8,\r\n      created_at DATETIME DEFAULT CURRENT_TIMESTAMP,\r\n      updated_at DATETIME DEFAULT CURRENT_TIMESTAMP,\r\n      metadata TEXT DEFAULT '{}'\r\n    );\r\n  `,\r\n  agents: `\r\n    CREATE TABLE IF NOT EXISTS agents (\r\n      id TEXT PRIMARY KEY,\r\n      swarm_id TEXT,\r\n      name TEXT NOT NULL,\r\n      type TEXT NOT NULL,\r\n      role TEXT,\r\n      capabilities TEXT DEFAULT '[]',\r\n      status TEXT DEFAULT 'active',\r\n      performance_score REAL DEFAULT 0.5,\r\n      task_count INTEGER DEFAULT 0,\r\n      success_rate REAL DEFAULT 1.0,\r\n      last_active DATETIME DEFAULT CURRENT_TIMESTAMP,\r\n      created_at DATETIME DEFAULT CURRENT_TIMESTAMP,\r\n      metadata TEXT DEFAULT '{}',\r\n      FOREIGN KEY (swarm_id) REFERENCES swarms (id)\r\n    );\r\n  `,\r\n  tasks: `\r\n    CREATE TABLE IF NOT EXISTS tasks (\r\n      id TEXT PRIMARY KEY,\r\n      swarm_id TEXT,\r\n      agent_id TEXT,\r\n      name TEXT NOT NULL,\r\n      description TEXT,\r\n      status TEXT DEFAULT 'pending',\r\n      priority INTEGER DEFAULT 3,\r\n      complexity REAL DEFAULT 0.5,\r\n      estimated_time INTEGER,\r\n      actual_time INTEGER,\r\n      created_at DATETIME DEFAULT CURRENT_TIMESTAMP,\r\n      started_at DATETIME,\r\n      completed_at DATETIME,\r\n      metadata TEXT DEFAULT '{}',\r\n      FOREIGN KEY (swarm_id) REFERENCES swarms (id),\r\n      FOREIGN KEY (agent_id) REFERENCES agents (id)\r\n    );\r\n  `,\r\n  messages: `\r\n    CREATE TABLE IF NOT EXISTS messages (\r\n      id TEXT PRIMARY KEY,\r\n      swarm_id TEXT,\r\n      sender_id TEXT,\r\n      recipient_id TEXT,\r\n      channel TEXT DEFAULT 'general',\r\n      type TEXT DEFAULT 'info',\r\n      content TEXT NOT NULL,\r\n      priority INTEGER DEFAULT 3,\r\n      consensus_vote REAL,\r\n      timestamp DATETIME DEFAULT CURRENT_TIMESTAMP,\r\n      processed BOOLEAN DEFAULT 0,\r\n      metadata TEXT DEFAULT '{}',\r\n      FOREIGN KEY (swarm_id) REFERENCES swarms (id),\r\n      FOREIGN KEY (sender_id) REFERENCES agents (id),\r\n      FOREIGN KEY (recipient_id) REFERENCES agents (id)\r\n    );\r\n  `,\r\n  consensus_votes: `\r\n    CREATE TABLE IF NOT EXISTS consensus_votes (\r\n      id TEXT PRIMARY KEY,\r\n      swarm_id TEXT,\r\n      proposal_id TEXT NOT NULL,\r\n      agent_id TEXT,\r\n      vote REAL NOT NULL,\r\n      weight REAL DEFAULT 1.0,\r\n      justification TEXT,\r\n      timestamp DATETIME DEFAULT CURRENT_TIMESTAMP,\r\n      FOREIGN KEY (swarm_id) REFERENCES swarms (id),\r\n      FOREIGN KEY (agent_id) REFERENCES agents (id)\r\n    );\r\n  `,\r\n  knowledge_base: `\r\n    CREATE TABLE IF NOT EXISTS knowledge_base (\r\n      id TEXT PRIMARY KEY,\r\n      swarm_id TEXT,\r\n      category TEXT DEFAULT 'general',\r\n      title TEXT NOT NULL,\r\n      content TEXT NOT NULL,\r\n      tags TEXT DEFAULT '[]',\r\n      confidence REAL DEFAULT 0.5,\r\n      source_agent_id TEXT,\r\n      created_at DATETIME DEFAULT CURRENT_TIMESTAMP,\r\n      updated_at DATETIME DEFAULT CURRENT_TIMESTAMP,\r\n      access_count INTEGER DEFAULT 0,\r\n      FOREIGN KEY (swarm_id) REFERENCES swarms (id),\r\n      FOREIGN KEY (source_agent_id) REFERENCES agents (id)\r\n    );\r\n  `,\r\n  performance_metrics: `\r\n    CREATE TABLE IF NOT EXISTS performance_metrics (\r\n      id TEXT PRIMARY KEY,\r\n      entity_type TEXT NOT NULL,\r\n      entity_id TEXT NOT NULL,\r\n      metric_name TEXT NOT NULL,\r\n      metric_value REAL NOT NULL,\r\n      timestamp DATETIME DEFAULT CURRENT_TIMESTAMP,\r\n      metadata TEXT DEFAULT '{}'\r\n    );\r\n  `,\r\n  sessions: `\r\n    CREATE TABLE IF NOT EXISTS sessions (\r\n      id TEXT PRIMARY KEY,\r\n      swarm_id TEXT NOT NULL,\r\n      swarm_name TEXT NOT NULL,\r\n      objective TEXT,\r\n      status TEXT DEFAULT 'active',\r\n      created_at DATETIME DEFAULT CURRENT_TIMESTAMP,\r\n      updated_at DATETIME DEFAULT CURRENT_TIMESTAMP,\r\n      paused_at DATETIME,\r\n      resumed_at DATETIME,\r\n      completion_percentage REAL DEFAULT 0,\r\n      checkpoint_data TEXT,\r\n      metadata TEXT,\r\n      parent_pid INTEGER,\r\n      child_pids TEXT,\r\n      FOREIGN KEY (swarm_id) REFERENCES swarms (id)\r\n    );\r\n  `,\r\n};\r\n\r\n/**\r\n * Create hive-mind directory structure\r\n */\r\nexport async function createHiveMindDirectories(workingDir, dryRun = false) {\r\n  const directories = [\r\n    '.hive-mind',\r\n    '.hive-mind/sessions',\r\n    '.hive-mind/memory',\r\n    '.hive-mind/logs',\r\n    '.hive-mind/backups',\r\n    '.hive-mind/config',\r\n    '.hive-mind/templates',\r\n    '.hive-mind/exports',\r\n  ];\r\n\r\n  console.log('  ðŸ“ Creating hive-mind directory structure...');\r\n\r\n  for (const dir of directories) {\r\n    const fullPath = path.join(workingDir, dir);\r\n    if (!dryRun) {\r\n      await fs.mkdir(fullPath, { recursive: true });\r\n    } else {\r\n      console.log(`    [DRY RUN] Would create: ${dir}`);\r\n    }\r\n  }\r\n\r\n  if (!dryRun) {\r\n    console.log('  âœ… Hive-mind directories created');\r\n  }\r\n}\r\n\r\n/**\r\n * Initialize collective memory database\r\n */\r\nexport async function initializeCollectiveMemoryDatabase(workingDir, dryRun = false) {\r\n  console.log('  ðŸ§  Initializing collective memory database...');\r\n\r\n  if (dryRun) {\r\n    console.log('    [DRY RUN] Would initialize hive.db with full schema');\r\n    console.log('    [DRY RUN] Would create indexes for performance optimization');\r\n    console.log('    [DRY RUN] Would insert default data and configurations');\r\n    return;\r\n  }\r\n\r\n  try {\r\n    // Dynamic import for better-sqlite3 with proper error handling\r\n    let Database;\r\n    try {\r\n      Database = (await import('better-sqlite3')).default;\r\n    } catch (err) {\r\n      console.log('    âš ï¸  better-sqlite3 not available, using fallback memory database');\r\n      return await createFallbackMemoryDatabase(workingDir);\r\n    }\r\n\r\n    const hivePath = path.join(workingDir, '.hive-mind', 'hive.db');\r\n    const hiveDb = new Database(hivePath);\r\n    \r\n    // Enable WAL mode for better concurrency\r\n    hiveDb.pragma('journal_mode = WAL');\r\n    hiveDb.pragma('synchronous = NORMAL');\r\n    hiveDb.pragma('cache_size = 1000');\r\n    hiveDb.pragma('temp_store = MEMORY');\r\n\r\n    // Create all tables\r\n    console.log('    ðŸ“‹ Creating database schema...');\r\n    for (const [tableName, schema] of Object.entries(HIVE_DB_SCHEMA)) {\r\n      hiveDb.exec(schema);\r\n    }\r\n\r\n    // Create indexes for performance\r\n    console.log('    ðŸ” Creating performance indexes...');\r\n    const indexes = [\r\n      'CREATE INDEX IF NOT EXISTS idx_agents_swarm_id ON agents(swarm_id);',\r\n      'CREATE INDEX IF NOT EXISTS idx_agents_status ON agents(status);',\r\n      'CREATE INDEX IF NOT EXISTS idx_tasks_swarm_id ON tasks(swarm_id);',\r\n      'CREATE INDEX IF NOT EXISTS idx_tasks_agent_id ON tasks(agent_id);',\r\n      'CREATE INDEX IF NOT EXISTS idx_tasks_status ON tasks(status);',\r\n      'CREATE INDEX IF NOT EXISTS idx_messages_swarm_id ON messages(swarm_id);',\r\n      'CREATE INDEX IF NOT EXISTS idx_messages_timestamp ON messages(timestamp);',\r\n      'CREATE INDEX IF NOT EXISTS idx_consensus_votes_swarm_id ON consensus_votes(swarm_id);',\r\n      'CREATE INDEX IF NOT EXISTS idx_knowledge_base_swarm_id ON knowledge_base(swarm_id);',\r\n      'CREATE INDEX IF NOT EXISTS idx_knowledge_base_category ON knowledge_base(category);',\r\n      'CREATE INDEX IF NOT EXISTS idx_performance_metrics_entity ON performance_metrics(entity_type, entity_id);',\r\n      'CREATE INDEX IF NOT EXISTS idx_sessions_swarm_id ON sessions(swarm_id);',\r\n    ];\r\n\r\n    for (const index of indexes) {\r\n      hiveDb.exec(index);\r\n    }\r\n\r\n    // Insert initial metadata\r\n    const insertInitialData = hiveDb.prepare(`\r\n      INSERT OR IGNORE INTO knowledge_base (id, category, title, content, confidence)\r\n      VALUES (?, ?, ?, ?, ?)\r\n    `);\r\n\r\n    const initialKnowledge = [\r\n      ['init-1', 'system', 'Hive Mind System Initialization', 'Hive mind system successfully initialized with full database schema and configuration.', 1.0],\r\n      ['init-2', 'capabilities', 'Default Agent Capabilities', JSON.stringify(DEFAULT_HIVE_CONFIG.workers.defaultCapabilities), 0.9],\r\n      ['init-3', 'consensus', 'Consensus Algorithms', JSON.stringify(DEFAULT_HIVE_CONFIG.consensus), 1.0],\r\n      ['init-4', 'queen', 'Queen Configuration', JSON.stringify(DEFAULT_HIVE_CONFIG.queen), 1.0],\r\n    ];\r\n\r\n    for (const knowledge of initialKnowledge) {\r\n      insertInitialData.run(...knowledge);\r\n    }\r\n\r\n    hiveDb.close();\r\n    console.log('  âœ… Collective memory database initialized with full schema');\r\n\r\n  } catch (err) {\r\n    console.log(`    âš ï¸  Could not initialize hive database: ${err.message}`);\r\n    return await createFallbackMemoryDatabase(workingDir);\r\n  }\r\n}\r\n\r\n/**\r\n * Create fallback memory database when SQLite is not available\r\n */\r\nasync function createFallbackMemoryDatabase(workingDir) {\r\n  console.log('    ðŸ“„ Creating fallback JSON memory database...');\r\n  \r\n  const fallbackDb = {\r\n    metadata: {\r\n      type: 'fallback',\r\n      initialized: new Date().toISOString(),\r\n      warning: 'Using JSON fallback - install better-sqlite3 for full database features'\r\n    },\r\n    swarms: [],\r\n    agents: [],\r\n    tasks: [],\r\n    messages: [],\r\n    consensus_votes: [],\r\n    knowledge_base: [\r\n      {\r\n        id: 'init-1',\r\n        category: 'system',\r\n        title: 'Fallback Memory System',\r\n        content: 'Using JSON-based fallback memory system. Install better-sqlite3 for full database features.',\r\n        confidence: 1.0,\r\n        created_at: new Date().toISOString()\r\n      }\r\n    ],\r\n    performance_metrics: [],\r\n    sessions: []\r\n  };\r\n\r\n  const fallbackPath = path.join(workingDir, '.hive-mind', 'memory.json');\r\n  await fs.writeFile(fallbackPath, JSON.stringify(fallbackDb, null, 2), 'utf8');\r\n  \r\n  console.log('  âœ… Fallback memory database created');\r\n  return true;\r\n}\r\n\r\n/**\r\n * Create default queen and worker configurations\r\n */\r\nexport async function createDefaultConfigurations(workingDir, dryRun = false) {\r\n  console.log('  ðŸ‘‘ Creating default queen and worker configurations...');\r\n\r\n  if (dryRun) {\r\n    console.log('    [DRY RUN] Would create queen configurations');\r\n    console.log('    [DRY RUN] Would create worker configurations');\r\n    console.log('    [DRY RUN] Would create role templates');\r\n    return;\r\n  }\r\n\r\n  const configDir = path.join(workingDir, '.hive-mind', 'config');\r\n\r\n  // Queen configurations\r\n  const queenConfigs = {\r\n    strategic: {\r\n      name: 'Strategic Queen',\r\n      description: 'Focuses on long-term planning and high-level coordination',\r\n      capabilities: [\r\n        'strategic-planning',\r\n        'resource-optimization',\r\n        'risk-assessment',\r\n        'quality-oversight',\r\n        'team-coordination'\r\n      ],\r\n      decisionStyle: 'analytical',\r\n      planningHorizon: 'long-term',\r\n      adaptability: 0.7,\r\n      specialties: ['architecture', 'planning', 'coordination']\r\n    },\r\n    tactical: {\r\n      name: 'Tactical Queen',\r\n      description: 'Focuses on execution efficiency and immediate problem-solving',\r\n      capabilities: [\r\n        'task-optimization',\r\n        'rapid-response',\r\n        'resource-allocation',\r\n        'performance-monitoring',\r\n        'conflict-resolution'\r\n      ],\r\n      decisionStyle: 'pragmatic',\r\n      planningHorizon: 'short-term',\r\n      adaptability: 0.9,\r\n      specialties: ['execution', 'optimization', 'troubleshooting']\r\n    },\r\n    adaptive: {\r\n      name: 'Adaptive Queen',\r\n      description: 'Dynamically adjusts approach based on context and feedback',\r\n      capabilities: [\r\n        'pattern-recognition',\r\n        'adaptive-learning',\r\n        'context-switching',\r\n        'feedback-integration',\r\n        'dynamic-planning'\r\n      ],\r\n      decisionStyle: 'flexible',\r\n      planningHorizon: 'adaptive',\r\n      adaptability: 1.0,\r\n      specialties: ['learning', 'adaptation', 'context-awareness']\r\n    }\r\n  };\r\n\r\n  // Worker role templates\r\n  const workerTemplates = {\r\n    architect: {\r\n      name: 'System Architect',\r\n      description: 'Designs system architecture and technical specifications',\r\n      capabilities: [\r\n        'system-design',\r\n        'architecture-patterns',\r\n        'scalability-planning',\r\n        'technology-selection',\r\n        'documentation'\r\n      ],\r\n      complexity: 0.9,\r\n      autonomy: 0.8,\r\n      collaboration: 0.7\r\n    },\r\n    researcher: {\r\n      name: 'Research Specialist',\r\n      description: 'Conducts research and gathers information for informed decisions',\r\n      capabilities: [\r\n        'information-gathering',\r\n        'analysis',\r\n        'trend-identification',\r\n        'competitive-research',\r\n        'reporting'\r\n      ],\r\n      complexity: 0.7,\r\n      autonomy: 0.9,\r\n      collaboration: 0.6\r\n    },\r\n    implementer: {\r\n      name: 'Implementation Specialist',\r\n      description: 'Translates designs into working code and solutions',\r\n      capabilities: [\r\n        'coding',\r\n        'debugging',\r\n        'integration',\r\n        'optimization',\r\n        'deployment'\r\n      ],\r\n      complexity: 0.8,\r\n      autonomy: 0.7,\r\n      collaboration: 0.8\r\n    },\r\n    tester: {\r\n      name: 'Quality Assurance Specialist',\r\n      description: 'Ensures quality through testing and validation',\r\n      capabilities: [\r\n        'testing',\r\n        'validation',\r\n        'quality-assurance',\r\n        'automation',\r\n        'reporting'\r\n      ],\r\n      complexity: 0.6,\r\n      autonomy: 0.8,\r\n      collaboration: 0.7\r\n    },\r\n    reviewer: {\r\n      name: 'Code Review Specialist',\r\n      description: 'Reviews code quality and provides improvement suggestions',\r\n      capabilities: [\r\n        'code-review',\r\n        'quality-assessment',\r\n        'best-practices',\r\n        'mentoring',\r\n        'documentation-review'\r\n      ],\r\n      complexity: 0.8,\r\n      autonomy: 0.8,\r\n      collaboration: 0.9\r\n    }\r\n  };\r\n\r\n  // Save configurations\r\n  await fs.writeFile(\r\n    path.join(configDir, 'queens.json'),\r\n    JSON.stringify(queenConfigs, null, 2),\r\n    'utf8'\r\n  );\r\n\r\n  await fs.writeFile(\r\n    path.join(configDir, 'workers.json'),\r\n    JSON.stringify(workerTemplates, null, 2),\r\n    'utf8'\r\n  );\r\n\r\n  console.log('  âœ… Default configurations created');\r\n}\r\n\r\n/**\r\n * Create hive-mind config file with sensible defaults\r\n */\r\nexport async function createHiveMindConfig(workingDir, customConfig = {}, dryRun = false) {\r\n  console.log('  âš™ï¸ Creating hive-mind configuration file...');\r\n\r\n  if (dryRun) {\r\n    console.log('    [DRY RUN] Would create config.json with merged settings');\r\n    return;\r\n  }\r\n\r\n  // Merge custom config with defaults\r\n  const config = mergeDeep(DEFAULT_HIVE_CONFIG, customConfig);\r\n  \r\n  const configPath = path.join(workingDir, '.hive-mind', 'config.json');\r\n  await fs.writeFile(configPath, JSON.stringify(config, null, 2), 'utf8');\r\n  \r\n  console.log('  âœ… Hive-mind configuration created');\r\n  return config;\r\n}\r\n\r\n/**\r\n * Create initial README and documentation files\r\n */\r\nexport async function createHiveMindDocumentation(workingDir, dryRun = false) {\r\n  console.log('  ðŸ“š Creating hive-mind documentation...');\r\n\r\n  if (dryRun) {\r\n    console.log('    [DRY RUN] Would create README.md and documentation files');\r\n    return;\r\n  }\r\n\r\n  const readmeContent = `# Hive Mind System\r\n\r\nThis directory contains the Claude Flow Hive Mind system configuration and data.\r\n\r\n## Directory Structure\r\n\r\n- **config/**: Configuration files for queens, workers, and system settings\r\n- **sessions/**: Active and historical session data\r\n- **memory/**: Collective memory and knowledge base\r\n- **logs/**: System and debug logs\r\n- **backups/**: Automated backups of system state\r\n- **templates/**: Templates for agents and workflows\r\n- **exports/**: Exported data and reports\r\n\r\n## Database Files\r\n\r\n- **hive.db**: Main SQLite database (or memory.json as fallback)\r\n- **config.json**: Primary system configuration\r\n\r\n## Getting Started\r\n\r\n1. Initialize: \\`npx claude-flow@alpha hive-mind init\\`\r\n2. Spawn swarm: \\`npx claude-flow@alpha hive-mind spawn \"your objective\"\\`\r\n3. Check status: \\`npx claude-flow@alpha hive-mind status\\`\r\n\r\n## Features\r\n\r\n- **Collective Intelligence**: Multiple AI agents working together\r\n- **Consensus Building**: Democratic decision-making process\r\n- **Adaptive Learning**: System improves over time\r\n- **Fault Tolerance**: Self-healing and recovery capabilities\r\n- **Performance Monitoring**: Real-time metrics and optimization\r\n\r\n## Configuration\r\n\r\nEdit \\`.hive-mind/config.json\\` to customize:\r\n- Queen type and capabilities\r\n- Worker specializations\r\n- Consensus algorithms\r\n- Memory settings\r\n- Integration options\r\n\r\nFor more information, see the [Hive Mind Documentation](https://github.com/ruvnet/claude-flow/docs/hive-mind.md).\r\n`;\r\n\r\n  await fs.writeFile(\r\n    path.join(workingDir, '.hive-mind', 'README.md'),\r\n    readmeContent,\r\n    'utf8'\r\n  );\r\n\r\n  console.log('  âœ… Hive-mind documentation created');\r\n}\r\n\r\n/**\r\n * Complete hive-mind initialization\r\n */\r\nexport async function initializeHiveMind(workingDir, options = {}, dryRun = false) {\r\n  console.log('ðŸ§  Initializing Hive Mind System...');\r\n\r\n  try {\r\n    // Create directory structure\r\n    await createHiveMindDirectories(workingDir, dryRun);\r\n\r\n    // Initialize collective memory database\r\n    await initializeCollectiveMemoryDatabase(workingDir, dryRun);\r\n\r\n    // Create default configurations\r\n    await createDefaultConfigurations(workingDir, dryRun);\r\n\r\n    // Create main config file\r\n    await createHiveMindConfig(workingDir, options.config || {}, dryRun);\r\n\r\n    // Create documentation\r\n    await createHiveMindDocumentation(workingDir, dryRun);\r\n\r\n    if (!dryRun) {\r\n      printSuccess('ðŸ§  Hive Mind System initialized successfully');\r\n    } else {\r\n      console.log('[DRY RUN] Hive Mind System would be fully initialized');\r\n    }\r\n\r\n    return {\r\n      success: true,\r\n      features: [\r\n        'Collective memory database',\r\n        'Queen and worker configurations',\r\n        'Consensus mechanisms',\r\n        'Performance monitoring',\r\n        'Session management',\r\n        'Knowledge base'\r\n      ]\r\n    };\r\n\r\n  } catch (error) {\r\n    printError(`Failed to initialize Hive Mind System: ${error.message}`);\r\n    return {\r\n      success: false,\r\n      error: error.message,\r\n      rollbackRequired: true\r\n    };\r\n  }\r\n}\r\n\r\n/**\r\n * Get hive-mind initialization status for init summary\r\n */\r\nexport function getHiveMindStatus(workingDir) {\r\n  const configPath = path.join(workingDir, '.hive-mind', 'config.json');\r\n  const dbPath = path.join(workingDir, '.hive-mind', 'hive.db');\r\n  const fallbackPath = path.join(workingDir, '.hive-mind', 'memory.json');\r\n\r\n  const status = {\r\n    configured: existsSync(configPath),\r\n    database: existsSync(dbPath) ? 'sqlite' : existsSync(fallbackPath) ? 'fallback' : 'none',\r\n    directories: existsSync(path.join(workingDir, '.hive-mind')),\r\n  };\r\n\r\n  return status;\r\n}\r\n\r\n/**\r\n * Rollback hive-mind initialization (cleanup on failure)\r\n */\r\nexport async function rollbackHiveMindInit(workingDir) {\r\n  console.log('ðŸ”„ Rolling back hive-mind initialization...');\r\n  \r\n  try {\r\n    const hiveMindDir = path.join(workingDir, '.hive-mind');\r\n    if (existsSync(hiveMindDir)) {\r\n      await fs.rmdir(hiveMindDir, { recursive: true });\r\n      console.log('  âœ… Hive-mind directory removed');\r\n    }\r\n    return { success: true };\r\n  } catch (error) {\r\n    printError(`Failed to rollback hive-mind initialization: ${error.message}`);\r\n    return { success: false, error: error.message };\r\n  }\r\n}\r\n\r\n/**\r\n * Deep merge utility for configuration objects\r\n */\r\nfunction mergeDeep(target, source) {\r\n  const output = Object.assign({}, target);\r\n  if (isObject(target) && isObject(source)) {\r\n    Object.keys(source).forEach(key => {\r\n      if (isObject(source[key])) {\r\n        if (!(key in target))\r\n          Object.assign(output, { [key]: source[key] });\r\n        else\r\n          output[key] = mergeDeep(target[key], source[key]);\r\n      } else {\r\n        Object.assign(output, { [key]: source[key] });\r\n      }\r\n    });\r\n  }\r\n  return output;\r\n}\r\n\r\nfunction isObject(item) {\r\n  return (item && typeof item === 'object' && !Array.isArray(item));\r\n}"],"names":["promises","fs","existsSync","path","printSuccess","printError","DEFAULT_HIVE_CONFIG","version","initialized","Date","toISOString","system","enabled","autoStart","maxRetries","healthCheckInterval","queen","type","name","capabilities","decisionThreshold","adaptiveLearning","workers","maxWorkers","defaultCapabilities","autoScale","scaleThreshold","specializedRoles","consensus","algorithm","minimumParticipants","timeoutMs","requiredConsensus","votingMethods","memory","size","persistenceMode","sharedMemoryNamespace","retentionDays","compressionEnabled","encryptionEnabled","communication","protocol","encryption","messageQueue","maxSize","priorityLevels","batchProcessing","channels","integration","mcpTools","parallel","timeout","fallbackMode","claudeCode","autoSpawn","coordination","sharedContext","github","autoCommit","branchStrategy","monitoring","metricsCollection","performanceTracking","healthChecks","alerting","thresholds","errorRate","responseTime","consensusFailures","HIVE_DB_SCHEMA","swarms","agents","tasks","messages","consensus_votes","knowledge_base","performance_metrics","sessions","createHiveMindDirectories","workingDir","dryRun","directories","console","log","dir","fullPath","join","mkdir","recursive","initializeCollectiveMemoryDatabase","Database","default","err","createFallbackMemoryDatabase","hivePath","hiveDb","pragma","tableName","schema","Object","entries","exec","indexes","index","insertInitialData","prepare","initialKnowledge","JSON","stringify","knowledge","run","close","message","fallbackDb","metadata","warning","id","category","title","content","confidence","created_at","fallbackPath","writeFile","createDefaultConfigurations","configDir","queenConfigs","strategic","description","decisionStyle","planningHorizon","adaptability","specialties","tactical","adaptive","workerTemplates","architect","complexity","autonomy","collaboration","researcher","implementer","tester","reviewer","createHiveMindConfig","customConfig","config","mergeDeep","configPath","createHiveMindDocumentation","readmeContent","initializeHiveMind","options","success","features","error","rollbackRequired","getHiveMindStatus","dbPath","status","configured","database","rollbackHiveMindInit","hiveMindDir","rmdir","target","source","output","assign","isObject","keys","forEach","key","item","Array","isArray"],"mappings":"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"}